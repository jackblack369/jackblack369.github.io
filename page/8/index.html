<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="source is the essence">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="source is the essence">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="brook">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>source is the essence</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="source is the essence" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">source is the essence</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/09/01/JVM%20learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/01/JVM%20learn/" class="post-title-link" itemprop="url">JVM Learn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-09-01 08:35:47" itemprop="dateCreated datePublished" datetime="2021-09-01T08:35:47+08:00">2021-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-06 11:23:48" itemprop="dateModified" datetime="2023-03-06T11:23:48+08:00">2023-03-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="堆内与堆外"><a href="#堆内与堆外" class="headerlink" title="堆内与堆外"></a>堆内与堆外</h2><h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><ul>
<li><p>常说的堆，指的是堆内内存，由JVM「托管」的内存区域。对应的英文是：on-heap Memory。所有的对象都是放在堆中。</p>
</li>
<li><p>堆的特点：</p>
</li>
<li><ul>
<li>由GC管理，一旦堆大小大于1GB会出现比较明显的暂停。</li>
<li>对象存储到GC中无需进行序列化、反序列化的。</li>
</ul>
</li>
</ul>
<h3 id="堆外"><a href="#堆外" class="headerlink" title="堆外"></a>堆外</h3><ul>
<li><p>堆外就是JVM开辟出来的，堆以外的一块「非托管」内存区域。对应的英文是：off-heap Memory。堆外内存也是 JVM 进程开辟的一块内存空间。只不过，GC不会「光顾」这里。</p>
</li>
<li><p>堆外的特点：</p>
</li>
<li><ul>
<li>由操作系统直接管理。别的进程能够直接访问。</li>
<li>特别适合分配次数少，读写非常频繁的场景。</li>
<li>可以避免在分配GB级别的内存而造成GC开销。</li>
</ul>
</li>
<li><p>堆外的缺点：</p>
</li>
<li><ul>
<li>容易出现内存泄漏，难以排查。</li>
<li>对象的存储需要序列化、和反序列化。</li>
</ul>
</li>
</ul>
<p>因为堆外内存由此特点，很多高性能的应用组件基于off-heap来提高性能。</p>
<h4 id="堆外内存常配合使用System-GC"><a href="#堆外内存常配合使用System-GC" class="headerlink" title="堆外内存常配合使用System GC"></a>堆外内存常配合使用System GC</h4><blockquote>
<p>堆外内存主要针对java.nio.DirectByteBuffer，这些对象的创建过程会通过Unsafe接口直接通过os::malloc来分配内存，然后将内存的起始地址和大小存到java.nio.DirectByteBuffer对象里，这样就可以直接操作这些内存。这些内存只有在DirectByteBuffer回收掉之后才有机会被回收，因此如果这些对象大部分都移到了old，但是一直没有触发CMS GC或者Full GC，那么悲剧将会发生，因为你的物理内存被他们耗尽了，因此为了避免这种悲剧的发生，通过-XX:MaxDirectMemorySize来指定最大的堆外内存大小，当使用达到了阈值的时候将调用System.gc来做一次full gc，以此来回收掉没有被使用的堆外内存。</p>
</blockquote>
<h3 id="System-gc常识"><a href="#System-gc常识" class="headerlink" title="System.gc常识"></a>System.gc常识</h3><ul>
<li>system.gc其实是做一次full gc</li>
<li>system.gc会暂停整个进程</li>
<li>system.gc一般情况下我们要禁掉，使用-XX:+DisableExplicitGC</li>
<li>system.gc在cms gc下我们通过-XX:+ExplicitGCInvokesConcurrent来做一次稍微高效点的GC(效果比Full GC要好些)</li>
<li>system.gc最常见的场景是RMI/NIO下的堆外内存分配等</li>
</ul>
<h1 id="jvm常用参数的设置和含义"><a href="#jvm常用参数的设置和含义" class="headerlink" title="jvm常用参数的设置和含义"></a>jvm常用参数的设置和含义</h1><p><strong>1.设置堆的最大和最小值</strong><br> -Xmx20M(最大值) ,-Xms20M(最小值)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xms和-Xmx实际上是 -XX:InitialHeapSize 和-XX:MaxHeapSize 的缩写</span><br></pre></td></tr></table></figure>

<p><strong>2.设置栈的大小</strong><br> -Xss128k： 设置每个线程的堆栈大小。JDK5.0以后每个线程堆栈大小为1M，以前每个线程堆栈大小为256K。更具应用的线程所需内存大小进行调整。在相同物理内 存下，减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在3000~5000左右。</p>
<p>功能开关:</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>默认值或限制</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-XX:-AllowUserSignalHandlers</td>
<td>限于Linux和Solaris，默认不启用</td>
<td>允许为java进程安装信号处理器,信号处理参见类:sun.misc.Signal, sun.misc.SignalHandler</td>
</tr>
<tr>
<td>-XX:+DisableExplicitGC</td>
<td>默认启用</td>
<td>禁止在运行期显式地调用System.gc()</td>
</tr>
<tr>
<td>-XX:+FailOverToOldVerifier</td>
<td>Java6新引入选项，默认启用</td>
<td>如果新的Class校验器检查失败，则使用老的校验器(失败原因:因为JDK6最高向下兼容到JDK1.2，而JDK1.2的class info 与JDK6的info存在较大的差异，所以新校验器可能会出现校验失败的情况)</td>
</tr>
<tr>
<td>-XX:+HandlePromotionFailure</td>
<td>java5以前是默认不启用，java6默认启用</td>
<td>关闭新生代收集担保</td>
</tr>
<tr>
<td>-XX:+MaxFDLimit</td>
<td>限于Solaris，默认启用</td>
<td>设置java进程可用文件描述符为操作系统允许的最大值。</td>
</tr>
<tr>
<td>-XX:PreBlockSpin=10</td>
<td>-XX:+UseSpinning 必须先启用，对于java6来说已经默认启用了，这里默认自旋10次</td>
<td>控制多线程自旋锁优化的自旋次数</td>
</tr>
<tr>
<td>-XX:-RelaxAccessControlCheck</td>
<td>默认不启用</td>
<td>在Class校验器中，放松对访问控制的检查,作用与reflection里的setAccessible类似</td>
</tr>
<tr>
<td>-XX:+ScavengeBeforeFullGC</td>
<td>默认启用</td>
<td>在Full GC前触发一次Minor GC</td>
</tr>
<tr>
<td>-XX:+UseAltSigs</td>
<td>限于Solaris，默认启用</td>
<td>为了防止与其他发送信号的应用程序冲突，允许使用候补信号替代 SIGUSR1和SIGUSR2</td>
</tr>
<tr>
<td>-XX:+UseBoundThreads</td>
<td>限于Solaris, 默认启用</td>
<td>绑定所有的用户线程到内核线程, 减少线程进入饥饿状态（得不到任何cpu time）的次数</td>
</tr>
<tr>
<td>-XX:-UseConcMarkSweepGC</td>
<td>默认不启用</td>
<td>启用CMS低停顿垃圾收集器,减少FGC的暂停时间</td>
</tr>
<tr>
<td>-XX:+UseGCOverheadLimit</td>
<td>默认启用</td>
<td>限制GC的运行时间。如果GC耗时过长，就抛OOM</td>
</tr>
<tr>
<td>-XX:+UseLWPSynchronization</td>
<td>限于solaris，默认启用</td>
<td>使用轻量级进程（内核线程）替换线程同步</td>
</tr>
<tr>
<td>-XX:-UseParallelGC</td>
<td>-server时启用,其他情况下，默认不启用</td>
<td>策略为新生代使用并行清除，年老代使用单线程Mark-Sweep-Compact的垃圾收集器</td>
</tr>
<tr>
<td>-XX:-UseParallelOldGC</td>
<td>默认不启用</td>
<td>策略为老年代和新生代都使用并行清除的垃圾收集器</td>
</tr>
<tr>
<td>-XX:-UseSerialGC</td>
<td>-client时启用,其他情况下，默认不启用</td>
<td>使用串行垃圾收集器</td>
</tr>
<tr>
<td>-XX:-UseSpinning</td>
<td>java1.4.2和1.5需要手动启用, java6默认已启用</td>
<td>启用多线程自旋锁优化</td>
</tr>
<tr>
<td>-XX:+UseTLAB</td>
<td>1.4.2以前和使用-client选项时，默认不启用，其余版本默认启用</td>
<td>启用线程本地缓存区</td>
</tr>
<tr>
<td>-XX:+UseSplitVerifier</td>
<td>java5默认不启用, java6默认启用</td>
<td>使用新的Class类型校验器</td>
</tr>
<tr>
<td>-XX:+UseThreadPriorities</td>
<td>默认启用</td>
<td>使用本地线程的优先级</td>
</tr>
<tr>
<td>-XX:+UseVMInterruptibleIO</td>
<td>限于solaris，默认启用</td>
<td>在solaris中，允许运行时中断线程</td>
</tr>
</tbody></table>
<p>性能参数:</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>默认值或限制</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-XX:+AggressiveOpts</td>
<td>JDK 5 update 6后引入，但需要手动启用, JDK6默认启用</td>
<td>启用JVM开发团队最新的调优成果。例如编译优化，偏向锁，并行年老代收集等</td>
</tr>
<tr>
<td>-XX:CompileThreshold=10000</td>
<td>1000</td>
<td>通过JIT编译器，将方法编译成机器码的触发阀值，可以理解为调用方法的次数，例如调1000次，将方法编译为机器码</td>
</tr>
<tr>
<td>-XX:LargePageSizeInBytes=4m</td>
<td>默认4m, amd64位：2m</td>
<td>设置堆内存的内存页大小</td>
</tr>
<tr>
<td>-XX:MaxHeapFreeRatio=70</td>
<td>70</td>
<td>GC后，如果发现空闲堆内存占到整个预估上限值的70%，则收缩预估上限值</td>
</tr>
<tr>
<td>-XX:MaxNewSize=size</td>
<td>1.3.1 Sparc: 32m, 1.3.1 x86: 2.5m</td>
<td>新生代占整个堆内存的最大值</td>
</tr>
<tr>
<td>-XX:MaxPermSize=64m</td>
<td>5.0以后: 64 bit VMs会增大预设值的30%, 1.4 amd64: 96m, 1.3.1 -client: 32m, 其他默认 64m</td>
<td>Perm（俗称方法区）占整个堆内存的最大值</td>
</tr>
<tr>
<td>-XX:MinHeapFreeRatio=40</td>
<td>40</td>
<td>GC后，如果发现空闲堆内存占到整个预估上限值的40%，则增大上限值</td>
</tr>
<tr>
<td>-XX:NewRatio=2</td>
<td>Sparc -client: 8, x86 -server: 8, x86 -client: 12, -client: 4 (1.3), 8 (1.3.1+), x86: 12, 其他默认 2</td>
<td>新生代和年老代的堆内存占用比例, 例如2表示新生代占年老代的1/2，占整个堆内存的1/3</td>
</tr>
<tr>
<td>-XX:NewSize=2.125m</td>
<td>5.0以后: 64 bit Vms 会增大预设值的30%, x86: 1m, x86, 5.0以后: 640k, 其他默认 2.125m</td>
<td>新生代预估上限的默认值</td>
</tr>
<tr>
<td>-XX:ReservedCodeCacheSize=32m</td>
<td>Solaris 64-bit, amd64, -server x86: 48m, 1.5.0_06之前, Solaris 64-bit amd64: 1024m, 其他默认 32m</td>
<td>设置代码缓存的最大值，编译时用</td>
</tr>
<tr>
<td>-XX:SurvivorRatio=8</td>
<td>Solaris amd64: 6, Sparc in 1.3.1: 25, Solaris platforms 5.0以前: 32, 其他默认 8</td>
<td>Eden与Survivor的占用比例。例如8表示，一个survivor区占用 1/8 的Eden内存，即1/10的新生代内存，为什么不是1/9？ 因为我们的新生代有2个survivor，即S0和S1。所以survivor总共是占用新生代内存的 2/10，Eden与新生代的占比则为 8/10</td>
</tr>
<tr>
<td>-XX:TargetSurvivorRatio=50</td>
<td>50</td>
<td>实际使用的survivor空间大小占比。默认是50%，最高90%</td>
</tr>
<tr>
<td>-XX:ThreadStackSize=512</td>
<td>Sparc: 512, Solaris x86: 320 (5.0以前 256), Sparc 64 bit: 1024, Linux amd64: 1024 (5.0 以前 0), 其他默认 512.</td>
<td>线程堆栈大小</td>
</tr>
<tr>
<td>-XX:+UseBiasedLocking</td>
<td>JDK 5 update 6后引入，但需要手动启用, JDK6默认启用</td>
<td>启用偏向锁</td>
</tr>
<tr>
<td>-XX:+UseFastAccessorMethods</td>
<td>默认启用</td>
<td>优化原始类型的getter方法性能(get/set:Primitive Type)</td>
</tr>
<tr>
<td>-XX:-UseISM</td>
<td>默认启用</td>
<td>启用solaris的ISM</td>
</tr>
<tr>
<td>-XX:+UseLargePages</td>
<td>JDK 5 update 5后引入，但需要手动启用, JDK6默认启用</td>
<td>启用大内存分页</td>
</tr>
<tr>
<td>-XX:+UseMPSS</td>
<td>1.4.1 之前: 不启用, 其余版本默认启用</td>
<td>启用solaris的MPSS，不能与ISM同时使用</td>
</tr>
<tr>
<td>-XX:+UseStringCache</td>
<td>默认开启</td>
<td>启用缓存常用的字符串。</td>
</tr>
<tr>
<td>-XX:AllocatePrefetchLines=1</td>
<td>1</td>
<td>Number of cache lines to load after the last object allocation using prefetch instructions generated in JIT compiled code. Default values are 1 if the last allocated object was an instance and 3 if it was an array.</td>
</tr>
<tr>
<td>-XX:AllocatePrefetchStyle=1</td>
<td>1</td>
<td>Generated code style for prefetch instructions. 0 – no prefetch instructions are generate<em>d</em>, 1 – execute prefetch instructions after each allocation, 2 – use TLAB allocation watermark pointer to gate when prefetch instructions are executed.</td>
</tr>
<tr>
<td>-XX:+UseCompressedStrings</td>
<td>Java 6 update 21有一选项</td>
<td>其中，对于不需要16位字符的字符串，可以使用byte[] 而非char[]。对于许多应用，这可以节省内存，但速度较慢（5％-10％）</td>
</tr>
<tr>
<td>-XX:+OptimizeStringConcat</td>
<td>在Java 6更新20中引入</td>
<td>优化字符串连接操作在可能的情况下</td>
</tr>
</tbody></table>
<p>调试参数:</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>默认值或限制</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-XX:-CITime</td>
<td></td>
<td>打印发费在JIT编译上的时间</td>
</tr>
<tr>
<td>-XX:ErrorFile=./hs_err_pid<pid>.log</td>
<td>JDK6中引入</td>
<td>错误文件</td>
</tr>
<tr>
<td>-XX:-ExtendedDTraceProbes</td>
<td>JDK6中引入仅在Solaris</td>
<td>启用性能的影响DTrace探测器</td>
</tr>
<tr>
<td>-XX:HeapDumpPath=./java_pid<pid>.hprof</td>
<td>1.4.2 update 12, 5.0 update 7</td>
<td>指定HeapDump的文件路径或目录</td>
</tr>
<tr>
<td>-XX:-HeapDumpOnOutOfMemoryError</td>
<td>1.4.2 update 12, 5.0 update 7</td>
<td>当抛出OOM时进行HeapDump</td>
</tr>
<tr>
<td>-XX:OnError=”<cmd args>;<cmd args>”</td>
<td>1.4.2 update 9</td>
<td>当发生错误时执行用户指定的命令</td>
</tr>
<tr>
<td>-XX:OnOutOfMemoryError=”<cmd args>; <cmd args>”</td>
<td>1.4.2 update 12, 6</td>
<td>当发生OOM时执行用户指定的命令</td>
</tr>
<tr>
<td>-XX:-PrintClassHistogram</td>
<td>1.4.2</td>
<td>当Ctrl+Break发生时打印Class实例信息,与jmap -histo相同</td>
</tr>
<tr>
<td>-XX:-PrintConcurrentLocks</td>
<td>6</td>
<td>当Ctrl+Break发生时打印java.util.concurrent的锁信息, 与jstack -l相同</td>
</tr>
<tr>
<td>-XX:-PrintCommandLineFlags</td>
<td>5</td>
<td>打印命令行上的标记</td>
</tr>
<tr>
<td>-XX:-PrintCompilation</td>
<td></td>
<td>当方法被编译时打印信息</td>
</tr>
<tr>
<td>-XX:-PrintGC</td>
<td></td>
<td>当GC发生时打印信息</td>
</tr>
<tr>
<td>-XX:-PrintGCDetails</td>
<td>1.4.0</td>
<td>打印GC详细信息</td>
</tr>
<tr>
<td>-XX:-PrintGCTimeStamps</td>
<td>1.4.0</td>
<td>打印GC用时</td>
</tr>
<tr>
<td>-XX:-PrintTenuringDistribution</td>
<td></td>
<td>打印Tenuring年龄信息</td>
</tr>
<tr>
<td>-XX:-TraceClassLoading</td>
<td></td>
<td>跟踪类加载</td>
</tr>
<tr>
<td>-XX:-TraceClassLoadingPreorder</td>
<td>1.4.2</td>
<td>跟踪所有加载的引用类</td>
</tr>
<tr>
<td>-XX:-TraceClassResolution</td>
<td>1.4.2</td>
<td>跟踪常量池的变化</td>
</tr>
<tr>
<td>-XX:-TraceClassUnloading</td>
<td></td>
<td>跟踪类的卸载</td>
</tr>
<tr>
<td>-XX:-TraceLoaderConstraints</td>
<td>6</td>
<td>Trace recording of loader constraints</td>
</tr>
<tr>
<td>-XX:+PerfSaveDataToFile</td>
<td></td>
<td>退出时保存jvmstat二进制文件</td>
</tr>
<tr>
<td>-XX:ParallelGCThreads=</td>
<td></td>
<td>设置新生代与老年代并行垃圾回收器的线程数</td>
</tr>
<tr>
<td>-XX:+UseCompressedOops</td>
<td></td>
<td>Enables the use of compressed pointers (object references represented as 32 bit offsets instead of 64-bit pointers) for optimized 64-bit performance with Java heap sizes less than 32gb.</td>
</tr>
<tr>
<td>-XX:+AlwaysPreTouch</td>
<td></td>
<td>Pre-touch the Java heap during JVM initialization. Every page of the heap is thus demand-zeroed during initialization rather than incrementally during application execution.</td>
</tr>
<tr>
<td>-XX:AllocatePrefetchDistance=</td>
<td></td>
<td>Sets the prefetch distance for object allocation. Memory about to be written with the value of new objects is prefetched into cache at this distance (in bytes) beyond the address of the last allocated object. Each Java thread has its own allocation point. The default value varies with the platform on which the JVM is running.</td>
</tr>
<tr>
<td>-XX:InlineSmallCode=</td>
<td></td>
<td>当编译的代码小于指定的值时,内联编译的代码</td>
</tr>
<tr>
<td>-XX:MaxInlineSize=35</td>
<td></td>
<td>内联方法的最大字节数</td>
</tr>
<tr>
<td>-XX:FreqInlineSize=</td>
<td></td>
<td>内联频繁执行的方法的最大字节码大小</td>
</tr>
<tr>
<td>-XX:LoopUnrollLimit=</td>
<td></td>
<td>Unroll loop bodies with server compiler intermediate representation node count less than this value. The limit used by the server compiler is a function of this value, not the actual value. The default value varies with the platform on which the JVM is running.</td>
</tr>
<tr>
<td>-XX:InitialTenuringThreshold=7</td>
<td></td>
<td>设置初始的对象在新生代中最大存活次数</td>
</tr>
<tr>
<td>-XX:MaxTenuringThreshold=</td>
<td></td>
<td>设置对象在新生代中最大的存活次数,最大值15,并行回收机制默认为15,CMS默认为4</td>
</tr>
</tbody></table>
<h1 id="Garbage-Collectors"><a href="#Garbage-Collectors" class="headerlink" title="Garbage Collectors"></a>Garbage Collectors</h1><p>The JVM (Java Virtual Machine) has several different garbage collectors, including the <strong>Parallel Scavenge collector</strong> and the <strong>G1 (Garbage-First) collector</strong>. Both collectors have a “young generation” that is responsible for storing newly created objects, but they work in different ways.</p>
<ul>
<li>Parallel Scavenge collector</li>
</ul>
<p>The Parallel Scavenge collector’s young generation, also known as the “PS young generation”, is divided into two regions called “Eden” and “Survivor”. The Eden region is where newly created objects are initially allocated, while the Survivor regions are used to store objects that have survived one or more garbage collection cycles. The idea is to quickly identify and collect objects that are no longer needed, while promoting long-lived objects to the older generation.</p>
<ul>
<li>G1 collector</li>
</ul>
<p>The G1 collector also has a young generation, which is referred to as the “G1 young generation”. Unlike the PS young generation, the G1 young generation does not have fixed regions like Eden and Survivor. Instead, the G1 collector divides the heap into equal-sized “regions” that can be used for both young and old objects, depending on their age and usage patterns. The G1 collector also uses a “remembered set” to keep track of references between regions, which allows it to more efficiently identify and collect objects that are no longer needed.</p>
<p>Overall, both the PS and G1 collectors have their own strengths and weaknesses, and the best choice depends on the specific requirements and characteristics of the application. The G1 collector is generally considered to be more flexible and adaptive to different usage patterns, but the PS collector may be better suited for applications with short-lived objects and high object creation rates.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/16/$%E6%89%93%E5%8D%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/16/$%E6%89%93%E5%8D%A1/" class="post-title-link" itemprop="url">打卡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-04-16 10:37:26" itemprop="dateCreated datePublished" datetime="2021-04-16T10:37:26+08:00">2021-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 14:05:08" itemprop="dateModified" datetime="2022-04-20T14:05:08+08:00">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/will/" itemprop="url" rel="index"><span itemprop="name">will</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>金钱换不来的东西才算珍贵，比如时间、健康、知识</p>
</blockquote>
<p>✔️ </p>
<h3 id="身体是本钱"><a href="#身体是本钱" class="headerlink" title="身体是本钱"></a>身体是本钱</h3><h3 id="英语是编程语言的基础语言"><a href="#英语是编程语言的基础语言" class="headerlink" title="英语是编程语言的基础语言"></a>英语是编程语言的基础语言</h3><pre><code>    April   2021
</code></pre>
<table>
<thead>
<tr>
<th>Sun</th>
<th>Mon</th>
<th>Tue</th>
<th>Wed</th>
<th>Thu</th>
<th>Fri</th>
<th>Sat</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td><a href="#41">1</a></td>
<td><a href="#42">2</a></td>
<td><a href="#43">3</a></td>
</tr>
<tr>
<td><a href="#44">4</a></td>
<td><a href="#45">5</a></td>
<td><a href="#46">6</a></td>
<td><a href="#47">7</a></td>
<td><a href="#48">8</a></td>
<td><a href="#49">9</a></td>
<td><a href="#410">10</a></td>
</tr>
<tr>
<td><a href="#411">11</a></td>
<td><a href="#412">12</a></td>
<td><a href="#413">13</a></td>
<td><a href="#414">14</a></td>
<td><a href="#415">15</a></td>
<td><a href="#416">16</a> ✔️</td>
<td><a href="#417">17</a></td>
</tr>
<tr>
<td><a href="#418">18</a></td>
<td><a href="#419">19</a></td>
<td><a href="#420">20</a></td>
<td><a href="#421">21</a></td>
<td><a href="#422">22</a></td>
<td><a href="#423">23</a></td>
<td><a href="#424">24</a></td>
</tr>
<tr>
<td><a href="#425">25</a></td>
<td><a href="#426">26</a></td>
<td><a href="#427">27</a></td>
<td><a href="#428">28</a></td>
<td><a href="#429">29</a></td>
<td><a href="#430">30</a></td>
<td></td>
</tr>
</tbody></table>
<pre><code>     June   2021          
</code></pre>
<table>
<thead>
<tr>
<th>Sun</th>
<th>Mon</th>
<th>Tue</th>
<th>Wed</th>
<th>Thu</th>
<th>Fri</th>
<th>Sat</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td><a href="#61">1</a></td>
<td><a href="#62">2</a></td>
<td><a href="#63">3</a></td>
<td><a href="#64">4</a></td>
<td><a href="#65">5</a></td>
</tr>
<tr>
<td><a href="#66">6</a></td>
<td><a href="#67">7</a></td>
<td><a href="#68">8</a></td>
<td><a href="#69">9</a></td>
<td><a href="#610">10</a></td>
<td><a href="#611">11</a></td>
<td><a href="#612">12</a></td>
</tr>
<tr>
<td><a href="#613">13</a></td>
<td><a href="#614">14</a></td>
<td><a href="#615">15</a></td>
<td><a href="#616">16</a></td>
<td><a href="#617">17</a></td>
<td><a href="#618">18</a></td>
<td><a href="#619">19</a></td>
</tr>
<tr>
<td><a href="#620">20</a></td>
<td><a href="#621">21</a></td>
<td><a href="#622">22</a></td>
<td><a href="#623">23</a></td>
<td><a href="#624">24</a></td>
<td><a href="#625">25</a></td>
<td><a href="#626">26</a></td>
</tr>
<tr>
<td><a href="#627">27</a></td>
<td><a href="#628">28</a></td>
<td><a href="#629">29</a>✔️</td>
<td><a href="#630">30</a>✔️</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<pre><code>     July   2021          
</code></pre>
<table>
<thead>
<tr>
<th>Sun</th>
<th>Mon</th>
<th>Tue</th>
<th>Wed</th>
<th>Thu</th>
<th>Fri</th>
<th>Sat</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td><a href="#2021%E5%B9%B407%E6%9C%8801%E6%97%A5">1</a></td>
<td><a href="#72">2</a></td>
<td><a href="#73">3</a></td>
</tr>
<tr>
<td><a href="#74">4</a></td>
<td><a href="#75">5</a></td>
<td><a href="#76">6</a></td>
<td><a href="#77">7</a></td>
<td><a href="#78">8</a></td>
<td><a href="#79">9</a></td>
<td><a href="#710">10</a></td>
</tr>
<tr>
<td><a href="#711">11</a></td>
<td><a href="#712">12</a></td>
<td><a href="#713">13</a></td>
<td><a href="#714">14</a></td>
<td><a href="#715">15</a></td>
<td><a href="#716">16</a></td>
<td><a href="#717">17</a></td>
</tr>
<tr>
<td><a href="#718">18</a></td>
<td><a href="#719">19</a></td>
<td><a href="#720">20</a></td>
<td><a href="#721">21</a></td>
<td><a href="#722">22</a></td>
<td><a href="#723">23</a></td>
<td><a href="#724">24</a></td>
</tr>
<tr>
<td><a href="#725">25</a></td>
<td><a href="#726">26</a></td>
<td><a href="#727">27</a></td>
<td><a href="#728">28</a></td>
<td><a href="#729">29</a></td>
<td><a href="#730">30</a></td>
<td><a href="#731">31</a></td>
</tr>
</tbody></table>
<h1 id="2021年07月01日"><a href="#2021年07月01日" class="headerlink" title="2021年07月01日"></a>2021年07月01日</h1><p>测试链接<br>后面可以修改连接处标题由71改为2021年07月01日</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/14/$Daily/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/14/$Daily/" class="post-title-link" itemprop="url">Daily_Flag</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-04-14 15:05:37" itemprop="dateCreated datePublished" datetime="2021-04-14T15:05:37+08:00">2021-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 10:45:16" itemprop="dateModified" datetime="2022-04-20T10:45:16+08:00">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/will/" itemprop="url" rel="index"><span itemprop="name">will</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="2021-04-14"><a href="#2021-04-14" class="headerlink" title="2021-04-14"></a>2021-04-14</h3><p>今天记录了一个ignite问题，并更新于post，提交到github，打开github发现2020年只有四个绿点。<br>2021年以后的时间，争取一个周可以有一个绿点吧</p>
<h3 id="2021-04-16"><a href="#2021-04-16" class="headerlink" title="2021-04-16"></a>2021-04-16</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/14/$Awareness/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/14/$Awareness/" class="post-title-link" itemprop="url">Awareness</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-04-14 14:54:23 / Modified: 15:01:39" itemprop="dateCreated datePublished" datetime="2021-04-14T14:54:23+08:00">2021-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/will/" itemprop="url" rel="index"><span itemprop="name">will</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>行动为王，思想为妃</p>
</li>
<li><p>自律且专注</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/14/$Output/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/14/$Output/" class="post-title-link" itemprop="url">Output</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-04-14 14:31:00 / Modified: 15:01:52" itemprop="dateCreated datePublished" datetime="2021-04-14T14:31:00+08:00">2021-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/will/" itemprop="url" rel="index"><span itemprop="name">will</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>知识的成长周期，只有输入，没有输出，那么输入就失去了意义，输入的东西生命也不会长久，并且浪费了之前付出的时间。<br>输出，不限于做一件事情，解决一个问题，还可能只是一行文字，一点领悟。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/08/zookeeper%20learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/08/zookeeper%20learn/" class="post-title-link" itemprop="url">zookeeper learn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-08 17:08:10" itemprop="dateCreated datePublished" datetime="2020-10-08T17:08:10+08:00">2020-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-07 10:06:03" itemprop="dateModified" datetime="2023-09-07T10:06:03+08:00">2023-09-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zookeeper/" itemprop="url" rel="index"><span itemprop="name">zookeeper</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h2><ul>
<li>tickTime</li>
</ul>
<p>Length of a single tick, in milliseconds. ZooKeeper uses tick as the basic time unit to regulate timeouts. Default is 2000.</p>
<ul>
<li>initLimit</li>
</ul>
<p>Number of ticks after which the ZooKeeper server times out during the synchronization process. Default is 10.</p>
<ul>
<li>syncLimit</li>
</ul>
<p>Maximum number of ticks for the followers to wait to synchronize with the leader before the followers time out. Default is 5.</p>
<ul>
<li>dataDir</li>
</ul>
<p>Absolute path for the ZooKeeper to store the in-memory snapshots of the data and the transactional log of updates to the database.</p>
<ul>
<li>clientPort</li>
</ul>
<p>Port on which the ZooKeeper server listens for client connections.</p>
<ul>
<li>maxClientCnxns</li>
</ul>
<p>Maximum number of concurrent connections that a single client can make to a single member of the ZooKeeper ensemble. Default is 10.</p>
<h2 id="终端操作"><a href="#终端操作" class="headerlink" title="终端操作"></a>终端操作</h2><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure>

<h3 id="新増节点"><a href="#新増节点" class="headerlink" title="新増节点"></a>新増节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create [-s] [-e] path data #其中-s 为有序节点，-e临时节点。不写 -s/-e 默认为创建持久化节点</span><br></pre></td></tr></table></figure>

<h3 id="查看节点"><a href="#查看节点" class="headerlink" title="查看节点"></a>查看节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get path</span><br></pre></td></tr></table></figure>

<p><img src="./img/zkInfo.png"></p>
<ul>
<li>查看节点状态<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stat path  #返回结果和get命令类似，但不会返回节点数据内容。</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="修改节点"><a href="#修改节点" class="headerlink" title="修改节点"></a>修改节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set path data [dataVersion]</span><br></pre></td></tr></table></figure>

<p>可以用set命令修改节点数据。也可以基于版本号进行修改，当传入的dataVersion与当前版本号不一致时，zookeeper会拒绝修改。</p>
<p><img src="./img/%E4%BF%AE%E6%94%B9%E8%8A%82%E7%82%B9.png"></p>
<h3 id="返回节点列表"><a href="#返回节点列表" class="headerlink" title="返回节点列表"></a>返回节点列表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls   path</span><br><span class="line">ls2  path</span><br></pre></td></tr></table></figure>

<h3 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete path [dataVersion]</span><br></pre></td></tr></table></figure>

<p> 与更新节点类似，删除也可以传入版本号，当传入的dataVersion与当前版本号不一致时，zookeeper会拒绝删除。</p>
<ul>
<li>要想删除某个节点及其后代节点，可以使用递归删除<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmr path</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/01/flink%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/01/flink%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">flink 运行机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-01 22:00:30" itemprop="dateCreated datePublished" datetime="2020-10-01T22:00:30+08:00">2020-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-02-19 12:28:05" itemprop="dateModified" datetime="2023-02-19T12:28:05+08:00">2023-02-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flink/" itemprop="url" rel="index"><span itemprop="name">flink</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="运行时框架"><a href="#运行时框架" class="headerlink" title="运行时框架"></a>运行时框架</h1><p><img src="/images/flink/flink_runtime_architecture.png"></p>
<h1 id="作业调度框架"><a href="#作业调度框架" class="headerlink" title="作业调度框架"></a>作业调度框架</h1><p><img src="/images/flink/flink_schedule_architecture.png"></p>
<h1 id="table模块架构"><a href="#table模块架构" class="headerlink" title="table模块架构"></a>table模块架构</h1><p><img src="/images/flink/flink_table_architecture.png"></p>
<h1 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h1><h2 id="TaskExecutor"><a href="#TaskExecutor" class="headerlink" title="TaskExecutor"></a>TaskExecutor</h2><ol>
<li><code>taskmanager.numberOfTaskSlots</code>：指定每个TaskExecutor的任务槽数量。默认情况下，该属性设置为1，表示每个TaskExecutor只能执行一个任务。如果需要在同一节点上并行执行多个任务，则需要将该属性设置为大于1的值。</li>
<li><code>taskmanager.memory.process.size</code>：指定TaskExecutor进程的内存大小。默认情况下，该属性设置为1GB。可以根据节点的资源情况和作业的内存需求进行适当调整。</li>
<li><code>taskmanager.cpu.cores</code>：指定TaskExecutor可以使用的CPU核心数量。默认情况下，该属性设置为所有可用的CPU核心数。可以根据节点的CPU资源情况和作业的CPU需求进行适当调整。</li>
<li><code>taskmanager.tmp.dirs</code>：指定TaskExecutor使用的临时文件目录。默认情况下，该属性设置为系统的临时目录。可以根据节点的磁盘空间情况和作业的磁盘需求进行适当调整。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/11/java%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/11/java%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">java性能调优学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-11 14:05:30" itemprop="dateCreated datePublished" datetime="2019-11-11T14:05:30+08:00">2019-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-25 00:55:46" itemprop="dateModified" datetime="2022-01-25T00:55:46+08:00">2022-01-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/course/" itemprop="url" rel="index"><span itemprop="name">course</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h2><p>“纸上得来终觉浅，绝知此事要躬行”。</p>
<p>学会透过现象看本质</p>
<p><strong>1. 扎实的计算机基础</strong></p>
<blockquote>
<p>我们需要储备计算机组成原理、操作系统、网络协议以及数据库等基础知识。具体的性能问题往往还与传输、计算、存储数据等相关，那我们还需要储备数据结构、算法以及数学等基础知识。</p>
</blockquote>
<p><strong>2. 习惯透过源码了解技术本质</strong></p>
<blockquote>
<p>我们需要深入源码，通过分析来学习、总结一项技术的实现原理和优缺点，这样我们就能更客观地去学习一项技术，还能透过源码来学习牛人的思维方式，收获更好的编码实现方式。</p>
</blockquote>
<p><strong>3. 善于追问和总结</strong></p>
<blockquote>
<p>“知其然且知所以然”才是我们积累经验的关键。知道了一项技术背后的实现原理，我们才能在遇到性能问题时，做到触类旁通。</p>
</blockquote>
<h2 id="调优政策"><a href="#调优政策" class="headerlink" title="调优政策"></a>调优政策</h2><ul>
<li>分析查找问题是一个复杂而又细致的过程，某个性能问题可能是一个原因导致的，也可能是几个原因共同导致的结果。我们分析查找问题可以采用自下而上的方式，而我们解决系统性能问题，则可以采用自上而下的方式逐级优化。</li>
</ul>
<p><strong>1. 优化代码</strong></p>
<p><strong>2. 优化设计</strong></p>
<p><strong>3. 优化算法</strong></p>
<p><strong>4. 时间换空间</strong></p>
<p><strong>5. 空间换时间</strong></p>
<p><strong>6. 参数调优</strong></p>
<p><strong>7. 兜底策略，确保系统稳定性</strong></p>
<h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><p><strong>数组</strong>：采用一段连续的存储单元来存储数据。对于指定下标的查找，时间复杂度为 O(1)，但在数组中间以及头部插入数据时，需要复制移动后面的元素。</p>
<p><strong>链表</strong>：一种在物理存储单元上非连续、非顺序的存储结构，数据元素的逻辑顺序是通过链表中的指针链接次序实现的。由于链表不用必须按顺序存储，所以链表在插入的时候可以达到 O(1) 的复杂度，但查找一个结点或者访问特定编号的结点需要 O(n) 的时间。</p>
<p><strong>哈希表</strong>：根据关键码值（Key value）直接进行访问的数据结构。通过把关键码值映射到表中一个位置来访问记录，以加快查找的速度。这个映射函数叫做哈希函数，存放记录的数组就叫做哈希表。</p>
<p><strong>树</strong>：由 n（n≥1）个有限结点组成的一个具有层次关系的集合，就像是一棵倒挂的树。</p>
<h3 id="字符串性能优化"><a href="#字符串性能优化" class="headerlink" title="字符串性能优化"></a>字符串性能优化</h3><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/MGD7wV"><img src="https://s2.ax1x.com/2019/11/13/MGD7wV.md.jpg" alt="MGD7wV.md.jpg"></a></p>
<ul>
<li><p>一个 char 字符占 16 位，2 个字节。这个情况下，存储单字节编码内的字符（占一个字节的字符）就显得非常浪费。JDK1.9 的 String 类为了节约内存空间，于是使用了占 8 位，1 个字节的 byte 数组来存放字符串</p>
</li>
<li><p>String 对象的不可变性</p>
</li>
<li><p>对象和对象引用</p>
</li>
<li><p>使用 String.intern 来节省内存空间，从而优化 String 对象的存储</p>
<blockquote>
<p>具体做法就是，在每次赋值的时候使用 String 的 intern 方法，如果常量池中有相同值，就会重复使用该对象，返回对象引用，这样一开始的对象就可以被回收掉。这种方式可以使重复性非常高的地址信息存储大小从 20G 降到几百兆。</p>
<p>如果调用 intern 方法，会去查看字符串常量池中是否有等于该对象的字符串，如果没有，就在常量池中新增该对象，并返回该对象引用；如果有，就返回常量池中的字符串引用。堆内存中原有的对象由于没有引用指向它，将会通过垃圾回收器回收。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String a =<span class="keyword">new</span> String(<span class="string">&quot;abc&quot;</span>).intern();</span><br><span class="line">String b = <span class="keyword">new</span> String(<span class="string">&quot;abc&quot;</span>).intern();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a==b) &#123;<span class="comment">// a 和 b 引用的是同一个对象。</span></span><br><span class="line">    System.out.print(<span class="string">&quot;a==b&quot;</span>);<span class="comment">//正常输出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>用 String.indexOf() 方法代替 Split() 方法完成字符串的分割 </p>
</li>
</ul>
<h3 id="慎重使用正则表达式"><a href="#慎重使用正则表达式" class="headerlink" title="慎重使用正则表达式"></a>慎重使用正则表达式</h3><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/MGDWWQ"><img src="https://s2.ax1x.com/2019/11/13/MGDWWQ.md.jpg" alt="MGDWWQ.md.jpg"></a></p>
<blockquote>
<p>正则表达式是一个用正则符号写出的公式，程序对这个公式进行语法分析，建立一个语法分析树，再根据这个分析树结合正则表达式的引擎生成执行程序（这个执行程序我们把它称作状态机，也叫状态自动机），用于字符匹配。</p>
<p>如果使用正则表达式能使你的代码简洁方便，那么在做好性能排查的前提下，可以去使用；如果不能，那么正则表达式能不用就不用，以此避免造成更多的性能问题。</p>
</blockquote>
<h3 id="ArrayList-VS-LinkedList"><a href="#ArrayList-VS-LinkedList" class="headerlink" title="ArrayList VS LinkedList"></a>ArrayList VS LinkedList</h3><ul>
<li>由于 ArrayList 是数组实现的，而数组是一块连续的内存空间，在添加元素到数组头部的时候，需要对头部以后的数据进行复制重排，所以效率很低；而 LinkedList 是基于链表实现，在添加元素的时候，首先会通过循环查找到添加元素的位置，如果要添加的位置处于 List 的前半段，就从前往后找；若其位置处于后半段，就从后往前找。因此 LinkedList 添加元素到头部是非常高效的。</li>
<li>LinkedList 的 for 循环性能是最差的，而 ArrayList 的 for 循环性能是最好的。</li>
</ul>
<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/MY0E6A"><img src="https://s2.ax1x.com/2019/11/14/MY0E6A.md.jpg" alt="MY0E6A.md.jpg"></a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/01/ignite_snippet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/01/ignite_snippet/" class="post-title-link" itemprop="url">ignite snippet</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-01 12:01:30" itemprop="dateCreated datePublished" datetime="2019-11-01T12:01:30+08:00">2019-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-08 19:12:32" itemprop="dateModified" datetime="2023-11-08T19:12:32+08:00">2023-11-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ignite/" itemprop="url" rel="index"><span itemprop="name">ignite</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><ul>
<li><p>清空数据</p>
<p><code>cache -clear -c=xxxxx</code></p>
</li>
<li><p>lostPart</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cache -rebalance -c=xxxx</span><br><span class="line">cache -rebalance 命令不需要依赖于 cache -stop 的操作。启动或重新启动分区重平衡可以在缓存运行期间进行，不需要停止缓存。</span><br></pre></td></tr></table></figure></li>
<li><p>停止多个缓存表</p>
</li>
</ul>
<p>​    <code>cache -stop --caches=myCache_*</code></p>
<ul>
<li>重新平衡多个缓存表</li>
</ul>
<p>​    <code>cache -rebalance --caches=myCache1,myCache2,myCache3</code></p>
<ul>
<li><p>停止所有缓存表，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cache -stop --all </span><br><span class="line">cache -start --all</span><br></pre></td></tr></table></figure></li>
<li><p>重新加载所有缓存表并重新平衡</p>
<p>``cache -l -r –all`</p>
<p><code>cache -clear</code> 命令只是清空缓存中的数据，但是缓存仍然处于活动状态，可以继续使用；而<code>cache -stop</code> 命令则停止了缓存，并且清空了所有数据，需要使用 <code>cache -start</code> 命令重新启动缓存，并重新加载数据。</p>
</li>
</ul>
<p>​    ``cache -start<code>命令用于启动一个已经停止的缓存。如果缓存之前已经存在并被停止，使用</code>cache -start` 命令可以重新启动该缓存，并开始加载数据。如果该缓存之前不存在，则会创建一个新的缓存并开始加载数据。</p>
<ul>
<li>查看表的状态</li>
</ul>
<p>使用 <code>cache -state</code> 命令查看指定缓存表的状态，包括缓存大小、分区数量、复制和备份数等信息。</p>
<hr>
<p>设置复制和备份数量：<br>cache -rebalance -r <replicas> -b <backups><br>其中<replicas>是要设置的复制数量，<backups>是要设置的备份数量。</p>
<p>设置备份数量为1，即每个分区都在一个不同的节点上保留1个备份数量<br>设置复制数量为2，即每个缓存表的分区都会在集群中的两个节点上复制</p>
<p>复制和备份都是为了提高数据可用性和可靠性，但复制是将同一份数据存储在多个节点上，而备份是将数据副本存储在集群中的不同节点上。在配置Ignite缓存表时，可以同时设置复制和备份的数量来确保数据的高可用性和可靠性。</p>
<hr>
<p>如果有三个Ignite节点，可以按照以下建议设置缓存表的复制和备份数量：</p>
<p>复制因子建议设置为2，这样每个分区的数据都会在两个节点上进行备份，当一个节点故障时，可以保证数据的可靠性。<br>例如，使用ignitevisorcmd.sh命令可以这样设置：cache -set-replicas myCache 2<br>备份数量建议设置为1，这样每个分区的数据都会在一个节点上进行备份，当一个节点故障时，可以保证数据的可靠性，并且减少额外的网络开销。<br>例如，使用ignitevisorcmd.sh命令可以这样设置：cache -set-backups myCache 1</p>
<p>需要注意的是，设置复制和备份数量会增加网络和存储开销，因此需要根据具体场景进行权衡和调整。<br>此外，还需要根据数据大小、访问模式、节点配置等因素进行性能测试和优化。</p>
<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="ignite-2-7-0"><a href="#ignite-2-7-0" class="headerlink" title="ignite-2.7.0"></a>ignite-2.7.0</h3><ul>
<li>编译ignite-core模块的时候需要使用jdk8，因为会报jdk.internal.misc.SharedSecrets找不到的错误原因：估计是在GridUnsafe.java中的miscPackage方法以及javaNioAccessObject的<code>Class&lt;?&gt; cls = Class.forName(pkgName + &quot;.misc.SharedSecrets&quot;);</code>出现的问题，jdk11中SharedSecrets出现的位置是<code>jdk.internal.access.SharedSecrets</code></li>
</ul>
<h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><ul>
<li>Ignite的原生持久化会在磁盘上存储一个数据的超集，以及根据容量在内存中存储一个子集。比如，如果有100个条目，然后内存只能存储20条，那么磁盘上会存储所有的100条，然后为了提高性能在内存中缓存20条。</li>
<li>和纯内存的使用场景一样，当打开持久化时，每个独立的节点只会持久化数据的一个子集，不管是主还是备节点，都是只包括节点所属的分区的数据，总的来说，整个集群包括了完整的数据集。</li>
<li>在开发应用时可能需要修改自定义对象字段的类型。例如假设对象A的字段类型<code>A.range</code>为<code>int</code>类型，然后决定将<code>A.range</code>的类型修改为<code>long</code>类型。之后会发现集群或应用将无法重启，因为Ignite不支持字段/列类型的更改。</li>
<li>无法变更枚举值的顺序，也无法在枚举值列表的开始或者中部添加新的常量，但是可以在列表的末尾添加新的常量。</li>
</ul>
<h3 id="ZooKeeper-Discovery"><a href="#ZooKeeper-Discovery" class="headerlink" title="ZooKeeper Discovery"></a>ZooKeeper Discovery</h3><p>ZooKeeper Discovery是为需要保持易扩展性和线性性能的大规模部署而设计的。然而，同时使用Ignite和ZooKeeper需要配置和管理两个分布式系统，这可能是一个挑战。因此，我们建议你只有在计划扩展到100个或1000个节点时才使用ZooKeeper Discovery。否则，最好使用TCP/IP发现。</p>
<hr>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><ul>
<li><p>marshaller</p>
<blockquote>
<p> $IGNITE_HOME/work/db/marshaller    类classpath信息</p>
</blockquote>
</li>
<li><p>binary_meta</p>
<blockquote>
<p>$IGNITE_HOME/work/db/binary_meta    类的元素信息</p>
</blockquote>
</li>
</ul>
<p><strong>下面三个配置项是在配置文件中进行配置</strong></p>
<ul>
<li><p>storagePath</p>
<blockquote>
<p>$RDX_HOME/data/ignite/persistent    持久化文件</p>
</blockquote>
</li>
<li><p>walPath</p>
<blockquote>
<p>$RDX_HOME/data/ignite/wal_store    持久化数据的元数据信息（类名、元素名、位置）</p>
</blockquote>
<ul>
<li>walPath和storagePath存储的数据的关联</li>
</ul>
</li>
<li><p>walArchivePath</p>
<blockquote>
<p>$RDX_HOME/data/ignite/wal_archive</p>
</blockquote>
<ul>
<li>和walPath存储的数据结构一样，二者的关系</li>
</ul>
</li>
</ul>
<h3 id="Ignite-and-ZooKeeper-Configuration-Considerations"><a href="#Ignite-and-ZooKeeper-Configuration-Considerations" class="headerlink" title="Ignite and ZooKeeper Configuration Considerations"></a>Ignite and ZooKeeper Configuration Considerations</h3><ul>
<li>zookeeper中 tickTime和syncLimit参数的定义</li>
</ul>
<p>When using ZooKeeper Discovery, you need to make sure that the configuration parameters of the ZooKeeper cluster and Ignite cluster match each other.</p>
<p>Consider a sample ZooKeeper configuration, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># The number of milliseconds of each tick</span><br><span class="line">tickTime=2000</span><br><span class="line"></span><br><span class="line"># The number of ticks that can pass between sending a request and getting an acknowledgement</span><br><span class="line">syncLimit=5</span><br></pre></td></tr></table></figure>

<ul>
<li>在zookeeper中 tickTime和syncLimit参数的作用</li>
</ul>
<p>Configured this way, ZooKeeper server detects its own segmentation from the rest of the ZooKeeper cluster only after <code>tickTime * syncLimit</code> elapses. Until this event is detected at ZooKeeper level, all Ignite nodes connected to the segmented ZooKeeper server do not try to reconnect to the other ZooKeeper servers.</p>
<ul>
<li>在ignite中 sessionTimeout参数与zookeeper的tickTime和syncLimit参数的关联</li>
</ul>
<p>On the other hand, there is a <code>sessionTimeout</code> parameter on the Ignite side that defines how soon ZooKeeper closes an Ignite node’s session if the node gets disconnected from the ZooKeeper cluster. If <code>sessionTimeout</code> is smaller than <code>tickTime * syncLimit</code> , then the Ignite node is notified by the segmented ZooKeeper server too late — its session expires before it tries to reconnect to other ZooKeeper servers.</p>
<p>To avoid this situation, <code>sessionTimeout</code> should be bigger than <code>tickTime * syncLimit</code>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/01/flink%20Memory%20Model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/01/flink%20Memory%20Model/" class="post-title-link" itemprop="url">flink Memory Model</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-01 22:00:30" itemprop="dateCreated datePublished" datetime="2019-10-01T22:00:30+08:00">2019-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-25 00:54:20" itemprop="dateModified" datetime="2022-01-25T00:54:20+08:00">2022-01-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flink/" itemprop="url" rel="index"><span itemprop="name">flink</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h2><h3 id="jobmanager"><a href="#jobmanager" class="headerlink" title="jobmanager"></a>jobmanager</h3><p><img src="/images/flink/jobmanager.jpg"></p>
<ul>
<li>JVM Heap大小设置对应配置文件<code>flink-conf.yaml</code>的<strong>jobmanager.heap.size</strong></li>
</ul>
<h3 id="taskmanager"><a href="#taskmanager" class="headerlink" title="taskmanager"></a>taskmanager</h3><p><img src="/images/flink/taskmanager.jpg"></p>
<ul>
<li>Total Flink Memory对应<code>flink-conf.yaml</code>的<strong>taskmanager.memory.flink.size</strong></li>
<li>JVM Metaspace对应<code>flink-conf.yaml</code>的<strong>taskmanager.memory.jvm-metaspace.size</strong></li>
<li>Total Process Memory对应<code>flink-conf.yaml</code>的<strong>taskmanager.memory.process.size</strong></li>
</ul>
<h4 id="Flink总内存（Total-Flink-Memory）"><a href="#Flink总内存（Total-Flink-Memory）" class="headerlink" title="Flink总内存（Total Flink Memory）"></a>Flink总内存（Total Flink Memory）</h4><ul>
<li><p><strong>含义</strong><br>TaskManager进程占用的所有与Flink相关的内存（不包括JVM元空间和其他额外开销）。具体包含4大块：Flink框架内存（堆内、堆外）、托管内存（仅堆外）、网络缓存（仅堆外）、任务内存（堆内、堆外）。</p>
</li>
<li><p><strong>参数</strong><br><code>taskmanager.memory.flink.size</code>：无默认值，需要用户指定。</p>
</li>
</ul>
<h4 id="Flink框架（Framework）内存"><a href="#Flink框架（Framework）内存" class="headerlink" title="Flink框架（Framework）内存"></a>Flink框架（Framework）内存</h4><ul>
<li><p>含义<br>Flink Runtime底层占用的内存，一般来讲相对固定，不需要更改。极特殊情况下才需要调大一些，比如非常高的算子并行度，或者与外部系统（如Hadoop）有密集交互等等。</p>
</li>
<li><p>参数</p>
<p><code>taskmanager.memory.framework.heap.size</code>：堆内部分（Framework Heap），默认值128MB；</p>
<p><code>taskmanager.memory.framework.off-heap.size</code>：堆外部分（Framework Off-Heap），以直接内存形式分配，默认值128MB。</p>
</li>
</ul>
<h4 id="托管（Managed）内存"><a href="#托管（Managed）内存" class="headerlink" title="托管（Managed）内存"></a>托管（Managed）内存</h4><ul>
<li><p>含义<br>纯堆外内存，由MemoryManager管理，用于中间结果缓存、排序、哈希表等，以及RocksDB状态后端。可见，RocksDB消耗的内存可以由用户显式控制了，不再像旧版本一样难以预测和调节。</p>
</li>
<li><p>参数</p>
<p><code>taskmanager.memory.managed.fraction</code>：托管内存占Flink总内存<code>taskmanager.memory.flink.size的比例</code>，默认值0.4；<code>taskmanager.memory.managed.size</code>：托管内存的大小，无默认值，一般也不指定，而是依照上述比例来推定，更加灵活。</p>
</li>
</ul>
<h4 id="网络（Network）缓存"><a href="#网络（Network）缓存" class="headerlink" title="网络（Network）缓存"></a>网络（Network）缓存</h4><ul>
<li><p>含义<br>纯堆外内存，用于TaskManager之间（shuffle、广播等）及与外部组件的数据传输，以直接内存形式分配。</p>
</li>
<li><p>参数</p>
<p><code>taskmanager.memory.network.min</code>：网络缓存的最小值，默认64MB；<code>taskmanager.memory.network.max</code>：网络缓存的最大值，默认1GB；<code>taskmanager.memory.network.fraction</code>：网络缓存占Flink总内存<code>taskmanager.memory.flink.size</code>的比例，默认值0.1。若根据此比例算出的内存量比最小值小或比最大值大，就会限制到最小值或者最大值。</p>
</li>
</ul>
<h4 id="任务（Task）内存"><a href="#任务（Task）内存" class="headerlink" title="任务（Task）内存"></a>任务（Task）内存</h4><ul>
<li><p>含义<br>顾名思义，是算子逻辑和用户代码、自定义数据结构真正占用的内存。</p>
</li>
<li><p>参数</p>
<p><code>taskmanager.memory.task.heap.size</code>：堆内部分（Task Heap），无默认值，一般不建议设置，会自动用Flink总内存减去框架、托管、网络三部分的内存推算得出。<code>taskmanager.memory.task.off-heap.size</code>：堆外部分（Task Off-Heap），以直接内存形式分配，默认值为0，即不使用。</p>
</li>
</ul>
<h5 id="TaskManager进程总内存（Total-Process-Memory）"><a href="#TaskManager进程总内存（Total-Process-Memory）" class="headerlink" title="TaskManager进程总内存（Total Process Memory）"></a>TaskManager进程总内存（Total Process Memory）</h5><ul>
<li><p><strong>含义</strong><br>在容器化部署（on YARN/K8s/Mesos）环境下使用，是Flink总内存、JVM元空间与JVM额外内存开销的和，也就是容器本身的内存大小。</p>
</li>
<li><p><strong>参数</strong><br><code>taskmanager.memory.process.size</code>：无默认值，需要用户指定。</p>
</li>
</ul>
<h5 id="JVM元空间（Metaspace）"><a href="#JVM元空间（Metaspace）" class="headerlink" title="JVM元空间（Metaspace）"></a>JVM元空间（Metaspace）</h5><ul>
<li><p><strong>含义</strong><br>存放已被虚拟机加载的<strong>类信息、常量、静态变量，即编译器编译后的代码</strong></p>
</li>
<li><p><strong>参数</strong><br><code>taskmanager.memory.jvm-metaspace.size</code>：默认值256MB。</p>
</li>
</ul>
<h4 id="JVM额外开销（Overhead）"><a href="#JVM额外开销（Overhead）" class="headerlink" title="JVM额外开销（Overhead）"></a>JVM额外开销（Overhead）</h4><ul>
<li><p>含义<br>为JVM预留的其他本地内存，用于线程栈、代码缓存等，作用有些类似于之前版本中为容器预留的截断（cutoff）内存。当然在1.10版本中，原先的containerized.heap-cutoff-ratio与containerized.heap-cutoff-min参数对TM就不再生效了。</p>
</li>
<li><p>参数</p>
<p><code>taskmanager.memory.jvm-overhead.min</code>：JVM额外开销的最小值，默认192MB；<code>taskmanager.memory.jvm-overhead.max</code>：JVM额外开销的最大值，默认1GB；<code>taskmanager.memory.jvm-overhead.fraction</code>：JVM额外开销占TM进程总内存<code>taskmanager.memory.process.size</code>（注意不是Flink总内存）的比例，默认值0.1。若根据此比例算出的内存量比最小值小或比最大值大，就会限制到最小值或者最大值。</p>
</li>
</ul>
<h3 id="Flink内存参数与JVM参数的关系"><a href="#Flink内存参数与JVM参数的关系" class="headerlink" title="Flink内存参数与JVM参数的关系"></a>Flink内存参数与JVM参数的关系</h3><p>上述内存参数会直接影响启动TaskManager时使用的JVM参数，使用相关工具可以观察到。</p>
<ul>
<li><p><code>-Xmx</code>/<code>-Xms</code>：对应堆内框架内存与任务内存之和；</p>
</li>
<li><p><code>-XX:MaxDirectMemorySize</code>：对应三块直接内存，即堆外框架内存、任务内存与网络缓存之和；</p>
</li>
<li><p><code>-XX:MaxMetaspaceSize</code>：对应JVM元空间设置。</p>
</li>
</ul>
<h2 id="配置优化"><a href="#配置优化" class="headerlink" title="配置优化"></a>配置优化</h2><ul>
<li><strong>节点平均分配</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.evenly-spread-out-slots:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<p>reference</p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_14222592/2892910">Flink 1.10之改进的TaskManager内存模型与配置【附源码】_wx5c7a97e3804fd_51CTO博客</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">brook</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">158</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">85</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">brook</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


</body>
</html>
