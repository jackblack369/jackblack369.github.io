<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="source is the essence">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="source is the essence">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="brook">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>source is the essence</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="source is the essence" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">source is the essence</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/14/js%E4%B8%AD%E7%9A%84this/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/14/js%E4%B8%AD%E7%9A%84this/" class="post-title-link" itemprop="url">js中的this</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-14 11:17:30" itemprop="dateCreated datePublished" datetime="2019-08-14T11:17:30+08:00">2019-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-25 00:59:22" itemprop="dateModified" datetime="2022-01-25T00:59:22+08:00">2022-01-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>文字转载自<a target="_blank" rel="noopener" href="https://juejin.im/post/5d51feaef265da039005219e#heading-5">JS 中 this 在各个场景下的指向</a></p>
<h2 id="1-this-的奥秘"><a href="#1-this-的奥秘" class="headerlink" title="1. this 的奥秘"></a>1. this 的奥秘</h2><p>很多时候, JS 中的 <code>this</code> 对于咱们的初学者很容易产生困惑不解。 <code>this</code> 的功能很强大，但需要一定付出才能慢慢理解它。</p>
<p>对Java、PHP或其他标准语言来看，<code>this</code> 表示类方法中当前对象的实例。大多数情况下，<code>this</code>不能在方法之外使用，这样就比较不会造成混淆。</p>
<p>在J要中情况就有所不同: <code>this</code>表示函数的当前执行上下文，JS 中函数调用主要有以下几种方式：</p>
<ul>
<li>函数调用: <code>alert(&#39;Hello World!&#39;)</code></li>
<li>方法调用: <code>console.log(&#39;Hello World!&#39;)</code></li>
<li>构造函数: <code>new RegExp(&#39;\\d&#39;)</code></li>
<li>隐式调用: <code>alert.call(undefined, &#39;Hello World!&#39;)</code></li>
</ul>
<p>每种调用类型以自己的方式定义上下文，所以就很容易产生混淆。</p>
<p>此外，严格模式也会影响执行上下文。</p>
<p>理解<code>this</code>关键是要清楚的知道函数调用及其如何影响上下文。</p>
<p>本文主要说明函数的调用方式及如何影响 <code>this</code>，并且说明执行上下文的常见陷阱。</p>
<p>在开始之前，先知道几个术语：</p>
<p>调用函数正在执行创建函数体的代码，或者只是调用函数。 例如，parseInt函数调用是parseInt（’15’）。</p>
<ul>
<li><strong>函数调用</strong>：执行构成函数主体的代码：例如，<code>parseInt</code>函数调用是<code>parseInt(&#39;15&#39;)</code>。</li>
<li><strong>调用的上下文</strong>：指 <code>this</code> 在函数体内的值。 例如，<code>map.set(&#39;key&#39;, &#39;value&#39;)</code>的调用上下文是 <code>map</code>。</li>
<li><strong>函数的作用域</strong>：是在函数体中可访问的变量、对象和函数的集合。</li>
</ul>
<h2 id="2-函数调用"><a href="#2-函数调用" class="headerlink" title="2.函数调用"></a>2.函数调用</h2><p>当一个表达式为函数接着一个<code>(</code>，一些用逗号分隔的参数以及一个<code>）</code>时，函数调用被执行，例如<code>parseInt(&#39;18&#39;)</code>。</p>
<p>函数调用表达式不能是属性方式的调用，如 <code>obj.myFunc()</code>，这种是创建一个方法调用。再如 <code>[1,5].join(&#39;,&#39;)</code>不是函数调用，而是方法调用，<strong>这种区别需要记住哈，很重要滴</strong>。</p>
<p>函数调用的一个简单示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function hello(name) &#123;</span><br><span class="line">  return &#x27;Hello &#x27; + name + &#x27;!&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">// 函数调用</span><br><span class="line">const message = hello(&#x27;World&#x27;);</span><br><span class="line">console.log(message); // =&gt; &#x27;Hello World!&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>hello(&#39;World&#39;)</code>是函数调用: <code>hello</code>表达式等价于一个函数，跟在它后面的是一对括号以及<code>&#39;World&#39;</code>参数。</p>
<p>一个更高级的例子是<strong>IIFE</strong>(立即调用的函数表达式)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const message = (function(name) &#123;</span><br><span class="line">   return &#x27;Hello &#x27; + name + &#x27;!&#x27;;</span><br><span class="line">&#125;)(&#x27;World&#x27;);</span><br><span class="line">console.log(message) // =&gt; &#x27;Hello World!&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><strong>IIFE</strong>也是一个函数调用:第一对圆括号<code>(function(name) &#123;...&#125;)</code>是一个表达式，它的计算结果是一个函数对象，后面跟着一对圆括号，圆括号的参数是<code>“World”</code>。</p>
<h4 id="2-1-在函数调用中的this"><a href="#2-1-在函数调用中的this" class="headerlink" title="2.1. 在函数调用中的this"></a>2.1. 在函数调用中的this</h4><blockquote>
<p>this 在函数调用中是一个全局对象</p>
</blockquote>
<p>局对象由执行环境决定。在浏览器中，<code>this</code>是 <code>window</code> 对象。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884b811a409ab?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>在函数调用中，执行上下文是全局对象。</p>
<p>再来看看下面函数中的上下文又是什么鬼：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function sum(a, b) &#123;</span><br><span class="line">   console.log(this === window); // =&gt; true</span><br><span class="line">   this.myNumber = 20; // 将&#x27;myNumber&#x27;属性添加到全局对象</span><br><span class="line">   return a + b;</span><br><span class="line">&#125;</span><br><span class="line">// sum() is invoked as a function</span><br><span class="line">// sum() 中的 `this` 是一个全局对象（window）</span><br><span class="line">sum(15, 16);     // =&gt; 31</span><br><span class="line">window.myNumber; // =&gt; 20</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>在调用<code>sum(15,16)</code>时，JS 自动将<code>this</code>设置为全局对象，在浏览器中该对象是<code>window</code>。</p>
<p>当<code>this</code>在任何函数作用域(最顶层作用域:全局执行上下文)之外使用，<code>this</code> 表示 <code>window</code> 对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">console.log(this === window); // =&gt; true</span><br><span class="line">this.myString = &#x27;Hello World!&#x27;;</span><br><span class="line">console.log(window.myString); // =&gt; &#x27;Hello World!&#x27;</span><br><span class="line"></span><br><span class="line">&lt;!-- In an html file --&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">   console.log(this === window); // =&gt; true</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="2-2-严格模式下的函数调用-this-又是什么样的"><a href="#2-2-严格模式下的函数调用-this-又是什么样的" class="headerlink" title="2.2 严格模式下的函数调用 this 又是什么样的"></a>2.2 严格模式下的函数调用 this 又是什么样的</h4><blockquote>
<p><code>this</code> 在严格模式下的函数调用中为 <strong>undefined</strong></p>
</blockquote>
<p>严格模式是在 ECMAScript 5.1中引入的，它提供了更好的安全性和更强的错误检查。</p>
<p>要启用严格模式，函数头部写入<code>use strict</code> 即可。</p>
<p>启用后，严格模式会影响执行上下文，<code>this</code> 在常规函数调用中值为<code>undefined</code>。 与上述情况<code>2.1</code>相反，执行上下文不再是全局对象。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884ceb97a4874?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>严格模式函数调用示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function multiply(a, b) &#123;</span><br><span class="line">  &#x27;use strict&#x27;; // 启用严格模式</span><br><span class="line">  console.log(this === undefined); // =&gt; true</span><br><span class="line">  return a * b;</span><br><span class="line">&#125;</span><br><span class="line">multiply(2, 5); // =&gt; 10</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>当<code>multiply(2,5)</code>作为函数调用时，<code>this</code>是<code>undefined</code>。</p>
<p>严格模式不仅在当前作用域中有效，在内部作用域中也是有效的(对于在内部声明的所有函数):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function execute() &#123;</span><br><span class="line">   &#x27;use strict&#x27;; // 开启严格模式  </span><br><span class="line">   function concat(str1, str2) &#123;</span><br><span class="line">     // 严格模式仍然有效  </span><br><span class="line">     console.log(this === undefined); // =&gt; true</span><br><span class="line">     return str1 + str2;</span><br><span class="line">   &#125;</span><br><span class="line">   // concat() 在严格模式下作为函数调用</span><br><span class="line">   // this in concat() is undefined</span><br><span class="line">   concat(&#x27;Hello&#x27;, &#x27; World!&#x27;); // =&gt; &quot;Hello World!&quot;</span><br><span class="line">&#125;</span><br><span class="line">execute();</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>&#39;use strict&#39;</code>被插入到执行体的顶部，在其作用域内启用严格模式。 因为函数<code>concat</code>是在执行的作用域中声明的，所以它继承了严格模式。</p>
<p>单个JS文件可能包含严格和非严格模式。 因此，对于相同的调用类型，可以在单个脚本中具有不同的上下文行为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function nonStrictSum(a, b) &#123;</span><br><span class="line">  // 非严格模式</span><br><span class="line">  console.log(this === window); // =&gt; true</span><br><span class="line">  return a + b;</span><br><span class="line">&#125;</span><br><span class="line">function strictSum(a, b) &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  // 启用严格模式</span><br><span class="line">  console.log(this === undefined); // =&gt; true</span><br><span class="line">  return a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nonStrictSum(5, 6); // =&gt; 11</span><br><span class="line">strictSum(8, 12); // =&gt; 20</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="2-3-陷阱-this-在内部函数中的时候"><a href="#2-3-陷阱-this-在内部函数中的时候" class="headerlink" title="2.3 陷阱:this 在内部函数中的时候"></a>2.3 陷阱:<code>this</code> 在内部函数中的时候</h4><p>函数调用的一个常见陷阱是，认为<code>this</code>在内部函数中的情况与外部函数中的情况相同。</p>
<p>正确地说，内部函数的上下文只依赖于它的调用类型，而不依赖于外部函数的上下文。</p>
<p>要将 <code>this</code> 设置为所需的值，可以通过 <code>.call()</code>或<code>.apply()</code>修改内部函数的上下文或使用<code>.bind()</code>创建绑定函数。</p>
<p>下面的例子是计算两个数的和：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const numbers = &#123;</span><br><span class="line">   numberA: 5,</span><br><span class="line">   numberB: 10,</span><br><span class="line">   sum: function() &#123;</span><br><span class="line">     console.log(this === numbers); // =&gt; true</span><br><span class="line">     function calculate() &#123;</span><br><span class="line">       console.log(this === numbers); // =&gt; false</span><br><span class="line">       return this.numberA + this.numberB;</span><br><span class="line">     &#125;</span><br><span class="line">     return calculate();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line">numbers.sum(); // =&gt; NaN</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>sum()</code>是对象上的方法调用，所以<code>sum</code>中的上下文是<code>numbers</code>对象。<code>calculate</code>函数是在<code>sum</code>中定义的，你可能希望在<code>calculate()</code>中<code>this</code>也表示<code>number</code>对象。</p>
<p><code>calculate()</code>是一个函数调用(不是方法调用)，它将<code>this</code>作为全局对象<code>window</code>(非严格模下)。即使外部函数<code>sum</code>将上下文作为<code>number</code>对象，它在<code>calculate</code>里面没有影响。</p>
<p><code>sum()</code>的调用结果是<code>NaN</code>，不是预期的结果<code>5 + 10 = 15</code>，这都是因为没有正确调用<code>calculate</code>。</p>
<p>为了解决这个问题，<code>calculate</code>函数中上下文应该与 <code>sum</code> 中的一样，以便可以访问<code>numberA</code>和<code>numberB</code>属性。</p>
<p>一种解决方案是通过调用<code>calculator.call(this)</code>手动将<code>calculate</code>上下文更改为所需的上下文。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const numbers = &#123;</span><br><span class="line">   numberA: 5,</span><br><span class="line">   numberB: 10,</span><br><span class="line">   sum: function() &#123;</span><br><span class="line">     console.log(this === numbers); // =&gt; true</span><br><span class="line">     function calculate() &#123;</span><br><span class="line">       console.log(this === numbers); // =&gt; true</span><br><span class="line">       return this.numberA + this.numberB;</span><br><span class="line">     &#125;</span><br><span class="line">     // 使用 .call() 方法修改上下文</span><br><span class="line">     return calculate.call(this);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line">numbers.sum(); // =&gt; 15</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>call(this)</code>像往常一样执行<code>calculate</code>函数，但 <code>call</code> 会把上下文修改为指定为第一个参数的值。</p>
<p>现在<code>this.numberA</code> + <code>this.numberB</code>相当于<code>numbers.numberA + numbers.numberB</code>。 该函数返回预期结果<code>5 + 10 = 15</code>。</p>
<p>另一种就是使用箭头函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const numbers = &#123;</span><br><span class="line">   numberA: 5,</span><br><span class="line">   numberB: 10,</span><br><span class="line">   sum: function() &#123;</span><br><span class="line">     console.log(this === numbers); // =&gt; true</span><br><span class="line">     const calculate = () =&gt; &#123;</span><br><span class="line">       console.log(this === numbers); // =&gt; true</span><br><span class="line">       return this.numberA + this.numberB;</span><br><span class="line">     &#125;</span><br><span class="line">     return calculate();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line">numbers.sum(); // =&gt; 15</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h2 id="3-方法调用"><a href="#3-方法调用" class="headerlink" title="3.方法调用"></a>3.方法调用</h2><p>方法是存储在对象属性中的函数。例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const myObject = &#123;</span><br><span class="line">  // helloFunction 是一个方法</span><br><span class="line">  helloFunction: function() &#123;</span><br><span class="line">    return &#x27;Hello World!&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">const message = myObject.helloFunction();</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>helloFunction</code>是<code>myObject</code>的一个方法，要调用该方法，可以这样子调用 :<code>myObject.helloFunction</code>。</p>
<p>当一个表达式以属性访问的形式执行时，执行的是方法调用，它相当于以个函数接着(，一组用逗号分隔的参数以及)。</p>
<p>利用前面的例子，<code>myObject.helloFunction()</code>是对象<code>myObject</code>上的一个<code>helloFunction</code>的方法调用。<code>[1, 2].join(&#39;,&#39;)</code> 或<code>/\s/.test(&#39;beautiful world&#39;)</code>也被认为是方法调用。</p>
<p>区分函数调用和方法调用非常重要，因为它们是不同的类型。主要区别在于方法调用需要一个属性访问器形式来调用函数(<code>obj.myFunc()</code>或<code>obj[&#39;myFunc&#39;]()</code>)，而函数调用不需要(<code>myFunc()</code>)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;Hello&#x27;, &#x27;World&#x27;].join(&#x27;, &#x27;); // 方法调用</span><br><span class="line">(&#123; ten: function() &#123; return 10; &#125; &#125;).ten(); // 方法调用</span><br><span class="line">const obj = &#123;&#125;;</span><br><span class="line">obj.myFunction = function() &#123;</span><br><span class="line">  return new Date().toString();</span><br><span class="line">&#125;;</span><br><span class="line">obj.myFunction(); // 方法调用</span><br><span class="line"></span><br><span class="line">const otherFunction = obj.myFunction;</span><br><span class="line">otherFunction();     // 函数调用</span><br><span class="line">parseFloat(&#x27;16.60&#x27;); // 函数调用</span><br><span class="line">isNaN(0);            // 函数调用</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>理解函数调用和方法调用之间的区别有助于正确识别上下文。</p>
<h4 id="3-1-方法调用中-this-是肿么样"><a href="#3-1-方法调用中-this-是肿么样" class="headerlink" title="3.1 方法调用中 this 是肿么样"></a>3.1 方法调用中 this 是肿么样</h4><blockquote>
<p>在方法调用中，<code>this</code>是拥有这个方法的对象</p>
</blockquote>
<p>当调用对象上的方法时，<code>this</code>就变成了对象本身。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884d308092da0?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>创建一个对象，该对象有一个递增数字的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const calc = &#123;</span><br><span class="line">  num: 0,</span><br><span class="line">  increment: function() &#123;</span><br><span class="line">    console.log(this === calc); // =&gt; true</span><br><span class="line">    this.num += 1;</span><br><span class="line">    return this.num;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">// method invocation. this is calc</span><br><span class="line">calc.increment(); // =&gt; 1</span><br><span class="line">calc.increment(); // =&gt; 2</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>调用<code>calc.increment()</code>使<code>increment</code>函数的上下文成为<code>calc</code>对象。所以使用<code>this.num</code>来增加<code>num</code>属性是有效的。</p>
<p>再来看看另一个例子。JS对象从原型继承一个方法，当在对象上调用继承的方法时，调用的上下文仍然是对象本身</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const myDog = Object.create(&#123;</span><br><span class="line">  sayName: function() &#123;</span><br><span class="line">     console.log(this === myDog); // =&gt; true</span><br><span class="line">     return this.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">myDog.name = &#x27;Milo&#x27;;</span><br><span class="line">// 方法调用 this 指向 myDog</span><br><span class="line">myDog.sayName(); // =&gt; &#x27;Milo&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>Object.create()</code>创建一个新对象<code>myDog</code>，并根据第一个参数设置其原型。<code>myDog</code>对象继承<code>sayName</code>方法。</p>
<p>执行<code>myDog. sayname()</code>时，<code>myDog</code>是调用的上下文。</p>
<p>在EC6 <code>class</code> 语法中，方法调用上下文也是实例本身</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Planet &#123;</span><br><span class="line">  constructor(name) &#123;</span><br><span class="line">    this.name = name;    </span><br><span class="line">  &#125;</span><br><span class="line">  getName() &#123;</span><br><span class="line">    console.log(this === earth); // =&gt; true</span><br><span class="line">    return this.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">var earth = new Planet(&#x27;Earth&#x27;);</span><br><span class="line">// method invocation. the context is earth</span><br><span class="line">earth.getName(); // =&gt; &#x27;Earth&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="3-2-陷阱-将方法与其对象分离"><a href="#3-2-陷阱-将方法与其对象分离" class="headerlink" title="3.2 陷阱:将方法与其对象分离"></a>3.2 陷阱:将方法与其对象分离</h4><p>方法可以从对象中提取到一个单独的变量<code>const alone = myObj.myMethod</code>。当方法单独调用时，与原始对象<code>alone()</code>分离，你可能认为当前的<code>this</code>就是定义方法的对象<code>myObject</code>。</p>
<p>如果方法在没有对象的情况下调用，那么函数调用就会发生，此时的<code>this</code>指向全局对象<code>window</code>严格模式下是<code>undefined</code>。</p>
<p>下面的示例定义了<code>Animal</code>构造函数并创建了它的一个实例:<code>myCat</code>。然后<code>setTimout()</code>在1秒后打印<code>myCat</code>对象信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Animal(type, legs) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.legs = legs;  </span><br><span class="line">  this.logInfo = function() &#123;</span><br><span class="line">    console.log(this === myCat); // =&gt; false</span><br><span class="line">    console.log(&#x27;The &#x27; + this.type + &#x27; has &#x27; + this.legs + &#x27; legs&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const myCat = new Animal(&#x27;Cat&#x27;, 4);</span><br><span class="line">// The undefined has undefined legs</span><br><span class="line">setTimeout(myCat.logInfo, 1000);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>你可能认为<code>setTimout</code>调用<code>myCat.loginfo()</code>时，它应该打印关于<code>myCat</code>对象的信息。</p>
<p>不幸的是，方法在作为参数传递时与对象是分离，<code>setTimout(myCat.logInfo)</code>以下情况是等效的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setTimout(myCat.logInfo);</span><br><span class="line">// 等价于</span><br><span class="line">const extractedLogInfo = myCat.logInfo;</span><br><span class="line">setTimout(extractedLogInfo);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>将分离的<code>logInfo</code>作为函数调用时，<code>this</code>是全局 <code>window</code>,所以对象信息没有正确地打印。</p>
<p>函数可以使用<code>.bind()</code>方法与对象绑定,就可以解决 <code>this</code> 指向的问题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Animal(type, legs) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.legs = legs;  </span><br><span class="line">  this.logInfo = function() &#123;</span><br><span class="line">    console.log(this === myCat); // =&gt; true</span><br><span class="line">    console.log(&#x27;The &#x27; + this.type + &#x27; has &#x27; + this.legs + &#x27; legs&#x27;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">const myCat = new Animal(&#x27;Cat&#x27;, 4);</span><br><span class="line">// logs &quot;The Cat has 4 legs&quot;</span><br><span class="line">setTimeout(myCat.logInfo.bind(myCat), 1000);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>myCat.logInfo.bind(myCat)</code>返回一个新函数，它的执行方式与<code>logInfo</code>完全相同，但是此时的 <code>this</code> 指向 <code>myCat</code>，即使在函数调用中也是如此。</p>
<p>另一种解决方案是将<code>logInfo()</code>方法定义为一个箭头函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Animal(type, legs) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.legs = legs;  </span><br><span class="line">  this.logInfo = () =&gt; &#123;</span><br><span class="line">    console.log(this === myCat); // =&gt; true</span><br><span class="line">    console.log(&#x27;The &#x27; + this.type + &#x27; has &#x27; + this.legs + &#x27; legs&#x27;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">const myCat = new Animal(&#x27;Cat&#x27;, 4);</span><br><span class="line">// logs &quot;The Cat has 4 legs&quot;</span><br><span class="line">setTimeout(myCat.logInfo, 1000);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h2 id="4-构造函数调用"><a href="#4-构造函数调用" class="headerlink" title="4. 构造函数调用"></a>4. 构造函数调用</h2><p>当<code>new</code>关键词紧接着函数对象,(,一组逗号分隔的参数以及)时被调用，执行的是构造函数调用如<code>new RegExp(&#39;\\d&#39;)</code>。</p>
<p>声明了一个<code>Country</code>函数，并且将它作为一个构造函数调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function Country(name, traveled) &#123;</span><br><span class="line">   this.name = name ? name : &#x27;United Kingdom&#x27;;</span><br><span class="line">   this.traveled = Boolean(traveled);</span><br><span class="line">&#125;</span><br><span class="line">Country.prototype.travel = function() &#123;</span><br><span class="line">  this.traveled = true;</span><br><span class="line">&#125;;</span><br><span class="line">// 构造函数调用</span><br><span class="line">const france = new Country(&#x27;France&#x27;, false);</span><br><span class="line">// 构造函数调用</span><br><span class="line">const unitedKingdom = new Country;</span><br><span class="line"></span><br><span class="line">france.travel(); // Travel to France</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>new Country(&#39;France&#39;, false)</code>是<code>Country</code>函数的构造函数调用。它的执行结果是一个<code>name</code>属性为<code>&#39;France&#39;</code>的新的对象。 如果这个构造函数调用时不需要参数，那么括号可以省略：<code>new Country</code>。</p>
<p>从ES6开始，JS 允许用<code>class</code>关键词来定义构造函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class City &#123;</span><br><span class="line">  constructor(name, traveled) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.traveled = false;</span><br><span class="line">  &#125;</span><br><span class="line">  travel() &#123;</span><br><span class="line">    this.traveled = true;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// Constructor invocation</span><br><span class="line">const paris = new City(&#x27;Paris&#x27;, false);</span><br><span class="line">paris.travel();</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>new City(&#39;Paris&#39;)</code>是构造函数调用。这个对象的初始化由这个类中一个特殊的方法<code>constructor</code>来处理。其中，<code>this</code>指向新创建的对象。</p>
<p>构造函数创建了一个新的空的对象，它从构造函数的原型继承了属性。构造函数的作用就是去初始化这个对象。 可能你已经知道了，在这种类型的调用中，上下文指向新创建的实例。</p>
<p>当属性访问<code>myObject.myFunction</code>前面有一个<code>new</code>关键词时，JS会执行构造函数调用而不是原来的方法调用。</p>
<p>例如<code>new myObject.myFunction()</code>：它相当于先用属性访问把方法提取出来<code>extractedFunction = myObject.myFunction</code>，然后利用把它作为构造函数创建一个新的对象： <code>new extractedFunction()</code>。</p>
<h2 id="4-1-构造函数中的-this"><a href="#4-1-构造函数中的-this" class="headerlink" title="4.1. 构造函数中的 this"></a>4.1. 构造函数中的 this</h2><blockquote>
<p>在构造函数调用中 this 指向新创建的对象</p>
</blockquote>
<p>构造函数调用的上下文是新创建的对象。它利用构造函数的参数初始化新的对象，设定属性的初始值，添加事件处理函数等等。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884d774863ecb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>来看看下面示例中的上下文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function Foo () &#123;</span><br><span class="line">  console.log(this instanceof Foo); // =&gt; true</span><br><span class="line">  this.property = &#x27;Default Value&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">// Constructor invocation</span><br><span class="line">const fooInstance = new Foo();</span><br><span class="line">fooInstance.property; // =&gt; &#x27;Default Value&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>new Foo()</code> 正在进行构造函数调用，其中上下文是<code>fooInstance</code>。 在<code>Foo</code>内部初始化对象：<code>this.property</code>被赋值为默认值。</p>
<p>同样的情况在用<code>class</code>语法（从ES6起）时也会发生，唯一的区别是初始化在<code>constructor</code>方法中进行:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Bar &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    console.log(this instanceof Bar); // =&gt; true</span><br><span class="line">    this.property = &#x27;Default Value&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// Constructor invocation</span><br><span class="line">const barInstance = new Bar();</span><br><span class="line">barInstance.property; // =&gt; &#x27;Default Value&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="4-2-陷阱-忘了使用-new"><a href="#4-2-陷阱-忘了使用-new" class="headerlink" title="4.2. 陷阱: 忘了使用 new"></a>4.2. 陷阱: 忘了使用 new</h4><p>有些JS函数不是只在作为构造函数调用的时候才创建新的对象，作为函数调用时也会，例如<code>RegExp</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var reg1 = new RegExp(&#x27;\\w+&#x27;);</span><br><span class="line">var reg2 = RegExp(&#x27;\\w+&#x27;);</span><br><span class="line"></span><br><span class="line">reg1 instanceof RegExp;      // =&gt; true</span><br><span class="line">reg2 instanceof RegExp;      // =&gt; true</span><br><span class="line">reg1.source === reg2.source; // =&gt; true</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>当执行的 <code>new RegExp(&#39;\\w+&#39;)</code>和<code>RegExp(&#39;\\w+&#39;)</code>时，JS 会创建等价的正则表达式对象。</p>
<p>使用函数调用来创建对象存在一个潜在的问题(不包括工厂模式)，因为一些构造函数可能会忽略在缺少<code>new</code>关键字时初始化对象的逻辑。</p>
<p>下面的例子说明了这个问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Vehicle(type, wheelsCount) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.wheelsCount = wheelsCount;</span><br><span class="line">  return this;</span><br><span class="line">&#125;</span><br><span class="line">// 忘记使用 new</span><br><span class="line">const car = Vehicle(&#x27;Car&#x27;, 4);</span><br><span class="line">car.type;       // =&gt; &#x27;Car&#x27;</span><br><span class="line">car.wheelsCount // =&gt; 4</span><br><span class="line">car === window  // =&gt; true</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>Vehicle</code>是一个在上下文对象上设置<code>type</code>和<code>wheelsCount</code>属性的函数。</p>
<p>当执行<code>Vehicle(&#39;Car&#39;， 4)</code>时，返回一个对象<code>Car</code>，它具有正确的属性:<code>Car.type</code> 为 <code>Car</code>和<code>Car.wheelsCount</code> 为<code>4</code>，你可能认为它很适合创建和初始化新对象。</p>
<p>然而，在函数调用中，<code>this</code>是<code>window</code>对象 ，因此 <code>Vehicle（&#39;Car&#39;，4）</code>在 <code>window</code> 对象上设置属性。 显然这是错误，它并没有创建新对象。</p>
<p>当你希望调用构造函数时，确保你使用了<code>new</code>操作符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Vehicle(type, wheelsCount) &#123;</span><br><span class="line">  if (!(this instanceof Vehicle)) &#123;</span><br><span class="line">    throw Error(&#x27;Error: Incorrect invocation&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.wheelsCount = wheelsCount;</span><br><span class="line">  return this;</span><br><span class="line">&#125;</span><br><span class="line">// Constructor invocation</span><br><span class="line">const car = new Vehicle(&#x27;Car&#x27;, 4);</span><br><span class="line">car.type               // =&gt; &#x27;Car&#x27;</span><br><span class="line">car.wheelsCount        // =&gt; 4</span><br><span class="line">car instanceof Vehicle // =&gt; true</span><br><span class="line"></span><br><span class="line">// Function invocation. Throws an error.</span><br><span class="line">const brokenCar = Vehicle(&#x27;Broken Car&#x27;, 3);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>new Vehicle(&#39;Car&#39;，4)</code> 运行正常：创建并初始化一个新对象，因为构造函数调用中时使用了<code>new</code>关键字。</p>
<p>在构造函数里添加了一个验证<code>this instanceof Vehicle</code>来确保执行的上下文是正确的对象类型。如果<code>this</code>不是<code>Vehicle</code>，那么就会报错。这样，如果执行<code>Vehicle(&#39;Broken Car&#39;, 3)</code>(没有<code>new</code>)，我们会得到一个异常：<code>Error: Incorrect invocation</code>。</p>
<h2 id="5-隐式调用"><a href="#5-隐式调用" class="headerlink" title="5. 隐式调用"></a>5. 隐式调用</h2><p>使用<code>myFun.call()</code>或<code>myFun.apply()</code>方法调用函数时，执行的是隐式调用。</p>
<p>JS中的函数是第一类对象，这意味着函数就是对象，对象的类型为<code>Function</code>。从函数对象的方法列表中，<code>.call()</code>和<code>.apply()</code>用于调用具有可配置上下文的函数。</p>
<ul>
<li>方法 <code>.call(thisArg[, arg1[, arg2[, ...]]])</code>将接受的第一个参数<code>thisArg</code>作为调用时的上下文，<code>arg1, arg2, ...</code>这些则作为参数传入被调用的函数。</li>
<li>方法<code>.apply(thisArg, [args])</code>将接受的第一个参数<code>thisArg</code>作为调用时的上下文，并且接受另一个类似数组的对象<code>[arg1, arg2, ...]</code>作为被调用函数的参数传入。</li>
</ul>
<p>下面是隐式调用的例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function increment(number) &#123;</span><br><span class="line">  return ++number;  </span><br><span class="line">&#125;</span><br><span class="line">increment.call(undefined, 10);    // =&gt; 11</span><br><span class="line">increment.apply(undefined, [10]); // =&gt; 11</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>increment.call()</code>和<code>increment.apply()</code>都用参数<code>10</code>调用了这个自增函数。</p>
<p>两者的区别是<code>.call()</code>接受一组参数，例如<code>myFunction.call(thisValue, &#39;value1&#39;, &#39;value2&#39;)</code>。而<code>.apply()</code>接受的一组参数必须是一个类似数组的对象，例如<code>myFunction.apply(thisValue, [&#39;value1&#39;, &#39;value2&#39;]</code>)。</p>
<h4 id="5-1-隐式调用中的this"><a href="#5-1-隐式调用中的this" class="headerlink" title="5.1. 隐式调用中的this"></a>5.1. 隐式调用中的this</h4><blockquote>
<p>在隐式调用.call()或.apply()中，this是第一个参数</p>
</blockquote>
<p>很明显，在隐式调用中，<code>this</code>作为第一个参数传递给<code>.call()</code>或<code>.apply()</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var rabbit = &#123; name: &#x27;White Rabbit&#x27; &#125;;</span><br><span class="line">function concatName(string) &#123;</span><br><span class="line">  console.log(this === rabbit); // =&gt; true</span><br><span class="line">  return string + this.name;</span><br><span class="line">&#125;</span><br><span class="line">concatName.call(rabbit, &#x27;Hello &#x27;);  // =&gt; &#x27;Hello White Rabbit&#x27;</span><br><span class="line">concatName.apply(rabbit, [&#x27;Bye &#x27;]); // =&gt; &#x27;Bye White Rabbit&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>当应该使用特定上下文执行函数时，隐式调用非常有用。例如为了解决方法调用时，<code>this</code>总是<code>window</code>或严格模式下的<code>undefined</code>的上下文问题。隐式调用可以用于模拟在一个对象上调用某个方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Runner(name) &#123;</span><br><span class="line">  console.log(this instanceof Rabbit); // =&gt; true</span><br><span class="line">  this.name = name;  </span><br><span class="line">&#125;</span><br><span class="line">function Rabbit(name, countLegs) &#123;</span><br><span class="line">  console.log(this instanceof Rabbit); // =&gt; true</span><br><span class="line">  Runner.call(this, name);</span><br><span class="line">  this.countLegs = countLegs;</span><br><span class="line">&#125;</span><br><span class="line">const myRabbit = new Rabbit(&#x27;White Rabbit&#x27;, 4);</span><br><span class="line">myRabbit; // &#123; name: &#x27;White Rabbit&#x27;, countLegs: 4 &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>Rabbit</code>中的<code>Runner.call(this, name)</code>隐式调用了父类的函数来初始化这个对象。</p>
<h2 id="6-绑定函数"><a href="#6-绑定函数" class="headerlink" title="6. 绑定函数"></a>6. 绑定函数</h2><p>绑定函数是与对象连接的函数。通常使用<code>.bind()</code>方法从原始函数创建。原始函数和绑定函数共享相同的代码和作用域，但执行时上下文不同。</p>
<p>方法 <code>myFunc.bind(thisArg[, arg1[, arg2[, ...]]])</code>接受第一个参数<code>thisArg</code>作为绑定函数执行时的上下文，并且它接受一组可选的参数 <code>arg1, arg2, ...</code>作为被调用函数的参数。它返回一个绑定了<code>thisArg</code>的新函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function multiply(number) &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  return this * number;</span><br><span class="line">&#125;</span><br><span class="line">const double = multiply.bind(2);</span><br><span class="line"></span><br><span class="line">double(3);  // =&gt; 6</span><br><span class="line">double(10); // =&gt; 20</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>bind(2)</code>返回一个新的函数对象<code>double</code>，<code>double</code> 绑定了数字<code>2</code>。<code>multiply</code>和<code>double</code>具有相同的代码和作用域。</p>
<p>与<code>.apply()</code>和<code>.call()</code> 方法相反，它不会立即调用该函数，<code>.bind()</code>方法只返回一个新函数，在之后被调用，只是this<code>已经</code>被提前设置好了。</p>
<h4 id="6-1-绑定函数中的this"><a href="#6-1-绑定函数中的this" class="headerlink" title="6.1. 绑定函数中的this"></a>6.1. 绑定函数中的this</h4><blockquote>
<p>在调用绑定函数时，<code>this</code>是<code>.bind()</code>的第一个参数。</p>
</blockquote>
<p><code>.bind()</code>的作用是创建一个新函数，调用该函数时，将上下文作为传递给<code>.bind()</code>的第一个参数。它是一种强大的技术，使咱们可以创建一个定义了<code>this</code>值的函数。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884dceeb04418?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>来看看，如何在如何在绑定函数设置 <code>this</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const numbers = &#123;</span><br><span class="line">  array: [3, 5, 10],</span><br><span class="line">  getNumbers: function() &#123;</span><br><span class="line">    return this.array;    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">const boundGetNumbers = numbers.getNumbers.bind(numbers);</span><br><span class="line">boundGetNumbers(); // =&gt; [3, 5, 10]</span><br><span class="line">// Extract method from object</span><br><span class="line">const simpleGetNumbers = numbers.getNumbers;</span><br><span class="line">simpleGetNumbers(); // =&gt; undefined (严格模式下报错)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>numbers.getNumbers.bind(numbers)</code>返回绑定<code>numbers</code>对象<code>boundGetNumbers</code>函数。<code>boundGetNumbers()</code>调用时的<code>this</code>是<code>number</code>对象，并能够返回正确的数组对象。</p>
<p>可以将函数<code>numbers.getNumbers</code>提取到变量<code>simpleGetNumbers</code>中而不进行绑定。在之后的函数调用中<code>simpleGetNumbers()</code>的<code>this</code>是<code>window</code>(严格模式下为<code>undefined</code>)，不是<code>number</code>对象。在这个情况下，<code>simpleGetNumbers()</code>不会正确返回数组。</p>
<h4 id="6-2-紧密的上下文绑定"><a href="#6-2-紧密的上下文绑定" class="headerlink" title="6.2 紧密的上下文绑定"></a>6.2 紧密的上下文绑定</h4><p><code>.bind()</code>创建一个永久的上下文链接，并始终保持它。 一个绑定函数不能通过<code>.call()</code>或者<code>.apply()</code>来改变它的上下文，甚至是再次绑定也不会有什么作用。</p>
<p>只有绑定函数的构造函数调用才能更改已经绑定的上下文，但是很不推荐的做法(构造函数调用必须使用常规的非绑定函数)。</p>
<p>下面示例创建一个绑定函数，然后尝试更改其已预先定义好的上下文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function getThis() &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  return this;</span><br><span class="line">&#125;</span><br><span class="line">const one = getThis.bind(1);</span><br><span class="line">// 绑定函数调用</span><br><span class="line">one(); // =&gt; 1</span><br><span class="line">// 使用带有.apply()和.call()的绑定函数</span><br><span class="line">one.call(2);  // =&gt; 1</span><br><span class="line">one.apply(2); // =&gt; 1</span><br><span class="line">// 再次绑定</span><br><span class="line">one.bind(2)(); // =&gt; 1</span><br><span class="line">// 以构造函数的形式调用绑定函数</span><br><span class="line">new one(); // =&gt; Object</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>只有<code>new one()</code>改变了绑定函数的上下文，其他方式的调用中<code>this</code>总是等于1。</p>
<h2 id="7-箭头函数"><a href="#7-箭头函数" class="headerlink" title="7. 箭头函数"></a>7. 箭头函数</h2><p>箭头函数用于以更短的形式声明函数，并在词法上绑定上下文。它可以这样使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const hello = (name) =&gt; &#123;</span><br><span class="line">  return &#x27;Hello &#x27; + name;</span><br><span class="line">&#125;;</span><br><span class="line">hello(&#x27;World&#x27;); // =&gt; &#x27;Hello World&#x27;</span><br><span class="line">// Keep only even numbers</span><br><span class="line">[1, 2, 5, 6].filter(item =&gt; item % 2 === 0); // =&gt; [2, 6]</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>箭头函数语法简单，没有冗长的<code>function</code> 关键字。当箭头函数只有一条语句时，甚至可以省略<code>return</code>关键字。</p>
<p>箭头函数是匿名的，这意味着<code>name</code>属性是一个空字符串<code>&#39;&#39;</code>。这样它就没有词法上函数名(函数名对于递归、分离事件处理程序非常有用)</p>
<p>同时，跟常规函数相反，它也不提供<code>arguments</code>对象。但是，这在ES6中通过<code>rest parameters</code>修复了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const sumArguments = (...args) =&gt; &#123;</span><br><span class="line">   console.log(typeof arguments); // =&gt; &#x27;undefined&#x27;</span><br><span class="line">   return args.reduce((result, item) =&gt; result + item);</span><br><span class="line">&#125;;</span><br><span class="line">sumArguments.name      // =&gt; &#x27;&#x27;</span><br><span class="line">sumArguments(5, 5, 6); // =&gt; 16</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="7-1-箭头函数中的this"><a href="#7-1-箭头函数中的this" class="headerlink" title="7.1. 箭头函数中的this"></a>7.1. 箭头函数中的this</h4><blockquote>
<p>this 定义箭头函数的封闭上下文</p>
</blockquote>
<p>箭头函数不会创建自己的执行上下文，而是从定义它的外部函数中获取 <code>this</code>。 换句话说，箭头函数在词汇上绑定 <code>this</code>。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884dfd5bf33de?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>下面的例子说明了这个上下文透明的特性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Point &#123;</span><br><span class="line">  constructor(x, y) &#123;</span><br><span class="line">    this.x = x;</span><br><span class="line">    this.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">  log() &#123;</span><br><span class="line">    console.log(this === myPoint); // =&gt; true</span><br><span class="line">    setTimeout(()=&gt; &#123;</span><br><span class="line">      console.log(this === myPoint);      // =&gt; true</span><br><span class="line">      console.log(this.x + &#x27;:&#x27; + this.y); // =&gt; &#x27;95:165&#x27;</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const myPoint = new Point(95, 165);</span><br><span class="line">myPoint.log();</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>setTimeout</code>使用与<code>log()</code>方法相同的上下文(<code>myPoint</code>对象)调用箭头函数。正如所见，箭头函数从定义它的函数继承上下文。</p>
<p>如果在这个例子里尝试用常规函数,它创建自己的上下文(<code>window</code>或严格模式下的<code>undefined</code>)。因此，要使相同的代码正确地使用函数表达式，需要手动绑定上下文:<code>setTimeout(function()&#123;…&#125;.bind(this))</code>。这很冗长，使用箭头函数是一种更简洁、更短的解决方案。</p>
<p>如果箭头函数在最顶层的作用域中定义（在任何函数之外），则上下文始终是全局对象（浏览器中的 window）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">onst getContext = () =&gt; &#123;</span><br><span class="line">   console.log(this === window); // =&gt; true</span><br><span class="line">   return this;</span><br><span class="line">&#125;;</span><br><span class="line">console.log(getContext() === window); // =&gt; true</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>箭头函数一劳永逸地与词汇上下文绑定。 即使修改上下文，<code>this</code>也不能被改变：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const numbers = [1, 2];</span><br><span class="line">(function() &#123;  </span><br><span class="line">  const get = () =&gt; &#123;</span><br><span class="line">    console.log(this === numbers); // =&gt; true</span><br><span class="line">    return this;</span><br><span class="line">  &#125;;</span><br><span class="line">  console.log(this === numbers); // =&gt; true</span><br><span class="line">  get(); // =&gt; [1, 2]</span><br><span class="line">  // Use arrow function with .apply() and .call()</span><br><span class="line">  get.call([0]);  // =&gt; [1, 2]</span><br><span class="line">  get.apply([0]); // =&gt; [1, 2]</span><br><span class="line">  // Bind</span><br><span class="line">  get.bind([0])(); // =&gt; [1, 2]</span><br><span class="line">&#125;).call(numbers);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>无论如何调用箭头函数<code>get</code>，它总是保留词汇上下文<code>numbers</code>。 用其他上下文的隐式调用(通过 <code>get.call([0])</code>或<code>get.apply([0])</code>)或者重新绑定(通过<code>.bind()</code>)都不会起作用。</p>
<p>箭头函数不能用作构造函数。 将它作为构造函数调用(<code>new get()</code>)会抛出一个错误：<code>TypeError: get is not a constructor</code>。</p>
<h4 id="7-2-陷阱-用箭头函数定义方法"><a href="#7-2-陷阱-用箭头函数定义方法" class="headerlink" title="7.2. 陷阱: 用箭头函数定义方法"></a>7.2. 陷阱: 用箭头函数定义方法</h4><p>你可能希望使用箭头函数来声明一个对象上的方法。箭头函数的定义相比于函数表达式短得多：<code>(param) =&gt; &#123;...&#125; instead of function(param) &#123;..&#125;</code>。</p>
<p>来看看例子，用箭头函数在Period类上定义了<code>format()</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Period (hours, minutes) &#123;  </span><br><span class="line">  this.hours = hours;</span><br><span class="line">  this.minutes = minutes;</span><br><span class="line">&#125;</span><br><span class="line">Period.prototype.format = () =&gt; &#123;</span><br><span class="line">  console.log(this === window); // =&gt; true</span><br><span class="line">  return this.hours + &#x27; hours and &#x27; + this.minutes + &#x27; minutes&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">const walkPeriod = new Period(2, 30);  </span><br><span class="line">walkPeriod.format(); // =&gt; &#x27;undefined hours and undefined minutes&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>由于<code>format</code>是一个箭头函数，并且在全局上下文（最顶层的作用域）中定义，因此 <code>this</code> 指向<code>window</code>对象。</p>
<p>即使<code>format</code>作为方法在一个对象上被调用如<code>walkPeriod.format()</code>，<code>window</code>仍然是这次调用的上下文。之所以会这样是因为箭头函数有静态的上下文，并不会随着调用方式的改变而改变。</p>
<p>该方法返回<code>&#39;undefined hours和undefined minutes&#39;</code>，这不是咱们想要的结果。</p>
<p>函数表达式解决了这个问题，因为常规函数确实能根据实际调用改变它的上下文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Period (hours, minutes) &#123;  </span><br><span class="line">  this.hours = hours;</span><br><span class="line">  this.minutes = minutes;</span><br><span class="line">&#125;</span><br><span class="line">Period.prototype.format = function() &#123;</span><br><span class="line">  console.log(this === walkPeriod); // =&gt; true</span><br><span class="line">  return this.hours + &#x27; hours and &#x27; + this.minutes + &#x27; minutes&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">const walkPeriod = new Period(2, 30);  </span><br><span class="line">walkPeriod.format(); // =&gt; &#x27;2 hours and 30 minutes&#x27;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>walkPeriod.format()</code>是一个对象上的方法调用，它的上下文是<code>walkPeriod</code>对象。<code>this.hours</code>等于<code>2</code>，<code>this.minutes</code>等于<code>30</code>，所以这个方法返回了正确的结果：<code>&#39;2 hours and 30 minutes&#39;</code>。</p>
<p><strong>原文：dmitripavlutin.com/gentle-expl…</strong></p>
<p><strong>代码部署后可能存在的BUG没法实时知道，事后为了解决这些BUG，花了大量的时间进行log 调试，这边顺便给大家推荐一个好用的BUG监控工具 Fundebug。</strong></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>为函数调用对<code>this</code>影响最大，从现在开始不要问自己：</p>
<blockquote>
<p>this 是从哪里来的？</p>
</blockquote>
<p>而是要看看</p>
<blockquote>
<p>函数是怎么被调用的？</p>
</blockquote>
<p>对于箭头函数，需要想想</p>
<blockquote>
<p>在这个箭头函数被定义的地方，this是什么？</p>
</blockquote>
<p>这是处理<code>this</code>时的正确想法，它们可以让你免于头痛。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/31/coin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/31/coin/" class="post-title-link" itemprop="url">挖矿程序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-07-31 10:00:30" itemprop="dateCreated datePublished" datetime="2019-07-31T10:00:30+08:00">2019-07-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-28 13:59:44" itemprop="dateModified" datetime="2021-12-28T13:59:44+08:00">2021-12-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config.json （挖矿配置）、</span><br><span class="line">sysupdate （XMR 挖矿软件）、</span><br><span class="line">update.sh （本脚本）、</span><br><span class="line">networkservice(scanner扫描并入侵其他的主机)、</span><br><span class="line">sysguard(watchdog 用于监控并保证病毒的正常运行以及更新) 并保证他们以 root 权限运行。</span><br></pre></td></tr></table></figure>

<ol>
<li><p>查看病毒的 PID 号</p>
</li>
<li><p>获取绝对路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /proc/&#123;pid 号&#125;/exe</span><br></pre></td></tr></table></figure></li>
<li><p>删除/tmp文件夹的所有文件</p>
</li>
<li><p>检查下定时任务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l 或者 cat /var/spool/cron/will</span><br></pre></td></tr></table></figure>

<p>上面的will为当前用户名</p>
<p>查看定时任务的日志</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more /var/<span class="built_in">log</span>/cron <span class="built_in">log</span></span><br></pre></td></tr></table></figure></li>
<li><p>删除定时任务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /var/spool/cron/root 或者 crontab -r 删除定时任务</span><br></pre></td></tr></table></figure></li>
<li><p>kill 命令将相关进程干掉</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sysupdate</span><br><span class="line">networkservice</span><br><span class="line">sysguard</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/10/java%20io/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/10/java%20io/" class="post-title-link" itemprop="url">java io</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-07-10 14:25:30 / Modified: 15:58:46" itemprop="dateCreated datePublished" datetime="2019-07-10T14:25:30+08:00">2019-07-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="流"><a href="#流" class="headerlink" title="流"></a>流</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">流包括字符流和字节流，流从概念上来说是一个连续的数据流。当程序需要读数据的时候就需要使用输入流读取数据，当需要往外写数据的时候就需要输出流</span><br></pre></td></tr></table></figure>

<ul>
<li><p>字节流：字节流主要用来处理字节或二进制对象<code>InputStream、OutputStream，</code></p>
<blockquote>
<p>在使用字节流的时候，InputStream和OutputStream都是抽象类，我们实例化的都是他们的子类，每一个子类都有自己的作用范围</p>
</blockquote>
<p><img src="https://i.imgur.com/s39Xj3r.png"></p>
</li>
<li><p>字符流：字符流用来处理字符文本或字符串<code>Reader、Writer</code></p>
<blockquote>
<p>在使用字符流的时候也是，Reader和Writer都是抽象类，我们实例化的都是他们的子类，每一个子类都有自己的作用范围</p>
</blockquote>
<p><img src="https://i.imgur.com/RMD0koG.png"></p>
</li>
<li><p>字节流转换为字符流</p>
<blockquote>
<p>使用<code>InputStreamReader、OutputStreamWriter</code>可以将输入字节流转化为输入字符流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Reader reader  =  <span class="keyword">new</span> InputStreamReader(inputStream);</span><br><span class="line">Writer writer = <span class="keyword">new</span> OutputStreamWriter(outputStream)</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<p>输入字节流：<strong>InputStream</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/a.txt&quot;</span>);</span><br><span class="line">    InputStream inputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) file.length()];</span><br><span class="line">    inputStream.read(bytes);</span><br><span class="line">    System.out.println(<span class="keyword">new</span> String(bytes));</span><br><span class="line">    inputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入字符流：<strong>Reader</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/a.txt&quot;</span>);</span><br><span class="line">    Reader reader = <span class="keyword">new</span> FileReader(file);</span><br><span class="line">    <span class="keyword">char</span>[] bytes = <span class="keyword">new</span> <span class="keyword">char</span>[(<span class="keyword">int</span>) file.length()];</span><br><span class="line">    reader.read(bytes);</span><br><span class="line">    System.out.println(<span class="keyword">new</span> String(bytes));</span><br><span class="line">    reader.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出字节流：<strong>OutputStream</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    String <span class="keyword">var</span> = <span class="string">&quot;hai this is a test&quot;</span>;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/b.txt&quot;</span>);</span><br><span class="line">    OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">    outputStream.write(<span class="keyword">var</span>.getBytes());</span><br><span class="line">    outputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出字符流：<strong>Writer</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    String <span class="keyword">var</span> = <span class="string">&quot;hai this is a test&quot;</span>;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/b.txt&quot;</span>);</span><br><span class="line">    Writer writer = <span class="keyword">new</span> FileWriter(file);</span><br><span class="line">    writer.write(<span class="keyword">var</span>);</span><br><span class="line">    writer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>BufferedInputStream</strong></p>
<blockquote>
<p>在使用InputStream的时候，都是一个字节一个字节的读或写，而BufferedInputStream为输入字节流提供了缓冲区，读数据的时候会一次读取一块数据放到缓冲区里，当缓冲区里的数据被读完之后，输入流会再次填充数据缓冲区，直到输入流被读完，有了缓冲区就能够提高很多io速度</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * inputStream 输入流</span></span><br><span class="line"><span class="comment"> * 1024 内部缓冲区大小为1024byte</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">BufferedInputStream bufferedInputStream = <span class="keyword">new</span> BufferedInputStream(inputStream,<span class="number">1024</span>);</span><br></pre></td></tr></table></figure>

<p><strong>BufferedOutputStream</strong></p>
<blockquote>
<p>BufferedOutputStream可以为输出字节流提供缓冲区，作用与BufferedInputStream类似，使用方式将输出流包装到BufferedOutputStream中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * outputStream 输出流</span></span><br><span class="line"><span class="comment"> * 1024 内部缓冲区大小为1024byte</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">BufferedOutputStream bufferedOutputStream = <span class="keyword">new</span> BufferedOutputStream(outputStream,<span class="number">1024</span>);</span><br></pre></td></tr></table></figure>

<p><strong>BufferedReader</strong></p>
<blockquote>
<p>为输入字符流提供缓冲区</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(reader,<span class="number">1024</span>);</span><br></pre></td></tr></table></figure>

<p><strong>BufferedWriter</strong></p>
<blockquote>
<p>为输出字符流提供缓冲区</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(writer,<span class="number">1024</span>);</span><br></pre></td></tr></table></figure>



<h2 id="io模型"><a href="#io模型" class="headerlink" title="io模型"></a>io模型</h2><h3 id="bio"><a href="#bio" class="headerlink" title="bio"></a>bio</h3><blockquote>
<p>同步阻塞IO模型</p>
<p>JDK 1.4版本以前</p>
</blockquote>
<p><img src="https://chenmingyu.top/nio/bio%E7%BA%BF%E7%A8%8B.png"></p>
<p>在这种模式中通常用一个线程去接受请求，然后用一个线程池去处理请求，用这种方式并发管理多个Socket客户端连接</p>
<p><img src="https://chenmingyu.top/nio/BIO%E7%BA%BF%E7%A8%8B+%E7%BA%BF%E7%A8%8B%E6%B1%A0.png"></p>
<h3 id="nio"><a href="#nio" class="headerlink" title="nio"></a>nio</h3><blockquote>
<p>同步非阻塞IO模型</p>
<p>JDK 1.4版本以后</p>
</blockquote>
<p>成熟的框架，比如Netty</p>
<h3 id="aio"><a href="#aio" class="headerlink" title="aio"></a>aio</h3><blockquote>
<p>异步非阻塞IO模型</p>
<p>JDK1.7升级了Nio类库，成为Nio2.0，最主要的是提供了异步文件的IO操作，以及事件驱动IO，AIO的异步套接字通道是真正的异步非阻塞IO</p>
</blockquote>
<p><img src="https://chenmingyu.top/nio/%E5%90%84IO%E6%A8%A1%E5%9E%8B%E5%AF%B9%E6%AF%94.png"></p>
<hr>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://chenmingyu.top/nio/">一文看懂java io系统</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/11/kafka%20snippet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/06/11/kafka%20snippet/" class="post-title-link" itemprop="url">kafka learn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-06-11 14:01:30" itemprop="dateCreated datePublished" datetime="2019-06-11T14:01:30+08:00">2019-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-08 15:03:51" itemprop="dateModified" datetime="2023-01-08T15:03:51+08:00">2023-01-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kafka/" itemprop="url" rel="index"><span itemprop="name">kafka</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="port（confluent-reference）"><a href="#port（confluent-reference）" class="headerlink" title="port（confluent reference）"></a>port（confluent reference）</h2><table>
<thead>
<tr>
<th align="left">Component</th>
<th align="left">Default Port</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Zookeeper</td>
<td align="left">2181</td>
</tr>
<tr>
<td align="left">Apache Kafka brokers (plain text)</td>
<td align="left">9092</td>
</tr>
<tr>
<td align="left">Schema Registry REST API</td>
<td align="left">8081</td>
</tr>
<tr>
<td align="left">REST Proxy</td>
<td align="left">8082</td>
</tr>
<tr>
<td align="left">Kafka Connect REST API</td>
<td align="left">8083</td>
</tr>
<tr>
<td align="left">Confluent Control Center</td>
<td align="left">9021</td>
</tr>
</tbody></table>
<h2 id="System-Architecture"><a href="#System-Architecture" class="headerlink" title="System Architecture"></a>System Architecture</h2><p><img src="https://i.imgur.com/gG71h6m.png"></p>
<ul>
<li><strong>kafka Producer API:</strong> Applications directly producing data (ex: clickstream, logs, IoT).</li>
<li><strong>Kafka Connect Source API:</strong> Applications bridging between a datastore we don’t control and Kafka (ex: CDC, Postgres, MongoDB, Twitter, REST API).</li>
<li><strong>Kafka Streams API / KSQL:</strong> Applications wanting to consume from Kafka and produce back into Kafka, also called stream processing. Use KSQL if you think you can write your real-time job as SQL-like, use Kafka Streams API if you think you’re going to need to write complex logic for your job.</li>
<li><strong>Kafka Consumer API:</strong> Read a stream and perform real-time actions on it (e.g. send email…)</li>
<li><strong>Kafka Connect Sink API</strong>: Read a stream and store it into a target store (ex: Kafka to S3, Kafka to HDFS, Kafka to PostgreSQL, Kafka to MongoDB, etc.)</li>
</ul>
<p><img src="https://www.sohamkamani.com/basic_arch-e0b11d2ab5b62a78cb7fd26d3a9d279b.svg"></p>
<ol>
<li><strong>Zookeeper</strong> : Which is used by Kafka to maintain state between the nodes of the cluster.</li>
<li><strong>Kafka brokers</strong> : The “pipes” in our pipeline, which store and emit data.</li>
<li><strong>Producers</strong> : That insert data into the cluster.</li>
<li><strong>Consumers</strong> : That read data from the cluster.</li>
</ol>
<p><img src="https://kafka.apache.org/22/images/kafka-apis.png"></p>
<h3 id="Creating-a-topic"><a href="#Creating-a-topic" class="headerlink" title="Creating a topic"></a>Creating a topic</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh \</span><br><span class="line">--create \</span><br><span class="line">--topic my-kafka-topic \</span><br><span class="line">--zookeeper localhost:2181 \</span><br><span class="line">--partitions 3 \</span><br><span class="line">--replication-factor 2</span><br></pre></td></tr></table></figure>

<ul>
<li>The <code>paritions</code> options lets you decide how many brokers you want your data to be split between. Since we set up 3 brokers, we can set this option to 3.</li>
<li>The <code>replication-factor</code> describes how many copies of you data you want (in case one of the brokers goes down, you still have your data on the others).</li>
</ul>
<h3 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-producer.sh \</span><br><span class="line">--broker-list localhost:9093,localhost:9094,localhost:9095 \</span><br><span class="line">--topic my-kafka-topic</span><br></pre></td></tr></table></figure>

<h3 id="Consumers"><a href="#Consumers" class="headerlink" title="Consumers"></a>Consumers</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh \</span><br><span class="line">--bootstrap-server localhost:9093 \</span><br><span class="line">--topic my-kafka-topic \</span><br><span class="line">--from-beginning</span><br></pre></td></tr></table></figure>

<ul>
<li>The <code>bootstrap-server</code> can be any one of the brokers in the cluster.</li>
<li>The <code>from-beginning</code> option tells the cluster that you want all the messages that it currently has with it, even messages that we put into it previously.</li>
</ul>
<p>Try starting another consumer in a different terminal window:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh \</span><br><span class="line">--bootstrap-server localhost:9093 \</span><br><span class="line">--topic my-kafka-topic \</span><br><span class="line">--from-beginning \</span><br><span class="line">--group group2</span><br></pre></td></tr></table></figure>

<h2 id="Kafka-as-a-Messaging-System"><a href="#Kafka-as-a-Messaging-System" class="headerlink" title="Kafka as a Messaging System"></a>Kafka as a Messaging System</h2><ul>
<li><p>As with a queue the consumer group allows you to divide up processing over a collection of processes (the members of the consumer group). As with publish-subscribe, Kafka allows you to broadcast messages to multiple consumer groups.</p>
<p><img src="https://kafka.apache.org/22/images/consumer-groups.png"></p>
</li>
<li><p>Kafka does it better. By having a notion of parallelism—the partition—within the topics, Kafka is able to provide both ordering guarantees and load balancing over a pool of consumer processes. This is achieved by assigning the partitions in the topic to the consumers in the consumer group so that each partition is consumed by exactly one consumer in the group. By doing this we ensure that the consumer is the only reader of that partition and consumes the data in order. Since there are many partitions this still balances the load over many consumer instances. Note however that there cannot be more consumer instances in a consumer group than partitions.</p>
</li>
<li><p>Each record consists of a key, a value, and a timestamp.</p>
</li>
</ul>
<h2 id="Kafka-as-a-Storage-System"><a href="#Kafka-as-a-Storage-System" class="headerlink" title="Kafka as a Storage System"></a>Kafka as a Storage System</h2><h2 id="Kafka-as-Stream-Processing"><a href="#Kafka-as-Stream-Processing" class="headerlink" title="Kafka as Stream Processing"></a>Kafka as Stream Processing</h2><h2 id="source-code"><a href="#source-code" class="headerlink" title="source code"></a>source code</h2><h3 id="源码文件结构"><a href="#源码文件结构" class="headerlink" title="源码文件结构"></a>源码文件结构</h3><table>
<thead>
<tr>
<th>目录</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>bin</td>
<td>存放可直接在Linux或Windows上运行的.sh文件和.bat文件，包含Kafka常用操作以及ZooKeeper便捷脚本</td>
</tr>
<tr>
<td>checkstyle</td>
<td>存放代码规范检查文档</td>
</tr>
<tr>
<td>clients</td>
<td>客户端的实现</td>
</tr>
<tr>
<td>config</td>
<td>存放配置文件</td>
</tr>
<tr>
<td>connetct</td>
<td>Kafka Connect工具的实现</td>
</tr>
<tr>
<td>core</td>
<td>核心模块</td>
</tr>
<tr>
<td>docs</td>
<td>官方文档</td>
</tr>
<tr>
<td>examples</td>
<td>Kafka生产者消费者简单Demo</td>
</tr>
<tr>
<td>jmh-benchmarks</td>
<td>基准测试模块</td>
</tr>
<tr>
<td>log4j-appender</td>
<td>日志模块</td>
</tr>
<tr>
<td>streams</td>
<td>Kafka Streams客户端库</td>
</tr>
<tr>
<td>tools</td>
<td>工具类</td>
</tr>
</tbody></table>
<h3 id="核心模块结构"><a href="#核心模块结构" class="headerlink" title="核心模块结构"></a>核心模块结构</h3><table>
<thead>
<tr>
<th>目录</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td>管理模块，操作和管理topic， broker, consumer group， records等</td>
</tr>
<tr>
<td>api</td>
<td>封装调用</td>
</tr>
<tr>
<td>client</td>
<td>Producer生产的元数据信息的传递</td>
</tr>
<tr>
<td>cluster</td>
<td>存活的Broker集群、分区、副本以及他们的底层属性和相互关系</td>
</tr>
<tr>
<td>common</td>
<td>异常类、枚举类、格式化类、配置类等</td>
</tr>
<tr>
<td>consumer</td>
<td>旧版本的废弃消费者类</td>
</tr>
<tr>
<td>controller</td>
<td>Kafka集群控制中心的选举，分区状态管理，分区副本状态管理，监听ZooKeeper数据变化等</td>
</tr>
<tr>
<td>coordinator</td>
<td>GroupCoordinator处理一般组成员资格和偏移量。transaction管理事务</td>
</tr>
<tr>
<td>javaapi</td>
<td>给java调用的生产者、消费者、消息集api</td>
</tr>
<tr>
<td>log</td>
<td>管理log，它是消息存储的形式，可对应到磁盘上的一个文件夹</td>
</tr>
<tr>
<td>message</td>
<td>由消息封装而成的一个压缩消息集</td>
</tr>
<tr>
<td>metrics</td>
<td>Kafka监控模块</td>
</tr>
<tr>
<td>network</td>
<td>网络管理模块，对客户端连接的处理</td>
</tr>
<tr>
<td>producer</td>
<td>旧版本的废弃生产者类</td>
</tr>
<tr>
<td>security</td>
<td>权限管理</td>
</tr>
<tr>
<td>serializer</td>
<td>消息序列化与反序列化处理</td>
</tr>
<tr>
<td>server</td>
<td>服务器端的实现</td>
</tr>
<tr>
<td>tools</td>
<td>各种控制台工具的实现</td>
</tr>
<tr>
<td>utils</td>
<td>工具类</td>
</tr>
<tr>
<td>zk</td>
<td>提供与ZooKeeper交互的管理方法和在管道之上的更高级别的Kafka特定操作</td>
</tr>
<tr>
<td>zookeeper</td>
<td>一个促进管道传输请求的ZooKeeper客户端</td>
</tr>
</tbody></table>
<h1 id="主题分区"><a href="#主题分区" class="headerlink" title="主题分区"></a>主题分区</h1><ul>
<li>调整分区</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper localhost:2181 --alter --topic my-topic --partitions 10</span><br></pre></td></tr></table></figure>

<ul>
<li>查看分区</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper localhost:2181 --describe --topic my-topic</span><br></pre></td></tr></table></figure>



<h1 id="Restful-API"><a href="#Restful-API" class="headerlink" title="Restful API"></a>Restful API</h1><h2 id="AVRO主题相关"><a href="#AVRO主题相关" class="headerlink" title="AVRO主题相关"></a>AVRO主题相关</h2><blockquote>
<p>一般schema registry 默认端口是8081（有时候避免与flink-jobmanager端口冲突，改为别的端口号 8091）</p>
</blockquote>
<ul>
<li><p>获取所有主题信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;http://&lt;schema-registry-url&gt;:&lt;port&gt;/subjects&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>根据schema id查下相关信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;http://&lt;schema-registry-url&gt;:&lt;port&gt;/schemas/ids/&lt;schema-id&gt;&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>获取指定主题key/value相关schema信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://&lt;schema-registry-url&gt;:&lt;port&gt;/subjects/&lt;topic-name&gt;-value/versions/latest</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://&lt;schema-registry-url&gt;:&lt;port&gt;/subjects/&lt;topic-name&gt;-key/versions/latest</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="参数调优"><a href="#参数调优" class="headerlink" title="参数调优"></a>参数调优</h1><h1 id="producer"><a href="#producer" class="headerlink" title="producer"></a>producer</h1><ul>
<li>batch.size 默认16384</li>
<li>request.time.ms 默认30000（30秒）</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/24/hadoop%20learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/24/hadoop%20learn/" class="post-title-link" itemprop="url">javarevisited</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-24 12:01:30" itemprop="dateCreated datePublished" datetime="2019-05-24T12:01:30+08:00">2019-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-02-16 10:39:14" itemprop="dateModified" datetime="2023-02-16T10:39:14+08:00">2023-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="./img/Hadoop-Multi-node-Cluster.png"></p>
<p><img src="./img/hdfsarchitecture.gif"></p>
<h3 id="NameNode"><a href="#NameNode" class="headerlink" title="NameNode"></a>NameNode</h3><ul>
<li>The <strong>NameNode</strong> executes file system namespace operations like opening, closing, and renaming files and directories.It also determines the mapping of blocks to DataNodes.</li>
</ul>
<h3 id="DataNodes"><a href="#DataNodes" class="headerlink" title="DataNodes"></a>DataNodes</h3><ul>
<li>The <strong>DataNodes</strong> are responsible for serving read and write requests from the file system’s clients. The DataNodes also perform block creation, deletion, and replication upon instruction from the NameNode.</li>
<li>The DataNode stores HDFS data in files in its local file system.The DataNode has no knowledge about HDFS files. It stores each block of HDFS data in a separate file in its local file system.</li>
</ul>
<h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><ul>
<li><p>a file is split into one or more blocks and these blocks are stored in a set of DataNodes. </p>
</li>
<li><p>all blocks in a file except the last block are the same size.</p>
</li>
<li><p>Files in HDFS are write-once and have strictly one writer at any time.</p>
</li>
</ul>
<h3 id="The-Persistence-of-File-System-Metadata"><a href="#The-Persistence-of-File-System-Metadata" class="headerlink" title="The Persistence of File System Metadata"></a>The Persistence of File System Metadata</h3><ul>
<li>The NameNode uses a transaction log called the <strong>EditLog</strong> to persistently record every change that occurs to file system metadata.</li>
<li>The entire file system namespace, including the mapping of blocks to files and file system properties, is stored in a file called the <strong>FsImage</strong>. The FsImage is stored as a file in the NameNode’s local file system too.</li>
</ul>
<hr>
<p><strong>Blockreport</strong>: DataNode scans through its local file system, generates a list of all HDFS data blocks that correspond to each of these local files and sends this report to the NameNode</p>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>2.7.3源码</p>
<ul>
<li>编译问题</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">问题：Failed to parse plugin descriptor for org.apache.hadoop:hadoop-maven-plugins</span><br><span class="line"></span><br><span class="line">解决：cd到hadoop-maven-plugins，执行mvn clean 然后 install 一下，再执行编译通过</span><br></pre></td></tr></table></figure>

<h1 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h1><h1 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h1><h2 id="DataNode"><a href="#DataNode" class="headerlink" title="DataNode"></a>DataNode</h2><pre><code> 50010  dfs.datanode.address   datanode服务端口，用于数据传输
50075  dfs.datanode.http.address  http服务的端口
50475  dfs.datanode.https.address  https服务的端口
50020  dfs.datanode.ipc.address   ipc服务的端口
</code></pre>
<h2 id="NameNode-1"><a href="#NameNode-1" class="headerlink" title="NameNode"></a>NameNode</h2><p>​     50070  dfs.namenode.http-address  http服务的端口 （<strong>访问hadoop的管理页面</strong>）<br>​    50470  dfs.namenode.https-address  https服务的端口<br>​    8020   fs.defaultFS   接收Client连接的RPC端口，用于获取文件系统metadata信息。</p>
<h2 id="journalnode"><a href="#journalnode" class="headerlink" title="journalnode"></a>journalnode</h2><pre><code> 8485   dfs.journalnode.rpc-address   RPC服务
 8480   dfs.journalnode.http-address   HTTP服务
</code></pre>
<h2 id="ZKFC"><a href="#ZKFC" class="headerlink" title="ZKFC"></a>ZKFC</h2><pre><code> 8019   dfs.ha.zkfc.port   ZooKeeper FailoverController，用于NN HA
</code></pre>
<h2 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h2><h2 id="ResourceManager"><a href="#ResourceManager" class="headerlink" title="ResourceManager"></a>ResourceManager</h2><pre><code> 8032  yarn.resourcemanager.address   RM的applications manager(ASM)端口
8030  yarn.resourcemanager.scheduler.address  scheduler组件的IPC端口
8031  yarn.resourcemanager.resource-tracker.address  IPC
8033  yarn.resourcemanager.admin.address  IPC
8088  yarn.resourcemanager.webapp.address   http服务端口（**访问yarn的管理页面**）
</code></pre>
<h2 id="NodeManager"><a href="#NodeManager" class="headerlink" title="NodeManager"></a>NodeManager</h2><p>​     8040  yarn.nodemanager.localizer.address  localizer IPC<br>​    8042  yarn.nodemanager.webapp.address   http服务端口（<strong>从节点node管理界面，可查看节点的任务处理信息</strong>）<br>​    8041  yarn.nodemanager.address   NM中container manager的端口</p>
<h2 id="JobHistory-Server"><a href="#JobHistory-Server" class="headerlink" title="JobHistory Server"></a>JobHistory Server</h2><pre><code> 10020   mapreduce.jobhistory.address   IPC
19888   mapreduce.jobhistory.webapp.address   http服务端口
</code></pre>
<h1 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h1><p>   Master<br>     60000   hbase.master.port  IPC<br>     60010   hbase.master.info.port  http服务端口<br>   RegionServer<br>     60020   hbase.regionserver.port   IPC<br>     60030   hbase.regionserver.info.port   http服务端口<br>   HQuorumPeer<br>     2181  hbase.zookeeper.property.clientPort   HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。<br>     2888  hbase.zookeeper.peerport   HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。<br>     3888  hbase.zookeeper.leaderport  HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。</p>
<h1 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h1><p>   Metastore<br>     9083  /etc/default/hive-metastore中export PORT=<port>来更新默认端口<br>   HiveServer<br>     10000   /etc/hive/conf/hive-env.sh中export HIVE_SERVER2_THRIFT_PORT=<port>来更新默认端口   </p>
<h1 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h1><p>   Server<br>     2181  /etc/zookeeper/conf/zoo.cfg中clientPort=<port>  对客户端提供服务的端口<br>     2888  /etc/zookeeper/conf/zoo.cfg中server.x=[hostname]:nnnnn[:nnnnn]，标蓝部分  follower用来连接到leader，只在leader上监听该端口。<br>     3888  /etc/zookeeper/conf/zoo.cfg中server.x=[hostname]:nnnnn[:nnnnn]，标蓝部分  用于leader选举的。只在electionAlg是1,2或3(默认)时需要。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/24/hadoop%20snippt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/24/hadoop%20snippt/" class="post-title-link" itemprop="url">hadoop snippet</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-24 12:01:30" itemprop="dateCreated datePublished" datetime="2019-05-24T12:01:30+08:00">2019-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 10:52:22" itemprop="dateModified" datetime="2022-04-20T10:52:22+08:00">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hadoop/" itemprop="url" rel="index"><span itemprop="name">hadoop</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Create-a-directory-in-HDFS-at-given-path-s"><a href="#1-Create-a-directory-in-HDFS-at-given-path-s" class="headerlink" title="1. Create a directory in HDFS at given path(s)."></a>1. Create a directory in HDFS at given path(s).</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mkdir &lt;paths&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop dfs -mkdir /user/saurzcode/dir1 /user/saurzcode/dir2</span><br></pre></td></tr></table></figure>

<h2 id="2-List-the-contents-of-a-directory"><a href="#2-List-the-contents-of-a-directory" class="headerlink" title="2.  List the contents of a directory."></a>2.  List the contents of a directory.</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -ls &lt;args&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -ls /user/saurzcode</span><br></pre></td></tr></table></figure>

<h2 id="3-Upload-and-download-a-file-in-HDFS"><a href="#3-Upload-and-download-a-file-in-HDFS" class="headerlink" title="3. Upload and download a file in HDFS."></a>3. Upload and download a file in HDFS.</h2><p><strong>Upload:</strong></p>
<p><strong>hdfs fs -put:</strong></p>
<p>Copy single src file, or multiple src files from local file system to the hdfs data file system</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -put &lt;localsrc&gt; ... &lt;HDFS_dest_Path&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -put /home/saurzcode/Samplefile.txt  /user/saurzcode/dir3/</span><br></pre></td></tr></table></figure>

<p><strong>*Download:</strong>*</p>
<p><strong>hdfs fs -get:</strong></p>
<p>Copies/Downloads files to the local file system</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -get &lt;hdfs_src&gt; &lt;localdst&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -get /user/saurzcode/dir3/Samplefile.txt /home/</span><br></pre></td></tr></table></figure>

<h2 id="4-See-contents-of-a-file"><a href="#4-See-contents-of-a-file" class="headerlink" title="4. See contents of a file"></a>4. See contents of a file</h2><p>Same as unix cat command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -cat &lt;path[filename]&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -cat /user/saurzcode/dir1/abc.txt</span><br></pre></td></tr></table></figure>

<h2 id="5-Copy-a-file-from-source-to-destination"><a href="#5-Copy-a-file-from-source-to-destination" class="headerlink" title="5. Copy a file from source to destination"></a>5. Copy a file from source to destination</h2><p>This command allows multiple sources as well in which case the destination must be a directory.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -cp &lt;source&gt; &lt;dest&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -cp /user/saurzcode/dir1/abc.txt /user/saurzcode/dir2</span><br></pre></td></tr></table></figure>

<h2 id="6-Copy-a-file-from-To-Local-file-system-to-HDFS"><a href="#6-Copy-a-file-from-To-Local-file-system-to-HDFS" class="headerlink" title="6. Copy a file from/To Local file system to HDFS"></a>6. Copy a file from/To Local file system to HDFS</h2><p><strong>copyFromLocal</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -copyFromLocal &lt;localsrc&gt; URI</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -copyFromLocal /home/saurzcode/abc.txt  /user/saurzcode/abc.txt</span><br></pre></td></tr></table></figure>

<p>Similar to put command, except that the source is restricted to a local file reference.</p>
<p><strong>copyToLocal</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -copyToLocal [-ignorecrc] [-crc] URI &lt;localdst&gt;</span><br></pre></td></tr></table></figure>

<p>Similar to get command, except that the destination is restricted to a local file reference.</p>
<h2 id="7-Move-file-from-source-to-destination"><a href="#7-Move-file-from-source-to-destination" class="headerlink" title="7. Move file from source to destination."></a>7. Move file from source to destination.</h2><p>Note:- Moving files across filesystem is not permitted.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mv &lt;src&gt; &lt;dest&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mv /user/saurzcode/dir1/abc.txt /user/saurzcode/dir2</span><br></pre></td></tr></table></figure>

<h2 id="8-Remove-a-file-or-directory-in-HDFS"><a href="#8-Remove-a-file-or-directory-in-HDFS" class="headerlink" title="8. Remove a file or directory in HDFS."></a>8. Remove a file or directory in HDFS.</h2><p>Remove files specified as argument. Deletes directory only when it is empty</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rm &lt;arg&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rm /user/saurzcode/dir1/abc.txt</span><br></pre></td></tr></table></figure>

<p><strong>*Recursive version of delete.</strong>*</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rmr &lt;arg&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rmr /user/saurzcode/</span><br></pre></td></tr></table></figure>

<h2 id="9-Display-last-few-lines-of-a-file"><a href="#9-Display-last-few-lines-of-a-file" class="headerlink" title="9. Display last few lines of a file."></a>9. Display last few lines of a file.</h2><p>Similar to tail command in Unix.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -tail &lt;path[filename]&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -tail /user/saurzcode/dir1/abc.txt</span><br></pre></td></tr></table></figure>

<h2 id="10-Display-the-aggregate-length-of-a-file"><a href="#10-Display-the-aggregate-length-of-a-file" class="headerlink" title="10. Display the aggregate length of a file."></a>10. Display the aggregate length of a file.</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -du &lt;path&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">hdfs dfs -du /user/saurzcode/dir1/abc.txt</span><br></pre></td></tr></table></figure>

<p>Please comment which of these commands you found most useful while dealing with Hadoop /HDFS.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/14/rabbitmq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/14/rabbitmq/" class="post-title-link" itemprop="url">rabbitmq learn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-05-14 11:45:30 / Modified: 13:33:11" itemprop="dateCreated datePublished" datetime="2019-05-14T11:45:30+08:00">2019-05-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/rabbitmq/" itemprop="url" rel="index"><span itemprop="name">rabbitmq</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>查询已有queue</p>
<p><code>sudo rabbitmqctl list_queues</code></p>
</li>
<li><p>查询已有exchanges</p>
<p><code>sudo rabbitmqctl list_exchanges</code></p>
</li>
</ul>
<h2 id="Publish-Subscribe"><a href="#Publish-Subscribe" class="headerlink" title="Publish/Subscribe"></a>Publish/Subscribe</h2><ul>
<li><p>Exchanges</p>
<p>There are a few exchange types available: <strong>direct</strong>, <strong>topic</strong>, <strong>headers</strong> and <strong>fanout</strong>.</p>
</li>
<li><p>Bindings</p>
<p>A binding is a relationship between an exchange and a queue</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/14/http%20learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/14/http%20learn/" class="post-title-link" itemprop="url">http learn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-14 10:07:30" itemprop="dateCreated datePublished" datetime="2019-05-14T10:07:30+08:00">2019-05-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-08-08 16:31:19" itemprop="dateModified" datetime="2019-08-08T16:31:19+08:00">2019-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/http/" itemprop="url" rel="index"><span itemprop="name">http</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="http-1-0-http-1-1"><a href="#http-1-0-http-1-1" class="headerlink" title="http 1.0 http 1.1"></a>http 1.0 http 1.1</h2><ul>
<li><p>HTTP1.0最早在网页中使用是1996年，那个时候只是使用一些较为简单的网页和网络的请求，每次请求都需要建立一个单独的连接，上一次和下一次请求完全分离。这种做法，即使每次的请求量都很小，但是客户端和服务端每次建立TCP连接和关闭TCP连接都是相对比较费时的过程，严重影响客户端和服务端的性能。</p>
</li>
<li><p>基于以上的问题，HTTP1.1在1999年广泛应用于现在的各大浏览器网络请求中，同时HTTP1.1也是当前使用最为广泛的HTTP协议（2015年诞生了HTTP2，但是还未大规模应用），这里不详细对比HTTP1.1针对HTTP1.0改进了什么，只是在连接这块，HTTP1.1支持在一个TCP连接上传送多个HTTP请求和响应，减少了建立和关闭连接的消耗延迟，一定程度上弥补了HTTP1.0每次请求都要创建连接的缺点，这就是长连接，HTTP1.1默认使用长连接。</p>
</li>
<li><p>那么，长连接是如何工作的呢？首先，我们要明确一下，长短连接是通信层（TCP）的概念，HTTP是应用层协议，它只能说告诉通信层我打算一段时间内复用TCP通道而没有自己去建立、释放TCP通道的能力。</p>
</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eZzl4LXykQwdKAeT5rjMFfDXeITCDnbwnNXWrFDaIIhBibAk4N83H5dKXAkMNleqewC53Y8WQ6cOhRjA7k4SuMw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"></p>
<ul>
<li>http的keep-alive和tcp的keep-alive的区别<ul>
<li>http的keep-alive是为了复用已有连接</li>
<li>tcp的keep-alive是为了保活，即保证对端还存活，不然对端已经不在了我这边还占着和对端的这个连接，浪费服务器资源，做法是隔一段时间发送一个心跳包到对端服务器，一旦长时间没有接收到应答，就主动关闭连接</li>
</ul>
</li>
</ul>
<h2 id="WebSockets"><a href="#WebSockets" class="headerlink" title="WebSockets"></a>WebSockets</h2><p>WebSockets provide a persistent connection between a client and server that both parties can use to start sending data at any time.**</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Create a new WebSocket.</span><br><span class="line">var socket = new WebSocket(&#x27;ws://echo.websocket.org&#x27;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Once the connection has been established the <code>open</code> event will be fired on your WebSocket instance.</p>
</li>
<li><p>请求</p>
<p><code>ws://localhost:9095/webSocket/d72b3660-29a8-4276-9eb1-3373e82fdd92</code></p>
</li>
<li><p>后台请求的结果传入websocket是通过session建立关联的</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/05/bigdata/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/05/bigdata/" class="post-title-link" itemprop="url">bigdata snippet</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-05 22:52:30" itemprop="dateCreated datePublished" datetime="2019-05-05T22:52:30+08:00">2019-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-03-07 21:09:14" itemprop="dateModified" datetime="2022-03-07T21:09:14+08:00">2022-03-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="BIG-DATA-What-is-Types-Characteristics-amp-Example"><a href="#BIG-DATA-What-is-Types-Characteristics-amp-Example" class="headerlink" title="BIG DATA: What is, Types, Characteristics &amp; Example"></a>BIG DATA: What is, Types, Characteristics &amp; Example</h2><ul>
<li>Big Data is defined as data that is huge in size. Bigdata is a term used to describe a collection of data that is huge in size and yet growing exponentially with time.</li>
<li>Examples of Big Data generation includes stock exchanges, social media sites, jet engines, etc.</li>
<li>Big Data could be 1) Structured, 2) Unstructured, 3) Semi-structured</li>
<li>Volume, Variety, Velocity, and Variability are few Characteristics of Bigdata</li>
<li>Improved customer service, better operational efficiency, Better Decision Making are few advantages of Bigdata</li>
</ul>
<h2 id="Hadoop-EcoSystem-and-Components"><a href="#Hadoop-EcoSystem-and-Components" class="headerlink" title="Hadoop EcoSystem and Components"></a>Hadoop EcoSystem and Components</h2><p><img src="./img/061114_0803_LearnHadoop4.png"></p>
<h3 id="Hadoop-Architecture"><a href="#Hadoop-Architecture" class="headerlink" title="Hadoop Architecture"></a>Hadoop Architecture</h3><p><img src="./img/hadoop-architecture.png"></p>
<h4 id="HDFS-Architecture"><a href="#HDFS-Architecture" class="headerlink" title="HDFS Architecture"></a>HDFS Architecture</h4><p>HDFS cluster primarily consists of a <strong>NameNode</strong> that manages the file system <strong>Metadata</strong> and a <strong>DataNodes</strong> that stores the <strong>actual data</strong>.</p>
<ul>
<li><p>Read Operation In HDFS</p>
<p><img src="./img/061114_0923_LearnHDFSAB1.png"></p>
</li>
<li><p>Write Operation In HDFS</p>
<p><img src="./img/061114_0923_LearnHDFSAB2.png"></p>
</li>
</ul>
<h4 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h4><p>The whole process goes through four phases of execution namely, splitting, mapping, shuffling, and reducing.</p>
<p><img src="./img/061114_0930_Introductio1.png"></p>
<ol>
<li><strong>Jobtracker</strong>: Acts like a <strong>master</strong> (responsible for complete execution of submitted job)</li>
<li><strong>Multiple Task Trackers</strong>: Acts like <strong>slaves,</strong> each of them performing the job</li>
</ol>
<p><img src="./img/061114_0930_Introductio2.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/20/vmware/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="brook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="source is the essence">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/20/vmware/" class="post-title-link" itemprop="url">vmware snippet</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-20 16:15:30" itemprop="dateCreated datePublished" datetime="2019-04-20T16:15:30+08:00">2019-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-07-24 17:34:53" itemprop="dateModified" datetime="2019-07-24T17:34:53+08:00">2019-07-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vmware/" itemprop="url" rel="index"><span itemprop="name">vmware</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><ul>
<li><p>新增用户</p>
<p><code>adduser username</code></p>
<p><code>passwd username</code></p>
<p><code>usermod -aG wheel username</code></p>
<p><code>su - username</code></p>
</li>
</ul>
<h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3><ul>
<li><p>安装完毕之后，需要设置IP分配</p>
<ol>
<li><p><code>cd /etc/sysconfig/network-scripts/</code></p>
</li>
<li><p>再进入编辑<code>ifcfg-e**</code> 文件 执行命令<br><code>vi ifcfg-e**</code></p>
</li>
<li><p>修改ONBOOT项</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">其中部分内容如下： </span><br><span class="line">DEVICE=eth0 #设备名称，可根据ifcofnig命令查看到。 </span><br><span class="line">BOOTPROTO=dhcp #连接方式，dhcp会自动分配地址，此时不需要在下面设置ip和网关 </span><br><span class="line">ONBOOT=yes #yes表示启动就执行该配置，需要改为yes</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>修改完后需要重启网络设置，执行</p>
<p><code>service network restart</code></p>
</li>
</ol>
</li>
<li><p>设置静态IP</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/clevercode/article/details/50574695">虚拟机设置</a></p>
</li>
<li><p>宿主机器设置</p>
<p>需要设置vmnet8的ip为同一网段的配置</p>
</li>
</ul>
</li>
</ul>
<h3 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h3><ul>
<li><p>安装jdk</p>
<p><code>sudo yum install java-1.8.0-openjdk-devel</code></p>
<ul>
<li>find path</li>
</ul>
<p><code>update-alternatives --config java</code></p>
<ul>
<li>config .bashrc</li>
</ul>
<p><code>export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.191.b12-1.el7_6.x86_64/jre</code></p>
</li>
</ul>
<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><ul>
<li><p>授权所有机器可以从外界访问mysql</p>
<p><code>GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;will&#39;;</code></p>
<p><code>FLUSH PRIVILEGES;</code></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">brook</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">135</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">brook</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


</body>
</html>
