<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>github snippet</title>
      <link href="/2025/10/22/github/"/>
      <url>/2025/10/22/github/</url>
      
        <content type="html"><![CDATA[<h1 id="github-cli"><a href="#github-cli" class="headerlink" title="github cli"></a>github cli</h1><p><strong>install</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> centos/rocky</span></span><br><span class="line">sudo dnf install &#x27;dnf-command(config-manager)&#x27;</span><br><span class="line">sudo dnf config-manager --add-repo https://cli.github.com/packages/rpm/gh-cli.repo</span><br><span class="line">sudo dnf install gh --repo gh-cli</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ubuntu</span></span><br><span class="line">sudo apt install gh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ– ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œå®‰è£…</span></span><br><span class="line">https://github.com/cli/cli/releases</span><br></pre></td></tr></table></figure><p><strong>security</strong></p><ul><li><p>create/check gh_token</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> githubç½‘ç«™è®¾ç½®</span></span><br><span class="line">settings/Developer Settings/Personal access tokens (classic)</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>senario</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> senario 1 åœ¨git pushçš„æ—¶å€™ï¼Œè¾“å…¥passwordçš„æ—¶å€™ï¼Œç›´æ¥å¤åˆ¶ä¸Šé¢çš„tokenså³å¯</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> senario 2 åœ¨workflowä¸­ä½¿ç”¨</span></span><br><span class="line">gh secret set SECRET_NAME</span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line">gh secret set SECRET_NAME &lt; secret.txt</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>use</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> login</span></span><br><span class="line">gh auth login</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span></span></span><br><span class="line">gh secret set DOCKERHUB_USERNAME</span><br><span class="line">gh secret set DOCKERHUB_TOKEN </span><br><span class="line">gh secret set GH_TOKEN </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">gh secret list</span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th>Scenario</th><th>Secrets available?</th><th>Notes</th></tr></thead><tbody><tr><td>PR from fork triggers workflow (<code>pull_request</code> event)</td><td>No</td><td>Secrets are blocked for security. Causes your login error. (fork ä»“åº“çš„PRæ— æ³•ä¼ è¾“è‡ªå·±ä»“åº“è®¾ç½®çš„secretç»™è¿œç¨‹ä¸»ä»“åº“)</td></tr><tr><td>Workflow runs on push to original repo (after merge)</td><td>Yes</td><td>Full access to secrets, can push to Docker Hub.</td></tr><tr><td>Workflow runs in forked repo itself</td><td>Only forkâ€™s own secrets</td><td>Forkâ€™s secrets are independent, not shared with original repo.</td></tr></tbody></table><h1 id="workflow"><a href="#workflow" class="headerlink" title="workflow"></a>workflow</h1><blockquote><p>GitHub Actions is a continuous integration and continuous delivery (CI/CD) platform that allows you to automate your build, test, and deployment pipeline.</p></blockquote><ul><li><a href="https://docs.github.com/en/actions/using-github-hosted-runners/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources">runner host</a></li></ul><h2 id="runner-user"><a href="#runner-user" class="headerlink" title="runner user"></a><strong>runner</strong> user</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username: runner</span><br><span class="line">group: docker adm users systemd-journal</span><br><span class="line">Current directory: /home/runner/work/test-dingofs/test-dingofs</span><br></pre></td></tr></table></figure><h2 id="home"><a href="#home" class="headerlink" title="home"></a>home</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æƒ…å†µä¸€</span></span><br><span class="line">runs-on: ubuntu-latest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash">HOME=/home/runner/work/&lt;projectName&gt;/&lt;projectName&gt;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æƒ…å†µäºŒ</span></span><br><span class="line">runs-on: ubuntu-latest</span><br><span class="line">container: dingodatabase/dingo-eureka:rocky9</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash">HOME=/__w/&lt;projectName&gt;/&lt;projectName&gt;</span></span><br></pre></td></tr></table></figure><h2 id="disk-usage"><a href="#disk-usage" class="headerlink" title="disk usage"></a>disk usage</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æƒ…å†µä¸€ï¼š<span class="keyword">in</span> virtual host</span></span><br><span class="line">runs-on: ubuntu-latest</span><br><span class="line"></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/root        72G   47G   26G  65% /</span><br><span class="line">tmpfs           3.9G   84K  3.9G   1% /dev/shm</span><br><span class="line">tmpfs           1.6G  1.1M  1.6G   1% /run</span><br><span class="line">tmpfs           5.0M     0  5.0M   0% /run/lock</span><br><span class="line">/dev/sda16      881M   59M  761M   8% /boot</span><br><span class="line">/dev/sda15      105M  6.1M   99M   6% /boot/efi</span><br><span class="line">tmpfs           794M   12K  794M   1% /run/user/1001</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æƒ…å†µäºŒï¼šinit container</span> </span><br><span class="line">runs-on: ubuntu-latest</span><br><span class="line">container: dingodatabase/dingo-eureka:rocky9</span><br><span class="line"></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/root        72G   48G   25G  66% /</span><br><span class="line">tmpfs           7.9G   84K  7.9G   1% /dev/shm</span><br><span class="line">tmpfs           3.2G  1.1M  3.2G   1% /run</span><br><span class="line">tmpfs           5.0M     0  5.0M   0% /run/lock</span><br><span class="line">/dev/sda16      881M   60M  760M   8% /boot</span><br><span class="line">/dev/sda15      105M  6.2M   99M   6% /boot/efi</span><br><span class="line">/dev/sdb1        74G  4.1G   66G   6% /mnt  # ğŸš¨ new mount point</span><br><span class="line">tmpfs           1.6G   12K  1.6G   1% /run/user/1001</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># change data root directory</span></span></span><br><span class="line">    - name: Configure Docker data-root</span><br><span class="line">      run: |</span><br><span class="line">        sudo systemctl stop docker</span><br><span class="line">        sudo systemctl stop docker.socket</span><br><span class="line">        sudo mkdir -p /mnt/docker</span><br><span class="line">        echo &#x27;&#123; &quot;data-root&quot;: &quot;/mnt/docker&quot; &#125;&#x27; | sudo tee /etc/docker/daemon.json</span><br><span class="line">        if [ -d /var/lib/docker ]; then</span><br><span class="line">          sudo mv /var/lib/docker /mnt/docker || true</span><br><span class="line">        fi</span><br><span class="line">        sudo systemctl start docker.socket</span><br><span class="line">        sudo systemctl start docker</span><br><span class="line">        docker info | grep &quot;Docker Root Dir&quot;</span><br><span class="line">        echo &quot;check /mnt/docker/&quot;</span><br><span class="line">        sudo ls -la /mnt/docker</span><br></pre></td></tr></table></figure><h2 id="event"><a href="#event" class="headerlink" title="event"></a>event</h2><h2 id="env"><a href="#env" class="headerlink" title="env"></a>env</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GITHUB_OUTPUT</span><br><span class="line">GITHUB_STATE</span><br><span class="line">GITHUB_ENV</span><br></pre></td></tr></table></figure><p><a href="https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/passing-information-between-jobs">Passing information between jobs</a></p><h2 id="action"><a href="#action" class="headerlink" title="action"></a>action</h2><ul><li><strong>docker/metadata-action</strong></li></ul><blockquote><p>åˆ¶ä½œé•œåƒtag</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Docker</span> <span class="string">meta</span></span><br><span class="line">      <span class="attr">if:</span> <span class="string">steps.check-event.outputs.continue</span> <span class="string">==</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">meta</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">docker/metadata-action@v5</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">images:</span> <span class="string">dingodatabase/dingofs</span></span><br><span class="line">        <span class="attr">tags:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          type=raw,enable=$&#123;&#123; env.EVENT == &#x27;tag&#x27; &#125;&#125;,value=$&#123;&#123; env.TAG_NAME &#125;&#125;</span></span><br><span class="line"><span class="string">          type=raw,value=latest,enable=&#123;&#123;is_default_branch&#125;&#125;</span></span><br><span class="line"><span class="string">          type=sha,prefix=,format=long</span></span><br><span class="line"><span class="string"></span><span class="string">ä»¥ä¸Šé…ç½®ä¼šè¿›è¡Œ</span></span><br><span class="line"><span class="number">1</span><span class="string">.å¦‚æœæ˜¯push</span> <span class="string">tag</span> <span class="string">eventï¼Œè¿›è¡Œæ¨é€</span> <span class="string">tag</span> <span class="string">é•œåƒ</span></span><br><span class="line"><span class="number">2</span><span class="string">.ä¸€ç›´ä¼šæ¨é€</span> <span class="string">latest</span> <span class="string">é•œåƒ</span></span><br><span class="line"><span class="number">3</span><span class="string">.ä¸€ç›´ä¼šæ¨é€commitIdé•œåƒ</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¿®æ”¹å†…å®¹ä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        <span class="attr">tags:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          type=raw,enable=$&#123;&#123; env.EVENT == &#x27;tag&#x27; &#125;&#125;,value=$&#123;&#123; env.TAG_NAME &#125;&#125;</span></span><br><span class="line"><span class="string">          type=raw,value=latest,enable=$&#123;&#123;github.ref == &#x27;refs/heads/main&#x27; &amp;&amp; env.EVENT != &#x27;tag&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string">          type=sha,prefix=,format=long,enable=$&#123;&#123;env.EVENT != &#x27;tag&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span><span class="string">ä»¥ä¸Šé…ç½®ä¼šè¿›è¡Œ</span></span><br><span class="line"><span class="number">1</span><span class="string">.å¦‚æœæ˜¯</span> <span class="string">push</span> <span class="string">tag</span> <span class="string">eventï¼Œè¿›è¡Œæ¨é€</span> <span class="string">tag</span> <span class="string">é•œåƒ</span></span><br><span class="line"><span class="number">2</span><span class="string">.å¦‚æœæ˜¯mainåˆ†æ”¯ï¼Œå¹¶ä¸”étag</span> <span class="string">eventï¼Œæ‰ä¼šæ¨é€</span> <span class="string">latest</span> <span class="string">é•œåƒ</span></span><br><span class="line"><span class="number">3</span><span class="string">.étag</span> <span class="string">eventæ‰ä¼šæ¨é€commitIdé•œåƒ</span></span><br></pre></td></tr></table></figure><p>é€‚é…mainå’Œå…¶ä»–åˆ†æ”¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tags:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  type=raw,enable=$&#123;&#123; env.EVENT == &#x27;tag&#x27; &#125;&#125;,value=$&#123;&#123; env.TAG_NAME &#125;&#125;</span></span><br><span class="line"><span class="string">  type=raw,value=latest,enable=$&#123;&#123; env.BRANCH_NAME == &#x27;main&#x27; &amp;&amp; env.EVENT != &#x27;tag&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string">  type=sha,prefix=,format=short,enable=$&#123;&#123; env.EVENT != &#x27;tag&#x27; &amp;&amp; env.BRANCH_NAME == &#x27;main&#x27; &#125;&#125;</span></span><br><span class="line"><span class="string">  type=sha,prefix=$&#123;&#123; env.BRANCH_NAME &#125;&#125;-,format=short,enable=$&#123;&#123; env.EVENT != &#x27;tag&#x27; &amp;&amp; env.BRANCH_NAME != &#x27;main&#x27; &#125;&#125;</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>softprops/action-gh-release@v2</strong></p><p>é™åˆ¶æœ€å¤§ä¸Šä¼ 2Gæ–‡ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;resource&quot;:&quot;ReleaseAsset&quot;,&quot;code&quot;:&quot;custom&quot;,&quot;field&quot;:&quot;size&quot;,&quot;message&quot;:&quot;size must be less than or equal to 2147483648&quot;&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="best-practices"><a href="#best-practices" class="headerlink" title="best practices"></a>best practices</h1><h2 id="https"><a href="#https" class="headerlink" title="https"></a>https</h2><ul><li>ä½¿ç”¨ https åè®®æ‹‰å–é¡¹ç›®ä»£ç </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git config credential.helper cache</span><br><span class="line">git config credential.helper store</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> global (optional)</span></span><br><span class="line">git config --global credential.helper cache</span><br><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure><h2 id="ISSUES"><a href="#ISSUES" class="headerlink" title="ISSUES"></a>ISSUES</h2><ul><li>search</li></ul><p><code>searchKeyWord is:issue is:closed repo:Alamofire/Alamofire</code>Â </p><p>è¿™æ¡æœç´¢ï¼ŒsearchKeyWordæ˜¯æœç´¢å…³é”®å­—,Â <code>is:issue</code>Â è¡¨ç¤ºæˆ‘ä»¬è¦æœç´¢ issueï¼ŒÂ <code>is:closed</code>Â è¡¨ç¤ºå·²ç»å…³é—­çš„ issueï¼ŒÂ <code>repo:Alamofire/Alamofire</code>Â è¡¨ç¤ºæˆ‘ä»¬åªæœç´¢è¿™ä¸ªä»“åº“èŒƒå›´çš„ issue</p>]]></content>
      
      
      <categories>
          
          <category> github </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ci </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cmake learn</title>
      <link href="/2025/06/17/cmake%20learn/"/>
      <url>/2025/06/17/cmake%20learn/</url>
      
        <content type="html"><![CDATA[<h1 id="default"><a href="#default" class="headerlink" title="default"></a>default</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_CURRENT_SOURCE_DIR</span><br><span class="line">PROJECT_SOURCE_DIR</span><br></pre></td></tr></table></figure><p>**CMAKE_CURRENT_SOURCE_DIR **</p><p>The path to the source directory currently being processed.</p><p>This is the full path to the source directory that is currently being processed by cmake.</p><p><strong>PROJECT_SOURCE_DIR</strong></p><p>This is the source directory of the last call to the project() command made in the current directory scope or one of its parents. Note, it is not affected by calls to project() made within a child directory scope (i.e. from within a call to add_subdirectory()  from the current scope).</p><ul><li>When run in <a href="https://cmake.org/cmake/help/v3.31/manual/cmake.1.html#cmdoption-cmake-P"><code>cmake -P</code></a> script mode, CMake sets the variables <code>CMAKE_BINARY_DIR</code>, <code>CMAKE_SOURCE_DIR</code>, <code>CMAKE_CURRENT_BINARY_DIR</code> and <code>CMAKE_CURRENT_SOURCE_DIR</code> to the current working directory.</li></ul><h1 id="scope"><a href="#scope" class="headerlink" title="scope"></a>scope</h1><p><strong><code>PUBLIC</code></strong></p><p>Populates both properties for <a href="https://cmake.org/cmake/help/v3.31/manual/cmake-buildsystem.7.html#target-build-specification">building</a> and properties for <a href="https://cmake.org/cmake/help/v3.31/manual/cmake-buildsystem.7.html#target-usage-requirements">using</a> a target.</p><p><strong><code>PRIVATE</code></strong></p><p>Populates only properties for <a href="https://cmake.org/cmake/help/v3.31/manual/cmake-buildsystem.7.html#target-build-specification">building</a> a target.</p><p><strong><code>INTERFACE</code></strong></p><p>Populates only properties for <a href="https://cmake.org/cmake/help/v3.31/manual/cmake-buildsystem.7.html#target-usage-requirements">using</a> a target.</p><ul><li>Remember <code>INTERFACE</code> means things that consumers require but the producer doesnâ€™t.</li></ul><h1 id="syntax"><a href="#syntax" class="headerlink" title="syntax"></a>syntax</h1><h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>()</span><br><span class="line"><span class="keyword">cmake_minimum_required</span>()</span><br><span class="line"><span class="keyword">project</span>()</span><br></pre></td></tr></table></figure><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"><span class="keyword">project</span>(Tutorial VERSION <span class="number">2.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the variable</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tells CMake to create an executable using the specified source code files</span></span><br><span class="line"><span class="keyword">add_executable</span>(Tutorial tutorial.cxx)</span><br></pre></td></tr></table></figure><h3 id="configure-file"><a href="#configure-file" class="headerlink" title="configure_file"></a>configure_file</h3><blockquote><p>copy the input file with the specified CMake variables replaced</p></blockquote><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copies an &lt;input&gt; file to an &lt;output&gt; file </span></span><br><span class="line"><span class="keyword">configure_file</span>(&lt;input&gt; &lt;output&gt;)</span><br></pre></td></tr></table></figure><h3 id="target-include-directories"><a href="#target-include-directories" class="headerlink" title="target_include_directories"></a>target_include_directories</h3><blockquote><p>specify where the executable target should look for include files</p></blockquote><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(Tutorial PUBLIC <span class="string">&quot;$&#123;PROJECT_BINARY_DIR&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="Adding-a-Library"><a href="#Adding-a-Library" class="headerlink" title="Adding a Library"></a>Adding a Library</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>()</span><br><span class="line"><span class="keyword">add_subdirectory</span>()</span><br><span class="line"><span class="keyword">target_include_directories</span>()</span><br><span class="line"><span class="keyword">target_link_libraries</span>()</span><br></pre></td></tr></table></figure><h3 id="add-library"><a href="#add-library" class="headerlink" title="add_library"></a>add_library</h3><blockquote><p>Add a library target called <code>&lt;name&gt;</code> to be built from the source files listed in the command invocation</p></blockquote><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(MathFunctions MathFunctions.cxx mysqrt.cxx)</span><br></pre></td></tr></table></figure><h3 id="add-subdirectory"><a href="#add-subdirectory" class="headerlink" title="add_subdirectory"></a>add_subdirectory</h3><blockquote><p>make use of the new library call</p></blockquote><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(MathFunctions)</span><br></pre></td></tr></table></figure><h2 id="Adding-Usage-Requirements-for-a-Library"><a href="#Adding-Usage-Requirements-for-a-Library" class="headerlink" title="Adding Usage Requirements for a Library"></a>Adding Usage Requirements for a Library</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_compile_definitions</span>()</span><br><span class="line"><span class="keyword">target_compile_options</span>()</span><br><span class="line"><span class="keyword">target_include_directories</span>()</span><br><span class="line"><span class="keyword">target_link_directories</span>()</span><br><span class="line"><span class="keyword">target_link_options</span>()</span><br><span class="line">target_precompile_headers()</span><br><span class="line"><span class="keyword">target_sources</span>()</span><br><span class="line"><span class="keyword">add_library</span>()</span><br><span class="line"><span class="keyword">target_compile_features</span>()</span><br><span class="line"><span class="keyword">target_link_libraries</span>()</span><br></pre></td></tr></table></figure><h2 id="Adding-Generator-Expressions"><a href="#Adding-Generator-Expressions" class="headerlink" title="Adding Generator Expressions"></a>Adding Generator Expressions</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cmake-generator-expressions(<span class="number">7</span>)</span><br><span class="line"><span class="keyword">cmake_minimum_required</span>()</span><br><span class="line"><span class="keyword">set</span>()</span><br><span class="line"><span class="keyword">target_compile_options</span>()</span><br></pre></td></tr></table></figure><h2 id="Installing-and-Testing"><a href="#Installing-and-Testing" class="headerlink" title="Installing and Testing"></a>Installing and Testing</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>()</span><br></pre></td></tr></table></figure><h2 id="Adding-System-Introspection"><a href="#Adding-System-Introspection" class="headerlink" title="Adding System Introspection"></a>Adding System Introspection</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Packaging-an-Installer"><a href="#Packaging-an-Installer" class="headerlink" title="Packaging an Installer"></a>Packaging an Installer</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpack</span><br></pre></td></tr></table></figure><h2 id="Selecting-Static-or-Shared-Libraries"><a href="#Selecting-Static-or-Shared-Libraries" class="headerlink" title="Selecting Static or Shared Libraries"></a>Selecting Static or Shared Libraries</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">option</span>(BUILD_SHARED_LIBS <span class="string">&quot;Build using shared libraries&quot;</span> <span class="keyword">ON</span>)</span><br></pre></td></tr></table></figure><h2 id="Adding-Export-Configuration"><a href="#Adding-Export-Configuration" class="headerlink" title="Adding Export Configuration"></a>Adding Export Configuration</h2>]]></content>
      
      
      <categories>
          
          <category> cmake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>c++ summary</title>
      <link href="/2025/06/07/c++%20summary/"/>
      <url>/2025/06/07/c++%20summary/</url>
      
        <content type="html"><![CDATA[<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><p>C++ é‡Œç±»çš„å››å¤§å‡½æ•°ï¼šæ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼å‡½æ•°ã€‚C++11 å› ä¸ºå¼•å…¥äº†å³å€¼ï¼ˆRvalueï¼‰å’Œè½¬ç§»ï¼ˆMoveï¼‰ï¼Œåˆå¤šå‡ºäº†ä¸¤å¤§å‡½æ•°ï¼šè½¬ç§»æ„é€ å‡½æ•°å’Œè½¬ç§»èµ‹å€¼å‡½æ•°ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ç°ä»£ C++ é‡Œï¼Œä¸€ä¸ªç±»æ€»æ˜¯ä¼šæœ‰å…­å¤§åŸºæœ¬å‡½æ•°ï¼šä¸‰ä¸ªæ„é€ ã€ä¸¤ä¸ªèµ‹å€¼ã€ä¸€ä¸ªææ„ã€‚</p><ul><li>åœ¨ C/C++ é‡Œï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯å…¨å±€çš„ï¼Œæ²¡æœ‰ç”Ÿå­˜å‘¨æœŸçš„æ¦‚å¿µï¼ˆstaticã€åå­—ç©ºé—´çš„ä½œç”¨å¾ˆå¼±ï¼Œåªæ˜¯ç®€å•é™åˆ¶äº†åº”ç”¨èŒƒå›´ï¼Œé¿å…åå­—å†²çªï¼‰ã€‚è€Œä¸”å‡½æ•°ä¹Ÿéƒ½æ˜¯å¹³çº§çš„ï¼Œä¸èƒ½åœ¨å‡½æ•°é‡Œå†å®šä¹‰å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸å®šä¹‰åµŒå¥—å‡½æ•°ã€å‡½æ•°å¥—å‡½æ•°ã€‚</li></ul><h2 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h2><h3 id="skill"><a href="#skill" class="headerlink" title="skill"></a>skill</h3><h4 id="â€œå§”æ‰˜æ„é€ â€ï¼ˆdelegating-constructorï¼‰"><a href="#â€œå§”æ‰˜æ„é€ â€ï¼ˆdelegating-constructorï¼‰" class="headerlink" title="â€œå§”æ‰˜æ„é€ â€ï¼ˆdelegating constructorï¼‰"></a>â€œå§”æ‰˜æ„é€ â€ï¼ˆdelegating constructorï¼‰</h4><blockquote><p>ä½¿ç”¨â€œå§”æ‰˜æ„é€ â€çš„æ–°ç‰¹æ€§ï¼Œä¸€ä¸ªæ„é€ å‡½æ•°ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ŒæŠŠæ„é€ å·¥ä½œâ€œå§”æ‰˜â€å‡ºå»ï¼Œæ—¢ç®€å•åˆé«˜æ•ˆã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoDelegating</span> <span class="keyword">final</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> a; <span class="comment">// æˆå‘˜å˜é‡</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DemoDelegating</span>(<span class="keyword">int</span> x) : <span class="built_in">a</span>(x) <span class="comment">// åŸºæœ¬çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">DemoDelegating</span>() : <span class="comment">// æ— å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">DemoDelegating</span>(<span class="number">0</span>) <span class="comment">// ç»™å‡ºé»˜è®¤å€¼ï¼Œå§”æ‰˜ç»™ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°</span></span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">DemoDelegating</span>(<span class="keyword">const</span> string&amp; s) : <span class="comment">// å­—ç¬¦ä¸²å‚æ•°æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">DemoDelegating</span>(<span class="built_in">stoi</span>(s)) <span class="comment">// è½¬æ¢æˆæ•´æ•°ï¼Œå†å§”æ‰˜ç»™ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°</span></span><br><span class="line">    &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="â€œæˆå‘˜å˜é‡åˆå§‹åŒ–â€ï¼ˆIn-class-member-initializerï¼‰"><a href="#â€œæˆå‘˜å˜é‡åˆå§‹åŒ–â€ï¼ˆIn-class-member-initializerï¼‰" class="headerlink" title="â€œæˆå‘˜å˜é‡åˆå§‹åŒ–â€ï¼ˆIn-class member initializerï¼‰"></a>â€œæˆå‘˜å˜é‡åˆå§‹åŒ–â€ï¼ˆIn-class member initializerï¼‰</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoInit</span> <span class="keyword">final</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>                 a = <span class="number">0</span>;</span><br><span class="line">    std::string         s = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    std::vector&lt;<span class="keyword">int</span>&gt;    v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DemoInit</span>() = <span class="keyword">default</span>;</span><br><span class="line">   ~<span class="built_in">DemoInit</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DemoInit</span>(<span class="keyword">int</span> x) : <span class="built_in">a</span>(x) &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="â€œç±»å‹åˆ«åâ€ï¼ˆType-Aliasï¼‰"><a href="#â€œç±»å‹åˆ«åâ€ï¼ˆType-Aliasï¼‰" class="headerlink" title="â€œç±»å‹åˆ«åâ€ï¼ˆType Aliasï¼‰"></a>â€œç±»å‹åˆ«åâ€ï¼ˆType Aliasï¼‰</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">uint_t</span> = <span class="keyword">unsigned</span> <span class="keyword">int</span>; <span class="comment">// usingåˆ«å</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="keyword">uint_t</span>ï¼› <span class="comment">// ç­‰ä»·çš„typedef</span></span><br></pre></td></tr></table></figure><h2 id="lambda"><a href="#lambda" class="headerlink" title="lambda"></a>lambda</h2><blockquote><p>C++ æ²¡æœ‰ä¸º lambda è¡¨è¾¾å¼å¼•å…¥æ–°çš„å…³é”®å­—ï¼Œå¹¶æ²¡æœ‰â€œlambdaâ€è¿™æ ·çš„è¯æ±‡ï¼Œè€Œæ˜¯ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„å½¢å¼â€œ[]â€ï¼Œæœ¯è¯­å«â€œlambda å¼•å‡ºç¬¦â€ï¼ˆlambda introducerï¼‰ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> lambda è¡¨è¾¾å¼ç¤ºä¾‹</span></span><br><span class="line">auto f1 = [](&lt;å…¥å£å‚æ•°&gt;)&#123;å‡½æ•°ä½“&#125;; </span><br></pre></td></tr></table></figure><ul><li>lambdaè¡¨è¾¾å¼èµ‹å€¼å¿…é¡»ç”¨autoï¼ˆä½†autoä¸èƒ½ç”¨åœ¨ç±»æˆå‘˜åˆå§‹åŒ–ï¼‰</li><li>lambda è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œèƒ½å¤Ÿåƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ï¼Œåƒå˜é‡ä¸€æ ·è¢«ä¼ é€’</li><li>æ•è·å¼•ç”¨æ—¶å¿…é¡»è¦æ³¨æ„å¤–éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œé˜²æ­¢å˜é‡å¤±æ•ˆ</li></ul><p><strong>å˜é‡æ•è·</strong></p><ul><li><code>[=]</code>è¡¨ç¤ºæŒ‰å€¼æ•è·æ‰€æœ‰å¤–éƒ¨å˜é‡ï¼Œè¡¨è¾¾å¼å†…éƒ¨æ˜¯å€¼çš„æ‹·è´ï¼Œå¹¶ä¸”ä¸èƒ½ä¿®æ”¹</li><li><code>[&amp;]</code>æ˜¯æŒ‰å¼•ç”¨æ•è·æ‰€æœ‰å¤–éƒ¨å˜é‡ï¼Œå†…éƒ¨ä»¥å¼•ç”¨çš„æ–¹å¼ä½¿ç”¨ï¼Œå¯ä»¥ä¿®æ”¹</li></ul><h1 id="æ™ºèƒ½æŒ‡é’ˆ"><a href="#æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆ"></a>æ™ºèƒ½æŒ‡é’ˆ</h1><blockquote><p>å°½é‡ä¸è¦å†ä½¿ç”¨è£¸æŒ‡é’ˆã€new å’Œ delete æ¥æ“ä½œå†…å­˜</p></blockquote><h2 id="unique-ptr"><a href="#unique-ptr" class="headerlink" title="unique_ptr"></a>unique_ptr</h2><ul><li>å°½é‡ä¸è¦å¯¹ unique_ptr æ‰§è¡Œèµ‹å€¼æ“ä½œå°±å¥½äº†ï¼Œè®©å®ƒâ€œè‡ªç”Ÿè‡ªç­â€ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–ç®¡ç†ã€‚</li></ul><h2 id="shared-ptr"><a href="#shared-ptr" class="headerlink" title="shared_ptr"></a>shared_ptr</h2><ul><li>shared_ptr æ”¯æŒå®‰å…¨å…±äº«çš„ç§˜å¯†åœ¨äºå†…éƒ¨ä½¿ç”¨äº†â€œå¼•ç”¨è®¡æ•°â€</li><li>å› ä¸º shared_ptr å…·æœ‰å®Œæ•´çš„â€œå€¼è¯­ä¹‰â€ï¼ˆå³å¯ä»¥æ‹·è´èµ‹å€¼ï¼‰ï¼Œæ‰€ä»¥ï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•åœºåˆæ›¿ä»£åŸå§‹æŒ‡é’ˆï¼Œè€Œä¸ç”¨å†æ‹…å¿ƒèµ„æºå›æ”¶çš„é—®é¢˜ï¼Œæ¯”å¦‚ç”¨äºå®¹å™¨å­˜å‚¨æŒ‡é’ˆã€ç”¨äºå‡½æ•°å®‰å…¨è¿”å›åŠ¨æ€åˆ›å»ºçš„å¯¹è±¡ï¼Œç­‰ç­‰</li></ul><h1 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h1><ul><li>å®¹å™¨éƒ½å…·æœ‰çš„ä¸€ä¸ªåŸºæœ¬ç‰¹æ€§ï¼šå®ƒä¿å­˜å…ƒç´ é‡‡ç”¨çš„æ˜¯â€œå€¼â€ï¼ˆvalueï¼‰è¯­ä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨é‡Œå­˜å‚¨çš„æ˜¯å…ƒç´ çš„æ‹·è´ã€å‰¯æœ¬ï¼Œè€Œä¸æ˜¯å¼•ç”¨ã€‚ä»è¿™ä¸ªåŸºæœ¬ç‰¹æ€§å¯ä»¥å¾—å‡ºä¸€ä¸ªæ¨è®ºï¼Œå®¹å™¨æ“ä½œå…ƒç´ çš„å¾ˆå¤§ä¸€å—æˆæœ¬å°±æ˜¯å€¼çš„æ‹·è´ã€‚æ‰€ä»¥ï¼Œå¦‚æœå…ƒç´ æ¯”è¾ƒå¤§ï¼Œæˆ–è€…éå¸¸å¤šï¼Œé‚£ä¹ˆæ“ä½œæ—¶çš„æ‹·è´å¼€é”€å°±ä¼šå¾ˆé«˜ï¼Œæ€§èƒ½ä¹Ÿå°±ä¸ä¼šå¤ªå¥½ã€‚</li><li>å°½é‡ä¸ºå…ƒç´ å®ç°è½¬ç§»æ„é€ å’Œè½¬ç§»èµ‹å€¼å‡½æ•°</li><li>ä¾æ®å…ƒç´ çš„è®¿é—®æ–¹å¼ï¼Œåˆ†æˆé¡ºåºå®¹å™¨ã€æœ‰åºå®¹å™¨å’Œæ— åºå®¹å™¨ä¸‰å¤§ç±»åˆ«</li></ul><h2 id="é¡ºåºå®¹å™¨"><a href="#é¡ºåºå®¹å™¨" class="headerlink" title="é¡ºåºå®¹å™¨"></a>é¡ºåºå®¹å™¨</h2><img src="/images/c++/c++-container.jpeg" style="zoom: 50%"><p>é¡ºåºå®¹å™¨å°±æ˜¯æ•°æ®ç»“æ„é‡Œçš„çº¿æ€§è¡¨ï¼Œä¸€å…±æœ‰ 5 ç§ï¼š<code>array</code>ã€<code>vector</code>ã€<code>deque</code>ã€<code>list</code>ã€<code>forward_list</code>ï¼ŒæŒ‰ç…§å­˜å‚¨ç»“æ„ï¼Œè¿™ 5 ç§å®¹å™¨åˆå¯ä»¥å†ç»†åˆ†æˆä¸¤ç»„ã€‚</p><p>è¿ç»­å­˜å‚¨çš„æ•°ç»„ï¼š<code>array</code>ã€<code>vector</code> å’Œ <code>deque</code>ã€‚</p><p>æŒ‡é’ˆç»“æ„çš„é“¾è¡¨ï¼š<code>list</code> å’Œ <code>forward_list</code>ã€‚</p><ul><li><p><code>array</code> å’Œ <code>vector</code> ç›´æ¥å¯¹åº” C çš„å†…ç½®æ•°ç»„ï¼Œå†…å­˜å¸ƒå±€ä¸ C å®Œå…¨å…¼å®¹ï¼Œæ‰€ä»¥æ˜¯å¼€é”€æœ€ä½ã€é€Ÿåº¦æœ€å¿«çš„å®¹å™¨ã€‚å®ƒä»¬ä¸¤ä¸ªçš„åŒºåˆ«åœ¨äºå®¹é‡èƒ½å¦åŠ¨æ€å¢é•¿ã€‚array æ˜¯é™æ€æ•°ç»„ï¼Œå¤§å°åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±å›ºå®šäº†ï¼Œä¸èƒ½å†å®¹çº³æ›´å¤šçš„å…ƒç´ ã€‚è€Œ vector æ˜¯åŠ¨æ€æ•°ç»„ï¼Œè™½ç„¶åˆå§‹åŒ–çš„æ—¶å€™è®¾å®šäº†å¤§å°ï¼Œä½†å¯ä»¥åœ¨åé¢éšéœ€å¢é•¿ï¼Œå®¹çº³ä»»æ„æ•°é‡çš„å…ƒç´ ã€‚</p></li><li><p><code>deque</code> ä¹Ÿæ˜¯ä¸€ç§å¯ä»¥åŠ¨æ€å¢é•¿çš„æ•°ç»„ï¼Œå®ƒå’Œ<code>vector</code> çš„åŒºåˆ«æ˜¯ï¼Œå®ƒå¯ä»¥åœ¨ä¸¤ç«¯é«˜æ•ˆåœ°æ’å…¥åˆ é™¤å…ƒç´ ï¼Œè¿™ä¹Ÿæ˜¯å®ƒçš„åå­— double-end queue çš„æ¥å†ï¼Œè€Œ <code>vector</code> åˆ™åªèƒ½ç”¨ push_back åœ¨æœ«ç«¯è¿½åŠ å…ƒç´ ã€‚</p></li><li><p><code>vector</code> å’Œ <code>deque</code> é‡Œçš„å…ƒç´ å› ä¸ºæ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œæ‰€ä»¥åœ¨ä¸­é—´çš„æ’å…¥åˆ é™¤æ•ˆç‡å°±å¾ˆä½ï¼Œè€Œ <code>list</code>å’Œ <code>forward_list</code> æ˜¯é“¾è¡¨ç»“æ„ï¼Œæ’å…¥åˆ é™¤æ“ä½œåªéœ€è¦è°ƒæ•´æŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨ä»»æ„ä½ç½®çš„æ“ä½œéƒ½å¾ˆé«˜æ•ˆã€‚</p></li><li><p>é“¾è¡¨çš„ç¼ºç‚¹æ˜¯æŸ¥æ‰¾æ•ˆç‡ä½ï¼Œåªèƒ½æ²¿ç€æŒ‡é’ˆé¡ºåºè®¿é—®ï¼Œè¿™æ–¹é¢ä¸å¦‚ <code>vector</code> éšæœºè®¿é—®çš„æ•ˆç‡é«˜ã€‚<code>list</code> æ˜¯åŒå‘é“¾è¡¨ï¼Œå¯ä»¥å‘å‰æˆ–è€…å‘åéå†ï¼Œè€Œ <code>forward_list</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯å•å‘é“¾è¡¨ï¼Œåªèƒ½å‘å‰éå†ï¼ŒæŸ¥æ‰¾æ•ˆç‡å°±æ›´ä½äº†</p></li><li><p>é“¾è¡¨ç»“æ„æ¯”èµ·æ•°ç»„ç»“æ„è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å­˜å‚¨æˆæœ¬ç•¥é«˜ï¼Œå› ä¸ºå¿…é¡»è¦ä¸ºæ¯ä¸ªå…ƒç´ é™„åŠ ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªçš„æŒ‡é’ˆï¼ŒæŒ‡å‘é“¾è¡¨çš„å‰åèŠ‚ç‚¹ã€‚</p></li><li><p>å½“ <code>vector</code> çš„å®¹é‡åˆ°è¾¾ä¸Šé™çš„æ—¶å€™ï¼ˆcapacityï¼‰ï¼Œå®ƒä¼šå†åˆ†é…ä¸€å—ä¸¤å€å¤§å°çš„æ–°å†…å­˜ï¼Œç„¶åæŠŠæ—§å…ƒç´ æ‹·è´æˆ–è€…ç§»åŠ¨è¿‡å»ã€‚è¿™ä¸ªæ“ä½œçš„æˆæœ¬æ˜¯éå¸¸å¤§çš„ï¼Œæ‰€ä»¥ï¼Œä½ åœ¨ä½¿ç”¨ <code>vector</code> çš„æ—¶å€™æœ€å¥½èƒ½å¤Ÿâ€œé¢„ä¼°â€å®¹é‡ï¼Œä½¿ç”¨ reserve æå‰åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ï¼Œå‡å°‘åŠ¨æ€æ‰©å®¹çš„æ‹·è´ä»£ä»·ã€‚</p></li><li><p><code>vector</code> çš„åšæ³•å¤ªâ€œæ¿€è¿›â€ï¼Œè€Œ <code>deque</code>ã€<code>list</code> çš„çš„æ‰©å®¹ç­–ç•¥å°±â€œä¿å®ˆâ€å¤šäº†ï¼Œåªä¼šæŒ‰ç…§å›ºå®šçš„â€œæ­¥é•¿â€ï¼ˆä¾‹å¦‚ N ä¸ªå­—èŠ‚ã€ä¸€ä¸ªèŠ‚ç‚¹ï¼‰å»å¢åŠ å®¹é‡ã€‚ä½†åœ¨çŸ­æ—¶é—´å†…æ’å…¥å¤§é‡æ•°æ®çš„æ—¶å€™å°±ä¼šé¢‘ç¹åˆ†é…å†…å­˜ï¼Œæ•ˆæœåè€Œä¸å¦‚ <code>vector</code> ä¸€æ¬¡åˆ†é…æ¥å¾—å¥½ã€‚</p></li></ul><h2 id="æœ‰åºå®¹å™¨"><a href="#æœ‰åºå®¹å™¨" class="headerlink" title="æœ‰åºå®¹å™¨"></a>æœ‰åºå®¹å™¨</h2><p>é¡ºåºå®¹å™¨çš„ç‰¹ç‚¹æ˜¯ï¼Œå…ƒç´ çš„æ¬¡åºæ˜¯ç”±å®ƒæ’å…¥çš„æ¬¡åºè€Œå†³å®šçš„ï¼Œè®¿é—®å…ƒç´ ä¹Ÿå°±æŒ‰ç…§æœ€åˆæ’å…¥çš„é¡ºåºã€‚è€Œæœ‰åºå®¹å™¨åˆ™ä¸åŒï¼Œå®ƒçš„å…ƒç´ åœ¨æ’å…¥å®¹å™¨åå°±è¢«æŒ‰ç…§æŸç§è§„åˆ™è‡ªåŠ¨æ’åºï¼Œæ‰€ä»¥æ˜¯â€œæœ‰åºâ€çš„ã€‚C++ çš„æœ‰åºå®¹å™¨ä½¿ç”¨çš„æ˜¯æ ‘ç»“æ„ï¼Œé€šå¸¸æ˜¯çº¢é»‘æ ‘â€”â€”æœ‰ç€æœ€å¥½æŸ¥æ‰¾æ€§èƒ½çš„äºŒå‰æ ‘ã€‚</p><p>æ ‡å‡†åº“é‡Œä¸€å…±æœ‰å››ç§æœ‰åºå®¹å™¨ï¼š<code>set/multiset</code> å’Œ <code>map/multimap</code>ã€‚<code>set</code> æ˜¯é›†åˆï¼Œ<code>map</code> æ˜¯å…³è”æ•°ç»„ï¼ˆåœ¨å…¶ä»–è¯­è¨€é‡Œä¹Ÿå«â€œå­—å…¸â€ï¼‰ï¼Œæœ‰ multi å‰ç¼€çš„å®¹å™¨è¡¨ç¤ºå¯ä»¥å®¹çº³é‡å¤çš„ keyã€‚</p><h2 id="æ— åºå®¹å™¨"><a href="#æ— åºå®¹å™¨" class="headerlink" title="æ— åºå®¹å™¨"></a>æ— åºå®¹å™¨</h2><p>åˆ†åˆ«æ˜¯ <code>unordered_set/unordered_multiset</code>ã€<code>unordered_map/unordered_multimap</code>ã€‚æ— åºå®¹å™¨åŒæ ·ä¹Ÿæ˜¯é›†åˆå’Œå…³è”æ•°ç»„ï¼Œç”¨æ³•ä¸Šä¸æœ‰åºå®¹å™¨å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºå†…éƒ¨æ•°æ®ç»“æ„ï¼šå®ƒä¸æ˜¯çº¢é»‘æ ‘ï¼Œè€Œæ˜¯æ•£åˆ—è¡¨ï¼ˆä¹Ÿå«å“ˆå¸Œè¡¨ï¼Œhash tableï¼‰ã€‚å› ä¸ºå®ƒé‡‡ç”¨æ•£åˆ—è¡¨å­˜å‚¨æ•°æ®ï¼Œå…ƒç´ çš„ä½ç½®å–å†³äºè®¡ç®—çš„æ•£åˆ—å€¼ï¼Œæ²¡æœ‰è§„å¾‹å¯è¨€ï¼Œæ‰€ä»¥å°±æ˜¯â€œæ— åºâ€çš„ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºâ€œä¹±åºâ€å®¹å™¨ã€‚</p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><ul><li><p>C++ é‡Œä¹Ÿæ˜¯æœ‰åƒåœ¾å›æ”¶çš„ï¼Œä¸è¿‡ä¸æ˜¯ Javaã€Go é‚£ç§ä¸¥æ ¼æ„ä¹‰ä¸Šçš„åƒåœ¾å›æ”¶ï¼Œè€Œæ˜¯å¹¿ä¹‰ä¸Šçš„åƒåœ¾å›æ”¶ï¼Œè¿™å°±æ˜¯æ„é€  / ææ„å‡½æ•°å’Œ <code>RAII</code> æƒ¯ç”¨æ³•ï¼ˆResource Acquisition Is Initializationï¼‰</p></li><li><p><code>noexcept</code> ä¸“é—¨ç”¨æ¥ä¿®é¥°å‡½æ•°ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨ï¼šè¿™ä¸ªå‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ç¼–è¯‘å™¨çœ‹åˆ°<code>noexcept</code>ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªâ€œä¿è¯â€ï¼Œå°±å¯ä»¥å¯¹å‡½æ•°åšä¼˜åŒ–ï¼Œä¸å»åŠ é‚£äº›æ ˆå±•å¼€çš„é¢å¤–ä»£ç ï¼Œæ¶ˆé™¤å¼‚å¸¸å¤„ç†çš„æˆæœ¬ã€‚</p></li></ul><p><strong>reference</strong></p><ul><li>&lt;&lt;ç½—å‰‘é”‹çš„C++å®æˆ˜ç¬”è®°&gt;&gt;</li></ul>]]></content>
      
      
      <categories>
          
          <category> c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>c++ tools</title>
      <link href="/2025/06/06/c++%20tools/"/>
      <url>/2025/06/06/c++%20tools/</url>
      
        <content type="html"><![CDATA[<h1 id="daignose-debug"><a href="#daignose-debug" class="headerlink" title="daignose/debug"></a>daignose/debug</h1><h2 id="GDB"><a href="#GDB" class="headerlink" title="GDB"></a>GDB</h2><h2 id="Valgrind"><a href="#Valgrind" class="headerlink" title="Valgrind"></a>Valgrind</h2><h2 id="Systemtap"><a href="#Systemtap" class="headerlink" title="Systemtap"></a>Systemtap</h2><h2 id="FlameGraph"><a href="#FlameGraph" class="headerlink" title="FlameGraph"></a>FlameGraph</h2><p><a href="https://github.com/brendangregg/FlameGraph">https://github.com/brendangregg/FlameGraph</a>)</p>]]></content>
      
      
      <categories>
          
          <category> c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>etcd snippet</title>
      <link href="/2025/04/24/etcd/"/>
      <url>/2025/04/24/etcd/</url>
      
        <content type="html"><![CDATA[<h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ETCDCTL_API=3 etcdctl --endpoints=http://127.0.0.1:2379 endpoint health</span><br><span class="line">ETCDCTL_API=3 /dingofs/etcd/sbin/etcdctl   --endpoints=http://127.0.0.1:2379   member list</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> etcd </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>containerd</title>
      <link href="/2025/03/28/containerd/"/>
      <url>/2025/03/28/containerd/</url>
      
        <content type="html"><![CDATA[<h2 id="best-practise"><a href="#best-practise" class="headerlink" title="best practise"></a>best practise</h2><p><strong>change containerdâ€™s default data path</strong></p><ol><li><p>Identify the Current Data Path</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">containerd config default | grep &quot;root&quot; # Expected output: root = &quot;/var/lib/containerd&quot;</span><br></pre></td></tr></table></figure></li><li><p>Modify the following lines in /etc/containerd/config.toml:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root = &quot;/path/to/new/data/path&quot; # the location where container data (images, volumes) is stored</span><br></pre></td></tr></table></figure></li><li><p>Move Existing Data (if required)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop containerd  # optional</span><br><span class="line">sudo mv /var/lib/containerd /data/containerd</span><br><span class="line">sudo systemctl start containerd</span><br></pre></td></tr></table></figure></li></ol><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><h2 id="image"><a href="#image" class="headerlink" title="image"></a>image</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list k8s image</span></span><br><span class="line">sudo ctr -n k8s.io images ls</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pull k8s image</span></span><br><span class="line">sudo ctr -n k8s.io images pull xxx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> load tar file</span> </span><br><span class="line">sudo ctr -n k8s.io images import /tmp/my-image.tar</span><br><span class="line"><span class="meta">#</span><span class="bash"> combine load tar file to specify tag image</span></span><br><span class="line">sudo ctr -n k8s.io images import --base-name my.registry.com/myproject/my-image:v1.2.3 /path/to/image.tar</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rename tag</span></span><br><span class="line">sudo ctr -n k8s.io images tag &lt;old-image-name&gt; &lt;new-image-name&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remove image</span></span><br><span class="line">sudo ctr -n k8s.io images remove &lt;name&gt;:&lt;tag&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> containerd </category>
          
      </categories>
      
      
        <tags>
            
            <tag> container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph fs</title>
      <link href="/2025/03/26/ceph%20FS/"/>
      <url>/2025/03/26/ceph%20FS/</url>
      
        <content type="html"><![CDATA[<h1 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h1><p>Before mounting CephFS, ensure that</p><ol><li>the client host (where CephFS has to be mounted and used) has a copy of the Ceph configuration file (i.e. ceph.conf)</li><li>a keyring of the CephX user that has permission to access the MDS.<br>both of these files must already be present on the host where the Ceph MON resides.</li></ol><ul><li><p>Generate a minimal conf file for the client host and place it at a standard location:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> on client host</span></span><br><span class="line">mkdir -p -m 755 /etc/ceph</span><br><span class="line">ssh &#123;user&#125;@&#123;mon-host&#125; &quot;sudo ceph config generate-minimal-conf&quot; | sudo tee /etc/ceph/ceph.conf</span><br><span class="line">chmod 644 /etc/ceph/ceph.conf</span><br></pre></td></tr></table></figure></li><li><p>Create a CephX user and get its secret key:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;user&#125;@&#123;mon-host&#125; &quot;sudo ceph fs authorize cephfs-1 client.dongwei / rw&quot; | sudo tee /etc/ceph/ceph.client.dongwei.keyring</span><br></pre></td></tr></table></figure><blockquote><p>In above command, replace cephfs with the name of your CephFS, foo by the name you want for your CephX user and / by the path within your CephFS for which you want to allow access to the client host and rw stands for both read and write permissions.</p></blockquote></li><li><p>Ensure that the keyring has appropriate permissions:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 /etc/ceph/ceph.client.dongwei.keyring</span><br></pre></td></tr></table></figure></li></ul><h1 id="Create-Pool-FS"><a href="#Create-Pool-FS" class="headerlink" title="Create Pool/FS"></a>Create Pool/FS</h1><ul><li><p>Creating pools</p><blockquote><p>A Ceph file system requires at least two RADOS pools, one for data and one for metadata.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph osd pool create cephfs_data</span><br><span class="line">ceph osd pool create cephfs_metadata</span><br></pre></td></tr></table></figure></li><li><p>Creating the file system</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph fs new cephfs-1 cephfs_metadata cephfs_data</span><br></pre></td></tr></table></figure></li><li><p>Check the status of the file system</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph fs status</span><br></pre></td></tr></table></figure></li><li><p>check mds status</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph mds stat</span><br></pre></td></tr></table></figure></li><li><p>Using Erasure Coded pools with CephFSï¼ˆoptionalï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph osd pool set my_ec_pool allow_ec_overwrites true</span><br></pre></td></tr></table></figure></li></ul><h1 id="Mount-CephFS-using-Kernel-Driver"><a href="#Mount-CephFS-using-Kernel-Driver" class="headerlink" title="Mount CephFS using Kernel Driver"></a>Mount CephFS using Kernel Driver</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mount -t ceph &#123;device-string&#125;=&#123;path-to-mounted&#125; &#123;mount-point&#125; -o &#123;key-value-args&#125; &#123;other-args&#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mount -t ceph &lt;name&gt;@&lt;fsid&gt;.&lt;fs_name&gt;=/ /mnt/mycephfs</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> fsid is the FSID of the Ceph cluster, <span class="built_in">which</span> can be found using the `ceph fsid` <span class="built_in">command</span>.</span></span><br><span class="line"></span><br><span class="line">mkdir /mnt/mycephfs</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> not use mount.helper</span></span><br><span class="line">mount -t ceph dongwei@b3acfc0d-575f-41d3-9c91-0e7ed3dbb3fa.cephfs-1=/ -o mon_addr=192.168.0.1:6789,secret=AQATSKdNGBnwLhAAnNDKnH65FmVKpXZJVasUeQ==</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use mount.helper</span></span><br><span class="line">mount -t ceph dongwei@.cephfs-1=/ /mnt/cephfs -o secret=AQATSKdNGBnwLhAAnNDKnH65FmVKpXZJVasUeQ==</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use secret file and Multiple monitor hosts</span></span><br><span class="line">mount -t ceph cephuser@.cephfs=/ /mnt/mycephfs -o</span><br><span class="line">mon_addr=192.168.0.1:6789/192.168.0.2:6789,secretfile=/etc/ceph/cephuser.secret</span><br></pre></td></tr></table></figure><ul><li><p>check</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dongwei@6a65c746-e532-11ef-8ac2-fa7c097efb00.cephfs-1=/  190G     0  190G   0% /mnt/cephfs</span><br></pre></td></tr></table></figure></li></ul><h1 id="Mount-CephFS-using-FUSE"><a href="#Mount-CephFS-using-FUSE" class="headerlink" title="Mount CephFS using FUSE"></a>Mount CephFS using FUSE</h1><ul><li><p>install ceph-fuse</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Install the Ceph release RPM (adjust <span class="string">&#x27;reef&#x27;</span> as needed)</span></span><br><span class="line">sudo rpm -Uvh https://download.ceph.com/rpm-reef/el9/noarch/ceph-release-1-1.el9.noarch.rpm</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Import the Ceph GPG key</span></span><br><span class="line">sudo rpm --import &#x27;https://download.ceph.com/keys/release.asc&#x27;</span><br><span class="line"></span><br><span class="line">sudo dnf install -y ceph-fuse</span><br></pre></td></tr></table></figure></li><li><p>mount</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ceph-fuse &#123;mount point&#125; &#123;options&#125;</span></span><br><span class="line">mkdir /mnt/mycephfs</span><br><span class="line">ceph-fuse --id dongwei /mnt/mycephfs  # mount default fs</span><br><span class="line"></span><br><span class="line">ceph-fuse --id dongwei --client_fs cephfs-1 /mnt/mycephfs # mount specify fs</span><br></pre></td></tr></table></figure></li><li><p>check</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph-fuse190G     0  190G   0% /mnt/cephfs2</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph csi</title>
      <link href="/2025/03/26/ceph%20csi/"/>
      <url>/2025/03/26/ceph%20csi/</url>
      
        <content type="html"><![CDATA[<h1 id="image"><a href="#image" class="headerlink" title="image"></a>image</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> v3.13</span></span><br><span class="line">quay.io/cephcsi/cephcsi:canary</span><br><span class="line"></span><br><span class="line">registry.k8s.io/sig-storage/csi-node-driver-registrar:v2.13.0</span><br><span class="line">registry.k8s.io/sig-storage/csi-provisioner:v5.1.0</span><br><span class="line">registry.k8s.io/sig-storage/csi-resizer:v1.13.1</span><br><span class="line">registry.k8s.io/sig-storage/csi-snapshotter:v8.2.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> v3.10</span></span><br><span class="line">quay.io/cephcsi/cephcsi:v3.10-canary</span><br><span class="line"></span><br><span class="line">registry.k8s.io/sig-storage/csi-node-driver-registrar:v2.9.1</span><br><span class="line">registry.k8s.io/sig-storage/csi-provisioner:v3.6.2</span><br><span class="line">registry.k8s.io/sig-storage/csi-resizer:v1.9.2</span><br><span class="line">registry.k8s.io/sig-storage/csi-snapshotter:v6.3.2</span><br></pre></td></tr></table></figure><h1 id="resource"><a href="#resource" class="headerlink" title="resource"></a>resource</h1><h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><ul><li>step1</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f csidriver.yaml</span><br><span class="line">kubectl create -f csi-provisioner-rbac.yaml</span><br><span class="line">kubectl create -f csi-nodeplugin-rbac.yaml</span><br></pre></td></tr></table></figure><ul><li><p>step2</p><p><code>kubectl create -f csi-config-map.yaml</code></p><blockquote><p>check by <code>ceph mon dump</code></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ceph-csi-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ceph</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">config.json:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        &quot;clusterID&quot;: &quot;xxx&quot;, </span></span><br><span class="line"><span class="string">        &quot;monitors&quot;: [</span></span><br><span class="line"><span class="string">          &quot;172.20.7.xxx:6789&quot;,</span></span><br><span class="line"><span class="string">          &quot;172.20.7.xxx:6789&quot;,</span></span><br><span class="line"><span class="string">          &quot;172.20.7.xxx:6789&quot;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br></pre></td></tr></table></figure></li><li><p>step3</p><p><code>kubectl create -f ceph-conf.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">ceph.conf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    [global]</span></span><br><span class="line"><span class="string">    auth_cluster_required = cephx</span></span><br><span class="line"><span class="string">    auth_service_required = cephx</span></span><br><span class="line"><span class="string">    auth_client_required = cephx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="comment"># keyring is a required key and its value should be empty</span></span><br><span class="line">  <span class="attr">keyring:</span> <span class="string">|</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ceph-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ceph</span></span><br></pre></td></tr></table></figure></li><li><p>step4</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f kms-config.yaml</span><br><span class="line">kubectl create -f csi-cephfsplugin-provisioner.yaml</span><br><span class="line">kubectl create -f csi-cephfsplugin.yaml</span><br></pre></td></tr></table></figure></li></ul><h2 id="provision"><a href="#provision" class="headerlink" title="provision"></a>provision</h2><h3 id="dynamic-provision"><a href="#dynamic-provision" class="headerlink" title="dynamic provision"></a>dynamic provision</h3><ul><li><p>step1 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph fs subvolumegroup create &lt;fsName&gt; csi</span><br></pre></td></tr></table></figure></li><li><p>step2</p><p><code>kubectl create -f secret.yaml</code></p><blockquote><p>check by <code>ceph auth get client.dongwei</code> and <code>ceph auth get client.admin</code></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">csi-cephfs-secret</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ceph</span></span><br><span class="line"><span class="attr">stringData:</span></span><br><span class="line">  <span class="comment"># Required for statically provisioned volumes, ğŸš¨ this use user</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">dongwei</span></span><br><span class="line">  <span class="attr">userKey:</span> <span class="string">&lt;&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Required for dynamically provisioned volumes, ğŸš¨ this use admin</span></span><br><span class="line">  <span class="attr">admin:</span> <span class="string">admin</span></span><br><span class="line">  <span class="attr">adminKey:</span> <span class="string">&lt;&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Encryption passphrase</span></span><br><span class="line">  <span class="attr">encryptionPassphrase:</span> <span class="string">test_passphrase</span></span><br></pre></td></tr></table></figure></li><li><p>step3</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f storageclass.yaml</span><br><span class="line">kubectl create -f pvc.yaml</span><br><span class="line">kubectl create -f pod.yaml</span><br></pre></td></tr></table></figure></li></ul><h3 id="static-provision"><a href="#static-provision" class="headerlink" title="static provision"></a>static provision</h3><ul><li><p>step1 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ceph fs subvolumegroup create &lt;fsName&gt; testGroup</span><br><span class="line">ceph fs subvolume create &lt;fsName&gt; testSubVolume testGroup --size=1073741824  # byte 1073741824/1024/1024=1024MB</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">ceph fs subvolume getpath &lt;fsName&gt; testSubVolume testGroup</span><br></pre></td></tr></table></figure></li><li><p>step2</p><p><code>kubectl create -f secret.yaml</code></p><blockquote><p>check by <code>ceph auth get client.dongwei</code> </p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">csi-cephfs-secret-static</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ceph</span></span><br><span class="line"><span class="attr">stringData:</span></span><br><span class="line">  <span class="comment"># Required for statically provisioned volumes, ğŸš¨ this use userID</span></span><br><span class="line">  <span class="attr">userID:</span> <span class="string">dongwei</span></span><br><span class="line">  <span class="attr">userKey:</span> <span class="string">&lt;&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Encryption passphrase</span></span><br><span class="line">  <span class="attr">encryptionPassphrase:</span> <span class="string">test_passphrase</span></span><br></pre></td></tr></table></figure></li><li><p>step3</p><p><code>kubectl create -f pv.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cephfs-static-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">csi:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">cephfs.csi.ceph.com</span></span><br><span class="line">    <span class="attr">nodeStageSecretRef:</span></span><br><span class="line">      <span class="comment"># node stage secret name</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">csi-cephfs-secret</span></span><br><span class="line">      <span class="comment"># node stage secret namespace where above secret is created</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">ceph</span></span><br><span class="line">    <span class="attr">volumeAttributes:</span></span><br><span class="line">      <span class="comment"># optional file system to be mounted</span></span><br><span class="line">      <span class="attr">&quot;fsName&quot;:</span> <span class="string">&quot;cephfs-1&quot;</span></span><br><span class="line">      <span class="comment"># Required options from storageclass parameters need to be added in volumeAttributes</span></span><br><span class="line">      <span class="attr">&quot;clusterID&quot;:</span> <span class="string">&quot;ba68226a-672f-4ba5-97bc-22840318b2ec&quot;</span></span><br><span class="line">      <span class="attr">&quot;staticVolume&quot;:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">      <span class="attr">&quot;rootPath&quot;:</span> <span class="string">/volumes/testGroup/testSubVolume</span></span><br><span class="line">    <span class="comment"># volumeHandle can be anything, need not to be same</span></span><br><span class="line">    <span class="comment"># as PV name or volume name. keeping same for brevity</span></span><br><span class="line">    <span class="attr">volumeHandle:</span> <span class="string">cephfs-static-pv</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br></pre></td></tr></table></figure><blockquote><p>rootPath ä¹Ÿå¯ä»¥æŒ‡å®šä¸º  /volumes/csi</p></blockquote></li><li><p>step4</p><p><code>kubectl create -f pvc.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cephfs-static-pvc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ceph</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br><span class="line">  <span class="comment"># volumeName should be same as PV name</span></span><br><span class="line">  <span class="attr">volumeName:</span> <span class="string">cephfs-static-pv</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> csi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubelet snippet</title>
      <link href="/2025/03/25/kubelet%20snippet/"/>
      <url>/2025/03/25/kubelet%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="troubleshooting"><a href="#troubleshooting" class="headerlink" title="troubleshooting"></a>troubleshooting</h1><h2 id="Version-from-runtime-service-failed"><a href="#Version-from-runtime-service-failed" class="headerlink" title="Version from runtime service failed"></a>Version from runtime service failed</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E0325 12:15:10.889620 3185179 remote_runtime.go:189] &quot;Version from runtime service failed&quot; err=&quot;rpc error: code = Unimplemented desc = unknown service runtime.v1alpha2.RuntimeService&quot;</span><br><span class="line">E0325 12:15:10.889663 3185179 kuberuntime_manager.go:226] &quot;Get runtime version failed&quot; err=&quot;get remote runtime typed version failed: rpc error: code = Unimplemented desc = unknown service runtime.v1alpha2.RuntimeService&quot;</span><br><span class="line">E0325 12:15:10.889683 3185179 run.go:74] &quot;command failed&quot; err=&quot;failed to run Kubelet: failed to create kubelet: get remote runtime typed version failed: rpc error: code = Unimplemented desc = unknown service runtime.v1alpha2.RuntimeService&quot;</span><br></pre></td></tr></table></figure><ul><li><p>resolve</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¤åˆ¶æ­£å¸¸èŠ‚ç‚¹ /etc/containerd/config.toml é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡å¯ containerd</span><br><span class="line">sudo systemctl restart containerd</span><br><span class="line"></span><br><span class="line">kubeletæœåŠ¡ä¼šè‡ªåŠ¨æ‹‰èµ·</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubelet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>clang-uml</title>
      <link href="/2025/03/20/clang-uml/"/>
      <url>/2025/03/20/clang-uml/</url>
      
        <content type="html"><![CDATA[<h1 id="clang-uml"><a href="#clang-uml" class="headerlink" title="clang-uml"></a>clang-uml</h1><h2 id="init"><a href="#init" class="headerlink" title="init"></a>init</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> init .clang-uml file</span></span><br><span class="line">clang-uml --init</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use specify config file</span></span><br><span class="line">clang-uml -c /path/to/configFile</span><br></pre></td></tr></table></figure><h2 id="generate-PlantUML"><a href="#generate-PlantUML" class="headerlink" title="generate PlantUML"></a>generate PlantUML</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> generate xxx.puml base on default config</span></span><br><span class="line">clang-uml # --progress</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> draw svg picture base on above puml file</span></span><br><span class="line">plantuml -tsvg xxx.puml</span><br></pre></td></tr></table></figure><h2 id="generate-mermaid"><a href="#generate-mermaid" class="headerlink" title="generate  mermaid"></a>generate  mermaid</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> genrate xxx.mmd</span></span><br><span class="line">clang-uml -g mermaid</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> draw svg</span></span><br><span class="line">mmdc -i xxx.mmd # -o &lt;name&gt;.svg</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> draw big svg</span></span><br><span class="line">vim config.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;maxTextSize&quot;: 1000000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mmdc -i diagram.mmd -c config.json</span><br></pre></td></tr></table></figure><h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> To find the exact <span class="keyword">function</span> signature</span></span><br><span class="line"> clang-uml --print-from -n client_class_diagram -c .clang-uml-sequence | grep main</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> clang-uml </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nvidia cuda</title>
      <link href="/2025/03/12/cuda/"/>
      <url>/2025/03/12/cuda/</url>
      
        <content type="html"><![CDATA[<h1 id="version"><a href="#version" class="headerlink" title="version"></a>version</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GPU  drivercuda|vllm torch</span><br><span class="line">h10055012.4  |</span><br><span class="line">h20056512.7|0.7.32.5.1+cu124</span><br><span class="line">h20057012.8|0.7.32.5.1+cu124</span><br></pre></td></tr></table></figure><h1 id="install"><a href="#install" class="headerlink" title="install"></a>install</h1><h2 id="CUDA-Toolkit"><a href="#CUDA-Toolkit" class="headerlink" title="CUDA Toolkit"></a>CUDA Toolkit</h2><blockquote><p><a href="https://developer.nvidia.com/cuda-toolkit-archive">https://developer.nvidia.com/cuda-toolkit-archive</a></p></blockquote><ul><li><p>local</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-ubuntu2204.pin</span><br><span class="line"></span><br><span class="line">sudo mv cuda-ubuntu2204.pin /etc/apt/preferences.d/cuda-repository-pin-600</span><br><span class="line"></span><br><span class="line">wget https://developer.download.nvidia.com/compute/cuda/12.8.1/local_installers/cuda-repo-ubuntu2204-12-8-local_12.8.1-570.124.06-1_amd64.deb</span><br><span class="line"></span><br><span class="line">sudo dpkg -i cuda-repo-ubuntu2204-12-8-local_12.8.1-570.124.06-1_amd64.deb</span><br><span class="line"></span><br><span class="line">sudo cp /var/cuda-repo-ubuntu2204-12-8-local/cuda-*-keyring.gpg /usr/share/keyrings/</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get -y install cuda-toolkit-12-8</span><br></pre></td></tr></table></figure></li><li><p>online</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-keyring_1.1-1_all.deb</span><br><span class="line">sudo dpkg -i cuda-keyring_1.1-1_all.deb</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install cuda-toolkit-12-8</span><br></pre></td></tr></table></figure></li></ul><h3 id="post-operate"><a href="#post-operate" class="headerlink" title="post operate"></a>post operate</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> config env</span></span><br><span class="line">export PATH=/usr/local/cuda/bin:$PATH</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NVIDIA persistence daemon</span></span><br><span class="line">sudo systemctl start nvidia-persistenced</span><br></pre></td></tr></table></figure><h2 id="driver"><a href="#driver" class="headerlink" title="driver"></a>driver</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y cuda-drivers</span><br></pre></td></tr></table></figure><h2 id="nvidia-fabricmanager"><a href="#nvidia-fabricmanager" class="headerlink" title="nvidia-fabricmanager"></a>nvidia-fabricmanager</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y nvidia-fabricmanager-570</span><br><span class="line"></span><br><span class="line">sudo systemctl start nvidia-fabricmanager</span><br></pre></td></tr></table></figure><h1 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h1><blockquote><p>resolve issues: Error 802: system not yet initialized</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sort GPUs, by ordering their IDs with IDs on the PCIe bus.</span></span><br><span class="line">export CUDA_DEVICE_ORDER=&quot;PCI_BUS_ID&quot; </span><br><span class="line"><span class="meta">#</span><span class="bash"> perform an availability check using NVML (NVIDIA Management Library). NVML is an API layer <span class="keyword">for</span> obtaining data directly from the NVIDIA-smi utility.</span></span><br><span class="line">export PYTORCH_NVML_BASED_CUDA_CHECK=1 </span><br><span class="line"><span class="meta">#</span><span class="bash"> force show the system the IDs of available GPUs.</span></span><br><span class="line">export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7</span><br></pre></td></tr></table></figure><h1 id="cuda-kernel-model"><a href="#cuda-kernel-model" class="headerlink" title="cuda kernel model"></a>cuda kernel model</h1><ul><li>check by <code>lsmod | grep nvidia</code></li></ul><table><thead><tr><th><strong>Module</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>nvidia_uvm</td><td>NVIDIAâ€™s Unified Memory driver</td></tr><tr><td>nvidia_drm</td><td>Direct Rendering Manager support</td></tr><tr><td>nvidia_modeset</td><td>Kernel mode-setting support</td></tr><tr><td>nvidia</td><td>Main NVIDIA driver module</td></tr></tbody></table><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><h2 id="nvidia-smi"><a href="#nvidia-smi" class="headerlink" title="nvidia-smi"></a>nvidia-smi</h2><ul><li><p>Enable Persistence Mode</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvidia-smi -pm 1</span><br></pre></td></tr></table></figure></li><li><p>check state</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi conf-compute -grs</span><br><span class="line"><span class="meta">#</span><span class="bash"> Confidential Compute GPUs Ready state: not-ready</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Confidential Compute GPUs Ready state: ready</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> above state is not-ready, execute below cmd</span></span><br><span class="line">nvidia-smi conf-compute -srs 1</span><br></pre></td></tr></table></figure></li><li><p>cuda 12.8</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 570.124.06             Driver Version: 570.124.06     CUDA Version: 12.8     |</span><br><span class="line">|-----------------------------------------+------------------------+----------------------+</span><br><span class="line">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                                         |                        |               MIG M. |</span><br><span class="line">|=========================================+========================+======================|</span><br><span class="line">|   0  NVIDIA H200                    On  |   00000000:19:00.0 Off |                    0 |</span><br><span class="line">| N/A   23C    P0             76W /  700W |       1MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   1  NVIDIA H200                    On  |   00000000:3B:00.0 Off |                    0 |</span><br><span class="line">| N/A   21C    P0             75W /  700W |       1MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   2  NVIDIA H200                    On  |   00000000:4C:00.0 Off |                    0 |</span><br><span class="line">| N/A   23C    P0             76W /  700W |       1MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   3  NVIDIA H200                    On  |   00000000:5D:00.0 Off |                    0 |</span><br><span class="line">| N/A   24C    P0             77W /  700W |       1MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   4  NVIDIA H200                    On  |   00000000:9B:00.0 Off |                    0 |</span><br><span class="line">| N/A   24C    P0             75W /  700W |       1MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   5  NVIDIA H200                    On  |   00000000:BB:00.0 Off |                    0 |</span><br><span class="line">| N/A   23C    P0             77W /  700W |       1MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   6  NVIDIA H200                    On  |   00000000:CB:00.0 Off |                    0 |</span><br><span class="line">| N/A   24C    P0             76W /  700W |       1MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   7  NVIDIA H200                    On  |   00000000:DB:00.0 Off |                    0 |</span><br><span class="line">| N/A   24C    P0             76W /  700W |       1MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">                                                                                         </span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                              |</span><br><span class="line">|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |</span><br><span class="line">|        ID   ID                                                               Usage      |</span><br><span class="line">|=========================================================================================|</span><br><span class="line">|  No running processes found                                                             |</span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure></li><li><p>cuda 12.7</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Fri Mar 14 10:23:56 2025       </span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 565.57.01              Driver Version: 565.57.01      CUDA Version: 12.7     |</span><br><span class="line">|-----------------------------------------+------------------------+----------------------+</span><br><span class="line">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                                         |                        |               MIG M. |</span><br><span class="line">|=========================================+========================+======================|</span><br><span class="line">|   0  NVIDIA H200                    On  |   00000000:19:00.0 Off |                    0 |</span><br><span class="line">| N/A   26C    P0            111W /  700W |  134402MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   1  NVIDIA H200                    On  |   00000000:3B:00.0 Off |                    0 |</span><br><span class="line">| N/A   25C    P0            116W /  700W |  132320MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   2  NVIDIA H200                    On  |   00000000:4C:00.0 Off |                    0 |</span><br><span class="line">| N/A   25C    P0            112W /  700W |  132320MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   3  NVIDIA H200                    On  |   00000000:5D:00.0 Off |                    0 |</span><br><span class="line">| N/A   27C    P0            115W /  700W |  132320MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   4  NVIDIA H200                    On  |   00000000:9B:00.0 Off |                    0 |</span><br><span class="line">| N/A   27C    P0            115W /  700W |  132320MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   5  NVIDIA H200                    On  |   00000000:BB:00.0 Off |                    0 |</span><br><span class="line">| N/A   26C    P0            114W /  700W |  132320MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   6  NVIDIA H200                    On  |   00000000:CB:00.0 Off |                    0 |</span><br><span class="line">| N/A   26C    P0            113W /  700W |  132320MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   7  NVIDIA H200                    On  |   00000000:DB:00.0 Off |                    0 |</span><br><span class="line">| N/A   24C    P0            114W /  700W |  131840MiB / 143771MiB |      0%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">                                                                                         </span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                              |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |</span><br><span class="line">|        ID   ID                                                               Usage      |</span><br><span class="line">|=========================================================================================|</span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><h1 id="vllm"><a href="#vllm" class="headerlink" title="vllm"></a>vllm</h1><h2 id="install-offline"><a href="#install-offline" class="headerlink" title="install offline"></a>install offline</h2><p>On your local machine, create a virtual environment:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv vllm_env</span><br><span class="line">source vllm_env/bin/activate</span><br></pre></td></tr></table></figure><p>1ï¸âƒ£ <strong>On your local machine:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip download --dest=./vllm_deps vllm</span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ <strong>Transfer dependencies to the remote server:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r vllm_deps user@remote_server:/path/to/destination/</span><br></pre></td></tr></table></figure><p>3ï¸âƒ£ <strong>On the remote server:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /path/to/destination/vllm_deps</span><br><span class="line">pip install --no-index --find-links=. vllm*</span><br><span class="line">â€¢--no-index tells pip not to use the internet.</span><br><span class="line">â€¢--find-links=./vllm_deps tells pip to look for packages in this directory.</span><br><span class="line">â€¢vllm* ensures pip finds the correct package in that folder.</span><br></pre></td></tr></table></figure><h2 id="running-time"><a href="#running-time" class="headerlink" title="running time"></a>running time</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vllm serve /mnt/dingofs-test/DeepSeek-R1 --host 0.0.0.0 --port 8000 --served-model-name deepseek-r1 --tensor-parallel-size 8 --gpu-memory-utilization 0.85 --max-model-len 128000 --max-num-batched-tokens 32000 --max-num-seqs 1024 --trust-remote-code --enable-reasoning --reasoning-parser deepseek_r1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Sat Mar 15 20:33:04 2025       </span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 570.124.06             Driver Version: 570.124.06     CUDA Version: 12.8     |</span><br><span class="line">|-----------------------------------------+------------------------+----------------------+</span><br><span class="line">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                                         |                        |               MIG M. |</span><br><span class="line">|=========================================+========================+======================|</span><br><span class="line">|   0  NVIDIA H200                    On  |   00000000:19:00.0 Off |                    0 |</span><br><span class="line">| N/A   26C    P0            115W /  700W |   84474MiB / 143771MiB |      1%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   1  NVIDIA H200                    On  |   00000000:3B:00.0 Off |                    0 |</span><br><span class="line">| N/A   24C    P0            113W /  700W |   84522MiB / 143771MiB |      1%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   2  NVIDIA H200                    On  |   00000000:4C:00.0 Off |                    0 |</span><br><span class="line">| N/A   26C    P0            114W /  700W |   84522MiB / 143771MiB |      1%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   3  NVIDIA H200                    On  |   00000000:5D:00.0 Off |                    0 |</span><br><span class="line">| N/A   27C    P0            117W /  700W |   84522MiB / 143771MiB |      1%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   4  NVIDIA H200                    On  |   00000000:9B:00.0 Off |                    0 |</span><br><span class="line">| N/A   27C    P0            114W /  700W |   84522MiB / 143771MiB |      1%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   5  NVIDIA H200                    On  |   00000000:BB:00.0 Off |                    0 |</span><br><span class="line">| N/A   26C    P0            116W /  700W |   84522MiB / 143771MiB |      1%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   6  NVIDIA H200                    On  |   00000000:CB:00.0 Off |                    0 |</span><br><span class="line">| N/A   27C    P0            115W /  700W |   84522MiB / 143771MiB |      1%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">|   7  NVIDIA H200                    On  |   00000000:DB:00.0 Off |                    0 |</span><br><span class="line">| N/A   26C    P0            114W /  700W |   84282MiB / 143771MiB |      1%      Default |</span><br><span class="line">|                                         |                        |             Disabled |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">                                                                                         </span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                              |</span><br><span class="line">|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |</span><br><span class="line">|        ID   ID                                                               Usage      |</span><br><span class="line">|=========================================================================================|</span><br><span class="line">|    0   N/A  N/A          915920      C   ...niconda3/envs/vllm/bin/python      84464MiB |</span><br><span class="line">|    1   N/A  N/A          916338      C   ...niconda3/envs/vllm/bin/python      84512MiB |</span><br><span class="line">|    2   N/A  N/A          916339      C   ...niconda3/envs/vllm/bin/python      84512MiB |</span><br><span class="line">|    3   N/A  N/A          916340      C   ...niconda3/envs/vllm/bin/python      84512MiB |</span><br><span class="line">|    4   N/A  N/A          916341      C   ...niconda3/envs/vllm/bin/python      84512MiB |</span><br><span class="line">|    5   N/A  N/A          916342      C   ...niconda3/envs/vllm/bin/python      84512MiB |</span><br><span class="line">|    6   N/A  N/A          916343      C   ...niconda3/envs/vllm/bin/python      84512MiB |</span><br><span class="line">|    7   N/A  N/A          916344      C   ...niconda3/envs/vllm/bin/python      84272MiB |</span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><ul><li><p>log</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INFO 03-15 20:36:48 worker.py:267] Memory profiling takes 7.63 seconds</span><br><span class="line">INFO 03-15 20:36:48 worker.py:267] the current vLLM instance can use total_gpu_memory (139.81GiB) x gpu_memory_utilization (0.85) = 118.84GiB</span><br><span class="line">INFO 03-15 20:36:48 worker.py:267] model weights take 83.88GiB; non_torch_memory takes 7.16GiB; PyTorch activation peak memory takes 6.37GiB; the rest of the memory reserved </span><br><span class="line">for KV Cache is 21.43GiB.</span><br><span class="line">INFO 03-15 20:36:48 executor_base.py:111] # cuda blocks: 18418, # CPU blocks: 3437</span><br><span class="line">INFO 03-15 20:36:48 executor_base.py:116] Maximum concurrency for 128000 tokens per request: 2.30x</span><br></pre></td></tr></table></figure></li><li><p>chat</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8000/v1/chat/completions \</span><br><span class="line">    -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">    -d &#x27;&#123;</span><br><span class="line">        &quot;model&quot;: &quot;deepseek-r1&quot;,</span><br><span class="line">        &quot;messages&quot;: [</span><br><span class="line">            &#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;&#125;,</span><br><span class="line">            &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;introduce yourself&quot;&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure></li></ul><h1 id="sglang"><a href="#sglang" class="headerlink" title="sglang"></a>sglang</h1><h2 id="install-offline-1"><a href="#install-offline-1" class="headerlink" title="install offline"></a>install offline</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> prepare env</span></span><br><span class="line">python3 -m venv sglang_env</span><br><span class="line">source sglang_env/bin/activate</span><br><span class="line"><span class="meta">#</span><span class="bash"> optional use uv</span></span><br><span class="line">pip install --upgrade pip</span><br><span class="line"><span class="meta">#</span><span class="bash">pip install uv</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> download deps</span></span><br><span class="line">mkdir -p ./sglang_deps</span><br><span class="line">pip download &quot;sglang[all]&gt;=0.4.4.post1&quot; --find-links https://flashinfer.ai/whl/cu124/torch2.5/flashinfer-python -d ./sglang_deps</span><br><span class="line"><span class="meta">#</span><span class="bash"> scp deps to remote</span></span><br><span class="line">scp -r sglang_deps user@remote_server:/path/to/destination/</span><br><span class="line"><span class="meta">#</span><span class="bash"> install sglang on remote</span></span><br><span class="line">cd /path/to/remote/sglang_deps</span><br><span class="line">pip install --no-index --find-links=. &quot;sglang[all]&gt;=0.4.4.post1&quot;</span><br></pre></td></tr></table></figure><h2 id="runtime"><a href="#runtime" class="headerlink" title="runtime"></a>runtime</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m sglang.launch_server --model /mnt/3fs/DeepSeek-R1 --tp 8 --trust-remote-code --port 30000</span><br></pre></td></tr></table></figure><ul><li><p>chat</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:30000/v1/chat/completions \</span><br><span class="line">    -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">    -d &#x27;&#123;</span><br><span class="line">        &quot;model&quot;: &quot;deepseek-r1&quot;,</span><br><span class="line">        &quot;messages&quot;: [</span><br><span class="line">            &#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;&#125;,</span><br><span class="line">            &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;introduce yourself&quot;&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure></li></ul><h1 id="torch"><a href="#torch" class="headerlink" title="torch"></a>torch</h1><h2 id="install-offline-2"><a href="#install-offline-2" class="headerlink" title="install offline"></a>install offline</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/torch_deps</span><br><span class="line">pip download --dest=~/torch_deps torch==2.5.1 --extra-index-url https://download.pytorch.org/whl/nightly/cu128</span><br><span class="line"></span><br><span class="line">scp -r ~/torch_deps user@remote_server:/path/to/remote/directory</span><br><span class="line">cd /path/to/remote/directory</span><br><span class="line">pip install --no-index --find-links=./ torch</span><br></pre></td></tr></table></figure><ul><li><p>check</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import torch; print(torch.cuda.is_available()); print(torch.cuda.device_count())&quot;</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())  <span class="comment"># print false</span></span><br><span class="line"><span class="built_in">print</span>(torch.cuda.device_count())  <span class="comment"># print 8</span></span><br><span class="line"><span class="built_in">print</span>(torch.__version__)  <span class="comment"># print 2.5.1+cu124</span></span><br><span class="line"><span class="built_in">print</span>(torch.version.cuda) <span class="comment"># print 12.4</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="best-practices"><a href="#best-practices" class="headerlink" title="best practices"></a>best practices</h1><h2 id="CUDA-LAUNCH-BLOCKING-1"><a href="#CUDA-LAUNCH-BLOCKING-1" class="headerlink" title="CUDA_LAUNCH_BLOCKING=1"></a><code>CUDA_LAUNCH_BLOCKING=1</code></h2><blockquote><p>CUDA_LAUNCH_BLOCKING=1 will tell CUDA: â€œWait (block) for each GPU kernel to finish before moving to the next line of Python code.â€</p></blockquote><p>Normally, CUDA operations are <strong>asynchronous</strong>â€”errors may not happen exactly where the code looks wrong, because the kernel may fail later. This can make debugging frustrating.</p><p>should never use it in production or performance benchmarkingâ€”just for debugging.</p>]]></content>
      
      
      <categories>
          
          <category> cuda </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nvidia </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s ctr</title>
      <link href="/2025/03/12/k8s%20ctr/"/>
      <url>/2025/03/12/k8s%20ctr/</url>
      
        <content type="html"><![CDATA[<h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check k8s image</span></span><br><span class="line">ctr --namespace k8s.io images list</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>network solution</title>
      <link href="/2025/03/10/network%20solution/"/>
      <url>/2025/03/10/network%20solution/</url>
      
        <content type="html"><![CDATA[<h1 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h1><h2 id="add-new-dns"><a href="#add-new-dns" class="headerlink" title="add new dns"></a>add new dns</h2><ul><li><p>method 1:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step1: vim /etc/systemd/resolved.conf</span></span><br><span class="line">[<span class="string">Resolve</span>]</span><br><span class="line"><span class="string">DNS=10.201.44.51</span> <span class="number">223.5</span><span class="number">.5</span><span class="number">.5</span>  <span class="comment"># new DNS</span></span><br><span class="line"><span class="string">FallbackDNS=127.0.0.53</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step2: restart service</span></span><br><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">systemd-resolved</span></span><br></pre></td></tr></table></figure></li><li><p>method2: (æœ‰æ—¶å€™ä¸èµ·æ•ˆ)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vim</span> <span class="string">/etc/resolv.conf</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šæ·»åŠ çš„dnsè§£æåœ°å€ï¼Œéœ€è¦æ”¾åœ¨å‰é¢ï¼Œä¼šæœ‰é¡ºåºå½±å“</span></span><br><span class="line"></span><br><span class="line"><span class="string">nameserver</span> <span class="number">10.201</span><span class="number">.44</span><span class="number">.51</span>  <span class="comment"># new DNS</span></span><br><span class="line"><span class="string">nameserver</span> <span class="number">223.5</span><span class="number">.5</span><span class="number">.5</span><span class="comment"># new DNS</span></span><br><span class="line"><span class="string">nameserver</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.53</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="network"><a href="#network" class="headerlink" title="network"></a>network</h1><h2 id="create-new-network"><a href="#create-new-network" class="headerlink" title="create new network"></a>create new network</h2><p>step1: vim <code>/etc/netplan/ib.yaml</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    ibp27s0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      addresses:</span><br><span class="line">        - 192.168.2.52/21</span><br></pre></td></tr></table></figure><p>step2: <code>netplan apply</code></p><h1 id="bond"><a href="#bond" class="headerlink" title="bond"></a>bond</h1><h2 id="create-bond"><a href="#create-bond" class="headerlink" title="create bond"></a>create bond</h2><p>Bonding Mode</p><table><thead><tr><th>Mode</th><th>Max Speed (Single Flow)</th><th>Max Speed (Multiple Flows)</th><th>Key Feature</th></tr></thead><tbody><tr><td>mode=0 (round-robin)</td><td>Sum of all slaves</td><td>Sum of all slaves</td><td>Best for maximizing bandwidth, may cause out-of-order packets.</td></tr><tr><td>mode=1 (active-backup)</td><td>One interfaceâ€™s speed</td><td>One interfaceâ€™s speed</td><td>Best for redundancy, no speed gain.</td></tr><tr><td>mode=2 (balance-xor)</td><td>One interfaceâ€™s speed</td><td>Sum of all slaves</td><td>Good for performance; switch support required.</td></tr><tr><td>mode=4 (802.3ad - LACP)</td><td>One interfaceâ€™s speed</td><td>Sum of all slaves</td><td>Efficient load balancing for multiple flows; requires switch support.</td></tr><tr><td>mode=5 (balance-tlb)</td><td>One interfaceâ€™s speed</td><td>Sum of all slaves (outgoing only)</td><td>Adaptive transmit load balancing.</td></tr><tr><td>mode=6 (balance-alb)</td><td>One interfaceâ€™s speed</td><td>Sum of all slaves</td><td>Adaptive load balancing without switch support.</td></tr></tbody></table><blockquote><p> assume make ib7s400p0 to bond1, which have assigned  ip 172.30.12.46 with ib7s400p0</p></blockquote><p><strong>optional</strong>: Load the Bonding Kernel Module</p><p>Ensure the bonding driver is loaded:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo modprobe bonding</span><br></pre></td></tr></table></figure><p>To persist this across reboots:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;bonding&quot; | sudo tee /etc/modules-load.d/bonding.conf</span><br></pre></td></tr></table></figure><p><strong>optional</strong>: Remove the IP Address from ib7s400p0</p><p>Since the bond interface will carry the IP, you must remove the IP from ib7s400p0 first:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip addr del 172.30.12.61/24 dev ib7s400p0</span><br></pre></td></tr></table></figure><p><strong>Step 2: Create the Bond Interface (bond1)</strong></p><p>Create the bond interface:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link add bond1 type bond</span><br></pre></td></tr></table></figure><p><strong>Step 3: Configure Bonding Mode</strong></p><p>For your use case, you can set mode=active-backup (best for redundancy with one NIC now) or mode=802.3ad (if planning for LACP in the future).</p><p><strong>Set Active-Backup Mode (Recommended for 1 NIC Now)</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;active-backup&quot; | sudo tee /sys/class/net/bond1/bonding/mode</span><br></pre></td></tr></table></figure><p><strong>OR Set 802.3ad Mode (If Future Expansion is Planned)</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;802.3ad&quot; | sudo tee /sys/class/net/bond1/bonding/mode</span><br></pre></td></tr></table></figure><p><strong>Step 4: Add ib7s400p0 as a Slave</strong></p><ol><li>Remove any IP address from ib7s400p0 (if it has one):</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip addr flush dev ib7s400p0</span><br></pre></td></tr></table></figure><ol start="2"><li>Add ib7s400p0 to bond1:</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link set ib7s400p0 down</span><br><span class="line">sudo ip link set ib7s400p0 master bond1</span><br><span class="line">sudo ip link set ib7s400p0 up</span><br></pre></td></tr></table></figure><blockquote><p>check: ethtool ib7s400p0</p></blockquote><ol start="3"><li>Bring bond1 up:</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link set bond1 up</span><br></pre></td></tr></table></figure><blockquote><p>check: cat /proc/net/bonding/bond1</p></blockquote><p><strong>Step 5: Assign an IP Address</strong></p><p>If using a <strong>static IP</strong>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip addr add 172.30.12.61/24 dev bond1</span><br></pre></td></tr></table></figure><p>Or if using <strong>DHCP</strong>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dhclient bond1</span><br></pre></td></tr></table></figure><p>Try to force traffic through bond1 by removing the direct route through ib7s400p0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip route del 172.30.12.0/24 dev ib7s400p0</span><br></pre></td></tr></table></figure><p><strong>Step 6: Persistent Configuration (Rocky 9 / RHEL 9) (optional)</strong></p><p>To ensure the bond configuration persists after reboot:</p><ol><li>Create <code>/etc/sysconfig/network-scripts/ifcfg-bond1</code></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=bond1</span><br><span class="line">TYPE=Bond</span><br><span class="line">BONDING_MASTER=yes</span><br><span class="line">BOOTPROTO=dhcp      # Or use &#x27;static&#x27; if assigning a static IP</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BONDING_OPTS=&quot;mode=active-backup miimon=100&quot;</span><br></pre></td></tr></table></figure><ol start="2"><li>Create <code>/etc/sysconfig/network-scripts/ifcfg-ib7s400p0</code></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=ib7s400p0</span><br><span class="line">MASTER=bond1</span><br><span class="line">SLAVE=yes</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">ONBOOT=yes</span><br></pre></td></tr></table></figure><ol start="3"><li>Restart NetworkManager to apply changes:</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart NetworkManager</span><br></pre></td></tr></table></figure><p><strong>Step 7: Verify Configuration</strong></p><ol><li>Check bond details:</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/net/bonding/bond1</span><br></pre></td></tr></table></figure><p>ib7s400p0 should now appear as a <strong>Slave Interface</strong>.</p><ol start="2"><li>Confirm IP address and route:</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip a</span><br><span class="line">ip route</span><br></pre></td></tr></table></figure><ol start="3"><li>Test connectivity:</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 172.30.12.47 # other same bond addr</span><br></pre></td></tr></table></figure><p><strong>Step 8: Optional - Test Failover (For active-backup Mode)</strong></p><p>â€‹    1.    Temporarily bring down ib7s400p0:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link set ib7s400p0 down</span><br></pre></td></tr></table></figure><p>â€‹    2.    Check bond1 status:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/net/bonding/bond1</span><br></pre></td></tr></table></figure><p>In active-backup mode, bond1 should remain active (even though ib7s400p0 is down).</p><p>In 802.3ad mode, bond1 would go down since no alternate NIC exists yet.</p><p><strong>Summary</strong></p><p>Use <strong>active-backup</strong> mode if ib7s400p0 is the only slave (recommended now).</p><p>Use <strong>802.3ad</strong> if planning to add more NICs for higher throughput in the future.</p><p>Ensure <code>/etc/sysconfig/network-scripts/</code> configs are properly set for persistence.</p><h1 id="ibtables"><a href="#ibtables" class="headerlink" title="ibtables"></a>ibtables</h1><h2 id="remove-specify-rule"><a href="#remove-specify-rule" class="headerlink" title="remove specify rule"></a>remove specify rule</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check iptables</span></span><br><span class="line">sudo iptables -L -n -v</span><br><span class="line"><span class="meta">#</span><span class="bash"> check nftables</span></span><br><span class="line">sudo nft list ruleset</span><br></pre></td></tr></table></figure><p>To remove the <code>reject-with icmp-host-prohibited</code> rule and allow <strong>all incoming traffic</strong> from external servers, follow these steps. This will disable the firewallâ€™s default rejection of unmatched traffic.</p><p><strong>Step 1: Remove the <code>REJECT</code> Rule in <code>iptables</code></strong></p><p>First, identify and delete the explicit <code>REJECT</code> rule in the <code>INPUT</code> chain.</p><p>Check current <code>iptables</code> rules (look for the <code>REJECT</code> line):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -L INPUT -n --line-numbers</span><br></pre></td></tr></table></figure><p>Example output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">num  target     prot opt source               destination</span><br><span class="line">...</span><br><span class="line">5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibited</span><br></pre></td></tr></table></figure><p>Delete the rule by its line number (e.g., line <code>5</code>):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -D INPUT 5</span><br></pre></td></tr></table></figure><p><strong>Step 2: Set Default Policy to <code>ACCEPT</code> (Optional)</strong></p><p>If you want to <strong>allow all traffic by default</strong> (not recommended for security), set the <code>INPUT</code> chain policy to <code>ACCEPT</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -P INPUT ACCEPT</span><br></pre></td></tr></table></figure><p><strong>Step 3: Save the Rules (Persist Across Reboots)</strong></p><p>Save the changes to ensure they survive a reboot.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># On CentOS/RHEL 7 or systems using iptables-service:</span></span><br><span class="line">sudo service iptables save</span><br><span class="line"><span class="comment"># On Debian/Ubuntu with iptables-persistent:</span></span><br><span class="line">sudo netfilter-persistent save</span><br></pre></td></tr></table></figure><h1 id="nftables"><a href="#nftables" class="headerlink" title="nftables"></a>nftables</h1><h2 id="Accept-ALL-INPUT"><a href="#Accept-ALL-INPUT" class="headerlink" title="Accept ALL INPUT"></a>Accept ALL INPUT</h2><p>For systems using <code>nftables</code> (modern Linux):</p><p>If your system uses <code>nftables</code> , flush all rules and set a default <code>ACCEPT</code> policy:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Flush existing rules</span></span><br><span class="line">sudo nft flush ruleset</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set default policies to ACCEPT</span></span><br><span class="line">sudo nft add table ip filter</span><br><span class="line">sudo nft add chain ip filter INPUT &#123; <span class="built_in">type</span> filter hook input priority 0 \; policy accept \; &#125;</span><br><span class="line">sudo nft add chain ip filter FORWARD &#123; <span class="built_in">type</span> filter hook forward priority 0 \; policy accept \; &#125;</span><br><span class="line">sudo nft add chain ip filter OUTPUT &#123; <span class="built_in">type</span> filter hook output priority 0 \; policy accept \; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save rules</span></span><br><span class="line">sudo nft list ruleset &gt; /etc/nftables.conf</span><br></pre></td></tr></table></figure><p><strong>Step 4: Verify the Rules</strong></p><p>Confirm the <code>REJECT</code> rule is gone and traffic is allowed:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -L INPUT -n</span><br><span class="line"><span class="comment"># OR for nftables:</span></span><br><span class="line">sudo nft list ruleset</span><br></pre></td></tr></table></figure><p><strong>Important Notes</strong></p><ul><li><strong>Security Warning</strong>: Disabling firewall rules entirely (<code>ACCEPT</code> policy) exposes your server to all traffic. Only do this in trusted environments.</li><li>If you only want to allow specific ports (e.g., <code>6800</code>), use targeted rules instead of disabling the firewall:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -I INPUT -p tcp --dport 6800 -j ACCEPT</span><br><span class="line">sudo netfilter-persistent save</span><br></pre></td></tr></table></figure></li><li>The <code>icmp-host-prohibited</code> rejection is part of the <code>iptables</code> rules, not a separate service. Deleting the rule (Step 1) is sufficient to stop the blocking.</li></ul>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> solution </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>llm vllm</title>
      <link href="/2025/03/06/llm%20vllm/"/>
      <url>/2025/03/06/llm%20vllm/</url>
      
        <content type="html"><![CDATA[<h1 id="route"><a href="#route" class="headerlink" title="route"></a>route</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">INFO llm_engine.py:436] init engine (profile, create kv cache, warmup model) took 135.23 seconds</span><br><span class="line">INFO api_server.py:958] Starting vLLM API server on http://0.0.0.0:8000</span><br><span class="line">Available routes are:</span><br><span class="line"> Route: /openapi.json, Methods: GET, HEAD</span><br><span class="line"> Route: /docs, Methods: GET, HEAD</span><br><span class="line"> Route: /docs/oauth2-redirect, Methods: GET, HEAD</span><br><span class="line"> Route: /redoc, Methods: GET, HEAD</span><br><span class="line"> Route: /health, Methods: GET</span><br><span class="line"> Route: /ping, Methods: GET, POST</span><br><span class="line"> Route: /tokenize, Methods: POST</span><br><span class="line"> Route: /detokenize, Methods: POST</span><br><span class="line"> Route: /v1/models, Methods: GET</span><br><span class="line"> Route: /version, Methods: GET</span><br><span class="line"> Route: /v1/chat/completions, Methods: POST</span><br><span class="line"> Route: /v1/completions, Methods: POST</span><br><span class="line"> Route: /v1/embeddings, Methods: POST</span><br><span class="line"> Route: /pooling, Methods: POST</span><br><span class="line"> Route: /score, Methods: POST</span><br><span class="line"> Route: /v1/score, Methods: POST</span><br><span class="line"> Route: /v1/audio/transcriptions, Methods: POST</span><br><span class="line"> Route: /rerank, Methods: POST</span><br><span class="line"> Route: /v1/rerank, Methods: POST</span><br><span class="line"> Route: /v2/rerank, Methods: POST</span><br><span class="line"> Route: /invocations, Methods: POST</span><br><span class="line">INFO:     Started server process [1]</span><br><span class="line">INFO:     Waiting for application startup.</span><br><span class="line">INFO:     Application startup complete.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> llm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sinppet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes RBAC</title>
      <link href="/2025/03/01/kubernetes%20RBAC/"/>
      <url>/2025/03/01/kubernetes%20RBAC/</url>
      
        <content type="html"><![CDATA[<blockquote><p>RBAC (Role-Based Access Control) in Kubernetes is a security model that controls who can access and perform actions on resources (like Pods, Deployments, Services, etc.) within a cluster.</p></blockquote><h1 id="Component"><a href="#Component" class="headerlink" title="Component"></a>Component</h1><p>Kubernetes RBAC consists of four main components:</p><table><thead><tr><th>Component</th><th>Description</th></tr></thead><tbody><tr><td>Role / ClusterRole</td><td>Defines what actions (verbs) can be performed on which resources.</td></tr><tr><td>RoleBinding / ClusterRoleBinding</td><td>Grants a Role or ClusterRole to a User, Group, or ServiceAccount.</td></tr><tr><td>Subjects (Users, Groups, ServiceAccounts)</td><td>Who is allowed to perform actions (User, Group, or ServiceAccount).</td></tr><tr><td>Resources &amp; API Groups</td><td>The objects that can be controlled (e.g., pods, deployments, services, etc.).</td></tr></tbody></table><h2 id="Role-amp-ClusterRole"><a href="#Role-amp-ClusterRole" class="headerlink" title="Role &amp; ClusterRole"></a>Role &amp; ClusterRole</h2><blockquote><p>RBAC defines what actions can be performed on which resources using Roles and ClusterRoles.</p></blockquote><h3 id="Role"><a href="#Role" class="headerlink" title="Role"></a>Role</h3><blockquote><p>A Role is used for namespace-scoped access control.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">my-namespace</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br></pre></td></tr></table></figure><p>âœ… This Role allows a user to view (get, list, watch) Pods only in the namespace my-namespace.</p><p>âŒ This does not grant access to other namespaces.</p><h3 id="ClusterRole"><a href="#ClusterRole" class="headerlink" title="ClusterRole"></a>ClusterRole</h3><blockquote><p> A ClusterRole is used for cluster-wide permissions or permissions across all namespaces.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-pod-reader</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br></pre></td></tr></table></figure><p>âœ… This allows viewing (get, list, watch) Pods in all namespaces.</p><h2 id="RoleBinding-amp-ClusterRoleBinding"><a href="#RoleBinding-amp-ClusterRoleBinding" class="headerlink" title="RoleBinding &amp; ClusterRoleBinding"></a>RoleBinding &amp; ClusterRoleBinding</h2><blockquote><p>Who Gets These Permissions?</p></blockquote><h3 id="RoleBinding"><a href="#RoleBinding" class="headerlink" title="RoleBinding"></a>RoleBinding</h3><blockquote><p>A RoleBinding assigns a Role to a specific user, group, or ServiceAccount in a namespace.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">my-namespace</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-user</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure><p>âœ… This binds the pod-reader Role to my-user in the my-namespace namespace.</p><p>âŒ It does not grant permissions outside my-namespace.</p><h3 id="ClusterRoleBinding"><a href="#ClusterRoleBinding" class="headerlink" title="ClusterRoleBinding"></a>ClusterRoleBinding</h3><blockquote><p>A ClusterRoleBinding assigns a ClusterRole to a User, Group, or ServiceAccount across all namespaces.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-pod-reader-binding</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-user</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-pod-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure><p>âœ… This grants my-user access to Pods across all namespaces.</p><h2 id="Subjects"><a href="#Subjects" class="headerlink" title="Subjects"></a>Subjects</h2><blockquote><p>A RoleBinding or ClusterRoleBinding grants permissions to a subject, which can be:</p></blockquote><table><thead><tr><th>Subject Type</th><th>Description</th></tr></thead><tbody><tr><td>User</td><td>A real human user (external identity).</td></tr><tr><td>Group</td><td>A group of users (e.g., dev-team).</td></tr><tr><td>ServiceAccount</td><td>An internal Kubernetes identity for a Pod or Controller.</td></tr></tbody></table><p>Example: Binding a ServiceAccount (my-sa) to a Role</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-sa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">my-namespace</span></span><br></pre></td></tr></table></figure><h2 id="API-Groups-amp-Resources"><a href="#API-Groups-amp-Resources" class="headerlink" title="API Groups &amp; Resources"></a>API Groups &amp; Resources</h2><p>Each RBAC rule specifies which resources in which API groups can be accessed.</p><table><thead><tr><th>API Group</th><th>Resources Example</th></tr></thead><tbody><tr><td>â€œâ€ (core)</td><td>pods, services, nodes</td></tr><tr><td>apps</td><td>deployments, daemonsets</td></tr><tr><td>batch</td><td>jobs, cronjobs</td></tr><tr><td>rbac.authorization.k8s.io</td><td>roles, rolebindings, clusterroles, clusterrolebindings</td></tr></tbody></table><p>Example: Allow Access to Pods, Deployments, and Nodes</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>, <span class="string">&quot;services&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;deployments&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>]</span><br></pre></td></tr></table></figure><p>âœ… Allows reading Pods and Services (core API group).</p><p>âœ… Allows reading Deployments (apps API group).</p><p>âœ… Allows reading Nodes (core API group).</p><h1 id="Works-Scenario"><a href="#Works-Scenario" class="headerlink" title="Works Scenario"></a>Works Scenario</h1><h2 id="Scenario-1"><a href="#Scenario-1" class="headerlink" title="Scenario 1"></a>Scenario 1</h2><p>Use Case:</p><ul><li><p>A user (dev-user) needs read-only access to Pods in the dev namespace.</p></li><li><p>The ServiceAccount (cicd-runner-sa) needs to create Deployments in the cicd namespace.</p></li></ul><p>Solution: Define the RBAC Rules</p><ol><li>Create a Role for Read-Only Pod Access in dev Namespace</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br></pre></td></tr></table></figure><ol start="2"><li>Bind the Role to dev-user in dev Namespace</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-user</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure><ol start="3"><li>Create a Role for cicd-runner-sa to Deploy Apps in cicd Namespace</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deployment-creator</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">cicd</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;deployments&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br></pre></td></tr></table></figure><ol start="4"><li>Bind the Role to the cicd-runner-sa ServiceAccount</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cicd-runner-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">cicd</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cicd-runner-sa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">cicd</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deployment-creator</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure><h2 id="Scenario-2"><a href="#Scenario-2" class="headerlink" title="Scenario 2"></a>Scenario 2</h2><p>Scenario: Grant Read-Only Access to Pods Across Multiple Namespaces</p><p>Use Case:</p><ul><li><p>A developer team needs read-only access to Pods in multiple namespaces (dev, staging, prod).</p></li><li><p>Instead of creating separate Roles in each namespace, we use one ClusterRole.</p></li><li><p>We then create RoleBindings in each namespace to assign the ClusterRole.</p></li></ul><ol><li>Create a ClusterRole to Read Pods Across Namespaces</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">multi-namespace-pod-reader</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br></pre></td></tr></table></figure><ol start="2"><li>Bind the ClusterRole to a User for Multiple Namespaces</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">multi-namespace-pod-reader-binding</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">developer-user</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">multi-namespace-pod-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure><h1 id="Recap"><a href="#Recap" class="headerlink" title="Recap"></a>Recap</h1><p>Key Takeaways from Kubernetes RBAC Architecture</p><ol><li><p>Role / ClusterRole â†’ Defines permissions (what actions are allowed?).</p></li><li><p>RoleBinding / ClusterRoleBinding â†’ Assigns permissions (who gets access?).</p></li><li><p>Subjects â†’ Users, Groups, ServiceAccounts (who is authorized?).</p></li><li><p>API Groups â†’ Determines resources that can be controlled.</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RBAC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>podman snippet</title>
      <link href="/2025/02/10/podman%20snippet/"/>
      <url>/2025/02/10/podman%20snippet/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¸åŒç”¨æˆ·ä¸‹æ‰§è¡Œ <code>podman ps</code>ï¼Œåªèƒ½æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è¿è¡Œå®¹å™¨ï¼ˆå³ä½¿æ˜¯rootç”¨æˆ·ï¼Œä¹Ÿä¸èƒ½æŸ¥çœ‹å…¶ä»–æ™®é€šç”¨æˆ·å¯ç”¨çš„å®¹å™¨ä¿¡æ¯ï¼‰</p></blockquote><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><h2 id="image"><a href="#image" class="headerlink" title="image"></a>image</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> load tar file to image</span></span><br><span class="line">podman load -i &lt;image-tar-file&gt;</span><br></pre></td></tr></table></figure><h1 id="best-practices"><a href="#best-practices" class="headerlink" title="best practices"></a>best practices</h1><h2 id="change-default-data-dir"><a href="#change-default-data-dir" class="headerlink" title="change default data dir"></a>change default data dir</h2><ul><li><p><strong>rootful mode</strong> </p><blockquote><p>Default graphroot: /var/lib/containers/storage.</p></blockquote></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">podman info | grep &#x27;GraphRoot&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Edit Podmanâ€™s Storage Configuration</span></span><br><span class="line">sudo mkdir -p /etc/containers</span><br><span class="line">sudo vim /etc/containers/storage.conf # rootç”¨æˆ·é»˜è®¤é‡‡ç”¨çš„é…ç½®</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> edit storage.conf</span></span><br><span class="line">[storage]</span><br><span class="line">driver = &quot;overlay&quot;</span><br><span class="line">graphroot = &quot;/mnt/podman-root-data&quot;</span><br></pre></td></tr></table></figure><ul><li><p><strong>rootless mode</strong></p><blockquote><p>Default graphroot: ~/.local/share/containers/storage.</p></blockquote></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">podman info | grep &#x27;GraphRoot&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Edit Podmanâ€™s Storage Configuration</span></span><br><span class="line">sudo mkdir -p ~/.config/containers</span><br><span class="line">sudo vim ~/.config/containers/storage.conf   # æ™®é€šç”¨æˆ·é»˜è®¤é‡‡ç”¨çš„é…ç½®</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> edit storge.conf</span></span><br><span class="line">[storage]</span><br><span class="line">driver = &quot;overlay&quot;</span><br><span class="line">graphroot = &quot;/mnt/podman-&lt;userName&gt;-data&quot; # æ™®é€šç”¨æˆ·å’Œrootç”¨æˆ·çš„æ•°æ®å¿…é¡»è¦åŒºåˆ†å¼€ï¼Œä¸ç„¶ä¼šæœ‰ç›®å½•æƒé™æ“ä½œçš„é—®é¢˜</span><br></pre></td></tr></table></figure><h1 id="troubleshooting"><a href="#troubleshooting" class="headerlink" title="troubleshooting"></a>troubleshooting</h1><h2 id="potentially-insufficient-UIDs-or-GIDs-available-in-user-namespace"><a href="#potentially-insufficient-UIDs-or-GIDs-available-in-user-namespace" class="headerlink" title="potentially insufficient UIDs or GIDs available in user namespace"></a>potentially insufficient UIDs or GIDs available in user namespace</h2><blockquote><p> If the requested UID/GID still falls outside or Podman needs more mappings, you can edit /etc/subuid and /etc/subgid (as root) to increase the range</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Increase UID/GID Range (Optional):</span></span><br><span class="line">sudo vim /etc/subuid  # dingofs:60000:131072</span><br><span class="line">sudo vim /etc/subgid  # dingofs:60000:131072</span><br><span class="line"></span><br><span class="line">podman system migrate</span><br></pre></td></tr></table></figure><h2 id="error-while-loading-shared-libraries"><a href="#error-while-loading-shared-libraries" class="headerlink" title="error while loading shared libraries"></a>error while loading shared libraries</h2><blockquote><p>when execute â€˜podman run -it â€“entrypoint bash xxxâ€™, occur â€˜bash: error while loading shared libraries: /usr/lib64/libc.so.6: cannot apply additional memory protection after relocation: Permission deniedâ€™</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo setenforce 0</span><br></pre></td></tr></table></figure><h2 id="ulimit-open-files-cannot-modify-limit-Operation-not-permitted"><a href="#ulimit-open-files-cannot-modify-limit-Operation-not-permitted" class="headerlink" title="ulimit: open files: cannot modify limit: Operation not permitted"></a>ulimit: open files: cannot modify limit: Operation not permitted</h2><blockquote><p>use regular use could not operate ulimit command</p></blockquote><ol><li><p>Set ulimit when starting the container</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">podman run -it --ulimit nofile=1048576:1048576 your_image</span><br></pre></td></tr></table></figure></li><li><p>Adjust host user limits (Edit <code>/etc/security/limits.conf</code> as root)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">your_username soft nofile 1048576</span><br><span class="line">your_username hard nofile 1048576</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> podman </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph rados</title>
      <link href="/2025/02/08/ceph%20rados/"/>
      <url>/2025/02/08/ceph%20rados/</url>
      
        <content type="html"><![CDATA[<p>The <a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph-Storage-Cluster">Ceph Storage Cluster</a> provides the basic storage service that allows <a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph">Ceph</a> to uniquely deliver <strong>object, block, and file storage</strong> in one unified system. However, you are not limited to using the RESTful, block, or POSIX interfaces. Based upon RADOS, the <code>librados</code> API enables you to create your own interface to the Ceph Storage Cluster.</p><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list objects by specify pool</span></span><br><span class="line">rados -p &lt;pool-name&gt; ls</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">read</span> object</span></span><br><span class="line">rados -p &lt;pool-name&gt; get &lt;object-name&gt; output.txt</span><br><span class="line">cat output.txt</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check xattr value</span></span><br><span class="line">rados -p &lt;pool-name&gt; getxattr &lt;object-name&gt; &lt;xattr-key&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> storage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph deploy</title>
      <link href="/2025/02/07/ceph%20deploy/"/>
      <url>/2025/02/07/ceph%20deploy/</url>
      
        <content type="html"><![CDATA[<h1 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h1><h2 id="install-cephadm"><a href="#install-cephadm" class="headerlink" title="install cephadm"></a>install cephadm</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf search release-ceph</span><br><span class="line">dnf install --assumeyes centos-release-ceph-reef</span><br><span class="line">dnf install --assumeyes cephadm</span><br></pre></td></tr></table></figure><h3 id="enable-ceph-cli"><a href="#enable-ceph-cli" class="headerlink" title="enable ceph cli"></a>enable ceph cli</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cephadm add-repo --release reef</span><br><span class="line">cephadm install ceph-common</span><br></pre></td></tr></table></figure><p><strong>troubleshooting</strong></p><ul><li><p><code>yum: stderr  - nothing provides libcrypto.so.3(OPENSSL_3.4.0)(64bit) needed by ceph-common-2:18.2.7-2.el9s.x86_64 from centos-ceph-reef</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y ceph-common --nobest</span><br></pre></td></tr></table></figure></li></ul><h2 id="booststrap"><a href="#booststrap" class="headerlink" title="booststrap"></a>booststrap</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cephadm bootstrap --mon-ip 172.20.7.232</span><br></pre></td></tr></table></figure><ul><li>log<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Ceph Dashboard is now available at:</span><br><span class="line">        URL: https://dingo7232.com:8443/</span><br><span class="line">        User: admin</span><br><span class="line">    Password: &lt;password&gt;</span><br><span class="line">Enabling client.admin keyring and conf on hosts with &quot;admin&quot; label</span><br><span class="line">Saving cluster configuration to /var/lib/ceph/6a65c746-e532-11ef-8ac2-fa7c097efb00/config directory</span><br><span class="line">Enabling autotune for osd_memory_target</span><br><span class="line">You can access the Ceph CLI as following in case of multi-cluster or non-default config:</span><br><span class="line">        sudo /sbin/cephadm shell --fsid 6a65c746-e532-11ef-8ac2-fa7c097efb00 -c /etc/ceph/ceph.conf -k /etc/ceph/ceph.client.admin.keyring</span><br><span class="line">Or, if you are only running a single cluster on this host:</span><br><span class="line">        sudo /sbin/cephadm shell</span><br><span class="line">Please consider enabling telemetry to help improve Ceph:</span><br><span class="line">        ceph telemetry on</span><br><span class="line">For more information see:</span><br><span class="line">        https://docs.ceph.com/en/latest/mgr/telemetry/</span><br><span class="line">Bootstrap complete.</span><br></pre></td></tr></table></figure></li></ul><h2 id="add-hosts"><a href="#add-hosts" class="headerlink" title="add hosts"></a>add hosts</h2><ul><li><p>Install the clusterâ€™s public SSH key in the new hostâ€™s root userâ€™s authorized_keys file:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -f -i /etc/ceph/ceph.pub root@dingo7233</span><br><span class="line">ssh-copy-id -f -i /etc/ceph/ceph.pub root@dingo7234</span><br></pre></td></tr></table></figure></li><li><p>Tell Ceph that the new node is part of the cluster</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ceph orch host add *&lt;newhost&gt;* [*&lt;ip&gt;*] [*&lt;label1&gt; ...*]</span></span><br><span class="line">ceph orch host add dingo7233 172.20.7.233</span><br><span class="line">ceph orch host add dingo7234 172.20.7.234</span><br><span class="line">or</span><br><span class="line">ceph orch host add dingo7233 172.20.7.233 --labels _admin</span><br><span class="line">ceph orch host add dingo7234 172.20.7.234 --labels _admin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> after add host, should <span class="built_in">wait</span> some minutes <span class="keyword">for</span> host<span class="string">&#x27;s container bootstrap</span></span></span><br></pre></td></tr></table></figure></li><li><p>add label (optional)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph orch host label add dingo7233 _admin</span><br><span class="line">ceph orch host label add dingo7234 _admin</span><br></pre></td></tr></table></figure></li><li><p>list hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph orch host ls --detail</span><br></pre></td></tr></table></figure></li></ul><h2 id="deploy-osd"><a href="#deploy-osd" class="headerlink" title="deploy osd"></a>deploy osd</h2><ul><li><p>check available devices</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph orch device ls</span><br></pre></td></tr></table></figure></li><li><p>apply osd</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ceph orch apply osd --all-available-devices</span><br><span class="line"><span class="meta">#</span><span class="bash"> or add specify device</span></span><br><span class="line">ceph orch daemon add osd dingo-dongwei-1:/dev/vdc</span><br></pre></td></tr></table></figure></li></ul><h2 id="deploy-rgw"><a href="#deploy-rgw" class="headerlink" title="deploy rgw"></a>deploy rgw</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> to deploy 2 RGW daemons (the default)</span> </span><br><span class="line">ceph orch apply rgw &lt;rgwName&gt;</span><br><span class="line">or </span><br><span class="line"><span class="meta">#</span><span class="bash"> apply specify host with rgw</span></span><br><span class="line">ceph orch host label add &lt;hostName&gt; &lt;labelName&gt;  # the labelName could be &#x27;rgw&#x27; label or any other name</span><br><span class="line">ceph orch apply rgw &lt;rgwName&gt; &#x27;--placement=label:&lt;labelName&gt; count-per-host:2&#x27; --port=8000</span><br></pre></td></tr></table></figure><h1 id="check"><a href="#check" class="headerlink" title="check"></a>check</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ceph status</span></span><br><span class="line">cluster:</span><br><span class="line">    id:     6a65c746-e532-11ef-8ac2-fa7c097efb00</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            1 mgr modules have recently crashed</span><br><span class="line"></span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum dingo7232,dingo7234,dingo7233 (age 16m)</span><br><span class="line">    mgr: dingo7232.znvodw(active, since 24m), standbys: dingo7234.yenqrt</span><br><span class="line">    osd: 3 osds: 3 up (since 15m), 3 in (since 15m)</span><br><span class="line"></span><br><span class="line">  data:</span><br><span class="line">    pools:   1 pools, 1 pgs</span><br><span class="line">    objects: 2 objects, 449 KiB</span><br><span class="line">    usage:   81 MiB used, 600 GiB / 600 GiB avail</span><br><span class="line">    pgs:     1 active+clean</span><br></pre></td></tr></table></figure><h1 id="thouble-shooting"><a href="#thouble-shooting" class="headerlink" title="thouble shooting"></a>thouble shooting</h1><h2 id="redeploy-cluster"><a href="#redeploy-cluster" class="headerlink" title="redeploy cluster"></a>redeploy cluster</h2><p>To remove an existing Ceph cluster deployed using <code>cephadm</code> and redeploy a new one, follow these steps:</p><ul><li>Step 1: Stop All Ceph Services</li></ul><p>First, stop all Ceph services on each host in the cluster.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop ceph.target</span><br></pre></td></tr></table></figure><ul><li>Step 2: Remove Ceph Configuration and Data</li></ul><p>Remove the Ceph configuration and data directories.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /etc/ceph</span><br><span class="line">sudo rm -rf /var/lib/ceph</span><br><span class="line">sudo rm -rf /var/<span class="built_in">log</span>/ceph</span><br></pre></td></tr></table></figure><ul><li><p>Step 3: deploy as below words</p></li><li><p>Step 4: Verify Cluster Health</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph -s</span><br></pre></td></tr></table></figure></li></ul><p>If you encounter any issues during the redeployment, check the logs:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl -u ceph-* -f</span><br></pre></td></tr></table></figure><p>Or check the Ceph logs directly:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo less /var/<span class="built_in">log</span>/ceph/ceph.log</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> deploy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux A vs B</title>
      <link href="/2025/01/22/linux%20A%20vs%20B/"/>
      <url>/2025/01/22/linux%20A%20vs%20B/</url>
      
        <content type="html"><![CDATA[<h1 id="Systemd-limits-vs-PAM-limits"><a href="#Systemd-limits-vs-PAM-limits" class="headerlink" title="Systemd limits vs PAM limits"></a>Systemd limits vs PAM limits</h1><p><strong>Systemd limits</strong> and <strong>PAM limits</strong> are two different ways of configuring resource limits in Linux. They control aspects like <strong>open file limits (<strong>nofile</strong>)</strong>, <strong>memory</strong>, and <strong>CPU usage</strong>, but they work at different levels of the system.</p><h2 id="PAM-Limits"><a href="#PAM-Limits" class="headerlink" title="PAM Limits"></a>PAM Limits</h2><p>PAM (Pluggable Authentication Module) sets limits when <strong>a user logs in</strong> via <strong>SSH, TTY, or GUI login</strong>. It does <strong>not</strong> apply to system services. </p><p><strong>Configuration:</strong></p><ul><li><p>/etc/security/limits.conf</p></li><li><p>/etc/security/limits.d/*.conf</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Example (/etc/security/limits.conf or /etc/security/limits.d/custom.conf):**</span></span><br><span class="line">dongw soft nofile 65535</span><br><span class="line">dongw hard nofile 65535</span><br></pre></td></tr></table></figure><p><strong>Limitations of PAM:</strong></p><ul><li><p>Only affects interactive logins (TTY, SSH, GUI).</p></li><li><p>Does <strong>not</strong> apply to systemd-managed services.</p></li></ul><h2 id="Systemd-Limits"><a href="#Systemd-Limits" class="headerlink" title="Systemd Limits"></a>Systemd Limits</h2><p>Systemd sets limits <strong>for system services and user sessions</strong>. It applies to <strong>both login sessions and system services</strong>, making it more powerful than PAM.</p><p><strong>Configuration:</strong></p><ul><li><p><strong>Global (for all services and users)</strong>:</p></li><li><p>/etc/systemd/system.conf (system-wide limits)</p></li><li><p>/etc/systemd/user.conf (per-user session limits)</p></li><li><p><strong>Per-service limits</strong> (for specific services):</p></li><li><p>/etc/systemd/system/<service>.service</p></li></ul><h3 id="Global-Limits"><a href="#Global-Limits" class="headerlink" title="Global Limits"></a>Global Limits</h3><p>Applies to <strong>all</strong> processes managed by systemd. (/etc/systemd/system.conf or /etc/systemd/user.conf)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DefaultLimitNOFILE=65535</span><br></pre></td></tr></table></figure><h3 id="Per-Service-Limits"><a href="#Per-Service-Limits" class="headerlink" title="Per-Service Limits"></a>Per-Service Limits</h3><p> This applies to only on specify service. (e.g. /etc/systemd/system/myservice.service)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">LimitNOFILE=65535</span><br></pre></td></tr></table></figure><p><strong>Advantages of Systemd Limits:</strong></p><ul><li><p>Affects <strong>both user logins and system services</strong>.</p></li><li><p>Ensures limits persist across <strong>system reboots</strong>.</p></li><li><p>More reliable for applications like Ceph, Docker, and databases.</p></li></ul><h2 id="Comparison-Table"><a href="#Comparison-Table" class="headerlink" title="Comparison Table"></a><strong>Comparison Table</strong></h2><table><thead><tr><th align="left"><strong>Feature</strong></th><th><strong>PAM Limits (<code>limits.conf</code>)</strong></th><th><strong>Systemd Limits (<code>system.conf</code>/<code>.service</code>)</strong></th></tr></thead><tbody><tr><td align="left">Applies to interactive users</td><td>âœ… Yes (SSH, TTY, GUI)</td><td>âœ… Yes</td></tr><tr><td align="left">Applies to system services</td><td>âŒ No</td><td>âœ… Yes</td></tr><tr><td align="left">Persists across reboots</td><td>âœ… Yes</td><td>âœ… Yes</td></tr><tr><td align="left">Easy to configure</td><td>âœ… Yes</td><td>âœ… Yes</td></tr><tr><td align="left">Best for tuning servers</td><td>âš ï¸  Partial</td><td>âœ… Yes</td></tr></tbody></table><ul><li><p><strong>For interactive user sessions</strong> â†’ Use <strong>PAM (<strong>limits.conf</strong>)</strong>.</p></li><li><p><strong>For system services and all users</strong> â†’ Use <strong>Systemd (<strong>system.conf</strong>,</strong> .service**)**.</p></li><li><p><strong>For the best persistence and reliability</strong>, configure <strong>both</strong>.</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> A vs B </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux tune</title>
      <link href="/2025/01/21/linux%20tune/"/>
      <url>/2025/01/21/linux%20tune/</url>
      
        <content type="html"><![CDATA[<h1 id="cpu"><a href="#cpu" class="headerlink" title="cpu"></a>cpu</h1><h2 id="governor-strategy"><a href="#governor-strategy" class="headerlink" title="governor strategy"></a>governor strategy</h2><ul><li><p>Check Available CPU Governors</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Run the following <span class="built_in">command</span> to check available CPU governors:</span></span><br><span class="line">cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You should see something like below info:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> conservative ondemand userspace powersave performance schedutil</span></span><br></pre></td></tr></table></figure></li><li><p>Check Current CPU Governor</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor</span><br><span class="line">or</span><br><span class="line">cpupower frequency-info --policy # should install cpupower command by &#x27;sudo dnf install kernel-tools -y&#x27;</span><br></pre></td></tr></table></figure></li><li><p>Set CPU Governor to Performance temporarily</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> To temporarily <span class="built_in">set</span> the CPU governor to performance (until reboot):</span></span><br><span class="line">for cpu in /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor; do</span><br><span class="line">  echo performance | sudo tee $cpu</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li><li><p>Set CPU Governor Persistent</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> First, install cpupower:</span></span><br><span class="line">sudo dnf install kernel-tools -y</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Then, <span class="built_in">set</span> the governor:</span></span><br><span class="line">sudo cpupower frequency-set -g performance</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To apply this setting at boot, <span class="built_in">enable</span> the service:</span></span><br><span class="line">sudo systemctl enable --now cpupower.service</span><br></pre></td></tr></table></figure></li></ul><h1 id="nvme"><a href="#nvme" class="headerlink" title="nvme"></a>nvme</h1><h2 id="I-O-scheduler"><a href="#I-O-scheduler" class="headerlink" title="I/O scheduler"></a>I/O scheduler</h2><ul><li><p>check current scheduler pattern</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/block/nvme[01]\*/queue/scheduler</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> console <span class="built_in">print</span> below info</span></span><br><span class="line">none [mq-deadline] kyber bfq</span><br></pre></td></tr></table></figure><p>The <strong>scheduler currently in use</strong> is indicated by the square brackets [ ].</p><p><strong>Common NVMe I/O Schedulers</strong></p><ol><li><p><strong>none</strong> â€“ Default for NVMe, provides minimal latency.</p></li><li><p><strong>mq-deadline</strong> â€“ Multi-queue deadline scheduler, balances fairness and performance.</p></li><li><p><strong>kyber</strong> â€“ Optimized for high-performance SSDs.</p></li><li><p><strong>bfq</strong> â€“ Budget Fair Queueing, useful for low-latency workloads.</p></li></ol></li><li><p>Change the I/O Scheduler</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> To <span class="built_in">set</span> the none scheduler <span class="keyword">for</span> nvme0n1, use:</span></span><br><span class="line">echo none | sudo tee /sys/block/nvme0n1/queue/scheduler</span><br></pre></td></tr></table></figure><p><strong>When to Change the Scheduler?</strong></p><ul><li><p>Use none <strong>(default)</strong> if latency is the priority (most NVMe drives handle queuing internally).</p></li><li><p>Use mq-deadline if fairness in I/O operations is needed.</p></li><li><p>Use kyber for workloads requiring fast response time.</p></li><li><p>Use bfq for interactive desktop workloads.</p></li></ul></li></ul><h1 id="ulimit"><a href="#ulimit" class="headerlink" title="ulimit"></a>ulimit</h1><h2 id="open-file-size"><a href="#open-file-size" class="headerlink" title="open file size"></a>open file size</h2><blockquote><p>To configure the <strong>maximum open file size</strong> (ulimit) for a specific user </p></blockquote><ul><li><p>Check Current Limits</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> To see the current limits <span class="keyword">for</span> a user:</span></span><br><span class="line">ulimit -n # Check open file limit</span><br><span class="line">ulimit -a # Check all limits</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To check system-wide limits:</span></span><br><span class="line">cat /proc/sys/fs/file-max</span><br></pre></td></tr></table></figure></li><li><p>Set Open File Limits for a Specific User</p><blockquote><p>The changes in limits.conf are only applied to new login sessions</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/security/limits.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Add the following lines (replace username with the actual user):</span></span><br><span class="line">username soft nofile 65535</span><br><span class="line">username hard nofile 65535</span><br></pre></td></tr></table></figure></li></ul><p>â€‹    <strong>soft</strong>: The default limit the user gets.</p><p>â€‹    <strong>hard</strong>: The maximum limit a user can set.</p><table><thead><tr><th>Feature</th><th>/etc/security/limits.conf</th><th>/etc/security/limits.d/*.conf</th></tr></thead><tbody><tr><td><strong>Default File</strong></td><td>Yes</td><td>No (Custom files in limits.d directory)</td></tr><tr><td><strong>Priority</strong></td><td>Read first</td><td>Read after limits.conf</td></tr><tr><td><strong>Organization</strong></td><td>All rules in one file</td><td>Modular approach, one file per service or user</td></tr><tr><td><strong>Example</strong></td><td><code>* soft nofile 65536</code></td><td><code>dongw soft nofile 65536</code> (in <code>/etc/security/limits.d/dongw.conf</code>)</td></tr><tr><td><strong>Syntax</strong></td><td>Same syntax for both files</td><td>Same syntax as limits.conf</td></tr></tbody></table><h1 id="HP-and-THP"><a href="#HP-and-THP" class="headerlink" title="HP and THP"></a>HP and THP</h1><blockquote><p>Huge Pages (HP) and Transparent Huge Pages (THP)</p></blockquote><p>Understanding Huge Pages (HP) and Transparent Huge Pages (THP)</p><p><strong>Huge Pages (HP)</strong>: A manually configured fixed-size memory allocation system, beneficial for workloads that require large contiguous memory allocations.</p><p><strong>Transparent Huge Pages (THP)</strong>: An automated memory management feature that dynamically allocates large memory pages based on usage patterns.</p><p>for performance-sensitive applications, THP can sometimes cause performance issues due to fragmentation and unexpected latency spikes. Thus, itâ€™s often recommended to <strong>disable THP</strong> and manually configure HP.</p><ul><li><p>Checking Current Huge Pages Configuration</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/meminfo | grep HugePages</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Example output:</span></span><br><span class="line">AnonHugePages:  16850944 kB # Memory allocated via THP.</span><br><span class="line">ShmemHugePages:        0 kB</span><br><span class="line">FileHugePages:         0 kB</span><br><span class="line">HugePages_Total:       0 # Number of configured huge pages.</span><br><span class="line">HugePages_Free:        0 # Available huge pages.</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br></pre></td></tr></table></figure></li><li><p>Configuring Static Huge Pages</p><p><strong>Step 1: Set the Number of Huge Pages</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> To allocate a specific number of 2MB huge pages, calculate based on your memory requirements. Example:</span></span><br><span class="line">echo 1024 | sudo tee /proc/sys/vm/nr_hugepages</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Make it persistent:</span></span><br><span class="line">echo &quot;vm.nr_hugepages=1024&quot; | sudo tee -a /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><p><strong>Step 2: Allocate Huge Pages at Boot (Recommended)</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/grub</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Add hugepages kernel parameter:</span></span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;default_hugepagesz=2M hugepagesz=2M hugepages=1024&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Update GRUB:</span></span><br><span class="line">sudo grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Reboot the system:</span></span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p><strong>Step 3: Mount Huge Pages File System (Optional)</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> To <span class="built_in">enable</span> shared access to huge pages:</span></span><br><span class="line">mkdir -p /mnt/huge</span><br><span class="line">mount -t hugetlbfs nodev /mnt/huge</span><br><span class="line"><span class="meta">#</span><span class="bash"> To make this persistent, add to /etc/fstab:</span></span><br><span class="line">nodev /mnt/huge hugetlbfs defaults 0 0</span><br></pre></td></tr></table></figure></li><li><p>Disabling Transparent Huge Pages (THP)</p><p>THP should be <strong>disabled</strong> for performance-sensitive applications</p><p><strong>Step 1: Disable THP at Runtime</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo never | sudo tee /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo never | sudo tee /sys/kernel/mm/transparent_hugepage/defrag</span><br></pre></td></tr></table></figure><p><strong>Step 2: Make THP Disabled at Boot</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/grub</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Add:</span></span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;transparent_hugepage=never&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Update GRUB:</span></span><br><span class="line">sudo grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Reboot:</span></span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure></li><li><p>Verification After Reboot</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Check Huge Pages Allocation</span></span><br><span class="line">cat /proc/meminfo | grep HugePages</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check THP Status</span></span><br><span class="line">cat /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="meta">#</span><span class="bash"> Expected output:</span></span><br><span class="line">[always] madvise never</span><br></pre></td></tr></table></figure></li></ul><p>Summary: Should You Configure HP &amp; THP Together?</p><p>For performance-sensitive applications, itâ€™s recommended to <strong>disable THP</strong> and <strong>manually configure Huge Pages (HP)</strong> for better performance.</p><p>THP can cause latency spikes and memory fragmentation, making it less ideal for high-performance file systems.</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tune </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nvme</title>
      <link href="/2025/01/17/fs:%20nvme/"/>
      <url>/2025/01/17/fs:%20nvme/</url>
      
        <content type="html"><![CDATA[<h1 id="NVMe"><a href="#NVMe" class="headerlink" title="NVMe"></a>NVMe</h1><p><strong>NVMe (Non-Volatile Memory Express)</strong> is a high-performance storage protocol designed to take full advantage of the speed and efficiency offered by modern solid-state drives (SSDs), particularly those using <strong>NAND flash</strong> or <strong>3D NAND</strong> memory. It was developed to overcome the limitations of older storage protocols (such as SATA and SAS) by optimizing the interaction between the storage device and the CPU over faster interfaces like <strong>PCIe (Peripheral Component Interconnect Express)</strong>.</p><h2 id="1-What-NVMe-is"><a href="#1-What-NVMe-is" class="headerlink" title="1. What NVMe is"></a>1. What NVMe is</h2><p>NVMe is both a <strong>protocol</strong> and a <strong>standard</strong> for connecting <strong>non-volatile memory</strong> (such as NAND flash memory) directly to a computer system via high-speed interfaces, most commonly <strong>PCIe</strong>. It allows data to be transferred at much faster speeds compared to older storage protocols, enabling devices to reach their full potential and significantly reducing latency.</p><h2 id="2-Key-Advantages-of-NVMe"><a href="#2-Key-Advantages-of-NVMe" class="headerlink" title="2. Key Advantages of NVMe"></a>2. Key Advantages of NVMe</h2><ul><li><p><strong>Faster Speeds</strong>: NVMe takes full advantage of the high throughput and low latency of <strong>PCIe lanes</strong>. For example, the PCIe Gen 3.0 standard provides a maximum theoretical speed of about <strong>32 GB/s</strong> (using 16 lanes), while PCIe Gen 4.0 can offer speeds up to <strong>64 GB/s</strong>. NVMe drives can use multiple PCIe lanes (usually 4 or more) to transfer data simultaneously, making them vastly faster than older SATA SSDs or hard disk drives (HDDs).</p></li><li><p><strong>Low Latency</strong>: NVMeâ€™s protocol is optimized to handle thousands of input/output operations per second (IOPS), resulting in very low latency (often measured in microseconds). This is crucial for applications requiring rapid access to large datasets, such as databases or high-performance computing tasks.</p></li><li><p><strong>Parallelism</strong>: NVMe is designed to support <strong>multi-core processors</strong> and can handle many more <strong>queues</strong> and <strong>commands</strong> simultaneously than previous protocols. It can support <strong>64K queues</strong>, each with up to <strong>64K commands</strong>, which is a huge improvement over the older <strong>SATA</strong> interface, which could handle only one queue with a limited number of commands.</p></li><li><p><strong>Efficiency</strong>: NVMe uses a streamlined protocol that minimizes overhead. SATA and SAS, by comparison, were originally designed for spinning hard drives and include more layers of abstraction that slow down communication.</p></li></ul><h2 id="3-NVMe-vs-SATA-SAS"><a href="#3-NVMe-vs-SATA-SAS" class="headerlink" title="3. NVMe vs. SATA/SAS"></a>3. NVMe vs. SATA/SAS</h2><ul><li><p><strong>SATA</strong> (Serial Advanced Technology Attachment) is an older protocol used mainly for connecting hard drives and SSDs. Itâ€™s limited by the speed of the interface itself (roughly <strong>600 MB/s</strong> max in the case of SATA III) and was designed when mechanical HDDs were the primary storage medium. Even with SSDs, the SATA interface is a bottleneck.</p></li><li><p><strong>SAS</strong> (Serial Attached SCSI) is often used in enterprise environments for high-reliability storage solutions, but it, too, has limitations in speed and efficiency compared to NVMe.</p></li></ul><h2 id="4-How-NVMe-Works"><a href="#4-How-NVMe-Works" class="headerlink" title="4. How NVMe Works"></a>4. How NVMe Works</h2><p>NVMe devices communicate directly with the CPU via PCIe, bypassing older storage controllers. The <strong>PCIe interface</strong> connects storage devices such as <strong>NVMe SSDs</strong> directly to the motherboard or via expansion cards, allowing faster and more direct data transfer.</p><p>NVMe itself is built around a <strong>command set</strong> that is designed for <strong>flash memory</strong>, as opposed to the traditional command sets used in older storage systems. This reduces unnecessary overhead and allows NVMe devices to process requests more quickly.</p><h2 id="5-NVMe-Form-Factors"><a href="#5-NVMe-Form-Factors" class="headerlink" title="5. NVMe Form Factors"></a>5. NVMe Form Factors</h2><p>There are several physical form factors for NVMe drives, including:</p><ul><li><p><strong>M.2</strong>: A small form factor typically used in laptops and desktops. It plugs directly into an M.2 slot on the motherboard, and modern M.2 NVMe drives can reach speeds of over <strong>7,000 MB/s</strong> with PCIe Gen 3.0 or Gen 4.0 support.</p></li><li><p><strong>U.2</strong>: A connector used for enterprise-class SSDs. These drives are often used in servers and data centers.</p></li><li><p><strong>Add-in Card (AIC)</strong>: These are full-sized PCIe cards that can be inserted into a motherboardâ€™s PCIe slot. They offer high storage capacity and performance, making them ideal for high-end workstations or servers.</p></li></ul><h2 id="6-Applications-of-NVMe"><a href="#6-Applications-of-NVMe" class="headerlink" title="6. Applications of NVMe"></a>6. Applications of NVMe</h2><ul><li><p><strong>Gaming</strong>: NVMe SSDs dramatically reduce game load times, texture rendering, and video streaming, providing a smoother gaming experience.</p></li><li><p><strong>Content Creation</strong>: Video editing, 3D rendering, and other high-bandwidth tasks benefit from the rapid access to large files.</p></li><li><p><strong>Data Centers</strong>: NVMe drives are ideal for enterprise storage solutions, especially when handling high-volume data throughput, real-time analytics, or AI workloads.</p></li><li><p><strong>Databases</strong>: NVMeâ€™s low latency and high throughput make it an excellent choice for applications involving large databases and data warehousing.</p></li></ul><h2 id="7-NVMe-and-PCIe-Versions"><a href="#7-NVMe-and-PCIe-Versions" class="headerlink" title="7. NVMe and PCIe Versions"></a>7. NVMe and PCIe Versions</h2><p>NVMeâ€™s performance scales with <strong>PCIe</strong> versions:</p><ul><li><p><strong>PCIe 3.0</strong> supports a maximum theoretical bandwidth of <strong>1 GB/s per lane</strong> (total of <strong>4 GB/s</strong> for a 4-lane SSD).</p></li><li><p><strong>PCIe 4.0</strong> doubles this bandwidth to <strong>2 GB/s per lane</strong> (total of <strong>8 GB/s</strong> for a 4-lane SSD).</p></li><li><p><strong>PCIe 5.0</strong> further increases the bandwidth to <strong>4 GB/s per lane</strong> (total of <strong>16 GB/s</strong> for a 4-lane SSD).</p></li></ul><h2 id="8-Conclusion"><a href="#8-Conclusion" class="headerlink" title="8. Conclusion"></a>8. Conclusion</h2><p>NVMe is revolutionizing storage by offering higher speeds, lower latency, and better scalability compared to older protocols. Whether for consumer laptops, high-performance desktops, or enterprise-level data centers, NVMe is fast becoming the go-to solution for anyone who demands top-tier storage performance.</p><h1 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h1><p>The relationship between <strong>NVMe</strong> and <strong>SSD</strong> is one of complementary technologies. Hereâ€™s a breakdown of how the two are related and how they differ:</p><h2 id="1-What-is-an-SSD"><a href="#1-What-is-an-SSD" class="headerlink" title="1. What is an SSD?"></a>1. What is an SSD?</h2><p><strong>SSD (Solid-State Drive)</strong> refers to a type of storage device that uses <strong>non-volatile flash memory</strong> (usually NAND flash) to store data, rather than the spinning platters and moving heads of traditional <strong>HDDs (Hard Disk Drives)</strong>. SSDs are much faster, more reliable, and use less power than HDDs, making them a popular choice for both consumer and enterprise storage solutions.</p><p><strong>SSDs can use various interfaces and protocols</strong> to communicate with the computer system. These include:</p><ul><li><p><strong>SATA (Serial ATA)</strong>: An older protocol, often used for <strong>SATA-based SSDs</strong>. While fast compared to HDDs, itâ€™s limited by the bandwidth of the SATA interface (roughly <strong>600 MB/s</strong>).</p></li><li><p><strong>SAS (Serial Attached SCSI)</strong>: A more advanced, enterprise-grade protocol used for connecting SSDs in servers.</p></li><li><p><strong>PCIe (Peripheral Component Interconnect Express)</strong>: A high-speed interface used by <strong>NVMe SSDs</strong>.</p></li></ul><h2 id="2-How-NVMe-and-SSDs-are-Related"><a href="#2-How-NVMe-and-SSDs-are-Related" class="headerlink" title="2. How NVMe and SSDs are Related"></a>2. How NVMe and SSDs are Related</h2><p>NVMe and SSDs are connected in the following way:</p><ul><li><p><strong>NVMe is a protocol for accessing and transferring data from an SSD</strong>. It is the language or set of instructions that defines how data moves between the SSD and the computerâ€™s CPU.</p></li><li><p><strong>SSD is the storage device</strong>, and it can use different interfaces and protocols (SATA, SAS, or PCIe). <strong>NVMe SSDs</strong> are SSDs that use the <strong>NVMe protocol over the PCIe interface</strong> to provide high-speed data transfer.</p></li></ul><h2 id="3-Key-Differences-Between-NVMe-SSDs-and-Other-SSDs"><a href="#3-Key-Differences-Between-NVMe-SSDs-and-Other-SSDs" class="headerlink" title="3. Key Differences Between NVMe SSDs and Other SSDs"></a>3. Key Differences Between NVMe SSDs and Other SSDs</h2><p>The main difference between <strong>NVMe SSDs</strong> and <strong>non-NVMe SSDs</strong> (like <strong>SATA SSDs</strong>) lies in the <strong>interface</strong> and <strong>protocol</strong> they use for data transfer:</p><ul><li><p><strong>NVMe SSDs</strong>:</p><ul><li><p><strong>Interface</strong>: Use <strong>PCIe</strong> lanes to communicate with the system.</p></li><li><p><strong>Protocol</strong>: Use the <strong>NVMe protocol</strong> to provide faster, more efficient data transfers.</p></li><li><p><strong>Speed</strong>: Much faster than SATA-based SSDs, as PCIe supports higher throughput.</p></li><li><p><strong>Latency</strong>: Lower latency compared to SATA SSDs, as NVMe is optimized for flash memory and can handle many more I/O operations in parallel.</p></li><li><p><strong>Form Factors</strong>: NVMe SSDs typically come in <strong>M.2</strong>, <strong>U.2</strong>, or <strong>Add-in Card</strong> (AIC) form factors.</p></li></ul></li><li><p><strong>Non-NVMe SSDs</strong> (e.g., <strong>SATA SSDs</strong>):</p><ul><li><p><strong>Interface</strong>: Use the <strong>SATA</strong> interface, which was originally designed for spinning hard drives.</p></li><li><p><strong>Protocol</strong>: Use the older <strong>SATA protocol</strong>, which is slower than NVMe.</p></li><li><p><strong>Speed</strong>: Limited to <strong>around 600 MB/s</strong> (the maximum bandwidth of SATA III).</p></li><li><p><strong>Latency</strong>: Higher latency compared to NVMe SSDs because of the older protocol and interface.</p></li><li><p><strong>Form Factor</strong>: Commonly come in <strong>2.5-inch</strong> or <strong>mSATA</strong> form factors, similar to the size of traditional HDDs.</p></li></ul></li></ul><h2 id="4-Performance-Comparison"><a href="#4-Performance-Comparison" class="headerlink" title="4. Performance Comparison"></a><strong>4. Performance Comparison</strong></h2><ul><li><p><strong>SATA SSDs</strong>:</p><ul><li><p>Maximum read/write speeds are capped at around <strong>550-600 MB/s</strong> due to the limitations of the <strong>SATA III interface</strong>.</p></li><li><p>Suitable for everyday consumer use, including boot drives, gaming, and regular workloads, but not optimal for high-performance or data-intensive tasks.</p></li></ul></li><li><p><strong>NVMe SSDs</strong>:</p><ul><li><p>The <strong>PCIe 3.0</strong> interface provides <strong>up to 4 GB/s</strong> of bandwidth for a 4-lane SSD, while <strong>PCIe 4.0</strong> can go up to <strong>8 GB/s</strong> or higher for consumer drives.</p></li><li><p><strong>Latency</strong> is much lower compared to SATA, with NVMe SSDs often providing sub-millisecond access times.</p></li><li><p>Ideal for <strong>high-end gaming</strong>, <strong>video editing</strong>, <strong>3D rendering</strong>, and other professional or enterprise-level applications that require quick access to large datasets.</p></li></ul></li></ul><h2 id="5-Form-Factor-and-Compatibility"><a href="#5-Form-Factor-and-Compatibility" class="headerlink" title="5. Form Factor and Compatibility"></a>5. Form Factor and Compatibility</h2><ul><li><p><strong>SATA SSDs</strong>: Often found in the <strong>2.5-inch form factor</strong> (similar to HDDs) and can be used in most computers and laptops with a SATA interface.</p></li><li><p><strong>NVMe SSDs</strong>: Use <strong>M.2</strong> or <strong>U.2</strong> form factors (for consumer or enterprise-level SSDs) and require a motherboard with an <strong>M.2 PCIe slot</strong> or a <strong>U.2 connector</strong> for compatibility. Some systems may require an adapter to support NVMe drives.</p></li></ul><h2 id="6-Summary-of-the-Relationship-Between-NVMe-and-SSD"><a href="#6-Summary-of-the-Relationship-Between-NVMe-and-SSD" class="headerlink" title="6. Summary of the Relationship Between NVMe and SSD"></a>6. Summary of the Relationship Between NVMe and SSD</h2><ul><li><p><strong>NVMe</strong> is a <strong>protocol</strong> designed to maximize the speed and efficiency of <strong>PCIe-based SSDs</strong>.</p></li><li><p><strong>SSD</strong> is a type of storage device that can use different interfaces like SATA, SAS, or PCIe, with <strong>NVMe SSDs</strong> specifically referring to <strong>SSDs that use the NVMe protocol</strong> over a <strong>PCIe interface</strong>.</p></li><li><p><strong>NVMe SSDs</strong> offer significant performance improvements (speed, latency, and scalability) over <strong>SATA SSDs</strong>, making them ideal for users with high-performance storage needs, such as gamers, content creators, and data centers.</p></li></ul><p>In short: <strong>NVMe SSD</strong> refers to a <strong>high-speed SSD</strong> that uses the <strong>NVMe protocol</strong> and <strong>PCIe interface</strong> for faster data transfer, while <strong>SATA SSDs</strong> use the older <strong>SATA interface</strong> and protocol, which are slower in comparison.</p>]]></content>
      
      
      <categories>
          
          <category> fs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nvme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph storage cluster</title>
      <link href="/2025/01/16/ceph%20storage/"/>
      <url>/2025/01/16/ceph%20storage/</url>
      
        <content type="html"><![CDATA[<h1 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h1><p>A Ceph Storage Cluster requires the following: at least one Ceph Monitor and at least one Ceph Manager, and at least as many <a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph-OSD">Ceph Object Storage Daemon</a>s (OSDs) as there are copies of a given object stored in the Ceph cluster (for example, if three copies of a given object are stored in the Ceph cluster, then at least three OSDs must exist in that Ceph cluster).</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    %% Define Ceph Components</span><br><span class="line">    subgraph &quot;Ceph Cluster&quot;</span><br><span class="line">        direction TB</span><br><span class="line">        OSDs[&quot;OSDs - Object Storage Daemons\n(Store and replicate data)&quot;]</span><br><span class="line">        Monitors[&quot;Monitors (MON) - Cluster Coordination\n(Maintain cluster map &amp; quorum)&quot;]</span><br><span class="line">        Managers[&quot;Managers (MGR) - Metrics &amp; Control\n(Provide monitoring, orchestration, and services)&quot;]</span><br><span class="line">        MDSs[&quot;MDSs - Metadata Servers\n(Manage CephFS metadata)&quot;]</span><br><span class="line">        RADOS[&quot;RADOS - Reliable Autonomic Distributed Object Store\n(Core distributed storage layer)&quot;]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    %% Relationships</span><br><span class="line">    OSDs --&gt;|Store &amp; Replicate Data| RADOS</span><br><span class="line">    Monitors --&gt;|Maintain Cluster State &amp; Quorum| RADOS</span><br><span class="line">    Managers --&gt;|Monitor, Orchestrate &amp; Provide Services| RADOS</span><br><span class="line">    MDSs --&gt;|Manage CephFS Metadata| RADOS</span><br><span class="line">    RADOS --&gt;|Foundation of Ceph Storage| Ceph-Cluster</span><br><span class="line"></span><br><span class="line">    %% Descriptions</span><br><span class="line">    subgraph &quot;Component Descriptions&quot;</span><br><span class="line">        direction TB</span><br><span class="line">        MDSs_Description[&quot;MDSs: Handle metadata for CephFS, enabling file system operations like directory listing and file creation.&quot;]</span><br><span class="line">        RADOS_Description[&quot;RADOS: Core storage layer ensuring data durability, fault tolerance, and scalability.&quot;]</span><br><span class="line">        OSDs_Description[&quot;OSDs: Store, replicate, and recover object data across the cluster.&quot;]</span><br><span class="line">        Monitors_Description[&quot;Monitors: Maintain cluster state, handle authentication, and ensure consensus.&quot;]</span><br><span class="line">        Managers_Description[&quot;Managers: Provide additional cluster management features, including dashboards, orchestration, and monitoring.&quot;]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    %% Link Descriptions to Components</span><br><span class="line">    MDSs --&gt; MDSs_Description</span><br><span class="line">    RADOS --&gt; RADOS_Description</span><br><span class="line">    OSDs --&gt; OSDs_Description</span><br><span class="line">    Monitors --&gt; Monitors_Description</span><br><span class="line">    Managers --&gt; Managers_Description</span><br></pre></td></tr></table></figure><ul><li><p><strong>Monitors</strong>: A <a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph-Monitor">Ceph Monitor</a> (<code>ceph-mon</code>) maintains maps of the cluster state, including the <a href="https://docs.ceph.com/en/reef/rados/operations/monitoring/#display-mon-map">monitor map</a>, manager map, the OSD map, the MDS map, and the CRUSH map. These maps are critical cluster state required for Ceph daemons to coordinate with each other. Monitors are also responsible for managing authentication between daemons and clients. At least three monitors are normally required for redundancy and high availability.</p></li><li><p><strong>Managers</strong>: A <a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph-Manager">Ceph Manager</a> daemon (<code>ceph-mgr</code>) is responsible for keeping track of runtime metrics and the current state of the Ceph cluster, including storage utilization, current performance metrics, and system load. The Ceph Manager daemons also host python-based modules to manage and expose Ceph cluster information, including a web-based <a href="https://docs.ceph.com/en/reef/mgr/dashboard/#mgr-dashboard">Ceph Dashboard</a> and <a href="https://docs.ceph.com/en/mgr/restful">REST API</a>. At least two managers are normally required for high availability.</p></li><li><p><strong>Ceph OSDs</strong>: An Object Storage Daemon (<a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph-OSD">Ceph OSD</a>, <code>ceph-osd</code>) stores data, handles data replication, recovery, rebalancing, and provides some monitoring information to Ceph Monitors and Managers by checking other Ceph OSD Daemons for a heartbeat. At least three Ceph OSDs are normally required for redundancy and high availability.</p></li><li><p><strong>MDSs</strong>: A <a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph-Metadata-Server">Ceph Metadata Server</a> (MDS, <code>ceph-mds</code>) stores metadata for the <a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph-File-System">Ceph File System</a>. Ceph Metadata Servers allow CephFS users to run basic commands (like <code>ls</code>, <code>find</code>, etc.) without placing a burden on the Ceph Storage Cluster.</p></li><li><p><strong>RADOS</strong>: (Reliable Autonomic Distributed Object Store) Any Cluster that supports <a href="https://docs.ceph.com/en/reef/glossary/#term-Ceph-Object-Storage">Ceph Object Storage</a> runs Ceph RADOS Gateway daemons (<code>radosgw</code>).</p></li></ul><h1 id="architecture"><a href="#architecture" class="headerlink" title="architecture"></a>architecture</h1><img src="/images/ceph/stack.webp" style="zoom: 60%"><h2 id="ceph-block-device"><a href="#ceph-block-device" class="headerlink" title="ceph block device"></a>ceph block device</h2><blockquote><p>RBD (Ceph Block Devices) </p></blockquote><img src="/images/ceph/block-device.webp" style="zoom: 60%"><p>Ceph block devices are thin-provisioned, resizable, and store data striped over multiple OSDs. Ceph block devices leverage RADOS capabilities including snapshotting, replication and strong consistency. Ceph block storage clients communicate with Ceph clusters through kernel modules or the <code>librbd</code> library.</p><h2 id="ceph-object-storage"><a href="#ceph-object-storage" class="headerlink" title="ceph object storage"></a>ceph object storage</h2><blockquote><p>RGW (Ceph Object Storage Gateway)</p></blockquote><img src="/images/ceph/object-storage.webp" style="zoom: 60%"><p>Ceph Object Storage uses the Ceph Object Gateway daemon (<code>radosgw</code>), an HTTP server designed to interact with a Ceph Storage Cluster. The Ceph Object Gateway provides interfaces that are compatible with both Amazon S3 and OpenStack Swift, and it has its own user management. Ceph Object Gateway can use a single Ceph Storage cluster to store data from Ceph File System and from Ceph Block device clients. The S3 API and the Swift API share a common namespace, which means that it is possible to write data to a Ceph Storage Cluster with one API and then retrieve that data with the other API.</p><h2 id="ceph-file-system"><a href="#ceph-file-system" class="headerlink" title="ceph file system"></a>ceph file system</h2><blockquote><p>cephFS</p></blockquote><img src="/images/ceph/cephfs.svg" style="zoom: 40%"><p>The Ceph File System, or CephFS, is a POSIX-compliant file system built on top of Cephâ€™s distributed object store, <strong>RADOS</strong>. CephFS endeavors to provide a state-of-the-art, multi-use, highly available, and performant file store for a variety of applications, including traditional use-cases like shared home directories, HPC scratch space, and distributed workflow shared storage.</p><h1 id="Storage-Interfaces"><a href="#Storage-Interfaces" class="headerlink" title="Storage Interfaces"></a>Storage Interfaces</h1><p>Ceph offers several â€œstorage interfacesâ€, which is another way of saying â€œways of storing dataâ€. These storage interfaces include: - <strong>CephFS</strong>(a file system) - <strong>RBD</strong> (block devices) - <strong>RADOS</strong> (an object store).</p><p>Deep down, though, all three of these are really RADOS object stores. CephFS and RBD are just presenting themselves as file systems and block devices.</p><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><h2 id="pools-vs-placement-groups-vs-object"><a href="#pools-vs-placement-groups-vs-object" class="headerlink" title="pools vs placement groups vs object"></a>pools vs placement groups vs object</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    </span><br><span class="line">    subgraph Ceph Cluster</span><br><span class="line">        A[Pool: mypool] --&gt;|Contains| B1[PG 1]</span><br><span class="line">        A[Pool: mypool] --&gt;|Contains| B2[PG 2]</span><br><span class="line">        A[Pool: mypool] --&gt;|Contains| B3[PG 3]</span><br><span class="line">        </span><br><span class="line">        B1 --&gt;|Stores| C1[Object A]</span><br><span class="line">        B1 --&gt;|Stores| C2[Object B]</span><br><span class="line">        </span><br><span class="line">        B2 --&gt;|Stores| C3[Object C]</span><br><span class="line">        B2 --&gt;|Stores| C4[Object D]</span><br><span class="line">        </span><br><span class="line">        B3 --&gt;|Stores| C5[Object E]</span><br><span class="line">        </span><br><span class="line">        subgraph OSD Nodes</span><br><span class="line">            D1[OSD.1] </span><br><span class="line">            D2[OSD.2] </span><br><span class="line">            D3[OSD.3] </span><br><span class="line">            D4[OSD.4] </span><br><span class="line">            D5[OSD.5] </span><br><span class="line">        end</span><br><span class="line"></span><br><span class="line">        B1 --&gt;|Mapped to| D1</span><br><span class="line">        B1 --&gt;|Mapped to| D2</span><br><span class="line">        B1 --&gt;|Mapped to| D3</span><br><span class="line">        </span><br><span class="line">        B2 --&gt;|Mapped to| D2</span><br><span class="line">        B2 --&gt;|Mapped to| D3</span><br><span class="line">        B2 --&gt;|Mapped to| D4</span><br><span class="line">        </span><br><span class="line">        B3 --&gt;|Mapped to| D3</span><br><span class="line">        B3 --&gt;|Mapped to| D4</span><br><span class="line">        B3 --&gt;|Mapped to| D5</span><br><span class="line">    end</span><br></pre></td></tr></table></figure><blockquote><p><strong>Pool (mypool)</strong> contains <strong>multiple PGs</strong> (Placement Groups).</p><p>Each <strong>PG stores multiple objects</strong>.</p><p>Each <strong>PG is mapped to multiple OSDs</strong>, based on the replication factor.</p><p><strong>Objects are stored within PGs</strong>, and Ceph automatically balances them across OSDs.</p></blockquote><p><strong>Understanding the Relationship Between Placement Groups (PGs), Pools, and Objects in Ceph</strong></p><p>In Ceph, <strong>objects</strong>, <strong>placement groups (PGs)</strong>, and <strong>pools</strong> work together to distribute and store data efficiently. Hereâ€™s how they relate:</p><h3 id="Pools"><a href="#Pools" class="headerlink" title="Pools"></a>Pools</h3><blockquote><p>The Logical Storage Units</p></blockquote><p>A pool in Ceph is a logical container that stores objects. Pools are used for different types of storage, such as:</p><ul><li><p><strong>RADOS block storage (RBD)</strong></p></li><li><p><strong>CephFS (Ceph File System)</strong></p></li><li><p><strong>RGW (RADOS Gateway for S3/Swift compatibility)</strong></p></li></ul><p>A pool has properties like:</p><ul><li><p><strong>Replication factor (e.g., 3x replication)</strong></p></li><li><p><strong>Erasure coding settings</strong></p></li><li><p><strong>Number of placement groups (PGs)</strong></p></li></ul><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph osd pool create mypool 128</span><br></pre></td></tr></table></figure><p>This creates a pool named <strong>mypool</strong> with <strong>128 PGs</strong>.</p><h3 id="Placement-Groups-PGs"><a href="#Placement-Groups-PGs" class="headerlink" title="Placement Groups (PGs)"></a>Placement Groups (PGs)</h3><blockquote><p>Buckets for Objects</p></blockquote><p>A <strong>placement group (PG)</strong> is an internal grouping of objects within a pool. Instead of distributing objects directly across OSDs, Ceph first assigns objects to PGs. Then, PGs are mapped to OSDs.</p><p><strong>Why PGs?</strong></p><ul><li><p>They act as <strong>intermediaries</strong> between objects and OSDs.</p></li><li><p>They help balance data across OSDs efficiently.</p></li><li><p>They make recovery and replication easier.</p></li></ul><p><strong>PG Calculation Example</strong></p><p>If a pool has <strong>128 PGs</strong> and uses a <strong>3-replica</strong> setting, each PG will be mapped to 3 different OSDs.</p><h3 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h3><blockquote><p>The Data Units in Ceph</p></blockquote><p>An <strong>object</strong> is the fundamental data unit in Ceph. When you store a file in Ceph, itâ€™s broken into one or more objects.</p><p><strong>How Objects Are Stored?</strong></p><ol><li><p><strong>Objects are stored in a Pool</strong> (e.g., mypool).</p></li><li><p><strong>Each object is mapped to a Placement Group (PG)</strong>.</p></li><li><p><strong>The PG is mapped to multiple OSDs</strong> (based on the poolâ€™s replication settings).</p></li><li><p><strong>The primary OSD</strong> handles writes and ensures copies are stored on secondary OSDs.</p></li></ol><p><strong>Example Workflow:</strong></p><ul><li><p>A file is stored in <strong>RGW (Ceph S3) â†’ mypool</strong>.</p></li><li><p>The file is broken into <strong>objects</strong>.</p></li><li><p>Each object is assigned to a <strong>PG</strong>.</p></li><li><p>The PG is mapped to <strong>3 OSDs</strong> (in a replicated pool).</p></li></ul><h3 id="Putting-It-All-Together"><a href="#Putting-It-All-Together" class="headerlink" title="Putting It All Together"></a>Putting It All Together</h3><p><strong>Example</strong></p><p>Assume:</p><ul><li><p>You create a <strong>pool</strong> called mypool with <strong>128 PGs</strong>.</p></li><li><p>You upload a file that gets broken into <strong>10 objects</strong>.</p></li><li><p>Each object is <strong>hashed and assigned</strong> to a PG.</p></li><li><p>The PGs are <strong>mapped to OSDs</strong>.</p></li></ul><table><thead><tr><th><strong>Component</strong></th><th><strong>Example Value</strong></th></tr></thead><tbody><tr><td><strong>Pool</strong></td><td>mypool</td></tr><tr><td><strong>PG Count</strong></td><td>128</td></tr><tr><td><strong>Object Name</strong></td><td>obj12345</td></tr><tr><td><strong>Object Hash</strong></td><td>hash(obj12345) â†’ PG 45</td></tr><tr><td><strong>PG Assigned</strong></td><td>PG 45</td></tr><tr><td><strong>Mapped OSDs</strong></td><td>OSD.3, OSD.7, OSD.12</td></tr></tbody></table><p>In this case, <strong>obj12345</strong> will be stored in <strong>PG 45</strong>, which is replicated across <strong>OSD.3, OSD.7, and OSD.12</strong>.</p><p><strong>Key Takeaways</strong></p><ul><li><p><strong>Objects</strong> are stored in <strong>pools</strong>.</p></li><li><p><strong>Pools</strong> contain <strong>placement groups (PGs)</strong>.</p></li><li><p><strong>PGs</strong> group multiple objects and map them to multiple OSDs.</p></li><li><p><strong>OSDs</strong> store object data and handle replication.</p></li></ul><p><strong>Commands to Check PGs and Pools</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> List all pools:</span></span><br><span class="line">ceph osd pool ls</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check PG status:</span></span><br><span class="line">ceph pg stat</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> See <span class="built_in">which</span> PGs belong to a pool:</span></span><br><span class="line">ceph pg dump | grep mypool</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check object distribution:</span></span><br><span class="line">ceph osd df</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> storage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>terminology</title>
      <link href="/2024/12/19/terminology/"/>
      <url>/2024/12/19/terminology/</url>
      
        <content type="html"><![CDATA[<h1 id="å¹‚ç­‰-éå¹‚ç­‰"><a href="#å¹‚ç­‰-éå¹‚ç­‰" class="headerlink" title="å¹‚ç­‰/éå¹‚ç­‰"></a>å¹‚ç­‰/éå¹‚ç­‰</h1><p>åœ¨è®¡ç®—æœºç§‘å­¦å’Œç½‘ç»œé€šä¿¡ä¸­ï¼Œå¹‚ç­‰ï¼ˆIdempotentï¼‰å’Œéå¹‚ç­‰ï¼ˆNon-idempotentï¼‰æè¿°äº†æ“ä½œæ‰§è¡Œå¤šæ¬¡å’Œæ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœæ˜¯å¦ç›¸åŒã€‚</p><ol><li><p><strong>å¹‚ç­‰æ“ä½œ</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤šæ¬¡å’Œæ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œè¢«ç§°ä¸ºå¹‚ç­‰æ“ä½œã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå¹‚ç­‰æ“ä½œåœ¨é‡å¤æ‰§è¡Œæ—¶ä¸ä¼šæ”¹å˜ç³»ç»ŸçŠ¶æ€ï¼Œå³å¤šæ¬¡æ‰§è¡Œå’Œæ‰§è¡Œä¸€æ¬¡çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<ul><li><strong>GETè¯·æ±‚</strong>ï¼šè¯»å–èµ„æºçš„æ“ä½œæ˜¯å¹‚ç­‰çš„ï¼Œå› ä¸ºæ— è®ºè¯»å–å¤šå°‘æ¬¡ï¼Œèµ„æºçš„å†…å®¹ä¸ä¼šæ”¹å˜ã€‚</li><li><strong>PUTè¯·æ±‚</strong>ï¼šæ›´æ–°èµ„æºçš„æ“ä½œé€šå¸¸æ˜¯å¹‚ç­‰çš„ï¼Œå› ä¸ºå¤šæ¬¡æ›´æ–°åŒä¸€ä¸ªèµ„æºåˆ°ç›¸åŒçš„çŠ¶æ€ï¼Œæœ€ç»ˆèµ„æºçš„çŠ¶æ€ä¸ä¼šæ”¹å˜ã€‚</li><li><strong>DELETEè¯·æ±‚</strong>ï¼šåˆ é™¤èµ„æºçš„æ“ä½œä¹Ÿæ˜¯å¹‚ç­‰çš„ï¼Œå› ä¸ºä¸€æ—¦èµ„æºè¢«åˆ é™¤ï¼Œå†æ¬¡åˆ é™¤ä¸ä¼šå¯¹ç³»ç»Ÿäº§ç”Ÿè¿›ä¸€æ­¥çš„å½±å“ã€‚</li></ul></li></ul></li><li><p><strong>éå¹‚ç­‰æ“ä½œ</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤šæ¬¡å’Œæ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œè¢«ç§°ä¸ºéå¹‚ç­‰æ“ä½œã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šéå¹‚ç­‰æ“ä½œåœ¨é‡å¤æ‰§è¡Œæ—¶ä¼šæ”¹å˜ç³»ç»ŸçŠ¶æ€ï¼Œå³å¤šæ¬¡æ‰§è¡Œå’Œæ‰§è¡Œä¸€æ¬¡çš„ç»“æœä¸åŒã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<ul><li><strong>POSTè¯·æ±‚</strong>ï¼šåˆ›å»ºèµ„æºçš„æ“ä½œæ˜¯éå¹‚ç­‰çš„ï¼Œå› ä¸ºå¤šæ¬¡æ‰§è¡Œåˆ›å»ºæ“ä½œä¼šåˆ›å»ºå¤šä¸ªèµ„æºå®ä¾‹ã€‚</li><li><strong>æŸäº›ç±»å‹çš„UPDATEè¯·æ±‚</strong>ï¼šå¦‚æœæ›´æ–°æ“ä½œæ¶‰åŠåˆ°è®¡æ•°å™¨æˆ–å…¶ä»–ä¼šéšæ—¶é—´å˜åŒ–çš„å€¼ï¼Œé‚£ä¹ˆè¿™äº›æ“ä½œå¯èƒ½æ˜¯éå¹‚ç­‰çš„ï¼Œå› ä¸ºå¤šæ¬¡æ›´æ–°å¯èƒ½ä¼šç´¯ç§¯æ•ˆæœã€‚</li></ul></li></ul></li></ol><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå’Œç½‘ç»œé€šä¿¡ä¸­ï¼Œå¹‚ç­‰æ€§æ˜¯ä¸€ä¸ªé‡è¦çš„å±æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ç¡®ä¿ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚ç”±äºç½‘ç»œé—®é¢˜è¢«é‡å¤å‘é€ï¼Œå¹‚ç­‰æ“ä½œå¯ä»¥ç¡®ä¿ç³»ç»Ÿä¸ä¼šå› ä¸ºé‡å¤çš„è¯·æ±‚è€Œäº§ç”Ÿä¸ä¸€è‡´çš„çŠ¶æ€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> terminology </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes pkg</title>
      <link href="/2024/12/17/kubernetes%20pkg/"/>
      <url>/2024/12/17/kubernetes%20pkg/</url>
      
        <content type="html"><![CDATA[<h1 id="klog"><a href="#klog" class="headerlink" title="klog"></a>klog</h1><h2 id="default-log-level"><a href="#default-log-level" class="headerlink" title="default log level"></a>default log level</h2><p>klog verbosity level (0-10)</p><p>default use <code>klog.Info</code> is equivalent to <code>klog.V(0).Info</code>. </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> by default klog uses level 0, so logs with log.V(1) won<span class="string">&#x27;t appear unless you set --v=1 or a higher verbosity.  default k8s&#x27;</span>s <span class="built_in">log</span> level is also 0</span></span><br><span class="line"></span><br><span class="line">containers:</span><br><span class="line">  - name: your-container</span><br><span class="line">    image: your-image</span><br><span class="line">    args:</span><br><span class="line">      - &quot;--v=1&quot; # if not config this, default klog uses level 0</span><br></pre></td></tr></table></figure><ul><li>For more detailed debug or trace messages, use klog.V(level).Info, where level is greater than 0 (e.g., klog.V(2).Info).</li></ul>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pkg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cmake &amp; make cmd</title>
      <link href="/2024/12/16/cmake%20&amp;%20make%20cmd/"/>
      <url>/2024/12/16/cmake%20&amp;%20make%20cmd/</url>
      
        <content type="html"><![CDATA[<h1 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h1><ul><li><p>generate a full dependency graph</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake --graphviz=output.dot .</span><br><span class="line">dot -Tpng output.dot -o deps.png</span><br></pre></td></tr></table></figure></li><li><p>diagnose error</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥è¯¢ CMake Error ä¿¡æ¯å­—æ ·</span><br></pre></td></tr></table></figure></li></ul><h1 id="make"><a href="#make" class="headerlink" title="make"></a>make</h1><ul><li><p>show all errors</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -k (keep going) helps show all errors,</span></span><br><span class="line">make -j2 -k   # å…ˆç”¨ make -j32 å¤šå¹¶å‘ç¼–è¯‘æš´éœ²é”™è¯¯ï¼Œç„¶åå†ç”¨2å¹¶å‘ç»“åˆ&#x27;-k&#x27;å‚æ•°æ‰“å°ç¼–è¯‘é”™è¯¯</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> cmake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes controller</title>
      <link href="/2024/12/15/kubernetes%20controller/"/>
      <url>/2024/12/15/kubernetes%20controller/</url>
      
        <content type="html"><![CDATA[<blockquote><p>From <a href="https://buraksekili.github.io/articles/controller-runtime-1/">Diving into controller-runtime | Manager</a></p></blockquote><p><a href="https://github.com/kubernetes-sigs/controller-runtime"><code>controller-runtime</code></a> package has become a fundamental tool for most Kubernetes controllers, simplifying the creation of controllers to manage resources within a Kubernetes environment efficiently. Users tend to prefer it over <a href="https://github.com/kubernetes/client-go"><code>client-go</code></a>.</p><p>In Kubernetes, controllers observe resources, such as Deployments, in a control loop to ensure the cluster resources conform to the desired state specified in the resource specification (e.g., YAML files).</p><p>On the other hand, according to Redhat, a Kubernetes Operator is an application-specific controller <a href="https://buraksekili.github.io/articles/controller-runtime-1/#fn:2">2</a>. For instance, the Prometheus Operator manages the lifecycle of a Prometheus instance in the cluster, including managing configurations and updating Kubernetes resources, such as ConfigMaps.</p><h1 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h1><p>controllers follow a special architecture to</p><ul><li>observe the resources,</li><li>inform any events (updating, deleting, adding) done on the resources,</li><li>keep a local cache to decrease the load on API Server,</li><li>keep a work queue to pick up events,</li><li>run workers to perform reconciliation on resources picked up from work queue.</li></ul><img src="/images/k8s/controller-runtime-1-client-go-controller-interaction.jpeg" style="zoom: 80%"><h2 id="informer"><a href="#informer" class="headerlink" title="informer"></a>informer</h2><p>Informers leverage certain components like <strong>Reflector</strong>, <strong>Queue</strong> and <strong>Indexer</strong>, as shown in the above diagram.</p><p>Informers watch Kubernetes API server to detect changes in resources that we want to. It keeps a local cache - in-memory cache implementing <a href="https://pkg.go.dev/k8s.io/client-go/tools/cache#Store">Store</a> interface - including the objects observed through Kubernetes API. Then controllers and operators use this cache for all getter requests - GET and LIST - to prevent load on Kubernetes API server. Moreover, Informers invoke controllers by sending objects to the controllers (registering Event Handlers).</p><h3 id="Reflector"><a href="#Reflector" class="headerlink" title="Reflector"></a>Reflector</h3><blockquote><p>Reflector watches a specified resource and causes all changes to be reflected in the given store.</p></blockquote><p>The store is actually a cache - with two options; simple one and FIFO. Reflector pushes objects to Delta Fifo queue.</p><p>By monitoring the server (Kubernetes API Server), the Reflector maintains a local cache of the resources. Upon any event occurring on the watched resource, implying a new operation on the Kubernetes resource, the Reflector updates the cache (Delta FIFO queue, as illustrated in the diagram). Subsequently, the Informer reads objects from this Delta FIFO queue, indexes them for future retrievals, and dispatches the object to the controller.</p><h3 id="Indexer"><a href="#Indexer" class="headerlink" title="Indexer"></a>Indexer</h3><p>Indexer saves objects into thread-safe Store by indexing the objects. This approach facilitates efficient querying of objects from the cache.</p><p>Custom indexers, based on specific needs, can be created. For example, a custom indexer can be generated to retrieve all objects based on certain fields, such as Annotations.</p><p>More details about how Kubernetes indexing works, check <a href="https://buraksekili.github.io/articles/client-k8s-indexing">Kubernetes Client-Side Indexing</a>.</p><hr><p>reference</p><ul><li><p><a href="https://www.zhaohuabing.com/post/2023-03-09-how-to-create-a-k8s-controller/">Kubernetes Controller æœºåˆ¶è¯¦è§£</a></p></li><li><p><a href="https://cloud.tencent.com/developer/article/1989055">Controller Runtime çš„å››ç§ä½¿ç”¨å§¿åŠ¿</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> controller runtime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GO PKG</title>
      <link href="/2024/12/13/golang%20pkg/"/>
      <url>/2024/12/13/golang%20pkg/</url>
      
        <content type="html"><![CDATA[<h1 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h1><ul><li><p><code>%v</code> vs <code>%#v</code></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Example <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Value <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ex := Example&#123;Name: <span class="string">&quot;test&quot;</span>, Value: <span class="number">42</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Using %v</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Default format: %v\n&quot;</span>, ex)</span><br><span class="line">    <span class="comment">// Output: Default format: &#123;test 42&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Using %#v</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Go syntax representation: %#v\n&quot;</span>, ex)</span><br><span class="line">    <span class="comment">// Output: Go syntax representation: main.Example&#123;Name:&quot;test&quot;, Value:42&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="json"><a href="#json" class="headerlink" title="json"></a>json</h1><ul><li><p><code>json:&quot;,inline&quot;</code></p><blockquote><p>This means that the fields of the embedded struct will appear at the same level as the fields of the parent struct in the resulting JSON object.</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Meta <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">    Age  <span class="keyword">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Meta <span class="string">`json:&quot;,inline&quot;`</span></span><br><span class="line">    Address <span class="keyword">string</span> <span class="string">`json:&quot;address&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p := Person&#123;</span><br><span class="line">        Meta: Meta&#123;</span><br><span class="line">            Name: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">            Age:  <span class="number">30</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        Address: <span class="string">&quot;123 Main St&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data, _ := json.Marshal(p)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># output:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="string">&quot;address&quot;</span>: <span class="string">&quot;123 Main St&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="cobra"><a href="#cobra" class="headerlink" title="cobra"></a>cobra</h1><h2 id="PersistentFlag-vs-Flag"><a href="#PersistentFlag-vs-Flag" class="headerlink" title="PersistentFlag vs Flag"></a>PersistentFlag vs Flag</h2><p><strong>PersistentFlag</strong></p><ul><li>Flags that are available to the command and all its subcommands. but not explicitly added to the main commandâ€™s help output.</li></ul><p><strong>Flag</strong></p><ul><li><p>Definition: Flags that are only available to the specific command they are defined on.</p></li><li><p>Example: If you set a flag on a specific command, it will not be available to its parent or sibling commands.</p></li></ul><h1 id="klog"><a href="#klog" class="headerlink" title="klog"></a>klog</h1><blockquote><p>k8s.io/klog/v2</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">klog.Info(<span class="string">&quot;setting.MountOptions&quot;</span>, setting.MountOptions)</span><br><span class="line"></span><br><span class="line">klog.Infof(<span class="string">&quot;volumeId[%s] using patch:%#v&quot;</span>, setting.VolumeId, patch)</span><br><span class="line"></span><br><span class="line">klog.ErrorS(err, <span class="string">&quot;dingofs create fs error: %v&quot;</span>, err)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Change to a lower level (e.g., V(5).Infof)</span></span><br><span class="line">klog.V(<span class="number">5</span>).Infof(<span class="string">&quot;csi-driver volume mounts JSON: %s&quot;</span>, <span class="keyword">string</span>(volumeMountsJSON))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> GO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pkg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lvm senario</title>
      <link href="/2024/12/06/fs:%20lvm%20senario/"/>
      <url>/2024/12/06/fs:%20lvm%20senario/</url>
      
        <content type="html"><![CDATA[<h1 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h1><img src="/images/fs/lvm_overview-1.svg"><h1 id="create-LVs"><a href="#create-LVs" class="headerlink" title="create LVs"></a>create LVs</h1><blockquote><p> If you want to create <strong>three Logical Volumes (LVs)</strong> of sizes 1TB, 1TB, and 5TB on a single Volume Group (VG) for each disk, hereâ€™s how you can do it step by step.</p></blockquote><p>Assume:</p><p><strong>Disks</strong>: /dev/nvme0n1, /dev/nvme1n1, /dev/nvme2n1</p><p><strong>Volume Groups</strong>: vg_nvme0, vg_nvme1, vg_nvme2</p><p><strong>Logical Volumes (LVs)</strong>: lv1, lv2, lv3 for each VG</p><p><strong>LV Sizes</strong>: 1TB, 1TB, and 5TB</p><h2 id="1-Create-Physical-Volumes-PVs"><a href="#1-Create-Physical-Volumes-PVs" class="headerlink" title="1. Create Physical Volumes (PVs)"></a>1. Create Physical Volumes (PVs)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Initialize each disk as a PV:</span></span><br><span class="line">sudo pvcreate /dev/nvme0n1</span><br><span class="line">sudo pvcreate /dev/nvme1n1</span><br><span class="line">sudo pvcreate /dev/nvme2n1</span><br></pre></td></tr></table></figure><h2 id="2-Create-Volume-Groups-VGs"><a href="#2-Create-Volume-Groups-VGs" class="headerlink" title="2. Create Volume Groups (VGs)"></a>2. Create Volume Groups (VGs)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create a VG <span class="keyword">for</span> each disk:</span></span><br><span class="line">sudo vgcreate vg_nvme0 /dev/nvme0n1</span><br><span class="line">sudo vgcreate vg_nvme1 /dev/nvme1n1</span><br><span class="line">sudo vgcreate vg_nvme2 /dev/nvme2n1</span><br></pre></td></tr></table></figure><h2 id="3-Create-Logical-Volumes-LVs"><a href="#3-Create-Logical-Volumes-LVs" class="headerlink" title="3. Create Logical Volumes (LVs)"></a>3. Create Logical Volumes (LVs)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Allocate 1TB, 1TB, and 5TB LVs from each VG.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For vg_nvme0:</span></span><br><span class="line">sudo lvcreate -L 1T -n lv1 vg_nvme0</span><br><span class="line">sudo lvcreate -L 1T -n lv2 vg_nvme0</span><br><span class="line">sudo lvcreate -L 5T -n lv3 vg_nvme0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For vg_nvme1:</span></span><br><span class="line">sudo lvcreate -L 1T -n lv1 vg_nvme1</span><br><span class="line">sudo lvcreate -L 1T -n lv2 vg_nvme1</span><br><span class="line">sudo lvcreate -L 5T -n lv3 vg_nvme1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For vg_nvme2:</span></span><br><span class="line">sudo lvcreate -L 1T -n lv1 vg_nvme2</span><br><span class="line">sudo lvcreate -L 1T -n lv2 vg_nvme2</span><br><span class="line">sudo lvcreate -L 5T -n lv3 vg_nvme2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use whole vg</span></span><br><span class="line">sudo lvcreate -l 100%FREE -n lv vg_xxx</span><br></pre></td></tr></table></figure><h2 id="4-Verify-the-Setup"><a href="#4-Verify-the-Setup" class="headerlink" title="4. Verify the Setup"></a>4. Verify the Setup</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Check the LVs and their sizes:</span></span><br><span class="line">sudo lvs</span><br></pre></td></tr></table></figure><p>You should see something like:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LV   VG        Attr       LSize</span><br><span class="line"></span><br><span class="line">lv1  vg_nvme0  -wi-a----- 1.00t                           </span><br><span class="line">lv2  vg_nvme0  -wi-a----- 1.00t                           </span><br><span class="line">lv3  vg_nvme0  -wi-a----- 5.00t                           </span><br><span class="line">lv1  vg_nvme1  -wi-a----- 1.00t                           </span><br><span class="line">lv2  vg_nvme1  -wi-a----- 1.00t                           </span><br><span class="line">lv3  vg_nvme1  -wi-a----- 5.00t                           </span><br><span class="line">lv1  vg_nvme2  -wi-a----- 1.00t                           </span><br><span class="line">lv2  vg_nvme2  -wi-a----- 1.00t                           </span><br><span class="line">lv3  vg_nvme2  -wi-a----- 5.00t</span><br></pre></td></tr></table></figure><h2 id="5-Format-the-LVs"><a href="#5-Format-the-LVs" class="headerlink" title="5. Format the LVs"></a>5. Format the LVs</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Use xfs or another filesystem to format the LVs:</span></span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme0/lv1</span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme0/lv2</span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme0/lv3</span><br><span class="line"></span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme1/lv1</span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme1/lv2</span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme1/lv3</span><br><span class="line"></span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme2/lv1</span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme2/lv2</span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme2/lv3</span><br></pre></td></tr></table></figure><h2 id="6-Mount-the-LVs"><a href="#6-Mount-the-LVs" class="headerlink" title="6. Mount the LVs"></a>6. Mount the LVs</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create directories <span class="keyword">for</span> each LV and mount them:</span></span><br><span class="line">sudo mkdir -p /mnt/nvme0/lv1 /mnt/nvme0/lv2 /mnt/nvme0/lv3</span><br><span class="line">sudo mkdir -p /mnt/nvme1/lv1 /mnt/nvme1/lv2 /mnt/nvme1/lv3</span><br><span class="line">sudo mkdir -p /mnt/nvme2/lv1 /mnt/nvme2/lv2 /mnt/nvme2/lv3</span><br><span class="line"></span><br><span class="line">sudo mount /dev/vg_nvme0/lv1 /mnt/nvme0/lv1</span><br><span class="line">sudo mount /dev/vg_nvme0/lv2 /mnt/nvme0/lv2</span><br><span class="line">sudo mount /dev/vg_nvme0/lv3 /mnt/nvme0/lv3</span><br><span class="line"></span><br><span class="line">sudo mount /dev/vg_nvme1/lv1 /mnt/nvme1/lv1</span><br><span class="line">sudo mount /dev/vg_nvme1/lv2 /mnt/nvme1/lv2</span><br><span class="line">sudo mount /dev/vg_nvme1/lv3 /mnt/nvme1/lv3</span><br><span class="line"></span><br><span class="line">sudo mount /dev/vg_nvme2/lv1 /mnt/nvme2/lv1</span><br><span class="line">sudo mount /dev/vg_nvme2/lv2 /mnt/nvme2/lv2</span><br><span class="line">sudo mount /dev/vg_nvme2/lv3 /mnt/nvme2/lv3</span><br></pre></td></tr></table></figure><h2 id="7-Persist-the-Mounts"><a href="#7-Persist-the-Mounts" class="headerlink" title="7. Persist the Mounts"></a>7. Persist the Mounts</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Add the mounts to /etc/fstab <span class="keyword">for</span> automatic remounting on boot:</span></span><br><span class="line">echo &#x27;/dev/vg_nvme0/lv1 /mnt/nvme0/lv1 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">echo &#x27;/dev/vg_nvme0/lv2 /mnt/nvme0/lv2 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">echo &#x27;/dev/vg_nvme0/lv3 /mnt/nvme0/lv3 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line"></span><br><span class="line">echo &#x27;/dev/vg_nvme1/lv1 /mnt/nvme1/lv1 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">echo &#x27;/dev/vg_nvme1/lv2 /mnt/nvme1/lv2 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">echo &#x27;/dev/vg_nvme1/lv3 /mnt/nvme1/lv3 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line"></span><br><span class="line">echo &#x27;/dev/vg_nvme2/lv1 /mnt/nvme2/lv1 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">echo &#x27;/dev/vg_nvme2/lv2 /mnt/nvme2/lv2 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">echo &#x27;/dev/vg_nvme2/lv3 /mnt/nvme2/lv3 xfs defaults 0 0&#x27; | sudo tee -a /etc/fstab</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> **Final Directory Layout**</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> **Disk****VG Name****LV Name****Size****Mount Point**</span></span><br><span class="line">/dev/nvme0n1vg_nvme0lv11T/mnt/nvme0/lv1</span><br><span class="line">lv21T/mnt/nvme0/lv2</span><br><span class="line">lv35T/mnt/nvme0/lv3</span><br><span class="line"></span><br><span class="line">/dev/nvme1n1vg_nvme1lv11T/mnt/nvme1/lv1</span><br><span class="line">lv21T/mnt/nvme1/lv2</span><br><span class="line">lv35T/mnt/nvme1/lv3</span><br><span class="line"></span><br><span class="line">/dev/nvme2n1vg_nvme2lv11T/mnt/nvme2/lv1</span><br><span class="line">lv21T/mnt/nvme2/lv2</span><br><span class="line">lv35T/mnt/nvme2/lv3</span><br></pre></td></tr></table></figure><blockquote><p>defaults 0 x</p><p>The difference is in the last number (0 vs 2) in the fstab entry, which represents the filesystem check (fsck) pass number. Hereâ€™s what these numbers mean:</p><p>Last field (6th field) in fstab:</p><ul><li><code>0</code> = No filesystem check will be done at boot time</li><li><code>1</code> = Filesystem will be checked first (typically used for root filesystem /)</li><li><code>2</code> = Filesystem will be checked after pass 1 filesystems (typically used for other filesystems)</li></ul><p>So:</p><ul><li><code>defaults 0 0</code> means the filesystem will never be automatically checked during boot</li><li><code>defaults 0 2</code> means the filesystem will be checked during boot, but after the root filesystem</li></ul><p>Best practices:</p><ul><li>Use <code>0 1</code> for the root filesystem (/)</li><li>Use <code>0 2</code> for other important filesystems that should be checked</li><li>Use <code>0 0</code> for pseudo-filesystems (like proc, sysfs) or filesystems that donâ€™t need checking (like swap)</li></ul></blockquote><h1 id="wipe-disk-and-create-lvm"><a href="#wipe-disk-and-create-lvm" class="headerlink" title="wipe disk and create lvm"></a>wipe disk and create lvm</h1><blockquote><p>assum dev is /dev/nvme2n1</p></blockquote><p>To erase all partitions on the device /dev/nvme2n1 and create multiple logical volumes (LVs) using the LVM framework, follow these steps:</p><h2 id="1-Verify-Device-and-Backup-Data"><a href="#1-Verify-Device-and-Backup-Data" class="headerlink" title="1. Verify Device and Backup Data"></a>1. Verify Device and Backup Data</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Ensure you are working on the correct device. Erasing partitions will delete all data on the device.</span></span><br><span class="line">sudo lsblk -o NAME,SIZE,TYPE,MOUNTPOINT /dev/nvme2n1</span><br></pre></td></tr></table></figure><h2 id="2-Erase-Existing-Partitions"><a href="#2-Erase-Existing-Partitions" class="headerlink" title="2. Erase Existing Partitions"></a>2. Erase Existing Partitions</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Clear the Partition Table, To wipe the partition table completely:</span></span><br><span class="line">sudo wipefs -a /dev/nvme2n1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Verify the Disk is Clean, Check that no partitions remain</span></span><br><span class="line">sudo lsblk /dev/nvme2n1</span><br></pre></td></tr></table></figure><blockquote><p>if you want use device directly instead of  make lv, you can use below command format origin device</p><p>sudo mkfs -t ext4 /dev/nvme2n1</p><p>or </p><p>sudo mkfs -t xfs /dev/nvme2n1</p></blockquote><h2 id="3-Create-Physical-Volume-PV"><a href="#3-Create-Physical-Volume-PV" class="headerlink" title="3. Create Physical Volume (PV)"></a>3. Create Physical Volume (PV)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Convert the entire disk into an LVM physical volume:</span></span><br><span class="line">sudo pvcreate /dev/nvme2n1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Verify the PV</span></span><br><span class="line">sudo pvdisplay</span><br></pre></td></tr></table></figure><h2 id="4-Create-Volume-Group-VG"><a href="#4-Create-Volume-Group-VG" class="headerlink" title="4. Create Volume Group (VG)"></a>4. Create Volume Group (VG)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create a volume group that spans the entire disk:</span></span><br><span class="line">sudo vgcreate vg_nvme2n1 /dev/nvme2n1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Verify the VG:</span></span><br><span class="line">sudo vgdisplay</span><br></pre></td></tr></table></figure><h2 id="5-Create-Logical-Volumes-LVs"><a href="#5-Create-Logical-Volumes-LVs" class="headerlink" title="5. Create Logical Volumes (LVs)"></a>5. Create Logical Volumes (LVs)</h2><p>Example: Create Three LVs</p><p><strong>LV1</strong>: 1TB</p><p><strong>LV2</strong>: 1TB</p><p><strong>LV3</strong>: Remaining space</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo lvcreate -L 1T -n lv1 vg_nvme2n1</span><br><span class="line">sudo lvcreate -L 1T -n lv2 vg_nvme2n1</span><br><span class="line">sudo lvcreate -l 100%FREE -n lv3 vg_nvme2n1 --wipesignatures y</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ³¨æ„å¦‚æœåœ¨lvcreateçš„æ—¶å€™ä¸€ç›´æç¤º warning wipe offset xxx,é‚£æ‰§è¡Œ sudo lvcreate xxx -y (åŠ -yå‚æ•°)</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Verify the LVs:</span></span><br><span class="line">sudo lvdisplay</span><br></pre></td></tr></table></figure><h2 id="6-Format-Logical-Volumes"><a href="#6-Format-Logical-Volumes" class="headerlink" title="6. Format Logical Volumes"></a>6. Format Logical Volumes</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Format each logical volume with your desired file system (e.g., XFS):</span></span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme2n1/lv1</span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme2n1/lv2</span><br><span class="line">sudo mkfs.xfs /dev/vg_nvme2n1/lv3</span><br></pre></td></tr></table></figure><h2 id="7-Mount-Logical-Volumes"><a href="#7-Mount-Logical-Volumes" class="headerlink" title="7. Mount Logical Volumes"></a>7. Mount Logical Volumes</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create mount points and mount the LVs:</span></span><br><span class="line">sudo mkdir -p /mnt/nvme2n1/lv1 /mnt/nvme2n1/lv2 /mnt/nvme2n1/lv3</span><br><span class="line"></span><br><span class="line">sudo mount /dev/vg_nvme2n1/lv1 /mnt/nvme2n1/lv1</span><br><span class="line">sudo mount /dev/vg_nvme2n1/lv2 /mnt/nvme2n1/lv2</span><br><span class="line">sudo mount /dev/vg_nvme2n1/lv3 /mnt/nvme2n1/lv3</span><br><span class="line"><span class="meta">#</span><span class="bash"> Verify the mounts:</span></span><br><span class="line">df -h</span><br></pre></td></tr></table></figure><h2 id="8-Make-the-Mounts-Persistent"><a href="#8-Make-the-Mounts-Persistent" class="headerlink" title="8. Make the Mounts Persistent"></a>8. Make the Mounts Persistent</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Add entries to /etc/fstab to ensure the LVs are mounted on reboot:</span></span><br><span class="line">echo &#x27;/dev/vg_nvme2n1/lv1 /mnt/nvme2n1/lv1 xfs defaults 0 2&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">echo &#x27;/dev/vg_nvme2n1/lv2 /mnt/nvme2n1/lv2 xfs defaults 0 2&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">echo &#x27;/dev/vg_nvme2n1/lv3 /mnt/nvme2n1/lv3 xfs defaults 0 2&#x27; | sudo tee -a /etc/fstab</span><br></pre></td></tr></table></figure><h1 id="wipe-existed-lv"><a href="#wipe-existed-lv" class="headerlink" title="wipe existed lv"></a>wipe existed lv</h1><h2 id="1-Check-Whatâ€™s-Using-the-LV"><a href="#1-Check-Whatâ€™s-Using-the-LV" class="headerlink" title="1. Check Whatâ€™s Using the LV"></a>1. Check Whatâ€™s Using the LV</h2><p>First, identify what is still using the LV:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof | grep /dev/mapper/&lt;lv-name&gt;</span><br></pre></td></tr></table></figure><p>Also, check active processes using the device:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fuser -m /dev/mapper/&lt;lv-name&gt;</span><br></pre></td></tr></table></figure><p>If any process is using the LV, stop it:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kill -9 &lt;PID&gt;</span><br></pre></td></tr></table></figure><h2 id="2-Unmount-If-Mounted"><a href="#2-Unmount-If-Mounted" class="headerlink" title="2. Unmount If Mounted"></a>2. Unmount If Mounted</h2><p>Check if the LV is mounted:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount | grep /dev/mapper/&lt;lv-name&gt;</span><br></pre></td></tr></table></figure><p>If it is mounted, unmount it:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount -l /dev/mapper/&lt;lv-name&gt;</span><br></pre></td></tr></table></figure><p>Use -l (lazy unmount) to force unmount if needed.</p><h2 id="3-Disable-the-LV"><a href="#3-Disable-the-LV" class="headerlink" title="3. Disable the LV"></a>3. Disable the LV</h2><p>Before removing the LV, <strong>deactivate it</strong>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lvchange -an /dev/&lt;vg-name&gt;/&lt;lv-name&gt;</span><br></pre></td></tr></table></figure><p>Now try to remove it:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dmsetup remove /dev/mapper/&lt;lv-name&gt;</span><br></pre></td></tr></table></figure><h2 id="4-Forcefully-Remove-LV-VG-and-PV"><a href="#4-Forcefully-Remove-LV-VG-and-PV" class="headerlink" title="4. Forcefully Remove LV, VG, and PV"></a>4. Forcefully Remove LV, VG, and PV</h2><p>If the above steps donâ€™t work, forcefully remove everything:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo lvremove -f /dev/&lt;vg-name&gt;/&lt;lv-name&gt;</span><br><span class="line">sudo vgremove -f &lt;vg-name&gt;</span><br><span class="line">sudo pvremove -f /dev/&lt;device-name&gt;</span><br></pre></td></tr></table></figure><p>Check again with:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br><span class="line">sudo vgs</span><br><span class="line">sudo lvs</span><br></pre></td></tr></table></figure><h2 id="5-If-Everything-Fails"><a href="#5-If-Everything-Fails" class="headerlink" title="5. If Everything Fails"></a>5. If Everything Fails</h2><p>If none of the above works, the safest option is to <strong>reboot</strong>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo wipefs --all --force /dev/&lt;device-name&gt;</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><h1 id="Extend-lv-size"><a href="#Extend-lv-size" class="headerlink" title="Extend lv size"></a>Extend lv size</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1</span></span><br><span class="line">lvextend -l +100%FREE /path/to/lv  # e.g. /dev/ubuntu-vg/ubuntu-lv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> ext4</span></span><br><span class="line">resize2fs /path/to/lv  # e.g. /dev/ubuntu-vg/ubuntu-lv</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> xfs</span></span><br><span class="line">xfs_growfs /path/to/extend-path  # e.g. /mnt/data</span><br></pre></td></tr></table></figure><h1 id="troubleshooting"><a href="#troubleshooting" class="headerlink" title="troubleshooting"></a>troubleshooting</h1><h2 id="fix-lv-issue"><a href="#fix-lv-issue" class="headerlink" title="fix lv issue"></a>fix lv issue</h2><blockquote><p>e.g. /dev/vg_disk3/lv -&gt; /mnt/disk3 is error</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Unmount the filesystem (<span class="keyword">if</span> still mounted):</span></span><br><span class="line">umount -f /mnt/disk3  # Force unmount if stuck</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> optional: If the filesystem remains busy, identify processes using lsof or fuser:</span></span><br><span class="line">fuser -vm /dev/vg_disk3/lv   # Alternative method  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check the deviceâ€™s I/O status:</span></span><br><span class="line">dmsetup info vg_disk3-lv</span><br><span class="line"><span class="meta">#</span><span class="bash"> Attempt to Clear Stuck I/O</span></span><br><span class="line">dmsetup suspend vg_disk3-lv</span><br><span class="line">dmsetup resume vg_disk3-lv</span><br><span class="line">dmsetup remove --force vg_disk3-lv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check <span class="keyword">for</span> LVM Snapshots or Mirrors</span></span><br><span class="line">lvs | grep vg_disk3</span><br><span class="line">lvremove /dev/vg_disk3/&lt;snapshot_name&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Deactivate the Volume Group</span></span><br><span class="line">vgchange -an vg_disk3  # Deactivate all volumes in the group  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> optional: Locate the LVM Metadata Backup</span></span><br><span class="line">ls -lt /etc/lvm/archive/ | grep vg_disk3</span><br><span class="line"><span class="meta">#</span><span class="bash"> optional: Restore the Volume Group Configuration</span></span><br><span class="line">vgcfgrestore -f /etc/lvm/archive/vg_disk3_NNNNNN.vg vg_disk3</span><br><span class="line"><span class="meta">#</span><span class="bash"> optional: Verify the Logical Volume is Restored</span></span><br><span class="line">lvdisplay /dev/vg_disk3/lv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Repair the XFS Filesystem</span></span><br><span class="line">vgchange -ay vg_disk3  # Activate the volume group</span><br><span class="line"><span class="meta">#</span><span class="bash"> optional: create lv</span></span><br><span class="line">sudo lvcreate -l 100%FREE -n lv vg_disk3</span><br><span class="line"><span class="meta">#</span><span class="bash"> repair lv (need long <span class="built_in">times</span>)</span></span><br><span class="line">xfs_repair /dev/vg_disk3/lv # If I/O errors persist, try: xfs_repair -L /dev/vg_disk3/lv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remount</span></span><br><span class="line">mount /dev/vg_disk3/lv /mnt/disk3</span><br><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">ls /mnt/disk3  # Check for I/O errors</span><br><span class="line">xfs_check /dev/vg_disk3/lv  # Validate filesystem health</span><br></pre></td></tr></table></figure><h2 id="Logical-volume-lt-vg-name-gt-lt-lv-name-gt-contains-a-filesystem-in-use"><a href="#Logical-volume-lt-vg-name-gt-lt-lv-name-gt-contains-a-filesystem-in-use" class="headerlink" title="Logical volume &lt;vg-name&gt;/&lt;lv-name&gt;  contains a filesystem in use"></a>Logical volume &lt;vg-name&gt;/&lt;lv-name&gt;  contains a filesystem in use</h2><ol><li><p>check used process</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mount point</span></span><br><span class="line">sudo lsof /mnt/disk0</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. <span class="built_in">print</span></span></span><br><span class="line">COMMAND     PID    USER   FD   TYPE DEVICE SIZE/OFF       NODE NAME</span><br><span class="line">bash    1067388 dingofs  cwd    DIR  259,4       64 2147483776 /mnt/disk0/install/dingo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lv</span></span><br><span class="line">sudo fuser -m /dev/mapper/&lt;lv-name&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. <span class="built_in">print</span></span></span><br><span class="line">/dev/dm-3:           3733654m  # 3733654 is process id</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span> reference pid</span></span><br><span class="line">kill -9 3733654</span><br></pre></td></tr></table></figure></li><li><p> optional: Search for processes using the device by major/minor numbers</p></li></ol>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dmsetup info -c vg_disk3-lv</span><br><span class="line">or</span><br><span class="line">dmsetup info vg_disk3-lv</span><br></pre></td></tr></table></figure><p>   e.g. console print</p>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> dmsetup info -c vg_disk3-lv , <span class="built_in">print</span> below</span></span><br><span class="line">Name             Maj Min Stat Open Targ Event  UUID                                                        </span><br><span class="line">vg_disk3-lv      253   4 L--w    1    1      0 LVM-jKQjctpauajJM9B6bT1OaygGfZYROrC2FNNC1tRiXxEG14UBO2GBN4umaKvne0FI</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dmsetup info vg_disk3-lv, <span class="built_in">print</span> below</span></span><br><span class="line">Name:              vg_disk3-lv</span><br><span class="line">State:             ACTIVE (DEFERRED REMOVE)</span><br><span class="line">Read Ahead:        256</span><br><span class="line">Tables present:    LIVE</span><br><span class="line">Open count:        1</span><br><span class="line">Event number:      0</span><br><span class="line">Major, minor:      253, 4</span><br><span class="line">Number of targets: 1</span><br><span class="line">UUID: LVM-jKQjctpauajJM9B6bT1OaygGfZYROrC2FNNC1tRiXxEG14UBO2GBN4umaKvne0FI</span><br></pre></td></tr></table></figure><ol start="3"><li><p>search for processes using those numbers (replace 253,X) with actual numbers</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsof -n 2&gt;&amp;1 | grep &#x27;253,X&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. according above example</span></span><br><span class="line">lsof -n 2&gt;&amp;1 | grep &quot;253,4&quot;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> fs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>network snippet</title>
      <link href="/2024/12/05/network%20snippet/"/>
      <url>/2024/12/05/network%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h1><p><strong>Common Name (CN)</strong></p><p><strong>Alternative Name (SAN)</strong></p><p><strong>Transport Layer Security (TLS)</strong></p><h1 id="A-VS-B"><a href="#A-VS-B" class="headerlink" title="A VS B"></a>A VS B</h1><h2 id="SSL-VS-TLS"><a href="#SSL-VS-TLS" class="headerlink" title="SSL VS TLS"></a>SSL VS TLS</h2><blockquote><p>TLS (Transport Layer Security) and SSL (Secure Sockets Layer) are both cryptographic protocols used for secure communication over the internet. However, they have some key differences:</p></blockquote><p><strong>SSL (Secure Sockets Layer)</strong></p><ul><li>Developed by Netscape in 1994 as a predecessor to TLS</li><li>Primarily focused on web browsing security</li><li>Used for encrypting data between a clientâ€™s browser and a server</li><li>Typically used with port 443 (HTTPS)</li><li>Considered insecure due to weaknesses in its encryption algorithms and key exchange mechanisms</li></ul><p><strong>TLS (Transport Layer Security)</strong></p><ul><li>Developed by the Internet Engineering Task Force (IETF) as a successor to SSL</li><li>Focuses on secure communication between any two endpoints, not just web browsing</li><li>Uses more robust encryption algorithms, such as AES-256, and improved key exchange mechanisms</li><li>Supports multiple versions of the protocol (TLS 1.0, TLS 1.1, TLS 1.2)</li><li>Now considered a standard for secure internet communications</li></ul><p><strong>Key differences:</strong></p><ol><li><strong>Name</strong>: SSL was originally used for web browsing security, while TLS is more general-purpose.</li><li><strong>Encryption algorithms</strong>: TLS uses stronger encryption algorithms than SSL.</li><li><strong>Key exchange mechanisms</strong>: TLS has improved key exchange mechanisms compared to SSL.</li><li><strong>Protocol versions</strong>: TLS supports multiple protocol versions (TLS 1.0, TLS 1.1, TLS 1.2), while SSL is typically associated with a single version.</li></ol><p><strong>When to use each:</strong></p><ul><li>Use SSL when you need to maintain compatibility with older systems or browsers that only support the original SSL protocol.</li><li>Use TLS for new applications and systems where security is paramount.</li></ul><p>Keep in mind that most modern systems, including web servers and clients, have already adopted TLS as the standard for secure communication. If youâ€™re developing a new application or system, itâ€™s recommended to use TLS to ensure the highest level of security.</p><h2 id="RDMA-vs-InfiniBand-vs-RoCE"><a href="#RDMA-vs-InfiniBand-vs-RoCE" class="headerlink" title="RDMA vs InfiniBand vs RoCE"></a>RDMA vs InfiniBand vs RoCE</h2><table><thead><tr><th><strong>Feature</strong></th><th><strong>RDMA</strong></th><th><strong>InfiniBand</strong></th><th><strong>RoCE</strong></th></tr></thead><tbody><tr><td>Type</td><td>Technology</td><td>Network standard + hardware</td><td>Protocol (RDMA over Ethernet)</td></tr><tr><td>Runs Over</td><td>InfiniBand, RoCE, iWARP</td><td>InfiniBand cables and switches</td><td>Ethernet (RoCE v1/v2)</td></tr><tr><td>Needs RDMA?</td><td>âœ… Yes</td><td>âœ… Yes (native)</td><td>âœ… Yes (via Ethernet NICs with RDMA)</td></tr><tr><td>Main Use Case</td><td>Fast memory transfer</td><td>HPC, low-latency compute</td><td>Data centers, storage over Ethernet</td></tr></tbody></table><p>In Practical Terms:</p><ul><li><strong>RDMA</strong> is the <strong>core mechanism</strong>.</li><li><strong>InfiniBand</strong> is a <strong>specialized RDMA transport</strong>.</li><li><strong>RoCE</strong> is a <strong>way to use RDMA over standard Ethernet</strong> hardware (with special NIC support).</li></ul><p>So, if you have <strong>InfiniBand</strong> hardware â€” youâ€™re doing <strong>native RDMA</strong>.</p><p>If youâ€™re using <strong>RoCE</strong> â€” youâ€™re doing <strong>RDMA over Ethernet</strong> (with RDMA-capable NICs like Mellanox).</p><h1 id="RDMA"><a href="#RDMA" class="headerlink" title="RDMA"></a>RDMA</h1><blockquote><p> RDMA (Remote Direct Memory Access)</p></blockquote><ul><li>RDMA is a <strong>technology</strong> that allows one computer to directly access the memory of another computer <strong>without involving the CPU, OS, or context switching</strong> on the remote system.<ul><li><strong>Low latency</strong></li><li><strong>High throughput</strong></li><li><strong>Very low CPU usage</strong></li></ul></li><li><strong>Used in:</strong> HPC clusters, storage systems, distributed databases (like Ceph, NVMe-oF, RDMA-aware MPI, etc.)</li></ul><h1 id="InfiniBand"><a href="#InfiniBand" class="headerlink" title="InfiniBand"></a>InfiniBand</h1><blockquote><p>RDMA was first implemented over InfiniBand â€” so itâ€™s the â€œclassicâ€ RDMA transport</p></blockquote><ul><li>InfiniBand is a <strong>high-performance network architecture</strong> designed specifically for data centers and HPC, and it <strong>natively supports RDMA</strong>.<ul><li>Specialized hardware (InfiniBand adapters and switches)</li><li>Very high bandwidth (100 Gbps+)</li><li>Very low latency</li><li>Used in supercomputers, HPC clusters, etc.</li></ul></li></ul><h1 id="RoCE"><a href="#RoCE" class="headerlink" title="RoCE"></a>RoCE</h1><blockquote><p> RDMA over Converged Ethernet</p></blockquote><ul><li><p>RoCE allows RDMA to run <strong>over standard Ethernet networks</strong> instead of specialized InfiniBand hardware.</p><ul><li><strong>RoCE v1:</strong> Requires a lossless Ethernet fabric (same L2 subnet).</li><li><strong>RoCE v2:</strong> Works over routed networks (L3) using UDP encapsulation.</li></ul></li><li><p>RoCE allows RDMA to be deployed using more common Ethernet-based infrastructure, often used in cloud and data center deployments.</p></li></ul><p>Great follow-up! Letâ€™s explore the relationship between <strong>RDMA</strong> and <strong>Mellanox</strong>, which is very close and central in the high-performance networking world.</p><h1 id="Mellanox"><a href="#Mellanox" class="headerlink" title="Mellanox"></a>Mellanox</h1><ul><li><strong>Mellanox Technologies</strong> (now owned by <strong>NVIDIA</strong>) is a <strong>leading vendor</strong> of high-performance network interface cards (NICs), switches, and software â€” especially for <strong>InfiniBand</strong> and <strong>Ethernet</strong> with RDMA capabilities.</li><li>Mellanox NIC families (like <strong>ConnectX-3, 4, 5, 6, 7</strong>, etc.) support:<ul><li><strong>InfiniBand RDMA</strong></li><li><strong>RoCE v1 / v2 RDMA</strong></li><li><strong>iWARP</strong> (less commonly used)</li></ul></li><li>Mellanox also provides the <strong>driver stack</strong> and <strong>tools</strong> to enable RDMA:<ul><li>mlx5_ib â†’ RDMA over Mellanox NICs</li><li>mlx4_core, mlx5_core â†’ core NIC drivers</li><li>ibverbs, rdma-core â†’ user-space RDMA APIs</li><li>ethtool, ibstat, ibv_devinfo, rdma â†’ debug/config tools</li></ul></li></ul><table><thead><tr><th><strong>Component</strong></th><th><strong>Role</strong></th></tr></thead><tbody><tr><td><strong>RDMA</strong></td><td>Technology for fast memory access</td></tr><tr><td><strong>InfiniBand/RoCE</strong></td><td>Transport for RDMA</td></tr><tr><td><strong>Mellanox NICs</strong></td><td>Hardware that <strong>implements RDMA</strong></td></tr><tr><td><strong>Mellanox drivers</strong></td><td>Software to <strong>enable RDMA support</strong> on Linux</td></tr><tr><td><strong>rdma-core + ibverbs</strong></td><td>API layer used by apps (e.g., MPI, Ceph)</td></tr></tbody></table><p><strong>Mellanox</strong> provides the <strong>hardware and drivers</strong> that make RDMA <em>actually work on your servers</em>.</p>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bazel</title>
      <link href="/2024/11/25/bazel/"/>
      <url>/2024/11/25/bazel/</url>
      
        <content type="html"><![CDATA[<p><strong>MODULE.bazel</strong></p><blockquote><p>is equal WORKSPACE at old bazel version</p></blockquote><ul><li>The <code>MODULE.bazel</code> file, which identifies the directory and its contents as a Bazel workspace and lives at the root of the projectâ€™s directory structure. Itâ€™s also where you specify your external dependencies.</li></ul><p><strong>BUILD</strong></p><ul><li>One or more <a href="https://bazel.build/reference/glossary#build-file"><code>BUILD</code> files</a>, which tell Bazel how to build different parts of the project. A directory within the workspace that contains a <code>BUILD</code> file is a package. (More on packages later in this tutorial.)</li></ul>]]></content>
      
      
      <categories>
          
          <category> build </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jenkins practice</title>
      <link href="/2024/11/18/jenkins%20practice/"/>
      <url>/2024/11/18/jenkins%20practice/</url>
      
        <content type="html"><![CDATA[<h1 id="config-SSL"><a href="#config-SSL" class="headerlink" title="config SSL"></a>config SSL</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1 generate the SSL public and private keys</span></span><br><span class="line">openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2 merge key.pem key and the certificate.pem by converting them to a .p12 keystore</span></span><br><span class="line">openssl pkcs12 -inkey key.pem -in certificate.pem -export -out certificate.p12  # generate certificate.p12</span><br><span class="line"><span class="meta">#</span><span class="bash"> passwd: dongw123</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step3 import the .p12 file with keytool and convert it into a .jks keystore</span></span><br><span class="line">keytool -importkeystore -srckeystore ./certificate.p12 -srcstoretype pkcs12 -destkeystore jenkinsserver.jks -deststoretype JKS # generate jenkinsserver.jks</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step4 Add JKS File to Jenkins Path</span></span><br><span class="line">sudo cp jenkinsserver.jks /var/lib/jenkins/</span><br><span class="line">sudo chown jenkins:jenkins /var/lib/jenkins/jenkinsserver.jks</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step5 Configure Jenkins <span class="keyword">for</span> SSL Communication</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vim /etc/systemd/system/jenkins.service</span></span><br><span class="line">Environment=&quot;JENKINS_HTTPS_PORT=8443&quot;</span><br><span class="line">Environment=&quot;JENKINS_HTTPS_KEYSTORE=/var/lib/jenkins/jenkinsserver.jks&quot;</span><br><span class="line">Environment=&quot;JENKINS_HTTPS_KEYSTORE_PASSWORD=dongw123&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step6 restart service</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart jenkins.service </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Export Password: dongw123</span><br><span class="line">destination keystore password: dongw123</span><br><span class="line">source keystore password: dongw123</span><br></pre></td></tr></table></figure><h1 id="change-default-data-dir"><a href="#change-default-data-dir" class="headerlink" title="change default data dir"></a>change default data dir</h1><p>To change Jenkinsâ€™ default data directory from /var/lib/jenkins to /mnt/disk1, follow these steps:</p><ul><li>Stop Jenkins Service</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop jenkins</span><br></pre></td></tr></table></figure><ul><li>Move the existing data to the new directory:</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /var/lib/jenkins /mnt/disk1/</span><br></pre></td></tr></table></figure><ul><li>Ensure the ownership is correct:</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R jenkins:jenkins /mnt/disk1/jenkins</span><br></pre></td></tr></table></figure><ul><li>Edit the Jenkins service file</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> edit /etc/systemd/system/jenkins.service or /usr/lib/systemd/system/jenkins.service</span></span><br><span class="line">Environment=&quot;JENKINS_HOME=/mnt/disk1/jenkins&quot;</span><br><span class="line">WorkingDirectory=/mnt/disk1/jenkins</span><br></pre></td></tr></table></figure><ul><li>Reload Systemd and Restart Jenkins</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart jenkins</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> jenkins </category>
          
      </categories>
      
      
        <tags>
            
            <tag> practice </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheus &amp; Grafana</title>
      <link href="/2024/10/25/prometheus%20&amp;%20grafana/"/>
      <url>/2024/10/25/prometheus%20&amp;%20grafana/</url>
      
        <content type="html"><![CDATA[<h1 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h1><h2 id="node-exporter"><a href="#node-exporter" class="headerlink" title="node_exporter"></a>node_exporter</h2><ul><li><p>package</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>prepare user and directory</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd -f dingofs</span><br><span class="line">sudo useradd -g dingofs dingofs</span><br><span class="line">sudo mkdir /etc/node_exporter</span><br><span class="line">sudo chown dingofs:dingofs /etc/node_exporter</span><br><span class="line"></span><br><span class="line">sudo cp /path/to/node_exporter-files/node_exporter /usr/bin/</span><br><span class="line">sudo chown dingofs:dingofs /usr/bin/node_exporter</span><br></pre></td></tr></table></figure></li><li><p>config system service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /usr/lib/systemd/system/node_exporter.service</span><br><span class="line">sudo chmod 664 /usr/lib/systemd/system/node_exporter.service</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">Unit</span>]</span><br><span class="line"><span class="string">Description=Node</span> <span class="string">Exporter</span></span><br><span class="line"><span class="string">Documentation=https://prometheus.io/docs/guides/node-exporter/</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Service</span>]</span><br><span class="line"><span class="string">User=dingofs</span></span><br><span class="line"><span class="string">Group=dingofs</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/node_exporter</span> <span class="string">\</span></span><br><span class="line">  <span class="string">--web.listen-address=:19100</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Install</span>]</span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br></pre></td></tr></table></figure></li><li><p>start system service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl start node_exporter</span><br><span class="line">sudo systemctl status node_exporter</span><br><span class="line">sudo systemctl enable node_exporter.service # Configure node_exporter to start at boot</span><br></pre></td></tr></table></figure></li></ul><h2 id="prometheus-server"><a href="#prometheus-server" class="headerlink" title="prometheus server"></a>prometheus server</h2><ul><li><p>prometheus.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>     <span class="string">15s</span> <span class="comment"># By default, scrape targets every 15 seconds.</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span> <span class="comment"># Evaluate rules every 15 seconds.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Attach these extra labels to all timeseries collected by this Prometheus instance.</span></span><br><span class="line">  <span class="attr">external_labels:</span></span><br><span class="line">    <span class="attr">monitor:</span> <span class="string">&#x27;codelab-monitor&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rule_files:</span></span><br><span class="line"><span class="comment">#- &#x27;prometheus.rules.yml&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Override the global default and scrape targets from this job every 5 seconds.</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;172.20.7.232:19090&#x27;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Override the global default and scrape targets from this job every 5 seconds.</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;172.20.7.232:19100&#x27;</span>,<span class="string">&#x27;172.20.7.233:19100&#x27;</span>,<span class="string">&#x27;172.20.7.234:19100&#x27;</span>]</span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">&#x27;metric1&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>docker container</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create persistent volume <span class="keyword">for</span> your data</span></span><br><span class="line">docker volume create prometheus-data</span><br><span class="line"><span class="meta">#</span><span class="bash"> Start Prometheus container</span></span><br><span class="line">docker run -d \</span><br><span class="line">    -p 19090:19090 \</span><br><span class="line">    -v /path/to/prometheus.yml:/etc/prometheus/prometheus.yml \</span><br><span class="line">    -v prometheus-data:/prometheus \</span><br><span class="line">    prom/prometheus</span><br></pre></td></tr></table></figure><h1 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h1><ul><li><p>deploy container</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> create a persistent volume <span class="keyword">for</span> your data</span></span><br><span class="line">docker volume create grafana-storage</span><br><span class="line"><span class="meta">#</span><span class="bash"> verify that the volume was created correctly</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you should see some JSON output</span></span><br><span class="line">docker volume inspect grafana-storage</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> start grafana</span></span><br><span class="line">docker run -d -p 13000:3000 --name=grafana \</span><br><span class="line">  --volume grafana-storage:/var/lib/grafana \</span><br><span class="line">  grafana/grafana</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> web login</span></span><br><span class="line">admin/admin</span><br></pre></td></tr></table></figure></li></ul><h2 id="dashboard"><a href="#dashboard" class="headerlink" title="dashboard"></a>dashboard</h2><p><a href="https://grafana.com/grafana/dashboards/">https://grafana.com/grafana/dashboards/</a></p><p><strong>just import from existed dashboard json</strong></p><p>enjoy it</p><ul><li>reference<ul><li><a href="https://grafana.com/docs/grafana/latest/setup-grafana/installation/docker/">official deploy</a></li><li><a href="https://grafana.com/docs/grafana/latest/datasources/prometheus/configure-prometheus-data-source/">config prometheous</a></li><li><a href="https://grafana.com/docs/grafana/latest/getting-started/get-started-grafana-prometheus/">Get started with Grafana and Prometheus</a></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang command</title>
      <link href="/2024/10/22/golang%20cmd/"/>
      <url>/2024/10/22/golang%20cmd/</url>
      
        <content type="html"><![CDATA[<h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><blockquote><p>ä½ å¯ä»¥è¦†ç›– 100% çš„ä»£ç è¡Œï¼Œä½†ä½ æ°¸è¿œæ— æ³•è¦†ç›– 100% çš„è¾“å…¥å’ŒçŠ¶æ€ç»„åˆ</p></blockquote><ul><li>å•å…ƒæµ‹è¯• (Unit Testing): éªŒè¯å¼€å‘è€…å¯¹ä»£ç å•å…ƒåœ¨é¢„æœŸè¾“å…¥ä¸‹çš„è¡Œä¸ºã€‚</li><li>æ¨¡ç³Šæµ‹è¯• (Fuzz Testing): é€šè¿‡è‡ªåŠ¨ç”Ÿæˆå¤§é‡éšæœºæˆ–å˜å¼‚è¾“å…¥ï¼Œæ¢ç´¢ä»£ç çš„è¾¹ç¼˜æƒ…å†µå’ŒæœªçŸ¥ç¼ºé™·ã€‚Go 1.18 å·²å°† Fuzz Testing å†…ç½®åˆ°æ ‡å‡†å·¥å…·é“¾ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ­¦å™¨ã€‚</li><li>é›†æˆæµ‹è¯• (Integration Testing): éªŒè¯æ¨¡å—é—´çš„äº¤äº’ã€‚</li><li>ç«¯åˆ°ç«¯æµ‹è¯• (End-to-End Testing): æ¨¡æ‹ŸçœŸå®ç”¨æˆ·åœºæ™¯ã€‚</li><li>ç”Ÿäº§æµ‹è¯•/ç°åº¦å‘å¸ƒ (Staged Rollouts / Canary Releases): åœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå°èŒƒå›´ã€é€æ­¥åœ°éªŒè¯å˜æ›´çš„å¯é æ€§ï¼Œè¿™æ˜¯å¤§å‹ç³»ç»Ÿå‘å¸ƒçš„â€œé‡‘ä¸é›€â€ã€‚</li></ul><p><strong>command</strong></p><ul><li><code>go test -v</code></li><li><code>go test -cover</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•æŒ‡å®šç›®å½•ä¸‹çš„æŸä¸ªæ–¹æ³•</span></span><br><span class="line">go test -v /path/to/package -run ^FuncName$</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. go <span class="built_in">test</span> -v ./http -run ^TestRunning$  <span class="comment"># æ³¨æ„ &quot;./&quot; è¿™ä¸ªæ˜¯å¿…é¡»çš„</span></span></span><br></pre></td></tr></table></figure><h1 id="Tool"><a href="#Tool" class="headerlink" title="Tool"></a>Tool</h1><ul><li><p>install</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install github.com/go-resty/resty/v2@xxx</span><br></pre></td></tr></table></figure></li><li><p>errcheck</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">errcheck .</span><br></pre></td></tr></table></figure></li><li><p>format</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gofmt -w yourfile.go</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>mod</p><p><code>go mod tidy</code> is used to clean up the module directory by removing any unnecessary files, such as: Unused dependencies, Duplicate entries, Empty directories</p><p><code>go mod vendor</code> is a part of Goâ€™s vendor tooling, which allows you to manage dependencies in your project by creating a separate directory called <code>vendor</code>. This directory contains all the dependencies required for your project.</p><p><strong>Purpose</strong>: <code>go mod tidy</code> is used for cleaning up the module directory, while <code>go mod vendor</code> is used for managing dependencies in a separate <code>vendor</code> directory.</p><p><strong>Output</strong>: <code>go mod tidy</code> updates the <code>go.mod</code> file, while <code>go mod vendor</code> creates or updates the <code>vendor</code> directory.</p></li><li><p>run</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run /path/to/main/directory</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>devops</title>
      <link href="/2024/10/10/devops/"/>
      <url>/2024/10/10/devops/</url>
      
        <content type="html"><![CDATA[<img src="/images/devops/cicd.jpg" style="zoom: 100%">]]></content>
      
      
      <categories>
          
          <category> devops </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>minio snippet</title>
      <link href="/2024/09/29/minio/"/>
      <url>/2024/09/29/minio/</url>
      
        <content type="html"><![CDATA[<h1 id="concept"><a href="#concept" class="headerlink" title="concept"></a>concept</h1><h2 id="Erasure-Coding"><a href="#Erasure-Coding" class="headerlink" title="Erasure Coding"></a>Erasure Coding</h2><p><strong>Erasure Coding</strong> splits data into data and parity shards. For example, MinIO might use a <strong>4:2 erasure code</strong> (should use 6  disks), meaning each object is split into 4 data shards and 2 parity shards.</p><blockquote><p>In a 4:2 erasure coding setup:</p><p>4 data shards hold the actual object data.</p><p>2 parity shards are created for redundancy.</p></blockquote><p>In this configuration, every object is broken into smaller pieces, with redundancy pieces (parity shards) stored to allow recovery if a disk or node fails.</p><h1 id="install"><a href="#install" class="headerlink" title="install"></a>install</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.min.io/server/minio/release/linux-amd64/minio</span><br><span class="line">chmod +x minio</span><br><span class="line">sudo mv minio /usr/local/bin/</span><br></pre></td></tr></table></figure><h2 id="plan1-deploy-binary"><a href="#plan1-deploy-binary" class="headerlink" title="plan1: deploy binary"></a>plan1: deploy binary</h2><ul><li><p>hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx minio1.dev.net</span><br><span class="line">xxx minio2.dev.net</span><br><span class="line">xxx minio3.dev.net</span><br></pre></td></tr></table></figure></li><li><p>service</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> service file</span></span><br><span class="line">/usr/lib/systemd/system/minio.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default config file</span></span><br><span class="line">/etc/default/minio</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> reload config after modify default file</span></span><br><span class="line">sudo systemctl stop minio</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœæ›´æ”¹MINIO_VOLUMESä¿¡æ¯ï¼Œå¹¶ä¸”éœ€è¦ç”¨åˆ°ä¹‹å‰çš„ä¸€äº›ç›˜ç¬¦ï¼Œéœ€è¦æ¸…ç†å¹²å‡€ç›¸å…³ç›®å½•çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ .minio.sysï¼‰</span></span><br><span class="line">éœ€è¦ç›®å½•é‡Œæ¸…ç†é—ç•™çš„æ‰€æœ‰æ–‡ä»¶ ï¼ˆrm -rf ./* å‘½ä»¤ä¸ä¼šæ¸…ç†éšè—æ–‡ä»¶ï¼‰</span><br></pre></td></tr></table></figure><ul><li><p>minio.service</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">Unit</span>]</span><br><span class="line"><span class="string">Description=MinIO</span></span><br><span class="line"><span class="string">Documentation=https://docs.min.io</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"><span class="string">AssertFileIsExecutable=/usr/local/bin/minio</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Service</span>]</span><br><span class="line"><span class="string">Type=notify</span></span><br><span class="line"></span><br><span class="line"><span class="string">WorkingDirectory=/usr/local</span></span><br><span class="line"></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string">Group=root</span></span><br><span class="line"><span class="string">ProtectProc=invisible</span></span><br><span class="line"></span><br><span class="line"><span class="string">EnvironmentFile=-/etc/default/minio</span></span><br><span class="line"><span class="string">ExecStart=/usr/local/bin/minio</span> <span class="string">server</span> <span class="string">$MINIO_OPTS</span> <span class="string">$MINIO_VOLUMES</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Let systemd restart this service always</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the maximum file descriptor number that can be opened by this process</span></span><br><span class="line"><span class="string">LimitNOFILE=1048576</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn-off memory accounting by systemd, which is buggy.</span></span><br><span class="line"><span class="string">MemoryAccounting=no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the maximum number of threads this process can create</span></span><br><span class="line"><span class="string">TasksMax=infinity</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable timeout logic and wait until process is stopped</span></span><br><span class="line"><span class="string">TimeoutSec=infinity</span></span><br><span class="line"></span><br><span class="line"><span class="string">SendSIGKILL=no</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Install</span>]</span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br></pre></td></tr></table></figure></li><li><p>/etc/default/minio</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">MINIO_VOLUMES=&quot;http://minio&#123;1...3&#125;.dev.net:19000/mnt/disk2/minio&quot;</span></span><br><span class="line"><span class="comment">#MINIO_VOLUMES=&quot;http://minio&#123;1...3&#125;.dev.net:19000/mnt/disk&#123;0...1&#125;/minio&quot;</span></span><br><span class="line"><span class="comment">#MINIO_VOLUMES=&quot;http://minio1.dev.net:19000/mnt/disk1/minio http://minio2.dev.net:19000/mnt/disk1/minio http://minio3.dev.net:19000/mnt/disk1/minio&quot;</span></span><br><span class="line"><span class="comment">#MINIO_VOLUMES=&quot;http://minio2.dev.net:19000/mnt/minio http://minio3.dev.net:19000/mnt/minio&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set all MinIO server options</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following explicitly sets the MinIO Console listen address to</span></span><br><span class="line"><span class="comment"># port 9001 on all network interfaces. The default behavior is dynamic</span></span><br><span class="line"><span class="comment"># port selection.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#MINIO_OPTS=&quot;--console-address :9001&quot;</span></span><br><span class="line"><span class="string">MINIO_OPTS=&#x27;</span> <span class="string">--console-address=&quot;:19001&quot;</span> <span class="string">--address=&quot;:19000&quot;</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Set the root username. This user has unrestricted permissions to</span></span><br><span class="line"><span class="string"># perform S3 and administrative API operations on any resource in the</span></span><br><span class="line"><span class="string"># deployment.</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string"># Defer to your organizations requirements for superadmin user name.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MINIO_ROOT_USER=minioadmin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Set the root password</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string"># Use a long, random, unique string that meets your organizations</span></span><br><span class="line"><span class="string"># requirements for passwords.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MINIO_ROOT_PASSWORD=minioadmin</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="plan2-container"><a href="#plan2-container" class="headerlink" title="plan2: container"></a>plan2: container</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -dt                                  \</span><br><span class="line">  -p 9000:9000 -p 9001:9001                     \</span><br><span class="line">  -v /mnt/minio:/mnt/data                             \</span><br><span class="line">  -v /etc/default/minio:/etc/config.env         \</span><br><span class="line">  -e &quot;MINIO_CONFIG_ENV_FILE=/etc/config.env&quot;    \</span><br><span class="line">  --name &quot;minio_local&quot;                          \</span><br><span class="line">  quay.io/minio/minio  server --console-address &quot;:9001&quot;</span><br></pre></td></tr></table></figure><h1 id="client"><a href="#client" class="headerlink" title="client"></a>client</h1><h2 id="install-1"><a href="#install-1" class="headerlink" title="install"></a>install</h2>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl https://dl.min.io/client/mc/release/linux-amd64/mc \</span><br><span class="line">  --create-dirs \</span><br><span class="line">  -o $HOME/minio-binaries/mc</span><br><span class="line"></span><br><span class="line">chmod +x $HOME/minio-binaries/mc</span><br><span class="line"></span><br><span class="line">cp $HOME/minio-binaries/mc /usr/bin/</span><br><span class="line"></span><br><span class="line">mc alias set myminio http://minio1.dev.net:19000 &#123;ak&#125; &#123;sk&#125;</span><br></pre></td></tr></table></figure><h2 id="command"><a href="#command" class="headerlink" title="command"></a>command</h2><ul><li>log</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc admin logs myminio</span><br></pre></td></tr></table></figure><ul><li>development</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> add development</span></span><br><span class="line">mc alias set myminio &#123;endpoint_address&#125; &#123;ak&#125; &#123;sk&#125; </span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. mc <span class="built_in">alias</span> <span class="built_in">set</span> myminio http://minio1.dev.net:19000 1111111 22222222</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> alias-tls</span></span><br><span class="line">çœ‹ä¸‹é¢çš„ mc alias å†…å®¹</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls <span class="built_in">alias</span></span></span><br><span class="line">mc alias list</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> overview info</span></span><br><span class="line">mc admin info myminio</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check config</span></span><br><span class="line">mc admin config get myminio</span><br></pre></td></tr></table></figure><ul><li>bucket</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> create bucket</span></span><br><span class="line">mc mb &lt;ALIAS&gt;/&lt;BUCKET&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> list bucket</span></span><br><span class="line">mc ls &lt;ALIAS&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check bucket</span></span><br><span class="line">mc ls &lt;ALIAS&gt;/&lt;BUCKET&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> count total object/file num</span></span><br><span class="line">mc ls --summarize --recursive &lt;ALIAS&gt;</span><br><span class="line">mc ls --summarize --recursive &lt;ALIAS&gt;/&lt;BUCKET&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check object</span></span><br><span class="line">mc cat &lt;ALIAS&gt;/&lt;BUCKET&gt;/&lt;OBJECT&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete object</span></span><br><span class="line">mc rm &lt;ALIAS&gt;/&lt;BUCKET&gt;/&lt;OBJECT&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete according specify time</span> </span><br><span class="line">mc find &lt;alias/bucket-name&gt; --older-than &lt;time&gt; --exec &quot;mc rm &#123;&#125;&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. mc find myminio/mybucket --older-than 30d --<span class="built_in">exec</span> <span class="string">&quot;mc rm &#123;&#125;&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete all data</span></span><br><span class="line">mc rm --recursive --force &lt;ALIAS&gt;/&lt;BUCKET&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> force delete bucket</span></span><br><span class="line">mc rb --force &lt;ALIAS&gt;/&lt;BUCKET&gt;  # must delete bucket&#x27;s object file first</span><br></pre></td></tr></table></figure><ul><li><p>quota</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Increase the hard quota (e.g., to 10 GiB)</span></span><br><span class="line">mc quota set &lt;ALIAS&gt;/&lt;BUCKET&gt; --hard 10GiB</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check bucket quota</span></span><br><span class="line">mc quota info &lt;ALIAS&gt;/&lt;BUCKET&gt;</span><br></pre></td></tr></table></figure></li><li><p>heal</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Use MinIOâ€™s heal <span class="built_in">command</span> to ensure the data and metadata are consistent:</span></span><br><span class="line">mc admin heal -r &lt;ALIAS&gt;/</span><br></pre></td></tr></table></figure><ul><li>erasure code</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> erasure code</span></span><br><span class="line">mc admin config set myminio storage_class standard=EC:0</span><br><span class="line"><span class="meta">#</span><span class="bash"> should restart minio.service, and <span class="string">&#x27;systemctl status minio&#x27;</span> will <span class="built_in">print</span> <span class="string">&#x27;WARN: The standard parity is set to 0. This can lead to data loss&#x27;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check storage_class</span> </span><br><span class="line">mc admin config get myminio storage_class</span><br></pre></td></tr></table></figure><h1 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h1><h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><ul><li><a href="https://min.io/docs/minio/linux/operations/network-encryption.html#enabling-tls">enabling-tls</a></li></ul><blockquote><p>172.20.61.102 minio1.dev.net<br>172.20.61.103 minio2.dev.net<br>172.20.61.105 minio3.dev.net</p><p>/etc/default/minio:<br>MINIO_VOLUMES=â€<a href="https://minio{1...3}.dev.net:19000/mnt/minio%7B1...2%7D&quot;">https://minio{1...3}.dev.net:19000/mnt/minio{1...2}&quot;</a><br>MINIO_OPTS=â€™ â€“console-address=â€:19001â€ â€“address=â€:19000â€ â€˜</p></blockquote><p>By default, the MinIO server looks for the TLS keys and certificates for each node in the following directory: <code>$&#123;HOME&#125;/.minio/certs</code> (è¯¥è¯ä¹¦å­˜æ”¾å„è‡ªæœºå™¨çš„<code>private.key</code> å’Œ <code>public.crt</code>ï¼Œ æ¯å°æœºå™¨çš„ <code>private.key</code> å’Œ <code>public.crt</code>éƒ½ä¸ä¸€æ ·)</p><p>If using Certificates signed by a non-global or non-public Certificate Authority, <em>or</em> if using a global CA that requires the use of intermediate certificates, you must provide those CAs to the MinIO Server <code>/root/.minio/certs/CAs</code> (ç”¨æ¥å­˜æ”¾ç§æœ‰çš„è¯ä¹¦<code>ca.crt</code>ï¼Œè¯¥è¯ä¹¦ç”¨äºç”Ÿæˆæœºå™¨çš„<code>private.key</code> å’Œ <code>public.crt</code>ï¼Œ é›†ç¾¤çš„æ¯å°æœºå™¨å­˜æ”¾çš„<code>ca.crt</code>åº”è¯¥ä¿æŒä¸€è‡´)</p><ol><li><strong>Generate CA and Certificates <code>generate_certificate.sh</code></strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate CA private key</span></span><br><span class="line">openssl genrsa -out ca.key 4096</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create CA certificate</span></span><br><span class="line">openssl req -x509 -new -nodes -key ca.key -sha256 -days 3650 \</span><br><span class="line">    -out ca.crt \</span><br><span class="line">    -subj <span class="string">&quot;/C=US/ST=YourState/L=YourCity/O=YourOrg/OU=YourUnit/CN=MinioCA&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate server private keys for each node</span></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> minio1 minio2 minio3; <span class="keyword">do</span></span><br><span class="line">    openssl genrsa -out <span class="variable">$&#123;node&#125;</span>.key 2048</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Create server certificate signing request (CSR)</span></span><br><span class="line">    openssl req -new -key <span class="variable">$&#123;node&#125;</span>.key -out <span class="variable">$&#123;node&#125;</span>.csr \</span><br><span class="line">        -subj <span class="string">&quot;/C=US/ST=YourState/L=YourCity/O=YourOrg/OU=YourUnit/CN=<span class="variable">$&#123;node&#125;</span>.dev.net&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Create server certificate configuration</span></span><br><span class="line">    cat &gt; <span class="variable">$&#123;node&#125;</span>.ext &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">authorityKeyIdentifier=keyid,issuer</span></span><br><span class="line"><span class="string">basicConstraints=CA:FALSE</span></span><br><span class="line"><span class="string">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[alt_names]</span></span><br><span class="line"><span class="string">DNS.1 = $&#123;node&#125;.dev.net</span></span><br><span class="line"><span class="string">IP.1 = 172.20.61.$(grep $&#123;node&#125; /etc/hosts | awk &#x27;&#123;print $1&#125;&#x27; | cut -d. -f4)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Sign server certificate with CA</span></span><br><span class="line">    openssl x509 -req -<span class="keyword">in</span> <span class="variable">$&#123;node&#125;</span>.csr -CA ca.crt -CAkey ca.key \</span><br><span class="line">        -CAcreateserial -out <span class="variable">$&#123;node&#125;</span>.crt -days 3650 \</span><br><span class="line">        -sha256 -extfile <span class="variable">$&#123;node&#125;</span>.ext</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>Distribute Certificates <code>copy_certificate.sh</code></strong><blockquote><p>if use regular user instead of root, change reference  dir to /home/<user>/.minio/certs</p></blockquote></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create certificate directories</span></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> minio1 minio2 minio3; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># Copy node-specific certificate and key</span></span><br><span class="line">    scp <span class="variable">$&#123;node&#125;</span>.crt root@<span class="variable">$&#123;node&#125;</span>.dev.net:/root/.minio/certs/public.crt</span><br><span class="line">    scp <span class="variable">$&#123;node&#125;</span>.key root@<span class="variable">$&#123;node&#125;</span>.dev.net:/root/.minio/certs/private.key</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Copy CA certificate to trusted CAs</span></span><br><span class="line">    scp ca.crt root@<span class="variable">$&#123;node&#125;</span>.dev.net:/root/.minio/certs/CAs/</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p><strong>Update MinIO Configuration</strong><br>Modify <code>/etc/default/minio</code> on each node to ensure proper TLS configuration:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Update MINIO_VOLUMES to use https</span></span><br><span class="line">MINIO_VOLUMES=<span class="string">&quot;https://minio&#123;1...3&#125;.dev.net:19000/mnt/minio&#123;1...2&#125;&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>Set Correct Permissions (optional)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> minio1 minio2 minio3; <span class="keyword">do</span></span><br><span class="line">    ssh root@<span class="variable">$&#123;node&#125;</span>.dev.net <span class="string">&quot;</span></span><br><span class="line"><span class="string">    chown -R minio:minio /root/.minio/certs</span></span><br><span class="line"><span class="string">    chmod 700 /root/.minio/certs</span></span><br><span class="line"><span class="string">    chmod 600 /root/.minio/certs/private.key</span></span><br><span class="line"><span class="string">    chmod 644 /root/.minio/certs/public.crt /root/.minio/certs/CAs/*</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Restart MinIO Cluster</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart minio</span><br></pre></td></tr></table></figure></li><li><p> <strong>Trust certificate globally</strong></p></li></ol><blockquote><p>æ¯å°æœºå™¨å‡éœ€è¦æ“ä½œä¸€éï¼ˆè¿™æ ·å¯ä»¥ä¿è¯mcè®¾ç½®aliasæˆåŠŸï¼‰</p></blockquote>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /root/.minio/certs/CAs/ca.crt /etc/pki/ca-trust/source/anchors/</span><br><span class="line">sudo update-ca-trust extract</span><br><span class="line">sudo openssl verify -CAfile /etc/pki/tls/certs/ca-bundle.crt /etc/pki/ca-trust/source/anchors/ca.crt</span><br></pre></td></tr></table></figure><ol start="7"><li>Verification</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check TLS configuration on each node</span></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> minio1 minio2 minio3; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Checking <span class="variable">$&#123;node&#125;</span>:&quot;</span></span><br><span class="line">    ssh root@<span class="variable">$&#123;node&#125;</span>.dev.net <span class="string">&quot;</span></span><br><span class="line"><span class="string">    openssl x509 -in /root/.minio/certs/public.crt -text -noout</span></span><br><span class="line"><span class="string">    echo &#x27;---&#x27;</span></span><br><span class="line"><span class="string">    netstat -tuln | grep 19000</span></span><br><span class="line"><span class="string">    echo &#x27;---&#x27;</span></span><br><span class="line"><span class="string">    systemctl status minio</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>browser check</p><img src="/images/minio/cert.jpg" style="zoom: 60%"><h2 id="mc-alias"><a href="#mc-alias" class="headerlink" title="mc alias"></a>mc alias</h2><ul><li><p>step1: fetch the MinIO serverâ€™s certificate</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -n | openssl s_client -connect 172.30.14.127:19000 -showcerts | openssl x509</span><br></pre></td></tr></table></figure></li><li><p>step2: Move the Certificate to the Trusted Store</p><ul><li><p>ubuntu</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /usr/local/share/ca-certificates/  </span><br><span class="line"><span class="meta">#</span><span class="bash"> copy the entire certificate from step1 (including -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----).</span></span><br><span class="line">sudo vim /usr/local/share/ca-certificates/minio.crt</span><br><span class="line">sudo update-ca-certificates</span><br></pre></td></tr></table></figure></li><li><p>rocky</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/pki/ca-trust/source/anchors/</span><br><span class="line"><span class="meta">#</span><span class="bash"> copy the entire certificate from step1 (including -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----).</span></span><br><span class="line">sudo vim /etc/pki/ca-trust/source/anchors/minio.crt</span><br><span class="line">sudo update-ca-trust extract</span><br><span class="line">export SSL_CERT_FILE=/etc/pki/ca-trust/source/anchors/minio.crt</span><br></pre></td></tr></table></figure></li></ul></li><li><p>step3: add alias</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc alias set minio127 https://172.30.14.127:19000 &lt;ak&gt; &lt;sk&gt;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> minio </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubectl command</title>
      <link href="/2024/09/15/kubectl%20command/"/>
      <url>/2024/09/15/kubectl%20command/</url>
      
        <content type="html"><![CDATA[<h1 id="common"><a href="#common" class="headerlink" title="common"></a>common</h1><h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl version</span><br><span class="line">kubectl api-versions</span><br></pre></td></tr></table></figure><h2 id="health"><a href="#health" class="headerlink" title="health"></a>health</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check kubernetes inner ip</span> </span><br><span class="line">kubectl get svc kubernetes -n default</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check api server</span></span><br><span class="line">kubectl get componentstatuses</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check crd</span></span><br><span class="line">kubectl get crd | grep cert-manager</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check all pods</span></span><br><span class="line">kubectl get pods -A</span><br></pre></td></tr></table></figure><h2 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete all resource by specify namespace</span></span><br><span class="line">kubectl delete all --all -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h1 id="node"><a href="#node" class="headerlink" title="node"></a>node</h1><h2 id="resource"><a href="#resource" class="headerlink" title="resource"></a>resource</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> method 1: Check Node Resource Availability</span></span><br><span class="line">kubectl describe node &lt;node-name&gt;  # check Capacity, Allocatable, Allocated resources</span><br><span class="line">â€¢CPU available = Allocatable CPU - CPU Requests</span><br><span class="line">â€¢Memory available = Allocatable Memory - Memory Requests</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method 2: Get Detailed Resource Requests &amp; Limits <span class="keyword">for</span> All Pods</span></span><br><span class="line">kubectl get pods -A -o=custom-columns=&quot;NAMESPACE:.metadata.namespace,NAME:.metadata.name,CPU_REQUESTS:.spec.containers[*].resources.requests.cpu,MEM_REQUESTS:.spec.containers[*].resources.requests.memory,CPU_LIMITS:.spec.containers[*].resources.limits.cpu,MEM_LIMITS:.spec.containers[*].resources.limits.memory&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method 3:  Output <span class="keyword">for</span> Advanced Parsing json</span></span><br><span class="line">kubectl get nodes -o json | jq &#x27;.items[] | &#123;name: .metadata.name, allocatable: .status.allocatable&#125;&#x27;</span><br></pre></td></tr></table></figure><h2 id="label"><a href="#label" class="headerlink" title="label"></a>label</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> show all labels</span></span><br><span class="line">kubectl get nodes --show-labels</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> add label on node</span></span><br><span class="line">kubectl label node &lt;node-name&gt; &lt;label-key&gt;=&lt;label-value&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remove label from node</span></span><br><span class="line">kubectl label node &lt;node-name&gt; &lt;label-key&gt;-</span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl label nodes sd-shangdi-ceph17 dingofs-csi-node-</span></span><br></pre></td></tr></table></figure><h2 id="taint"><a href="#taint" class="headerlink" title="taint"></a>taint</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check node is taint or not</span></span><br><span class="line">kubectl describe node &lt;nodeName&gt; | grep -i taint</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> taint node <span class="built_in">print</span></span></span><br><span class="line">Taints: nodepool=fault:NoSchedule</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> normal node <span class="built_in">print</span></span></span><br><span class="line">Taints: &lt;none&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tag taint</span></span><br><span class="line">kubectl taint node &lt;node&gt; nodepool=fault:NoSchedule</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remove taint</span></span><br><span class="line">kubectl taint node &lt;node-name&gt; &lt;key&gt;:&lt;value&gt;-</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. kubectl taint node node1 nodepool=fault:NoSchedule-</span></span><br></pre></td></tr></table></figure><h1 id="All"><a href="#All" class="headerlink" title="All"></a>All</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> delete all resource</span></span><br><span class="line">kubectl delete all --all -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h1 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h1><h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list namespace<span class="string">&#x27;s pod</span></span></span><br><span class="line">kubectl get pod -n &#123;namespace&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> describe</span></span></span><br><span class="line">kubectl describe pod &#123;podName&#125;</span><br></pre></td></tr></table></figure><h2 id="log"><a href="#log" class="headerlink" title="log"></a>log</h2><blockquote><p>-c <container-name>: Specify which container to retrieve logs from.</p><p>-f: Stream the logs in real-time.</p><p>â€“previous: Show logs from the last terminated container.</p><p>â€“since=<duration>: Return logs for the last period (e.g., 1h, 30m).</p><p>â€“tail=<lines>: Limit the number of log lines returned.</p><p>â€“all-containers=true: Get logs from all containers in the pod.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> pod</span></span><br><span class="line">kubectl logs -f &#123;podId&#125; -n &#123;namespace&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pod<span class="string">&#x27;s container</span></span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> check the logs from previous crash container</span></span></span><br><span class="line">kubectl logs &lt;pod-name&gt; --previous -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod &lt;å®¹å™¨id&gt; --kubeconfig=/path/to/configfile -o yaml &gt; env-vq48.yaml</span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get -o yaml è¿™æ ·çš„å‚æ•°ï¼Œä¼šå°†æŒ‡å®šçš„ Pod API å¯¹è±¡ä»¥ YAML çš„æ–¹å¼å±•ç¤ºå‡ºæ¥ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> expose</span></span><br><span class="line">kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o yaml &gt; pod-config.yaml</span><br></pre></td></tr></table></figure><h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><p>without kubeconfig</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> enter pod on specify container</span></span><br><span class="line">kubectl exec -it &#123;pod_id&#125; -n &#123;namespace&#125; -c &#123;container_id&#125; -- sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> execute specify <span class="built_in">command</span> on pod</span></span><br><span class="line">kubectl exec -it &#123;pod_id&#125; -n &#123;namespace&#125; -c &#123;container_id&#125; -- &lt;shell&gt;</span><br><span class="line">e.g. kubectl exec -it csi-node-1 -n dingofs -- cat /etc/resolv.conf</span><br></pre></td></tr></table></figure><h2 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl cp å‘½ä»¤ç©ºé—´/å®¹å™¨id:path/to/source_file ./path/to/local_file</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ³¨æ„ podé‡Œé¢çš„è·¯å¾„æ— éœ€å¸¦ /ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„å³å¯ï¼ˆç›¸å¯¹äºè¿›å…¥podä¹‹åçš„é»˜è®¤ç›®å½•ï¼‰</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line">kubectl exec -n &lt;namespace&gt; &lt;pod_name&gt; -- tar cf - &lt;path/to/file&gt; | tar xf - -C .</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. kubectl <span class="built_in">exec</span> -n dingofs dingofs-csi-node-5bfkf -- tar cf - /proc/mounts | tar xf - -C .</span></span><br></pre></td></tr></table></figure><h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> method 1</span></span><br><span class="line">kubectl delete pod &#123;pod_name&#125; --grace-period=0 --force -n &#123;namespace&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method 2</span></span><br><span class="line">kubectl patch pod &lt;pod-name&gt; -n &lt;target-namespace&gt; -p &#x27;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;:null&#125;&#125;&#x27; --type=merge</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method 3</span></span><br><span class="line">step1 : kubectl edit pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line">step2 : delete the finalizers array under metadata, save the file, and exit</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>Aspect</strong></th><th><strong><code>kubectl patch</code></strong></th><th><strong><code>kubectl edit</code></strong></th></tr></thead><tbody><tr><td><strong>Interaction</strong></td><td>Non-interactive (scriptable).</td><td>Interactive (manual editing).</td></tr><tr><td><strong>Precision</strong></td><td>Targets only the <code>finalizers</code> field.</td><td>Requires manually deleting <code>finalizers</code>.</td></tr><tr><td><strong>Use Case</strong></td><td>Automation (e.g., CI/CD pipelines).</td><td>Debugging or ad-hoc fixes.</td></tr><tr><td><strong>Safety</strong></td><td>Risk of typos in JSON syntax.</td><td>Risk of accidental edits to other fields.</td></tr></tbody></table><h1 id="deployment"><a href="#deployment" class="headerlink" title="deployment"></a>deployment</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> restart</span></span><br><span class="line">kubectl rollout restart deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h1 id="statefulset"><a href="#statefulset" class="headerlink" title="statefulset"></a>statefulset</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> restart</span></span><br><span class="line">kubectl rollout restart StatefulSet/dingofs-csi-controller -n dingofs</span><br></pre></td></tr></table></figure><h1 id="daemonsets"><a href="#daemonsets" class="headerlink" title="daemonsets"></a>daemonsets</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get daemonsets --all-namespaces</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restart</span> </span><br><span class="line">kubectl rollout restart daemonset/dingofs-csi-node -n dingofs</span><br></pre></td></tr></table></figure><h1 id="service"><a href="#service" class="headerlink" title="service"></a>service</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc -o wide -n &lt;namespace&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete all</span></span><br><span class="line">kubectl delete service --all -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h1 id="storage"><a href="#storage" class="headerlink" title="storage"></a>storage</h1><h2 id="CSIDriver"><a href="#CSIDriver" class="headerlink" title="CSIDriver"></a>CSIDriver</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get csidrivers</span><br></pre></td></tr></table></figure><h2 id="storageclass"><a href="#storageclass" class="headerlink" title="storageclass"></a>storageclass</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get storageclass</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete</span> </span><br><span class="line">kubectl delete storageclass &lt;sc-name&gt;</span><br></pre></td></tr></table></figure><h2 id="pvc"><a href="#pvc" class="headerlink" title="pvc"></a>pvc</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pvc</span><br></pre></td></tr></table></figure><h2 id="pv"><a href="#pv" class="headerlink" title="pv"></a>pv</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list pv</span></span><br><span class="line">kubectl get pv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete multiply pv</span></span><br><span class="line">kubectl get pv --no-headers | grep &lt;NAME&gt; | awk &#x27;&#123;print $1&#125;&#x27; | xargs kubectl delete pv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete released status pvc</span></span><br><span class="line">kubectl get pv -o json | jq -r &#x27;.items[] | select(.status.phase==&quot;Released&quot;) | .metadata.name&#x27; | xargs kubectl delete pv</span><br></pre></td></tr></table></figure><ul><li><p>delete pv</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1: change stragety</span></span><br><span class="line">kubectl patch pv PV_NAME -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;persistentVolumeReclaimPolicy&quot;:&quot;Delete&quot;&#125;&#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2: delete</span></span><br><span class="line">kubectl delete pv PV_NAME</span><br></pre></td></tr></table></figure></li><li><p>PV reavailable</p><blockquote><p> ç°è±¡ï¼šåœ¨åŸæœ‰PVå·²ç»boundä¸Špvcçš„æƒ…å†µä¸‹ï¼ˆpvæ­¤æ—¶çŠ¶æ€ä½ boundï¼‰ï¼Œä¿®æ”¹äº†pvcçš„å‚æ•°ï¼Œå¹¶åˆ é™¤pvcï¼ˆæ­¤æ—¶pvçŠ¶æ€ä¸ºreleaseï¼‰ï¼Œé‡æ–°åº”ç”¨pvcä¹‹å ï¼ˆæ­¤æ—¶pvçŠ¶æ€ä¸ºreleaseï¼‰</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> éœ€è¦åº”ç”¨ `kubectl patch pv pv-1 -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;claimRef&quot;:null&#125;&#125;&#x27;</span>`ï¼ŒæŠŠ pvçŠ¶æ€ç½®ä¸º avaliableï¼Œè¿‡ä¸€ä¼š pvå°±ä¼šå’Œpvcå†æ¬¡ç»‘å®šï¼ˆpvçŠ¶æ€å˜ä¸ºboundï¼‰</span></span><br><span class="line">kubectl patch pv &lt;pv-name&gt; -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;claimRef&quot;:null&#125;&#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl patch pv pv-1 -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;persistentVolumeReclaimPolicy&quot;:&quot;Retain&quot;&#125;&#125;&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl patch pv pv-1 -p <span class="string">&#x27;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;:null&#125;&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure></li></ul><h1 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list role</span></span><br><span class="line">kubectl get role -n &lt;namespace&gt;  # -o yaml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> list clusterrole</span></span><br><span class="line">kubectl get clusterrole</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> list RoleBinding</span></span><br><span class="line">kubectl get rolebinding -n &lt;namespace&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> list clusterrolebinding</span></span><br><span class="line">kubectl get clusterrolebinding</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check <span class="keyword">if</span> the User Can List Pods <span class="keyword">in</span> Namespace</span></span><br><span class="line">kubectl auth can-i list pods --as=&lt;userName&gt; -n &lt;namespace&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check If the ServiceAccount Has Permissions to Get DaemonSets</span></span><br><span class="line">kubectl auth can-i get daemonsets --as=system:serviceaccount:&lt;namespace&gt;:&lt;serviceAccount&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> kubectl </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph command</title>
      <link href="/2024/09/09/ceph%20command/"/>
      <url>/2024/09/09/ceph%20command/</url>
      
        <content type="html"><![CDATA[<h1 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h1><h2 id="cephadm"><a href="#cephadm" class="headerlink" title="cephadm"></a>cephadm</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1 monitor</span></span><br><span class="line">cephadm bootstrap --mon-ip *&lt;mon-ip&gt;*</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ceph shell</span></span><br><span class="line">sudo ./cephadm shell</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can access the Ceph CLI as following <span class="keyword">in</span> <span class="keyword">case</span> of multi-cluster or non-default config:</span></span><br><span class="line">sudo /usr/sbin/cephadm shell --fsid &lt;fsid&gt; -c /etc/ceph/ceph.conf -k /etc/ceph/ceph.client.admin.keyring</span><br></pre></td></tr></table></figure><h1 id="service"><a href="#service" class="headerlink" title="service"></a>service</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check all vaild service</span></span><br><span class="line">ceph orch ls</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check all vaild/invaild service</span></span><br><span class="line">ceph orch ps</span><br></pre></td></tr></table></figure><h1 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> method 1</span></span><br><span class="line">ceph fsid</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method 2</span></span><br><span class="line">cat /etc/ceph/ceph.conf | grep fsid</span><br></pre></td></tr></table></figure><h1 id="User"><a href="#User" class="headerlink" title="User"></a>User</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check regular user key</span></span><br><span class="line">ceph auth list</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check admin key</span></span><br><span class="line">ceph auth get client.admin</span><br></pre></td></tr></table></figure><h1 id="health"><a href="#health" class="headerlink" title="health"></a>health</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph df</span><br></pre></td></tr></table></figure><h1 id="host"><a href="#host" class="headerlink" title="host"></a>host</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list host</span></span><br><span class="line">ceph orch host ls --detail</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> add host</span></span><br><span class="line">ssh-copy-id -f -i /etc/ceph/ceph.pub root@*&lt;new-host&gt;*</span><br><span class="line">ceph orch host add *&lt;newhost&gt;* [*&lt;ip&gt;*] [*&lt;label1&gt; ...*]</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g.  ceph orch host add host2 10.10.0.102 --labels _admin</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remove host</span></span><br><span class="line">ceph orch host drain *&lt;host&gt;*</span><br><span class="line">ceph orch ps &lt;host&gt;  # daemons on the host</span><br><span class="line">ceph orch host rm &lt;host&gt; # remove the host from the cluster after all daemons have been removed</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> add storage</span></span><br><span class="line">ceph orch apply osd --all-available-devices</span><br></pre></td></tr></table></figure><h1 id="osd"><a href="#osd" class="headerlink" title="osd"></a>osd</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list</span></span><br><span class="line">ceph orch device ls</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">ceph ods tree</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Creating New OSDs</span></span><br><span class="line">ceph orch apply osd --all-available-devices</span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line">ceph orch daemon add osd *&lt;host&gt;*:*&lt;device-path&gt;*</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g.</span></span><br><span class="line">ceph orch daemon add osd host1:/dev/sdb</span><br><span class="line">ceph orch daemon add osd host1:data_devices=/dev/sda,/dev/sdb,db_devices=/dev/sdc,osds_per_device=2</span><br></pre></td></tr></table></figure><h2 id="pool"><a href="#pool" class="headerlink" title="pool"></a>pool</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list available pool</span></span><br><span class="line">ceph osd pool ls</span><br></pre></td></tr></table></figure><h1 id="RGW"><a href="#RGW" class="headerlink" title="RGW"></a>RGW</h1><blockquote><p>radosgw</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">enable</span> rgw</span></span><br><span class="line">ceph mgr module enable rgw</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> config rgw name e.g. foo</span></span><br><span class="line">ceph orch apply rgw foo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lable host</span> </span><br><span class="line">ceph orch host label add gwhost1 rgw  # the &#x27;rgw&#x27; label can be anything</span><br><span class="line">ceph orch host label add gwhost2 rgw</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> apply</span></span><br><span class="line">ceph orch apply rgw foo &#x27;--placement=label:rgw count-per-host:2&#x27; --port=8000</span><br></pre></td></tr></table></figure><h1 id="radosgw-admin"><a href="#radosgw-admin" class="headerlink" title="radosgw-admin"></a>radosgw-admin</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> create user</span></span><br><span class="line">radosgw-admin user create --uid=dongwei --display-name=&quot;Dongwei User&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check user</span></span><br><span class="line">radosgw-admin user info --uid=dongwei</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check bucket info</span></span><br><span class="line">radosgw-admin bucket stats --bucket=&lt;bucket-name&gt;</span><br><span class="line">or </span><br><span class="line">radosgw-admin metadata get bucket:&lt;bucket&gt;</span><br></pre></td></tr></table></figure><h1 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph mon dump</span><br><span class="line"><span class="meta">#</span><span class="bash"> &lt;mon-ip&gt;:6789</span></span><br></pre></td></tr></table></figure><h1 id="Ceph-Object-Gateway"><a href="#Ceph-Object-Gateway" class="headerlink" title="Ceph Object Gateway"></a>Ceph Object Gateway</h1>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>c++ learn</title>
      <link href="/2024/09/08/c++%20learn/"/>
      <url>/2024/09/08/c++%20learn/</url>
      
        <content type="html"><![CDATA[<h1 id="philosophy"><a href="#philosophy" class="headerlink" title="philosophy"></a>philosophy</h1><p>The underlying design philosophy of C and C++ can be summed up as â€œtrust the programmerâ€ â€“ which is both wonderful and dangerous. C++ is designed to allow the programmer a high degree of freedom to do what they want. However, this also means the language often wonâ€™t stop you from doing things that donâ€™t make sense, because it will assume youâ€™re doing so for some reason it doesnâ€™t understand. There are quite a few pitfalls that new programmers are likely to fall into if caught unaware. This is one of the primary reasons why knowing what you shouldnâ€™t do in C/C++ is almost as important as knowing what you should do.</p><p>Typically, good solutions have the following characteristics:</p><ul><li>They are straightforward (not overly complicated or confusing).</li><li>They are well documented (especially around any assumptions being made or limitations).</li><li>They are built modularly, so parts can be reused or changed later without impacting other parts of the program.</li><li>They can recover gracefully or give useful error messages when something unexpected happens.</li></ul><h1 id="terminology"><a href="#terminology" class="headerlink" title="terminology"></a>terminology</h1><ul><li>CTAD (class template argument deduction) </li></ul><h1 id="liftcycle"><a href="#liftcycle" class="headerlink" title="liftcycle"></a>liftcycle</h1><blockquote><p>ç¼–ç ï¼ˆCodingï¼‰ã€é¢„å¤„ç†ï¼ˆPre-processingï¼‰ã€ç¼–è¯‘ï¼ˆCompilingï¼‰å’Œè¿è¡Œï¼ˆRunningï¼‰</p></blockquote><h2 id="Pre-processing"><a href="#Pre-processing" class="headerlink" title="Pre-processing"></a>Pre-processing</h2><blockquote><p>é¢„å¤„ç†çš„ç›®çš„æ˜¯æ–‡å­—æ›¿æ¢ï¼Œå¸¸ç”¨çš„é¢„å¤„ç†æŒ‡ä»¤ï¼š#includeã€#defineã€#if</p></blockquote><ul><li><p>é¢„å¤„ç†é˜¶æ®µç¼–ç¨‹çš„æ“ä½œç›®æ ‡æ˜¯â€œæºç â€ï¼Œç”¨å„ç§æŒ‡ä»¤æ§åˆ¶é¢„å¤„ç†å™¨ï¼ŒæŠŠæºç æ”¹é€ æˆå¦ä¸€ç§å½¢å¼ï¼Œå°±åƒæ˜¯ææ©¡çš®æ³¥ä¸€æ ·ã€‚</p></li><li><p>è¾“å‡ºé¢„å¤„ç†åçš„æºç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ test03.cpp -E -o a.cxx</span><br></pre></td></tr></table></figure></li><li><p>åŒ…å«æ–‡ä»¶ï¼ˆ**#include**ï¼‰</p><p>å®ƒçš„ä½œç”¨æ˜¯â€œåŒ…å«æ–‡ä»¶â€ã€‚æ³¨æ„ï¼Œä¸æ˜¯â€œåŒ…å«å¤´æ–‡ä»¶â€ï¼Œè€Œæ˜¯å¯ä»¥åŒ…å«ä»»æ„çš„æ–‡ä»¶ã€‚ä½¿ç”¨â€œ#includeâ€å¯ä»¥æŠŠæºç ã€æ™®é€šæ–‡æœ¬ï¼Œç”šè‡³æ˜¯å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘éƒ½å¼•è¿›æ¥</p></li><li><p>å®å®šä¹‰ï¼ˆ**#define/#undef**ï¼‰</p><p>å®æ˜¯æ²¡æœ‰ä½œç”¨åŸŸæ¦‚å¿µçš„ï¼Œæ°¸è¿œæ˜¯å…¨å±€ç”Ÿæ•ˆã€‚æ‰€ä»¥ï¼Œå¯¹äºä¸€äº›ç”¨æ¥ç®€åŒ–ä»£ç ã€èµ·ä¸´æ—¶ä½œç”¨çš„å®ï¼Œæœ€å¥½æ˜¯ç”¨å®Œåå°½å¿«ç”¨â€œ#undefâ€å–æ¶ˆå®šä¹‰ï¼Œé¿å…å†²çªçš„é£é™©ã€‚</p><ul><li><p>é¢„å®šä¹‰çš„å®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__cplusplus</span><br><span class="line">æºæ–‡ä»¶ä¿¡æ¯å®ï¼Œæ¯”å¦‚ FILE, LINE, DATE</span><br><span class="line">ä¸€äº›è¯­è¨€ç‰¹æ€§æµ‹è¯•å®ï¼Œæ¯”å¦‚â€œ__cpp_decltypeâ€, â€œ__cpp_decltype_autoâ€, â€œ__cpp_lib_make_uniqueâ€</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ¡ä»¶ç¼–è¯‘ï¼ˆ**#if/#else/#endif**ï¼‰</p></li></ul><h2 id="Compiling"><a href="#Compiling" class="headerlink" title="Compiling"></a>Compiling</h2><blockquote><p>åŒ…æ‹¬ â€œç¼–è¯‘â€å’Œâ€œé“¾æ¥ï¼ˆLinkingï¼‰ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼ŒC++ ç¨‹åºä¹Ÿå°±æ˜¯ç»è¿‡é¢„å¤„ç†çš„æºç ï¼Œè¦ç»è¿‡ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨çš„â€œé”¤ç‚¼â€ï¼Œç”Ÿæˆå¯ä»¥åœ¨è®¡ç®—æœºä¸Šè¿è¡Œçš„äºŒè¿›åˆ¶æœºå™¨ç ã€‚è¿™é‡Œé¢çš„è®²ç©¶æ˜¯æœ€å¤šçš„ï¼Œä¹Ÿæ˜¯æœ€å¤æ‚çš„ï¼ŒC++ ç¼–è¯‘å™¨è¦åˆ†è¯ã€è¯­æ³•è§£æã€ç”Ÿæˆç›®æ ‡ç ï¼Œå¹¶å°½å¯èƒ½åœ°å»ä¼˜åŒ–ã€‚</p></blockquote><p><strong>é™æ€æ£€æŸ¥</strong>ï¼šåœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨è¿˜ä¼šæ ¹æ® C++ è¯­è¨€è§„åˆ™æ£€æŸ¥ç¨‹åºçš„è¯­æ³•ã€è¯­ä¹‰æ˜¯å¦æ­£ç¡®ï¼Œå‘ç°é”™è¯¯å°±ä¼šäº§ç”Ÿâ€œç¼–è¯‘å¤±è´¥â€ã€‚</p><h3 id="compiler"><a href="#compiler" class="headerlink" title="compiler"></a>compiler</h3><ul><li><p><strong>Build</strong> compiles all <em>modified</em> code files in the project or workspace/solution, and then links the object files into an executable. If no code files have been modified since the last build, this option does nothing.</p><ul><li>compile</li></ul><img src="/images/c++/CompileSource.png" style="zoom:100%;"/><ul><li>linking</li></ul><img src="/images/c++/LinkingObjects.webp"><p><strong>g++ï¼ˆGNU Compiler Collection for C++ï¼‰</strong></p><p><code>g++</code> æ˜¯ GNU ç¼–è¯‘å™¨é›†åˆï¼ˆGNU Compiler Collection, GCCï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºç¼–è¯‘ C++ ç¨‹åºã€‚GCC æ˜¯ç”± GNU é¡¹ç›®å¼€å‘çš„å¼€æºç¼–è¯‘å™¨ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Cã€C++ã€Objective-Cã€Fortranã€Ada å’Œ Go ç­‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> use</span></span><br><span class="line">g++ -o my_program my_program.cpp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> specify compiler standard</span></span><br><span class="line">g++ --std=gnu++17 &#123;filename&#125;.cpp</span><br></pre></td></tr></table></figure><p><strong>clang++ï¼ˆClang C++ Frontendï¼‰</strong></p><p><code>clang++</code> æ˜¯ Clang é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼ŒClang æ˜¯ä¸€ä¸ªç”±è‹¹æœå…¬å¸ä¸»å¯¼å¼€å‘çš„ç¼–è¯‘å™¨å‰ç«¯ï¼Œç”¨äºæ›¿ä»£ GCCã€‚å®ƒä¸ä»…æ”¯æŒ C++ï¼Œè¿˜æ”¯æŒ Cã€Objective-C å’Œå…¶ä»–è¯­è¨€ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> use</span></span><br><span class="line">clang++ -o my_program my_program.cpp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> specify compiler standard</span></span><br><span class="line">clang++ --std=c++17 &#123;filename&#125;.cpp</span><br></pre></td></tr></table></figure></li><li><p><strong>Clean</strong> removes all cached objects and executables so the next time the project is built, all files will be recompiled and a new executable produced.</p></li><li><p><strong>Rebuild</strong> does a â€œcleanâ€, followed by a â€œbuildâ€.</p></li><li><p><strong>Compile</strong> recompiles a single code file (regardless of whether it has been cached previously). This option does not invoke the linker or produce an executable.</p></li><li><p><strong>Run/start</strong> executes the executable from a prior build. Some IDEs (e.g. Visual Studio) will invoke a â€œbuildâ€ before doing a â€œrunâ€ to ensure you are running the latest version of your code. Otherwise (e.g. Code::Blocks) will just execute the prior executable.</p></li></ul><h1 id="Paradigm"><a href="#Paradigm" class="headerlink" title="Paradigm"></a>Paradigm</h1><blockquote><p>æ”¯æŒâ€œé¢å‘è¿‡ç¨‹â€ã€â€œé¢å‘å¯¹è±¡â€ã€â€œæ³›å‹â€ã€â€œæ¨¡æ¿å…ƒâ€ã€â€œå‡½æ•°å¼â€ è¿™äº”ç§ä¸»è¦çš„ç¼–ç¨‹èŒƒå¼ã€‚</p></blockquote><img src="/images/c++/paradigm.jpeg" style="zoom:60%;"/><ul><li><p>code style </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  MAX_PATH_LEN  256  <span class="comment">// å¸¸é‡ï¼Œå…¨å¤§å†™</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> g_sys_flag;  <span class="comment">// å…¨å±€å˜é‡ï¼ŒåŠ  g_ å‰ç¼€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> linux_sys &#123;  <span class="comment">// åå­—ç©ºé—´ï¼Œå…¨å°å†™</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">get_rlimit_core</span><span class="params">()</span></span>;  <span class="comment">// å‡½æ•°ï¼Œå…¨å°å†™</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilePath</span> <span class="keyword">final</span>  // ç±»åï¼Œé¦–å­—æ¯å¤§å†™</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">set_path</span><span class="params">(<span class="keyword">const</span> string&amp; str)</span></span>;  <span class="comment">// å‡½æ•°ï¼Œå…¨å°å†™</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  string m_path;   <span class="comment">// æˆå‘˜å˜é‡ï¼Œm_ å‰ç¼€</span></span><br><span class="line">  <span class="keyword">int</span>    m_level;  <span class="comment">// æˆå‘˜å˜é‡ï¼Œm_ å‰ç¼€</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h1 id="grammer"><a href="#grammer" class="headerlink" title="grammer"></a>grammer</h1><h2 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h2><h3 id="preprocessor-macros"><a href="#preprocessor-macros" class="headerlink" title="preprocessor macros"></a>preprocessor macros</h3><ul><li><p>Use <code>#define</code> macros for</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Header guards (#ifndef MY_HEADER_H)</span><br><span class="line">Platform-specific code (#ifdef _WIN32)</span><br><span class="line">Code that must be substituted inline for performance (#define SQUARE(x))</span><br><span class="line">Simple constants that donâ€™t need a type (#define MAX_SIZE 1024</span><br></pre></td></tr></table></figure></li><li><p>Avoid <code>#define</code> for:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Complex expressions (use constexpr instead)</span><br><span class="line">Type-sensitive operations (use inline functions)</span><br><span class="line">Global constants (use const or constexpr)</span><br></pre></td></tr></table></figure></li></ul><h3 id="operator"><a href="#operator" class="headerlink" title="operator"></a>operator</h3><ul><li>The <code>:: </code>symbol is an operator called the <strong>scope resolution operator</strong>.</li></ul><h3 id="iostream"><a href="#iostream" class="headerlink" title="iostream"></a>iostream</h3><ul><li><p>std::endl</p><p>output a newline; Using <code>std::endl</code> is often inefficient than <code>&#39;\n&#39;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::cin and std::cout always go on the left-hand side of the operator.</span><br><span class="line">std::cout is used to output a value (cout = character output).</span><br><span class="line">std::cin is used to get an input value (cin = character input).</span><br><span class="line">&lt;&lt; is used with std::cout, and shows the direction that data is moving. std::cout &lt;&lt; 4 moves the value 4 to the console.</span><br><span class="line">&gt;&gt; is used with std::cin, and shows the direction that data is moving. std::cin &gt;&gt; x moves the value the user entered from the keyboard into variable x.</span><br></pre></td></tr></table></figure><ul><li>Avoid implementation-defined and unspecified behavior whenever possible, as they may cause your program to malfunction on other implementations.</li></ul><p>addition (<code>+</code>), subtraction (<code>-</code>), multiplication (<code>*</code>), division (<code>/</code>).  assignment (<code>=</code>)</p><h2 id="function"><a href="#function" class="headerlink" title="function"></a>function</h2><ul><li><p>When a function parameter exists but is not used in the body of the function, do not give it a name. You can optionally put a name inside a comment.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(<span class="keyword">int</span>)</span> <span class="comment">// ok: unnamed parameter will not generate warning</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(<span class="keyword">int</span> <span class="comment">/*count*/</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Names used for function parameters or variables declared in a function body are only visible within the function that declares them. This means local variables within a function can be named without regard for the names of variables in other functions. This helps keep functions independent.</p></li><li><p>Define your local variables as close to their first use as reasonable.</p></li><li><p><strong>declaration</strong>, tells the <em>compiler</em> about the <em>existence</em> of an identifier and its associated type information.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>; <span class="comment">// tells the compiler about a function named &quot;add&quot; that takes two int parameters and returns an int.  No body!</span></span><br><span class="line"><span class="keyword">int</span> x;                 <span class="comment">// tells the compiler about an integer variable named x</span></span><br></pre></td></tr></table></figure></li><li><p><strong>definition</strong> is a declaration that actually implements (for functions and types) or instantiates (for variables) the identifier.<br>In C++, all definitions are declarations. Therefore <code>int x;</code> is both a definition and a declaration.</p></li><li><p>the compiler compiles each file individually. </p></li><li><p>Use double quotes to include header files that youâ€™ve written or are expected to be found in the current directory. Use angled brackets to include headers that come with your compiler, OS, or third-party libraries youâ€™ve installed elsewhere on your system.</p></li><li><p>header guard</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ADD_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADD_H</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></li></ul><ul><li>If a parameter is given a default argument, all subsequent parameters (to the right) must also be given default arguments.</li></ul><h2 id="Data-Types"><a href="#Data-Types" class="headerlink" title="Data Types"></a>Data Types</h2><ul><li>The smallest unit of memory is a <strong>binary digit</strong> (also called a <strong>bit</strong>), which can hold a value of 0 or 1.</li><li>Each memory address holds 1 byte of data. A <strong>byte</strong> is a group of bits that are operated on as a unit. The modern standard is that a byte is comprised of 8 sequential bits.</li></ul><table><thead><tr><th align="left">Types</th><th align="left">Category</th><th align="left">Meaning</th><th align="left">Example</th></tr></thead><tbody><tr><td align="left">float double long double</td><td align="left">Floating Point</td><td align="left">a number with a fractional part</td><td align="left">3.14159</td></tr><tr><td align="left">bool</td><td align="left">Integral (Boolean)</td><td align="left">true or false</td><td align="left">true</td></tr><tr><td align="left">char <br />wchar_t <br />char8_t (C++20) <br />char16_t (C++11) <br />char32_t (C++11)</td><td align="left">Integral (Character)</td><td align="left">a single character of text</td><td align="left">â€˜câ€™</td></tr><tr><td align="left">short int int long int long long int (C++11)</td><td align="left">Integral (Integer)</td><td align="left">positive and negative whole numbers, including 0</td><td align="left">64</td></tr><tr><td align="left">std::nullptr_t (C++11)</td><td align="left">Null Pointer</td><td align="left">a null pointer</td><td align="left">nullptr</td></tr><tr><td align="left">void</td><td align="left">Void</td><td align="left">no type</td><td align="left">n/a</td></tr></tbody></table><table><thead><tr><th align="left">Category</th><th align="left">Type</th><th align="left">Minimum Size</th><th align="left">Typical Size</th><th align="left">Note</th></tr></thead><tbody><tr><td align="left">Boolean</td><td align="left">bool</td><td align="left">1 byte</td><td align="left">1 byte</td><td align="left"></td></tr><tr><td align="left">character</td><td align="left">char</td><td align="left">1 byte</td><td align="left">1 byte</td><td align="left">always exactly 1 byte</td></tr><tr><td align="left"></td><td align="left">wchar_t</td><td align="left">1 byte</td><td align="left">2 or 4 bytes</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">char8_t</td><td align="left">1 byte</td><td align="left">1 byte</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">char16_t</td><td align="left">2 bytes</td><td align="left">2 bytes</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">char32_t</td><td align="left">4 bytes</td><td align="left">4 bytes</td><td align="left"></td></tr><tr><td align="left">integer</td><td align="left">short</td><td align="left">2 bytes</td><td align="left">2 bytes</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">int</td><td align="left">2 bytes</td><td align="left">4 bytes</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">long</td><td align="left">4 bytes</td><td align="left">4 or 8 bytes</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">long long</td><td align="left">8 bytes</td><td align="left">8 bytes</td><td align="left"></td></tr><tr><td align="left">floating point</td><td align="left">float</td><td align="left">4 bytes</td><td align="left">4 bytes</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">double</td><td align="left">8 bytes</td><td align="left">8 bytes</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">long double</td><td align="left">8 bytes</td><td align="left">8, 12, or 16 bytes</td><td align="left"></td></tr><tr><td align="left">pointer</td><td align="left">std::nullptr_t</td><td align="left">4 bytes</td><td align="left">4 or 8 bytes</td><td align="left"></td></tr></tbody></table><h3 id="integer"><a href="#integer" class="headerlink" title="integer"></a>integer</h3><table><thead><tr><th align="left">Size / Type</th><th align="left">Range</th></tr></thead><tbody><tr><td align="left">8-bit signed</td><td align="left">-128 to 127</td></tr><tr><td align="left">16-bit signed</td><td align="left">-32,768 to 32,767</td></tr><tr><td align="left">32-bit signed</td><td align="left">-2,147,483,648 to 2,147,483,647</td></tr><tr><td align="left">64-bit signed</td><td align="left">-9,223,372,036,854,775,808 to 9,223,372,036,854,775,807</td></tr></tbody></table><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Range</th><th align="left">Notes</th></tr></thead><tbody><tr><td align="left">std::int8_t</td><td align="left">1 byte signed</td><td align="left">-128 to 127</td><td align="left">**Treated like a signed char on many systems. **</td></tr><tr><td align="left">std::uint8_t</td><td align="left">1 byte unsigned</td><td align="left">0 to 255</td><td align="left">**Treated like an unsigned char on many systems. **</td></tr><tr><td align="left">std::int16_t</td><td align="left">2 byte signed</td><td align="left">-32,768 to 32,767</td><td align="left"></td></tr><tr><td align="left">std::uint16_t</td><td align="left">2 byte unsigned</td><td align="left">0 to 65,535</td><td align="left"></td></tr><tr><td align="left">std::int32_t</td><td align="left">4 byte signed</td><td align="left">-2,147,483,648 to 2,147,483,647</td><td align="left"></td></tr><tr><td align="left">std::uint32_t</td><td align="left">4 byte unsigned</td><td align="left">0 to 4,294,967,295</td><td align="left"></td></tr><tr><td align="left">std::int64_t</td><td align="left">8 byte signed</td><td align="left">-9,223,372,036,854,775,808 to 9,223,372,036,854,775,807</td><td align="left"></td></tr><tr><td align="left">std::uint64_t</td><td align="left">8 byte unsigned</td><td align="left"></td><td align="left"></td></tr></tbody></table><h3 id="floating-point"><a href="#floating-point" class="headerlink" title="floating point"></a>floating point</h3><table><thead><tr><th align="left">Size</th><th align="left">Range</th><th align="left">Precision</th></tr></thead><tbody><tr><td align="left">4 bytes</td><td align="left">Â±1.18 x 10-38 to Â±3.4 x 1038 and 0.0</td><td align="left">6-9 significant digits, typically 7</td></tr><tr><td align="left">8 bytes</td><td align="left">Â±2.23 x 10-308 to Â±1.80 x 10308 and 0.0</td><td align="left">15-18 significant digits, typically 16</td></tr><tr><td align="left">80-bits (typically uses 12 or 16 bytes)</td><td align="left">Â±3.36 x 10-4932 to Â±1.18 x 104932 and 0.0</td><td align="left">18-21 significant digits</td></tr><tr><td align="left">16 bytes</td><td align="left">Â±3.36 x 10-4932 to Â±1.18 x 104932 and 0.0</td><td align="left">33-36 significant digits</td></tr></tbody></table><ul><li><p>When outputting floating point numbers, <code>std::cout</code> has a default precision of 6 â€“ that is, it assumes all floating point variables are only significant to 6 digits (the minimum precision of a float), and hence it will truncate anything after that.</p></li><li><p><strong>Inf</strong>, which represents infinity. Inf can be positive or negative.  <strong>NaN</strong>, which stands for â€œNot a Numberâ€.</p></li><li><p>By default, floating point values whose decimal part is 0 print without the decimal places (e.g. <code>5.0</code> prints as <code>5</code>).</p></li></ul><h2 id="const-and-string"><a href="#const-and-string" class="headerlink" title="const and string"></a>const and string</h2><blockquote><p>const å®šä¹‰çš„å¸¸é‡åœ¨é¢„å¤„ç†é˜¶æ®µå¹¶ä¸å­˜åœ¨ï¼Œè€Œæ˜¯ç›´åˆ°è¿è¡Œé˜¶æ®µæ‰ä¼šå‡ºç°ã€‚</p></blockquote><p><strong>const vs constexpr</strong></p><ul><li><p><strong>Purpose:</strong> <code>const</code> is used to specify that a variable or function parameter cannot be modified, while <code>constexpr</code> is used to specify that an expression can be evaluated at compile-time.</p></li><li><p><strong>Scope:</strong> A <code>const</code> variable can have a scope that includes the current block, while a <code>constexpr</code> expression must be within the scope of a function or class definition.</p></li><li><p><strong>Evaluation time:</strong> A <code>const</code> variable is evaluated at runtime, while a <code>constexpr</code> expression is evaluated at compile-time.</p></li></ul><p><strong>Numeral systems</strong></p><ul><li><p>There are 4 main numeral systems available in C++. In order of popularity, these are: decimal (base 10), binary (base 2), hexadecimal (base 16), and octal (base 8).</p><p>To use an octal literal, prefix your literal with a <code>0 (zero)</code>, e.g. <code>int x&#123; 012 &#125;</code></p><p>To use a hexadecimal literal, prefix your literal with <code>0x</code>, e.g.  <code>int x&#123; 0xF &#125;</code></p><p>By default, C++ outputs values in decimal. However, you can change the output format via use of the <code>std::dec</code>, <code>std::oct</code>, and <code>std::hex</code> I/O manipulators:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x &#123; <span class="number">12</span> &#125;;</span><br><span class="line">std::cout &lt;&lt; x &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// decimal (by default)</span></span><br><span class="line">std::cout &lt;&lt; std::hex &lt;&lt; x &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// hexadecimal</span></span><br><span class="line">std::cout &lt;&lt; x &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// now hexadecimal</span></span><br><span class="line">std::cout &lt;&lt; std::oct &lt;&lt; x &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// octal</span></span><br><span class="line">std::cout &lt;&lt; std::dec &lt;&lt; x &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// return to decimal</span></span><br><span class="line">std::cout &lt;&lt; x &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// decimal</span></span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th></th><th>const</th><th>éconst</th></tr></thead><tbody><tr><td>å¯¹è±¡ï¼ˆå®ä¾‹ï¼‰</td><td>(const T) å¯¹è±¡åªè¯»ï¼Œåªèƒ½è°ƒç”¨constæˆå‘˜å‡½æ•°</td><td>å¯ä»¥ä¿®æ”¹å¯¹è±¡ï¼Œè°ƒç”¨ä»»æ„æˆå‘˜å‡½æ•°</td></tr><tr><td>å¼•ç”¨</td><td>(const T&amp;) å¼•ç”¨çš„å¯¹è±¡åªè¯»ï¼Œåªèƒ½è°ƒç”¨constæˆå‘˜å‡½æ•°</td><td>åŒä¸Š</td></tr><tr><td>æŒ‡é’ˆ</td><td>(const T*) æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡åªè¯»ï¼Œåªèƒ½è°ƒç”¨constæˆå‘˜å‡½æ•°</td><td>åŒä¸Š</td></tr><tr><td>æˆå‘˜å‡½æ•°</td><td>(func) const) ä¸å…è®¸ä¿®æ”¹æˆå‘˜å˜é‡</td><td>å¯ä»¥ä¿®æ”¹æˆå‘˜å˜é‡</td></tr></tbody></table><h2 id="scope-duration-linkage"><a href="#scope-duration-linkage" class="headerlink" title="scope duration linkage"></a>scope duration linkage</h2><table><thead><tr><th align="left">Type</th><th align="left">Example</th><th align="left">Scope</th><th align="left">Duration</th><th align="left">Linkage</th><th align="left">Notes</th></tr></thead><tbody><tr><td align="left">Local variable</td><td align="left">int x;</td><td align="left">Block</td><td align="left">Automatic</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">Static local variable</td><td align="left">static int s_x;</td><td align="left">Block</td><td align="left">Static</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">Dynamic local variable</td><td align="left">int* x { new int{} };</td><td align="left">Block</td><td align="left">Dynamic</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">Function parameter</td><td align="left">void foo(int x)</td><td align="left">Block</td><td align="left">Automatic</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">Internal non-const global variable</td><td align="left">static int g_x;</td><td align="left">Global</td><td align="left">Static</td><td align="left">Internal</td><td align="left">Initialized or uninitialized</td></tr><tr><td align="left">External non-const global variable</td><td align="left">int g_x;</td><td align="left">Global</td><td align="left">Static</td><td align="left">External</td><td align="left">Initialized or uninitialized</td></tr><tr><td align="left">Inline non-const global variable (C++17)</td><td align="left">inline int g_x;</td><td align="left">Global</td><td align="left">Static</td><td align="left">External</td><td align="left">Initialized or uninitialized</td></tr><tr><td align="left">Internal constant global variable</td><td align="left">constexpr int g_x { 1 };</td><td align="left">Global</td><td align="left">Static</td><td align="left">Internal</td><td align="left">Must be initialized</td></tr><tr><td align="left">External constant global variable</td><td align="left">extern const int g_x { 1 };</td><td align="left">Global</td><td align="left">Static</td><td align="left">External</td><td align="left">Must be initialized</td></tr><tr><td align="left">Inline constant global variable (C++17)</td><td align="left">inline constexpr int g_x { 1 };</td><td align="left">Global</td><td align="left">Static</td><td align="left">External</td><td align="left">Must be initialized</td></tr></tbody></table><ul><li><p>Variables declared inside a namespace are also global variables.</p><p>Prefer defining global variables inside a namespace rather than in the global namespace.</p></li><li><p>Scope determines where a variable is accessible. Duration determines when a variable is created and destroyed. </p></li><li><p>Linkage determines whether the variable can be exported to another file or not.</p></li><li><p>Global variables can have either internal or external linkage, via the static and extern keywords respectively.</p></li><li><p>Initialize your static local variables. Static local variables are only initialized the first time the code is executed, not on subsequent calls.</p></li></ul><h2 id="control-flow"><a href="#control-flow" class="headerlink" title="control flow"></a>control flow</h2><table><thead><tr><th align="left">Category</th><th align="left">Meaning</th><th align="left">Implemented in C++ by</th></tr></thead><tbody><tr><td align="left">Conditional statements</td><td align="left">Causes a sequence of code to execute only if some condition is met.</td><td align="left">if, else, switch</td></tr><tr><td align="left">Jumps</td><td align="left">Tells the CPU to start executing the statements at some other location.</td><td align="left">goto, break, continue</td></tr><tr><td align="left">Function calls</td><td align="left">Jump to some other location and back.</td><td align="left">function calls, return</td></tr><tr><td align="left">Loops</td><td align="left">Repeatedly execute some sequence of code zero or more times, until some condition is met.</td><td align="left">while, do-while, for, ranged-for</td></tr><tr><td align="left">Halts</td><td align="left">Terminate the program.</td><td align="left">std::exit(), std::abort()</td></tr><tr><td align="left">Exceptions</td><td align="left">A special kind of flow control structure designed for error handling.</td><td align="left">try, throw, catch</td></tr></tbody></table><h2 id="References-and-Pointers"><a href="#References-and-Pointers" class="headerlink" title="References and Pointers"></a>References and Pointers</h2><p><strong>Lvalue</strong></p><blockquote><p><strong>å·¦å€¼</strong> (lvalue, left value)ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯èµ‹å€¼ç¬¦å·å·¦è¾¹çš„å€¼ã€‚å‡†ç¡®æ¥è¯´ï¼Œ å·¦å€¼æ˜¯è¡¨è¾¾å¼ï¼ˆä¸ä¸€å®šæ˜¯èµ‹å€¼è¡¨è¾¾å¼ï¼‰åä¾ç„¶å­˜åœ¨çš„æŒä¹…å¯¹è±¡ã€‚</p></blockquote><ul><li>Lvalue expressions evaluate to an identifiable object.<ul><li>An lvalue reference  acts as an alias for an existing lvalue (such as a variable).</li><li>Lvalue references can only bind to modifiable lvalues.</li><li>Lvalue references to const can bind to modifiable lvalues, non-modifiable lvalues, and rvalues. This makes them a much more flexible type of reference.</li></ul></li></ul><p><strong>Rvalue</strong></p><blockquote><p><strong>å³å€¼</strong> (rvalue, right value)ï¼Œå³è¾¹çš„å€¼ï¼Œæ˜¯æŒ‡è¡¨è¾¾å¼ç»“æŸåå°±ä¸å†å­˜åœ¨çš„ä¸´æ—¶å¯¹è±¡ã€‚</p></blockquote><ul><li>Rvalue expressions evaluate to a value.</li></ul><p><strong>Reference</strong></p><ul><li>Pass by reference allows us to pass arguments to a function without making copies of those arguments each time the function is called.</li><li>Pass by reference can only accept modifiable lvalue arguments</li><li>Class types can be expensive to copy (sometimes significantly so), so they are typically passed by const reference. Fundamental types and enumerated types are cheap to copy, so they are typically passed by value.</li><li>When an object being referenced is destroyed before a reference to it, the reference is left referencing an object that no longer exists. Such a reference is called a <em>dangling reference</em></li></ul><p><strong>çº¯å³å€¼</strong> (prvalue, pure rvalue)ï¼Œçº¯ç²¹çš„å³å€¼ï¼Œè¦ä¹ˆæ˜¯çº¯ç²¹çš„å­—é¢é‡ï¼Œä¾‹å¦‚ <code>10</code>, <code>true</code>ï¼› è¦ä¹ˆæ˜¯æ±‚å€¼ç»“æœç›¸å½“äºå­—é¢é‡æˆ–åŒ¿åä¸´æ—¶å¯¹è±¡ï¼Œä¾‹å¦‚ <code>1+2</code>ã€‚éå¼•ç”¨è¿”å›çš„ä¸´æ—¶å˜é‡ã€è¿ç®—è¡¨è¾¾å¼äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€ åŸå§‹å­—é¢é‡ã€Lambda è¡¨è¾¾å¼éƒ½å±äºçº¯å³å€¼ã€‚</p><p><strong>å°†äº¡å€¼</strong> (xvalue, expiring value)ï¼Œæ˜¯ C++11 ä¸ºäº†å¼•å…¥å³å€¼å¼•ç”¨è€Œæå‡ºçš„æ¦‚å¿µï¼ˆå› æ­¤åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œ çº¯å³å€¼å’Œå³å€¼æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼‰ï¼Œä¹Ÿå°±æ˜¯å³å°†è¢«é”€æ¯ã€å´èƒ½å¤Ÿè¢«ç§»åŠ¨çš„å€¼ã€‚</p><p><strong>Pointer</strong></p><ul><li>A pointer is an object that holds a <em>memory address</em> (typically of another variable) as its value. This allows us to store the address of some other object to use later.</li><li>Use <code>nullptr</code> when you need a null pointer literal for initialization, assignment, or passing a null pointer to a function.</li><li>When we pass an address to a function, that address is copied from the argument into the pointer parameter (which is fine, because copying an address is fast). </li><li>pointers must hold the address of an object ( canâ€™t have a pointer to a reference, since references arenâ€™t objects )</li><li>Objects returned by reference must live beyond the scope of the function returning the reference, or a dangling reference will result. Never return a (non-static) local variable or temporary by reference.</li></ul><p><strong>summary</strong></p><ul><li>Prefer pass by reference to pass by address unless you have a specific reason to use pass by address.</li></ul><h2 id="Compound-Types"><a href="#Compound-Types" class="headerlink" title="Compound Types"></a>Compound Types</h2><blockquote><p>Enums and Structs</p></blockquote><table><thead><tr><th align="left">Type</th><th align="left">Meaning</th><th align="left">Examples</th></tr></thead><tbody><tr><td align="left">Fundamental</td><td align="left">A type built into the core C++ language</td><td align="left">int, std::nullptr_t</td></tr><tr><td align="left">Compound</td><td align="left">A type built from fundamental types</td><td align="left">int&amp;, double*, std::string, Fraction</td></tr><tr><td align="left">User-defined</td><td align="left">A class type or enumerated type (Includes those defined in the standard library or implementation) (In casual use, typically used to mean program-defined types)</td><td align="left">std::string, Fraction</td></tr><tr><td align="left">Program-defined</td><td align="left">A class type or enumerated type (Excludes those defined in standard library or implementation)</td><td align="left">Fraction</td></tr></tbody></table><ul><li>A <strong>class template</strong> is a template definition for instantiating class types (structs, classes, or unions). <strong>Class template argument deduction (CTAD)</strong> is a C++17 feature that allows the compiler to deduce the template type arguments from an initializer.</li><li>The members of a struct are public by default</li></ul><h2 id="classes"><a href="#classes" class="headerlink" title="classes"></a>classes</h2><table><thead><tr><th align="left">Access level</th><th align="left">Access specifier</th><th align="left">Member access</th><th align="left">Derived class access</th><th align="left">Public access</th></tr></thead><tbody><tr><td align="left">Public</td><td align="left">public:</td><td align="left">yes</td><td align="left">yes</td><td align="left">yes</td></tr><tr><td align="left">Protected</td><td align="left">protected:</td><td align="left">yes</td><td align="left">yes</td><td align="left">no</td></tr><tr><td align="left">Private</td><td align="left">private:</td><td align="left">yes</td><td align="left">no</td><td align="left">no</td></tr></tbody></table><ul><li><p>The members of a class are private by default. Private members can be accessed by other members of the class, but can not be accessed by the public.</p><p>A class with private members is no longer an aggregate, and therefore can no longer use aggregate initialization.</p></li><li><p>Classes should generally make member variables private (or protected), and member functions public.</p><p>Structs should generally avoid using access specifiers (all members will default to public).</p></li><li><p>Prefer using the member initializer list to initialize your members over assigning values in the body of the constructor.</p></li><li><p>If you want your class to be able to be evaluated at compile-time, make your member functions and constructor constexpr.</p></li><li><p>A non-const member function can modify members of non-const objects.</p></li><li><p>A constexpr member function can be called in either runtime contexts or compile-time contexts.</p></li><li><p>All non-static member functions have a <code>this</code> const pointer that holds the address of the implicit object.</p></li></ul><h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h2><ul><li>Avoid array indexing with integral values whenever possible.</li><li>For range-based for loops, prefer to define the element type as:<ul><li><code>auto</code> when you want to modify copies of the elements.</li><li><code>auto&amp;</code> when you want to modify the original elements.</li><li><code>const auto&amp;</code> otherwise (when you just need to view the original elements).</li></ul></li><li>The length of a vector is how many elements are â€œin useâ€.<br>The capacity of a vector is how many elements have been allocated in memory.</li><li>Tracking capacity separately from length allows the <code>std::vector</code> to avoid some reallocations when length is changed.</li><li>To increase the number of elements in a <code>std::vector</code>:<br>Use <code>resize()</code> when accessing a vector via indexing. This changes the length of the vector so your indices will be valid.<br>Use <code>reserve()</code> when accessing a vector using stack operations. This adds capacity without changing the length of the vector.</li></ul><h2 id="array"><a href="#array" class="headerlink" title="array"></a>array</h2><ul><li>Define  <code>std::array</code> as constexpr whenever possible. If your <code>std::array</code> is not constexpr, consider using a <code>std::vector</code> instead.</li><li>Use class template argument deduction (CTAD) to have the compiler deduce the type and length of a <code>std::array</code> from its initializers.</li></ul><h2 id="lambda"><a href="#lambda" class="headerlink" title="lambda"></a>lambda</h2><blockquote><p>Lambdas are anonymous functions, A <strong>lambda expression</strong> (also called a <strong>lambda</strong> or <strong>closure</strong>) allows us to define an anonymous function inside another function. The nesting is important, as it allows us both to avoid namespace naming pollution, and to define the function as close to where it is used as possible (providing additional context).</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ captureClause ] ( parameters ) -&gt; returnType</span><br><span class="line">&#123;</span><br><span class="line">    statements;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[æ•è·åˆ—è¡¨](å‚æ•°åˆ—è¡¨) mutable(å¯é€‰) å¼‚å¸¸å±æ€§ -&gt; è¿”å›ç±»å‹ &#123;</span><br><span class="line">// å‡½æ•°ä½“</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In actuality, lambdas arenâ€™t functions (which is part of how they avoid the limitation of C++ not supporting nested functions). Theyâ€™re a special kind of object called a functor. Functors are objects that contain an overloaded <code>operator()</code> that make them callable like a function.</p><blockquote><p>æ‰€è°“æ•è·åˆ—è¡¨ï¼Œå…¶å®å¯ä»¥ç†è§£ä¸ºå‚æ•°çš„ä¸€ç§ç±»å‹ï¼ŒLambda è¡¨è¾¾å¼å†…éƒ¨å‡½æ•°ä½“åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨å‡½æ•°ä½“å¤–éƒ¨çš„å˜é‡çš„ï¼Œ è¿™æ—¶å€™æ•è·åˆ—è¡¨å¯ä»¥èµ·åˆ°ä¼ é€’å¤–éƒ¨æ•°æ®çš„ä½œç”¨</p></blockquote><h1 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h1><p>The memory that a program uses is typically divided into a few different areas, called segments:</p><ul><li>The code segment (also called a text segment), where the compiled program sits in memory. The code segment is typically read-only.</li><li>The bss segment (also called the uninitialized data segment), where zero-initialized global and static variables are stored.</li><li>The data segment (also called the initialized data segment), where initialized global and static variables are stored.</li><li>The heap, where dynamically allocated variables are allocated from.</li><li>The call stack, where function parameters, local variables, and other function-related information are stored.</li></ul><h2 id="memory-allocation"><a href="#memory-allocation" class="headerlink" title="memory allocation"></a>memory allocation</h2><ul><li><p><strong>Static memory allocation</strong> happens for static and global variables. Memory for these types of variables is allocated once when your program is run and persists throughout the life of your program.</p></li><li><p><strong>Automatic memory allocation</strong> happens for function parameters and local variables. Memory for these types of variables is allocated when the relevant block is entered, and freed when the block is exited, as many times as necessary.</p></li><li><p>accessing heap-allocated objects is generally slower than accessing stack-allocated objects. Because the compiler knows the address of stack-allocated objects, it can go directly to that address to get a value. Heap allocated objects are typically accessed via pointer. This requires two steps: one to get the address of the object (from the pointer), and another to get the value.</p></li></ul><h1 id="relationship"><a href="#relationship" class="headerlink" title="relationship"></a>relationship</h1><table><thead><tr><th align="left">Property\Type</th><th align="left">Composition</th><th align="left">Aggregation</th><th align="left">Association</th><th align="left">Dependency</th></tr></thead><tbody><tr><td align="left">Relationship type</td><td align="left">Whole/part</td><td align="left">Whole/part</td><td align="left">Otherwise unrelated</td><td align="left">Otherwise unrelated</td></tr><tr><td align="left">Members can belong to multiple classes</td><td align="left">No</td><td align="left">Yes</td><td align="left">Yes</td><td align="left">Yes</td></tr><tr><td align="left">Members existence managed by class</td><td align="left">Yes</td><td align="left">No</td><td align="left">No</td><td align="left">No</td></tr><tr><td align="left">Directionality</td><td align="left">Unidirectional</td><td align="left">Unidirectional</td><td align="left">Unidirectional or bidirectional</td><td align="left">Unidirectional</td></tr><tr><td align="left">Relationship verb</td><td align="left">Part-of</td><td align="left">Has-a</td><td align="left">Uses-a</td><td align="left">Depends-on</td></tr></tbody></table><h2 id="inheritance"><a href="#inheritance" class="headerlink" title="inheritance"></a>inheritance</h2><ul><li>that C++ always constructs the â€œfirstâ€ or â€œmost baseâ€ class first. It then walks through the inheritance tree in order and constructs each successive derived class.</li></ul><h1 id="Static-and-dynamic-libraries"><a href="#Static-and-dynamic-libraries" class="headerlink" title="Static and dynamic libraries"></a>Static and dynamic libraries</h1><h2 id="static-library"><a href="#static-library" class="headerlink" title="static library"></a>static library</h2><p>A <strong>static library</strong> (also known as an <strong>archive</strong>) consists of routines that are compiled and linked directly into your program. When you compile a program that uses a static library, all the functionality of the static library that your program uses becomes part of your executable. </p><ul><li>On Windows, static libraries typically have a <strong>.lib</strong> extension, whereas on Linux, static libraries typically have an <strong>.a (archive)</strong> extension. </li><li>One advantage of static libraries is that you only have to distribute the executable in order for users to run your program. Because the library becomes part of your program, this ensures that the right version of the library is always used with your program. Also, because static libraries become part of your program, you can use them just like functionality youâ€™ve written for your own program. </li><li>On the downside, because a copy of the library becomes part of every executable that uses it, this can cause a lot of wasted space. Static libraries also can not be upgraded easy â€“ to update the library, the entire executable needs to be replaced.</li></ul><h2 id="dynamic-library"><a href="#dynamic-library" class="headerlink" title="dynamic library"></a>dynamic library</h2><p>A <strong>dynamic library</strong> (also called a <strong>shared library</strong>) consists of routines that are loaded into your application at run time. When you compile a program that uses a dynamic library, the library does not become part of your executable â€“ it remains as a separate unit. </p><ul><li><p>On Windows, dynamic libraries typically have a <strong>.dll (dynamic link library)</strong> extension, whereas on Linux, dynamic libraries typically have a <strong>.so (shared object)</strong> extension, and macos with <strong>.dylib</strong> as dynamic library. One advantage of dynamic libraries is that many programs can share one copy, which saves space. Perhaps a bigger advantage is that the dynamic library can be upgraded to a newer version without replacing all of the executables that use it.</p></li><li><p>Because dynamic libraries are not linked into your program, programs using dynamic libraries must explicitly load and interface with the dynamic library. This mechanism can be confusing, and makes interfacing with a dynamic library awkward. To make dynamic libraries easier to use, an import library can be used.</p></li><li><p>An <strong>import library</strong> is a library that automates the process of loading and using a dynamic library. On Windows, this is typically done via a small static library (.lib) of the same name as the dynamic library (.dll). The static library is linked into the program at compile time, and then the functionality of the dynamic library can effectively be used as if it were a static library. On Linux, the shared object (.so) file works as both a dynamic library and an import library. Most linkers can build an import library for a dynamic library when the dynamic library is created.</p></li></ul><h2 id="create-and-use"><a href="#create-and-use" class="headerlink" title="create and use"></a>create and use</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> macos</span></span><br><span class="line">clang++ -arch arm64 -shared -fPIC -o lib&lt;name&gt;.dylib &lt;name&gt;.cpp</span><br><span class="line">clang++ -arch arm64 &lt;demo&gt;.cpp -o &lt;demo&gt; -L. -lmymath (-Iinclude)</span><br><span class="line"><span class="meta">#</span><span class="bash"> -Iinclude tells the compiler to look <span class="keyword">in</span> the <span class="string">&quot;include&quot;</span> folder <span class="keyword">for</span> header files.</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> -L. tells the linker to look <span class="keyword">in</span> the current directory <span class="keyword">for</span> library files.</span></span><br></pre></td></tr></table></figure><h3 id="check"><a href="#check" class="headerlink" title="check"></a>check</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> header file</span></span><br><span class="line">/usr/include/xxx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use the ldconfig <span class="built_in">command</span> to locate library</span></span><br><span class="line">ldconfig -p | grep xxx.so</span><br></pre></td></tr></table></figure><p><strong>reference</strong></p><ul><li><a href="https://www.devxperiences.com/pzwp1/2023/05/17/c-dynamic-loading-of-a-shared-library-also-create-and-load-one-on-your-own/">C++ Dynamic loading of a shared library</a></li></ul><h1 id="Data-structures-algorithms-and-design-patterns"><a href="#Data-structures-algorithms-and-design-patterns" class="headerlink" title="Data structures, algorithms, and design patterns"></a>Data structures, algorithms, and design patterns</h1><p>TBD</p><h1 id="tool"><a href="#tool" class="headerlink" title="tool"></a>tool</h1><h2 id="vscode"><a href="#vscode" class="headerlink" title="vscode"></a>vscode</h2><h3 id="config-file"><a href="#config-file" class="headerlink" title="config file"></a>config file</h3><ul><li><p>c_cpp_properties.json</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> config include path</span></span><br><span class="line">Open the Command Palette (Ctrl+Shift+P) and type C/C++: Edit Configurations (UI).</span><br><span class="line">This will open the c_cpp_properties.json file. If it doesn&#x27;t exist, it will be created.</span><br></pre></td></tr></table></figure></li><li><p>setting.json</p></li><li><p>tasks.json</p></li></ul><h2 id="error-detection-and-handing"><a href="#error-detection-and-handing" class="headerlink" title="error detection and handing"></a>error detection and handing</h2><ul><li>Favor <code>static_assert</code> over <code>assert()</code> whenever possible.</li></ul>]]></content>
      
      
      <categories>
          
          <category> c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes csi</title>
      <link href="/2024/09/05/kubernetes%20csi/"/>
      <url>/2024/09/05/kubernetes%20csi/</url>
      
        <content type="html"><![CDATA[<h1 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h1><p>In Kubernetes, the CSI (Container Storage Interface) plugin uses Unix domain sockets for communication between the kubelet and CSI drivers:</p><ul><li><p>Socket Location:  </p><ul><li><code>/var/lib/kubelet/plugins/csi.dingofs.com/csi-controller.sock</code></li><li><code>/var/lib/kubelet/plugins/csi.dingofs.com/csi.sock</code></li></ul></li><li><p>Role: </p><ul><li><p>The CSI driver exposes its RPC interface via the Unix domain socket.</p></li><li><p>Kubelet connects to this socket to invoke RPC methods like CreateVolume or NodePublishVolume.</p></li></ul></li></ul><p>This approach ensures efficient and secure communication between the kubelet and the storage driver, without exposing the RPC interface over a network.</p><h1 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h1><blockquote><p>Container Storage Interface <strong>å®¹å™¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å«ä¹‰</strong>ï¼Œå°±æ˜¯ç”¨æ¥ä¿å­˜å®¹å™¨å­˜å‚¨çŠ¶æ€çš„é‡è¦æ‰‹æ®µï¼šå­˜å‚¨æ’ä»¶ä¼šåœ¨å®¹å™¨é‡ŒæŒ‚è½½ä¸€ä¸ªåŸºäºç½‘ç»œæˆ–è€…å…¶ä»–æœºåˆ¶çš„è¿œç¨‹æ•°æ®å·ï¼Œä½¿å¾—åœ¨å®¹å™¨é‡Œåˆ›å»ºçš„æ–‡ä»¶ï¼Œå®é™…ä¸Šæ˜¯ä¿å­˜åœ¨è¿œç¨‹å­˜å‚¨æœåŠ¡å™¨ä¸Šï¼Œæˆ–è€…ä»¥åˆ†å¸ƒå¼çš„æ–¹å¼ä¿å­˜åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œè€Œä¸å½“å‰å®¿ä¸»æœºæ²¡æœ‰ä»»ä½•ç»‘å®šå…³ç³»ã€‚è¿™æ ·ï¼Œæ— è®ºä½ åœ¨å…¶ä»–å“ªä¸ªå®¿ä¸»æœºä¸Šå¯åŠ¨æ–°çš„å®¹å™¨ï¼Œéƒ½å¯ä»¥è¯·æ±‚æŒ‚è½½æŒ‡å®šçš„æŒä¹…åŒ–å­˜å‚¨å·ï¼Œä»è€Œè®¿é—®åˆ°æ•°æ®å·é‡Œä¿å­˜çš„å†…å®¹ã€‚</p><p><strong>CSI æ’ä»¶ä½“ç³»çš„è®¾è®¡æ€æƒ³ï¼Œå°±æ˜¯æŠŠ Provision é˜¶æ®µï¼Œä»¥åŠ Kubernetes é‡Œçš„ä¸€éƒ¨åˆ†å­˜å‚¨ç®¡ç†åŠŸèƒ½(æ¯”å¦‚â€œAttach é˜¶æ®µâ€å’Œâ€œMount é˜¶æ®µâ€çš„å…·ä½“æ“ä½œ)ï¼Œä»ä¸»å¹²ä»£ç é‡Œå‰¥ç¦»å‡ºæ¥ï¼Œåšæˆäº†å‡ ä¸ªå•ç‹¬çš„ç»„ä»¶</strong></p></blockquote><p>ä¸€ä¸ª CSI æ’ä»¶åªæœ‰ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½†å®ƒä¼šä»¥ gRPC çš„æ–¹å¼å¯¹å¤–æä¾›ä¸‰ä¸ªæœåŠ¡ï¼ˆgRPC Serviceï¼‰ï¼Œåˆ†åˆ«å«ä½œï¼šCSI Identityã€CSI Controller å’Œ CSI Node</p><p><strong>CSI çš„è®¾è®¡æ€æƒ³</strong>ï¼ŒæŠŠæ’ä»¶çš„èŒè´£ä»â€œä¸¤é˜¶æ®µå¤„ç†â€ï¼Œæ‰©å±•æˆäº† Provisionã€Attach å’Œ Mount ä¸‰ä¸ªé˜¶æ®µã€‚å…¶ä¸­ï¼ŒProvision ç­‰ä»·äºâ€œåˆ›å»ºç£ç›˜â€ï¼ŒAttach ç­‰ä»·äºâ€œæŒ‚è½½ç£ç›˜åˆ°è™šæ‹Ÿæœºâ€ï¼ŒMount ç­‰ä»·äºâ€œå°†è¯¥ç£ç›˜æ ¼å¼åŒ–åï¼ŒæŒ‚è½½åœ¨ Volume çš„å®¿ä¸»æœºç›®å½•ä¸Šâ€ã€‚</p><img src="/images/k8s/csi idea.png" style="zoom:50%;"/><p>below diagram depicts a kind of high-level Kubernetes archetypes integrated with CSI:</p><img src="/images/k8s/csi-diagram.png" style="zoom:50%;"/><blockquote><p>åœ¨å®é™…ä½¿ç”¨ CSI æ’ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå°†è¿™ä¸‰ä¸ª External Components ä½œä¸º sidecar å®¹å™¨å’Œ CSI æ’ä»¶æ”¾ç½®åœ¨åŒä¸€ä¸ª Pod ä¸­ã€‚ç”±äº External Components å¯¹ CSI æ’ä»¶çš„è°ƒç”¨éå¸¸é¢‘ç¹ï¼Œæ‰€ä»¥è¿™ç§ sidecar çš„éƒ¨ç½²æ–¹å¼éå¸¸é«˜æ•ˆã€‚</p></blockquote><ul><li>the external components are introduced to decouple Kubernetes and Storage Provider logic</li><li>Blue arrows present the conventional way to call against API Server</li><li>Red arrows present gRPC to call against Volume Driver</li></ul><h2 id="External-Components"><a href="#External-Components" class="headerlink" title="External Components"></a>External Components</h2><ul><li><p><strong>Driver Registrar</strong></p><p><strong>è´Ÿè´£å°†æ’ä»¶æ³¨å†Œåˆ° kubelet é‡Œé¢</strong>ï¼ˆè¿™å¯ä»¥ç±»æ¯”ä¸ºï¼Œå°†å¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨æ’ä»¶ç›®å½•ä¸‹ï¼‰ã€‚è€Œåœ¨å…·ä½“å®ç°ä¸Šï¼ŒDriver Registrar éœ€è¦è¯·æ±‚ CSI æ’ä»¶çš„ Identity æœåŠ¡æ¥è·å–æ’ä»¶ä¿¡æ¯ã€‚</p><blockquote><p>CSIDriver æ˜¯é›†ç¾¤çº§åˆ«çš„ï¼Œä¾›å…¶ä»–namespaceè°ƒç”¨</p></blockquote></li><li><p><strong>External Provisioner</strong></p><p><strong>è´Ÿè´£ Provision é˜¶æ®µ</strong>ã€‚åœ¨å…·ä½“å®ç°ä¸Šï¼ŒExternal Provisioner ç›‘å¬ï¼ˆWatchï¼‰äº† APIServer é‡Œçš„ PVC å¯¹è±¡ã€‚å½“ä¸€ä¸ª PVC è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°±ä¼šè°ƒç”¨ CSI Controller çš„ CreateVolume æ–¹æ³•ï¼Œåˆ›å»ºå¯¹åº” PV</p></li><li><p><strong>External Attacher</strong></p><p><strong>è´Ÿè´£â€œAttach é˜¶æ®µâ€</strong>ã€‚åœ¨å…·ä½“å®ç°ä¸Šï¼Œå®ƒç›‘å¬äº† APIServer é‡Œ VolumeAttachment å¯¹è±¡çš„å˜åŒ–ã€‚VolumeAttachment å¯¹è±¡æ˜¯ Kubernetes ç¡®è®¤ä¸€ä¸ª Volume å¯ä»¥è¿›å…¥â€œAttach é˜¶æ®µâ€çš„é‡è¦æ ‡å¿—ï¼›</p><p>ä¸€æ—¦å‡ºç°äº† VolumeAttachment å¯¹è±¡ï¼ŒExternal Attacher å°±ä¼šè°ƒç”¨ CSI Controller æœåŠ¡çš„ ControllerPublish æ–¹æ³•ï¼Œå®Œæˆå®ƒæ‰€å¯¹åº”çš„ Volume çš„ Attach é˜¶æ®µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubernetes-csi/external-snapshotter: This project contains the sidecar container that watches Kubernetes VolumeSnapshot objects and triggers CreateSnapshot/DeleteSnapshot operations against a CSI endpoint.</span><br><span class="line"></span><br><span class="line">kubernetes-csi/external-provisioner: The external-provisioner is a sidecar container that watches Kubernetes PersistentVolumeClaim objects and triggers CreateVolume/DeleteVolume operations against a CSI endpoint.</span><br><span class="line"></span><br><span class="line">kubernetes-csi/external-attacher: The external-attacher is a sidecar container that watches Kubernetes VolumeAttachment objects and triggers ControllerPublish/Unpublish operations against a CSI endpoint.</span><br><span class="line"></span><br><span class="line">kubernetes-csi/node-driver-registrar: This sidecar container registers a CSI driver with the kubelet using the kubelet plugin registration mechanism.</span><br><span class="line"></span><br><span class="line">kubernetes-csi/livenessprobe: A sidecar container that can be included in a CSI plugin pod to enable integration with Kubernetes Liveness Probe</span><br></pre></td></tr></table></figure></li></ul><h2 id="Custom-Components"><a href="#Custom-Components" class="headerlink" title="Custom Components"></a>Custom Components</h2><ul><li><p><strong>CSI Identity</strong></p><p><strong>è´Ÿè´£å¯¹å¤–æš´éœ²è¿™ä¸ªæ’ä»¶æœ¬èº«çš„ä¿¡æ¯</strong></p></li><li><p><strong>CSI Controller</strong></p><p><strong>å®šä¹‰çš„åˆ™æ˜¯å¯¹ CSI Volumeï¼ˆå¯¹åº” Kubernetes é‡Œçš„ PVï¼‰çš„ç®¡ç†æ¥å£</strong>ï¼Œæ¯”å¦‚ï¼šåˆ›å»ºå’Œåˆ é™¤ CSI Volumeã€å¯¹ CSI Volume è¿›è¡Œ Attach/Dettachï¼ˆåœ¨ CSI é‡Œï¼Œè¿™ä¸ªæ“ä½œè¢«å«ä½œ Publish/Unpublishï¼‰ï¼Œä»¥åŠå¯¹ CSI Volume è¿›è¡Œ Snapshot ç­‰</p></li><li><p><strong>CSI Node</strong></p><p>â€œMount é˜¶æ®µâ€åœ¨ CSI Node é‡Œçš„æ¥å£ï¼Œæ˜¯ç”± NodeStageVolume å’Œ NodePublishVolume ä¸¤ä¸ªæ¥å£å…±åŒå®ç°çš„;</p><p>å½“ kubelet çš„ VolumeManagerReconciler æ§åˆ¶å¾ªç¯æ£€æŸ¥åˆ°å®ƒéœ€è¦æ‰§è¡Œ Mount æ“ä½œçš„æ—¶å€™ï¼Œä¼šé€šè¿‡ pkg/volume/csi åŒ…ï¼Œç›´æ¥è°ƒç”¨ CSI Node æœåŠ¡å®Œæˆ Volume çš„â€œMount é˜¶æ®µâ€</p></li></ul><h1 id="provision"><a href="#provision" class="headerlink" title="provision"></a>provision</h1><h2 id="Dynamic-provisioning"><a href="#Dynamic-provisioning" class="headerlink" title="Dynamic provisioning"></a>Dynamic provisioning</h2><ul><li>Create the PVC first.</li><li>the CreateVolume request is triggered by Kubernetes when a PVC requests storage, and the CSI driver dynamically provisions the volume based on StorageClass and PVC parameters.</li></ul><h2 id="Static-provisioning"><a href="#Static-provisioning" class="headerlink" title="Static provisioning"></a>Static provisioning</h2><ul><li>Create the PV first.</li><li>there is no CreateVolume request. Instead, the PV is manually created, and the CSI driver accesses an already provisioned volume using information like volumeHandle from the PV YAML.</li></ul><h1 id="senarios"><a href="#senarios" class="headerlink" title="senarios"></a>senarios</h1><h2 id="expand-volume"><a href="#expand-volume" class="headerlink" title="expand volume"></a>expand volume</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant User as User</span><br><span class="line">    participant APIServer as API Server</span><br><span class="line">    participant ControllerManager as Kube-Controller-Manager</span><br><span class="line">    participant CSIController as CSI Controller Plugin</span><br><span class="line">    participant Node as Node (Kubelet)</span><br><span class="line"></span><br><span class="line">    User-&gt;&gt;APIServer: Update PVC with new size</span><br><span class="line">    APIServer-&gt;&gt;ControllerManager: Trigger Volume Expansion</span><br><span class="line">    ControllerManager-&gt;&gt;CSIController: ControllerExpandVolume</span><br><span class="line">    CSIController--&gt;&gt;ControllerManager: Expansion Success (NodeExpansionRequired: true)</span><br><span class="line"></span><br><span class="line">    ControllerManager-&gt;&gt;APIServer: Update PV size</span><br><span class="line">    APIServer-&gt;&gt;Node: Notify Node of Expansion</span><br><span class="line">    Node-&gt;&gt;CSIController: NodeExpandVolume</span><br><span class="line">    CSIController--&gt;&gt;Node: Expansion Success</span><br><span class="line">    Node-&gt;&gt;APIServer: Filesystem Resized</span><br><span class="line">    APIServer-&gt;&gt;User: PVC Expansion Complete</span><br></pre></td></tr></table></figure><h1 id="code"><a href="#code" class="headerlink" title="code"></a>code</h1><h2 id="request"><a href="#request" class="headerlink" title="request"></a>request</h2><ul><li><p><code>volCap := req.GetVolumeCapability()</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">get volume_capability:</span><br><span class="line">appName=&quot;test-dingofs-app&quot; volumeId=&quot;pvc-a96af0fb-2df7-435f-bde9-b3b3f0853023&quot;</span><br><span class="line">volCap=</span><br><span class="line">&#123;</span><br><span class="line">&quot;AccessType&quot;: &#123;</span><br><span class="line">&quot;Mount&quot;: &#123;</span><br><span class="line">&quot;mount_flags&quot;: [&quot;diskCache.diskCacheType=2&quot;, &quot;block_cache.cache_store=disk&quot;, &quot;disk_cache.cache_dir=/curvefs/client/data/cache/1:10240;/curvefs/client/data/cache/2:10240;/curvefs/client/data/cache/3:10240&quot;, &quot;disk_cache.cache_size_mb=102400&quot;]</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;access_mode&quot;: &#123;</span><br><span class="line">&quot;mode&quot;: 5</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>volCtx := req.GetVolumeContext()</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">get volume context:</span><br><span class="line">appName=&quot;test-dingofs-app&quot; volumeId=&quot;pvc-a96af0fb-2df7-435f-bde9-b3b3f0853023&quot;</span><br><span class="line">volCtx=</span><br><span class="line">&#123;</span><br><span class="line">&quot;capacity&quot;: &quot;21474836480&quot;,</span><br><span class="line">&quot;csi.storage.k8s.io/ephemeral&quot;: &quot;false&quot;,</span><br><span class="line">&quot;csi.storage.k8s.io/pod.name&quot;: &quot;test-dingofs-app&quot;,</span><br><span class="line">&quot;csi.storage.k8s.io/pod.namespace&quot;: &quot;test-dingofs-mountpod&quot;,</span><br><span class="line">&quot;csi.storage.k8s.io/pod.uid&quot;: &quot;98ad53c2-e99f-4ccf-b98c-841d9ec5a5b8&quot;,</span><br><span class="line">&quot;csi.storage.k8s.io/serviceAccount.name&quot;: &quot;default&quot;,</span><br><span class="line">&quot;storage.kubernetes.io/csiProvisionerIdentity&quot;: &quot;1734407521827-8081-csi.dingofs.v2&quot;,</span><br><span class="line">&quot;subPath&quot;: &quot;pvc-a96af0fb-2df7-435f-bde9-b3b3f0853023&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> csi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>emacs</title>
      <link href="/2024/08/30/emacs/"/>
      <url>/2024/08/30/emacs/</url>
      
        <content type="html"><![CDATA[<h2 id="shortcut"><a href="#shortcut" class="headerlink" title="shortcut"></a>shortcut</h2><table><thead><tr><th>Emacs åŠŸèƒ½é”®</th><th>ç¼©å†™</th><th>å¯¹åº”é”®ç›˜æŒ‰é”®(PC/Mac)</th></tr></thead><tbody><tr><td>Control</td><td>C</td><td>Ctrl / Control</td></tr><tr><td>Meta</td><td>M</td><td>Alt / Option</td></tr><tr><td>Shift</td><td>S</td><td>Shift / Shift</td></tr><tr><td>Super</td><td>s</td><td>Win / Command</td></tr></tbody></table><table><thead><tr><th>æ“ä½œæè¿°</th><th>å¿«æ·é”®</th><th>å‘½ä»¤å</th></tr></thead><tbody><tr><td>è¾“å…¥å‘½ä»¤</td><td>M-x</td><td>execute-extended-command</td></tr><tr><td>é€€å‡ºç¨‹åº</td><td>C-x C-c</td><td>save-buffers-kill-terminal</td></tr><tr><td>æ”¾å¼ƒå½“å‰è¾“å…¥</td><td>C-g</td><td>keyboard-quit</td></tr><tr><td>å…‰æ ‡å‘ä¸Šä¸€è¡Œï¼ˆæ–¹å‘é”®ä¸Šï¼‰</td><td>C-p</td><td>previous-line</td></tr><tr><td>å…‰æ ‡å‘ä¸‹ä¸€è¡Œï¼ˆæ–¹å‘é”®ä¸‹ï¼‰</td><td>C-n</td><td>next-line</td></tr><tr><td>å…‰æ ‡å‘å·¦ä¸€ä¸ªå­—ç¬¦ï¼ˆæ–¹å‘é”®å·¦ï¼‰</td><td>C-b</td><td>backward-char</td></tr><tr><td>å…‰æ ‡å‘å³ä¸€ä¸ªå­—ç¬¦ï¼ˆæ–¹å‘é”®å³ï¼‰</td><td>C-f</td><td>forward-char</td></tr><tr><td>å…‰æ ‡å‘å·¦ç§»åŠ¨ä¸€ä¸ªè¯</td><td>M-b</td><td>backward-word</td></tr><tr><td>å…‰æ ‡å‘å³ç§»åŠ¨ä¸€ä¸ªè¯</td><td>M-f</td><td>forward-word</td></tr><tr><td>å…‰æ ‡ç§»è‡³è¡Œé¦–</td><td>C-a</td><td>move-beginning-of-line</td></tr><tr><td>å…‰æ ‡ç§»è‡³è¡Œå°¾</td><td>C-e</td><td>move-end-of-line</td></tr><tr><td>å…‰æ ‡ç§»åŠ¨åˆ°ä¸€è¡Œç¼©è¿›çš„å¼€å¤´</td><td>M-m</td><td>back-to-indentation</td></tr><tr><td>å…‰æ ‡ç§»è‡³å¥é¦–</td><td>M-a</td><td>backward-sentence</td></tr><tr><td>å…‰æ ‡ç§»è‡³å¥å°¾</td><td>M-e</td><td>forward-sentence</td></tr><tr><td>å…‰æ ‡ç§»è‡³æ–‡ä»¶å¼€å¤´</td><td>M-&lt;</td><td>beginning-of-buffer</td></tr><tr><td>å…‰æ ‡ç§»è‡³æ–‡ä»¶ç»“å°¾</td><td>M-&gt;</td><td>end-of-buffer</td></tr><tr><td>å…‰æ ‡ç§»åŠ¨è‡³çª—å£çš„ä¸­é—´ã€æœ€ä¸Šã€æœ€ä¸‹</td><td>M-r</td><td>move-to-window-line-top-bottom</td></tr><tr><td>åˆ é™¤å…‰æ ‡å³ä¾§å­—ç¬¦</td><td>C-d</td><td>delete-char</td></tr><tr><td>ç§»é™¤å…‰æ ‡å³ä¾§è¯</td><td>M-d</td><td>kill-word</td></tr><tr><td>ç§»é™¤å…‰æ ‡å·¦ä¾§è¯</td><td>M-DEL</td><td>backward-kill-word</td></tr><tr><td>ç§»é™¤å³ä¾§ç›´åˆ°å¥å­ç»“å°¾</td><td>M-k</td><td>kill-sentence</td></tr><tr><td>ç§»é™¤å³ä¾§ç›´åˆ°è¡Œå°¾</td><td>C-k</td><td>kill-line</td></tr><tr><td>è®¾ç½®æ ‡è®°ä»¥é€‰æ‹©åŒºåŸŸ</td><td>C-SPC</td><td>set-mark-command</td></tr><tr><td>å¤åˆ¶åŒºåŸŸ</td><td>M-w</td><td>kill-region-save</td></tr><tr><td>ç§»é™¤åŒºåŸŸ</td><td>C-w</td><td>kill-region</td></tr><tr><td>æ’å…¥å·²ç§»é™¤æ–‡æœ¬</td><td>C-y</td><td>yank</td></tr><tr><td>æ’å…¥å†å²ç§»é™¤æ–‡æœ¬</td><td>M-y</td><td>yank-pop</td></tr><tr><td>æ’¤å›</td><td>C-/ æˆ– C-_ æˆ– C-x u</td><td>undo</td></tr><tr><td>è·³è½¬åˆ°ä¸Šä¸€æ ‡è®°</td><td>C-x C-SPC æˆ– C-u C-SPC</td><td>pop-global-mark</td></tr><tr><td>è·³è½¬åˆ°è¡Œå·</td><td>M-g M-g</td><td>goto-line</td></tr><tr><td>é‡å¤</td><td>C-u</td><td>universal-argument</td></tr><tr><td>å‘ä¸‹ä¸€é¡µ</td><td>C-v</td><td>scroll-up-command</td></tr><tr><td>å‘ä¸Šä¸€é¡µ</td><td>M-v</td><td>scroll-down-command</td></tr><tr><td>ç§»åŠ¨é¡µé¢ä½¿å¾—å…‰æ ‡åœ¨ä¸­å¤®/æœ€ä¸Šæ–¹/æœ€ä¸‹æ–¹</td><td>C-l</td><td>recenter-top-bottom</td></tr><tr><td>å‘åæœç´¢</td><td>C-s</td><td>isearch-forward</td></tr><tr><td>å‘å‰æœç´¢</td><td>C-r</td><td>isearch-backward</td></tr><tr><td>äº¤æ¢å‰åå­—ç¬¦</td><td>C-t</td><td>transpose-chars</td></tr><tr><td>äº¤æ¢å‰åè¯</td><td>M-t</td><td>transpose-words</td></tr><tr><td>äº¤æ¢å‰åä¸¤è¡Œ</td><td>C-x C-t</td><td>transpose-lines</td></tr><tr><td>åœ¨ä¸‹æ–¹æ–°å»ºä¸€è¡Œ</td><td>C-o</td><td>open-line</td></tr><tr><td>åˆ é™¤è¿ç»­ç©ºè¡Œä¸ºä¸€ä¸ªç©ºè¡Œ</td><td>C-x C-o</td><td>delete-blank-lines</td></tr><tr><td>å°†åé¢çš„è¯å˜ä¸ºå°å†™</td><td>M-l</td><td>downcase-word</td></tr><tr><td>å°†åé¢çš„è¯å˜ä¸ºå¤§å†™</td><td>M-u</td><td>upcase-word</td></tr><tr><td>å°†åé¢çš„è¯å˜ä¸ºé¦–å­—æ¯å¤§å†™</td><td>M-c</td><td>capitalize-word</td></tr><tr><td>æ”¾å¤§å­—å·</td><td>C-x C-=</td><td>text-scale-adjust</td></tr><tr><td>ç¼©å°å­—å·</td><td>C-x Câ€“</td><td>text-scale-adjust</td></tr><tr><td>é‡ç½®å­—å·</td><td>C-x C-0</td><td>text-scale-adjust</td></tr><tr><td>ç®€è¦æè¿°å¿«æ·é”®åŠŸèƒ½</td><td>C-h c</td><td>describe-key-briefly</td></tr><tr><td>æè¿°å¿«æ·é”®åŠŸèƒ½</td><td>C-h k</td><td>describe-key</td></tr><tr><td>æè¿°å‡½æ•°åŠŸèƒ½</td><td>C-h f</td><td>describe-function</td></tr><tr><td>æè¿°å˜é‡</td><td>C-h v</td><td>describe-variable</td></tr><tr><td>åˆ—å‡ºå«æŸä¸€å…³é”®è¯çš„å‘½ä»¤</td><td>C-h a</td><td>apropos-command</td></tr><tr><td>åˆ—å‡ºå«æŸä¸€å…³é”®è¯çš„ç¬¦å·çš„æ–‡æ¡£</td><td>C-h d</td><td>apropos-documentation</td></tr><tr><td>å¸®åŠ©çš„å¸®åŠ©</td><td>C-h ?</td><td>help-for-help</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> emacs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes vcluster</title>
      <link href="/2024/08/27/kubernetes%20vcluster/"/>
      <url>/2024/08/27/kubernetes%20vcluster/</url>
      
        <content type="html"><![CDATA[<blockquote><p>vCluster is a technology that creates virtual clusters within a physical Kubernetes cluster. These virtual clusters are fully functional and provide enhanced isolation and flexibility for multi-tenancy. Each vCluster operates independently, with its own API server and control plane, while sharing the underlying resources of the host cluster.</p><p>Kubernetes serves as the foundational platform for container orchestration, while vCluster enhances its capabilities by providing isolated, virtualized environments for multi-tenant applications. This relationship allows organizations to maximize resource utilization and maintain security across diverse teams and applications</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------------------------------+</span><br><span class="line">|                  Host Cluster                    |</span><br><span class="line">|                                                  |</span><br><span class="line">|  +--------------------------------------------+  |</span><br><span class="line">|  |            Kubernetes Control Plane        |  |</span><br><span class="line">|  |                                            |  |</span><br><span class="line">|  |  +-----------------+   +-----------------+ |  |</span><br><span class="line">|  |  |  API Server     |   |  Controller     | |  |</span><br><span class="line">|  |  |                 |   |  Manager        | |  |</span><br><span class="line">|  |  +-----------------+   +-----------------+ |  |</span><br><span class="line">|  |                                            |  |</span><br><span class="line">|  |  +-----------------+   +-----------------+ |  |</span><br><span class="line">|  |  |  Scheduler      |   |  Data Store     | |  |</span><br><span class="line">|  |  |                 |   |  (etcd)         | |  |</span><br><span class="line">|  |  +-----------------+   +-----------------+ |  |</span><br><span class="line">|  |                                            |  |</span><br><span class="line">|  |  +--------------------------------------+  |  |</span><br><span class="line">|  |  |          Worker Nodes                |  |  |</span><br><span class="line">|  |  |  (Pods running applications)         |  |  |</span><br><span class="line">|  |  +--------------------------------------+  |  |</span><br><span class="line">|  +--------------------------------------------+  |</span><br><span class="line">|                                                  |</span><br><span class="line">|  +--------------------------------------------+  |</span><br><span class="line">|  |                vCluster                    |  |</span><br><span class="line">|  |                                            |  |</span><br><span class="line">|  |  +-----------------+   +-----------------+ |  |</span><br><span class="line">|  |  |  Virtual API    |   |  Syncer         | |  |</span><br><span class="line">|  |  |  Server         |   |                 | |  |</span><br><span class="line">|  |  +-----------------+   +-----------------+ |  |</span><br><span class="line">|  |                                            |  |</span><br><span class="line">|  |  +-----------------+   +-----------------+ |  |</span><br><span class="line">|  |  |  Virtual        |   |  Virtual Data   | |  |</span><br><span class="line">|  |  |  Controller     |   |  Store          | |  |</span><br><span class="line">|  |  +-----------------+   +-----------------+ |  |</span><br><span class="line">|  +--------------------------------------------+  |</span><br><span class="line">+--------------------------------------------------+</span><br></pre></td></tr></table></figure><img src="/images/k8s/vcluster-architecture.png" style="width:100%"><h2 id="Key-Features-of-vCluster"><a href="#Key-Features-of-vCluster" class="headerlink" title="Key Features of vCluster"></a>Key Features of vCluster</h2><ul><li><strong>Isolation</strong>: Each virtual cluster has its own control plane, enhancing security and minimizing conflicts among teams.</li><li><strong>Resource Management</strong>: Virtual clusters manage their resources independently, allowing for efficient scaling and resource utilization.</li><li><strong>Multi-Tenancy</strong>: Supports multiple teams or tenants operating within the same physical infrastructure without interference.</li><li><strong>Flexibility</strong>: Can run on various Kubernetes distributions and supports different backing stores for data management.</li></ul><h2 id="Relationship-Between-Kubernetes-and-vCluster"><a href="#Relationship-Between-Kubernetes-and-vCluster" class="headerlink" title="Relationship Between Kubernetes and vCluster"></a>Relationship Between Kubernetes and vCluster</h2><ul><li><strong>Foundation</strong>: vCluster is built on top of Kubernetes, leveraging its capabilities to provide additional layers of abstraction and isolation.</li><li><strong>Resource Sharing</strong>: While vClusters share the physical resources of the host Kubernetes cluster, they maintain operational independence, allowing teams to work without affecting the global state of the host cluster.</li><li><strong>Enhanced Security</strong>: vClusters provide granular permissions and isolated control planes, which enhance security compared to standard Kubernetes namespaces.</li><li><strong>Operational Efficiency</strong>: By reducing the load on the host clusterâ€™s API server and allowing independent management of resources, vClusters improve overall operational efficiency.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vcluster </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PlantUML</title>
      <link href="/2024/08/23/plantUML/"/>
      <url>/2024/08/23/plantUML/</url>
      
        <content type="html"><![CDATA[<h1 id="TBD"><a href="#TBD" class="headerlink" title="TBD"></a>TBD</h1>]]></content>
      
      
      <categories>
          
          <category> PlantUML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfile</title>
      <link href="/2024/08/16/Dockerfile/"/>
      <url>/2024/08/16/Dockerfile/</url>
      
        <content type="html"><![CDATA[<h1 id="ARG-vs-ENV"><a href="#ARG-vs-ENV" class="headerlink" title="ARG vs ENV"></a>ARG vs ENV</h1><table><thead><tr><th><strong>Feature</strong></th><th>ARG <strong>(Build-time)</strong></th><th>ENV <strong>(Runtime)</strong></th></tr></thead><tbody><tr><td>Available at build-time?</td><td>âœ… Yes</td><td>âœ… Yes</td></tr><tr><td>Available in the running container?</td><td>âŒ No</td><td>âœ… Yes</td></tr><tr><td>Can be overridden at build-time?</td><td>âœ… Yes (â€“build-arg)</td><td>âŒ No</td></tr><tr><td>Can be overridden at runtime?</td><td>âŒ No</td><td>âœ… Yes (-e)</td></tr><tr><td>Included in final image?</td><td>âŒ No</td><td>âœ… Yes</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> dockerfile </category>
          
      </categories>
      
      
        <tags>
            
            <tag> config </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>grpc point</title>
      <link href="/2024/08/15/grpc/"/>
      <url>/2024/08/15/grpc/</url>
      
        <content type="html"><![CDATA[<h1 id="proto-file"><a href="#proto-file" class="headerlink" title="proto file"></a>proto file</h1><blockquote><p>.proto file that defines the gRPC service and messages</p></blockquote><h1 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h1><blockquote><p>Use protoc to generate client and server code for both languages</p></blockquote><p>When you compile <code>.proto</code> files using <code>protoc</code>, it generates two Go files: <code>xxx.pb.go</code> and <code>xxx_grpc.pb.go</code>. These files are essential for both client and server implementations in a gRPC service. Hereâ€™s how they fit into the architecture:</p><h3 id="xxx-pb-go"><a href="#xxx-pb-go" class="headerlink" title="xxx.pb.go"></a><code>xxx.pb.go</code></h3><ul><li><strong>Purpose</strong>: Contains the Go representations of the protocol buffer messages defined in the <code>.proto</code> file.</li><li><strong>Usage</strong>: Used by both client and server to serialize and deserialize the messages.</li><li><strong>Contents</strong>: <ul><li>Go structs for each message type.</li><li>Methods for marshaling and unmarshaling these structs to and from binary format.</li></ul></li></ul><h3 id="xxx-grpc-pb-go"><a href="#xxx-grpc-pb-go" class="headerlink" title="xxx_grpc.pb.go"></a><code>xxx_grpc.pb.go</code></h3><ul><li><strong>Purpose</strong>: Contains the gRPC service definitions and client/server interfaces.</li><li><strong>Usage</strong>: <ul><li><strong>Server</strong>: Implements the server-side logic by embedding the generated server interface.</li><li><strong>Client</strong>: Uses the generated client interface to make RPC calls.</li></ul></li><li><strong>Contents</strong>:<ul><li>Server interface with methods corresponding to the RPCs defined in the <code>.proto</code> file.</li><li>Client interface with methods to call the RPCs.</li><li>Registration functions to register the server with a gRPC server.</li><li>Handler functions to handle incoming RPC calls.</li></ul></li></ul><h1 id="client-and-server"><a href="#client-and-server" class="headerlink" title="client and server"></a>client and server</h1><h3 id="Client-Code"><a href="#Client-Code" class="headerlink" title="Client Code"></a>Client Code</h3><ul><li><strong>References</strong>: Both <code>xxx.pb.go</code> and <code>xxx_grpc.pb.go</code>.</li><li><strong>Functionality</strong>: <ul><li>Uses the client interface from <code>xxx_grpc.pb.go</code> to make RPC calls.</li><li>Constructs request messages using the structs from <code>xxx.pb.go</code>.</li></ul></li></ul><h3 id="Server-Code"><a href="#Server-Code" class="headerlink" title="Server Code"></a>Server Code</h3><ul><li><strong>References</strong>: Both <code>xxx.pb.go</code> and <code>xxx_grpc.pb.go</code>.</li><li><strong>Functionality</strong>: <ul><li>Implements the server interface from <code>xxx_grpc.pb.go</code>.</li><li>Handles incoming requests and constructs response messages using the structs from <code>xxx.pb.go</code>.</li></ul></li></ul><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>In the provided example:</p><ul><li><p><strong>Client Code</strong> (<code>examples/helloworld/greeter_client/main.go</code>):</p><ul><li>Uses <code>pb.NewGreeterClient</code> from <code>helloworld_grpc.pb.go</code> to create a client.</li><li>Constructs <code>HelloRequest</code> messages using the struct from <code>helloworld.pb.go</code>.</li></ul></li><li><p><strong>Server Code</strong> (<code>examples/helloworld/greeter_server/main.go</code>):</p><ul><li>Implements <code>GreeterServer</code> interface from <code>helloworld_grpc.pb.go</code>.</li><li>Constructs <code>HelloReply</code> messages using the struct from <code>helloworld.pb.go</code>.</li></ul></li></ul><p><strong>This architecture ensures that both client and server have a consistent and type-safe way to communicate using the protocol buffer messages and gRPC service definitions.</strong></p>]]></content>
      
      
      <categories>
          
          <category> grpc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> point </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>code style</title>
      <link href="/2024/08/14/code%20styple/"/>
      <url>/2024/08/14/code%20styple/</url>
      
        <content type="html"><![CDATA[<h1 id="functional-programming"><a href="#functional-programming" class="headerlink" title="functional programming"></a>functional programming</h1><h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><p>Go (Golang) supports functional programming concepts, although it is primarily an imperative language. Here are some key functional programming features in Go:</p><h3 id="1-First-Class-Functions"><a href="#1-First-Class-Functions" class="headerlink" title="1. First-Class Functions"></a>1. First-Class Functions</h3><p>Functions in Go are first-class citizens, meaning they can be assigned to variables, passed as arguments, and returned from other functions.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> op <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line">    op = add</span><br><span class="line">    fmt.Println(op(<span class="number">1</span>, <span class="number">2</span>)) <span class="comment">// Outputs: 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-Higher-Order-Functions"><a href="#2-Higher-Order-Functions" class="headerlink" title="2. Higher-Order Functions"></a>2. Higher-Order Functions</h3><p>Functions that take other functions as arguments or return functions are called higher-order functions.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">apply</span><span class="params">(op <span class="keyword">func</span>(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span>, <span class="title">a</span>, <span class="title">b</span> <span class="title">int</span>) <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> op(a, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    add := <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> a + b &#125;</span><br><span class="line">    fmt.Println(apply(add, <span class="number">1</span>, <span class="number">2</span>)) <span class="comment">// Outputs: 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Closures"><a href="#3-Closures" class="headerlink" title="3. Closures"></a>3. Closures</h3><p>Go supports closures, which are functions that capture the variables from their surrounding scope.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">incrementer</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        i++</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    inc := incrementer()</span><br><span class="line">    fmt.Println(inc()) <span class="comment">// Outputs: 1</span></span><br><span class="line">    fmt.Println(inc()) <span class="comment">// Outputs: 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Pure-Functions"><a href="#4-Pure-Functions" class="headerlink" title="4. Pure Functions"></a>4. Pure Functions</h3><p>Pure functions are functions that do not have side effects and return the same result given the same arguments.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(add(<span class="number">1</span>, <span class="number">2</span>)) <span class="comment">// Outputs: 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-Immutability"><a href="#5-Immutability" class="headerlink" title="5. Immutability"></a>5. Immutability</h3><p>While Go does not enforce immutability, you can design your functions to avoid mutating state.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addToSlice</span><span class="params">(slice []<span class="keyword">int</span>, value <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    newSlice := <span class="built_in">append</span>(slice, value)</span><br><span class="line">    <span class="keyword">return</span> newSlice</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    original := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">    newSlice := addToSlice(original, <span class="number">4</span>)</span><br><span class="line">    fmt.Println(original) <span class="comment">// Outputs: [1, 2, 3]</span></span><br><span class="line">    fmt.Println(newSlice) <span class="comment">// Outputs: [1, 2, 3, 4]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-Functional-Composition"><a href="#6-Functional-Composition" class="headerlink" title="6. Functional Composition"></a>6. Functional Composition</h3><p>You can compose functions to build more complex operations.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compose</span><span class="params">(f, g <span class="keyword">func</span>(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span>) <span class="title">func</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> f(g(a, b), b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    addThenMultiply := compose(multiply, add)</span><br><span class="line">    fmt.Println(addThenMultiply(<span class="number">2</span>, <span class="number">3</span>)) <span class="comment">// Outputs: 15 (5 * 3)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>These features allow you to use functional programming techniques in Go, making your code more modular, reusable, and easier to reason about.</p><h1 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h1><ul><li>å‡½æ•°å¼ç¨‹åºæ›´å€¾å‘äºé“ºè®¾è°ƒèŠ‚æ•°æ®æµè½¬æ¢çš„ç®¡é“ç»“æ„ï¼Œè€Œå¯å˜çš„å‘½ä»¤å¼ç¨‹åºæ›´å€¾å‘äºè¿­ä»£åœ°å¤„ç†ä¸€ä¸ªä¸ªç±»å‹å¯¹è±¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> style </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>file system</title>
      <link href="/2024/08/07/fs:%20file%20system/"/>
      <url>/2024/08/07/fs:%20file%20system/</url>
      
        <content type="html"><![CDATA[<h1 id="storage"><a href="#storage" class="headerlink" title="storage"></a>storage</h1><h2 id="Object-Block-and-File-Storage"><a href="#Object-Block-and-File-Storage" class="headerlink" title="Object, Block and File Storage"></a>Object, Block and File Storage</h2><table><thead><tr><th>Feature</th><th><strong>Object Storage</strong></th><th><strong>Block Storage</strong></th><th><strong>File Storage</strong></th></tr></thead><tbody><tr><td><strong>Data Structure</strong></td><td>Stores as objects (data + metadata)</td><td>Stores in blocks (raw chunks of data)</td><td>Stores as files in directories</td></tr><tr><td><strong>Access Protocols</strong></td><td>HTTP APIs (e.g., S3)</td><td>iSCSI, Fibre Channel</td><td>NFS, SMB/CIFS</td></tr><tr><td><strong>Performance</strong></td><td>High scalability, slower access</td><td>Low latency, high IOPS</td><td>Moderate, varies by file system</td></tr><tr><td><strong>Scalability</strong></td><td>Virtually unlimited (distributed)</td><td>Scales well with SAN, but complex</td><td>Limited by file system performance</td></tr><tr><td><strong>Cost Efficiency</strong></td><td>High for large amounts of unstructured data</td><td>Can be expensive at scale</td><td>Moderate to expensive</td></tr><tr><td><strong>Best Use Cases</strong></td><td>Media content, backups, big data, archives</td><td>Databases, VMs, transactional systems</td><td>Shared access, collaboration, home directories</td></tr><tr><td><strong>Metadata</strong></td><td>Rich, customizable per object</td><td>None</td><td>Minimal (file permissions, attributes)</td></tr><tr><td><strong>Concurrency</strong></td><td>Excellent for concurrent access</td><td>Not designed for shared access</td><td>Designed for shared access</td></tr><tr><td><strong>Example Systems</strong></td><td>AWS S3, MinIO, Google Cloud Storage</td><td>AWS EBS, iSCSI, Fibre Channel</td><td>NFS, SMB/CIFS, GlusterFS</td></tr></tbody></table><ul><li><strong>Object Storage</strong>: Best for large-scale unstructured data, low cost, scalable but not suitable for low-latency or transactional workloads.</li><li><strong>Block Storage</strong>: High performance, low latency, granular control over data, ideal for VMs, databases, but can be costly to scale.</li><li><strong>File Storage</strong>: File-based storage for shared access, good for collaboration, but less scalable for large datasets.</li></ul><p><strong>Object storage</strong>, <strong>block storage</strong>, and <strong>file storage</strong> are all methods of storing and accessing data, but they differ in structure, management, and how they handle data. Despite their differences, they often complement each other in modern storage systems, and sometimes, the boundaries between them blur depending on use cases.</p><p><strong>Relation</strong></p><ul><li><strong>Different Levels of Abstraction</strong>:<ul><li><strong>Block Storage</strong> is the most granular, dealing with raw blocks of data.</li><li><strong>File Storage</strong> is built on top of block storage, organizing data into files and directories.</li><li><strong>Object Storage</strong> exists at a higher level, organizing data into objects with associated metadata and accessed through APIs, not files or blocks.</li></ul></li><li><strong>Integration in Systems</strong>:<ul><li>Object storage can use block storage underneath to store objects.</li><li>File storage is typically built on block storage, where the blocks form the basis of a file system.</li><li>Many modern systems (especially in cloud environments) allow the coexistence of these types of storage, where object storage holds bulk data, block storage serves databases and high-performance workloads, and file storage provides shared file access.</li></ul></li></ul><p><strong>senario</strong>: A Cloud-Based Photo Sharing Application</p><p>Letâ€™s say weâ€™re developing a photo-sharing application. Hereâ€™s how each storage type might be used:</p><ol><li><strong>Block Storage</strong>: <ul><li>The applicationâ€™s <strong>database</strong> (such as MySQL or PostgreSQL) will store metadata about users, photos, and comments. Databases need low-latency, fast read/write operations, which makes block storage ideal. Each database table or index is stored in blocks, providing high performance and reliability.</li><li>Example: An AWS EC2 instance uses <strong>Amazon Elastic Block Store (EBS)</strong> for fast data access in the applicationâ€™s database.</li></ul></li><li><strong>File Storage</strong>:<ul><li>For <strong>user-generated content</strong>, like profile pictures or documents that may need to be shared and updated by multiple users, file storage is the best fit. It allows users to upload, read, and modify files easily. The hierarchical structure also works well for organizing files into folders.</li><li>Example: The application uses <strong>NFS (Network File System)</strong> or <strong>SMB/CIFS</strong> to store shared user profiles, document uploads, or configuration files. In this case, multiple application servers can access the same files.</li></ul></li><li><strong>Object Storage</strong>:<ul><li>For <strong>large photos and videos</strong> uploaded by users, object storage is the best choice due to its scalability and cost efficiency. Each file (photo or video) is stored as an object with metadata like date uploaded, user ID, etc. Object storage is ideal because it can easily scale to store millions of large media files.</li><li>Example: The application stores usersâ€™ photos and videos in <strong>Amazon S3</strong> or <strong>MinIO</strong> as objects, where each photo or video is stored independently and accessed through an API.</li></ul></li></ol><p><strong>The Workflow Example</strong>:</p><ul><li>When a user uploads a new photo:<ol><li><strong>File Storage</strong> stores any accompanying text (e.g., captions, metadata) that might be shared or updated by other users.</li><li><strong>Block Storage</strong> is used to store transaction information, user details, and other relational data in the appâ€™s database.</li><li><strong>Object Storage</strong> stores the actual image file (the photo itself) as an object, and the app accesses it via an HTTP API when needed.</li></ol></li></ul><p><strong>Visual Relationship</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Object Storage (High-level, flat structure)</span><br><span class="line">|-- Stores: Photos, Videos</span><br><span class="line">|-- Metadata: Filename, upload time, user ID</span><br><span class="line">|-- Access via: APIs (e.g., S3 API)</span><br><span class="line"></span><br><span class="line">File Storage (Intermediate level, hierarchical structure)</span><br><span class="line">|-- Stores: Text files, configuration files, shared resources</span><br><span class="line">|-- Hierarchical access: Files are accessed via paths (/photos/, /users/)</span><br><span class="line">|-- Access via: NFS, SMB/CIFS</span><br><span class="line"></span><br><span class="line">Block Storage (Low-level, raw storage)</span><br><span class="line">|-- Stores: Database records, application data, raw volumes</span><br><span class="line">|-- Managed by: File systems (ext4, XFS) or directly by applications (databases)</span><br><span class="line">|-- Access via: iSCSI, Fibre Channel, or direct local access</span><br></pre></td></tr></table></figure><ul><li><strong>Key Integration Points</strong></li></ul><ol><li><p><strong>Data flows between storage types</strong>:</p><ul><li>Object storage may rely on block storage for its underlying infrastructure. For instance, in a cloud service, object storage systems often store objects across distributed blocks on physical storage.</li><li>File storage often relies on block storage (e.g., a disk or volume formatted with a file system) to organize files into directories. </li></ul></li><li><p><strong>Shared Purpose</strong>:</p><ul><li>All three storage types can coexist in a modern system, handling different parts of the same application. Block storage handles the core operational data; file storage manages shared, accessible data; and object storage is used for scalable, long-term archival of data.</li></ul></li></ol><p>In summary, <strong>block storage</strong> is the foundational layer, <strong>file storage</strong> organizes files in a hierarchical structure on top of block storage, and <strong>object storage</strong> organizes data in a flat, scalable way with metadata and API-based access. Each serves a different purpose but can be used together for a comprehensive data storage solution in complex applications.</p><h2 id="S3-Gateway"><a href="#S3-Gateway" class="headerlink" title="S3 Gateway"></a>S3 Gateway</h2><p>S3 Gateway acts as an intermediary to facilitate interactions between your application and the object storage system. This includes common operations on <strong>buckets</strong> and <strong>objects</strong> such as:</p><ul><li><strong>Creating buckets</strong> (e.g., <code>CreateBucket</code> API call)</li><li><strong>Reading objects</strong> (e.g., <code>GetObject</code>)</li><li><strong>Uploading or writing objects</strong> (e.g., <code>PutObject</code>)</li><li><strong>Deleting objects or buckets</strong> (e.g., <code>DeleteObject</code>, <code>DeleteBucket</code>)</li></ul><p>The S3 gateway translates these requests into <strong>S3 API calls</strong> that the object storage system understands. This is especially useful when:</p><ol><li>Your application isnâ€™t natively using S3 but requires access to an S3-compatible storage system (via the gateway).</li><li>Youâ€™re in a hybrid or on-premises environment where you want applications to interact with object storage in the same way they would with a cloud-based S3 service.</li></ol><p>For example, if you have a legacy application that doesnâ€™t natively support the S3 API but needs to manage objects (e.g., create or read files), the S3 gateway can allow the application to perform these tasks as if it were working with a regular file system. The gateway will handle the <strong>CRUD</strong> (Create, Read, Update, Delete) operations on <strong>buckets</strong> and <strong>objects</strong> by mapping them to the appropriate S3 commands.</p><p>So, when operating on buckets and objects, especially in environments where direct S3 API calls are not feasible or supported, using an S3 gateway is a key method. The gateway allows you to continue using familiar protocols while interacting with S3-compatible storage systems.</p><h1 id="concept"><a href="#concept" class="headerlink" title="concept"></a>concept</h1><h2 id="FS-type"><a href="#FS-type" class="headerlink" title="FS type"></a>FS type</h2><p><img src="/images/fs/fileSystemType.jpeg" alt="fileSystemType.jpeg"></p><ul><li><p>MacÂ é»˜è®¤å¯ä»¥è¯»Â WindowsÂ çš„Â NTFSÂ æ ¼å¼ï¼Œä½†ä¸èƒ½å†™ã€‚</p></li><li><p>WindowsÂ æ— æ³•è¯†åˆ«Â MacÂ çš„Â HFS+Â æˆ–Â APFSÂ æ ¼å¼ã€‚</p></li><li><p>MacÂ å’ŒÂ WindowsÂ éƒ½èƒ½æ­£å¸¸è¯»å†™Â FAT32Â å’ŒÂ ExFATÂ æ ¼å¼</p></li><li><p>linux</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Linuxï¼šå­˜åœ¨å‡ åä¸ªæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼šext2ï¼Œext3ï¼Œext4ï¼Œxfsï¼Œbrtfsï¼Œzfsï¼ˆman 5 fså¯ä»¥å–å¾—å…¨éƒ¨æ–‡ä»¶ç³»ç»Ÿçš„ä»‹ç»ï¼‰</span><br><span class="line"></span><br><span class="line">ä¸åŒæ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨ä¸åŒçš„æ–¹æ³•æ¥ç®¡ç†ç£ç›˜ç©ºé—´ï¼Œå„æœ‰ä¼˜åŠ£ï¼›æ–‡ä»¶ç³»ç»Ÿæ˜¯å…·ä½“åˆ°åˆ†åŒºçš„ï¼Œæ‰€ä»¥æ ¼å¼åŒ–é’ˆå¯¹çš„æ˜¯åˆ†åŒºï¼Œåˆ†åŒºæ ¼å¼åŒ–æ˜¯æŒ‡é‡‡ç”¨æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹å¯¹åˆ†åŒºç©ºé—´è¿›è¡Œç™»è®°ã€ç´¢å¼•å¹¶å»ºç«‹ç›¸åº”çš„ç®¡ç†è¡¨æ ¼çš„è¿‡ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">ext2å…·æœ‰æå¿«çš„é€Ÿåº¦å’Œæå°çš„CPUå ç”¨ç‡ï¼Œå¯ç”¨äºç¡¬ç›˜å’Œç§»åŠ¨å­˜å‚¨è®¾å¤‡</span><br><span class="line">ext3å¢åŠ æ—¥å¿—åŠŸèƒ½ï¼Œå¯å›æº¯è¿½è¸ª</span><br><span class="line">ext4æ—¥å¿—å¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒ1EBï¼ˆ1024*1024TBï¼‰ï¼Œæœ€å¤§å•æ–‡ä»¶16TBï¼Œæ”¯æŒè¿ç»­å†™å…¥å¯å‡å°‘æ–‡ä»¶ç¢ç‰‡ã€‚rhel6é»˜è®¤æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">xfså¯ä»¥ç®¡ç†500Tçš„ç¡¬ç›˜ã€‚rhel7é»˜è®¤æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">brtfsæ–‡ä»¶ç³»ç»Ÿé’ˆå¯¹å›ºæ€ç›˜åšä¼˜åŒ–ï¼Œ</span><br></pre></td></tr></table></figure></li><li><p>windows</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FAT16ï¼šMSâ€”DOSå’Œwin95é‡‡ç”¨çš„ç£ç›˜åˆ†åŒºæ ¼å¼ï¼Œé‡‡ç”¨16ä½çš„æ–‡ä»¶åˆ†é…è¡¨ï¼Œåªæ”¯æŒ2GBçš„ç£ç›˜åˆ†åŒºï¼Œæœ€å¤§å•æ–‡ä»¶2GBï¼Œä¸”ç£ç›˜åˆ©ç”¨ç‡ä½</span><br><span class="line">FAT32ï¼šï¼ˆå³Vfatï¼‰é‡‡ç”¨32ä½çš„æ–‡ä»¶åˆ†é…è¡¨ï¼Œæ”¯æŒæœ€å¤§åˆ†åŒº128GBï¼Œæœ€å¤§æ–‡ä»¶4GB</span><br><span class="line">NTFSï¼šæ”¯æŒæœ€å¤§åˆ†åŒº2TBï¼Œæœ€å¤§æ–‡ä»¶2TBï¼Œå®‰å…¨æ€§å’Œç¨³å®šæ€§éå¸¸å¥½ï¼Œä¸æ˜“å‡ºç°æ–‡ä»¶ç¢ç‰‡ã€‚</span><br></pre></td></tr></table></figure></li></ul><h2 id="Blocks"><a href="#Blocks" class="headerlink" title="Blocks"></a>Blocks</h2><ul><li><p><strong>Definition</strong>: A block is the smallest unit of storage that the filesystem can manage and read/write. Blocks are fixed-size data units (e.g., 4KB or 8KB), commonly used by the filesystem.</p></li><li><p><strong>Purpose</strong>: Blocks enable efficient storage and management of data on physical media, allowing the filesystem to allocate, read, and write specific portions of data without needing to process an entire file.</p></li><li><p><strong>In FUSE</strong>:</p><ul><li><p>FUSE-based filesystems often work with underlying block devices (like HDDs or SSDs) or other storage solutions (like networked file systems) that use block-level access.</p></li><li><p>FUSE translates file operations (e.g., open, read, write) into these block operations, allowing efficient data management despite being in userspace, which typically has more overhead than kernel space.</p></li></ul></li></ul><h2 id="Chunks"><a href="#Chunks" class="headerlink" title="Chunks"></a><strong>Chunks</strong></h2><ul><li><p><strong>Definition</strong>: A chunk is a larger, logical grouping of data that may span multiple blocks. Chunks are often used in distributed or object storage systems where data is split into parts for parallelism, redundancy, or ease of distribution.</p></li><li><p><strong>Purpose</strong>: Chunks allow data to be divided and distributed, making it possible for distributed filesystems to store data across multiple nodes, providing redundancy, load balancing, and better performance.</p></li><li><p><strong>In FUSE</strong>:</p><ul><li><p>Distributed filesystems or object storage systems accessible via FUSE (like Ceph, GlusterFS, or MinIO gateways) may break files into chunks. FUSE then handles data in terms of these chunks, passing it to the storage backend, which manages chunk distribution and retrieval.</p></li><li><p>Chunks provide advantages in scalability and reliability when FUSE is used to interface with distributed storage systems, allowing filesystems to grow seamlessly across multiple devices.</p></li></ul></li></ul><p><strong>How Blocks and Chunks Work Together on FUSE</strong></p><p>In a FUSE-based setup, <strong>blocks</strong> are typically handled at the disk or device level (within a single node), while <strong>chunks</strong> are managed at a higher level (often in a distributed or networked environment). FUSE enables interoperability by translating file operations, letting the application layer access chunks and blocks transparently.</p><p>For example, a file request from an application to a FUSE-mounted distributed filesystem may be:</p><p>â€‹    1.    Split into chunks (for parallel access across nodes).</p><p>â€‹    2.    Each chunk is further divided into blocks if stored on a block-based medium, facilitating storage efficiency and reliability.</p><h2 id="inode"><a href="#inode" class="headerlink" title="inode"></a>inode</h2><blockquote><p> In computer science, an <strong>inode</strong> (short for â€œindex nodeâ€) is a data structure that represents a file or directory in a file system. Inodes are the basic building blocks of a file system, and they play a crucial role in managing files and directories.                                                                                                                </p></blockquote><ul><li><strong>properties</strong></li></ul><p>An inode is a unique identifier for a file or directory on a file system. It contains metadata about the file or directory, An inode typically has several properties:             </p><p> <strong>Type</strong>: The type of file or directory (e.g., regular file, directory, symbolic link)                        </p><p><strong>Permissions</strong>: The access rights for the file or directory (owner, group, other)                          </p><p><strong>Timestamps</strong>: Creation, modification, and access timestamps                                     </p><p><strong>Inode number</strong>: A unique identifier for the inode        </p><p><strong>Block count</strong>: The number of blocks allocated to the file                                      </p><p><strong>Block offset</strong>: The starting block offset for the file           </p><p><strong>Inodes vs. Blocks</strong>                                                                                                                             </p><p>When a file is created on a file system, itâ€™s divided into smaller blocks of data, called <strong>blocks</strong>. Each block contains a portion of the fileâ€™s contents. The inode, on the other hand, contains metadata about the file, including the location of the blocks that make up the file.</p><p>Think of an inode as a â€œdirectory entryâ€ for a file, and a block as a chunk of data stored in a file system. When you create or delete a file, the inode is updated to reflect changes in the fileâ€™s metadata,                                 </p><p>while the blocks remain intact.</p><ul><li><strong>File System Operations</strong></li></ul><p>When you perform file system operations like create, delete, or modify a file, the following happens:                  </p><ol><li><strong>Create file</strong>:                         </li></ol><p>â€‹    * A new inode is created with the specified type and permissions.                                </p><p>â€‹    * Blocks are allocated to fill out the fileâ€™s contents.                                     </p><ol start="2"><li><strong>Delete file</strong>:                         </li></ol><p>â€‹    * The inode associated with the file is deleted.                                        </p><p>â€‹    * Any blocks allocated to the file are freed.        </p><ol start="3"><li><strong>Modify file</strong>:                         </li></ol><p>â€‹    * The existing inode is updated with the new metadata (e.g., changes in permissions, timestamps).                </p><p>â€‹    * No new blocks need to be allocated; any changes occur within the existing block structure.                  </p><ul><li><strong>Inode Number</strong>                          </li></ul><p>The inode number is a unique identifier for an inode. Itâ€™s used by the operating system and file system to manage files and directories. When you delete a file, the inode number is updated to indicate that it no longer exists.</p><p><strong>In summary</strong></p><p>Inodes represent files and directories in a file system.</p><p>They contain metadata such as type, permissions, timestamps, and inode number.</p><p>Blocks contain the actual data for a file or directory.</p><p>Inodes are updated when files or directories are created, deleted, or modified. </p><h2 id="dentry"><a href="#dentry" class="headerlink" title="dentry"></a>dentry</h2><blockquote><p>Directory Entry</p></blockquote><p>A dentry (directory entry) represents a mapping between a file name and an inode. Essentially, a dentry links a file or directory name to its respective inode.</p><p><strong>Key Characteristics of Dentries:</strong></p><p>â€‹    â€¢    <strong>Path Resolution</strong>: Dentries assist in translating file paths to inodes, making it faster for the OS to locate files in complex directory structures.</p><p>â€‹    â€¢    <strong>Caches for Performance</strong>: Dentries are cached to speed up file lookups, especially for frequently accessed files. When you access a file, the system checks the dentry cache first, reducing the need to repeatedly search the disk.</p><p>â€‹    â€¢    <strong>Relationship with Inodes</strong>: Dentries reference inodes rather than storing file metadata or data directly.</p><p><strong>How Inodes and Dentries Work Together:</strong></p><p>When accessing a file (e.g., opening or modifying it), the filesystem:</p><ol><li><p>Uses the directory path to locate the <strong>dentry</strong> for each component of the path, starting from the root (/) to the desired file.</p></li><li><p>Each <strong>dentry</strong> provides a reference to the <strong>inode</strong> that holds the fileâ€™s metadata and data block locations.</p><ol start="3"><li>   Once the correct <strong>inode</strong> is found, the system can access the data blocks on the disk to perform the desired file operation.</li></ol></li></ol><p><strong>Summary:</strong></p><p>â€‹    â€¢    <strong>Inodes</strong> store metadata and data pointers for each file, managing essential details and the physical location of data.</p><p>â€‹    â€¢    <strong>Dentries</strong> map filenames to inodes, facilitating path resolution and improving filesystem performance through caching.</p><p>This division helps optimize file access and management, making filesystems more efficient and scalable.</p><h2 id="LVM"><a href="#LVM" class="headerlink" title="LVM"></a>LVM</h2><blockquote><p> (Logical Volume Manager) Represents the LVM system that manages the disks (physical volumes), creates VGs, and allocates LVs.</p></blockquote><p>â€‹    â€¢    <strong>Disk</strong>: Represents the physical disks, such as /dev/sda or /dev/vdb.</p><p>â€‹    â€¢    <strong>VG (Volume Group)</strong>: Aggregates the space of one or more physical disks.</p><p>â€‹    â€¢    <strong>LV (Logical Volume)</strong>: A subdivision of the VG space, which can be mounted.</p><p>â€‹    â€¢    <strong>Mount Point</strong>: Where the LV is mounted in the filesystem.</p><img src="/images/fs/lvm architecture.png"><h2 id="partitioning-vs-LVM"><a href="#partitioning-vs-LVM" class="headerlink" title="partitioning vs LVM"></a>partitioning vs LVM</h2><p>The key difference between <strong>partitions</strong> and <strong>LVM</strong> (Logical Volume Management) lies in how they manage and allocate disk space. Hereâ€™s a breakdown of each:</p><p><strong>Partitioning</strong>:</p><p>Partitioning is a traditional way to divide a disk into sections, with each section functioning as a separate storage unit. These partitions are created directly on the disk, and once created, they are static unless you re-partition the disk (which can be complex and risky if the partitions contain data).</p><ul><li><strong>Physical Disk-Based</strong>: Partitions are fixed divisions of a physical disk, where each partition has a specific size.</li><li><strong>Static</strong>: Once created, partitions are hard to resize, and managing space between partitions can be inflexible.</li><li><strong>Limited</strong>: Typically, you are limited to a small number of primary partitions (e.g., 4 primary partitions on an MBR disk, though extended partitions can allow more).</li><li><strong>Direct Mounting</strong>: Partitions can be formatted with a filesystem (e.g., <code>xfs</code>, <code>ext4</code>) and mounted directly to the filesystem.</li></ul><p>Example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/dev/sda1  -&gt;  /boot</span><br><span class="line">/dev/sda2  -&gt;  /</span><br><span class="line">/dev/sda3  -&gt;  /home</span><br></pre></td></tr></table></figure><p><strong>LVM</strong></p><blockquote><p> Logical Volume Management</p></blockquote><p>LVM is a more flexible and advanced disk management system. Instead of dividing a disk into fixed partitions, it uses logical volumes that can span across multiple physical disks. LVM allows you to create, resize, and move logical volumes much more easily than traditional partitions.</p><ul><li><strong>Flexible</strong>: Logical volumes can be resized, expanded, or shrunk easily without affecting data. You can add more disks to an LVM group to increase space.</li><li><strong>Virtual</strong>: LVM creates a layer of abstraction over physical disks. You group one or more physical disks (or partitions) into a <strong>Volume Group (VG)</strong>, and from that pool of storage, you create <strong>Logical Volumes (LV)</strong>.</li><li><strong>Resizing</strong>: Logical volumes can be resized on the fly (especially for file systems like XFS or ext4 with online resize capabilities).</li><li><strong>Spanning Disks</strong>: LVM allows logical volumes to span multiple physical disks or partitions, meaning you are not limited by the size of a single disk.</li><li><strong>Snapshots and RAID</strong>: LVM supports features like snapshots and can be combined with RAID for redundancy.</li></ul><p>Components:</p><ol><li><strong>Physical Volume (PV)</strong>: These are physical disks or partitions that are part of an LVM system.</li><li><strong>Volume Group (VG)</strong>: A pool of storage made up of one or more physical volumes.</li><li><strong>Logical Volume (LV)</strong>: A virtual partition that you can format and mount like a traditional partition. It is created from the space in the volume group.</li></ol><p>Example:</p><ol><li>You create a <strong>Volume Group</strong> (<code>vg1</code>) using two physical disks (<code>/dev/sdb</code>, <code>/dev/sdc</code>).</li><li>From the volume group, you create <strong>Logical Volumes</strong> (<code>lv_root</code>, <code>lv_home</code>) and mount them.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/dev/vg1/lv_root  -&gt;  /</span><br><span class="line">/dev/vg1/lv_home  -&gt;  /home</span><br></pre></td></tr></table></figure></li></ol><p><strong>Comparison</strong></p><table><thead><tr><th>Feature</th><th>Partition</th><th>LVM</th></tr></thead><tbody><tr><td><strong>Storage Flexibility</strong></td><td>Static size, hard to resize</td><td>Dynamic, easy to resize or move volumes</td></tr><tr><td><strong>Number of Volumes</strong></td><td>Limited (4 primary, extended partitions)</td><td>Unlimited logical volumes in a volume group</td></tr><tr><td><strong>Disk Spanning</strong></td><td>Partition tied to a single disk</td><td>Logical volumes can span multiple disks</td></tr><tr><td><strong>Resizing</strong></td><td>Complex and risky</td><td>Easily resizable without data loss</td></tr><tr><td><strong>Snapshots</strong></td><td>Not supported</td><td>Supports snapshots for backups</td></tr><tr><td><strong>Management</strong></td><td>Basic partition management tools</td><td>Advanced management with <code>lvcreate</code>, <code>lvextend</code>, etc.</td></tr></tbody></table><p><strong>Example Scenario</strong>:</p><ol><li><p><strong>Partition</strong>: You have a 500GB disk, and you partition it into <code>/boot</code>, <code>/</code>, and <code>/home</code>. If you need more space for <code>/home</code>, youâ€™d have to resize or repartition the disk, which is not easy.</p></li><li><p><strong>LVM</strong>: With LVM, you create a Volume Group from a few physical volumes (disks or partitions), and you can create logical volumes (<code>/</code>, <code>/home</code>) from that pool of space. If <code>/home</code> needs more space, you can easily expand it by adding another disk or reallocating space within the volume group.</p></li></ol><p><strong>Summary</strong>:</p><ul><li><strong>Partitioning</strong> is a simple, traditional way to divide a disk, but itâ€™s rigid and hard to manage once the partitions are set.</li><li><strong>LVM</strong> is a flexible, powerful storage management tool that allows you to create logical volumes that can be resized, expanded, and managed more easily, often spanning multiple disks.</li></ul><h2 id="volume-vs-fs"><a href="#volume-vs-fs" class="headerlink" title="volume vs fs"></a>volume vs fs</h2><p>The relationship between volumes and file systems is fundamental to understanding how data is organized and stored in computer systems.</p><p><strong>Volume</strong>:</p><ul><li>A volume is a single accessible storage area with a single file system.</li><li>Itâ€™s a logical device that can span one or more physical storage devices or parts of them.</li><li>In simple terms, you can think of a volume as a container for storing data.</li></ul><p><strong>File System</strong>:</p><ul><li>A file system is a method and data structure that the operating system uses to control how data is stored and retrieved on a volume.</li><li>It defines how files are named, stored, organized, and accessed on the volume.</li></ul><p>Relationship:</p><ol><li>One-to-One Mapping:<ul><li>Typically, there is a one-to-one relationship between a volume and a file system.</li><li>Each volume usually has one file system formatted on it.</li></ul></li><li>Formatting:<ul><li>When you â€œformatâ€ a volume, youâ€™re actually creating a file system on that volume.</li><li>This process prepares the volume to store files and directories in a way that the operating system can understand.</li></ul></li><li>Mounting:<ul><li>When you â€œmountâ€ a volume, youâ€™re making its file system accessible to the operating system.</li><li>The mount point becomes the root directory of that file system within the larger file hierarchy.</li></ul></li><li>Types:<ul><li>Different types of file systems (e.g., NTFS, ext4, XFS, FAT32) can be used on volumes, each with its own features and limitations.</li></ul></li><li>Management:<ul><li>Volume management often involves tasks like creating, resizing, or deleting volumes.</li><li>File system management includes tasks like formatting, checking for errors, and managing permissions.</li></ul></li><li>Abstraction:<ul><li>The volume provides a level of abstraction between the physical storage (like hard drives or SSDs) and the file system.</li><li>This abstraction allows for features like RAID, where multiple physical devices can appear as a single volume.</li></ul></li><li>Performance and Features:<ul><li>The choice of file system can affect the performance and features available on a volume.</li><li>For example, some file systems support larger file sizes, journaling, or built-in compression.</li></ul></li><li>Multiple File Systems:<ul><li>In some advanced setups, itâ€™s possible to have multiple file systems on a single volume, though this is less common.</li></ul></li><li>Logical Volume Management (LVM):<ul><li>LVM allows for more flexible management of storage, where volumes can be easily resized, and multiple physical devices can be combined into a single logical volume.</li></ul></li><li>Cloud and Virtualization:<ul><li>In cloud and virtualized environments, volumes and file systems are often abstracted further, allowing for easy scaling and management.</li></ul></li></ol><h2 id="mount-vs-bind"><a href="#mount-vs-bind" class="headerlink" title="mount vs bind"></a>mount vs bind</h2><ul><li><p>Mount</p><ul><li><p><strong>Mounting</strong> is the process of making a file system accessible at a certain point in the directory tree.</p></li><li><p>Typically used to attach external storage devices, like USB drives or partitions, to a directory.</p></li><li><p>Example: <code>mount /dev/sdX1 /mnt/mydrive</code></p></li></ul></li><li><p>Bind</p><ul><li><p><strong>Bind mounting</strong> allows you to map a directory to another location in the same file system.</p></li><li><p>This is useful for accessing the same files from multiple locations without duplicating them.</p></li><li><p>Example: <code>mount --bind /source/directory /target/directory</code></p></li></ul></li><li><p>Key Differences</p><ul><li><p><strong>Purpose</strong>: Mount is for attaching entire file systems; bind is for duplicating directory paths.</p></li><li><p><strong>Use Cases</strong>: Mount is common for devices; bind is useful for creating alternative paths to existing directories within the same file system.</p></li></ul></li></ul><p>So, When you bind mount <code>directory1</code> (which is mounted to external file system A) to <code>directory2</code>, you create an alias for <code>directory1</code> at <code>directory2</code>. This means:</p><ul><li>Accessing <code>directory2</code> will show the contents of file system A.</li><li>Any data written to <code>directory2</code> will be stored in file system A, not the local file system.</li></ul><h2 id="hard-link-vs-soft-link"><a href="#hard-link-vs-soft-link" class="headerlink" title="hard link vs soft link"></a>hard link vs soft link</h2><table><thead><tr><th></th><th>Hard Link</th><th>Soft Link (Symbolic Link)</th></tr></thead><tbody><tr><td>Shared storage</td><td>Same file on disk</td><td>Separate file on disk</td></tr><tr><td>Modifying one affects both</td><td>Yes</td><td>No</td></tr><tr><td>Separated copy</td><td>One copy, two names</td><td>Two separate files</td></tr></tbody></table><ul><li><p>Hard links share the same storage location on disk and modify together.</p></li><li><p>Soft links point to an alias or shortcut that does not share the same storage location. Modifying one does not affect the other.</p></li></ul><h2 id="tmpfs"><a href="#tmpfs" class="headerlink" title="tmpfs"></a>tmpfs</h2><ul><li>tmpfs is a special filesystem that uses RAM (and swap) for fast, temporary file storage.</li><li>RAM is the hardware that holds the systemâ€™s active data, while tmpfs is a virtual filesystem that leverages RAM for storage.</li><li>tmpfs is useful for temporary data that doesnâ€™t need to persist after reboots, providing fast I/O performance since itâ€™s in memory.</li></ul><h2 id="nvme"><a href="#nvme" class="headerlink" title="nvme"></a>nvme</h2><p><strong>NVMe (Non-Volatile Memory Express)</strong> is a high-performance storage protocol designed to take full advantage of the speed and efficiency offered by modern solid-state drives (SSDs), particularly those using <strong>NAND flash</strong> or <strong>3D NAND</strong> memory. It was developed to overcome the limitations of older storage protocols (such as SATA and SAS) by optimizing the interaction between the storage device and the CPU over faster interfaces like <strong>PCIe (Peripheral Component Interconnect Express)</strong>.</p><ul><li>NVMe is both a <strong>protocol</strong> and a <strong>standard</strong> for connecting <strong>non-volatile memory</strong> (such as NAND flash memory) directly to a computer system via high-speed interfaces, most commonly <strong>PCIe</strong>. It allows data to be transferred at much faster speeds compared to older storage protocols, enabling devices to reach their full potential and significantly reducing latency.</li></ul><p><strong>nvme vs lvm</strong></p><ul><li><strong>NVMe</strong> is the hardware interface and protocol that provides high-speed storage, primarily used for demanding workloads.</li><li><strong>LVM</strong> is a logical volume manager that allows you to manage storage in a flexible way, and it can be used with <strong>NVMe drives</strong> to create logical volumes, resize them, and add new storage easily.</li></ul><table><thead><tr><th>Feature</th><th>NVMe</th><th>LVM</th></tr></thead><tbody><tr><td><strong>Type</strong></td><td>Storage protocol (hardware level)</td><td>Logical volume management (software layer)</td></tr><tr><td><strong>Main Purpose</strong></td><td>Fast, high-performance storage for SSDs</td><td>Manage storage volumes dynamically</td></tr><tr><td><strong>Speed</strong></td><td>Very high (compared to SATA)</td><td>No direct impact on speed, but provides flexibility</td></tr><tr><td><strong>Flexibility</strong></td><td>Limited to storage capacity and speed</td><td>Highly flexible with resizing and pooling storage</td></tr><tr><td><strong>Management</strong></td><td>Managed directly by the OS or filesystem</td><td>Provides abstraction and dynamic management</td></tr><tr><td><strong>Use Cases</strong></td><td>High-performance workloads, low-latency apps</td><td>Dynamic storage management, snapshots, pooling</td></tr><tr><td><strong>Interaction</strong></td><td>Can be used as a physical storage device for LVM</td><td>Can manage NVMe storage via logical volumes</td></tr><tr><td><strong>Tools</strong></td><td>nvme-cli, lsblk, fdisk, etc.</td><td>lvcreate, vgcreate, pvcreate, etc.</td></tr></tbody></table><h1 id="FUSE"><a href="#FUSE" class="headerlink" title="FUSE"></a>FUSE</h1><blockquote><p>Filesystem in Userspace</p></blockquote><ul><li><p>install</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install fuse fuse-libs</span><br></pre></td></tr></table></figure></li></ul><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> list avaliable disk</span></span><br><span class="line">fdisk -l</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> list nvme (sudo dnf install -y nvme-cli)</span></span><br><span class="line">nvme list</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> list block disk</span></span><br><span class="line">lsblk -l</span><br></pre></td></tr></table></figure><h3 id="Check-Disk-Health"><a href="#Check-Disk-Health" class="headerlink" title="Check Disk Health"></a>Check Disk Health</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep -i &#x27;error&#x27;</span><br></pre></td></tr></table></figure><h3 id="umount"><a href="#umount" class="headerlink" title="umount"></a>umount</h3><ul><li><p>Unmount Using umount -l (Lazy Unmount)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount -l &lt;path/to/mount&gt;</span><br></pre></td></tr></table></figure><p>The -l (lazy) option detaches the filesystem immediately and postpones the actual unmount until itâ€™s no longer in use. This should allow you to unmount the device without needing to terminate the processes that are holding it.</p></li></ul><h2 id="LVM-1"><a href="#LVM-1" class="headerlink" title="LVM"></a>LVM</h2><ul><li><p>æ£€æŸ¥æŒ‡å®švgçš„å¯ç”¨ç©ºé—´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vgdisplay vg_nvme2n1 | grep &quot;Free&quot;</span><br></pre></td></tr></table></figure></li><li><p>delete lvm</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step 1:</span></span><br><span class="line">lsblk</span><br><span class="line">NAME                                                                                                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sr0                                                                                                    11:0    1 1024M  0 rom  </span><br><span class="line">vda                                                                                                   252:0    0  300G  0 disk </span><br><span class="line">â”œâ”€vda1                                                                                                252:1    0    6G  0 part /boot</span><br><span class="line">â””â”€vda2                                                                                                252:2    0  290G  0 part </span><br><span class="line">  â””â”€rl_172--20--7--230-root                                                                           253:0    0  290G  0 lvm  /</span><br><span class="line">vdb                                                                                                   252:16   0  100G  0 disk </span><br><span class="line">â””â”€ceph--d79fdfae--bdd5--4ea7--a907--740181f88091-osd--block--37262a3f--354b--4d6a--95db--eb18abd939ce 253:1    0  100G  0 lvm </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step3:</span></span><br><span class="line">sudo vgchange -an ceph--d79fdfae--bdd5--4ea7--a907--740181f88091-osd--block--37262a3f--354b--4d6a--95db--eb18abd939ce</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step4</span></span><br><span class="line">sudo lvchange -an /dev/ceph-d79fdfae-bdd5-4ea7-a907-740181f88091/osd-block-37262a3f-354b-4d6a-95db-eb18abd939ce</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step5</span></span><br><span class="line">sudo vgremove ceph-d79fdfae-bdd5-4ea7-a907-740181f88091</span><br></pre></td></tr></table></figure><ul><li>create lvm </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1 create vg(volume group)</span></span><br><span class="line">sudo vgcreate s3_vg /dev/vdb</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2 create lv(logic volume)</span></span><br><span class="line">sudo lvcreate -L 50G -n minio_lv s3_vg</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step3 format xfs on lvm</span></span><br><span class="line">sudo mkfs.xfs /dev/s3_vg/minio_lv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step4 create mount point</span></span><br><span class="line">sudo mkdir -p /mnt/minio</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step5 mount logic point</span></span><br><span class="line">sudo mount -o noatime /dev/s3_vg/minio_lv /mnt/minio</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step6 verify</span></span><br><span class="line">df -h /mnt/minio</span><br><span class="line"></span><br><span class="line">Filesystem                  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/s3_vg-minio_lv   50G  389M   50G   1% /mnt/minio</span><br></pre></td></tr></table></figure><ul><li>umount lvm</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1 umount directory</span></span><br><span class="line">sudo umount /mnt/your_mount_point</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2 Deactivate the Logical Volume</span></span><br><span class="line">sudo lvchange -an /dev/volume_group/logical_volume</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step3 Remove the Logical Volume</span></span><br><span class="line">sudo lvremove /dev/volume_group/logical_volume</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (Optional) step4 Remove the Volume Group</span> </span><br><span class="line">sudo vgremove volume_group</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (Optional) step5 Remove the Physical Volume</span></span><br><span class="line">sudo pvremove /dev/sdX</span><br></pre></td></tr></table></figure><ul><li>check</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check vgs</span></span><br><span class="line">sudo vgs</span><br></pre></td></tr></table></figure><h2 id="partition"><a href="#partition" class="headerlink" title="partition"></a>partition</h2><ul><li><p>check specify disk partition</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> method 1</span></span><br><span class="line">sudo parted /dev/&lt;name&gt; print</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method 2</span></span><br><span class="line">sudo fdisk -l /dev/nvme2n1</span><br></pre></td></tr></table></figure></li></ul><h1 id="toubleshooting"><a href="#toubleshooting" class="headerlink" title="toubleshooting"></a>toubleshooting</h1><ul><li><p>resolve <code>d?????????</code> status directory</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">umount -l /path/to/mount</span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span> </span><br><span class="line">fusermount -uz /path/to/mount</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æ’æŸ¥æŒ‡å®šåˆ†åŒºå ç”¨è¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å‡è®¾ /dev/nvme2n1p1 æ˜¯ /dev/nvme2n1 çš„å­åˆ†åŒºï¼Œåœ¨å¯¹/dev/nvme2n1p1æ“ä½œçš„æ—¶å€™ä¼šæç¤º cannot open /dev/nvme2n1p1: Device or resource busyï¼Œè¿™æ—¶å¯ä»¥æ’æŸ¥æ˜¯å¦æ˜¯ä¸»åˆ†åŒºæ˜¯å¦è¢«å ç”¨ï¼Œç„¶å<span class="built_in">kill</span>æ‰ç›¸åº”process</span></span><br><span class="line">sudo lsof | grep /dev/nvme2n1</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> fs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes learn</title>
      <link href="/2024/08/05/Kubernetes%20learn/"/>
      <url>/2024/08/05/Kubernetes%20learn/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>å®¹å™¨æ˜¯ä¸€ä¸ªâ€œå•è¿›ç¨‹â€æ¨¡å‹</strong></p><p>ä¸€ä¸ªâ€œå®¹å™¨â€ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªç”± Linux Namespaceã€Linux Cgroups å’Œ rootfs ä¸‰ç§æŠ€æœ¯æ„å»ºå‡ºæ¥çš„è¿›ç¨‹çš„éš”ç¦»ç¯å¢ƒ</p><p>ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Linux å®¹å™¨ï¼Œå…¶å®å¯ä»¥è¢«â€œä¸€åˆ†ä¸ºäºŒâ€åœ°çœ‹å¾…ï¼š</p><ol><li>ä¸€ç»„è”åˆæŒ‚è½½åœ¨ /var/lib/docker/aufs/mnt ä¸Šçš„ rootfsï¼Œè¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬ç§°ä¸ºâ€œå®¹å™¨é•œåƒâ€ï¼ˆContainer Imageï¼‰ï¼Œæ˜¯å®¹å™¨çš„é™æ€è§†å›¾ï¼›</li><li>ä¸€ä¸ªç”± Namespace+Cgroups æ„æˆçš„éš”ç¦»ç¯å¢ƒï¼Œè¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬ç§°ä¸ºâ€œå®¹å™¨è¿è¡Œæ—¶â€ï¼ˆContainer Runtimeï¼‰ï¼Œæ˜¯å®¹å™¨çš„åŠ¨æ€è§†å›¾ã€‚</li></ol></blockquote><h1 id="version"><a href="#version" class="headerlink" title="version"></a>version</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Client Version: v1.30.3</span><br><span class="line">Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3</span><br><span class="line">Server Version: v1.30.0</span><br></pre></td></tr></table></figure><h1 id="define"><a href="#define" class="headerlink" title="define"></a>define</h1><blockquote><p>å®¹å™¨æœ¬èº«æ²¡æœ‰ä»·å€¼ï¼Œæœ‰ä»·å€¼çš„æ˜¯â€œå®¹å™¨ç¼–æ’â€ã€‚</p></blockquote><p>Kubernetes is pronouncedÂ <strong>coo-ber-net-ees</strong>, not coo-ber-neats. People also use the shortened version k8s a lot. Please donâ€™t pronounce that one k-eightsâ€”it is still coo-ber-net-ees.</p><blockquote><p>Docker is a containerization platform, and Kubernetes is a container orchestrator for container platforms like Docker.Â </p></blockquote><h2 id="architecture"><a href="#architecture" class="headerlink" title="architecture"></a>architecture</h2><p>We can break down the components into three main parts.</p><ol><li>The Control Plane - The Master.</li><li>Nodes - Where pods get scheduled.</li><li>Pods - Holds containers.</li></ol><p><img src="/images/k8s/k8s-architecture-overview.png"></p><blockquote><p>kubernetesè®¾è®¡æ€æƒ³<strong>â€œä¸€åˆ‡çš†å¯¹è±¡â€</strong>ï¼šåº”ç”¨æ˜¯ Pod å¯¹è±¡ï¼Œåº”ç”¨çš„é…ç½®æ˜¯ ConfigMap å¯¹è±¡ï¼Œåº”ç”¨è¦è®¿é—®çš„å¯†ç åˆ™æ˜¯ Secret å¯¹è±¡ã€‚</p><p><strong>å£°æ˜å¼ APIï¼Œæ˜¯ Kubernetes é¡¹ç›®ç¼–æ’èƒ½åŠ›â€œèµ–ä»¥ç”Ÿå­˜â€çš„æ ¸å¿ƒæ‰€åœ¨</strong></p></blockquote><h2 id="dependency"><a href="#dependency" class="headerlink" title="dependency"></a>dependency</h2><blockquote><p>Namespace åšéš”ç¦»ï¼ŒCgroups åšé™åˆ¶ï¼Œrootfs åšæ–‡ä»¶ç³»ç»Ÿ</p><p>å¯¹ å®¹å™¨é¡¹ç›®æ¥è¯´ï¼Œæœ€æ ¸å¿ƒçš„åŸç†å®é™…ä¸Šå°±æ˜¯ä¸ºå¾…åˆ›å»ºçš„ç”¨æˆ·è¿›ç¨‹ï¼š</p><ol><li>å¯ç”¨ Linux Namespace é…ç½®ï¼›</li><li>è®¾ç½®æŒ‡å®šçš„ Cgroups å‚æ•°ï¼›</li><li>åˆ‡æ¢è¿›ç¨‹çš„æ ¹ç›®å½•ï¼ˆChange Rootï¼‰ã€‚</li></ol></blockquote><h3 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h3><blockquote><p> Linux æ“ä½œç³»ç»Ÿæä¾›äº†PIDã€ Mountã€UTSã€IPCã€Network å’Œ User è¿™äº› Namespaceï¼Œç”¨æ¥å¯¹å„ç§ä¸åŒçš„è¿›ç¨‹ä¸Šä¸‹æ–‡è¿›è¡Œâ€œéšœçœ¼æ³•â€æ“ä½œ</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PID Namespaceï¼šéš”ç¦»è¿›ç¨‹ IDã€‚</span><br><span class="line">Network Namespaceï¼šéš”ç¦»ç½‘ç»œè®¾å¤‡ã€ç½‘ç»œæ ˆã€ç«¯å£ç­‰ç½‘ç»œèµ„æºã€‚</span><br><span class="line">Mount Namespaceï¼šéš”ç¦»æŒ‚è½½ç‚¹ã€‚</span><br><span class="line">IPC Namespaceï¼šéš”ç¦»è¿›ç¨‹é—´é€šä¿¡èµ„æºï¼Œå¦‚ä¿¡å·é‡ç­‰ã€‚</span><br><span class="line">UTS Namespaceï¼šéš”ç¦»ä¸»æœºåå’ŒåŸŸåã€‚</span><br><span class="line">User Namespaceï¼šéš”ç¦»ç”¨æˆ·å’Œç”¨æˆ·ç»„ IDã€‚</span><br></pre></td></tr></table></figure><ul><li><p>å®¹å™¨å¸®åŠ©ç”¨æˆ·å¯åŠ¨çš„ï¼Œè¿˜æ˜¯åŸæ¥çš„åº”ç”¨è¿›ç¨‹ï¼Œåªä¸è¿‡åœ¨åˆ›å»ºè¿™äº›è¿›ç¨‹æ—¶ï¼Œå®¹å™¨ä¸ºå®ƒä»¬åŠ ä¸Šäº†å„ç§å„æ ·çš„ Namespace å‚æ•°ã€‚è¿›ç¨‹å°±ä¼šè§‰å¾—è‡ªå·±æ˜¯å„è‡ª PID Namespace é‡Œçš„ç¬¬ 1 å·è¿›ç¨‹ï¼Œåªèƒ½çœ‹åˆ°å„è‡ª Mount Namespace é‡ŒæŒ‚è½½çš„ç›®å½•å’Œæ–‡ä»¶ï¼Œåªèƒ½è®¿é—®åˆ°å„è‡ª Network Namespace é‡Œçš„ç½‘ç»œè®¾å¤‡ï¼Œå°±ä»¿ä½›è¿è¡Œåœ¨ä¸€ä¸ªä¸ªâ€œå®¹å™¨â€é‡Œé¢ï¼Œä¸ä¸–éš”ç»</p></li><li><p>åœ¨ Linux å†…æ ¸ä¸­ï¼Œæœ‰å¾ˆå¤šèµ„æºå’Œå¯¹è±¡æ˜¯ä¸èƒ½è¢« Namespace åŒ–çš„ï¼Œæœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯ï¼šæ—¶é—´</p></li><li><p>Linux Namespace ä¸º Kubernetes Namespace æä¾›äº†åº•å±‚çš„éš”ç¦»èƒ½åŠ›ï¼ŒKubernetes Namespace åˆ™æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ›´é«˜çº§åˆ«çš„æŠ½è±¡å’Œç®¡ç†ã€‚</p></li></ul><h4 id="mount-namesapce"><a href="#mount-namesapce" class="headerlink" title="mount namesapce"></a>mount namesapce</h4><ul><li>Mount Namespace è·Ÿå…¶ä»– Namespace çš„ä½¿ç”¨ç•¥æœ‰ä¸åŒçš„åœ°æ–¹ï¼šå®ƒå¯¹å®¹å™¨è¿›ç¨‹è§†å›¾çš„æ”¹å˜ï¼Œä¸€å®šæ˜¯ä¼´éšç€æŒ‚è½½æ“ä½œï¼ˆmountï¼‰æ‰èƒ½ç”Ÿæ•ˆã€‚</li><li>Mount Namespace æ­£æ˜¯åŸºäºå¯¹ chroot çš„ä¸æ–­æ”¹è‰¯æ‰è¢«å‘æ˜å‡ºæ¥çš„ï¼Œå®ƒä¹Ÿæ˜¯ Linux æ“ä½œç³»ç»Ÿé‡Œçš„ç¬¬ä¸€ä¸ª Namespace</li></ul><h3 id="cgoups"><a href="#cgoups" class="headerlink" title="cgoups"></a>cgoups</h3><blockquote><p> <strong>Linux Cgroups çš„å…¨ç§°æ˜¯ Linux Control Groupã€‚å®ƒæœ€ä¸»è¦çš„ä½œç”¨ï¼Œå°±æ˜¯é™åˆ¶ä¸€ä¸ªè¿›ç¨‹ç»„èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ŒåŒ…æ‹¬ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå¸¦å®½ç­‰ç­‰ã€‚</strong></p></blockquote><ul><li>Cgroups ç»™ç”¨æˆ·æš´éœ²å‡ºæ¥çš„æ“ä½œæ¥å£æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œå³å®ƒä»¥æ–‡ä»¶å’Œç›®å½•çš„æ–¹å¼ç»„ç»‡åœ¨æ“ä½œç³»ç»Ÿçš„ <code>/sys/fs/cgroup</code> è·¯å¾„ä¸‹</li><li>Linux Cgroups çš„è®¾è®¡è¿˜æ˜¯æ¯”è¾ƒæ˜“ç”¨çš„ï¼Œç®€å•ç²—æš´åœ°ç†è§£å®ƒå°±æ˜¯ä¸€ä¸ªå­ç³»ç»Ÿç›®å½•åŠ ä¸Šä¸€ç»„èµ„æºé™åˆ¶æ–‡ä»¶çš„ç»„åˆ</li><li>Cgroups æŠ€æœ¯æ˜¯ç”¨æ¥åˆ¶é€ çº¦æŸçš„ä¸»è¦æ‰‹æ®µï¼Œè€ŒNamespace æŠ€æœ¯åˆ™æ˜¯ç”¨æ¥ä¿®æ”¹è¿›ç¨‹è§†å›¾çš„ä¸»è¦æ–¹æ³•</li></ul><h3 id="rootfs"><a href="#rootfs" class="headerlink" title="rootfs"></a>rootfs</h3><blockquote><p>Rootfs(æ ¹æ–‡ä»¶ç³»ç»Ÿ) å®ƒåªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶ä¸åŒ…å«å†…æ ¸ï¼Œæœ€å¤šä¹Ÿå°±å‡ ç™¾å…†</p><p>å®¹å™¨é€šè¿‡ Mount Namespace å•ç‹¬æŒ‚è½½å…¶ä»–ä¸åŒç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿæ–‡ä»¶</p><p><strong>rootfs åªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ‰€åŒ…å«çš„æ–‡ä»¶ã€é…ç½®å’Œç›®å½•ï¼Œå¹¶ä¸åŒ…æ‹¬æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚</strong></p></blockquote><ul><li><p>æŒ‚è½½åœ¨å®¹å™¨æ ¹ç›®å½•ä¸Š, ä¸ºå®¹å™¨è¿›ç¨‹æä¾›éš”ç¦»åæ‰§è¡Œç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå°±æ˜¯æ‰€è°“çš„â€œå®¹å™¨é•œåƒâ€ã€‚</p></li><li><p>å®¹å™¨åªæ˜¯è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆå¤šä¸ªå®¹å™¨ä¹‹é—´ä½¿ç”¨çš„å°±è¿˜æ˜¯åŒä¸€ä¸ªå®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸</p></li></ul><h2 id="CRI"><a href="#CRI" class="headerlink" title="CRI"></a>CRI</h2><blockquote><p><strong>Container Runtime Interface</strong> å®¹å™¨è¿è¡Œæ—¶æ¥å£</p><p>kubelet è°ƒç”¨ä¸‹å±‚å®¹å™¨è¿è¡Œæ—¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¹¶ä¸ä¼šç›´æ¥è°ƒç”¨ Docker çš„ APIï¼Œè€Œæ˜¯é€šè¿‡CRIçš„ gRPC æ¥å£æ¥é—´æ¥æ‰§è¡Œ</p></blockquote><h3 id="ctr"><a href="#ctr" class="headerlink" title="ctr"></a>ctr</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check ctr images on k8s</span></span><br><span class="line">sudo ctr -n k8s.io images list | grep &#123;image&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete ctr images on k8s</span></span><br><span class="line">sudo ctr -n k8s.io images rm &#123;image&#125;:&#123;tag&#125;</span><br></pre></td></tr></table></figure><h1 id="API-object"><a href="#API-object" class="headerlink" title="API object"></a>API object</h1><blockquote><p>Kubernetes API å¯¹è±¡ï¼Œç”±å…ƒæ•°æ® metadataã€è§„èŒƒ spec å’ŒçŠ¶æ€ statusç»„æˆ</p><p>å…ƒæ•°æ®æ˜¯ç”¨æ¥æ ‡è¯† API å¯¹è±¡çš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½è‡³å°‘æœ‰ 3 ä¸ªå…ƒæ•°æ®ï¼šnamespaceï¼Œname å’Œ uid</p></blockquote><ul><li>è·¯å¾„</li></ul><p>åœ¨ Kubernetes é¡¹ç›®ä¸­ï¼Œä¸€ä¸ª API å¯¹è±¡åœ¨ Etcd é‡Œçš„å®Œæ•´èµ„æºè·¯å¾„ï¼Œæ˜¯ç”±ï¼šGroupï¼ˆAPI ç»„ï¼‰ã€Versionï¼ˆAPI ç‰ˆæœ¬ï¼‰å’Œ Resourceï¼ˆAPI èµ„æºç±»å‹ï¼‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># â€œCronJobâ€å°±æ˜¯è¿™ä¸ª API å¯¹è±¡çš„èµ„æºç±»å‹ï¼ˆResourceï¼‰ï¼Œâ€œbatchâ€å°±æ˜¯å®ƒçš„ç»„ï¼ˆGroupï¼‰ï¼Œv2alpha1 å°±æ˜¯å®ƒçš„ç‰ˆæœ¬ï¼ˆVersionï¼‰ã€‚</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v2alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><blockquote><p>ç®¡ç† é•¿æœŸä¼ºæœå‹ï¼ˆlong-runningï¼‰ä¸šåŠ¡</p></blockquote><table><thead><tr><th>Aspect</th><th>Pod</th><th>Deployment</th></tr></thead><tbody><tr><td><strong>Definition</strong></td><td>The smallest deployable unit, containing one or more containers.</td><td>A higher-level abstraction to manage Pods and ReplicaSets.</td></tr><tr><td><strong>Purpose</strong></td><td>Represents a single instance of a running application.</td><td>Manages Pods by defining scaling, updates, and desired state.</td></tr><tr><td><strong>Ephemerality</strong></td><td>Ephemeral: Once a Pod dies, it is not automatically replaced.</td><td>Resilient: Automatically replaces Pods as needed.</td></tr><tr><td><strong>Scaling</strong></td><td>Requires manual intervention to scale.</td><td>Can define a desired number of replicas for automatic scaling.</td></tr><tr><td><strong>Rolling Updates</strong></td><td>No built-in support for rolling updates.</td><td>Supports rolling updates and rollbacks for live changes.</td></tr><tr><td><strong>Use Case</strong></td><td>Suitable for testing or single-instance workloads.</td><td>Suitable for production workloads requiring scalability and availability.</td></tr></tbody></table><h2 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h2><blockquote><p>Kubernetes é‡Œâ€œæœ€å°â€çš„ API å¯¹è±¡æ˜¯ Podã€‚Pod å¯ä»¥ç­‰ä»·ä¸ºä¸€ä¸ªåº”ç”¨ï¼Œæ‰€ä»¥ï¼ŒPod å¯ä»¥ç”±å¤šä¸ªç´§å¯†åä½œçš„å®¹å™¨ç»„æˆ</p><p><strong>Pod å°±æ˜¯ Kubernetes ä¸–ç•Œé‡Œçš„â€œåº”ç”¨â€ï¼›è€Œä¸€ä¸ªåº”ç”¨ï¼Œå¯ä»¥ç”±å¤šä¸ªå®¹å™¨ç»„æˆ</strong></p><p>Podï¼Œå…¶å®æ˜¯ä¸€ç»„å…±äº«äº†æŸäº›èµ„æºçš„å®¹å™¨</p><p><strong>å‡¡æ˜¯è°ƒåº¦ã€ç½‘ç»œã€å­˜å‚¨ï¼Œä»¥åŠå®‰å…¨ç›¸å…³çš„å±æ€§ï¼ŒåŸºæœ¬ä¸Šæ˜¯ Pod çº§åˆ«çš„</strong>ï¼›</p><p><strong>å‡¡æ˜¯è·Ÿå®¹å™¨çš„ Linux Namespace ç›¸å…³çš„å±æ€§ï¼Œä¹Ÿä¸€å®šæ˜¯ Pod çº§åˆ«çš„</strong></p><p><strong>å‡¡æ˜¯ Pod ä¸­çš„å®¹å™¨è¦å…±äº«å®¿ä¸»æœºçš„ Namespaceï¼Œä¹Ÿä¸€å®šæ˜¯ Pod çº§åˆ«çš„å®šä¹‰</strong></p><p><strong>Pod é‡Œçš„æ‰€æœ‰å®¹å™¨ï¼Œå…±äº«çš„æ˜¯åŒä¸€ä¸ª Network Namespaceï¼Œå¹¶ä¸”å¯ä»¥å£°æ˜å…±äº«åŒä¸€ä¸ª Volume</strong></p><p>Pod å¯ä»¥è¢«çœ‹æˆä¼ ç»Ÿç¯å¢ƒé‡Œçš„â€œæœºå™¨â€ã€æŠŠå®¹å™¨çœ‹ä½œæ˜¯è¿è¡Œåœ¨è¿™ä¸ªâ€œæœºå™¨â€é‡Œçš„â€œç”¨æˆ·ç¨‹åºâ€</p><p>å®¹å™¨ï¼Œå°±æ˜¯æœªæ¥äº‘è®¡ç®—ç³»ç»Ÿä¸­çš„è¿›ç¨‹ï¼›å®¹å™¨é•œåƒå°±æ˜¯è¿™ä¸ªç³»ç»Ÿé‡Œçš„â€œ.exeâ€å®‰è£…åŒ…</p></blockquote><ul><li>æ¯ä¸ª Pod éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ IP åœ°å€ã€‚Pod ä¸­çš„æ‰€æœ‰å®¹å™¨å…±äº«ç½‘ç»œç©ºé—´ï¼ŒåŒ…æ‹¬ IP åœ°å€å’Œç«¯å£ã€‚Pod å†…éƒ¨çš„å®¹å™¨å¯ä»¥ä½¿ç”¨ <code>localhost</code> äº’ç›¸é€šä¿¡ã€‚Pod ä¸­çš„å®¹å™¨ä¸å¤–ç•Œé€šä¿¡æ—¶ï¼Œå¿…é¡»åˆ†é…å…±äº«ç½‘ç»œèµ„æºï¼ˆä¾‹å¦‚ä½¿ç”¨å®¿ä¸»æœºçš„ç«¯å£æ˜ å°„ï¼‰ã€‚</li><li>å¯ä»¥ä¸ºä¸€ä¸ª Pod æŒ‡å®šå¤šä¸ªå…±äº«çš„ Volumeã€‚Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥è®¿é—®å…±äº«çš„ volumeã€‚Volume ä¹Ÿå¯ä»¥ç”¨æ¥æŒä¹…åŒ– Pod ä¸­çš„å­˜å‚¨èµ„æºï¼Œä»¥é˜²å®¹å™¨é‡å¯åæ–‡ä»¶ä¸¢å¤±ã€‚</li></ul><h2 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h2><blockquote><p>ç®¡ç† èŠ‚ç‚¹åå°æ”¯æ’‘å‹ï¼ˆnode-daemonï¼‰ä¸šåŠ¡</p></blockquote><ol><li>è¿™ä¸ª Pod è¿è¡Œåœ¨ Kubernetes é›†ç¾¤é‡Œçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ä¸Šï¼›</li><li>æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªè¿™æ ·çš„ Pod å®ä¾‹ï¼›</li><li>å½“æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ Kubernetes é›†ç¾¤åï¼Œè¯¥ Pod ä¼šè‡ªåŠ¨åœ°åœ¨æ–°èŠ‚ç‚¹ä¸Šè¢«åˆ›å»ºå‡ºæ¥ï¼›è€Œå½“æ—§èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®ƒä¸Šé¢çš„ Pod ä¹Ÿç›¸åº”åœ°ä¼šè¢«å›æ”¶æ‰ã€‚</li></ol><h2 id="job"><a href="#job" class="headerlink" title="job"></a>job</h2><blockquote><p>ç®¡ç† æ‰¹å¤„ç†å‹ï¼ˆbatchï¼‰ä¸šåŠ¡</p></blockquote><h2 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a>StatefulSet</h2><blockquote><p>ç®¡ç† æœ‰çŠ¶æ€åº”ç”¨å‹ï¼ˆstateful applicationï¼‰ä¸šåŠ¡</p><p>StatefulSet çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡æŸç§æ–¹å¼è®°å½•è¿™äº›çŠ¶æ€ï¼Œç„¶ååœ¨ Pod è¢«é‡æ–°åˆ›å»ºæ—¶ï¼Œèƒ½å¤Ÿä¸ºæ–° Pod æ¢å¤è¿™äº›çŠ¶æ€</p></blockquote><ul><li><p>æ‹“æ‰‘çŠ¶æ€</p><ul><li><p>Headless Service</p><blockquote><p>é€šè¿‡ Headless Service çš„æ–¹å¼ï¼ŒStatefulSet ä¸ºæ¯ä¸ª Pod åˆ›å»ºäº†ä¸€ä¸ªå›ºå®šå¹¶ä¸”ç¨³å®šçš„ DNS è®°å½•ï¼Œæ¥ä½œä¸ºå®ƒçš„è®¿é—®å…¥å£ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;pod-name&gt;.&lt;svc-name&gt;.&lt;namespace&gt;.svc.cluster.local</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li>å­˜å‚¨çŠ¶æ€</li></ul><blockquote><p>Kubernetes ä¸­ PVC å’Œ PV çš„è®¾è®¡ï¼Œ<strong>å®é™…ä¸Šç±»ä¼¼äºâ€œæ¥å£â€å’Œâ€œå®ç°â€çš„æ€æƒ³</strong>ã€‚</p></blockquote><p><strong>Persistent Volume Claim(PVC)</strong></p><p><strong>persistent Volume(PV)</strong></p><h3 id="lifecycle-hook"><a href="#lifecycle-hook" class="headerlink" title="(lifecycle) hook"></a>(lifecycle) hook</h3><ul><li>PostStart</li><li>PreStop</li></ul><blockquote><p>Hook Handlers: Exec and HTTP</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">lifecycle:</span></span><br><span class="line">      <span class="attr">postStart:</span></span><br><span class="line">        <span class="attr">exec:</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;PostStart hook&#x27; &gt; /usr/share/message&quot;</span>]</span><br><span class="line">      <span class="attr">preStop:</span></span><br><span class="line">        <span class="attr">httpGet:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/shutdown</span></span><br><span class="line">          <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><h3 id="bootstram-command"><a href="#bootstram-command" class="headerlink" title="bootstram command"></a>bootstram command</h3><p><code>sh -c</code> allows running multiple commands in a single shell</p><p><code>exec</code> ensures the mount process becomes the main process of the container</p><p>e.g.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">containers:</span><br><span class="line">- name: juicefs-mount</span><br><span class="line">  command: </span><br><span class="line">    - sh</span><br><span class="line">    - -c</span><br><span class="line">    - |</span><br><span class="line">      /usr/local/bin/juicefs format ... </span><br><span class="line">      exec /bin/mount.juicefs ...</span><br></pre></td></tr></table></figure><h2 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h2><ul><li><p>create</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic user --from-file=./username.txt</span><br></pre></td></tr></table></figure></li><li><p>check</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secrets</span><br></pre></td></tr></table></figure></li></ul><h2 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h2><ul><li><p>create</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap ui-config --from-file=example/ui.properties</span><br></pre></td></tr></table></figure></li><li><p>delete</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete configmap &lt;name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure></li><li><p>get yaml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get configmaps ui-config -o yaml</span><br></pre></td></tr></table></figure></li></ul><h2 id="CronJob"><a href="#CronJob" class="headerlink" title="CronJob"></a>CronJob</h2><h2 id="infra-container-pause-container"><a href="#infra-container-pause-container" class="headerlink" title="infra container (pause container)"></a>infra container (pause container)</h2><blockquote><p>åœ¨ Kubernetes é¡¹ç›®é‡Œï¼ŒPod çš„å®ç°éœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸­é—´å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨å«ä½œ Infra å®¹å™¨ã€‚åœ¨è¿™ä¸ª Pod ä¸­ï¼ŒInfra å®¹å™¨æ°¸è¿œéƒ½æ˜¯ç¬¬ä¸€ä¸ªè¢«åˆ›å»ºçš„å®¹å™¨ï¼Œè€Œå…¶ä»–ç”¨æˆ·å®šä¹‰çš„å®¹å™¨ï¼Œåˆ™é€šè¿‡ Join Network Namespace çš„æ–¹å¼ï¼Œä¸ Infra å®¹å™¨å…³è”åœ¨ä¸€èµ·ã€‚</p><p>åœ¨ Kubernetes é¡¹ç›®é‡Œï¼ŒInfra å®¹å™¨ä¸€å®šè¦å ç”¨æå°‘çš„èµ„æºï¼Œæ‰€ä»¥å®ƒä½¿ç”¨çš„æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„é•œåƒï¼Œå«ä½œï¼š<code>k8s.gcr.io/pause</code>ã€‚è¿™ä¸ªé•œåƒæ˜¯ä¸€ä¸ªç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ã€æ°¸è¿œå¤„äºâ€œæš‚åœâ€çŠ¶æ€çš„å®¹å™¨ï¼Œè§£å‹åçš„å¤§å°ä¹Ÿåªæœ‰ 100~200 KB å·¦å³ã€‚</p></blockquote><ul><li>infra container è´Ÿè´£è¿è¡Œç½‘ç»œå’Œ IPC å‘½åç©ºé—´çš„åˆå§‹åŒ–ä»»åŠ¡ï¼Œä»¥åŠä¸º Pod ä¸­çš„å…¶ä»–å®¹å™¨æä¾›å…±äº«çš„ç½‘ç»œå’Œ IPC (Inter-Process Communication)ç¯å¢ƒ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Maintains pod network namespace and keeps pod alive</span><br><span class="line">Also known as the &quot;pause container&quot;</span><br><span class="line">Automatically created for every pod</span><br><span class="line">Holds the network namespace for the pod</span><br><span class="line">Keeps the pod running</span><br><span class="line">Uses minimal resources</span><br><span class="line">Not visible in pod specifications</span><br><span class="line">Runs for the entire lifecycle of the pod</span><br></pre></td></tr></table></figure><h2 id="stragety"><a href="#stragety" class="headerlink" title="stragety"></a>stragety</h2><ul><li><p><strong>ImagePullPolicy</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Always Never IfNotPresent</span><br></pre></td></tr></table></figure></li><li><p><strong>Lifecycle</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postStart preStop</span><br></pre></td></tr></table></figure></li><li><p><strong>restartPolicy</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Alwaysï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å®¹å™¨ä¸åœ¨è¿è¡ŒçŠ¶æ€ï¼Œå°±è‡ªåŠ¨é‡å¯å®¹å™¨ï¼›</span><br><span class="line">OnFailure: åªåœ¨å®¹å™¨å¼‚å¸¸æ—¶æ‰è‡ªåŠ¨é‡å¯å®¹å™¨ï¼›</span><br><span class="line">Never: ä»æ¥ä¸é‡å¯å®¹å™¨ã€‚</span><br></pre></td></tr></table></figure></li><li><p><strong>PodPreset</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PodPreset é‡Œå®šä¹‰çš„å†…å®¹ï¼Œåªä¼šåœ¨ Pod API å¯¹è±¡è¢«åˆ›å»ºä¹‹å‰è¿½åŠ åœ¨è¿™ä¸ªå¯¹è±¡æœ¬èº«ä¸Šï¼Œè€Œä¸ä¼šå½±å“ä»»ä½• Pod çš„æ§åˆ¶å™¨çš„å®šä¹‰</span><br></pre></td></tr></table></figure></li><li><p><strong>Status</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pending running succeeded failed upknown</span><br></pre></td></tr></table></figure></li></ul><h2 id="Volume"><a href="#Volume" class="headerlink" title="Volume"></a>Volume</h2><blockquote><p>æ‰€è°“å®¹å™¨çš„ Volumeï¼Œå…¶å®å°±æ˜¯å°†ä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œè·Ÿä¸€ä¸ªå®¹å™¨é‡Œçš„ç›®å½•ç»‘å®šæŒ‚è½½åœ¨äº†ä¸€èµ·</p><p>æ‰€è°“çš„â€œæŒä¹…åŒ– Volumeâ€ï¼ŒæŒ‡çš„å°±æ˜¯è¿™ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œå…·å¤‡â€œæŒä¹…æ€§â€ã€‚å³è¿™ä¸ªç›®å½•é‡Œé¢çš„å†…å®¹ï¼Œæ—¢ä¸ä¼šå› ä¸ºå®¹å™¨çš„åˆ é™¤è€Œè¢«æ¸…ç†æ‰ï¼Œä¹Ÿä¸ä¼šè·Ÿå½“å‰çš„å®¿ä¸»æœºç»‘å®šã€‚</p></blockquote><p><strong>â€œæŒä¹…åŒ–â€å®¿ä¸»æœºç›®å½•çš„è¿‡ç¨‹ï¼Œå¯ä»¥å½¢è±¡åœ°ç§°ä¸ºâ€œä¸¤é˜¶æ®µå¤„ç†â€</strong></p><ul><li>ç¬¬ä¸€é˜¶æ®µ Attachï¼šè™šæ‹ŸæœºæŒ‚è½½è¿œç¨‹ç£ç›˜çš„æ“ä½œ</li><li>ç¬¬äºŒé˜¶æ®µ Mountï¼šå°†ç£ç›˜è®¾å¤‡æ ¼å¼åŒ–å¹¶æŒ‚è½½åˆ° Volume å®¿ä¸»æœºç›®å½•çš„æ“ä½œ</li></ul><h3 id="StorageClass"><a href="#StorageClass" class="headerlink" title="StorageClass"></a>StorageClass</h3><blockquote><p><strong>StorageClass</strong> defines the provisioner and parameters for dynamic storage provisioning.</p><p>a <strong>StorageClass</strong> is a <strong>global resource</strong> and is <strong>not limited to a specific namespace</strong>. It can be used by any pod across all namespaces in the cluster.</p></blockquote><ul><li><p>å®šä¹‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€ï¼ŒPV çš„å±æ€§ã€‚æ¯”å¦‚ï¼Œå­˜å‚¨ç±»å‹ã€Volume çš„å¤§å°ç­‰ç­‰ã€‚</span><br><span class="line">ç¬¬äºŒï¼Œåˆ›å»ºè¿™ç§ PV éœ€è¦ç”¨åˆ°çš„å­˜å‚¨æ’ä»¶ã€‚æ¯”å¦‚ï¼ŒCeph ç­‰ç­‰ã€‚</span><br></pre></td></tr></table></figure></li><li><p>å……å½“ PV çš„æ¨¡æ¿ã€‚å¹¶ä¸”ï¼Œåªæœ‰åŒå±äºä¸€ä¸ª StorageClass çš„ PV å’Œ PVCï¼Œæ‰å¯ä»¥ç»‘å®šåœ¨ä¸€èµ·</p></li></ul><h3 id="PVC"><a href="#PVC" class="headerlink" title="PVC"></a>PVC</h3><blockquote><p><strong>PersistentVolumeClaim (PVC)</strong> requests storage and can specify a StorageClass to trigger the dynamic creation of a PersistentVolume.</p><p>The <strong>PVC size</strong> controls how much storage is made available to a pod, and <strong>all of that storage</strong> is accessible to the pod.</p><p>There is <strong>no way to further subdivide the storage provided to a pod</strong> by the PVC. Once the PVC is created, all storage allocated by it is available to the pod.</p></blockquote><ul><li><strong>PVCs are namespace-scoped</strong>: PVCs are created within a specific namespace and request storage from available PVs or a StorageClass.</li></ul><h3 id="PV"><a href="#PV" class="headerlink" title="PV"></a>PV</h3><blockquote><p><strong>PersistentVolume (PV)</strong> is either dynamically created based on the PVCâ€™s request or manually created and bound to a PVC.</p><p>so PV cannot directly use a StorageClass for dynamic provisioning util a PVC to trigger the provisioning process.</p><p>in other words, <strong>PVs are either statically provisioned</strong> (manually created) or <strong>dynamically provisioned via a PVC</strong>.</p><p>so Even if you manually create a PV, it wonâ€™t be useful until a <strong>PVC binds to it</strong>.</p></blockquote><ul><li><strong>PVs are global resources</strong>: They can be used across namespaces.</li></ul><h3 id="provision"><a href="#provision" class="headerlink" title="provision"></a>provision</h3><ul><li><strong>static provisioning</strong>, the relationship between a PersistentVolume (PV) and a PersistentVolumeClaim (PVC) is strictly <strong>1:1</strong> at any given time.</li></ul><h2 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h2><blockquote><p>Role-Based Access Control</p><p>reference <a href="https://www.willshirley.top/2025/03/01/kubernetes%20RBAC/">Kubernetes RBAC</a></p></blockquote><h2 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h2><blockquote><p>Operator çš„å·¥ä½œåŸç†ï¼Œå®é™…ä¸Šæ˜¯åˆ©ç”¨äº† Kubernetes çš„è‡ªå®šä¹‰ API èµ„æºï¼ˆ<a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/extend-api-custom-resource-definitions">custom resource definitions (CRDs)</a>ï¼‰ï¼Œæ¥æè¿°æˆ‘ä»¬æƒ³è¦éƒ¨ç½²çš„â€œæœ‰çŠ¶æ€åº”ç”¨â€ï¼›ç„¶ååœ¨è‡ªå®šä¹‰æ§åˆ¶å™¨é‡Œï¼Œæ ¹æ®è‡ªå®šä¹‰ API å¯¹è±¡çš„å˜åŒ–ï¼Œæ¥å®Œæˆå…·ä½“çš„éƒ¨ç½²å’Œè¿ç»´å·¥ä½œ</p><p>In other words, Operators are software extensions that use custom resources to manage applications and their components</p></blockquote><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><blockquote><p><em>Controller is just some logic about something that it is supposed to be managed and is usually visualised as an observe and adjust loop.</em></p><p><em>Observe the current state, compare it to the desired state and adjust the state</em></p></blockquote><h3 id="custom-resource-CR"><a href="#custom-resource-CR" class="headerlink" title="custom resource(CR)"></a>custom resource(CR)</h3><h3 id="state"><a href="#state" class="headerlink" title="state"></a>state</h3><blockquote><p><em>The state just holds the information of what the desired state of the resource is and the resource is the thing that you are managing.</em></p></blockquote><h3 id="Operator-vs-Deployment"><a href="#Operator-vs-Deployment" class="headerlink" title="Operator vs Deployment"></a>Operator vs Deployment</h3><table><thead><tr><th><strong>Feature</strong></th><th><strong>Operator</strong></th><th><strong>Deployment</strong></th></tr></thead><tbody><tr><td><strong>Definition</strong></td><td>A Kubernetes <strong>Operator</strong> automates the lifecycle of an application, handling deployment, upgrades, scaling, and failure recovery.</td><td>A <strong>Deployment</strong> is a Kubernetes object that manages a set of <strong>pods</strong> with defined scaling and update strategies.</td></tr><tr><td><strong>Automation Level</strong></td><td><strong>High</strong>: Operators provide full lifecycle automation.</td><td><strong>Basic</strong>: Deployments only handle pod management and scaling.</td></tr><tr><td><strong>Custom Resource (CRD)</strong></td><td>Uses <strong>Custom Resource Definitions (CRDs)</strong> to extend Kubernetes functionality.</td><td>Uses <strong>built-in resources</strong> like Deployment, Service, ReplicaSet.</td></tr><tr><td><strong>Scaling</strong></td><td>Can provide <strong>intelligent auto-scaling</strong> based on workload behavior.</td><td>Relies on <strong>Horizontal Pod Autoscaler (HPA)</strong> or manual scaling.</td></tr><tr><td><strong>Upgrade Handling</strong></td><td>Handles <strong>zero-downtime upgrades</strong> with rollback capabilities.</td><td>Uses RollingUpdate or Recreate strategies.</td></tr><tr><td><strong>Failure Recovery</strong></td><td>Can detect failures and take automated corrective actions.</td><td>Relies on Kubernetes itself to restart pods.</td></tr><tr><td><strong>Complexity</strong></td><td>More complex, requires coding and maintaining an Operator.</td><td>Simpler, uses YAML definitions.</td></tr></tbody></table><ul><li><p><strong>Operators use Deployments internally</strong> to manage application workloads.</p></li><li><p>A <strong>Deployment only manages pods</strong>, but an <strong>Operator enhances this by managing the entire application lifecycle</strong>.</p></li><li><p>Operators <strong>create, update, and delete Deployments</strong> dynamically based on defined logic.</p></li></ul><h2 id="CNI"><a href="#CNI" class="headerlink" title="CNI"></a>CNI</h2><p>TBD</p><h1 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h1><ul><li><p>è¿‡å»å¾ˆå¤šçš„é›†ç¾¤ç®¡ç†é¡¹ç›®ï¼ˆæ¯”å¦‚ Yarnã€Mesosï¼Œä»¥åŠ Swarmï¼‰æ‰€æ“…é•¿çš„ï¼Œéƒ½æ˜¯æŠŠä¸€ä¸ªå®¹å™¨ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™ï¼Œæ”¾ç½®åœ¨æŸä¸ªæœ€ä½³èŠ‚ç‚¹ä¸Šè¿è¡Œèµ·æ¥ã€‚è¿™ç§åŠŸèƒ½ï¼Œæˆ‘ä»¬ç§°ä¸ºâ€œè°ƒåº¦â€ã€‚</p><p>è€Œ Kubernetes é¡¹ç›®æ‰€æ“…é•¿çš„ï¼Œæ˜¯æŒ‰ç…§ç”¨æˆ·çš„æ„æ„¿å’Œæ•´ä¸ªç³»ç»Ÿçš„è§„åˆ™ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–åœ°å¤„ç†å¥½å®¹å™¨ä¹‹é—´çš„å„ç§å…³ç³»ã€‚<strong>è¿™ç§åŠŸèƒ½ï¼Œå°±æ˜¯ï¼šç¼–æ’ã€‚</strong></p></li><li><p>æ›´æ–°podçš„image</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> method 1, config yaml</span></span><br><span class="line">imagePullPolicy: Always</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method 2, manually delete pod</span></span><br><span class="line">kubectl delete pod &lt;pod-name&gt;</span><br></pre></td></tr></table></figure></li></ul><h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><h2 id="node-pod-cidr-not-assigned"><a href="#node-pod-cidr-not-assigned" class="headerlink" title="node pod cidr not assigned"></a><strong>node pod cidr not assigned</strong></h2><ul><li>Step 1</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> master node</span></span><br><span class="line">sudo vim /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br></pre></td></tr></table></figure><p><code>kube-controller-manager.yaml</code> info</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">    - kube-controller-manager</span><br><span class="line">    - --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf</span><br><span class="line">    - --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf</span><br><span class="line">...</span><br><span class="line">    - --allocate-node-cidrs=true</span><br><span class="line">    - --cluster-cidr=10.244.0.0/16</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>step2 </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart kubelet</span><br></pre></td></tr></table></figure><h2 id="failed-to-set-bridge-addr-â€œcni0â€œ-already-has-an-IP-address-different-from-xxx"><a href="#failed-to-set-bridge-addr-â€œcni0â€œ-already-has-an-IP-address-different-from-xxx" class="headerlink" title="failed to set bridge addr: â€œcni0â€œ already has an IP address different from xxx"></a>failed to set bridge addr: â€œcni0â€œ already has an IP address different from xxx</h2><ul><li>check</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> node1</span></span><br><span class="line">cni0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.85.0.1  netmask 255.255.0.0  broadcast 10.85.255.255</span><br><span class="line">        ...</span><br><span class="line">flannel.1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">        inet 10.244.0.0  netmask 255.255.255.255  broadcast 0.0.0.0  </span><br><span class="line"><span class="meta">#</span><span class="bash"> node2</span></span><br><span class="line">cni0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.85.0.1  netmask 255.255.0.0  broadcast 10.85.255.255</span><br><span class="line">        ...</span><br><span class="line">flannel.1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">        inet 10.244.1.0  netmask 255.255.255.255  broadcast 0.0.0.0  </span><br><span class="line"><span class="meta">#</span><span class="bash"> node3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> node2</span></span><br><span class="line">cni0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.85.0.1  netmask 255.255.0.0  broadcast 10.85.255.255</span><br><span class="line">        ...</span><br><span class="line">flannel.1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">        inet 10.244.2.0  netmask 255.255.255.255  broadcast 0.0.0.0  </span><br></pre></td></tr></table></figure><blockquote><p>cni0ä¸flannelåº”è¯¥éœ€è¦åœ¨ä¸€ä¸ªç½‘æ®µé‡Œ</p></blockquote><ul><li>delete <code>cni0 </code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> node1/node2/node3</span></span><br><span class="line">sudo ifconfig cni0 down </span><br><span class="line">sudo ip link delete cni0</span><br></pre></td></tr></table></figure><ul><li>restore <code>coredns</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> error info</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po -o wide -n kube-system</span></span><br><span class="line">NAME                                READY   STATUS             RESTARTS       AGE   IP             NODE  ...</span><br><span class="line">coredns-7b5944fdcf-mgwq2            0/1     CrashLoopBackOff   6 (2m3s ago)   15d   10.85.0.3      dingo7232 </span><br><span class="line">coredns-7b5944fdcf-sxfvt            0/1     CrashLoopBackOff   6 (2m8s ago)   15d   10.85.0.2      dingo7232 </span><br></pre></td></tr></table></figure><blockquote><p> delete coredns,  k8s system will auto recreate it </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po -o wide -n kube-system</span></span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE   IP             NODE...</span><br><span class="line">coredns-7b5944fdcf-fw87q            1/1     Running   0          11s   10.244.2.175   dingo7234   ...     </span><br><span class="line">coredns-7b5944fdcf-rzw9b            1/1     Running   0          22s   10.244.1.2     dingo7233   ...</span><br></pre></td></tr></table></figure><h2 id="namespace-Terminating"><a href="#namespace-Terminating" class="headerlink" title="namespace Terminating"></a>namespace Terminating</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1: check resource <span class="keyword">in</span> namespace</span></span><br><span class="line">kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get -n &lt;your-ns-to-delete&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g.: kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get -n curve</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2: remove the finalizers</span></span><br><span class="line">kubectl -n &lt;namespace&gt; patch &lt;RessourceObject&gt; &lt;Object-name&gt; -p &#x27;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;:null&#125;&#125;&#x27; --type=merge</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g.: kubectl -n curve patch curvefs my-fscluster -p <span class="string">&#x27;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;:null&#125;&#125;&#x27;</span> --<span class="built_in">type</span>=merge</span></span><br></pre></td></tr></table></figure><h2 id="pod-Terminating"><a href="#pod-Terminating" class="headerlink" title="pod Terminating"></a>pod Terminating</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod &lt;pod-name&gt; --grace-period=0 --force --namespace &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h2 id="flannel-with-kubeadm-init"><a href="#flannel-with-kubeadm-init" class="headerlink" title="flannel  with kubeadm init"></a>flannel  with kubeadm init</h2><blockquote><p>after install flannel , KubeletNotReady container runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized</p><p>all nodes is NotReady</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot all nodes</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes delploy</title>
      <link href="/2024/08/05/kubernetes%20deploy/"/>
      <url>/2024/08/05/kubernetes%20deploy/</url>
      
        <content type="html"><![CDATA[<h1 id="k8s-deploy"><a href="#k8s-deploy" class="headerlink" title="k8s deploy"></a>k8s deploy</h1><h2 id="install-kubelet-kubeadm-kubectl"><a href="#install-kubelet-kubeadm-kubectl" class="headerlink" title="install kubelet kubeadm kubectl"></a>install kubelet kubeadm kubectl</h2><blockquote><p>all nodes should install</p></blockquote><ul><li>Step1</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Set SELinux <span class="keyword">in</span> permissive mode (effectively disabling it)</span></span><br><span class="line">sudo setenforce 0</span><br><span class="line">sudo sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27; /etc/selinux/config</span><br></pre></td></tr></table></figure><ul><li><p>Step2</p><blockquote><p>æ³¨æ„ä¸‹é¢ç¤ºä¾‹çš„v1.32ä¸æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¯ä¿®æ”¹åˆ°æœ€æ–°çš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…</p></blockquote></li></ul><p><strong>CentOS/RHEL/Rocky</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.ustc.edu.cn/kubernetes/core:/stable:/v1.32/rpm/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.ustc.edu.cn/kubernetes/core:/stable:/v1.32/rpm/repodata/repomd.xml.key</span><br><span class="line">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p><strong>Ubuntu/Debian</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y apt-transport-https ca-certificates curl</span><br><span class="line">sudo curl -fsSL https://mirrors.ustc.edu.cn/kubernetes/core:/stable:/v1.32/deb/Release.key | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/kubernetes-ustc.gpg</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://mirrors.ustc.edu.cn/kubernetes/core:/stable:/v1.32/deb/ /</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><ul><li>step3</li></ul><p><strong>CentOS/RHEL/Rocky</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> all node</span></span><br><span class="line">sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">sudo systemctl enable --now kubelet</span><br></pre></td></tr></table></figure><p><strong>Ubuntu/Debian</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y kubelet kubeadm kubectl</span><br><span class="line">sudo systemctl enable --now kubelet</span><br></pre></td></tr></table></figure><ul><li><p>step4 disable swap</p><blockquote><p>ä¸»è¦æ˜¯ kubelet æœåŠ¡éœ€è¦ç¦ç”¨swap</p></blockquote></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff -a</span><br><span class="line">sudo sed -i &#x27;/[[:space:]]swap[[:space:]]/s/^/#/&#x27; /etc/fstab</span><br></pre></td></tr></table></figure><h2 id="install-Container-Runtimes"><a href="#install-Container-Runtimes" class="headerlink" title="install Container Runtimes"></a>install Container Runtimes</h2><blockquote><p><a href="https://www.cloudraft.io/blog/container-runtimes">https://www.cloudraft.io/blog/container-runtimes</a></p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># RuntimePath to Unix domain socket</span><br><span class="line">containerdunix:<span class="comment">///var/run/containerd/containerd.sock</span></span><br><span class="line">CRI-Ounix:<span class="comment">///var/run/crio/crio.sock</span></span><br><span class="line">Docker Engine (using cri-dockerd)unix:<span class="comment">///var/run/cri-dockerd.sock</span></span><br></pre></td></tr></table></figure><ul><li>Enable ipv4 packet forward</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sysctl params required by setup, params persist across reboots</span></span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">EOF</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Apply sysctl params without reboot</span></span><br><span class="line">sudo sysctl --system</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Verify that net.ipv4.ip_forward is <span class="built_in">set</span> to 1</span></span><br><span class="line">sysctl net.ipv4.ip_forward</span><br></pre></td></tr></table></figure><ul><li>cgroup driver (optional in container and CRI-O)</li></ul><blockquote><ul><li><a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd-systemd">containerd</a></li><li><a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cri-o">CRI-O</a></li></ul></blockquote><p>To set <code>systemd</code> as the cgroup driver, edit the <a href="https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/"><code>KubeletConfiguration</code></a> option of <code>cgroupDriver</code> and set it to <code>systemd</code>. For example:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubelet.config.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">KubeletConfiguration</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">cgroupDriver:</span> <span class="string">systemd</span></span><br></pre></td></tr></table></figure><p>Starting with v1.22 and later, when creating a cluster with kubeadm, if the user does not set the <code>cgroupDriver</code> field under <code>KubeletConfiguration</code>, kubeadm defaults it to <code>systemd</code>.</p><h3 id="containerd"><a href="#containerd" class="headerlink" title="containerd"></a>containerd</h3><ul><li><p>init config.toml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> must create /etc/containerd directory advanced</span></span><br><span class="line">sudo mkdir -p /etc/containerd</span><br><span class="line">sudo containerd config default | sudo tee /etc/containerd/config.toml</span><br></pre></td></tr></table></figure></li><li><p>config </p></li></ul><p>Configuring the <code>systemd</code> cgroup driver</p><p><code>sudo vim /etc/containerd/config.toml</code></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#disabled_plugins = [&quot;cri&quot;]</span></span><br><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span></span><br><span class="line">    <span class="attr">SystemdCgroup</span> = <span class="literal">true</span></span><br><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;]</span></span><br><span class="line">  <span class="attr">sandbox_image</span> = <span class="string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9&quot;</span> <span class="comment"># &quot;swr.cn-north-4.myhuaweicloud.com/ddn-k8s/registry.k8s.io/pause:3.10&quot;</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs]</span></span><br><span class="line">xxxxxx</span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]</span></span><br><span class="line">    xxxxxx</span><br></pre></td></tr></table></figure><p><code>sudo systemctl restart containerd</code></p><blockquote><p>å¯åŠ¨å®Œæˆåå°±å¯ä»¥ä½¿ç”¨ containerd çš„æœ¬åœ° CLI å·¥å…· <code>ctr</code> å’Œ <code>crictl</code> äº†</p></blockquote><ul><li><p>check containerd version</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">containerd --version</span><br><span class="line"><span class="meta">#</span><span class="bash"> containerd containerd.io 1.7.19</span> </span><br></pre></td></tr></table></figure></li></ul><h3 id="CRI-O-optional"><a href="#CRI-O-optional" class="headerlink" title="CRI-O (optional)"></a>CRI-O (optional)</h3><ul><li><p>set repo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/cri-o.repo</span><br><span class="line">[cri-o]</span><br><span class="line">name=CRI-O</span><br><span class="line">baseurl=https://mirrors.ustc.edu.cn/kubernetes/addons:/cri-o:/stable:/v1.30/rpm/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.ustc.edu.cn/kubernetes/addons:/cri-o:/stable:/v1.30/rpm/repodata/repomd.xml.key</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li><li><p>install</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf install -y container-selinux</span><br><span class="line">dnf install -y cri-o</span><br><span class="line">systemctl start crio.service</span><br></pre></td></tr></table></figure></li><li><p>bootstrap cluster</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a</span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl -w net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure></li></ul><h3 id="Docker-Engine-optional"><a href="#Docker-Engine-optional" class="headerlink" title="Docker Engine (optional)"></a>Docker Engine (optional)</h3><ul><li><p>install docker (existing)</p></li><li><p>install <code>cri-dockerd</code>, the CRI socket is <code>/run/cri-dockerd.sock</code> by default.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> download</span> </span><br><span class="line">wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.16/cri-dockerd-0.3.16.amd64.tgz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> extract tgz</span></span><br><span class="line">tar -xzvf cri-dockerd-0.3.16.amd64.tgz</span><br><span class="line"></span><br><span class="line">sudo mv ./cri-dockerd /usr/local/bin/ # mv binary cri-dockerd file</span><br><span class="line">wget https://raw.githubusercontent.com/Mirantis/cri-dockerd/master/packaging/systemd/cri-docker.service</span><br><span class="line">wget https://raw.githubusercontent.com/Mirantis/cri-dockerd/master/packaging/systemd/cri-docker.socket</span><br><span class="line">sudo mv cri-docker.socket cri-docker.service /etc/systemd/system/</span><br><span class="line">sudo sed -i -e &#x27;s,/usr/bin/cri-dockerd,/usr/local/bin/cri-dockerd,&#x27; /etc/systemd/system/cri-docker.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> config always auto-restart</span></span><br><span class="line">vim /etc/systemd/system/cri-docker.socket</span><br><span class="line">[Socket]</span><br><span class="line">Restart=always</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">enable</span> service, cri-docker.socket -&gt; trigger -&gt; cri-docker.service</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl enable cri-docker.service</span><br><span class="line">sudo systemctl enable --now cri-docker.socket</span><br><span class="line">sudo systemctl status cri-docker.socket</span><br></pre></td></tr></table></figure></li></ul><h2 id="crictl"><a href="#crictl" class="headerlink" title="crictl"></a>crictl</h2><blockquote><p> cri client, could check container running on k8s</p><p> all node should install it </p></blockquote><ul><li>Config containerd <code>vim /etc/crictl.yaml</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">runtime-endpoint:</span> <span class="string">unix:///run/containerd/containerd.sock</span> <span class="comment"># docker-engine use unix:///var/run/cri-dockerd.sock </span></span><br><span class="line"><span class="attr">image-endpoint:</span> <span class="string">unix:///run/containerd/containerd.sock</span> <span class="comment"># docker-engine use unix:///var/run/cri-dockerd.sock </span></span><br><span class="line"><span class="attr">timeout:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">debug:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">pull-image-on-create:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li>verify mirror</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo crictl info</span><br></pre></td></tr></table></figure><ul><li>command</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> List All Pods</span></span><br><span class="line">crictl pods</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Filter Pods by Namespace, To view pods <span class="keyword">in</span> a specific namespace, use the `--namespace` or `-n` option:</span></span><br><span class="line">crictl pods --namespace=&lt;namespace_name&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check Container Status</span></span><br><span class="line">crictl containers --namespace=&lt;namespace_name&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Describe a Specific Container</span></span><br><span class="line">crictl describe --namespace=&lt;namespace_name&gt; &lt;container_id&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check Logs (<span class="keyword">if</span> applicable)</span></span><br><span class="line">crictl logs --namespace=&lt;namespace_name&gt; &lt;container_id&gt;</span><br></pre></td></tr></table></figure><h2 id="kubeadm-deploy-cluster"><a href="#kubeadm-deploy-cluster" class="headerlink" title="kubeadm deploy cluster"></a>kubeadm deploy cluster</h2><blockquote><p>To use different container runtime or if there are more than one installed on the provisioned node, specify the <code>--cri-socket</code> argument to <code>kubeadm</code>.</p></blockquote><table><thead><tr><th>Runtime</th><th>Path to Unix domain socket</th></tr></thead><tbody><tr><td>containerd</td><td><code>unix:///var/run/containerd/containerd.sock</code></td></tr><tr><td>CRI-O</td><td><code>unix:///var/run/crio/crio.sock</code></td></tr><tr><td>Docker Engine (using cri-dockerd)</td><td><code>unix:///var/run/cri-dockerd.sock</code></td></tr></tbody></table><h3 id="Initializing-control-plane-node"><a href="#Initializing-control-plane-node" class="headerlink" title="Initializing  control-plane node"></a>Initializing  control-plane node</h3><ul><li><p>bootstrap cluster</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> use flannel as Pod network add-on (CNI plugin), 10.244.0.0/16 is config <span class="keyword">for</span> flannel</span></span><br><span class="line">sudo kubeadm init  --apiserver-advertise-address=10.220.32.16 --pod-network-cidr=10.244.0.0/16  --cri-socket=unix:///var/run/containerd/containerd.sock # å¦‚æœä½¿ç”¨å…¶ä»– criï¼Œ éœ€è¦ä¿®æ”¹sockæ–‡ä»¶</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sudo kubeadm config images pull --config kubeadm.conf (æå‰æ‹‰å–ç›¸å…³é•œåƒ)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sudo kubeadm init --config kubeadm.conf ï¼ˆä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼Œä¸Šæ–‡ä¸­çš„ apiserver-advertise-address ç­‰å‚æ•°å‡åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼‰</span></span><br></pre></td></tr></table></figure><ul><li><p>(optional) resert (back to kubeadm init) </p><blockquote><p>æ‰§è¡ŒæŠ¥é”™ï¼Œæˆ–ä¿®æ”¹inité…ç½®çš„æ—¶å€™ï¼Œè¿›è¡Œresertæ“ä½œ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm reset</span><br><span class="line"></span><br><span class="line">sudo rm -rf /etc/cni/net.d</span><br><span class="line">sudo rm -rf $HOME/.kube/config </span><br><span class="line">sudo systemctl restart kubelet # å¿…é¡»æ‰§è¡Œé‡å¯</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>Use kubectl</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure></li><li><p>install flannel</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> apply flannel(optional) CNI plugin</span> </span><br><span class="line">kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœéœ€è¦æ›¿æ¢ flannel ç›¸å…³çš„é•œåƒæºï¼Œéœ€è¦æå‰wget ä¸‹è½½ kube-flannel.yml, ç„¶åä¿®æ”¹imageä¿¡æ¯</span></span><br><span class="line">swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/flannel-io/flannel:v0.26.4 </span><br><span class="line">swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/flannel-io/flannel-cni-plugin:v1.6.2-flannel1</span><br></pre></td></tr></table></figure></li><li><p>check the CoreDNS Pod is <code>Running</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --all-namespaces</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-7b5944fdcf-mgwq2            1/1     Running   0          4h22m</span><br><span class="line">kube-system   coredns-7b5944fdcf-sxfvt            1/1     Running   0          4h22m</span><br><span class="line">kube-system   etcd-dingo7232                      1/1     Running   1          4h22m</span><br><span class="line">kube-system   kube-apiserver-dingo7232            1/1     Running   1          4h22m</span><br><span class="line">kube-system   kube-controller-manager-dingo7232   1/1     Running   1          4h22m</span><br><span class="line">kube-system   kube-proxy-w2lfk                    1/1     Running   0          4h22m</span><br><span class="line">kube-system   kube-scheduler-dingo7232            1/1     Running   1          4h22m</span><br></pre></td></tr></table></figure></li><li><p><code>kubeadm.conf</code> info</p><blockquote><p>sudo kubeadm config print init-defaults &gt; kubeadm.conf</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta3</span></span><br><span class="line"><span class="attr">bootstrapTokens:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">system:bootstrappers:kubeadm:default-node-token</span></span><br><span class="line">  <span class="attr">token:</span> <span class="string">abcdef.0123456789abcdef</span></span><br><span class="line">  <span class="attr">ttl:</span> <span class="string">24h0m0s</span></span><br><span class="line">  <span class="attr">usages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">signing</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">authentication</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">InitConfiguration</span></span><br><span class="line"><span class="attr">localAPIEndpoint:</span></span><br><span class="line">  <span class="attr">advertiseAddress:</span> <span class="number">172.20</span><span class="number">.7</span><span class="number">.232</span></span><br><span class="line">  <span class="attr">bindPort:</span> <span class="number">6443</span></span><br><span class="line"><span class="attr">nodeRegistration:</span></span><br><span class="line">  <span class="attr">criSocket:</span> <span class="string">unix:///var/run/containerd/containerd.sock</span></span><br><span class="line">  <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dingo7232</span></span><br><span class="line">  <span class="attr">taints:</span> <span class="literal">null</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiServer:</span></span><br><span class="line">  <span class="attr">timeoutForControlPlane:</span> <span class="string">4m0s</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta3</span></span><br><span class="line"><span class="attr">certificatesDir:</span> <span class="string">/etc/kubernetes/pki</span></span><br><span class="line"><span class="attr">clusterName:</span> <span class="string">kubernetes</span></span><br><span class="line"><span class="attr">controllerManager:</span> &#123;&#125;</span><br><span class="line"><span class="attr">dns:</span> &#123;&#125;</span><br><span class="line"><span class="attr">etcd:</span></span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">dataDir:</span> <span class="string">/var/lib/etcd</span></span><br><span class="line"><span class="attr">imageRepository:</span> <span class="string">registry.aliyuncs.com/google_containers</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterConfiguration</span></span><br><span class="line"><span class="attr">kubernetesVersion:</span> <span class="number">1.30</span><span class="number">.0</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="attr">dnsDomain:</span> <span class="string">cluster.local</span></span><br><span class="line">  <span class="attr">serviceSubnet:</span> <span class="number">10.96</span><span class="number">.0</span><span class="number">.0</span><span class="string">/12</span></span><br><span class="line"><span class="attr">scheduler:</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="join-node"><a href="#join-node" class="headerlink" title="join node"></a>join node</h3><blockquote><p>å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ ï¼ˆå·¥ä½œåŠèŠ‚ç‚¹éœ€è¦æå‰å®‰è£… kubeletã€kubeadmã€kubectlï¼‰</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> shangdi 16</span></span><br><span class="line">sudo kubeadm join 172.20.7.232:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:9f2fac23dc994bb63b7510b1925f143a5b6fd3305ec8f376b402aa3c08ae5e90 --cri-socket unix:///var/run/containerd/containerd.sock</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sjj 127</span></span><br><span class="line">sudo kubeadm join 172.30.14.127:6443 --token c2ixm4.l1iv90mj1b1ug3bq \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:600be5a4505e894ac2ee7a963b28ff33e6756291dfaf542884bf63a73ddf3fca \</span><br><span class="line">        --cri-socket unix:///var/run/cri-dockerd.sock</span><br><span class="line">        </span><br><span class="line">sudo kubeadm join 172.30.14.127:6443 --token c0ctm3.nkii2s87omvon67u --discovery-token-ca-cert-hash sha256:600be5a4505e894ac2ee7a963b28ff33e6756291dfaf542884bf63a73ddf3fca \</span><br><span class="line">--cri-socket unix:///var/run/cri-dockerd.sock</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼škubeadmçš„tokenä¼šæœ‰TTLï¼Œå¯ç”¨ <code>kubeadm token list</code> æŸ¥çœ‹tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¦åˆ™ä½¿ç”¨<code>kubeadm token create --print-join-command</code>åˆ›å»ºä¸€ä¸ªæ–°çš„token</p><ul><li>Check on control-plane</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line">NAME        STATUS   ROLES           AGE     VERSION</span><br><span class="line">dingo7232   Ready    control-plane   4h31m   v1.30.3</span><br><span class="line">dingo7233   Ready    &lt;none&gt;          98s     v1.30.3</span><br></pre></td></tr></table></figure><ul><li><p>check all pods</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --all-namespaces</span><br><span class="line">NAMESPACE      NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-flannel   kube-flannel-ds-gmdks              1/1     Running   0          56s</span><br><span class="line">kube-flannel   kube-flannel-ds-qzmb9              1/1     Running   0          10m</span><br><span class="line">kube-flannel   kube-flannel-ds-tvdjg              1/1     Running   0          3m58s</span><br><span class="line">kube-system    coredns-55cb58b774-7wwq7           1/1     Running   0          74m</span><br><span class="line">kube-system    coredns-55cb58b774-z8v87           1/1     Running   0          74m</span><br><span class="line">kube-system    etcd-dingo127                      1/1     Running   0          74m</span><br><span class="line">kube-system    kube-apiserver-dingo127            1/1     Running   0          74m</span><br><span class="line">kube-system    kube-controller-manager-dingo127   1/1     Running   0          74m</span><br><span class="line">kube-system    kube-proxy-6wv22                   1/1     Running   0          74m</span><br><span class="line">kube-system    kube-proxy-mc6nt                   1/1     Running   0          56s</span><br><span class="line">kube-system    kube-proxy-zv8fp                   1/1     Running   0          3m58s</span><br><span class="line">kube-system    kube-scheduler-dingo127            1/1     Running   0          74m</span><br></pre></td></tr></table></figure></li></ul><h1 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h1><h2 id="dashboard"><a href="#dashboard" class="headerlink" title="dashboard"></a>dashboard</h2><ul><li><p>install online</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</span><br><span class="line">helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard --create-namespace --namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure></li><li><p>install offline</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm upgrade --install kubernetes-dashboard kubernetes-dashboard-7.5.0.tgz --create-namespace --namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure></li><li><p>uninstall</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm delete kubernetes-dashboard --namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure></li><li><p>reference</p><ul><li><a href="https://blog.frognew.com/2023/08/kubeadm-install-kubernetes-1.28.html#3kubernetes%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6%E9%83%A8%E7%BD%B2">https://blog.frognew.com/2023/08/kubeadm-install-kubernetes-1.28.html#3kubernetes%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6%E9%83%A8%E7%BD%B2</a></li></ul></li></ul><h1 id="best-practices"><a href="#best-practices" class="headerlink" title="best practices"></a>best practices</h1><h2 id="change-etcd-default-port"><a href="#change-etcd-default-port" class="headerlink" title="change etcd default port"></a>change etcd default port</h2><ul><li><p>step 1: init kubeadm config</p><blockquote><p>åªéœ€è¦æ›´æ–°éœ€è¦ä¿®æ”¹çš„å‚æ•°ï¼Œä¾‹å¦‚ä¸‹é¢çš„é…ç½®ä¿¡æ¯å°±æ˜¯ä¿®æ”¹etcdçš„é»˜è®¤ç«¯å£æ”¹ä¸º 12379ã€12380</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">InitConfiguration</span></span><br><span class="line"><span class="attr">nodeRegistration:</span></span><br><span class="line">  <span class="attr">criSocket:</span> <span class="string">unix:///var/run/cri-dockerd.sock</span>  <span class="comment"># ä½¿ç”¨äº† docker engine ä½œä¸º container runtime</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dingo127</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterConfiguration</span></span><br><span class="line"><span class="attr">kubernetesVersion:</span> <span class="number">1.30</span><span class="number">.0</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="attr">podSubnet:</span> <span class="string">&quot;10.244.0.0/16&quot;</span>  <span class="comment"># å¯¹åº”äº†å‘½ä»¤è¡Œçš„ pod-network-cidr å‚æ•°</span></span><br><span class="line"><span class="attr">apiServer:</span></span><br><span class="line">  <span class="attr">timeoutForControlPlane:</span> <span class="string">4m0s</span></span><br><span class="line">  <span class="attr">extraArgs:</span></span><br><span class="line">    <span class="attr">advertise-address:</span> <span class="string">&quot;172.30.14.127&quot;</span></span><br><span class="line">    <span class="attr">etcd-servers:</span> <span class="string">&quot;https://127.0.0.1:12379&quot;</span>  <span class="comment"># etcd æœåŠ¡åœ°å€</span></span><br><span class="line"><span class="attr">etcd:</span></span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">dataDir:</span> <span class="string">/var/lib/k8s-etcd</span></span><br><span class="line">    <span class="attr">extraArgs:</span></span><br><span class="line">      <span class="attr">advertise-client-urls:</span> <span class="string">&quot;https://172.30.14.127:12379&quot;</span> </span><br><span class="line">      <span class="attr">initial-advertise-peer-urls:</span> <span class="string">&quot;https://172.30.14.127:12380&quot;</span></span><br><span class="line">      <span class="attr">listen-client-urls:</span> <span class="string">&quot;https://127.0.0.1:12379,https://172.30.14.127:12379&quot;</span></span><br><span class="line">      <span class="attr">listen-peer-urls:</span> <span class="string">&quot;https://172.30.14.127:12380&quot;</span></span><br><span class="line">      <span class="attr">initial-cluster:</span> <span class="string">&quot;dingo127=https://172.30.14.127:12380&quot;</span></span><br><span class="line">      <span class="attr">listen-metrics-urls:</span> <span class="string">&quot;http://127.0.0.1:12381&quot;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼škubeadm.k8s.io/v1beta3 ç‰ˆæœ¬çš„ extraArgs æ˜¯ map[string]string æ ¼å¼ï¼›å¦‚æœä½¿ç”¨çš„æ˜¯ kubeadm.k8s.io/v1beta4ï¼Œåˆ™ç›¸åº”çš„extraArgs éœ€è¦å˜ä¸º list ç±»å‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">apiServer:</span></span><br><span class="line">  <span class="attr">extraArgs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;advertise-address&quot;</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&quot;172.30.14.127&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;etcd-servers&quot;</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&quot;https://127.0.0.1:12379&quot;</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">etcd:</span></span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">extraArgs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;advertise-client-urls&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;https://172.30.14.127:12379&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;initial-advertise-peer-urls&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;https://172.30.14.127:12380&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;listen-client-urls&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;https://127.0.0.1:12379,https://172.30.14.127:12379&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;listen-peer-urls&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;https://172.30.14.127:12380&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;initial-cluster&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;dingo127=https://172.30.14.127:12380&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;listen-metrics-urls&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;http://127.0.0.1:12381&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>step2: æ‰§è¡Œ  init æ“ä½œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init --config=kubeadm.conf --ignore-preflight-errors=Port-2379,Port-2380</span><br><span class="line"><span class="meta">#</span><span class="bash"> å› ä¸º kubeadm éœ€è¦åš pref-light(æ£€æµ‹etcdç«¯å£2379å’Œ2380ç«¯å£æ˜¯å¦è¢«å ç”¨)ï¼Œè¿™é‡Œéœ€è¦è·³è¿‡å¯¹è¿™ä¸¤ä¸ªç«¯å£çš„æ£€æµ‹</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="rejoin-work-node"><a href="#rejoin-work-node" class="headerlink" title="rejoin work node"></a>rejoin work node</h2><ul><li><p>step1: remove node</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl drain &lt;old-node-name&gt; --ignore-daemonsets --delete-emptydir-data</span><br><span class="line">kubectl delete node &lt;old-node-name&gt;</span><br></pre></td></tr></table></figure></li><li><p>step 2ï¼š é‡ç½®kubeadm</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Reset kubeadm on the Worker Node</span></span><br><span class="line">sudo kubeadm reset -f # --cri-socket unix:///var/run/cri-dockerd.sock</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restart kubelet on workder node</span></span><br><span class="line">sudo systemctl restart kubelet</span><br></pre></td></tr></table></figure></li><li><p>step 3:  join node</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm join &lt;control-plane-ip&gt;:6443 --token &lt;token&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt; # # --cri-socket unix:///var/run/cri-dockerd.sock</span><br></pre></td></tr></table></figure></li></ul><h2 id="other-node-use-kubectl"><a href="#other-node-use-kubectl" class="headerlink" title="other node use kubectl"></a>other node use kubectl</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> method 1</span></span><br><span class="line">scp root@&lt;control-plane-host&gt;:/etc/kubernetes/admin.conf .</span><br><span class="line">kubectl --kubeconfig ./admin.conf get nodes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method 2: <span class="built_in">set</span> kubectl default config</span></span><br><span class="line">scp root@&lt;control-plane-host&gt;:/etc/kubernetes/admin.conf ~/.kube/config</span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure><h1 id="log"><a href="#log" class="headerlink" title="log"></a>log</h1><h2 id="init-control-plane-kubeadm-init"><a href="#init-control-plane-kubeadm-init" class="headerlink" title="init control-plane (kubeadm init)"></a>init control-plane (kubeadm init)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">[reset] Reading configuration from the cluster...                                                          </span><br><span class="line">[reset] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;  </span><br><span class="line">W0804 19:50:00.492596  337004 reset.go:124] [reset] Unable to fetch the kubeadm-config ConfigMap from cluster: failed to get config map: configmaps &quot;kubeadm-config&quot; is forbidden: User &quot;kubernetes-admin&quot; cannot get </span><br><span class="line">resource &quot;configmaps&quot; in API group &quot;&quot; in the namespace &quot;kube-system&quot;                                       </span><br><span class="line">W0804 19:50:00.492782  337004 preflight.go:56] [reset] WARNING: Changes made to this host by &#x27;kubeadm init&#x27; or &#x27;kubeadm join&#x27; will be reverted.                                                                       </span><br><span class="line">[reset] Are you sure you want to proceed? [y/N]: y   </span><br><span class="line">[preflight] Running pre-flight checks                                                                                                                                                                                 </span><br><span class="line">W0804 19:50:04.771583  337004 removeetcdmember.go:106] [reset] No kubeadm config, using etcd pod spec to get data directory                                                                                           </span><br><span class="line">[reset] Deleted contents of the etcd data directory: /var/lib/etcd                                                                                                                                                    </span><br><span class="line">[reset] Stopping the kubelet service                                                                                                                                                                                  </span><br><span class="line">[reset] Unmounting mounted directories in &quot;/var/lib/kubelet&quot;                                                                                                                                                          </span><br><span class="line">[reset] Deleting contents of directories: [/etc/kubernetes/manifests /var/lib/kubelet /etc/kubernetes/pki]                                                                                                            </span><br><span class="line">[reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/super-admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/sched</span><br><span class="line">uler.conf]                                                                                                                                                                                      </span><br><span class="line">The reset process does not clean CNI configuration. To do so, you must remove /etc/cni/net.d                                                                                                              </span><br><span class="line">The reset process does not reset or clean up iptables rules or IPVS tables.                                </span><br><span class="line">If you wish to reset iptables, you must do so manually by using the &quot;iptables&quot; command.                                                                                                   </span><br><span class="line">If your cluster was setup to utilize IPVS, run ipvsadm --clear (or similar)                                                                                                                                           </span><br><span class="line">to reset your system&#x27;s IPVS tables.                                                                                                                                                                              </span><br><span class="line">The reset process does not clean your kubeconfig files and you must remove them manually.                                                                                                                             </span><br><span class="line">Please, check the contents of the $HOME/.kube/config file.                                                 </span><br><span class="line">[dongw@dingo7232 kubernetes]$               </span><br><span class="line">[dongw@dingo7232 kubernetes]$ sudo kubeadm init --config kubeadm-containerd.conf                                                                                                            </span><br><span class="line">[init] Using Kubernetes version: v1.30.0                                                                   </span><br><span class="line">[preflight] Running pre-flight checks                                                                                                                                                                                 </span><br><span class="line">[preflight] Pulling images required for setting up a Kubernetes cluster                                    </span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action in beforehand using &#x27;kubeadm config images pull&#x27;</span><br><span class="line">W0804 19:50:17.819534  337405 checks.go:844] detected that the sandbox image &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6&quot; of the container runtime is inconsistent with that used by kubeadm.It is </span><br><span class="line">recommended to use &quot;registry.aliyuncs.com/google_containers/pause:3.9&quot; as the CRI sandbox image.           </span><br><span class="line">[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;                                                  </span><br><span class="line">[certs] Generating &quot;ca&quot; certificate and key                                                                </span><br><span class="line">[certs] Generating &quot;apiserver&quot; certificate and key   </span><br><span class="line">[certs] apiserver serving cert is signed for DNS names [dingo7232 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 172.20.7.232]</span><br><span class="line">[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key</span><br><span class="line">[certs] Generating &quot;front-proxy-ca&quot; certificate and key</span><br><span class="line">[certs] Generating &quot;front-proxy-client&quot; certificate and key                </span><br><span class="line">[certs] Generating &quot;etcd/ca&quot; certificate and key                                                           </span><br><span class="line">[certs] Generating &quot;etcd/server&quot; certificate and key                                                       </span><br><span class="line">[certs] etcd/server serving cert is signed for DNS names [dingo7232 localhost] and IPs [172.20.7.232 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating &quot;etcd/peer&quot; certificate and key                                                         </span><br><span class="line">[certs] etcd/peer serving cert is signed for DNS names [dingo7232 localhost] and IPs [172.20.7.232 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key                                                                                                                                                      </span><br><span class="line">[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key                                                                                                                                                        </span><br><span class="line">[certs] Generating &quot;sa&quot; key and public key</span><br><span class="line">[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;                                                                                                                                                                </span><br><span class="line">[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file                                                          </span><br><span class="line">[kubeconfig] Writing &quot;super-admin.conf&quot; kubeconfig file                                 </span><br><span class="line">[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file                                                                                                                                                                   </span><br><span class="line">[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file</span><br><span class="line">[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file                                                      </span><br><span class="line">[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;</span><br><span class="line">[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;</span><br><span class="line">[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;</span><br><span class="line">[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;</span><br><span class="line">[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;</span><br><span class="line">[kubelet-check] Waiting for a healthy kubelet. This can take up to 4m0s</span><br><span class="line">[kubelet-check] The kubelet is healthy after 1.002018544s</span><br><span class="line">[api-check] Waiting for a healthy API server. This can take up to 4m0s</span><br><span class="line">[api-check] The API server is healthy after 6.001201324s</span><br><span class="line">[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap &quot;kubelet-config&quot; in namespace kube-system with the configuration for the kubelets in the cluster</span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node dingo7232 as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span><br><span class="line">[mark-control-plane] Marking the node dingo7232 as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: abcdef.0123456789abcdef</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span><br><span class="line">[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace</span><br><span class="line">[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, if you are the root user, you can run: </span><br><span class="line"></span><br><span class="line">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 172.20.7.232:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:9f2fac23dc994bb63b7510b1925f143a5b6fd3305ec8f376b402aa3c08ae5e90</span><br></pre></td></tr></table></figure><h2 id="join-node-to-cluter"><a href="#join-node-to-cluter" class="headerlink" title="join node to cluter"></a>join node to cluter</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-check] Waiting for a healthy kubelet. This can take up to 4m0s</span><br><span class="line">[kubelet-check] The kubelet is healthy after 1.501334955s</span><br><span class="line">[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run &#x27;kubectl get nodes&#x27; on the control-plane to see this node join the cluster.</span><br></pre></td></tr></table></figure><h1 id="troubelshoot"><a href="#troubelshoot" class="headerlink" title="troubelshoot"></a>troubelshoot</h1><h2 id="flannel"><a href="#flannel" class="headerlink" title="flannel"></a>flannel</h2><p><strong>Failed to check br_netfilter: stat /proc/sys/net/bridge/bridge-nf-call-iptables: no such file or directory</strong></p><p>Solution : Load the br_netfilter Module</p><ol><li><p>Check if br_netfilter is loaded</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep br_netfilter</span><br></pre></td></tr></table></figure></li><li><p>If not loaded, load the module:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo modprobe br_netfilter</span><br></pre></td></tr></table></figure></li><li><p>Enable br_netfilter on boot</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Add the following line to /etc/modules-load.d/k8s.conf:</span></span><br><span class="line">br_netfilter</span><br></pre></td></tr></table></figure></li><li><p>Ensure bridge-nf-call-iptables and bridge-nf-call-ip6tables are set to 1:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">sudo sysctl net.bridge.bridge-nf-call-ip6tables=1</span><br></pre></td></tr></table></figure></li><li><p>Persist the settings by adding the following to <code>/etc/sysctl.d/k8s.conf</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br></pre></td></tr></table></figure></li><li><p>Reload sysctl settings:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure></li></ol><h2 id="containerd-1"><a href="#containerd-1" class="headerlink" title="containerd"></a>containerd</h2><p><strong>change containerdâ€™s default data path</strong></p><ol><li><p>Identify the Current Data Path</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">containerd config default | grep &quot;root&quot; # Expected output: root = &quot;/var/lib/containerd&quot;</span><br></pre></td></tr></table></figure></li><li><p>Modify the following lines in /etc/containerd/config.toml:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root = &quot;/path/to/new/data/path&quot; # the location where container data (images, volumes) is stored</span><br></pre></td></tr></table></figure></li><li><p>Move Existing Data (if required)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop containerd  # optional</span><br><span class="line">sudo mv /var/lib/containerd /data/containerd</span><br><span class="line">sudo systemctl start containerd</span><br></pre></td></tr></table></figure></li></ol><h2 id="kubelet-serivce-failed"><a href="#kubelet-serivce-failed" class="headerlink" title="kubelet serivce failed"></a>kubelet serivce failed</h2><p><strong>The connection to the server 10.220.32.16:6443 was refused - did you specify the right host or port?</strong></p><blockquote><p>API server process is up and listening on port 6443</p></blockquote><ul><li><strong>disable swap</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff -a</span><br><span class="line">sudo sed -i &#x27;/ swap / s/^\(.*\)$/#\1/g&#x27; /etc/fstab</span><br></pre></td></tr></table></figure><ul><li><code>systemctl start kubelet</code></li></ul><h2 id="control-plane-NotReady"><a href="#control-plane-NotReady" class="headerlink" title="control-plane NotReady"></a>control-plane NotReady</h2><ul><li><p>restart kubelet service on control-plane node</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart kubectl</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> deploy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell bash</title>
      <link href="/2024/07/30/shell%20bash/"/>
      <url>/2024/07/30/shell%20bash/</url>
      
        <content type="html"><![CDATA[<ul><li>the shell assigns its <strong>exit code</strong> to the <code>$?</code> environment variable. The <code>$?</code> variable is how we usually test whether a script has succeeded or not in its execution.</li></ul><h1 id="syntax"><a href="#syntax" class="headerlink" title="syntax"></a>syntax</h1><h2 id="set-e"><a href="#set-e" class="headerlink" title="set -e"></a>set -e</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Causes the script to exit immediately if any command fails (returns a non-zero status).</span><br></pre></td></tr></table></figure><h2 id="set-x"><a href="#set-x" class="headerlink" title="set -x"></a>set -x</h2><blockquote><p>â€‹    1.    <strong>Debugging</strong>: When youâ€™re trying to troubleshoot a script, set -x helps you see exactly what commands are being executed and in what order.</p><p>â€‹    2.    <strong>Selective Debugging</strong>: You can use set -x and set +x around specific parts of your script to narrow down the problematic sections.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">echo &quot;This is a normal message&quot;</span><br><span class="line"></span><br><span class="line">set -x  # Start debugging from this point</span><br><span class="line">name=&quot;John&quot;</span><br><span class="line">echo &quot;Hello, $name&quot;</span><br><span class="line"></span><br><span class="line">set +x  # Stop debugging after this point</span><br><span class="line">echo &quot;Debugging mode is now off&quot;</span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This is a normal message</span><br><span class="line">+ name=John</span><br><span class="line">+ echo &#x27;Hello, John&#x27;</span><br><span class="line">Hello, John</span><br><span class="line">Debugging mode is now off</span><br></pre></td></tr></table></figure><h2 id="shift-2"><a href="#shift-2" class="headerlink" title="shift 2"></a>shift 2</h2><ul><li>Removes the first two positional parameters from command line arguments</li><li>Shifts remaining parameters left by 2 positions</li><li>Useful when processing command line options/arguments in loops</li></ul><h2 id="xx-xx"><a href="#xx-xx" class="headerlink" title="{xx..xx}"></a>{xx..xx}</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for node in node&#123;1..9&#125; node&#123;20..29&#125; ; do</span><br><span class="line">  echo -n &quot;$node: &quot;</span><br><span class="line">  kubectl get node &quot;$node&quot; -o jsonpath=&#x27;&#123;.spec.taints&#125;&#x27; || echo &quot;Not found&quot;</span><br><span class="line">  echo</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h2 id="args"><a href="#args" class="headerlink" title="${args[@]}"></a><code>$&#123;args[@]&#125;</code></h2><p>The <code>$&#123;args[@]&#125;</code> syntax in bash is used to expand an array variable named <code>args</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Define an array</span></span><br><span class="line">args=(&quot;hello&quot; &quot;world&quot; &quot;test&quot;)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$&#123;args[@]&#125;</span> expands to all elements</span></span><br><span class="line">echo &quot;All arguments: $&#123;args[@]&#125;&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Output: All arguments: hello world <span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><h1 id="point"><a href="#point" class="headerlink" title="point"></a>point</h1><ul><li><code>(cd third-party &amp;&amp; ...)</code> è¿™æ ·çš„è¯­æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘½ä»¤æ›¿æ¢ï¼Œå®ƒå®è´¨ä¸Šæ˜¯å…ˆä¸´æ—¶æ”¹å˜åˆ° <code>third-party</code> ç›®å½•æ‰§è¡Œé‡Œé¢çš„å‘½ä»¤ï¼Œç„¶åè„šæœ¬ä¼šç»§ç»­åœ¨åŸå…ˆçš„ç›®å½•ä¸­æ‰§è¡Œã€‚</li></ul><h1 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h1><ul><li><p>output of a script to a specified file</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup your_script.sh &gt; output.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><blockquote><p>0: Standard input (stdin)</p><p>1: Standard output (stdout)</p><p>2: Standard error (stderr)</p><p><strong>&gt;&amp;</strong>: This is used to redirect the output.</p><p>&amp;: Puts the command in the background.</p></blockquote></li></ul><h1 id="getopt"><a href="#getopt" class="headerlink" title="getopt"></a>getopt</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">local long_opts=&quot;role:,args:,help&quot;</span><br><span class="line">local args=getopt -o ra --long $long_opts -n &quot;$0&quot; -- &quot;$@&quot;</span><br><span class="line">eval set -- &quot;$&#123;args&#125;&quot;</span><br></pre></td></tr></table></figure><p>This snippet is a common pattern in <strong>Bash scripting</strong> to <strong>parse command-line options</strong> using getopt. Hereâ€™s a line-by-line breakdown:</p><p><strong>Explanation:</strong></p><p><code>local long_opts=&quot;role:,args:,help&quot;</code></p><p>Defines <strong>long options</strong> supported by the script:</p><ul><li>role: means â€“role requires a value (e.g., â€“role=admin)</li><li>args: means â€“args requires a value</li><li>help means â€“help is a flag with <strong>no value</strong></li></ul><blockquote><p>: means the option <strong>requires an argument</strong>; no colon means itâ€™s a flag.</p></blockquote><p><code>local args=getopt -o ra â€“long $long_opts -n â€œ$0â€ â€“ â€œ$@â€</code></p><ul><li>-o ra: short options -r and -a are accepted</li><li>â€“long $long_opts: specify long-form options (see above)</li><li>-n â€œ$0â€: used for error messages (e.g., script name)</li><li>â€“ â€œ$@â€: separates option parsing from positional arguments</li></ul><p>This parses the options passed to the script and stores the <strong>normalized result</strong> in args.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Example: ./myscript.sh --role=admin --args=val --help foo bar</span><br><span class="line">Output of getopt:</span><br><span class="line">--role admin --args val --help -- foo bar</span><br></pre></td></tr></table></figure><p><code>eval set -- &quot;$&#123;args&#125;&quot;</code></p><p>This re-sets the $1, $2, â€¦ positional parameters to the parsed list.</p><p>So later in the script, you can safely loop through options using:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">while true; do</span><br><span class="line">  case &quot;$1&quot; in</span><br><span class="line">    --role) ROLE=$2; shift 2 ;;</span><br><span class="line">    --args) ARGS=$2; shift 2 ;;</span><br><span class="line">    --help) show_help; exit 0 ;;</span><br><span class="line">    --) shift; break ;;</span><br><span class="line">    *) echo &quot;Unknown option: $1&quot;; exit 1 ;;</span><br><span class="line">  esac</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p><strong>Summary</strong></p><table><thead><tr><th><strong>Line</strong></th><th><strong>Purpose</strong></th></tr></thead><tbody><tr><td>long_opts=â€¦</td><td>Defines supported long options</td></tr><tr><td>getopt â€¦</td><td>Parses CLI arguments</td></tr><tr><td>eval set â€“ â€¦</td><td>Makes parsed options available for normal while-case parsing</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GO learn</title>
      <link href="/2024/07/28/golang%20learn/"/>
      <url>/2024/07/28/golang%20learn/</url>
      
        <content type="html"><![CDATA[<h1 id="env"><a href="#env" class="headerlink" title="env"></a>env</h1><ul><li><code>GOPATH</code></li></ul><p><code>GOPATH</code> æ˜¯ Go å·¥ä½œåŒºçš„æ ¹ç›®å½•ï¼Œé€šå¸¸åŒ…å«ä¸‰ä¸ªå­ç›®å½•ï¼š<code>src</code>ã€<code>pkg</code> å’Œ <code>bin</code></p><blockquote><p>å¯é€šè¿‡ go env GOPATH æŸ¥çœ‹Go å·¥ä½œåŒºçš„æ ¹ç›®å½•ã€‚<code>GOPATH</code> ä¸­çš„ <code>bin</code> ç›®å½•é€šå¸¸åŒ…å«ç”± <code>go install</code>å®‰è£…çš„å¯æ‰§è¡Œæ–‡ä»¶</p></blockquote><h1 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h1><h2 id="sclice"><a href="#sclice" class="headerlink" title="sclice"></a>sclice</h2><blockquote><p>sclice selects a half-open range which includes the first element, but excludes the last one.</p></blockquote><ul><li><p>syntax <code>slice[low:high]</code></p></li><li><p>â€œtake from 1 to the endâ€ with <code>numbers[1:]</code>.</p></li><li><p>A slice does not store any data, it just describes a section of an underlying array. Changing the elements of a slice modifies the corresponding elements of its underlying array. Other slices that share the same underlying array will see those changes.</p></li><li><p>The default is zero for the low bound and the length of the slice for the high bound.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a [<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line"># is equal below </span><br><span class="line">a[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line">a[:<span class="number">10</span>]</span><br><span class="line">a[<span class="number">0</span>:]</span><br><span class="line">a[:]</span><br></pre></td></tr></table></figure></li></ul><h2 id="Goâ€™s-while"><a href="#Goâ€™s-while" class="headerlink" title="Goâ€™s while"></a>Goâ€™s while</h2><p> Câ€™s <code>while</code> is spelled <code>for</code> in Go.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> sum &lt; <span class="number">1000</span> &#123;</span><br><span class="line">sum += sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="error"><a href="#error" class="headerlink" title="error"></a>error</h2><ul><li> errors are values, so we can refactor it out into a variable and have a single source of truth for it.</li></ul>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ErrInsufficientFunds = errors.New(<span class="string">&quot;cannot withdraw, insufficient funds&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Wallet)</span> <span class="title">Withdraw</span><span class="params">(amount Bitcoin)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> amount &gt; w.balance &#123;</span><br><span class="line"><span class="keyword">return</span> ErrInsufficientFunds</span><br><span class="line">&#125;</span><br><span class="line">w.balance -= amount</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully">Donâ€™t just check errors, handle them gracefully</a></li></ul><h2 id="pointer"><a href="#pointer" class="headerlink" title="pointer"></a>pointer</h2><blockquote><p>A pointer holds the memory address of a value.</p><p>The <code>&amp;</code> operator <strong>generates</strong> a pointer to its operand.</p><p>The <code>*</code> operator <strong>denotes</strong> the pointerâ€™s underlying value.</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">42</span></span><br><span class="line"></span><br><span class="line">p := &amp;i         <span class="comment">// point to i</span></span><br><span class="line">fmt.Println(*p) <span class="comment">// read i through the pointer</span></span><br><span class="line">*p = <span class="number">21</span>         <span class="comment">// set i through the pointer</span></span><br><span class="line">fmt.Println(i)  <span class="comment">// see the new value of i</span></span><br></pre></td></tr></table></figure><p><strong>when you call a function or a method the arguments are</strong> <em><strong>copied</strong></em>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//When calling func (w Wallet) Deposit(amount int) the w is a copy of whatever we called the method from.</span></span><br><span class="line"><span class="comment">//*Wallet rather than Wallet which you can read as &quot;a pointer to a wallet</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Wallet)</span> <span class="title">Balance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> (*w).balance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pointer receivers: Methods with pointer receivers can modify the value to which the receiver points. Since methods often need to modify their receiver, pointer receivers are more common than value receivers.</span></span><br></pre></td></tr></table></figure><ul><li>ä¸å¯å¯»å€çš„æƒ…å†µï¼š</li></ul><ol><li><strong>ä¸å¯å˜çš„</strong>å€¼ä¸å¯å¯»å€ã€‚å¸¸é‡ã€åŸºæœ¬ç±»å‹çš„å€¼å­—é¢é‡ã€å­—ç¬¦ä¸²å˜é‡çš„å€¼ã€å‡½æ•°ä»¥åŠæ–¹æ³•çš„å­—é¢é‡éƒ½æ˜¯å¦‚æ­¤ã€‚å…¶å®è¿™æ ·è§„å®šä¹Ÿæœ‰å®‰å…¨æ€§æ–¹é¢çš„è€ƒè™‘ã€‚</li><li>ç»å¤§å¤šæ•°è¢«è§†ä¸º<strong>ä¸´æ—¶ç»“æœ</strong>çš„å€¼éƒ½æ˜¯ä¸å¯å¯»å€çš„ã€‚ç®—æœ¯æ“ä½œçš„ç»“æœå€¼å±äºä¸´æ—¶ç»“æœï¼Œé’ˆå¯¹å€¼å­—é¢é‡çš„è¡¨è¾¾å¼ç»“æœå€¼ä¹Ÿå±äºä¸´æ—¶ç»“æœã€‚ä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå¯¹åˆ‡ç‰‡å­—é¢é‡çš„ç´¢å¼•ç»“æœå€¼è™½ç„¶ä¹Ÿå±äºä¸´æ—¶ç»“æœï¼Œä½†å´æ˜¯å¯å¯»å€çš„ã€‚</li><li>è‹¥æ‹¿åˆ°æŸå€¼çš„æŒ‡é’ˆå¯èƒ½ä¼šç ´åç¨‹åºçš„ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå°±æ˜¯<strong>ä¸å®‰å…¨çš„</strong>ï¼Œè¯¥å€¼å°±ä¸å¯å¯»å€ã€‚ç”±äºå­—å…¸çš„å†…éƒ¨æœºåˆ¶ï¼Œå¯¹å­—å…¸çš„ç´¢å¼•ç»“æœå€¼çš„å–å€æ“ä½œéƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚å¦å¤–ï¼Œè·å–ç”±å­—é¢é‡æˆ–æ ‡è¯†ç¬¦ä»£è¡¨çš„å‡½æ•°æˆ–æ–¹æ³•çš„åœ°å€æ˜¾ç„¶ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ã€‚</li></ol><h2 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value, ok := <span class="keyword">interface</span>&#123;&#125;(container).(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br></pre></td></tr></table></figure><h2 id="data-type"><a href="#data-type" class="headerlink" title="data type"></a>data type</h2><ul><li>å¼•ç”¨ç±»å‹ï¼šåˆ‡ç‰‡ã€å­—å…¸ã€é€šé“ã€å‡½æ•°</li><li>å€¼ç±»å‹ï¼šæ•°ç»„ã€åŸºç¡€æ•°æ®ç±»å‹ä»¥åŠç»“æ„ä½“ç±»å‹</li></ul><h1 id="concurrency"><a href="#concurrency" class="headerlink" title="concurrency"></a>concurrency</h1><blockquote><p>Do not communicate by sharing memory; instead, share memory by communicating.</p></blockquote><h2 id="backstone"><a href="#backstone" class="headerlink" title="backstone"></a>backstone</h2><p>PMG stands for P (logical <strong>p</strong>rocessors), M (<strong>m</strong>achine threads), and G (<strong>g</strong>oroutines). The key point is that each logical processor (P) can only have one machine thread (M) running on it at any time. And for a goroutine (G) to run, it needs to be attached to a thread (M).</p><h2 id="sync"><a href="#sync" class="headerlink" title="sync"></a>sync</h2><ul><li><p><code>Mutex</code> allows us to add locks to our data</p><blockquote><p>mutual exclusionï¼Œç®€ç§° mutex</p></blockquote></li><li><p><code>WaitGroup</code> is a means of waiting for goroutines to finish jobs</p></li><li><p><code>RWMutex</code> è¯»å†™é”</p></li></ul><h2 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h2><blockquote><p>they provide a way to send data from one goroutine to another, ensuring smooth communication and synchronization in concurrent programs.</p></blockquote><h1 id="concepts"><a href="#concepts" class="headerlink" title="concepts"></a>concepts</h1><ul><li>subroutines</li></ul><p>Every programmer today is familiar with function calls (subroutines): F calls G, which stops F and runs G. G does its work, potentially calling and waiting for other functions, and eventually returns. When G returns, G is gone and F continues running. In this pattern, only one function is running at a time, while its callers wait, all the way up the call stack.</p><ul><li>coroutines</li></ul><p>In contrast to subroutines, coroutines run concurrently on different stacks, but itâ€™s still true that only one is running at a time, while its caller waits. F starts G, but G does not run immediately. Instead, F must explicitly <em>resume</em> G, which then starts running. At any point, G may turn around and <em>yield</em> back to F. That pauses G and continues F from its resume operation. Eventually F calls resume again, which pauses F and continues G from its yield. On and on they go, back and forth, until G returns, which cleans up G and continues F from its most recent resume, with some signal to F that G is done and that F should no longer try to resume G. In this pattern, only one coroutine is running at a time, while its caller waits on a different stack. They take turns in a well-defined, coordinated manner.</p><h1 id="best-practise"><a href="#best-practise" class="headerlink" title="best practise"></a>best practise</h1><h2 id="directory"><a href="#directory" class="headerlink" title="directory"></a>directory</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">project-root/</span><br><span class="line">â”œâ”€â”€ cmd/  # åŒ…å«é¡¹ç›®çš„ä¸»è¦åº”ç”¨ç¨‹åºã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„å­ç›®å½•ã€‚</span><br><span class="line">â”‚   â””â”€â”€ myapp/</span><br><span class="line">â”‚       â””â”€â”€ main.go  # ä¸»åº”ç”¨ç¨‹åºå…¥å£ç‚¹</span><br><span class="line">â”œâ”€â”€ internal/  # åŒ…å«ä¸å¸Œæœ›å…¶ä»–é¡¹ç›®å¯¼å…¥çš„åŒ…</span><br><span class="line">â”‚   â”œâ”€â”€ app/  # åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘</span><br><span class="line">â”‚   â”‚   â””â”€â”€ app.go</span><br><span class="line">â”‚   â”œâ”€â”€ config/  # é…ç½®ç›¸å…³ä»£ç </span><br><span class="line">â”‚   â”‚   â””â”€â”€ config.go</span><br><span class="line">â”‚   â””â”€â”€ models/  # æ•°æ®æ¨¡å‹</span><br><span class="line">â”‚       â””â”€â”€ user.go</span><br><span class="line">â”œâ”€â”€ pkg/  # å¯ä»¥è¢«å¤–éƒ¨åº”ç”¨ç¨‹åºä½¿ç”¨çš„åº“ä»£ç </span><br><span class="line">â”‚   â”œâ”€â”€ database/  # æ•°æ®åº“æ“ä½œç›¸å…³ä»£ç </span><br><span class="line">â”‚   â”‚   â””â”€â”€ database.go</span><br><span class="line">â”‚   â””â”€â”€ utils/  # é€šç”¨å·¥å…·å‡½æ•°</span><br><span class="line">â”‚       â””â”€â”€ helper.go</span><br><span class="line">â”œâ”€â”€ api/  # APIç›¸å…³çš„ä»£ç ï¼Œå¦‚æœé¡¹ç›®æä¾›API</span><br><span class="line">â”‚   â””â”€â”€ v1/</span><br><span class="line">â”‚       â””â”€â”€ api.go</span><br><span class="line">â”œâ”€â”€ web/  # Webåº”ç”¨ç›¸å…³çš„æ–‡ä»¶ï¼Œå¦‚æ¨¡æ¿å’Œé™æ€èµ„äº§</span><br><span class="line">â”‚   â”œâ”€â”€ templates/</span><br><span class="line">â”‚   â””â”€â”€ static/</span><br><span class="line">â”œâ”€â”€ scripts/  # å„ç§å·¥å…·è„šæœ¬ï¼Œå¦‚æ•°æ®åº“è¿ç§»è„šæœ¬</span><br><span class="line">â”‚   â””â”€â”€ migrate.go</span><br><span class="line">â”œâ”€â”€ tests/  # å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•</span><br><span class="line">â”‚   â””â”€â”€ app_test.go</span><br><span class="line">â”œâ”€â”€ docs/  # é¡¹ç›®æ–‡æ¡£</span><br><span class="line">â”‚   â””â”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ go.mod  # Goæ¨¡å—æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ go.sum</span><br><span class="line">â”œâ”€â”€ .gitignore</span><br><span class="line">â””â”€â”€ README.md</span><br></pre></td></tr></table></figure><h2 id="dependency"><a href="#dependency" class="headerlink" title="dependency"></a>dependency</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> get depends by specify branch</span></span><br><span class="line">go get github.com/jackblack369/minio@feat-gateway</span><br></pre></td></tr></table></figure><h1 id="Paraphrasing"><a href="#Paraphrasing" class="headerlink" title="Paraphrasing"></a>Paraphrasing</h1><ul><li><p>Use channels when passing ownership of data</p></li><li><p>Use mutexes for managing state</p></li><li><p>åç§°çš„é¦–å­—æ¯ä¸ºå¤§å†™çš„ç¨‹åºå®ä½“æ‰å¯ä»¥è¢«å½“å‰åŒ…å¤–çš„ä»£ç å¼•ç”¨ï¼Œå¦åˆ™å®ƒå°±åªèƒ½è¢«å½“å‰åŒ…å†…çš„å…¶ä»–ä»£ç å¼•ç”¨ã€‚</p></li><li><p>ä¸€å¯¹ä¸åŒ…è£¹ä»»ä½•ä¸œè¥¿çš„èŠ±æ‹¬å·ï¼Œé™¤äº†å¯ä»¥ä»£è¡¨ç©ºçš„ä»£ç å—ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºè¡¨ç¤ºä¸åŒ…å«ä»»ä½•å†…å®¹çš„æ•°æ®ç»“æ„ï¼ˆæˆ–è€…è¯´æ•°æ®ç±»å‹ï¼‰</p></li><li><p>å‡½æ•°ç±»å‹å±äºå¼•ç”¨ç±»å‹ï¼Œå®ƒçš„é›¶å€¼æ˜¯<code>nil</code>ã€‚</p></li><li><p>ç»“æ„ä½“ç±»å‹ä¸­çš„ä¸€ä¸ªå­—æ®µçœ‹ä½œæ˜¯å®ƒçš„ä¸€ä¸ªå±æ€§æˆ–è€…ä¸€é¡¹æ•°æ®ï¼Œå†æŠŠéš¶å±äºå®ƒçš„ä¸€ä¸ªæ–¹æ³•çœ‹ä½œæ˜¯é™„åŠ åœ¨å…¶ä¸­æ•°æ®ä¹‹ä¸Šçš„ä¸€ä¸ªèƒ½åŠ›æˆ–è€…ä¸€é¡¹æ“ä½œã€‚å°†å±æ€§åŠå…¶èƒ½åŠ›ï¼ˆæˆ–è€…è¯´æ•°æ®åŠå…¶æ“ä½œï¼‰å°è£…åœ¨ä¸€èµ·ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆobject-oriented programmingï¼‰çš„ä¸€ä¸ªä¸»è¦åŸåˆ™ã€‚</p></li></ul><h1 id="A-vs-B"><a href="#A-vs-B" class="headerlink" title="A vs B"></a>A vs B</h1><ul><li>Golangâ€™s goroutine VS Pythonâ€™s coroutine</li></ul><table><thead><tr><th><strong>Aspect</strong></th><th><strong>Go (Goroutines)</strong></th><th><strong>Python (Coroutines)</strong></th></tr></thead><tbody><tr><td><strong>Concurrency Model</strong></td><td>Preemptive, managed by Go runtime (M:N threading)</td><td>Cooperative, event-loop-based (async/await)</td></tr><tr><td><strong>Execution Model</strong></td><td>True concurrency, can run in parallel on multiple cores</td><td>Single-threaded, asynchronous (mostly I/O-bound)</td></tr><tr><td><strong>Syntax</strong></td><td><code>go func()</code></td><td><code>async def</code> and <code>await</code></td></tr><tr><td><strong>Task Management</strong></td><td>Automatic, via Go runtime</td><td>Manual, via event loop (e.g., <code>asyncio</code>)</td></tr><tr><td><strong>Performance</strong></td><td>Efficient, ideal for both I/O-bound and CPU-bound tasks</td><td>Efficient for I/O-bound, not CPU-bound tasks</td></tr><tr><td><strong>Error Handling</strong></td><td>Requires manual management via channels or sync</td><td>Propagates through <code>await</code>/event loop</td></tr></tbody></table><p><strong>1. Scheduling:</strong></p><p><strong>Goroutines:</strong> In Go, a goroutine is a lightweight thread that runs concurrently with other goroutines in the same process. The scheduler of the operating system determines which goroutine to run next.</p><p> <strong>Coroutines:</strong> In Python, a coroutine is an asynchronous function that can suspend its execution at specific points and resume from there later. Coroutines are scheduled by the runtime environment (e.g., CPython) itself.</p><p><strong>2. Context switching:</strong></p><p> <strong>Goroutines:</strong> In Go, context switching between goroutines is relatively cheap because goroutines share the same memory space as their parent process.</p><p> <strong>Coroutines:</strong> In Python, context switching between coroutines can be more expensive because each coroutine has its own stack and local variables.</p><p><strong>3. Yielding control:</strong></p><p> <strong>Goroutines:</strong> Goâ€™s goroutines do not have a concept of yielding control to another goroutine or task. Once a goroutine is scheduled, it runs until completion.</p><p> <strong>Coroutines:</strong> Python coroutines can yield control to other coroutines using the <code>yield</code> keyword, allowing them to suspend and resume their execution at specific points.</p><p><strong>4. Looping:</strong></p><p> <strong>Goroutines:</strong> Goâ€™s goroutines do not have a loop mechanism like Pythonâ€™s coroutines. Goroutines must be scheduled manually using <code>runtime.Gosched()</code> or other scheduling APIs.</p><p> <strong>Coroutines:</strong> Python coroutines can use loops, such as <code>for</code> loops, to iterate over data and switch between different coroutine implementations.</p><p><strong>5. Error handling:</strong></p><p> <strong>Goroutines:</strong> Goâ€™s goroutines handle errors internally when a panic occurs. The parent process receives the error through the <code>main</code> function.</p><p> <strong>Coroutines:</strong> Python coroutines can also handle errors, but they typically use exceptions or try-except blocks to manage errors.</p><p><strong>6. Global variables:</strong></p><p> <strong>Goroutines:</strong> Goâ€™s goroutines do not have access to global variables by default. They must be passed explicitly using channels or shared data structures.</p><p> <strong>Coroutines:</strong> Python coroutines can access global variables, but itâ€™s generally recommended to avoid sharing mutable state between coroutines.</p><h1 id="ide"><a href="#ide" class="headerlink" title="ide"></a>ide</h1><h2 id="vscode"><a href="#vscode" class="headerlink" title="vscode"></a>vscode</h2><ul><li><p>enable debug</p><p><strong>First options</strong> is to fix it by running <code>&quot;Go: Install/Update Tools&quot;</code> command from the Command Palette (<em><strong>Linux/Windows</strong></em>: Ctrl+Shift+P, <em><strong>Mac</strong></em>: â‡§+âŒ˜+P). Then, mark <code>dlv</code> &amp; <code>dlv-dap</code> from the menu, and hit <strong>ok</strong> to start install/update.</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> GO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>code thought</title>
      <link href="/2024/07/25/code%20thought/"/>
      <url>/2024/07/25/code%20thought/</url>
      
        <content type="html"><![CDATA[<h2 id="TDD"><a href="#TDD" class="headerlink" title="TDD"></a>TDD</h2><p>TDD, or Test-Driven Development, is a software development process that involves writing automated tests before writing the actual code. In other words, you write the test first, and then you implement the code to make the test pass.</p><p>Hereâ€™s how it typically works:</p><ol><li><p><strong>Write a test</strong>: You write an automated test that covers a specific piece of functionality or behavior in your system.</p></li><li><p><strong>Run the test and see it fail</strong>: Since you havenâ€™t implemented the code yet, the test will naturally fail.</p></li><li><p><strong>Write the code</strong>: You then implement the code to make the test pass. This is where you write the actual logic, algorithms, or whatever is needed to satisfy the requirements of the test.</p></li><li><p><strong>Run the test and see it pass</strong>: Now that youâ€™ve written the code, run the test again, and if everything is correct, the test should pass!</p></li><li><p><strong>Refactor the code (if needed)</strong>: If there are any issues with the code or if you can improve the design, you refactor the code to make it more maintainable, efficient, or easier to understand.</p></li></ol><p>The key benefits of TDD include:</p><ol><li><p><strong>Improved code quality</strong>: Writing tests before writing code ensures that your code is robust and meets the requirements.</p></li><li><p><strong>Reduced bugs</strong>: By testing each piece of functionality thoroughly, you can catch errors early on, reducing the overall number of bugs in your system.</p></li><li><p><strong>Faster development</strong>: TDD helps you focus on implementing only whatâ€™s necessary to pass the test, making your development process more efficient.</p></li><li><p><strong>Better design</strong>: The process of writing tests and then implementing code encourages good design principles, such as separation of concerns, modularity, and maintainability.</p></li></ol><p>TDD is often used in conjunction with other testing methodologies, like unit testing, integration testing, or acceptance testing, to ensure that your software system is thoroughly tested and reliable.</p><h1 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h1><ul><li><p><a href="http://wiki.c2.com/?MakeItWorkMakeItRightMakeItFast">Make it work, make it right, make it fast</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Where &#x27;work&#x27; is making the tests pass, &#x27;right&#x27; is refactoring the code, and &#x27;fast&#x27; is optimizing the code to make it, for example, run quickly. We can only &#x27;make it fast&#x27; once we&#x27;ve made it work and made it right. We were lucky that the code we were given was already demonstrated to be working, and didn&#x27;t need to be refactored. We should never try to &#x27;make it fast&#x27; before the other two steps have been performed because[Premature optimization is the root of all evil](http://wiki.c2.com/?PrematureOptimization)</span><br></pre></td></tr></table></figure></li><li><p><a href="https://en.wikipedia.org/wiki/If_it_ain't_broke,_don't_fix_it">If it ainâ€™t broke, donâ€™t fix it</a> </p></li><li><p><a href="https://en.wikipedia.org/wiki/KISS_principle">KISS principle</a> </p></li><li><p><a href="https://en.wikipedia.org/wiki/Don't_repeat_yourself">Donâ€™t repeat yourself</a> </p></li><li><p><a href="https://en.wikipedia.org/wiki/Feature_creep">Feature creep</a> </p></li><li><p><a href="https://en.wikipedia.org/wiki/List_of_software_development_philosophies">List of software development philosophies</a> -</p></li><li><p><a href="https://en.wikipedia.org/wiki/Minimum_viable_product">Minimum viable product</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/MoSCoW_method">MoSCoW method</a> </p></li><li><p><a href="https://en.wikipedia.org/wiki/Overengineering">Overengineering</a> </p></li><li><p><a href="https://en.wikipedia.org/wiki/Worse_is_better">Worse is better</a> </p></li><li><p><a href="https://en.wikipedia.org/wiki/SOLID">S.O.L.I.D.</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Unix_philosophy">Unix philosophy</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> thought </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jwt points</title>
      <link href="/2024/06/27/jwt/"/>
      <url>/2024/06/27/jwt/</url>
      
        <content type="html"><![CDATA[<p>JWT ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œç”¨ . åˆ†éš”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJrZXkiOiJ1c2VyLWtleSIsImV4cCI6MTU2NDA1MDgxMX0.Us8zh_4VjJXF-TmR5f8cif8mBU7SuefPlpxhH0jbPVI</span><br></pre></td></tr></table></figure><p>â€‹    1.    Headerï¼ˆå¤´éƒ¨ï¼‰ï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</p><p>â€‹    2.    Payloadï¼ˆè´Ÿè½½ï¼‰ï¼šeyJrZXkiOiJ1c2VyLWtleSIsImV4cCI6MTU2NDA1MDgxMX0</p><p>â€‹    3.    Signatureï¼ˆç­¾åï¼‰ï¼šUs8zh_4VjJXF-TmR5f8cif8mBU7SuefPlpxhH0jbPVI</p><ul><li><p><strong>å¯ç›´æ¥ä½¿ç”¨ Base64 è§£ç  Header å’Œ Payload</strong></p></li><li><p><strong>signatureéªŒç­¾</strong></p><p>ä½¿ç”¨ Headeré‡Œé¢çš„ç®—æ³•éªŒè¯ç­¾åéœ€è¦ç”¨åˆ°ä¸ç­¾åæ—¶ç›¸åŒçš„å¯†é’¥ï¼ˆå…¬é’¥ï¼‰ã€‚ä»¥ä¸‹æ˜¯éªŒè¯ç­¾åçš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify_signature</span>(<span class="params">header, payload, secret, signature</span>):</span></span><br><span class="line">    message = <span class="string">f&quot;<span class="subst">&#123;header&#125;</span>.<span class="subst">&#123;payload&#125;</span>&quot;</span></span><br><span class="line">    expected_signature = hmac.new(secret.encode(), message.encode(), hashlib.sha256).digest()</span><br><span class="line">    expected_signature_base64 = base64.urlsafe_b64encode(expected_signature).rstrip(<span class="string">b&#x27;=&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> hmac.compare_digest(expected_signature_base64, signature)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹å¯†é’¥ï¼ˆæ›¿æ¢ä¸ºå®é™…çš„å¯†é’¥ï¼‰</span></span><br><span class="line">secret = <span class="string">&quot;your-256-bit-secret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ç­¾å</span></span><br><span class="line">is_valid = verify_signature(header, payload, secret, signature)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Signature is valid: <span class="subst">&#123;is_valid&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> jwt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python pytest</title>
      <link href="/2024/05/20/python%20pytest/"/>
      <url>/2024/05/20/python%20pytest/</url>
      
        <content type="html"><![CDATA[<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><ul><li><p>æŸ¥çœ‹æµ‹è¯•è¯¦æƒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -v</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•ä¿¡æ¯æ‰“å°</p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œpytest ä¼šæ•è·æ‰€æœ‰çš„è¾“å‡ºã€‚è¿™æ„å‘³ç€åœ¨æµ‹è¯•è¿è¡ŒæœŸé—´ï¼Œ <code>print</code> è¯­å¥çš„è¾“å‡ºä¸ä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚</p><p>å¦‚æœæƒ³çœ‹åˆ° <code>print</code> è¯­å¥çš„è¾“å‡ºï¼Œéœ€è¦ä½¿ç”¨ <code>-s</code> é€‰é¡¹æ¥å‘Šè¯‰ pytest ä¸è¦æ•è·è¾“å‡º</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -s test_web_base.py</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•æŒ‡å®šæ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest tests/unit_tests/document_loaders/test_web_base.py::ç±»å::æ–¹æ³•å</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•è¢«æ ‡è®°çš„æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.finished</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_func1</span>():</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">1</span> == <span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -m finished tests/test-function/test_with_mark.py</span><br></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest --html=report.html</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pytest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>conda</title>
      <link href="/2024/03/14/conda/"/>
      <url>/2024/03/14/conda/</url>
      
        <content type="html"><![CDATA[<h1 id="install"><a href="#install" class="headerlink" title="install"></a>install</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> download binary</span></span><br><span class="line">mkdir -p ~/miniconda3</span><br><span class="line">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh</span><br><span class="line">bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3</span><br><span class="line">rm ~/miniconda3/miniconda.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active</span></span><br><span class="line">source ~/miniconda3/bin/activate</span><br><span class="line">conda init --all</span><br></pre></td></tr></table></figure><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><ul><li><p>æŸ¥çœ‹ç¯å¢ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda env list</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºç¯å¢ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create --name your_env_name</span><br></pre></td></tr></table></figure><p>æŒ‡å®špythonç‰ˆæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create --name xxx python=3.10</span><br></pre></td></tr></table></figure></li><li><p>æ¿€æ´»ç¯å¢ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate xxx</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ç¯å¢ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda remove --name xxx --all</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> conda </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>copilot</title>
      <link href="/2024/03/13/copilot/"/>
      <url>/2024/03/13/copilot/</url>
      
        <content type="html"><![CDATA[<h1 id="keywords"><a href="#keywords" class="headerlink" title="keywords"></a>keywords</h1><ul><li><p>æç¤ºå†…å®¹å†™å…¥ â¡ï¸</p></li><li><p>ä¸‹ä¸€ä¸ªæç¤º <code>option + ]</code>ï¼Œä¸Šä¸€ä¸ªæç¤º <code>option + [</code></p></li><li><p>æ¥æ”¶ä¸€è¡Œ<code>command + å³æ–¹å‘</code> ï¼Œå¤šè¡Œ <code>control/fn + command + å³æ–¹å‘</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> copilot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> assistant </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GPU learn</title>
      <link href="/2024/03/08/GPU%20learn/"/>
      <url>/2024/03/08/GPU%20learn/</url>
      
        <content type="html"><![CDATA[<h1 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h1><ul><li><p>æŸ¥çœ‹å¡çš„æ•°é‡</p><p><code>nvidia-smi -L</code></p></li><li><p>æŸ¥çœ‹æ˜¾å¡ä¸Šè¿è¡Œçš„ç¨‹åºï¼Œä»¥åŠæ‰€å å†…å­˜æƒ…å†µ</p><p><code>nvidia-smi --query-compute-apps=pid,process_name,used_memory,gpu_uuid --format=csv</code></p></li><li><p>æŸ¥çœ‹æ˜¾å¡æ‰€å‰©å†…å­˜</p><p><code>nvidia-smi --query-gpu=memory.free --format=csv,noheader,nounits</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> GPU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python pkg</title>
      <link href="/2024/03/05/python%20pkg/"/>
      <url>/2024/03/05/python%20pkg/</url>
      
        <content type="html"><![CDATA[<h1 id="pydanic"><a href="#pydanic" class="headerlink" title="pydanic"></a>pydanic</h1><h2 id="model-validator"><a href="#model-validator" class="headerlink" title="model_validator"></a>model_validator</h2><blockquote><p><code>model_validator</code> æ˜¯ Pydantic åº“æä¾›çš„ä¸€ä¸ªè£…é¥°å™¨ï¼Œç”¨äºå®šä¹‰æ¨¡å‹éªŒè¯å™¨å‡½æ•°ã€‚æ¨¡å‹éªŒè¯å™¨å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œç”¨äºåœ¨åˆ›å»ºæ¨¡å‹å®ä¾‹æˆ–æ›´æ–°æ¨¡å‹å±æ€§æ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„éªŒè¯é€»è¾‘ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@model_validator(<span class="params">mode=<span class="string">&quot;after&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_engine_and_run_func</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">if</span> self.search_engine <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        self.search_engine = SearchEngine.from_search_config(self.config.search, proxy=self.config.proxy)</span><br><span class="line">    <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@model_validator(<span class="params">mode=<span class="string">&quot;before&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_google</span>(<span class="params">cls, values: <span class="built_in">dict</span></span>) -&gt; <span class="built_in">dict</span>:</span></span><br><span class="line">  ...</span><br><span class="line">  </span><br><span class="line">å…¶ä¸­values æ˜¯å®ä¾‹åŒ–å¯¹è±¡çš„æ‰€æœ‰å‚æ•°</span><br></pre></td></tr></table></figure><h1 id="sqlmodel"><a href="#sqlmodel" class="headerlink" title="sqlmodel"></a>sqlmodel</h1><h2 id="å•ä¸ªå®ä½“è½¬æ¢ä¸ºå­—å…¸"><a href="#å•ä¸ªå®ä½“è½¬æ¢ä¸ºå­—å…¸" class="headerlink" title="å•ä¸ªå®ä½“è½¬æ¢ä¸ºå­—å…¸"></a>å•ä¸ªå®ä½“è½¬æ¢ä¸ºå­—å…¸</h2><ul><li>æ–¹å¼ä¸€</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å®ä¾‹å¯¹è±¡è½¬æ¢ä¸ºå­—å…¸ï¼Œæ’é™¤æœªè®¾ç½®å€¼çš„å­—æ®µ</span></span><br><span class="line">entity_dict = entity.<span class="built_in">dict</span>(exclude_unset=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨ Pydantic æ¨¡å‹å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå°†æ¨¡å‹å¯¹è±¡è½¬æ¢ä¸ºå­—å…¸å½¢å¼ã€‚<code>exclude_unset=True</code> å‚æ•°æ˜¯ç”¨æ¥æ§åˆ¶æ˜¯å¦æ’é™¤æœªè®¾ç½®çš„å±æ€§å­—æ®µã€‚å½“è®¾ç½®ä¸º <code>True</code> æ—¶ï¼Œå°†æ’é™¤é‚£äº›æœªè®¾ç½®å€¼çš„å­—æ®µï¼Œå³åªåŒ…å«å·²ç»è®¾ç½®å€¼çš„å­—æ®µã€‚</p></blockquote><ul><li><p>æ–¹å¼äºŒï¼š</p><p>éå†å­—å…¸ï¼ˆå¯¹æ²¡æœ‰è®¾ç½®çš„å­—æ®µè¿›è¡Œé»˜è®¤å€¼è®¾ç½®ï¼Œè®¾ç½®æ’æŸ¥æŸå­—æ®µæ”¾å…¥å­—å…¸ï¼‰</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> user_group_data.<span class="built_in">dict</span>(exclude_unset=<span class="literal">True</span>, exclude=&#123;<span class="string">&quot;team_roles&quot;</span>&#125;).items():</span><br><span class="line"><span class="keyword">if</span> value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line"><span class="built_in">setattr</span>(user_group, key, value)</span><br></pre></td></tr></table></figure><ul><li>æ–¹å¼ä¸‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resourceCreate: ResourceCreate</span><br><span class="line">...</span><br><span class="line">resource = Resource(**resourceCreate.<span class="built_in">dict</span>())</span><br></pre></td></tr></table></figure><h2 id="å•ä¸ªå®ä½“ä¸å®ä½“è½¬æ¢"><a href="#å•ä¸ªå®ä½“ä¸å®ä½“è½¬æ¢" class="headerlink" title="å•ä¸ªå®ä½“ä¸å®ä½“è½¬æ¢"></a>å•ä¸ªå®ä½“ä¸å®ä½“è½¬æ¢</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">role_update: RoleUpdate</span><br><span class="line">...</span><br><span class="line">role = Role.from_orm(role_update)</span><br></pre></td></tr></table></figure><h2 id="åˆ—è¡¨å®ä½“è½¬æ¢ä¸ºå­—å…¸åˆ—è¡¨"><a href="#åˆ—è¡¨å®ä½“è½¬æ¢ä¸ºå­—å…¸åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨å®ä½“è½¬æ¢ä¸ºå­—å…¸åˆ—è¡¨"></a>åˆ—è¡¨å®ä½“è½¬æ¢ä¸ºå­—å…¸åˆ—è¡¨</h2><ul><li>æ–¹å¼ä¸€ <strong>session.query</strong> </li></ul><blockquote><p>åœ¨ç›´æ¥è¿”å› æŸ¥è¯¢ç»“æ„çš„æ—¶å€™ï¼Œä¼˜å…ˆä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥æŠŠç»“æœè½¬ä¸ºjsonï¼ˆe.g. res_json = jsonable_encoder(res_data)ï¼‰</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db_rel_usergroup_roles = (session.query(RelUserGroupUser.user_id, Role.<span class="built_in">id</span>, Role.name, Role.nick_name, Role.label)</span><br><span class="line">                             .join(RelUsergroupRole, RelUserGroupUser.usergroup_id == RelUsergroupRole.usergroup_id)</span><br><span class="line">                             .join(Role, RelUsergroupRole.role_id == Role.<span class="built_in">id</span>)</span><br><span class="line">                             .<span class="built_in">filter</span>(RelUserGroupUser.user_id == user_id)</span><br><span class="line">                             .<span class="built_in">all</span>())</span><br><span class="line">        rel_usergroup_roles_info = []</span><br><span class="line">        <span class="keyword">for</span> rel_usergroup_role <span class="keyword">in</span> db_rel_usergroup_roles:</span><br><span class="line">            rel_usergroup_roles_info.append(Role(</span><br><span class="line">                <span class="built_in">id</span>=rel_usergroup_role[<span class="number">1</span>],</span><br><span class="line">                name=rel_usergroup_role[<span class="number">2</span>],</span><br><span class="line">                nick_name=rel_usergroup_role[<span class="number">3</span>],</span><br><span class="line">                label=rel_usergroup_role[<span class="number">4</span>]</span><br><span class="line">            ))</span><br><span class="line">        <span class="keyword">return</span> rel_usergroup_roles_info</span><br></pre></td></tr></table></figure><ul><li>æ–¹å¼äºŒ <strong>session.exec</strong></li></ul><blockquote><p>åœ¨éœ€è¦ç‰¹æ®Šå¤„ç†æŸ¥è¯¢çš„ä¸åŒå­—æ®µä¿¡æ¯æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æ­¤æ–¹æ³•</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rel_usergroup_user_list = session.<span class="built_in">exec</span>(</span><br><span class="line">            select(RelUserGroupUser.usergroup_id, RelUserGroupUser.user_id, UserGroup.name, UserGroup.label, UserGroup.remark)</span><br><span class="line">            .where(RelUserGroupUser.user_id == user_id)</span><br><span class="line">            .join(UserGroup, UserGroup.<span class="built_in">id</span> == RelUserGroupUser.usergroup_id)</span><br><span class="line">        ).<span class="built_in">all</span>()</span><br><span class="line">        converted_list = []</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> rel_usergroup_user_list:</span><br><span class="line">            converted_obj = RelUserGroupUserRead(</span><br><span class="line">                user_id=row.user_id,</span><br><span class="line">                usergroup_id=row.usergroup_id,</span><br><span class="line">                usergroup_name=row.name,</span><br><span class="line">                usergroup_label=row.label</span><br><span class="line">            )</span><br><span class="line">            converted_list.append(converted_obj)</span><br><span class="line">        <span class="keyword">return</span> converted_list</span><br></pre></td></tr></table></figure><ul><li></li></ul><h2 id="æŸ¥è¯¢è¿‡æ»¤"><a href="#æŸ¥è¯¢è¿‡æ»¤" class="headerlink" title="æŸ¥è¯¢è¿‡æ»¤"></a>æŸ¥è¯¢è¿‡æ»¤</h2><ul><li><p>ç­›é€‰æ¡ä»¶ä¸ºæˆ–æ¡ä»¶</p></li><li><p>```python<br>resource_list = session.query(Resource).filter(or_(Resource.type == â€œmenuâ€, Resource.type == â€œelementâ€)).all()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## updateæ“ä½œ</span><br><span class="line"></span><br><span class="line">å¦‚æœæå‰æœ‰ `session.get(entity, id)`ï¼Œé‚£åç»­åœ¨ä¿®æ”¹ç›¸å…³è¡¨å±æ€§`enitty.colx = xxx` ä¹‹åï¼Œéœ€è¦ç´§æ¥`session.add(entity)`</span><br><span class="line"></span><br><span class="line">### sessionçš„è·å–</span><br><span class="line"></span><br><span class="line">åœ¨ä½¿ç”¨ SQLModel è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ `with Session(engine) as session` æ¥åˆ›å»ºå¹¶ç®¡ç†æ•°æ®åº“ä¼šè¯ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä¼šè¯åœ¨ä½¿ç”¨å®Œæ¯•åä¼šè¢«æ­£ç¡®å…³é—­ï¼Œé‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æºã€‚</span><br><span class="line"></span><br><span class="line">åœ¨ä¾‹å¦‚ `async def delete_user(*, user_id: int, session: Session = Depends(get_session)):`ä¸­ï¼Œ`session` å‚æ•°æ˜¯é€šè¿‡ `Depends(get_session)` è¿›è¡Œä¾èµ–æ³¨å…¥çš„ï¼ŒFastAPI æ¡†æ¶ä¼šè´Ÿè´£åœ¨è¯·æ±‚å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨å…³é—­ä¼šè¯ã€‚æ‰€ä»¥åœ¨è¯·æ±‚é€»è¾‘ä¸­ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨å…³é—­ä¼šè¯è¿æ¥ã€‚</span><br><span class="line"></span><br><span class="line">## in_è¯­æ³•ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">## session.exec vs session.query</span><br><span class="line"></span><br><span class="line">åœ¨SQLAlchemyä¸­ï¼Œ`session.query`å’Œ`session.exec`éƒ½å¯ä»¥ç”¨æ¥æ‰§è¡ŒSQLæŸ¥è¯¢ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚</span><br><span class="line"></span><br><span class="line">`session.query`æ˜¯SQLAlchemy ORMçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè¿”å›çš„æ˜¯æ¨¡å‹å¯¹è±¡ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨Pythonçš„å±æ€§å’Œæ–¹æ³•æ¥è®¿é—®å’Œæ“ä½œè¿”å›çš„æ•°æ®ã€‚è¿™å¯¹äºç¼–å†™é¢å‘å¯¹è±¡çš„ä»£ç éå¸¸æœ‰ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">users = session.query(User).filter(User.name == &#x27;John&#x27;).all()</span><br><span class="line">for user in users:</span><br><span class="line">    print(user.id, user.name)</span><br></pre></td></tr></table></figure></li></ul><p>å¦ä¸€æ–¹é¢ï¼Œ<code>session.exec</code>æ˜¯SQLAlchemy Coreçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè¿”å›çš„æ˜¯åŸå§‹çš„SQLç»“æœã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ä½¿ç”¨åˆ—åä½œä¸ºå­—ç¬¦ä¸²æ¥è®¿é—®è¿”å›çš„æ•°æ®ã€‚è¿™å¯¹äºæ‰§è¡Œå¤æ‚çš„SQLæŸ¥è¯¢æˆ–è€…éœ€è¦æ›´æ¥è¿‘SQLçš„æ€§èƒ½ä¼˜åŒ–å¯èƒ½æ›´æœ‰ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = session.<span class="built_in">exec</span>(select(User).where(User.name == <span class="string">&#x27;John&#x27;</span>))</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(row[<span class="string">&#x27;id&#x27;</span>], row[<span class="string">&#x27;name&#x27;</span>])</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è¯´:</p><p>å¦‚æœæ­£åœ¨ç¼–å†™é¢å‘å¯¹è±¡çš„ä»£ç ï¼Œæˆ–è€…æŸ¥è¯¢ç›¸å¯¹ç®€å•ï¼Œé‚£ä¹ˆ<code>session.query</code>å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><p>å¦‚æœéœ€è¦æ‰§è¡Œå¤æ‚çš„SQLæŸ¥è¯¢ï¼Œæˆ–è€…éœ€è¦æ›´æ¥è¿‘SQLçš„æ€§èƒ½ä¼˜åŒ–ï¼Œé‚£ä¹ˆ<code>session.exec</code>å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><h1 id="auth"><a href="#auth" class="headerlink" title="auth"></a>auth</h1><blockquote><p>Security is always excessive until itâ€™s not enough.</p></blockquote><h2 id="fastapi-jwt-auth"><a href="#fastapi-jwt-auth" class="headerlink" title="fastapi jwt auth"></a>fastapi jwt auth</h2><p>åœ¨ FastAPI JWT Auth ä¸­ï¼ŒRefresh Tokenï¼ˆåˆ·æ–°ä»¤ç‰Œï¼‰å’Œ Access Tokenï¼ˆè®¿é—®ä»¤ç‰Œï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„ä»¤ç‰Œï¼Œç”¨äºå®ç°è®¤è¯å’Œæˆæƒæœºåˆ¶ã€‚</p><ol><li>Access Tokenï¼ˆè®¿é—®ä»¤ç‰Œï¼‰ï¼šAccess Token æ˜¯ä¸€ä¸ªçŸ­æœŸçš„ä»¤ç‰Œï¼Œç”¨äºéªŒè¯ç”¨æˆ·çš„èº«ä»½å¹¶æˆæƒç”¨æˆ·è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚Access Token æ˜¯é€šè¿‡ç”¨æˆ·æä¾›çš„å‡­è¯ï¼ˆå¦‚ç”¨æˆ·åå’Œå¯†ç ï¼‰è¿›è¡Œèº«ä»½éªŒè¯åç”Ÿæˆçš„ï¼Œé€šå¸¸å…·æœ‰è¾ƒçŸ­çš„æœ‰æ•ˆæœŸï¼ˆä¾‹å¦‚å‡ åˆ†é’Ÿæˆ–å‡ å°æ—¶ï¼‰ã€‚å®¢æˆ·ç«¯åœ¨æ¯æ¬¡è¯·æ±‚å—ä¿æŠ¤çš„èµ„æºæ—¶ï¼Œéœ€è¦åœ¨è¯·æ±‚çš„å¤´éƒ¨æˆ–è¯·æ±‚å‚æ•°ä¸­æºå¸¦ Access Tokenï¼Œä»¥è¯æ˜å…¶æœ‰æƒè®¿é—®è¯¥èµ„æºã€‚</li><li>Refresh Tokenï¼ˆåˆ·æ–°ä»¤ç‰Œï¼‰ï¼šRefresh Token æ˜¯ä¸€ä¸ªé•¿æœŸæœ‰æ•ˆçš„ä»¤ç‰Œï¼Œç”¨äºåœ¨ Access Token è¿‡æœŸåé‡æ–°è·å–æ–°çš„ Access Tokenã€‚å½“ Access Token è¿‡æœŸæ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ Refresh Token å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ¥è·å–æ–°çš„ Access Tokenï¼Œè€Œæ— éœ€é‡æ–°æä¾›ç”¨æˆ·åå’Œå¯†ç ç­‰å‡­è¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒRefresh Token çš„æœ‰æ•ˆæœŸè¦æ¯” Access Token æ›´é•¿ã€‚</li></ol><p>ä½¿ç”¨ Refresh Token çš„ä¸»è¦ç›®çš„æ˜¯å¢å¼ºå®‰å…¨æ€§å’Œå‡å°‘é¢‘ç¹çš„èº«ä»½éªŒè¯æ“ä½œã€‚é€šè¿‡å°† Access Token çš„æœ‰æ•ˆæœŸè®¾ç½®è¾ƒçŸ­ï¼Œå¯ä»¥é™ä½ä»¤ç‰Œæ³„éœ²çš„é£é™©ã€‚å½“ Access Token è¿‡æœŸæ—¶ï¼Œä½¿ç”¨ Refresh Token è·å–æ–°çš„ Access Tokenï¼Œè¿™æ ·å¯ä»¥å‡å°‘é¢‘ç¹åœ°è¦æ±‚ç”¨æˆ·é‡æ–°æä¾›å‡­è¯çš„æƒ…å†µã€‚</p><p>ä¸€èˆ¬çš„æµç¨‹æ˜¯ï¼Œå®¢æˆ·ç«¯åœ¨è¿›è¡Œèº«ä»½éªŒè¯åä¼šæ”¶åˆ°ä¸€ä¸ª Access Token å’Œä¸€ä¸ª Refresh Tokenã€‚å®¢æˆ·ç«¯ä½¿ç”¨ Access Token æ¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼Œå½“ Access Token è¿‡æœŸæ—¶ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ Refresh Token å‘æœåŠ¡å™¨è¯·æ±‚æ–°çš„ Access Tokenã€‚</p><p>FastAPI JWT Auth æä¾›äº†ç›¸åº”çš„åŠŸèƒ½å’Œè£…é¥°å™¨æ¥å¤„ç† Access Token å’Œ Refresh Token çš„ç”Ÿæˆã€éªŒè¯å’Œåˆ·æ–°ç­‰æ“ä½œï¼Œä»¥æ–¹ä¾¿å®ç° JWT è®¤è¯å’Œæˆæƒã€‚</p><p>refresh tokens <strong>cannot access</strong> an endpoint that is protected with <strong>jwt_required()</strong>, <strong>jwt_optional()</strong>, and <strong>fresh_jwt_required()</strong> </p><p>access tokens <strong>cannot access</strong> an endpoint that is protected with <strong>jwt_refresh_token_required()</strong>.</p><ul><li>Refresh Tokens</li></ul><p>These are long-lived tokens which can be used to create a new access tokens once an old access token has expired. </p><h1 id="TBD"><a href="#TBD" class="headerlink" title="TBD"></a>TBD</h1><ul><li>fire</li><li>networkx</li></ul>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pkg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>llm agent</title>
      <link href="/2024/01/24/llm%20agent/"/>
      <url>/2024/01/24/llm%20agent/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Agent = Large Language Model (LLM) + Observation + Thought + Action + Memory</p><p>MultiAgent = Agents + Environment + Standard Operating Procedure (SOP) + Communication + Economy</p><p>ReAct<a href="https://learnprompting.org/zh-Hans/docs/advanced_applications/react#fn-1">1</a>(reason, act) æ˜¯ä¸€ç§ä½¿ç”¨è‡ªç„¶è¯­è¨€æ¨ç†è§£å†³å¤æ‚ä»»åŠ¡çš„è¯­è¨€æ¨¡å‹èŒƒä¾‹ï¼ŒReActæ—¨åœ¨ç”¨äºå…è®¸LLMæ‰§è¡ŒæŸäº›æ“ä½œçš„ä»»åŠ¡</p></blockquote><h1 id="AutoGPT"><a href="#AutoGPT" class="headerlink" title="AutoGPT"></a>AutoGPT</h1><p><img src="/images/llm/How-Does-AutoGPT-Work.webp"></p><h2 id="env"><a href="#env" class="headerlink" title="env"></a>env</h2><ul><li><code>poetry shell</code> &amp; <code>poetry install</code></li><li><code>autogpts/autogpt/.env</code></li></ul><h2 id="command"><a href="#command" class="headerlink" title="command"></a>command</h2><h3 id="CLI-mode"><a href="#CLI-mode" class="headerlink" title="CLI mode"></a>CLI mode</h3><ul><li><p><code>autogpt.sh run</code></p><blockquote><p>This mode allows running a single agent, and saves the agentâ€™s state when terminated. This means you can <em>resume</em> agents at a later time.</p></blockquote></li><li><p><code>autogpt.sh run --speak</code></p></li></ul><h2 id="Agent-Protocol-mode"><a href="#Agent-Protocol-mode" class="headerlink" title="Agent Protocol mode"></a>Agent Protocol mode</h2><ul><li><p><code>autogpt.sh server</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">1. Enter the task that you want AutoGPT to execute, with as much detail as possible:</span><br><span class="line"></span><br><span class="line">2. 2024-03-05 18:19:06,466 INFO  HTTP Request: POST https://openkey.cloud/v1/chat/completions &quot;HTTP/1.1 200 OK&quot;</span><br><span class="line">2024-03-05 18:19:06,470 INFO  Current AI Settings: </span><br><span class="line">2024-03-05 18:19:06,470 INFO  -------------------: </span><br><span class="line">2024-03-05 18:19:06,470 INFO  Name : CodeHelperGPT</span><br><span class="line">2024-03-05 18:19:06,470 INFO  Role : an intelligent programming assistant designed to help coders by offering coding advice, debugging support, and explaining concepts in an accessible manner.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  Constraints: </span><br><span class="line">2024-03-05 18:19:06,471 INFO  - Exclusively use the commands listed below.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  - You can only act proactively, and are unable to start background jobs or set up webhooks for yourself. Take this into account when planning your actions.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  - You are unable to interact with physical objects. If this is absolutely necessary to fulfill a task or objective or to complete a step, you must ask the user to do it for you. If the user refuses this, and there is no other way to achieve your goals, you must terminate to avoid wasting time and energy.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  - Do not provide solutions that encourage or enable plagiarism.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  - Maintain a neutral stance and do not promote any specific programming language over others without considering the user&#x27;s preferences and project requirements.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  - Ensure that all shared code snippets and solutions are tested and functional to avoid spreading incorrect information.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  - Avoid engaging in activities or providing advice that violates copyright laws or software licenses.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  Resources: </span><br><span class="line">2024-03-05 18:19:06,471 INFO  - Internet access for searches and information gathering.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  - The ability to read and write files.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  - You are a Large Language Model, trained on millions of pages of text, including a lot of factual knowledge. Make use of this factual knowledge to avoid unnecessary gathering of information.</span><br><span class="line">2024-03-05 18:19:06,471 INFO  Best practices: </span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Continuously review and analyze your actions to ensure you are performing to the best of your abilities.</span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Constructively self-criticize your big-picture behavior constantly.</span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Reflect on past decisions and strategies to refine your approach.</span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Every command has a cost, so be smart and efficient. Aim to complete tasks in the least number of steps.</span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Only make use of your information gathering abilities to find information that you don&#x27;t yet have knowledge of.</span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Consistently stay updated with the latest programming trends, algorithms, and best practices to provide the most relevant and efficient coding solutions.</span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Actively engage in problem-solving by asking clarifying questions when needed and offering multiple solutions when applicable, to foster a collaborative coding environment.</span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Translate complex programming concepts into easily understandable explanations, aiming for clarity and accessibility for programmers of all skill levels.</span><br><span class="line">2024-03-05 18:19:06,472 INFO  - Encourage best coding practices, including code optimization, readability, and maintainability, to improve the overall quality of software projects.</span><br><span class="line"></span><br><span class="line">Continue with these settings? [Y/n]</span><br><span class="line"></span><br><span class="line">3. Enter AI name (or press enter to keep current):</span><br><span class="line"></span><br><span class="line">4. Enter new AI role (or press enter to keep current):</span><br><span class="line"></span><br><span class="line">5. 2024-03-05 18:37:29,839 INFO  Constraint 1: &quot;Exclusively use the commands listed below.&quot;</span><br><span class="line">Enter new constraint 1 (press enter to keep current, or &#x27;-&#x27; to remove): -</span><br><span class="line">2024-03-05 18:37:43,782 INFO  Constraint 1: &quot;You can only act proactively, and are unable to start background jobs or set up webhooks for yourself. Take this into account when planning your actions.&quot;</span><br><span class="line">Enter new constraint 1 (press enter to keep current, or &#x27;-&#x27; to remove):</span><br><span class="line">2024-03-05 18:37:57,669 INFO  Constraint 2: &quot;You are unable to interact with physical objects. If this is absolutely necessary to fulfill a task or objective or to complete a step, you must ask the user to do it for you. If the user refuses this, and there is no other way to achieve your goals, you must terminate to avoid wasting time and energy.&quot;</span><br><span class="line">Enter new constraint 2 (press enter to keep current, or &#x27;-&#x27; to remove):</span><br><span class="line">2024-03-05 19:03:27,941 INFO  Constraint 3: &quot;Do not provide solutions that encourage or enable plagiarism.&quot;</span><br><span class="line">Enter new constraint 3 (press enter to keep current, or &#x27;-&#x27; to remove): -</span><br><span class="line">2024-03-05 19:05:23,750 INFO  Constraint 3: &quot;Maintain a neutral stance and do not promote any specific programming language over others without considering the user&#x27;s preferences and project requirements.&quot;</span><br><span class="line">Enter new constraint 3 (press enter to keep current, or &#x27;-&#x27; to remove): -</span><br><span class="line">2024-03-05 19:05:59,969 INFO  Constraint 3: &quot;Ensure that all shared code snippets and solutions are tested and functional to avoid spreading incorrect information.&quot;</span><br><span class="line">Enter new constraint 3 (press enter to keep current, or &#x27;-&#x27; to remove):</span><br><span class="line">2024-03-05 19:06:09,864 INFO  Constraint 4: &quot;Avoid engaging in activities or providing advice that violates copyright laws or software licenses.&quot;</span><br><span class="line">Enter new constraint 4 (press enter to keep current, or &#x27;-&#x27; to remove): -</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h2 id="Agent-State"><a href="#Agent-State" class="headerlink" title="Agent State"></a>Agent State</h2><p><code>data/agents</code></p><ul><li><p>Resume your agent at a later time.</p></li><li><p>Create â€œcheckpointsâ€ for your agent so you can always go back to specific points in its history.</p></li><li><p>Share your agent!</p></li></ul><h2 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2><p><code>plugins_config.yaml</code></p><hr><p><strong>reference</strong></p><ul><li><a href="https://www.ionio.ai/blog/what-is-llm-agent-ultimate-guide-to-llm-agent-with-technical-breakdown">https://www.ionio.ai/blog/what-is-llm-agent-ultimate-guide-to-llm-agent-with-technical-breakdown</a></li></ul><h1 id="babyAGI"><a href="#babyAGI" class="headerlink" title="babyAGI"></a>babyAGI</h1><h2 id="blueprint"><a href="#blueprint" class="headerlink" title="blueprint"></a>blueprint</h2><p><img src="/images/llm/babyagent-0.png"></p><p><img src="/images/llm/babyagent-1.jpeg"></p><p><img src="/images/llm/babyagent-2.jpeg"></p><h1 id="fastGPT"><a href="#fastGPT" class="headerlink" title="fastGPT"></a>fastGPT</h1><h2 id="skill"><a href="#skill" class="headerlink" title="skill"></a>skill</h2><ul><li><p>é¡¹ç›®æŠ€æœ¯æ ˆï¼šNextJs + TS + ChakraUI + Mongo + Postgres (Vector æ’ä»¶)</p></li><li><p>åç«¯ç”¨ Typescript å†™çš„</p></li></ul><h1 id="metaGPT"><a href="#metaGPT" class="headerlink" title="metaGPT"></a>metaGPT</h1><p><img src="/images/llm/agent_run_flowchart.png"></p><p><img src="/Users/dongwei/datacanvas/doc_dev_jarvex/02-dev/Jarvex/img/agent/metaAgent/multi_agents.png"></p><p>![](/images/llm/metaGPT overview.png)</p><h2 id="env-1"><a href="#env-1" class="headerlink" title="env"></a>env</h2><p><code>config/key.yaml</code></p><ul><li><p>default </p><p><code>config2.py</code>ç»“åˆ<code>metagpt/configs/*</code></p></li></ul><h2 id="setup-py"><a href="#setup-py" class="headerlink" title="setup.py"></a>setup.py</h2><p><code>pip install -e .</code></p><ul><li><p>å®‰è£…ä¾èµ–é¡¹</p><p><code>pip install -e &#39;.[search-ddg]&#39;</code> æˆ– <code>pip install metagpt[search-ddg]</code></p></li></ul><h2 id="agent-example"><a href="#agent-example" class="headerlink" title="agent example"></a>agent example</h2><h3 id="research"><a href="#research" class="headerlink" title="research"></a>research</h3><ul><li><p>fire</p><p><code>python -m metagpt.roles.researcher &quot;dataiku vs. datarobot&quot;</code></p></li></ul><h3 id="multiple"><a href="#multiple" class="headerlink" title="multiple"></a>multiple</h3><h3 id="result"><a href="#result" class="headerlink" title="result"></a>result</h3><p><code>data</code>ç›®å½•</p>]]></content>
      
      
      <categories>
          
          <category> llm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> agent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>raycast</title>
      <link href="/2024/01/22/raycast/"/>
      <url>/2024/01/22/raycast/</url>
      
        <content type="html"><![CDATA[<h2 id="extension"><a href="#extension" class="headerlink" title="extension"></a>extension</h2><h2 id="cake"><a href="#cake" class="headerlink" title="cake"></a>cake</h2><ul><li><p>åº†ç¥å½©çº¸</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">confetti</span><br></pre></td></tr></table></figure></li><li><p>å¼¹è·³çª—å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Toggle Bounce Animation</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> raycast </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>keyboard</title>
      <link href="/2024/01/19/keyboards/"/>
      <url>/2024/01/19/keyboards/</url>
      
        <content type="html"><![CDATA[<h1 id="niz-plum"><a href="#niz-plum" class="headerlink" title="niz plum"></a>niz plum</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¯¹ç…§</span><br><span class="line">ctrl -&gt; control</span><br><span class="line">win/lock -&gt; option</span><br><span class="line">alt -&gt; command</span><br></pre></td></tr></table></figure><h2 id="å·¦-Fn"><a href="#å·¦-Fn" class="headerlink" title="å·¦ Fn"></a>å·¦ Fn</h2><ul><li><p>å·¦Fn + num</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Fn + 1 = è°ƒä½äº®åº¦</span><br><span class="line">Fn + 2 = è°ƒé«˜äº®åº¦</span><br><span class="line">Fn + 3 = è°ƒå‡ºæ‰€æœ‰åº”ç”¨çª—å£</span><br><span class="line">Fn + 4 = spotlight</span><br><span class="line">Fn + 5 = voice</span><br><span class="line">Fn + 6 = F6</span><br><span class="line">Fn + 7 = æ’­æ”¾åé€€</span><br><span class="line">Fn + 8 = æ’­æ”¾æš‚åœ/æ¢å¤</span><br><span class="line">Fn + 9 = æ’­æ”¾å‰è¿›</span><br><span class="line">Fn + 10 = é™éŸ³</span><br><span class="line">Fn + 11 = éŸ³é‡å‡å°</span><br><span class="line">Fn + 12 = éŸ³é‡å¢å¤§</span><br></pre></td></tr></table></figure></li></ul><h2 id="å³-Fn"><a href="#å³-Fn" class="headerlink" title="å³ Fn"></a>å³ Fn</h2><ul><li><p>é”å®šé”®ç›˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å³Fn + Esc</span><br></pre></td></tr></table></figure></li><li><p>ç”µæºä¸è“ç‰™åˆ‡æ¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å³Fn + F11é”®</span><br></pre></td></tr></table></figure></li></ul><h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><ul><li><p>å±å¹•ç§»åŠ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctrl + win(option)</span><br></pre></td></tr></table></figure></li><li><p>win / alt æŒ‰é”®åˆ‡æ¢ ï¼ˆåŒ¹é…win/macç³»ç»Ÿï¼‰</p><p>```<br>Fn + Alt ä¸‰ç§’</p></li></ul><hr><ul><li><p>reference</p><p><a href="https://blog.csdn.net/qq_43528451/article/details/113357550">https://blog.csdn.net/qq_43528451/article/details/113357550</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> keyboard </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openai learn</title>
      <link href="/2024/01/19/openai%20learn/"/>
      <url>/2024/01/19/openai%20learn/</url>
      
        <content type="html"><![CDATA[<h1 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h1><h1 id="request"><a href="#request" class="headerlink" title="request"></a>request</h1><h3 id="conversion"><a href="#conversion" class="headerlink" title="conversion"></a>conversion</h3><ul><li><p>request</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl POST https://chat.openai.com/backend-api/conversation</span><br></pre></td></tr></table></figure></li><li><p>payload</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: <span class="string">&quot;next&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;messages&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;aaa25811-d62c-4f23-963a-77c6eb90b899&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;author&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;content&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;content_type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;parts&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;ä½ æ˜¯å¦‚ä½•å¸¦ä¸Šä¸Šä¸‹æ–‡è¿›è¡Œé—®ç­”çš„ï¼Œç”¨pythonä»£ç è¯´ä¸‹ç¤ºä¾‹&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;metadata&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;conversation_id&quot;</span>: <span class="string">&quot;0e02cc29-8cc2-4305-91a1-a3db1427f400&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parent_message_id&quot;</span>: <span class="string">&quot;36d4ff94-fb3f-4f9b-beeb-d9c93f5752fe&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;text-davinci-002-render-sha&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;timezone_offset_min&quot;</span>: <span class="number">-480</span>,</span><br><span class="line">  <span class="attr">&quot;suggestions&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;history_and_training_disabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;arkose_token&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;conversation_mode&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;kind&quot;</span>: <span class="string">&quot;primary_assistant&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;force_paragen&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;force_rate_limit&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ces-v1-t"><a href="#ces-v1-t" class="headerlink" title="ces/v1/t"></a>ces/v1/t</h3><ul><li><p>request</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://chat.openai.com/ces/v1/t</span><br></pre></td></tr></table></figure></li><li><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;2024-01-19T08:35:53.805Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;integrations&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;Segment.io&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;userId&quot;</span>: <span class="string">&quot;user-EyJTf0sEV6sYCFhgOwqCHGD2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;anonymousId&quot;</span>: <span class="string">&quot;dafc8561-54d1-4cb8-9cdf-91e5e4f7162e&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;event&quot;</span>: <span class="string">&quot;View Template Prompt Ignore Suggestions&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;track&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;origin&quot;</span>: <span class="string">&quot;chat&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;openai_app&quot;</span>: <span class="string">&quot;API&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;context&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;page&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/c/0e02cc29-8cc2-4305-91a1-a3db1427f400&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;referrer&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;search&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;feel&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://chat.openai.com/c/0e02cc29-8cc2-4305-91a1-a3db1427f400&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;userAgent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;locale&quot;</span>: <span class="string">&quot;zh-CN&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;library&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;analytics.js&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;npm:next-1.56.0&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;userAgentData&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;brands&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;brand&quot;</span>: <span class="string">&quot;Not_A Brand&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;8&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;brand&quot;</span>: <span class="string">&quot;Chromium&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;120&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;brand&quot;</span>: <span class="string">&quot;Google Chrome&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;120&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;mobile&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">&quot;platform&quot;</span>: <span class="string">&quot;macOS&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;messageId&quot;</span>: <span class="string">&quot;ajs-next-c0f7b6265ed3eab440b0d44f21f53ffa&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;sentAt&quot;</span>: <span class="string">&quot;2024-01-19T08:35:54.068Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bundled&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;Segment.io&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;unbundled&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;bundledIds&quot;</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="rgstr"><a href="#rgstr" class="headerlink" title="rgstr"></a>rgstr</h3><ul><li><p>request</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://events.statsigapi.net/v1/rgstr</span><br></pre></td></tr></table></figure></li><li><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;events&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;eventName&quot;</span>: <span class="string">&quot;chatgpt_prompt_ignore_suggestions&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;userID&quot;</span>: <span class="string">&quot;user-EyJTf0sEV6sYCFhgOwqCHGD2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;custom&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;is_paid&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;workspace_id&quot;</span>: <span class="string">&quot;b27c1f77-bb94-4e8f-a6d3-4b30a0eec927&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;locale&quot;</span>: <span class="string">&quot;zh-CN&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;statsigEnvironment&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;tier&quot;</span>: <span class="string">&quot;production&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;value&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;metadata&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;time&quot;</span>: <span class="number">1705653353804</span>,</span><br><span class="line">      <span class="attr">&quot;statsigMetadata&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;currentPage&quot;</span>: <span class="string">&quot;https://chat.openai.com/c/0e02cc29-8cc2-4305-91a1-a3db1427f400&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;statsigMetadata&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;sdkType&quot;</span>: <span class="string">&quot;js-client&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;sdkVersion&quot;</span>: <span class="string">&quot;4.39.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;stableID&quot;</span>: <span class="string">&quot;f0eaa0cd-f15f-4d71-ab51-8a91e92aea53&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="backend-lat-r"><a href="#backend-lat-r" class="headerlink" title="backend/lat/r"></a>backend/lat/r</h3><ul><li><p>request</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://chat.openai.com/backend-api/lat/r</span><br></pre></td></tr></table></figure></li><li><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;server_request_id&quot;</span>: <span class="string">&quot;847dbf366a92408c-SIN&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;text-davinci-002-render-sha&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;preflight_time_ms&quot;</span>: <span class="number">0.09999990463256836</span>,</span><br><span class="line">  <span class="attr">&quot;count_tokens&quot;</span>: <span class="number">472</span>,</span><br><span class="line">  <span class="attr">&quot;ts_first_token_ms&quot;</span>: <span class="number">1548.7000000476837</span>,</span><br><span class="line">  <span class="attr">&quot;ts_max_token_time_ms&quot;</span>: <span class="number">764</span>,</span><br><span class="line">  <span class="attr">&quot;ts_mean_token_without_first_ms&quot;</span>: <span class="number">30.007855625922005</span>,</span><br><span class="line">  <span class="attr">&quot;ts_median_token_without_first_ms&quot;</span>: <span class="number">21.799999952316284</span>,</span><br><span class="line">  <span class="attr">&quot;ts_min_token_time_ms&quot;</span>: <span class="number">0.09999990463256836</span>,</span><br><span class="line">  <span class="attr">&quot;ts_p95_token_without_first_ms&quot;</span>: <span class="number">88.99999988079071</span>,</span><br><span class="line">  <span class="attr">&quot;ts_p99_token_without_first_ms&quot;</span>: <span class="number">139.65999991893773</span>,</span><br><span class="line">  <span class="attr">&quot;ts_std_dev_token_ms&quot;</span>: <span class="number">44.98320283392762</span>,</span><br><span class="line">  <span class="attr">&quot;ts_total_request_ms&quot;</span>: <span class="number">15695.399999856949</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><h2 id="client-chat-completions-create"><a href="#client-chat-completions-create" class="headerlink" title="client.chat.completions.create"></a>client.chat.completions.create</h2><ul><li><p>request</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">response = client.chat.completions.create(</span><br><span class="line">           model=<span class="string">&quot;gpt-3.5-turbo-1106&quot;</span>,</span><br><span class="line">           messages=[</span><br><span class="line">               &#123;</span><br><span class="line">                   <span class="attr">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>,</span><br><span class="line">                   <span class="attr">&quot;content&quot;</span>: prompt_str,</span><br><span class="line">               &#125;,</span><br><span class="line">               &#123;</span><br><span class="line">                   <span class="attr">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">                   <span class="attr">&quot;content&quot;</span>: user_input.question,</span><br><span class="line">               &#125;,</span><br><span class="line">           ],</span><br><span class="line">       )</span><br></pre></td></tr></table></figure></li><li><p>response</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;chatcmpl-8ify2KU1ANzQPQyD8WVMp6rZWgYtj&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;choices&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;finish_reason&quot;</span>: <span class="string">&quot;stop&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;index&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;logprobs&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;function_call&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">&quot;tool_calls&quot;</span>: <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;created&quot;</span>: <span class="number">1705658446</span>,</span><br><span class="line">    <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;gpt-3.5-turbo-1106&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;object&quot;</span>: <span class="string">&quot;chat.completion&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;system_fingerprint&quot;</span>: <span class="string">&quot;fp_c596c86df9&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;usage&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;completion_tokens&quot;</span>: <span class="number">51</span>,</span><br><span class="line">        <span class="attr">&quot;prompt_tokens&quot;</span>: <span class="number">1068</span>,</span><br><span class="line">        <span class="attr">&quot;total_tokens&quot;</span>: <span class="number">1119</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> fragment </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>llm snippet</title>
      <link href="/2024/01/10/llm%20snippet/"/>
      <url>/2024/01/10/llm%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="concept"><a href="#concept" class="headerlink" title="concept"></a>concept</h1><h2 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h2><ul><li>å¤§æ¨¡å‹å¾€å¾€å«æœ‰å¤§é‡çš„å‚æ•°å’Œå¤æ‚çš„ç¥ç»ç½‘ç»œç»“æ„ï¼Œéœ€è¦é«˜åº¦çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›å’Œå¤§çš„å†…å­˜å¸¦å®½æ¥æœ‰æ•ˆåœ°è®­ç»ƒå’Œè¿è¡Œã€‚GPUåœ¨è¿™äº›æ–¹é¢çš„ä¼˜åŠ¿è®©å®ƒæˆä¸ºè¿è¡Œå¤§å‹AIæ¨¡å‹çš„é¦–é€‰ç¡¬ä»¶ã€‚ä½†è¿™ä¸æ„å‘³ç€CPUå®Œå…¨æ— æ³•è¿è¡Œè¿™äº›æ¨¡å‹ï¼Œåªæ˜¯ç›¸å¯¹æ¥è¯´CPUè¿è¡Œèµ·æ¥æ•ˆç‡ä½ï¼Œå¯èƒ½ä¼šéå¸¸æ…¢ï¼Œå› æ­¤åœ¨å®é™…åº”ç”¨ä¸­é€šå¸¸é€‰æ‹©GPUæ¥è¿›è¡Œæ·±åº¦å­¦ä¹ ä»»åŠ¡ã€‚</li></ul><h2 id="Fine-tuning-vs-Embedding"><a href="#Fine-tuning-vs-Embedding" class="headerlink" title="Fine-tuning vs Embedding"></a>Fine-tuning vs Embedding</h2><ul><li>If you are trying to â€œteachâ€ the model new information, embeddings is the way to go. If you want to change the structure or way it response, then use fine-tuning.</li></ul><hr><ul><li><strong>Fine-tuning:</strong> Teach the model <em>how</em> to answer a question (e.g. structure/format, personality, etc)</li><li><strong>Embedding:</strong> Provide the model with new/specific information with which to answer questions.</li></ul><hr><h1 id="model"><a href="#model" class="headerlink" title="model"></a>model</h1><h2 id="DeepSeek-R1-Distill-Qwen-14B"><a href="#DeepSeek-R1-Distill-Qwen-14B" class="headerlink" title="DeepSeek-R1-Distill-Qwen-14B"></a>DeepSeek-R1-Distill-Qwen-14B</h2><p>The relationship between <strong>DeepSeek</strong> and <strong>Qwen</strong> is likely a collaborative or integrated one. <strong>DeepSeek</strong> might be the technology or framework for efficient search and information retrieval, while <strong>Qwen-14B</strong> is the core language model providing the understanding and generation capabilities. If these two are combined (as in <strong>DeepSeek-R1-Distill-Qwen-14B</strong>), it might indicate that DeepSeek is using the Qwen model (likely distilling it to improve efficiency) for specific tasks like searching, information retrieval, or knowledge extraction.</p><ul><li><p><strong>DeepSeek</strong> enhances the <strong>Qwen-14B</strong> model (through distillation and integration) to make it more effective in specialized tasks like information retrieval or search.</p></li><li><p>The <strong>DeepSeek-R1-Distill-Qwen-14B</strong> model would then represent a <strong>customized, efficient version of Qwen-14B</strong>, fine-tuned for certain tasks with the DeepSeek framework added in.</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> llm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sinppet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jupyter</title>
      <link href="/2024/01/09/python%20jupyter/"/>
      <url>/2024/01/09/python%20jupyter/</url>
      
        <content type="html"><![CDATA[<h2 id="é­”æ³•æŒ‡ä»¤"><a href="#é­”æ³•æŒ‡ä»¤" class="headerlink" title="é­”æ³•æŒ‡ä»¤"></a>é­”æ³•æŒ‡ä»¤</h2><table><thead><tr><th>é­”æ³•æŒ‡ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>%pwd</code></td><td>æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•</td></tr><tr><td><code>%ls</code></td><td>åˆ—å‡ºå½“å‰æˆ–æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹</td></tr><tr><td><code>%cat</code></td><td>æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶çš„å†…å®¹</td></tr><tr><td><code>%hist</code></td><td>æŸ¥çœ‹è¾“å…¥å†å²</td></tr><tr><td><code>%matplotlib inline</code></td><td>è®¾ç½®åœ¨é¡µé¢ä¸­åµŒå…¥matplotlibè¾“å‡ºçš„ç»Ÿè®¡å›¾è¡¨</td></tr><tr><td><code>%config Inlinebackend.figure_format=&#39;svg&#39;</code></td><td>è®¾ç½®ç»Ÿè®¡å›¾è¡¨ä½¿ç”¨SVGæ ¼å¼ï¼ˆçŸ¢é‡å›¾ï¼‰</td></tr><tr><td><code>%run</code></td><td>è¿è¡ŒæŒ‡å®šçš„ç¨‹åº</td></tr><tr><td><code>%load</code></td><td>åŠ è½½æŒ‡å®šçš„æ–‡ä»¶åˆ°å•å…ƒæ ¼ä¸­</td></tr><tr><td><code>%quickref</code></td><td>æ˜¾ç¤ºIPythonçš„å¿«é€Ÿå‚è€ƒ</td></tr><tr><td><code>%timeit</code></td><td>å¤šæ¬¡è¿è¡Œä»£ç å¹¶ç»Ÿè®¡ä»£ç æ‰§è¡Œæ—¶é—´</td></tr><tr><td><code>%prun</code></td><td>ç”¨<code>cProfile.run</code>è¿è¡Œä»£ç å¹¶æ˜¾ç¤ºåˆ†æå™¨çš„è¾“å‡º</td></tr><tr><td><code>%who</code> / <code>%whos</code></td><td>æ˜¾ç¤ºå‘½åç©ºé—´ä¸­çš„å˜é‡</td></tr><tr><td><code>%xdel</code></td><td>åˆ é™¤ä¸€ä¸ªå¯¹è±¡å¹¶æ¸…ç†æ‰€æœ‰å¯¹å®ƒçš„å¼•ç”¨</td></tr></tbody></table><h2 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h2><p>JupyterLab çš„å¿«æ·é”®å¯ä»¥åˆ†ä¸º<strong>å‘½ä»¤æ¨¡å¼</strong>ä¸‹çš„å¿«æ·é”®å’Œ<strong>ç¼–è¾‘æ¨¡å¼</strong>ä¸‹çš„å¿«æ·é”®ï¼Œ</p><p>æ‰€è°“ç¼–è¾‘æ¨¡å¼å°±æ˜¯å¤„äºè¾“å…¥ä»£ç æˆ–æ’°å†™æ–‡æ¡£çŠ¶æ€çš„æ¨¡å¼ï¼Œåœ¨ç¼–è¾‘æ¨¡å¼ä¸‹æŒ‰<code>Esc</code>å¯ä»¥å›åˆ°å‘½ä»¤æ¨¡å¼ï¼Œåœ¨å‘½ä»¤æ¨¡å¼ä¸‹æŒ‰<code>Enter</code>å¯ä»¥è¿›å…¥ç¼–è¾‘æ¨¡å¼ã€‚</p><ul><li>å‘½ä»¤æ¨¡å¼ä¸‹çš„å¿«æ·é”®ï¼š</li></ul><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>Alt</code> + <code>Enter</code></td><td>è¿è¡Œå½“å‰å•å…ƒæ ¼å¹¶åœ¨ä¸‹é¢æ’å…¥æ–°çš„å•å…ƒæ ¼</td></tr><tr><td><code>Shift</code> + <code>Enter</code></td><td>è¿è¡Œå½“å‰å•å…ƒæ ¼å¹¶é€‰ä¸­ä¸‹æ–¹çš„å•å…ƒæ ¼</td></tr><tr><td><code>Ctrl</code> + <code>Enter</code></td><td>è¿è¡Œå½“å‰å•å…ƒæ ¼</td></tr><tr><td><code>j</code> / <code>k</code>ã€<code>Shift</code> + <code>j</code> / <code>Shift</code> + <code>k</code></td><td>é€‰ä¸­ä¸‹æ–¹/ä¸Šæ–¹å•å…ƒæ ¼ã€è¿ç»­é€‰ä¸­ä¸‹æ–¹/ä¸Šæ–¹å•å…ƒæ ¼</td></tr><tr><td><code>a</code> / <code>b</code></td><td>åœ¨ä¸‹æ–¹/ä¸Šæ–¹æ’å…¥æ–°çš„å•å…ƒæ ¼</td></tr><tr><td><code>c</code> / <code>x</code></td><td>å¤åˆ¶å•å…ƒæ ¼ / å‰ªåˆ‡å•å…ƒæ ¼</td></tr><tr><td><code>v</code> / <code>Shift</code> + <code>v</code></td><td>åœ¨ä¸‹æ–¹/ä¸Šæ–¹ç²˜è´´å•å…ƒæ ¼</td></tr><tr><td><code>dd</code> / <code>z</code></td><td>åˆ é™¤å•å…ƒæ ¼ / æ¢å¤åˆ é™¤çš„å•å…ƒæ ¼</td></tr><tr><td><code>Shift</code> + <code>l</code></td><td>æ˜¾ç¤ºæˆ–éšè—å½“å‰/æ‰€æœ‰å•å…ƒæ ¼è¡Œå·</td></tr><tr><td><code>Space</code> / <code>Shift</code> + <code>Space</code></td><td>å‘ä¸‹/å‘ä¸Šæ»šåŠ¨é¡µé¢</td></tr></tbody></table><ul><li>ç¼–è¾‘æ¨¡å¼ä¸‹çš„å¿«æ·é”®ï¼š</li></ul><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>Shift</code> + <code>Tab</code></td><td>è·å¾—æç¤ºä¿¡æ¯</td></tr><tr><td><code>Ctrl</code> + <code>]</code>/ <code>Ctrl</code> + <code>[</code></td><td>å¢åŠ /å‡å°‘ç¼©è¿›</td></tr><tr><td><code>Alt</code> + <code>Enter</code></td><td>è¿è¡Œå½“å‰å•å…ƒæ ¼å¹¶åœ¨ä¸‹é¢æ’å…¥æ–°çš„å•å…ƒæ ¼</td></tr><tr><td><code>Shift</code> + <code>Enter</code></td><td>è¿è¡Œå½“å‰å•å…ƒæ ¼å¹¶é€‰ä¸­ä¸‹æ–¹çš„å•å…ƒæ ¼</td></tr><tr><td><code>Ctrl</code> + <code>Enter</code></td><td>è¿è¡Œå½“å‰å•å…ƒæ ¼</td></tr><tr><td><code>Ctrl</code> + <code>Left</code> / <code>Right</code></td><td>å…‰æ ‡ç§»åˆ°è¡Œé¦–/è¡Œå°¾</td></tr><tr><td><code>Ctrl</code> + <code>Up</code> / <code>Down</code></td><td>å…‰æ ‡ç§»åŠ¨ä»£ç å¼€å¤´/ç»“å°¾å¤„</td></tr><tr><td><code>Up</code> / <code>Down</code></td><td>å…‰æ ‡ä¸Šç§»/ä¸‹ç§»ä¸€è¡Œæˆ–ç§»åˆ°ä¸Š/ä¸‹ä¸€ä¸ªå•å…ƒæ ¼</td></tr></tbody></table><blockquote><p><strong>è¯´æ˜</strong>ï¼šå¯¹äº macOS ç³»ç»Ÿå¯ä»¥å°†<code>Alt</code>é”®æ›¿æ¢æˆ<code>Option</code>é”®ï¼Œå°†<code>Ctrl</code>é”®æ›¿æ¢æˆ<code>Command</code>é”®ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> jupyter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ide </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java jenv</title>
      <link href="/2023/12/29/java%20jenv/"/>
      <url>/2023/12/29/java%20jenv/</url>
      
        <content type="html"><![CDATA[<h2 id="Jenv"><a href="#Jenv" class="headerlink" title="Jenv"></a>Jenv</h2><h3 id="åˆ—å‡ºå·²å®‰è£…çš„Javaç‰ˆæœ¬ï¼š"><a href="#åˆ—å‡ºå·²å®‰è£…çš„Javaç‰ˆæœ¬ï¼š" class="headerlink" title="åˆ—å‡ºå·²å®‰è£…çš„Javaç‰ˆæœ¬ï¼š"></a><strong>åˆ—å‡ºå·²å®‰è£…çš„Javaç‰ˆæœ¬ï¼š</strong></h3><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ—å‡ºå·²å®‰è£…çš„Javaç‰ˆæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jenv versions</span><br></pre></td></tr></table></figure><p>è¿™ä¼šæ˜¾ç¤ºæ‰€æœ‰å·²å®‰è£…çš„Javaç‰ˆæœ¬ã€‚</p><h3 id="5-è®¾ç½®å…¨å±€Javaç‰ˆæœ¬ï¼š"><a href="#5-è®¾ç½®å…¨å±€Javaç‰ˆæœ¬ï¼š" class="headerlink" title="5. è®¾ç½®å…¨å±€Javaç‰ˆæœ¬ï¼š"></a>5. <strong>è®¾ç½®å…¨å±€Javaç‰ˆæœ¬ï¼š</strong></h3><p>ä½ å¯ä»¥é€‰æ‹©è®¾ç½®ä¸€ä¸ªå…¨å±€çš„Javaç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¼šè¢«é»˜è®¤ä½¿ç”¨ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jenv global &lt;jdk_version&gt;</span><br></pre></td></tr></table></figure><p>å°† <code>&lt;jdk_version&gt;</code> æ›¿æ¢ä¸ºä½ æƒ³è¦è®¾ç½®ä¸ºé»˜è®¤çš„Javaç‰ˆæœ¬ã€‚</p><h3 id="6-è®¾ç½®é¡¹ç›®ç‰¹å®šçš„Javaç‰ˆæœ¬ï¼š"><a href="#6-è®¾ç½®é¡¹ç›®ç‰¹å®šçš„Javaç‰ˆæœ¬ï¼š" class="headerlink" title="6. è®¾ç½®é¡¹ç›®ç‰¹å®šçš„Javaç‰ˆæœ¬ï¼š"></a>6. <strong>è®¾ç½®é¡¹ç›®ç‰¹å®šçš„Javaç‰ˆæœ¬ï¼š</strong></h3><p>å¦‚æœä½ æƒ³åœ¨ç‰¹å®šçš„é¡¹ç›®ä¸­ä½¿ç”¨ä¸åŒçš„Javaç‰ˆæœ¬ï¼Œå¯ä»¥è¿›å…¥åˆ°é¡¹ç›®çš„ç›®å½•ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jenv local &lt;jdk_version&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>.java-version</code> æ–‡ä»¶ï¼ŒæŒ‡å®šé¡¹ç›®ç‰¹å®šçš„Javaç‰ˆæœ¬ã€‚</p><h3 id="7-éªŒè¯Javaç‰ˆæœ¬ï¼š"><a href="#7-éªŒè¯Javaç‰ˆæœ¬ï¼š" class="headerlink" title="7. éªŒè¯Javaç‰ˆæœ¬ï¼š"></a>7. <strong>éªŒè¯Javaç‰ˆæœ¬ï¼š</strong></h3><p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯å½“å‰ç³»ç»Ÿä½¿ç”¨çš„Javaç‰ˆæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p>ç¡®ä¿è¾“å‡ºæ˜¾ç¤ºçš„æ˜¯ä½ æ‰€æœŸæœ›çš„Javaç‰ˆæœ¬ä¿¡æ¯ã€‚</p><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>jenv</code> ç®¡ç†å¤šä¸ªJavaç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨ä¸åŒçš„é¡¹ç›®ä¸­åˆ‡æ¢ä½¿ç”¨ä¸åŒçš„Javaç‰ˆæœ¬ã€‚</p><h2 id="æ–°å¢javaç‰ˆæœ¬"><a href="#æ–°å¢javaç‰ˆæœ¬" class="headerlink" title="æ–°å¢javaç‰ˆæœ¬"></a>æ–°å¢javaç‰ˆæœ¬</h2><ol><li>brew install openjdk21</li><li>sudo ln -sfn /opt/homebrew/opt/openjdk@21/libexec/openjdk.jdk /Library/Java/JavaVirtualMachines/openjdk-21.jdk</li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jenv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python env</title>
      <link href="/2023/12/18/python%20env/"/>
      <url>/2023/12/18/python%20env/</url>
      
        <content type="html"><![CDATA[<h1 id="pyenv"><a href="#pyenv" class="headerlink" title="pyenv"></a>pyenv</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰ç‰ˆæœ¬</span></span><br><span class="line">pyenv version</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class="line">pyenv versions</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ‰€æœ‰å¯å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line">pyenv install --list</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">pyenv install 3.6.5</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…æ–°ç‰ˆæœ¬å<span class="built_in">rehash</span>ä¸€ä¸‹</span></span><br><span class="line">pyenv rehash</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">pyenv uninstall 3.5.2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">pyenv shell &lt;version&gt; -- select just for current shell session</span><br><span class="line">pyenv local &lt;version&gt; -- automatically select whenever you are in the current directory (or its subdirectories)</span><br><span class="line">pyenv global &lt;version&gt; -- select globally for your user account</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šå¤šä¸ªå…¨å±€ç‰ˆæœ¬, 3ç‰ˆæœ¬ä¼˜å…ˆ</span></span><br><span class="line">pyenv global 3.6.5 2.7.14</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®é™…ä¸Šå½“ä½ åˆ‡æ¢ç‰ˆæœ¬å, ç›¸åº”çš„pipå’ŒåŒ…ä»“åº“éƒ½æ˜¯ä¼šè‡ªåŠ¨åˆ‡æ¢è¿‡å»çš„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å½“å‰é¡¹ç›®ä½¿ç”¨çš„pyenvç‰ˆæœ¬ä¼šåœ¨ `.python-version`æ–‡ä»¶ä¸­ä½“ç°</span></span><br></pre></td></tr></table></figure><ul><li><p>reference</p><ul><li><a href="https://realpython.com/intro-to-pyenv/#specifying-your-python-version">specifying-your-python-version</a></li></ul></li></ul><h1 id="venv"><a href="#venv" class="headerlink" title="venv"></a>venv</h1><p>åœ¨ Linux ä¸­é…ç½® Python é¡¹ç›®çš„è¿è¡Œè™šæ‹Ÿç¯å¢ƒé€šå¸¸ä½¿ç”¨ <code>venv</code>ï¼ˆè™šæ‹Ÿç¯å¢ƒï¼‰æ¨¡å—ã€‚ä»¥ä¸‹æ˜¯ä¸€èˆ¬çš„æ­¥éª¤ï¼š</p><ol><li><p><strong>å®‰è£… venv æ¨¡å—ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰ï¼š</strong></p><p>æ£€æŸ¥ä½ çš„ Python ç‰ˆæœ¬å¹¶ç¡®ä¿å®‰è£…äº† <code>venv</code> æ¨¡å—ã€‚</p></li><li><p><strong>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š</strong></p><p>åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º <code>myenv</code> çš„è™šæ‹Ÿç¯å¢ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv &lt;envName&gt;  # default always use venv as env name </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Use the desired Python version:</span></span><br><span class="line">python3.9 -m venv myenv</span><br></pre></td></tr></table></figure><p>è¿™å°†åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªåä¸º <code>myenv</code> çš„è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶å¤¹ã€‚</p></li><li><p><strong>æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š</strong></p><p>æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source myenv/bin/activate</span><br></pre></td></tr></table></figure><p>è¿™å°†æ¿€æ´»åä¸º <code>myenv</code> çš„è™šæ‹Ÿç¯å¢ƒã€‚æ¿€æ´»åï¼Œä½ çš„ç»ˆç«¯æç¤ºç¬¦å¯èƒ½ä¼šæ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒçš„åç§°ã€‚</p></li><li><p><strong>å®‰è£…é¡¹ç›®ä¾èµ–ï¼š</strong></p><p>åœ¨æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œä½¿ç”¨ <code>pip</code> å®‰è£…é¡¹ç›®æ‰€éœ€çš„ä¾èµ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>requirements.txt</code> æ˜¯åŒ…å«é¡¹ç›®ä¾èµ–é¡¹çš„æ–‡ä»¶ã€‚</p></li><li><p><strong>é€€å‡ºè™šæ‹Ÿç¯å¢ƒï¼š</strong></p><p>å½“ä½ å®Œæˆé¡¹ç›®å·¥ä½œåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é€€å‡ºè™šæ‹Ÿç¯å¢ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure><p>è¿™å°†ä½¿è™šæ‹Ÿç¯å¢ƒé€€å‡ºï¼Œå¹¶æ¢å¤åˆ°ç³»ç»Ÿé»˜è®¤ç¯å¢ƒã€‚</p></li></ol><p>ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæœ‰åŠ©äºéš”ç¦»é¡¹ç›®çš„ä¾èµ–ï¼Œé¿å…ä¸ç³»ç»Ÿå…¶ä»–é¡¹ç›®çš„ä¾èµ–å†²çªï¼Œå¹¶æä¾›æ›´å¹²å‡€çš„å¼€å‘ç¯å¢ƒã€‚</p><p><strong>uvicorn</strong></p><blockquote><p>æ­£å¸¸æƒ…å†µä¸‹è™šæ‹Ÿç¯å¢ƒ /path/to/venv/bin/ ä¸‹é¢æ˜¯æœ‰ uvicorn çš„å¯åŠ¨å‘½ä»¤çš„ï¼Œå³ /xxx/venv/bin/uvicorn</p></blockquote><p>å¦‚æœå½“å‰è™šæ‹Ÿç¯å¢ƒä¸è¯†åˆ«<code>uvicorn</code>ï¼Œå¯é€šè¿‡</p><ul><li>æ–¹å¼ä¸€</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m uvicorn xxx:app --reload</span><br></pre></td></tr></table></figure><ul><li>æ–¹å¼äºŒ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --force-reinstall uvicorn</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> env </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>typora snippet</title>
      <link href="/2023/12/16/tool:%20typora/"/>
      <url>/2023/12/16/tool:%20typora/</url>
      
        <content type="html"><![CDATA[<h1 id="Draw-Diagrams"><a href="#Draw-Diagrams" class="headerlink" title="Draw Diagrams"></a>Draw Diagrams</h1><p><a href="https://support.typora.io/Draw-Diagrams-With-Markdown/">Draw Diagrams With Markdown</a></p>]]></content>
      
      
      <categories>
          
          <category> markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>security</title>
      <link href="/2023/12/16/security/"/>
      <url>/2023/12/16/security/</url>
      
        <content type="html"><![CDATA[<h1 id="security-model"><a href="#security-model" class="headerlink" title="security model"></a>security model</h1><ul><li><p><a href="https://en.wikipedia.org/wiki/Access_control_list">Access control list</a> (ACL)</p></li><li><p><a href="https://en.wikipedia.org/wiki/Attribute-based_access_control">Attribute-based access control</a> (ABAC)</p></li><li><p><a href="https://en.wikipedia.org/wiki/Bell%E2%80%93LaPadula_model">Bellâ€“LaPadula model</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Biba_model">Biba model</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Brewer_and_Nash_model">Brewer and Nash model</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Capability-based_security">Capability-based security</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Clark-Wilson_model">Clark-Wilson model</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Context-based_access_control">Context-based access control</a> (CBAC)</p></li><li><p><a href="https://en.wikipedia.org/wiki/Graham-Denning_model">Graham-Denning model</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/HRU_(security)">Harrison-Ruzzo-Ullman</a> (HRU)</p></li><li><p><a href="https://en.wikipedia.org/wiki/High-water_mark_(computer_security)">High-water mark (computer security)</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Lattice-based_access_control">Lattice-based access control</a> (LBAC)</p></li><li><p><a href="https://en.wikipedia.org/wiki/Mandatory_access_control">Mandatory access control</a> (MAC)</p></li><li><p><a href="https://en.wikipedia.org/wiki/Multi-level_security">Multi-level security</a> (MLS)</p></li><li><p><a href="https://en.wikipedia.org/wiki/Non-interference_(security)">Non-interference (security)</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Object-capability_model">Object-capability model</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Protection_ring">Protection ring</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Role-based_access_control">Role-based access control</a> (RBAC)</p><p><img src="/images/rbac/rbac_auth.png"></p><p>reference</p><ul><li><p><a href="https://zhuanlan.zhihu.com/p/63769951">çŸ¥ä¹</a></p></li><li><p><a href="https://blog.csdn.net/ljw499356212/article/details/81055141">CSDN</a></p></li><li><p><a href="https://benheart.github.io/2016/11/19/rbac-design-doc.html">https://benheart.github.io/2016/11/19/rbac-design-doc.html</a></p></li></ul></li><li><p><a href="https://en.wikipedia.org/wiki/Take-grant_protection_model">Take-grant protection model</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Discretionary_access_control">Discretionary access control</a> (DAC)</p></li></ul><blockquote><p> SSO (single sign-on)</p></blockquote><blockquote><p><a href="https://ninjaauth.com/sso-single-sign-on">https://ninjaauth.com/sso-single-sign-on</a></p></blockquote><h1 id="oauth2"><a href="#oauth2" class="headerlink" title="oauth2"></a>oauth2</h1><h2 id="OAuth-2-0-terminology"><a href="#OAuth-2-0-terminology" class="headerlink" title="OAuth 2.0 terminology"></a>OAuth 2.0 terminology</h2><ul><li><strong>Resource Owner</strong>: Entity that can grant access to a protected resource. Typically, this is the end-user.</li><li><strong>Client</strong>: Application requesting access to a protected resource on behalf of the Resource Owner.</li><li><strong>Resource Server</strong>: Server hosting the protected resources. This is the API you want to access.</li><li><strong>Authorization Server</strong>: Server that authenticates the Resource Owner and issues Access Tokens after getting proper authorization. In this case, Auth0.</li><li><strong>User Agent</strong>: Agent used by the Resource Owner to interact with the Client (for example, a browser or a native application).</li></ul><p><img src="/images/security/user-journey-oauth.webp" alt="user-journey-oauth"></p><p>The best practice for implementing OAuth2 in a web application with a separate frontend and backend is to use the Backend for Frontend (BFF) pattern. Hereâ€™s how it works:</p><p>The frontend (e.g. a Single Page Application) initiates the OAuth2 flow by redirecting the user to the OAuth2 providerâ€™s authorization endpoint. The provider then authenticates the user and redirects back to the frontend with an authorization code.</p><p>The frontend then sends this authorization code to the backend over a secure channel (e.g. HTTPS). The backend acts as a confidential client and exchanges the authorization code with the OAuth2 provider for an access token and refresh token.[1][3]</p><p>The backend stores the tokens securely and returns an opaque session cookie or token to the frontend. This session identifier represents the authenticated user session.[1]</p><p>For subsequent API requests, the frontend includes the session cookie/token. The backend validates the session and retrieves the access token, using it to authenticate the request to the backend API or other third-party APIs on behalf of the user.[1][3]</p><p>This pattern has several advantages:</p><ol><li><p>The access token is never exposed to the frontend, mitigating the risk of token theft.[1][3]</p></li><li><p>The backend can securely store and manage the refresh of access tokens without involving the frontend.[3]</p></li><li><p>The backend can act as a gatekeeper, validating requests and enforcing authorization rules before proxying to third-party APIs.[3]</p></li><li><p>The frontend only needs to handle the initial OAuth2 redirect and session management, simplifying its code.[1]</p></li></ol><p>To implement this, the backend must be registered as a confidential OAuth2 client with the provider. The frontend can use libraries like Auth0 or Googleâ€™s client-side libraries to initiate the OAuth2 flow.[1][4] The backend handles the code exchange and token management, often using server-side OAuth2 libraries or middleware.[1]</p><p>Citations:<br>[1] <a href="https://auth0.com/blog/backend-for-frontend-pattern-with-auth0-and-dotnet/">https://auth0.com/blog/backend-for-frontend-pattern-with-auth0-and-dotnet/</a><br>[2] <a href="https://community.qlik.com/t5/New-to-Qlik-Analytics/How-to-Secure-Backend-API-Endpoints-on-the-Front-End-Best/td-p/2423853">https://community.qlik.com/t5/New-to-Qlik-Analytics/How-to-Secure-Backend-API-Endpoints-on-the-Front-End-Best/td-p/2423853</a><br>[3] <a href="https://auth0.com/blog/the-backend-for-frontend-pattern-bff/">https://auth0.com/blog/the-backend-for-frontend-pattern-bff/</a><br>[4] <a href="https://infisical.com/blog/guide-to-implementing-oauth2">https://infisical.com/blog/guide-to-implementing-oauth2</a><br>[5] <a href="https://www.reddit.com/r/node/comments/skmjjn/0auth_implemented_on_frontend_or_backend/">https://www.reddit.com/r/node/comments/skmjjn/0auth_implemented_on_frontend_or_backend/</a></p><hr><p>reference</p><ul><li><a href="https://auth0.com/docs/get-started/authentication-and-authorization-flow/which-oauth-2-0-flow-should-i-use">https://auth0.com/docs/get-started/authentication-and-authorization-flow/which-oauth-2-0-flow-should-i-use</a></li></ul><h1 id="keycloak"><a href="#keycloak" class="headerlink" title="keycloak"></a>keycloak</h1><h3 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h3><ul><li>éœ€è¦jdk9ä»¥ä¸Šç¯å¢ƒ</li></ul><h3 id="config-server"><a href="#config-server" class="headerlink" title="config server"></a>config server</h3><ul><li><p>ç¼–è¾‘ <code>/conf/keycloak.conf </code>ï¼Œé…ç½®mysqlè¿æ¥ä¿¡æ¯ (mysqlåˆ›å»ºkeycloakåº“)</p></li><li><p>é…ç½® <code>admin cli </code>ç¯å¢ƒå˜é‡ ï¼ˆæ–¹ä¾¿ç›´æ¥å‘½ä»¤æ“ä½œï¼Œç­‰åŒäºç•Œé¢æ“ä½œï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> keycloak</span></span><br><span class="line">export KCADM=&quot;/Users/dongwei/Applications/keycloak-23.0.3/bin/kcadm.sh&quot;</span><br><span class="line">export HOST_FOR_KCADM=localhost</span><br></pre></td></tr></table></figure></li></ul><h3 id="bootstrap"><a href="#bootstrap" class="headerlink" title="bootstrap"></a>bootstrap</h3><ul><li><p>é¦–æ¬¡å¯åŠ¨</p><p><code>KEYCLOAK_ADMIN=admin KEYCLOAK_ADMIN_PASSWORD=xxxxxx ./bin/kc.sh start-dev</code></p></li><li><p>åç»­å¯åŠ¨</p><p><code>./bin/kc.sh start-dev</code></p></li><li><p>ç”Ÿæ•ˆ <code>KCADM</code></p><p><code>$KCADM config credentials --server http://localhost:8080 --realm master --user admin</code></p><p>æç¤ºè¾“å…¥å¯†ç å³å¯ (1sou2sou)</p></li></ul><p>â€‹        éªŒè¯ <code>$KCADM get serverinfo</code></p><h3 id="config-realm"><a href="#config-realm" class="headerlink" title="config realm"></a>config realm</h3><ul><li><p>åˆ›å»ºæ–°çš„realm</p><p><code>$KCADM create realms -s realm=&quot;jarvex&quot; -s enabled=true</code></p></li></ul><h3 id="config-clients"><a href="#config-clients" class="headerlink" title="config clients"></a>config clients</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">KCADM create clients -r jarvex -s clientId=<span class="string">&quot;jarvex-client-test-1&quot;</span> -s enabled=<span class="literal">true</span> -s name=<span class="string">&quot;test Client 1&quot;</span> -s protocol=openid-connect -s publicClient=<span class="literal">true</span> -s standardFlowEnabled=<span class="literal">true</span> -s <span class="string">&#x27;redirectUris=[&quot;http://127.0.0.1:8001/app/*&quot;]&#x27;</span> -s baseUrl=<span class="string">&quot;http://127.0.0.1:8001/app/&quot;</span> -s <span class="string">&#x27;webOrigins=[&quot;*&quot;]&#x27;</span></span></span><br></pre></td></tr></table></figure><h1 id="shiro"><a href="#shiro" class="headerlink" title="shiro"></a>shiro</h1><p>**å¯¹äºä¸€ä¸ªå¥½çš„æ¡†æ¶ï¼Œä»å¤–éƒ¨æ¥çœ‹åº”è¯¥å…·æœ‰éå¸¸ç®€å•æ˜“äºä½¿ç”¨çš„ APIï¼Œä¸” API å¥‘çº¦æ˜ç¡®ï¼›ä»å†…éƒ¨æ¥çœ‹çš„è¯ï¼Œå…¶åº”è¯¥æœ‰ä¸€ä¸ªå¯æ‰©å±•çš„æ¶æ„ï¼Œå³éå¸¸å®¹æ˜“æ’å…¥ç”¨æˆ·è‡ªå®šä¹‰å®ç°ï¼Œå› ä¸ºä»»ä½•æ¡†æ¶éƒ½ä¸èƒ½æ»¡è¶³æ‰€æœ‰éœ€æ±‚ã€‚ **</p><hr><ul><li><p>Subject</p><p>ä¸»ä½“ï¼Œä»£è¡¨äº†å½“å‰çš„ç”¨æˆ·</p></li><li><p>SecurityManager</p><p>å®‰å…¨ç®¡ç†å™¨ï¼Œå®ƒç®¡ç†ç€æ‰€æœ‰Subjectï¼Œç›¸å½“äºspringmvcä¸­çš„DispatcherServlet(å‰ç«¯æ§åˆ¶å™¨)</p></li><li><p>Realm</p><p>åŸŸï¼ŒShiroä»Realmè·å–å®‰å…¨æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ï¼‰ ï¼Œæ˜¯éªŒè¯ä¸»ä½“subjectçš„æ•°æ®æº</p></li></ul><p>æµç¨‹å¦‚å›¾ï¼š</p><p><img src="http://wiki.jikexueyuan.com/project/shiro/images/2.png"></p><p><strong>æµç¨‹è¯´æ˜</strong>ï¼š</p><ol><li>åº”ç”¨ä»£ç é€šè¿‡ Subject æ¥è¿›è¡Œè®¤è¯å’Œæˆæƒï¼Œè€Œ Subject åˆå§”æ‰˜ç»™ SecurityManagerï¼›</li><li>æˆ‘ä»¬éœ€è¦ç»™ Shiro çš„ SecurityManager æ³¨å…¥ Realmï¼Œä»è€Œè®© SecurityManager èƒ½å¾—åˆ°åˆæ³•çš„ç”¨æˆ·åŠå…¶æƒé™è¿›è¡Œåˆ¤æ–­ã€‚</li></ol><p><strong>ä»ä»¥ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒShiro ä¸æä¾›ç»´æŠ¤ç”¨æˆ· / æƒé™ï¼Œè€Œæ˜¯é€šè¿‡ Realm è®©å¼€å‘äººå‘˜è‡ªå·±æ³¨å…¥ã€‚</strong> </p><hr><p>shiroçš„å†…éƒ¨ç»“æ„å¦‚å›¾ï¼š</p><p><img src="http://wiki.jikexueyuan.com/project/shiro/images/3.png"></p><hr><h3 id="èº«ä»½éªŒè¯"><a href="#èº«ä»½éªŒè¯" class="headerlink" title="èº«ä»½éªŒè¯"></a>èº«ä»½éªŒè¯</h3><p><strong>principals</strong>ï¼šèº«ä»½ï¼Œå³ä¸»ä½“çš„æ ‡è¯†å±æ€§ï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œå¦‚ç”¨æˆ·åã€é‚®ç®±ç­‰ï¼Œå”¯ä¸€å³å¯ã€‚ </p><p><strong>credentials</strong>ï¼šè¯æ˜ / å‡­è¯ï¼Œå³åªæœ‰ä¸»ä½“çŸ¥é“çš„å®‰å…¨å€¼ï¼Œå¦‚å¯†ç  / æ•°å­—è¯ä¹¦ç­‰ã€‚ </p><ul><li>èº«ä»½è®¤è¯æµç¨‹</li></ul><p><img src="http://wiki.jikexueyuan.com/project/shiro/images/4.png"></p><hr><h3 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h3><p>æˆæƒï¼Œä¹Ÿå«è®¿é—®æ§åˆ¶ï¼Œå³åœ¨åº”ç”¨ä¸­æ§åˆ¶è°èƒ½è®¿é—®å“ªäº›èµ„æºï¼ˆå¦‚è®¿é—®é¡µé¢/ç¼–è¾‘æ•°æ®/é¡µé¢æ“ä½œç­‰ï¼‰ã€‚åœ¨æˆæƒä¸­éœ€äº†è§£çš„å‡ ä¸ªå…³é”®å¯¹è±¡ï¼šä¸»ä½“ï¼ˆSubjectï¼‰ã€èµ„æºï¼ˆResourceï¼‰ã€æƒé™ï¼ˆPermissionï¼‰ã€è§’è‰²ï¼ˆRoleï¼‰ã€‚ </p><ul><li><p>æˆæƒæ–¹å¼</p><p>ç¼–ç¨‹å¼ã€æ³¨è§£å¼ã€jsp/gspæ ‡ç­¾å¼</p></li></ul><h1 id="casdoor"><a href="#casdoor" class="headerlink" title="casdoor"></a>casdoor</h1><h2 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h2><ul><li><p>docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d -p 18000:8000 \</span><br><span class="line">  -v /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro \</span><br><span class="line">  -v /home/dingodb/dongwei/docker/timezone:/etc/timezone:ro \</span><br><span class="line">  casbin/casdoor-all-in-one</span><br></pre></td></tr></table></figure><blockquote><p>å®¹å™¨å†…éƒ¨æœåŠ¡ç«¯å£8000ï¼Œæ˜ å°„æˆå¯¹å¤–è®¿é—®æ¥ç«¯å£ 18000</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git mergetool</title>
      <link href="/2023/12/08/git%20mergetool/"/>
      <url>/2023/12/08/git%20mergetool/</url>
      
        <content type="html"><![CDATA[<h1 id="vimdiff"><a href="#vimdiff" class="headerlink" title="vimdiff"></a>vimdiff</h1><h2 id="è¿›å…¥å†²çªè§£å†³çª—å£"><a href="#è¿›å…¥å†²çªè§£å†³çª—å£" class="headerlink" title="è¿›å…¥å†²çªè§£å†³çª—å£"></a>è¿›å…¥å†²çªè§£å†³çª—å£</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git mergetool</span><br></pre></td></tr></table></figure><p>çª—å£æ˜¾ç¤ºå››éƒ¨åˆ†å†…å®¹</p><ul><li><p>LOCAL â€“ this is file from the current branch </p></li><li><p>BASE â€“ common ancestor, how file looked before both changes </p></li><li><p>REMOTE â€“ file you are merging into your branch </p></li><li><p>MERGED â€“ merge result, this is what gets saved in the repo</p></li></ul><p>ç§»åŠ¨çª—å£æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ctrl w + h   # move to the split on the left </span><br><span class="line">Ctrl w + j   # move to the split below</span><br><span class="line">Ctrl w + k   # move to the split on top</span><br><span class="line">Ctrl w + l   # move to the split on the right</span><br></pre></td></tr></table></figure><p>å¤„ç†å†²çª</p><ul><li><p>å¯ç§»åŠ¨åˆ°mergeçª—å£å»æ‰‹åŠ¨æ”¹</p></li><li><p>ä½¿ç”¨å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:diffg RE  # get from REMOTE</span><br><span class="line">:diffg BA  # get from BASE</span><br><span class="line">:diffg LO  # get from LOCAL</span><br></pre></td></tr></table></figure></li></ul><p>ä¿å­˜é€€å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:wqa</span><br></pre></td></tr></table></figure><h1 id="Meld"><a href="#Meld" class="headerlink" title="Meld"></a>Meld</h1><p>todo</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> skill </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI</title>
      <link href="/2023/12/08/ai/"/>
      <url>/2023/12/08/ai/</url>
      
        <content type="html"><![CDATA[<h1 id="machine-learning"><a href="#machine-learning" class="headerlink" title="machine learning"></a>machine learning</h1><p><a href="https://developers.google.com/machine-learning/glossary/fundamentals?hl=zh-cn">æœºå™¨å­¦ä¹ æœ¯è¯­è¡¨</a></p><h1 id="æœºå™¨å­¦ä¹ ç±»å‹"><a href="#æœºå™¨å­¦ä¹ ç±»å‹" class="headerlink" title="æœºå™¨å­¦ä¹ ç±»å‹"></a>æœºå™¨å­¦ä¹ ç±»å‹</h1><p><a href="https://developers.google.com/machine-learning/intro-to-ml/what-is-ml?hl=zh-cn">ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ</a></p><p>æ ¹æ®æœºå™¨å­¦ä¹ ç³»ç»Ÿå­¦ä¹ è¿›è¡Œé¢„æµ‹æˆ–ç”Ÿæˆå†…å®¹çš„æ–¹å¼ï¼Œæœºå™¨å­¦ä¹ ç³»ç»Ÿå¯åˆ†ä¸ºä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªç±»åˆ«ï¼š</p><ul><li>ç›‘ç£å¼å­¦ä¹ </li><li>éç›‘ç£å¼å­¦ä¹ </li><li>å¼ºåŒ–å­¦ä¹ </li><li>ç”Ÿæˆå¼ AI</li></ul><ul><li>å®ç°æœºå™¨å­¦ä¹ çš„ä¸€èˆ¬æ­¥éª¤ï¼š</li></ul><ol><li>æ•°æ®æ”¶é›†</li><li>æ•°æ®å‡†å¤‡</li><li>æ•°æ®åˆ†æ</li><li>è®­ç»ƒç®—æ³•</li><li>æµ‹è¯•ç®—æ³•</li><li>åº”ç”¨ç®—æ³•</li></ol><h2 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h2><p>è®­ç»ƒé›†ã€éªŒè¯é›†ã€æµ‹è¯•é›†</p><h1 id="FSM"><a href="#FSM" class="headerlink" title="FSM"></a>FSM</h1><blockquote><p>The FSM can change from one state to another in response to some inputs; the change from one state to another is called a <em>transition</em>.</p></blockquote><p><img src="./images/fsm/Automata_theory.png"></p><hr><p><strong>reference</strong></p><ul><li><a href="https://en.wikipedia.org/wiki/Finite-state_machine">https://en.wikipedia.org/wiki/Finite-state_machine</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tmux</title>
      <link href="/2023/11/15/tmux%20snippet/"/>
      <url>/2023/11/15/tmux%20snippet/</url>
      
        <content type="html"><![CDATA[<p>session -&gt; window -&gt; pane</p><h1 id="session"><a href="#session" class="headerlink" title="session"></a>session</h1><table><thead><tr><th>åŠŸèƒ½</th><th>macos</th><th>linux</th></tr></thead><tbody><tr><td>æ–°å»ºsession</td><td>tmux new -s <session-name></td><td>same</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h1 id="çª—å£"><a href="#çª—å£" class="headerlink" title="çª—å£"></a>çª—å£</h1><table><thead><tr><th>åŠŸèƒ½</th><th>macos</th><th>linux</th></tr></thead><tbody><tr><td>æ›´æ”¹å½“å‰çª—å£çš„ç´¢å¼•å·</td><td>å‘½ä»¤æ¨¡å¼ï¼šmove-window [space] -t [space]  xx</td><td>Same</td></tr></tbody></table><h1 id="çª—æ ¼"><a href="#çª—æ ¼" class="headerlink" title="çª—æ ¼"></a>çª—æ ¼</h1><table><thead><tr><th>åŠŸèƒ½</th><th>macos</th><th>linux</th></tr></thead><tbody><tr><td>è°ƒæ•´çª—æ ¼å¤§å°</td><td>Ctrl + b, Esc + æ–¹å‘é”®</td><td>Ctrl + b, Ctrl + æ–¹å‘é”®</td></tr><tr><td>çª—æ ¼å†…å®¹ç¿»é¡µ</td><td>Ctrl + b, (Fn + ä¸Šä¸‹é”®) æˆ– PgUp/PgDn</td><td>Ctrl + b, Ctrl + ä¸Šä¸‹é”®</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h1 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h1><table><thead><tr><th>åŠŸèƒ½</th><th>macos</th><th>linux</th></tr></thead><tbody><tr><td>å†…åµŒtmuxæ“ä½œ</td><td><strong>æŒ‰ç€ ctrlï¼Œç‚¹å‡»ä¸¤æ¬¡ b é”®</strong></td><td>Same</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h1 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h1><p><code>ctrl + b</code> ç„¶åæŒ‰ä¸‹<code>:</code></p><h2 id="ä¼šè¯-session"><a href="#ä¼šè¯-session" class="headerlink" title="ä¼šè¯(session)"></a>ä¼šè¯(session)</h2><ul><li><p>åˆ›å»ºä¼šè¯</p><p><code>new-session -s &lt;session name&gt;</code> </p></li><li><p>åˆ‡æ¢ä¼šè¯</p><p><code>switch-client -t &lt;session name or id&gt;</code></p></li><li><p>åˆ é™¤ä¼šè¯</p><p><code>tmux kill-session -t &lt;session-name&gt;</code></p></li><li><p>æŸ¥æ‰¾/è¿‡æ»¤ä¼šè¯</p><p><code>ctrl+b, f</code></p></li></ul><h2 id="çª—å£-window"><a href="#çª—å£-window" class="headerlink" title="çª—å£(window)"></a>çª—å£(window)</h2><ul><li><p>å¿«é€Ÿå®šä½æŒ‡å®šç¼–å·çš„çª—å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®šä½ç¼–å·å°äº10çš„çª—å£</span></span><br><span class="line">Ctrl + b &lt;index&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®šä½ç¼–å·å¤§äºç­‰äº10çš„çª—å£</span></span><br><span class="line">Ctrl + b</span><br><span class="line">&#x27; (single quote)</span><br><span class="line">14</span><br><span class="line">Enter</span><br></pre></td></tr></table></figure></li><li><p>äº¤æ¢çª—å£ä½ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> äº¤æ¢ç¼–å·3ä¸ç¼–å·1çª—å£çš„ä½ç½®</span></span><br><span class="line">swap-window -s 3 -t 1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠå½“å‰çª—å£æ”¾åˆ°æŒ‡å®šç¼–å·1çš„ä½ç½®</span></span><br><span class="line">swap-window -t 0</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºçª—å£</p><p><code>new-window -n &lt;window name&gt;</code></p></li><li><p>åˆ‡æ¢çª—å£</p><p><code>select-window -t &lt;window id&gt;</code></p><p><code>select-window -n &lt;window name&gt;</code></p></li></ul><h2 id="çª—æ ¼-pane"><a href="#çª—æ ¼-pane" class="headerlink" title="çª—æ ¼(pane)"></a>çª—æ ¼(pane)</h2><ul><li><p>åˆ†å‰²çª—æ ¼</p><p><code>split-window -h</code> æ°´å¹³</p><p><code>split-window -v</code> å‚ç›´</p></li><li><p>æ”¹å˜ä½ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check pane num</span></span><br><span class="line">Ctrl + b, Then press q # this will display pane numbers</span><br><span class="line"></span><br><span class="line">:swap-pane -s &lt;source-pane&gt; -t &lt;target-pane&gt;</span><br><span class="line">or </span><br><span class="line">:swap-pane -t &lt;target-pane&gt;</span><br></pre></td></tr></table></figure></li><li><p>å®šä½æŒ‡å®špane</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> to show pane numbers</span></span><br><span class="line">Ctrl + b + â q </span><br><span class="line"></span><br><span class="line">then press the pane number</span><br></pre></td></tr></table></figure></li><li><p>åŒæ—¶æ“ä½œç›¸åŒwindowçš„æ‰€æœ‰pane</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">enable</span></span></span><br><span class="line">setw synchronize-panes on</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">disable</span></span></span><br><span class="line">setw synchronize-panes off</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æ”¹å˜å¤§å°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Ctrl + b, <span class="built_in">type</span> <span class="string">&#x27;:&#x27;</span></span></span><br><span class="line">resize-pane -D 10    # Resize down by 10 lines</span><br><span class="line">resize-pane -U 5     # Resize up by 5 lines</span><br><span class="line">resize-pane -L 20    # Resize left by 20 columns</span><br><span class="line">resize-pane -R 15    # Resize right by 15 columns</span><br></pre></td></tr></table></figure></li></ul><h1 id="Tmux-Plugin-Manager-TPM"><a href="#Tmux-Plugin-Manager-TPM" class="headerlink" title="Tmux Plugin Manager (TPM)"></a>Tmux Plugin Manager (TPM)</h1><ul><li><p>é…ç½®æ–‡ä»¶åœ°å€<code>~/.tmux.conf</code></p><p>ä¿®æ”¹é…ç½®ç”Ÿæ•ˆ <code>tmux source-file ~/.tmux.conf</code></p></li><li><h5 id="ä½¿ç”¨å¿«æ·é”®æ’ä»¶ç®¡ç†"><a href="#ä½¿ç”¨å¿«æ·é”®æ’ä»¶ç®¡ç†" class="headerlink" title="ä½¿ç”¨å¿«æ·é”®æ’ä»¶ç®¡ç†"></a>ä½¿ç”¨å¿«æ·é”®æ’ä»¶ç®¡ç†</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># prefixè¡¨ç¤ºæ˜¯Tmuxçš„å¿«æ·é”®å‰ç¼€</span><br><span class="line">prefix shift-i      # å®‰è£…ä»¶åˆ—è¡¨ä¸­çš„æ’ä»¶</span><br><span class="line">prefix shift-u      # æ›´æ–°ä»¶åˆ—è¡¨ä¸­çš„æ’ä»¶</span><br><span class="line">prefix alt-u        # åˆ é™¤/å¸è½½ä¸åœ¨æ’ä»¶åˆ—è¡¨ä¸­çš„æ’ä»¶</span><br></pre></td></tr></table></figure></li><li><h5 id="ä½¿ç”¨å‘½ä»¤è¡Œæ’ä»¶ç®¡ç†"><a href="#ä½¿ç”¨å‘½ä»¤è¡Œæ’ä»¶ç®¡ç†" class="headerlink" title="ä½¿ç”¨å‘½ä»¤è¡Œæ’ä»¶ç®¡ç†"></a>ä½¿ç”¨å‘½ä»¤è¡Œæ’ä»¶ç®¡ç†</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/.tmux/plugins/tpm/bin/install_plugins                  # å®‰è£…ä»¶åˆ—è¡¨ä¸­çš„æ’ä»¶</span><br><span class="line">~/.tmux/plugins/tpm/bin/update_plugins all|plugname      # æ›´æ–°æ‰€æœ‰æ’ä»¶æˆ–æŒ‡å®šæ’ä»¶</span><br><span class="line">~/.tmux/plugins/tpm/bin/clean_plugins                    # åˆ é™¤/å¸è½½ä¸åœ¨æ’ä»¶åˆ—è¡¨ä¸­çš„æ’ä»¶</span><br></pre></td></tr></table></figure></li><li><h5 id="ä¿å­˜-æ¢å¤ä¼šè¯-tmux-resurrect"><a href="#ä¿å­˜-æ¢å¤ä¼šè¯-tmux-resurrect" class="headerlink" title="ä¿å­˜/æ¢å¤ä¼šè¯ tmux-resurrect"></a>ä¿å­˜/æ¢å¤ä¼šè¯ tmux-resurrect</h5><blockquote><p>é»˜è®¤ä¼šè¯æ•°æ®è·¯å¾„ /.local/share/tmux/resurrect</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¿å­˜Tmuxä¼šè¯ï¼šå‰ç¼€é”® + Ctrl-s</span><br><span class="line">è¿˜åŸTmuxä¼šè¯ï¼š å‰ç¼€é”® + Ctrl-r</span><br><span class="line"></span><br><span class="line">Tmux Resurrect ä¼šå°† Tmux ä¼šè¯çš„è¯¦ç»†ä¿¡æ¯ä»¥æ–‡æœ¬æ–‡ä»¶å½¢å¼ä¿å­˜åˆ° ~/.tmux/resurrect ç›®å½•ï¼›</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> tmux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python snippet</title>
      <link href="/2023/11/14/python%20snippet/"/>
      <url>/2023/11/14/python%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="è™šæ‹Ÿç¯å¢ƒ"><a href="#è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒ"></a>è™šæ‹Ÿç¯å¢ƒ</h1><p>é¡¹ç›®ç²’åº¦ï¼špython -m venv venv<br>                    poetry<br>ç³»ç»Ÿç²’åº¦ï¼špyenv<br>                    conda</p><h1 id="æŒ‡ä»¤"><a href="#æŒ‡ä»¤" class="headerlink" title="æŒ‡ä»¤"></a>æŒ‡ä»¤</h1><ul><li><p>å®‰è£…tar.gzï¼Œè§£å‹ä¹‹åï¼Œæ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure></li></ul><h2 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h2><ul><li><p>å›½å†…é•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip config set global.index-url https://pypi.mirrors.ustc.edu.cn/simple</span><br><span class="line">pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…å­æ¨¡å—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install &#x27;fastapi_amis_admin[cli]&#x27;  # æ³¨æ„å¼•å·</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æŒ‡å®šä¾èµ–ç‰ˆæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip show package_name</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æŠŠé¡¹ç›®çš„ä¾èµ–æ”¾å…¥æŒ‡å®šæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure></li><li><p>æ¸…é™¤ç¼“å­˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip cache purge</span><br></pre></td></tr></table></figure></li></ul><h1 id="Buildins"><a href="#Buildins" class="headerlink" title="Buildins"></a>Buildins</h1><ul><li>è£…é¥°å™¨ <code>staticmethod</code> ç”¨äºå®šä¹‰ä¸ç±»æˆ–å®ä¾‹æ— å…³çš„å‡½æ•°ï¼Œè€Œ <code>classmethod</code> ç”¨äºå®šä¹‰éœ€è¦è®¿é—®ç±»æˆ–ç±»å˜é‡çš„å‡½æ•°ã€‚</li></ul><h1 id="profiler"><a href="#profiler" class="headerlink" title="profiler"></a>profiler</h1><h2 id="py-spy"><a href="#py-spy" class="headerlink" title="py-spy"></a>py-spy</h2><ul><li>record</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo py-spy record -o tableagent.svg --pid 37152</span><br></pre></td></tr></table></figure><h1 id="ä¿¡åˆ›"><a href="#ä¿¡åˆ›" class="headerlink" title="ä¿¡åˆ›"></a>ä¿¡åˆ›</h1><ul><li><p>å®‰è£…python3-devel</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install python3-devel</span><br></pre></td></tr></table></figure></li></ul><h1 id="è§„èŒƒ"><a href="#è§„èŒƒ" class="headerlink" title="è§„èŒƒ"></a>è§„èŒƒ</h1><ul><li><p><strong>è¯·é€‰æ‹©å››ä¸ªç©ºæ ¼çš„ç¼©è¿›ï¼Œä¸è¦ä½¿ç”¨ Tabï¼Œæ›´ä¸è¦ Tab å’Œç©ºæ ¼æ··ç€ç”¨ã€‚</strong></p></li><li><p><strong>å…¨å±€çš„ç±»å’Œå‡½æ•°çš„ä¸Šæ–¹éœ€è¦ç©ºä¸¤ä¸ªç©ºè¡Œï¼Œè€Œç±»çš„å‡½æ•°ä¹‹é—´éœ€è¦ç©ºä¸€ä¸ªç©ºè¡Œ</strong></p></li><li><p>ä»£ç çš„å°¾éƒ¨ï¼Œæ¯ä¸ªä»£ç æ–‡ä»¶çš„æœ€åä¸€è¡Œä¸ºç©ºè¡Œï¼Œå¹¶ä¸”åªæœ‰è¿™ä¸€ä¸ªç©ºè¡Œã€‚</p></li><li><p>å¯ä»¥ä½¿ç”¨<code>#</code>è¿›è¡Œå•ç‹¬æ³¨é‡Šï¼Œè¯·è®°å¾—è¦åœ¨<code>#</code>åã€æ³¨é‡Šå‰åŠ ä¸€ä¸ªç©ºæ ¼ã€‚</p></li><li><p>å¯¹äºæ“ä½œç¬¦ï¼Œä¾‹å¦‚<code>+</code>ï¼Œ<code>-</code>ï¼Œ<code>*</code>ï¼Œ<code>/</code>ï¼Œ<code>&amp;</code>ï¼Œ<code>|</code>ï¼Œ<code>=</code>ï¼Œ<code>==</code>ï¼Œ<code>!=</code>ï¼Œè¯·åœ¨ä¸¤è¾¹éƒ½ä¿ç•™ç©ºæ ¼ã€‚ä¸è¿‡ä¸æ­¤å¯¹åº”ï¼Œæ‹¬å·å†…çš„ä¸¤ç«¯å¹¶ä¸éœ€è¦ç©ºæ ¼ã€‚</p></li><li><p>é‡‡ç”¨ <code>from module import func</code> è¿™æ ·çš„è¯­å¥ï¼Œè¯·ç¡®ä¿ func åœ¨æœ¬æ–‡ä»¶ä¸­ä¸ä¼šå‡ºç°å‘½åå†²çªã€‚ä¸è¿‡ï¼Œä½ å…¶å®å¯ä»¥é€šè¿‡ <code>from module import func as new_func</code> æ¥è¿›è¡Œé‡å‘½åï¼Œä»è€Œé¿å…å†²çªã€‚</p></li><li><p>å¦‚æœæ˜¯ç±»çš„ç§æœ‰å˜é‡ï¼Œè¯·è®°å¾—å‰é¢å¢åŠ ä¸¤ä¸ªä¸‹åˆ’çº¿ã€‚</p></li><li><p>å¯¹äºå¸¸é‡ï¼Œæœ€å¥½çš„åšæ³•æ˜¯å…¨éƒ¨å¤§å†™ï¼Œå¹¶é€šè¿‡ä¸‹åˆ’çº¿è¿æ¥</p></li><li><p>å¯¹äºå‡½æ•°åï¼ŒåŒæ ·ä¹Ÿè¯·ä½¿ç”¨å°å†™çš„æ–¹å¼ï¼Œé€šè¿‡ä¸‹åˆ’çº¿è¿æ¥èµ·æ¥ï¼Œä¾‹å¦‚ï¼š<code>launch_nuclear_missile()</code>ã€<code>check_input_validation()</code>ã€‚</p></li><li><p>å¯¹äºç±»åï¼Œåˆ™åº”è¯¥é¦–å­—æ¯å¤§å†™ï¼Œç„¶ååˆå¹¶èµ·æ¥ï¼Œä¾‹å¦‚ï¼š<code>class SpatialDropout2D()</code>ã€<code>class FeatureSet()</code>ã€‚</p></li></ul><h1 id="Principle"><a href="#Principle" class="headerlink" title="Principle"></a>Principle</h1><h2 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h2><ul><li><p>S <em>ï¼ˆå•ä¸€èŒè´£åŸåˆ™ Single responsibility principleï¼‰</em> </p><ul><li><strong>ä¸€ä¸ªç±»åº”è¯¥ä»…ä»…åªæœ‰ä¸€ä¸ªè¢«ä¿®æ”¹çš„ç†ç”±ã€‚</strong></li></ul></li><li><p>O <em>ï¼ˆå¼€æ”¾-å…³é—­åŸåˆ™ Openâ€“closed principleï¼‰</em></p><ul><li><strong>ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚</strong></li></ul></li><li><p>L <em>ï¼ˆé‡Œæ°æ›¿æ¢åŸåˆ™ Liskov Substitution Principleï¼‰</em></p><ul><li><strong>å­ç±»åº”è¯¥å¯ä»¥éšæ„æ›¿æ¢å®ƒçš„çˆ¶ç±» ï¼Œè€Œä¸ç ´åç¨‹åº æœ¬èº«çš„åŠŸèƒ½</strong></li></ul></li><li><p>I <em>ï¼ˆæ¥å£éš”ç¦»åŸåˆ™ Interface Segregation Principlesï¼‰</em></p><ul><li><strong>å®¢æˆ·ï¼ˆclientï¼‰åº”è¯¥ä¸ä¾èµ–äºå®ƒä¸ä½¿ç”¨çš„æ–¹æ³•</strong></li></ul></li><li><p>D <em>ï¼ˆä¾èµ–å€’ç½®åŸåˆ™ Dependency Inversion Principleï¼‰</em></p><ul><li><strong>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚</strong></li></ul></li></ul><h2 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h2><ul><li>å¥½ä»£ç åœ¨å¤„ç†è¾¹ç•Œæƒ…å†µæ—¶åº”è¯¥æ˜¯ç®€æ´çš„ã€â€œæ¶¦ç‰©ç»†æ— å£°â€çš„</li></ul><h2 id="code-practise"><a href="#code-practise" class="headerlink" title="code practise"></a>code practise</h2><h4 id="è¾¹ç•Œæƒ…å†µï¼ˆEdge-casesï¼‰"><a href="#è¾¹ç•Œæƒ…å†µï¼ˆEdge-casesï¼‰" class="headerlink" title="è¾¹ç•Œæƒ…å†µï¼ˆEdge casesï¼‰"></a>è¾¹ç•Œæƒ…å†µï¼ˆEdge casesï¼‰</h4><ul><li>bad style: <ul><li>LBYLï¼ˆLook Before You Leapï¼‰</li></ul></li><li>better style:<ul><li>EAFPï¼ˆEasier to Ask for Forgiveness than Permissionï¼‰</li></ul></li><li>best style<ul><li>åœ¨æ—¥å¸¸ç¼–ç æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…å»æ‰‹åŠ¨æ ¡éªŒæ•°æ®ã€‚è€Œæ˜¯åº”è¯¥ä½¿ç”¨<em>ï¼ˆæˆ–è€…è‡ªå·±å®ç°ï¼‰</em>åˆé€‚çš„ç¬¬ä¸‰æ–¹æ ¡éªŒæ¨¡å—ï¼ŒæŠŠè¿™éƒ¨åˆ†è¾¹ç•Œå¤„ç†å·¥ä½œæŠ½è±¡å‡ºå»ï¼Œç®€åŒ–ä¸»æµç¨‹ä»£ç ã€‚</li></ul></li></ul><h1 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h1><h3 id="ç»Ÿè®¡è¿è¡Œæ—¶é—´"><a href="#ç»Ÿè®¡è¿è¡Œæ—¶é—´" class="headerlink" title="ç»Ÿè®¡è¿è¡Œæ—¶é—´"></a>ç»Ÿè®¡è¿è¡Œæ—¶é—´</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯«ç§’å€¼</span></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">xxx</span><br><span class="line">cost_time = <span class="built_in">int</span>((time.perf_counter() - start_time)* <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h3 id="call-å‡½æ•°"><a href="#call-å‡½æ•°" class="headerlink" title="__call__å‡½æ•°"></a><code>__call__å‡½æ•°</code></h3><p><code>__call__</code> æ–¹æ³•æ˜¯ Python ä¸­çš„ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼ˆä¹Ÿç§°ä¸ºé­”æœ¯æ–¹æ³•ï¼‰ï¼Œç”¨äºå°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°è°ƒç”¨ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼ŒPython è§£é‡Šå™¨ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥å¯¹è±¡çš„ <code>__call__</code> æ–¹æ³•ã€‚</p><p>åœ¨ç±»ä¸­å®šä¹‰ <code>__call__</code> æ–¹æ³•å¯ä»¥ä½¿å¯¹è±¡å…·æœ‰å¯è°ƒç”¨çš„è¡Œä¸ºï¼Œå°±åƒè°ƒç”¨å‡½æ•°ä¸€æ ·ã€‚è¿™æ ·çš„å¯¹è±¡è¢«ç§°ä¸ºå¯è°ƒç”¨å¯¹è±¡ã€‚é€šè¿‡å®ç° <code>__call__</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡è¢«è°ƒç”¨æ—¶æ‰§è¡Œç‰¹å®šçš„é€»è¾‘ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨ <code>__call__</code> æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableClass</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Object is being called&quot;</span>)</span><br><span class="line"></span><br><span class="line">obj = CallableClass()</span><br><span class="line">obj()  <span class="comment"># ç­‰åŒäºè°ƒç”¨ obj.__call__()</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>CallableClass</code> çš„ç±»ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°äº† <code>__call__</code> æ–¹æ³•ã€‚å½“åˆ›å»º <code>CallableClass</code> çš„å®ä¾‹ <code>obj</code> å¹¶å°†å…¶ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œ<code>__call__</code> æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œå¹¶æ‰“å°å‡º â€œObject is being calledâ€ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>__call__</code> æ–¹æ³•å¯ä»¥å¸¦æœ‰å‚æ•°ï¼Œå°±åƒæ™®é€šçš„å‡½æ•°ä¸€æ ·ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>__call__</code> æ–¹æ³•ä¸­å®šä¹‰ä»»æ„çš„é€»è¾‘ï¼Œå¯ä»¥è®¿é—®å®ä¾‹çš„å±æ€§ã€è°ƒç”¨å…¶ä»–æ–¹æ³•ç­‰ã€‚</p><p>ä½¿ç”¨ <code>__call__</code> æ–¹æ³•å¯ä»¥ä½¿å¯¹è±¡å…·æœ‰ç±»ä¼¼å‡½æ•°çš„è¡Œä¸ºï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚å®ç°å¯è°ƒç”¨çš„ç±»æˆ–å®ç°å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="**ä½¿ç”¨"></a><code>**</code>ä½¿ç”¨</h3><ul><li><p><code>**</code> è¿ç®—ç¬¦ç”¨äºè§£åŒ…å­—å…¸æˆ–å…³é”®å­—å‚æ•°ã€‚å½“åº”ç”¨äºå­—å…¸æ—¶ï¼Œ<code>**</code> è¿ç®—ç¬¦å¯ä»¥å°†å­—å…¸ä¸­çš„é”®å€¼å¯¹è§£åŒ…ä¸ºä¸€ç³»åˆ—å…³é”®å­—å‚æ•°ä¼ é€’ç»™å‡½æ•°æˆ–æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_person_info</span>(<span class="params">name, age, city</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Name: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Age: <span class="subst">&#123;age&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;City: <span class="subst">&#123;city&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">person = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;New York&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print_person_info(**person)</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¸ƒå°”çœŸå‡åˆ¤æ–­"><a href="#å¸ƒå°”çœŸå‡åˆ¤æ–­" class="headerlink" title="å¸ƒå°”çœŸå‡åˆ¤æ–­"></a>å¸ƒå°”çœŸå‡åˆ¤æ–­</h3><p>è™½ç„¶æ‰€æœ‰ç”¨æˆ·ç±»å®ä¾‹çš„å¸ƒå°”å€¼éƒ½æ˜¯çœŸã€‚ä½†æ˜¯ Python æä¾›äº†æ”¹å˜è¿™ä¸ªè¡Œä¸ºçš„åŠæ³•ï¼š<strong>è‡ªå®šä¹‰ç±»çš„ <code>__bool__</code> é­”æ³•æ–¹æ³•</strong> <em>ï¼ˆåœ¨ Python 2.X ç‰ˆæœ¬ä¸­ä¸º <code>__nonzero__</code>ï¼‰</em>ã€‚å½“ç±»å®šä¹‰äº† <code>__bool__</code> æ–¹æ³•åï¼Œå®ƒçš„è¿”å›å€¼å°†ä¼šè¢«å½“ä½œç±»å®ä¾‹çš„å¸ƒå°”å€¼ã€‚</p><p>å¦å¤–ï¼Œ<code>__bool__</code> ä¸æ˜¯å½±å“å®ä¾‹å¸ƒå°”çœŸå‡çš„å”¯ä¸€æ–¹æ³•ã€‚å¦‚æœç±»æ²¡æœ‰å®šä¹‰ <code>__bool__</code> æ–¹æ³•ï¼ŒPython è¿˜ä¼šå°è¯•è°ƒç”¨ <code>__len__</code> æ–¹æ³•<em>ï¼ˆä¹Ÿå°±æ˜¯å¯¹ä»»ä½•åºåˆ—å¯¹è±¡è°ƒç”¨ <code>len</code> å‡½æ•°ï¼‰</em>ï¼Œé€šè¿‡ç»“æœæ˜¯å¦ä¸º <code>0</code> åˆ¤æ–­å®ä¾‹çœŸå‡ã€‚</p><h3 id="åœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä½¿ç”¨-all-any"><a href="#åœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä½¿ç”¨-all-any" class="headerlink" title="åœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä½¿ç”¨ all() / any()"></a>åœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä½¿ç”¨ all() / any()</h3><p><code>all()</code> å’Œ <code>any()</code> ä¸¤ä¸ªå‡½æ•°éå¸¸é€‚åˆåœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä½¿ç”¨ã€‚è¿™ä¸¤ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå…¶ä¸­ï¼š</p><ul><li><code>all(seq)</code>ï¼šä»…å½“ <code>seq</code> ä¸­æ‰€æœ‰å¯¹è±¡éƒ½ä¸ºå¸ƒå°”çœŸæ—¶è¿”å› <code>True</code>ï¼Œå¦åˆ™è¿”å› <code>False</code></li><li><code>any(seq)</code>ï¼šåªè¦ <code>seq</code> ä¸­ä»»ä½•ä¸€ä¸ªå¯¹è±¡ä¸ºå¸ƒå°”çœŸå°±è¿”å› <code>True</code>ï¼Œå¦åˆ™è¿”å› <code>False</code></li></ul><h3 id="ä½¿ç”¨-partial-æ„é€ æ–°å‡½æ•°"><a href="#ä½¿ç”¨-partial-æ„é€ æ–°å‡½æ•°" class="headerlink" title="ä½¿ç”¨ partial æ„é€ æ–°å‡½æ•°"></a>ä½¿ç”¨ partial æ„é€ æ–°å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x * y</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">double</span>(<span class="params">value</span>):</span></span><br><span class="line">    <span class="comment"># è¿”å›å¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> multiply(<span class="number">2</span>, value)</span><br></pre></td></tr></table></figure><p>å¯å†™æˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line">double = functools.partial(multiply, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><h3 id="Mixin"><a href="#Mixin" class="headerlink" title="Mixin"></a>Mixin</h3><blockquote><p>Mixin æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œå®ƒè¡¨ç¤ºä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†ä¸€ç»„åŠŸèƒ½æˆ–è¡Œä¸ºä»¥æ¨¡å—åŒ–çš„æ–¹å¼æ·»åŠ åˆ°ç±»ä¸­ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendMailMixin</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_mail</span>(<span class="params">self, email</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Sending mail to <span class="subst">&#123;email&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, email</span>):</span></span><br><span class="line">        self.email = email</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminUser</span>(<span class="params">User, SendMailMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_admin_mail</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.send_mail(self.email)</span><br><span class="line"></span><br><span class="line">admin = AdminUser(<span class="string">&quot;admin@example.com&quot;</span>)</span><br><span class="line">admin.send_admin_mail()  <span class="comment"># è¾“å‡º: Sending mail to admin@example.com</span></span><br></pre></td></tr></table></figure><p><strong>Mixinå’Œabc.ABCçš„åŒºåˆ«:</strong></p><ol><li><strong>ç”¨é€”</strong>: Mixinä¾§é‡äºä»£ç å¤ç”¨å’ŒåŠŸèƒ½æ‰©å±•,è€Œabc.ABCåˆ™ç”¨äºå®šä¹‰æŠ½è±¡ç±»å’Œæ¥å£ã€‚</li><li><strong>ç»§æ‰¿å…³ç³»</strong>: Mixiné€šå¸¸ä¸å…¶ä»–ç±»ä¸€èµ·ä½¿ç”¨å¤šé‡ç»§æ‰¿,è€Œabc.ABCä½œä¸ºåŸºç±»è¢«å…·ä½“ç±»ç»§æ‰¿ã€‚</li><li><strong>æŠ½è±¡ç¨‹åº¦</strong>: Mixinå¯ä»¥åŒ…å«å…·ä½“çš„å®ç°,è€Œabc.ABCä¸­çš„æŠ½è±¡æ–¹æ³•å¿…é¡»ç”±å­ç±»å®ç°ã€‚</li><li><strong>ç±»å‹æ£€æŸ¥</strong>: abc.ABCå¯ç”¨äºç±»å‹æ£€æŸ¥,è€ŒMixinæ— æ³•ç›´æ¥è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚</li></ol><h3 id="LOOP"><a href="#LOOP" class="headerlink" title="LOOP"></a>LOOP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(names):</span><br><span class="line">    <span class="built_in">print</span>(i, name)</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ product æ‰å¹³åŒ–å¤šå±‚åµŒå¥—å¾ªç¯</li><li>ä½¿ç”¨ islice å®ç°å¾ªç¯å†…éš”è¡Œå¤„ç†</li><li>ä½¿ç”¨ takewhile æ›¿ä»£ break è¯­å¥</li><li>ä½¿ç”¨ç”Ÿæˆå™¨ç¼–å†™è‡ªå·±çš„ä¿®é¥°å‡½æ•°</li></ul><h3 id="ä¿®æ”¹å¤–å±‚å˜é‡æ—¶è®°å¾—ä½¿ç”¨-nonlocal"><a href="#ä¿®æ”¹å¤–å±‚å˜é‡æ—¶è®°å¾—ä½¿ç”¨-nonlocal" class="headerlink" title="ä¿®æ”¹å¤–å±‚å˜é‡æ—¶è®°å¾—ä½¿ç”¨ nonlocal"></a>ä¿®æ”¹å¤–å±‚å˜é‡æ—¶è®°å¾—ä½¿ç”¨ nonlocal</h3><ul><li>é—­åŒ…çš„å‚æ•°ä½¿ç”¨</li></ul><h3 id="ç±»å¯¹è±¡"><a href="#ç±»å¯¹è±¡" class="headerlink" title="ç±»å¯¹è±¡"></a>ç±»å¯¹è±¡</h3><ul><li><code>cls</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_send_request</span>(<span class="params">cls, method, endpoint, json=<span class="literal">None</span>, params=<span class="literal">None</span></span>):</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-dataclass-ç®€åŒ–ä»£ç "><a href="#ä½¿ç”¨-dataclass-ç®€åŒ–ä»£ç " class="headerlink" title="ä½¿ç”¨ dataclass ç®€åŒ–ä»£ç "></a>ä½¿ç”¨ dataclass ç®€åŒ–ä»£ç </h3><p>æ€»ç»“ä¸€ä¸‹,dataclassä¸»è¦æä¾›äº†ä»¥ä¸‹å‡ æ–¹é¢çš„åŠŸèƒ½:</p><ol><li><p><strong>è‡ªåŠ¨ç”Ÿæˆæ„é€ å‡½æ•°å’ŒåŸºæœ¬æ–¹æ³•</strong></p><ul><li>è‡ªåŠ¨ç”Ÿæˆ<code>__init__</code>æ„é€ å‡½æ•°</li><li>è‡ªåŠ¨ç”Ÿæˆ<code>__repr__</code>ã€<code>__eq__</code>ç­‰åŸºæœ¬æ–¹æ³•</li></ul></li><li><p><strong>æ•°æ®å­—æ®µç®¡ç†</strong></p><ul><li>å®šä¹‰æ•°æ®å­—æ®µ</li><li>æ”¯æŒä¸ºå­—æ®µè®¾ç½®é»˜è®¤å€¼</li><li>æ”¯æŒå­—æ®µç±»å‹æ³¨è§£</li><li>æ”¯æŒåªè¯»å­—æ®µã€åæœŸåˆå§‹åŒ–å­—æ®µ</li></ul></li><li><p><strong>æ•°æ®ç±»è¡Œä¸ºå®šåˆ¶</strong></p><ul><li>å¯è‡ªå®šä¹‰å­—æ®µæ’åº</li><li>å¯è‡ªå®šä¹‰å­—æ®µå‘½åè§„åˆ™(snake_case/CamelCase)</li><li>æ”¯æŒè‡ªå®šä¹‰<code>__post_init__</code>æ–¹æ³•åšæ•°æ®æ ¡éªŒ</li><li>å¯æ§åˆ¶æ˜¯å¦ç”Ÿæˆ<code>__repr__</code>æ–¹æ³•</li><li>æ”¯æŒç”Ÿæˆ<code>__hash__</code>æ–¹æ³•ç”¨äºå“ˆå¸Œ</li></ul></li><li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p><ul><li>æ”¯æŒä½¿ç”¨<code>__slots__</code>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li></ul></li><li><p><strong>ä¸é™æ€ç±»å‹æ£€æŸ¥å·¥å…·ç»“åˆ</strong></p><ul><li>æ”¯æŒä¸mypyç­‰ç±»å‹æ£€æŸ¥å·¥å…·ç»“åˆä½¿ç”¨</li></ul></li><li><p><strong>ç»§æ‰¿å’ŒåµŒå¥—</strong></p><ul><li>æ”¯æŒæ•°æ®ç±»çš„ç»§æ‰¿</li><li>æ”¯æŒåµŒå¥—æ•°æ®ç±»ä½œä¸ºå­—æ®µ</li></ul></li></ol><p>é€šè¿‡è¿™äº›åŠŸèƒ½,dataclasså¯ä»¥æå¤§ç®€åŒ–æ•°æ®ç±»çš„å®šä¹‰å’Œä½¿ç”¨,å‡å°‘æ ·æ¿ä»£ç ã€‚å®ƒä½¿å¾—åˆ›å»ºæ•°æ®ç±»å˜å¾—é«˜æ•ˆå’Œä¼˜é›…,åŒæ—¶è¿˜æä¾›äº†è¶³å¤Ÿçš„å®šåˆ¶ç©ºé—´ã€‚æ— è®ºæ˜¯ç®€å•çš„æ•°æ®æŒæœ‰å¯¹è±¡è¿˜æ˜¯å¤æ‚çš„æ•°æ®ç»“æ„,dataclasséƒ½èƒ½å‘æŒ¥å®ƒçš„ä¼˜åŠ¿,æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h1 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h1><h3 id="æ–‡ä»¶å¤„ç†"><a href="#æ–‡ä»¶å¤„ç†" class="headerlink" title="æ–‡ä»¶å¤„ç†"></a>æ–‡ä»¶å¤„ç†</h3><ul><li>pathlib</li></ul><h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><p>jsonæ¨¡å—ä¸»è¦æœ‰å››ä¸ªæ¯”è¾ƒé‡è¦çš„å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>dump</code> - å°†Pythonå¯¹è±¡æŒ‰ç…§JSONæ ¼å¼åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­</li><li><code>dumps</code> - å°†Pythonå¯¹è±¡å¤„ç†æˆJSONæ ¼å¼çš„å­—ç¬¦ä¸²</li><li><code>load</code> - å°†æ–‡ä»¶ä¸­çš„JSONæ•°æ®ååºåˆ—åŒ–æˆå¯¹è±¡</li><li><code>loads</code> - å°†å­—ç¬¦ä¸²çš„å†…å®¹ååºåˆ—åŒ–æˆPythonå¯¹è±¡</li></ul><h1 id="Grammar"><a href="#Grammar" class="headerlink" title="Grammar"></a>Grammar</h1><ul><li><code>*args</code> æ¥æ”¶å¹¶å¤„ç†æ‰€æœ‰ä¼ é€’è¿›æ¥çš„ä½ç½®å‚æ•°ï¼Œ<code>**kwargs</code> æ¥æ”¶å¹¶å¤„ç†æ‰€æœ‰ä¼ é€’è¿›æ¥çš„å…³é”®å­—å‚æ•°ã€‚</li></ul><h2 id="struture"><a href="#struture" class="headerlink" title="struture"></a>struture</h2><ul><li><p>åœ¨Pythonä¸­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚æ•´æ•°ã€å¸ƒå°”å€¼ï¼‰æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ„å‘³ç€å½“ä½ å°†ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯ä¼ é€’äº†å®ƒçš„å€¼çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯å®ƒæœ¬èº«ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªæ–¹æ³•å†…éƒ¨ä¿®æ”¹äº†ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œè¿™ä¸ªä¿®æ”¹ä¸ä¼šå½±å“åˆ°ä»»ä½•å…¶ä»–æ–¹æ³•ä¸­å¯¹è¯¥æˆå‘˜å˜é‡çš„å¼•ç”¨ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gateway snippet</title>
      <link href="/2023/11/05/gateway%20snippet/"/>
      <url>/2023/11/05/gateway%20snippet/</url>
      
        <content type="html"><![CDATA[<p><img src="https://www.baeldung.com/wp-content/uploads/2020/05/spring-cloud-gateway-webfilters-2.jpg"></p><h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><ul><li>LBï¼Œ â€œLoad Balancingâ€ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰çš„ç¼©å†™ã€‚è´Ÿè½½å‡è¡¡æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸è§çš„ç­–ç•¥ï¼Œç”¨äºå°†è¯·æ±‚å‡åŒ€åœ°åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹ä¸Šï¼Œä»¥é¿å…æŸä¸ªå®ä¾‹è´Ÿè½½è¿‡é‡ï¼Œæé«˜æ•´ä½“ç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯ç”¨æ€§ã€‚</li><li>restful headerä¸­çš„æ‰€æœ‰keyï¼Œå¯¹åº”çš„å€¼å…¶å®éƒ½æ˜¯é›†åˆï¼Œåªæ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹é›†åˆé‡Œé¢åªæœ‰ä¸€ä¸ªå…ƒç´ </li></ul><h3 id="spring-cloud-gateway"><a href="#spring-cloud-gateway" class="headerlink" title="spring cloud gateway"></a>spring cloud gateway</h3><ul><li><code>DefaultErrorWebExceptionHandler</code> æ˜¯ Spring Web çš„é»˜è®¤å®ç°ç±»ï¼Œå®ç°äº† <code>ErrorWebExceptionHandler</code> æ¥å£ã€‚å®ƒæä¾›äº†é»˜è®¤çš„é”™è¯¯å¤„ç†è¡Œä¸ºï¼Œå½“æ²¡æœ‰è‡ªå®šä¹‰çš„ <code>ErrorWebExceptionHandler</code> å®ç°æ—¶ï¼ŒSpring Boot å°†ä½¿ç”¨ <code>DefaultErrorWebExceptionHandler</code> æ¥å¤„ç†é”™è¯¯ã€‚</li><li><strong>åŸç”Ÿçš„spring cloud gatewayè¿›è¡Œè¯·æ±‚è½¬å‘ï¼Œæ‰€æœ‰çš„å¾®æœåŠ¡å®ä¾‹ä¸gatewayæœåŠ¡å®ä¾‹åœ¨nacosä¸­å¿…é¡»æ˜¯åŒä¸€ä¸ªnamesapceå’ŒåŒä¸€ä¸ªgroupã€‚</strong></li></ul><h1 id="é™æ€è·¯ç”±"><a href="#é™æ€è·¯ç”±" class="headerlink" title="é™æ€è·¯ç”±"></a>é™æ€è·¯ç”±</h1><ul><li>ä½¿ç”¨spring cloud gatewayé€šè¿‡ä»£ç æ–¹å¼æˆ–é…ç½®æ–‡ä»¶æ–¹å¼å®ç°</li></ul><h1 id="åŠ¨æ€è·¯ç”±"><a href="#åŠ¨æ€è·¯ç”±" class="headerlink" title="åŠ¨æ€è·¯ç”±"></a>åŠ¨æ€è·¯ç”±</h1><h2 id="spring-cloud-gateway-ä¸-nacosç»“åˆå®ç°"><a href="#spring-cloud-gateway-ä¸-nacosç»“åˆå®ç°" class="headerlink" title="spring cloud gateway ä¸ nacosç»“åˆå®ç°"></a>spring cloud gateway ä¸ nacosç»“åˆå®ç°</h2><blockquote><p>å®ç°æ€è·¯ï¼šä½¿ç”¨nacosçš„é…ç½®ä¸­å¿ƒï¼Œå°†è·¯ç”±é…ç½®æ”¾åœ¨nacosä¸Šï¼Œå†™ä¸ªç›‘å¬å™¨ç›‘å¬nacosä¸Šé…ç½®çš„å˜åŒ–ï¼Œå°†å˜åŒ–åçš„é…ç½®æ›´æ–°åˆ°GateWayåº”ç”¨çš„è¿›ç¨‹å†…ã€‚</p></blockquote><ul><li><p>åœºæ™¯ä¸€ï¼ˆåŸºç¡€ï¼‰</p><p>å¯ä»¥å…ˆåœ¨nacosçš„é…ç½®ç®¡ç†ä¸­ï¼Œæ·»åŠ å¾®æœåŠ¡çš„é…ç½®ä¿¡æ¯ï¼ˆç«¯å£ã€è·¯ç”±ç­‰ï¼‰ï¼Œç„¶åå¯åŠ¨å¾®æœåŠ¡ç¨‹åºï¼ˆä¸ç”¨é…ç½®ç›¸å…³ç«¯å£é…ç½®ï¼‰</p></li><li><p>åœºæ™¯äºŒï¼ˆpredicateï¼‰</p><p>å¯ä»¥æ§åˆ¶è¯·æ±‚çš„cookieã€headerã€hostã€methodã€pathã€queryã€RemoteAddrã€Weightï¼ˆæŒ‰ç…§æƒé‡å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒèŠ‚ç‚¹æœåŠ¡ï¼‰</p></li><li><p>åœºæ™¯ä¸‰ï¼ˆfiltersï¼‰</p><p>å¯ä»¥æ§åˆ¶è¯·æ±‚çš„AddRequestHeaderã€AddResponseHeaderã€DedupeResponseHeaderã€DedupeResponseHeaderã€CircuitBreakerï¼ˆæ–­è·¯å™¨ï¼‰ã€FallbackHeadersã€PrefixPathã€PreserveHostHeaderï¼ˆåŠ ä¸Šè¯·æ±‚è€…çš„ipä¿¡æ¯ï¼‰ã€RequestRateLimiterï¼ˆé™æµï¼‰ã€RedirectToã€RemoveRequestHeaderã€RemoveResponseHeaderã€RewritePathï¼ˆå°†è¯·æ±‚å‚æ•°ä¸­çš„è·¯å¾„åšå˜æ¢ï¼‰ã€RewriteLocationResponseHeaderã€RewriteResponseHeaderã€SecureHeadersã€SetPathã€SetRequestHeaderã€SetResponseHeaderã€SetStatusã€StripPrefixã€Retryã€RequestSizeã€SetRequestHostHeaderã€ModifyRequestBodyã€ModifyResponseBodyã€TokenRelayï¼ˆé…åˆé‰´æƒï¼‰</p></li><li><p>åœºæ™¯å››ï¼ˆé™æµï¼‰</p><ul><li>è¯·æ±‚åŒä¸€ç›®æ ‡åœ°å€</li></ul></li><li><p>åœºæ™¯äº”ï¼ˆä¿®æ”¹è¯·æ±‚å’Œå“åº”bodyï¼‰</p></li><li><p>åœºæ™¯å…­ï¼ˆåœ°å€åˆ†å‘ï¼‰</p><ul><li>æœ‰å¤šä¸ªåç«¯åº”ç”¨æœåŠ¡</li></ul></li></ul><hr><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ul><li><p>spring cloud gatewayä¸­å¦‚æœé…ç½®æ–‡ä»¶ä½¿ç”¨lbè®¿é—®æœåŠ¡ï¼Œé‚£éœ€è¦å¼•å…¥lbç›¸å…³ä¾èµ–åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="è·¨åŸŸè¯·æ±‚"><a href="#è·¨åŸŸè¯·æ±‚" class="headerlink" title="è·¨åŸŸè¯·æ±‚"></a>è·¨åŸŸè¯·æ±‚</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gateway:</span></span><br><span class="line">  <span class="comment"># è·¨åŸŸé…ç½®</span></span><br><span class="line">  <span class="attr">globalcors:</span></span><br><span class="line">    <span class="attr">corsConfigurations:</span></span><br><span class="line">      <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">        <span class="attr">allowedOrigins:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">        <span class="attr">allowedMethods:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">GET</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">POST</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">PUT</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">DELETE</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">OPTIONS</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">HEAD</span></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><p><a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/#configuring-route-predicate-factories-and-gateway-filter-factories">å®˜ç½‘</a></p></li><li><p><a href="https://blog.csdn.net/boling_cavalry/category_9278131.html">ç¨‹åºå‘˜æ¬£å®¸</a></p></li><li><p>å…¶å®ƒ</p><ul><li><a href="https://blog.csdn.net/abu935009066/article/details/112245330">https://blog.csdn.net/abu935009066/article/details/112245330</a></li></ul></li><li><p><a href="http://47.109.59.205/2023/01/02/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/#3-Gateway%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3">http://47.109.59.205/2023/01/02/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/#3-Gateway%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> gateway </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python poetry</title>
      <link href="/2023/11/03/python%20env%20poetry/"/>
      <url>/2023/11/03/python%20env%20poetry/</url>
      
        <content type="html"><![CDATA[<h2 id="POETRY"><a href="#POETRY" class="headerlink" title="POETRY"></a>POETRY</h2><blockquote><p>æ¯ä¸ªä½¿ç”¨ Poetry çš„é¡¹ç›®éƒ½ä¼šæœ‰è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸åŒé¡¹ç›®ä¹‹é—´çš„ä¾èµ–å†²çªã€‚å› æ­¤ï¼Œæ¯ä¸ªé¡¹ç›®çš„ä¾èµ–é¡¹éƒ½ä¼šç‹¬ç«‹å­˜æ”¾åœ¨å„è‡ªçš„è™šæ‹Ÿç¯å¢ƒä¸­ã€‚</p></blockquote><ul><li><p>æŸ¥çœ‹å®‰è£…ä¾èµ–ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry env info --path</span><br></pre></td></tr></table></figure></li><li><p>åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry env list</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æŒ‡å®šè™šæ‹Ÿç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry env remove &lt;è™šæ‹Ÿç¯å¢ƒåç§°&gt;</span><br></pre></td></tr></table></figure></li><li><p>è¿›å…¥ Poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry shell</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>é”å®šå¹¶å®‰è£…é¡¹ç›®ä¾èµ–é¡¹çš„ç¡®åˆ‡ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">poetry lock</span><br><span class="line">poetry install</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>å®‰è£…testç›¸å…³ä¾èµ–</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.poetry.group.test.dependencies]</span></span><br><span class="line"><span class="attr">pytest</span> = <span class="string">&quot;^7.3.0&quot;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry install --with test</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>é€šè¿‡<code>requirement</code>æ·»åŠ ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry add $( cat requirements.txt )</span><br></pre></td></tr></table></figure></li><li><p>buildç¼–è¯‘</p><p>å¦‚æœä½¿ç”¨<code>build backend</code>éé»˜è®¤çš„<code>poetry core</code>ï¼Œåˆ™ç›´æ¥ä½¿ç”¨å…¶ä»–ç¼–è¯‘å·¥å…·å‘½ä»¤æ‰§è¡Œç¼–è¯‘</p></li></ul><p>ä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨æµç¨‹å¦‚ä¸‹:</p><ol><li>åœ¨ä¸€ä¸ªæ–°é¡¹ç›®ä¸­,é¦–å…ˆæ‰§è¡Œ <code>poetry install</code> å®‰è£…ä¾èµ–å¹¶ç”Ÿæˆ <code>poetry.lock</code> æ–‡ä»¶ã€‚</li><li>åœ¨å¼€å‘è¿‡ç¨‹ä¸­,å¦‚æœéœ€è¦æ–°å¢æˆ–æ›´æ–°ä¾èµ–,å…ˆæ‰§è¡Œ <code>poetry add/remove ä¾èµ–å</code>ã€‚</li><li>ç„¶åæ‰§è¡Œ <code>poetry lock</code> æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ã€‚</li><li>å†æ‰§è¡Œ <code>poetry install</code> å®‰è£…æ–°çš„ä¾èµ–ã€‚</li><li>å¼€å‘æˆ–è¿è¡Œä»£ç æ—¶,æ‰§è¡Œ <code>poetry shell</code> è¿›å…¥è™šæ‹Ÿç¯å¢ƒã€‚</li><li>åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿›è¡Œå¼€å‘ã€æµ‹è¯•å’Œè¿è¡Œã€‚</li></ol><h2 id="HATCH"><a href="#HATCH" class="headerlink" title="HATCH"></a>HATCH</h2><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><ul><li><p>æ–°å»ºé¡¹ç›®</p><p><code>hatch new &quot;Hatch Demo&quot;</code></p></li><li><p>å·²æœ‰é¡¹ç›®åˆå§‹åŒ–</p><p><code>hatch new --init</code></p></li><li><p>è™šæ‹Ÿç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m venv venv</span><br><span class="line">source venv/bin/activate</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºhatchè™šæ‹Ÿç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hatch env create</span><br></pre></td></tr></table></figure></li><li><p>pycharmé…ç½®</p><p>è™šæ‹Ÿç¯å¢ƒéœ€é…ç½®æˆ <code>hatch shell</code>æç¤ºçš„ç›®å½•</p></li><li><p>æ›´æ–°ä¾èµ–</p><ul><li>è¿è¡Œ <code>hatch shell</code>å‘½ä»¤</li></ul></li><li><p>æŸ¥çœ‹ç¯å¢ƒä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hatch env show --ascii</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æŸ¥çœ‹å½“å‰é¡¹ç›®ç¯å¢ƒä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hatch env find</span><br></pre></td></tr></table></figure></li><li><p>é€€å‡ºå½“å‰ç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æ¸…ç†ç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hatch env prune &lt;envName&gt;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æ ¼å¼åŒ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hatch run lint:fmt</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><ul><li><p>æ–¹å¼ä¸€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --upgrade build</span><br><span class="line">python3 -m build</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€æ—¦å®Œæˆåº”è¯¥åœ¨ dist ç›®å½•ä¸‹äº§ç”Ÿä¸¤ä¸ªæ–‡ä»¶ï¼š</span></span><br></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hatch build</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä»£ç æ ¼å¼åŒ–"><a href="#ä»£ç æ ¼å¼åŒ–" class="headerlink" title="ä»£ç æ ¼å¼åŒ–"></a>ä»£ç æ ¼å¼åŒ–</h3><ul><li>é…ç½®</li></ul><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.hatch.envs.lint.scripts]</span></span><br><span class="line"><span class="attr">typing</span> = <span class="string">&quot;mypy --install-types --non-interactive &#123;args:src/jarvex_auth tests&#125;&quot;</span></span><br><span class="line"><span class="attr">style</span> = [</span><br><span class="line">  <span class="string">&quot;ruff &#123;args:.&#125;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;black --check --diff &#123;args:.&#125;&quot;</span>,</span><br><span class="line">]</span><br><span class="line"><span class="attr">fmt</span> = [</span><br><span class="line">  <span class="string">&quot;black &#123;args:.&#125;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;ruff --fix &#123;args:.&#125;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;style&quot;</span>,</span><br><span class="line">]</span><br><span class="line"><span class="attr">all</span> = [</span><br><span class="line">  <span class="string">&quot;style&quot;</span>,</span><br><span class="line">  <span class="string">&quot;typing&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œå‘½ä»¤<code>hatch run lint:fmt</code></li></ul><h2 id="Flit"><a href="#Flit" class="headerlink" title="Flit"></a>Flit</h2><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flit install</span><br></pre></td></tr></table></figure><hr><p><strong>Reference</strong></p><ul><li><p><a href="https://drivendata.co/blog/python-packaging-2023">THE BASICS OF PYTHON PACKAGING IN EARLY</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/666166082">https://zhuanlan.zhihu.com/p/666166082</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lib </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python learn</title>
      <link href="/2023/10/31/python%20learn/"/>
      <url>/2023/10/31/python%20learn/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/python/python%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1.png"></p><h1 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h1><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><h3 id="åˆ—è¡¨listå’Œå…ƒç»„tuple"><a href="#åˆ—è¡¨listå’Œå…ƒç»„tuple" class="headerlink" title="åˆ—è¡¨listå’Œå…ƒç»„tuple"></a>åˆ—è¡¨listå’Œå…ƒç»„tuple</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>] <span class="comment"># åˆ—è¡¨ä¸­åŒæ—¶å«æœ‰ int å’Œ string ç±»å‹çš„å…ƒç´ </span></span><br><span class="line">l</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>]</span><br><span class="line"> </span><br><span class="line">tup = (<span class="string">&#x27;jason&#x27;</span>, <span class="number">22</span>) <span class="comment"># å…ƒç»„ä¸­åŒæ—¶å«æœ‰ int å’Œ string ç±»å‹çš„å…ƒç´ </span></span><br><span class="line">tup</span><br><span class="line">(<span class="string">&#x27;jason&#x27;</span>, <span class="number">22</span>)</span><br></pre></td></tr></table></figure><ul><li>åˆ—è¡¨æ˜¯åŠ¨æ€çš„ï¼Œé•¿åº¦å¯å˜ï¼Œå¯ä»¥éšæ„çš„å¢åŠ ã€åˆ å‡æˆ–æ”¹å˜å…ƒç´ ã€‚åˆ—è¡¨çš„å­˜å‚¨ç©ºé—´ç•¥å¤§äºå…ƒç»„ï¼Œæ€§èƒ½ç•¥é€Šäºå…ƒç»„ã€‚</li><li>å…ƒç»„æ˜¯é™æ€çš„ï¼Œé•¿åº¦å¤§å°å›ºå®šï¼Œä¸å¯ä»¥å¯¹å…ƒç´ è¿›è¡Œå¢åŠ ã€åˆ å‡æˆ–è€…æ”¹å˜æ“ä½œã€‚å…ƒç»„ç›¸å¯¹äºåˆ—è¡¨æ›´åŠ è½»é‡çº§ï¼Œæ€§èƒ½ç¨ä¼˜ã€‚</li><li>setæ˜¯ç©ºçš„æ—¶å€™ï¼Œè¿›è¡Œå’Œå…¶ä»–éç©ºsetå–äº¤é›†ï¼Œæ°¸è¿œæ˜¯ç©º</li></ul><h3 id="å­—å…¸å’Œé›†åˆ"><a href="#å­—å…¸å’Œé›†åˆ" class="headerlink" title="å­—å…¸å’Œé›†åˆ"></a>å­—å…¸å’Œé›†åˆ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">d1 = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">20</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span>&#125;</span><br><span class="line">d2 = <span class="built_in">dict</span>(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">20</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span>&#125;)</span><br><span class="line">d3 = <span class="built_in">dict</span>([(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;jason&#x27;</span>), (<span class="string">&#x27;age&#x27;</span>, <span class="number">20</span>), (<span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;male&#x27;</span>)])</span><br><span class="line">d4 = <span class="built_in">dict</span>(name=<span class="string">&#x27;jason&#x27;</span>, age=<span class="number">20</span>, gender=<span class="string">&#x27;male&#x27;</span>) </span><br><span class="line">d1 == d2 == d3 ==d4</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">s1 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">s2 = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">s1 == s2</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><ul><li>å­—å…¸åœ¨ Python3.7+ æ˜¯æœ‰åºçš„æ•°æ®ç»“æ„ï¼Œè€Œé›†åˆæ˜¯æ— åºçš„ï¼Œå…¶å†…éƒ¨çš„å“ˆå¸Œè¡¨å­˜å‚¨ç»“æ„ï¼Œä¿è¯äº†å…¶æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œçš„é«˜æ•ˆæ€§ã€‚æ‰€ä»¥ï¼Œå­—å…¸å’Œé›†åˆé€šå¸¸è¿ç”¨åœ¨å¯¹å…ƒç´ çš„é«˜æ•ˆæŸ¥æ‰¾ã€å»é‡ç­‰åœºæ™¯ã€‚</li></ul><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">s2 = <span class="string">&quot;hello&quot;</span></span><br><span class="line">s3 = <span class="string">&quot;&quot;&quot;hello&quot;&quot;&quot;</span></span><br><span class="line">s1 == s2 == s3</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><ul><li>è½¬ä¹‰å­—ç¬¦</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;a\nb\tc&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">a</span><br><span class="line">bc</span><br><span class="line"></span><br><span class="line"><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure><ul><li><p>å¸¸ç”¨æ–¹æ³•</p><ul><li><p>å’Œå…¶ä»–æ•°æ®ç»“æ„ï¼Œå¦‚åˆ—è¡¨ã€å…ƒç»„ä¸€æ ·ï¼Œå­—ç¬¦ä¸²çš„ç´¢å¼•åŒæ ·ä» 0 å¼€å§‹ï¼Œindex=0 è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå­—ç¬¦ï¼‰ï¼Œ[index:index+2] åˆ™è¡¨ç¤ºç¬¬ index ä¸ªå…ƒç´ åˆ° index+1 ä¸ªå…ƒç´ ç»„æˆçš„å­å­—ç¬¦ä¸²ã€‚</p></li><li><p>å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰</p></li><li><p>å­—ç¬¦ä¸²æ ¼å¼åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;no data available for person with id: &#123;&#125;, name: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>, name)) <span class="string">&#x27;&#x27;&#x27;æœ€æ–°è§„èŒƒ&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;no data available for person with id: %s, name: %s&#x27;</span> % (<span class="built_in">id</span>, name))<span class="string">&#x27;&#x27;&#x27;ä»¥å¾€è§„èŒƒï¼Œ%s è¡¨ç¤ºå­—ç¬¦ä¸²å‹ï¼Œ%d è¡¨ç¤ºæ•´å‹&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><ul><li>json.dumps() è¿™ä¸ªå‡½æ•°ï¼Œæ¥å— åŸºæœ¬æ•°æ®ç±»å‹ï¼Œç„¶åå°†å…¶åºåˆ—åŒ–ä¸º string</li><li>json.loads() è¿™ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªåˆæ³•å­—ç¬¦ä¸²ï¼Œç„¶åå°†å…¶ååºåˆ—åŒ–ä¸ºåŸºæœ¬æ•°æ®ç±»å‹</li></ul><h2 id="æ¡ä»¶ä¸å¾ªç¯"><a href="#æ¡ä»¶ä¸å¾ªç¯" class="headerlink" title="æ¡ä»¶ä¸å¾ªç¯"></a>æ¡ä»¶ä¸å¾ªç¯</h2><h3 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># y = |x|</span></span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">    y = -x</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    y = x</span><br><span class="line"><span class="comment"># åœºæ™¯äºŒ</span></span><br><span class="line"><span class="keyword">if</span> condition_1:</span><br><span class="line">    statement_1</span><br><span class="line"><span class="keyword">elif</span> condition_2:</span><br><span class="line">    statement_2</span><br><span class="line">...</span><br><span class="line"><span class="keyword">elif</span> condition_i:</span><br><span class="line">    statement_i</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    statement_n</span><br></pre></td></tr></table></figure><h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—è¡¨</span></span><br><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> l:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="comment"># å­—å…¸</span></span><br><span class="line">d = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;dob&#x27;</span>: <span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> d: <span class="comment"># éå†å­—å…¸çš„é”®</span></span><br><span class="line">    <span class="built_in">print</span>(k)</span><br><span class="line">name</span><br><span class="line">dob</span><br><span class="line">gender</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> d.values(): <span class="comment"># éå†å­—å…¸çš„å€¼</span></span><br><span class="line">    <span class="built_in">print</span>(v)</span><br><span class="line">jason</span><br><span class="line"><span class="number">2000</span>-01-01</span><br><span class="line">male    </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> d.items(): <span class="comment"># éå†å­—å…¸çš„é”®å€¼å¯¹</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;key: &#123;&#125;, value: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(k, v))</span><br><span class="line">key: name, value: jason</span><br><span class="line">key: dob, value: <span class="number">2000</span>-01-01</span><br><span class="line">key: gender, value: male </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        text = <span class="built_in">input</span>(<span class="string">&#x27;Please enter your questions, enter &quot;q&quot; to exit&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> text == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Exit system&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">        <span class="built_in">print</span>(response)</span><br><span class="line">    <span class="keyword">except</span> <span class="keyword">as</span> err:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Encountered error: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(err))</span><br><span class="line">        <span class="keyword">break</span> </span><br></pre></td></tr></table></figure><h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><ul><li>å½“ç¨‹åºä¸­å­˜åœ¨å¤šä¸ª except block æ—¶ï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ª except block ä¼šè¢«æ‰§è¡Œã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå¤šä¸ª except å£°æ˜çš„å¼‚å¸¸ç±»å‹éƒ½ä¸å®é™…ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆåªæœ‰æœ€å‰é¢çš„ except block ä¼šè¢«æ‰§è¡Œï¼Œå…¶ä»–åˆ™è¢«å¿½ç•¥ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    s = <span class="built_in">input</span>(<span class="string">&#x27;please enter two numbers separated by comma: &#x27;</span>)</span><br><span class="line">    num1 = <span class="built_in">int</span>(s.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>].strip())</span><br><span class="line">    num2 = <span class="built_in">int</span>(s.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>].strip())</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> err:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Value Error: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(err))</span><br><span class="line"><span class="keyword">except</span> IndexError <span class="keyword">as</span> err:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Index Error: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(err))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Other error&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;continue&#x27;</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>æ— è®ºå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œfinally block ä¸­çš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œï¼Œå“ªæ€•å‰é¢çš„ try å’Œ excep block ä¸­ä½¿ç”¨äº† return è¯­å¥ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    .... <span class="comment"># some data processing</span></span><br><span class="line"><span class="keyword">except</span> OSError <span class="keyword">as</span> err:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;OS error: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(err))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Unexpected error:&#x27;</span>, sys.exc_info()[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure><ul><li>è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå®šä¹‰å¹¶å®ç°äº†åˆå§‹åŒ–å‡½æ•°å’Œ str å‡½æ•°ï¼ˆç›´æ¥ print æ—¶è°ƒç”¨ï¼‰ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInputError</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Exception raised when there&#x27;re errors in input&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span> <span class="comment"># è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹çš„åˆå§‹åŒ–</span></span><br><span class="line">        self.value = value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span> <span class="comment"># è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹çš„ string è¡¨è¾¾å½¢å¼</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;&#123;&#125; is invalid input&quot;</span>.<span class="built_in">format</span>(<span class="built_in">repr</span>(self.value)))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> MyInputError(<span class="number">1</span>) <span class="comment"># æŠ›å‡º MyInputError è¿™ä¸ªå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">except</span> MyInputError <span class="keyword">as</span> err:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;error: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(err))</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">param1, param2, ..., paramN</span>):</span></span><br><span class="line">    statements</span><br><span class="line">    <span class="keyword">return</span>/<span class="keyword">yield</span> value <span class="comment"># optional</span></span><br></pre></td></tr></table></figure><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><ul><li><p>ä¸ºäº†èƒ½è®©ä¸€ä¸ªå‡½æ•°æ¥å—ä»»æ„æ•°é‡çš„ä½ç½®å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª*å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">avg</span>(<span class="params">first, *rest</span>):</span></span><br><span class="line">    ...</span><br><span class="line"><span class="comment"># Sample use</span></span><br><span class="line">avg(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure></li><li><p>ä¸ºäº†æ¥å—ä»»æ„æ•°é‡çš„å…³é”®å­—å‚æ•°ï¼Œä½¿ç”¨ä¸€ä¸ªä»¥**å¼€å¤´çš„å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_element</span>(<span class="params">name, value, **attrs</span>):</span></span><br><span class="line">  ...</span><br><span class="line">make_element(<span class="string">&#x27;item&#x27;</span>, <span class="string">&#x27;Albatross&#x27;</span>, size=<span class="string">&#x27;large&#x27;</span>, quantity=<span class="number">6</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">anyargs</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(args) <span class="comment"># A tuple</span></span><br><span class="line">    <span class="built_in">print</span>(kwargs) <span class="comment"># A dict</span></span><br></pre></td></tr></table></figure></li><li><p>å‚æ•°é»˜è®¤å€¼ä¸è¦è®¾ç½® []ï¼Œè€Œæ˜¯å†™æˆ None</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">spam</span>(<span class="params">a, b=[]</span>):</span> <span class="comment"># NO! ï¼Œåé¢å¦‚æœå¤šæ¬¡è°ƒç”¨spamæ–¹æ³•ï¼Œåˆ™bçš„å€¼ä¼šä¸€ç›´ä¼ é€’ä½¿ç”¨</span></span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line"><span class="comment">### å‡½æ•°åµŒå¥—</span></span><br><span class="line"></span><br><span class="line">- å‡½æ•°çš„åµŒå¥—èƒ½å¤Ÿä¿è¯å†…éƒ¨å‡½æ•°çš„éšç§ã€‚</span><br><span class="line">- åˆç†çš„ä½¿ç”¨å‡½æ•°åµŒå¥—ï¼Œèƒ½å¤Ÿæé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>():</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;world&#x27;</span>)</span><br><span class="line">    f2()</span><br><span class="line">f1()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">hello</span><br><span class="line">world</span><br></pre></td></tr></table></figure></li></ul><h3 id="å‡½æ•°å˜é‡"><a href="#å‡½æ•°å˜é‡" class="headerlink" title="å‡½æ•°å˜é‡"></a>å‡½æ•°å˜é‡</h3><ul><li><p>å±€éƒ¨å˜é‡ï¼šåªåœ¨å‡½æ•°å†…éƒ¨æœ‰æ•ˆã€‚ä¸€æ—¦å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå±€éƒ¨å˜é‡å°±ä¼šè¢«å›æ”¶</p></li><li><p>å…¨å±€å˜é‡ï¼šä¸èƒ½åœ¨å‡½æ•°å†…éƒ¨éšæ„æ”¹å˜å…¨å±€å˜é‡çš„å€¼ï¼Œå¦‚æœæˆ‘ä»¬ä¸€å®šè¦åœ¨å‡½æ•°å†…éƒ¨æ”¹å˜å…¨å±€å˜é‡çš„å€¼ï¼Œå°±å¿…é¡»åŠ ä¸Š global è¿™ä¸ªå£°æ˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MIN_VALUE = <span class="number">1</span></span><br><span class="line">MAX_VALUE = <span class="number">10</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validation_check</span>(<span class="params">value</span>):</span></span><br><span class="line">    <span class="keyword">global</span> MIN_VALUE</span><br><span class="line">    ...</span><br><span class="line">    MIN_VALUE += <span class="number">1</span></span><br><span class="line">    ...</span><br><span class="line">validation_check(<span class="number">5</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nth_power</span>(<span class="params">exponent</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exponent_of</span>(<span class="params">base</span>):</span></span><br><span class="line">        <span class="keyword">return</span> base ** exponent</span><br><span class="line">    <span class="keyword">return</span> exponent_of <span class="comment"># è¿”å›å€¼æ˜¯ exponent_of å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line">square = nth_power(<span class="number">2</span>) <span class="comment"># è®¡ç®—ä¸€ä¸ªæ•°çš„å¹³æ–¹</span></span><br><span class="line">cube = nth_power(<span class="number">3</span>) <span class="comment"># è®¡ç®—ä¸€ä¸ªæ•°çš„ç«‹æ–¹ </span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(square(<span class="number">2</span>))  <span class="comment"># è®¡ç®— 2 çš„å¹³æ–¹</span></span><br><span class="line"><span class="built_in">print</span>(cube(<span class="number">2</span>)) <span class="comment"># è®¡ç®— 2 çš„ç«‹æ–¹</span></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="number">4</span> <span class="comment"># 2^2</span></span><br><span class="line"><span class="number">8</span> <span class="comment"># 2^3</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span>():</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">increment</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> count</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> increment</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨</span></span><br><span class="line">c1 = counter()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨è®¡æ•°å™¨çš„ increment å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨ä¼šä½¿è®¡æ•°å™¨å€¼å¢åŠ </span></span><br><span class="line"><span class="built_in">print</span>(c1())  <span class="comment"># è¾“å‡º: 1</span></span><br><span class="line"><span class="built_in">print</span>(c1())  <span class="comment"># è¾“å‡º: 2</span></span><br><span class="line"><span class="built_in">print</span>(c1())  <span class="comment"># è¾“å‡º: 3</span></span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºé—­åŒ…çš„å­˜åœ¨ï¼Œ<code>count</code> å˜é‡çš„çŠ¶æ€ä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨ <code>counter</code> å‡½æ•°éƒ½ä¼šé‡æ–°åˆå§‹åŒ–ï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªæŒä¹…çš„è®¡æ•°å™¨åŠŸèƒ½ã€‚</p></blockquote><ul><li><p>é—­åŒ…çš„å…³é”®ç‰¹ç‚¹æ˜¯:ä¸€ä¸ªå†…éƒ¨å‡½æ•°è¢«å¤–éƒ¨å‡½æ•°è¿”å›,å†…éƒ¨å‡½æ•°åœ¨æ‰§è¡Œæ—¶è®°ä½äº†å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚å®ƒåƒä¸€ä¸ªâ€å°ç›’å­â€,å°é—­å¹¶è®°ä½äº†å¤–éƒ¨å˜é‡,å³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</p></li><li><p>é—­åŒ…çš„å¥½å¤„åœ¨äºå®ƒå¯ä»¥å°†æ•°æ®å’ŒåŠŸèƒ½æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒï¼Œå¯ä»¥åœ¨ä¸åŒçš„åœ°æ–¹é‡å¤ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ä¿æŒæ•°æ®çš„çŠ¶æ€ã€‚è¿™ç§æœºåˆ¶ä½¿å¾—é—­åŒ…åœ¨å®ç°çŠ¶æ€ä¿æŒã€å›è°ƒå‡½æ•°ã€è£…é¥°å™¨ç­‰æ–¹é¢éå¸¸æœ‰ç”¨ã€‚</p></li><li><p>è¿™ç§ç‰¹æ€§åœ¨å®é™…ç¼–ç¨‹ä¸­å¾ˆæœ‰ç”¨,æ¯”å¦‚å®ç°ç§æœ‰å˜é‡ã€ç¼“å­˜ç­‰ã€‚å½“ç„¶,è¿‡åº¦ä½¿ç”¨ä¹Ÿä¼šå½±å“ä»£ç å¯è¯»æ€§ã€‚æ€»ä¹‹,ç†è§£äº†é—­åŒ…çš„å·¥ä½œåŸç†,å°±èƒ½æ›´å¥½åœ°æŒæ¡è¿™ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚</p></li></ul><h3 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h3><ul><li><strong>lambda æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼ˆexpressionï¼‰ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªè¯­å¥ï¼ˆstatementï¼‰</strong></li><li><strong>lambda çš„ä¸»ä½“æ˜¯åªæœ‰ä¸€è¡Œçš„ç®€å•è¡¨è¾¾å¼ï¼Œå¹¶ä¸èƒ½æ‰©å±•æˆä¸€ä¸ªå¤šè¡Œçš„ä»£ç å—</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">square = <span class="keyword">lambda</span> x: x**<span class="number">2</span></span><br><span class="line">square(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰åŒäº</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x**<span class="number">2</span></span><br><span class="line">square(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å¼ç¼–ç¨‹"><a href="#å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹"></a>å‡½æ•°å¼ç¼–ç¨‹</h3><ul><li><p>æ‰€è°“å‡½æ•°å¼ç¼–ç¨‹ï¼Œæ˜¯æŒ‡ä»£ç ä¸­æ¯ä¸€å—éƒ½æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Œéƒ½ç”±çº¯å‡½æ•°ï¼ˆpure functionï¼‰çš„å½¢å¼ç»„æˆã€‚è¿™é‡Œçš„çº¯å‡½æ•°ï¼Œæ˜¯æŒ‡å‡½æ•°æœ¬èº«ç›¸äº’ç‹¬ç«‹ã€äº’ä¸å½±å“ï¼Œå¯¹äºç›¸åŒçš„è¾“å…¥ï¼Œæ€»ä¼šæœ‰ç›¸åŒçš„è¾“å‡ºï¼Œæ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨</p></li><li><p>ä¸»è¦æä¾›äº†è¿™ä¹ˆå‡ ä¸ªå‡½æ•°ï¼šmap()ã€filter() å’Œ reduce()ï¼Œé€šå¸¸ç»“åˆåŒ¿åå‡½æ•° lambda ä¸€èµ·ä½¿ç”¨</p></li></ul><h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><blockquote><p><strong>ç±»ï¼Œä¸€ç¾¤æœ‰ç€ç›¸åŒå±æ€§å’Œå‡½æ•°çš„å¯¹è±¡çš„é›†åˆã€‚</strong></p><p>OOPæ€æƒ³å››è¦ç´ ï¼š ç±» å¯¹è±¡ å±æ€§ å‡½æ•°</p></blockquote><ul><li><p>ç±»å‡½æ•°</p></li><li><p>æˆå‘˜å‡½æ•°</p></li><li><p>é™æ€å‡½æ•°</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Document</span>():</span></span><br><span class="line">    </span><br><span class="line">    WELCOME_STR = <span class="string">&#x27;Welcome! The context for this book is &#123;&#125;.&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, title, author, context</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;init function called&#x27;</span>)</span><br><span class="line">        self.title = title</span><br><span class="line">        self.author = author</span><br><span class="line">        self.__context = context</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç±»å‡½æ•°</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_empty_book</span>(<span class="params">cls, title, author</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cls(title=title, author=author, context=<span class="string">&#x27;nothing&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_context_length</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.__context)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é™æ€å‡½æ•°</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_welcome</span>(<span class="params">context</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Document.WELCOME_STR.<span class="built_in">format</span>(context)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">empty_book = Document.create_empty_book(<span class="string">&#x27;What Every Man Thinks About Apart from Sex&#x27;</span>, <span class="string">&#x27;Professor Sheridan Simove&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(empty_book.get_context_length())</span><br><span class="line"><span class="built_in">print</span>(empty_book.get_welcome(<span class="string">&#x27;indeed nothing&#x27;</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment">########## è¾“å‡º ##########</span></span><br><span class="line"> </span><br><span class="line">init function called</span><br><span class="line"><span class="number">7</span></span><br><span class="line">Welcome! The context <span class="keyword">for</span> this book <span class="keyword">is</span> indeed nothing.</span><br></pre></td></tr></table></figure><h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><ul><li>æ¯ä¸ªç±»éƒ½æœ‰æ„é€ å‡½æ•°ï¼Œç»§æ‰¿ç±»åœ¨ç”Ÿæˆå¯¹è±¡çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°çš„ï¼Œå› æ­¤ä½ å¿…é¡»åœ¨ <strong>init</strong>() å‡½æ•°ä¸­æ˜¾å¼è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚å®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ å­ç±»çš„æ„é€ å‡½æ•° -&gt; çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚</li></ul><h3 id="æŠ½è±¡å‡½æ•°-æŠ½è±¡ç±»"><a href="#æŠ½è±¡å‡½æ•°-æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡å‡½æ•°/æŠ½è±¡ç±»"></a>æŠ½è±¡å‡½æ•°/æŠ½è±¡ç±»</h3><ul><li><p>æŠ½è±¡ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå®ƒç”Ÿä¸‹æ¥å°±æ˜¯ä½œä¸ºçˆ¶ç±»å­˜åœ¨çš„ï¼Œä¸€æ—¦å¯¹è±¡åŒ–å°±ä¼šæŠ¥é”™ã€‚åŒæ ·ï¼ŒæŠ½è±¡å‡½æ•°å®šä¹‰åœ¨æŠ½è±¡ç±»ä¹‹ä¸­ï¼Œå­ç±»å¿…é¡»é‡å†™è¯¥å‡½æ•°æ‰èƒ½ä½¿ç”¨ã€‚ç›¸åº”çš„æŠ½è±¡å‡½æ•°ï¼Œåˆ™æ˜¯ä½¿ç”¨è£…é¥°å™¨ @abstractmethod æ¥è¡¨ç¤ºã€‚</p></li><li><p>æŠ½è±¡ç±»å°±æ˜¯è¿™ä¹ˆä¸€ç§å­˜åœ¨ï¼Œå®ƒæ˜¯ä¸€ç§è‡ªä¸Šè€Œä¸‹çš„è®¾è®¡é£èŒƒï¼Œä½ åªéœ€è¦ç”¨å°‘é‡çš„ä»£ç æè¿°æ¸…æ¥šè¦åšçš„äº‹æƒ…ï¼Œå®šä¹‰å¥½æ¥å£ï¼Œç„¶åå°±å¯ä»¥äº¤ç»™ä¸åŒå¼€å‘äººå‘˜å»å¼€å‘å’Œå¯¹æ¥ã€‚</p></li></ul><h3 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a>è£…é¥°å™¨</h3><blockquote><p><strong>æ‰€è°“çš„è£…é¥°å™¨ï¼Œå…¶å®å°±æ˜¯é€šè¿‡è£…é¥°å™¨å‡½æ•°ï¼Œæ¥ä¿®æ”¹åŸå‡½æ•°çš„ä¸€äº›åŠŸèƒ½ï¼Œä½¿å¾—åŸå‡½æ•°ä¸éœ€è¦ä¿®æ”¹ã€‚</strong></p><p>Decorators is to modify the behavior of the function through a wrapper so we donâ€™t have to actually modify the function.</p></blockquote><h4 id="å‡½æ•°è£…é¥°å™¨"><a href="#å‡½æ•°è£…é¥°å™¨" class="headerlink" title="å‡½æ•°è£…é¥°å™¨"></a>å‡½æ•°è£…é¥°å™¨</h4><ul><li><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠ<code>*args</code>å’Œ<code>**kwargs</code>ï¼Œä½œä¸ºè£…é¥°å™¨å†…éƒ¨å‡½æ•° wrapper() çš„å‚æ•°ã€‚<code>*args</code>å’Œ<code>**kwargs</code>ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„æ•°é‡å’Œç±»å‹çš„å‚æ•°ï¼Œå› æ­¤è£…é¥°å™¨å°±å¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">my_decorator</span>(<span class="params">func</span>):</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;wrapper of decorator&#x27;</span>)</span><br><span class="line">          func(*args, **kwargs)</span><br><span class="line">      <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">- è£…é¥°å™¨å¯ä»¥æ¥å—åŸå‡½æ•°ä»»æ„ç±»å‹å’Œæ•°é‡çš„å‚æ•°ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å¯ä»¥æ¥å—è‡ªå·±å®šä¹‰çš„å‚æ•°ã€‚</span><br><span class="line"></span><br><span class="line">  ```python</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">repeat</span>(<span class="params">num</span>):</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">my_decorator</span>(<span class="params">func</span>):</span></span><br><span class="line">          <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">              <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">&#x27;wrapper of decorator&#x27;</span>)</span><br><span class="line">                  func(*args, **kwargs)</span><br><span class="line">          <span class="keyword">return</span> wrapper</span><br><span class="line">      <span class="keyword">return</span> my_decorator</span><br><span class="line">   </span><br><span class="line"><span class="meta">  @repeat(<span class="params"><span class="number">4</span></span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">greet</span>(<span class="params">message</span>):</span></span><br><span class="line">      <span class="built_in">print</span>(message)</span><br><span class="line">   </span><br><span class="line">  greet(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">   </span><br><span class="line">  <span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">  wrapper of decorator</span><br><span class="line">  hello world</span><br><span class="line">  wrapper of decorator</span><br><span class="line">  hello world</span><br><span class="line">  wrapper of decorator</span><br><span class="line">  hello world</span><br><span class="line">  wrapper of decorator</span><br><span class="line">  hello world</span><br></pre></td></tr></table></figure></li></ul><h4 id="ç±»è£…é¥°å™¨"><a href="#ç±»è£…é¥°å™¨" class="headerlink" title="ç±»è£…é¥°å™¨"></a>ç±»è£…é¥°å™¨</h4><ul><li><p>ç±»è£…é¥°å™¨ä¸»è¦ä¾èµ–äºå‡½æ•°<code>__call_()</code>ï¼Œæ¯å½“ä½ è°ƒç”¨ä¸€ä¸ªç±»çš„ç¤ºä¾‹æ—¶ï¼Œå‡½æ•°<code>__call__()</code>å°±ä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, func</span>):</span></span><br><span class="line">        self.func = func</span><br><span class="line">        self.num_calls = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        self.num_calls += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;num of calls is: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(self.num_calls))</span><br><span class="line">        <span class="keyword">return</span> self.func(*args, **kwargs)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Count</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line"> </span><br><span class="line">example()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">num of calls <span class="keyword">is</span>: <span class="number">1</span></span><br><span class="line">hello world</span><br><span class="line"> </span><br><span class="line">example()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">num of calls <span class="keyword">is</span>: <span class="number">2</span></span><br><span class="line">hello world</span><br></pre></td></tr></table></figure></li></ul><h4 id="è£…é¥°å™¨çš„åµŒå¥—"><a href="#è£…é¥°å™¨çš„åµŒå¥—" class="headerlink" title="è£…é¥°å™¨çš„åµŒå¥—"></a>è£…é¥°å™¨çš„åµŒå¥—</h4><ul><li><p>æ‰§è¡Œé¡ºåºä»é‡Œåˆ°å¤–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@decorator1</span></span><br><span class="line"><span class="meta">@decorator2</span></span><br><span class="line"><span class="meta">@decorator3</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    ...</span><br><span class="line"><span class="comment"># ç­‰åŒäº</span></span><br><span class="line">decorator1(decorator2(decorator3(func)))</span><br></pre></td></tr></table></figure></li></ul><h3 id="metaclass"><a href="#metaclass" class="headerlink" title="metaclass"></a>metaclass</h3><h2 id="åç¨‹ï¼ˆAsyncioï¼‰"><a href="#åç¨‹ï¼ˆAsyncioï¼‰" class="headerlink" title="åç¨‹ï¼ˆAsyncioï¼‰"></a>åç¨‹ï¼ˆAsyncioï¼‰</h2><h3 id="å•çº¿ç¨‹-å¼‚æ­¥I-O"><a href="#å•çº¿ç¨‹-å¼‚æ­¥I-O" class="headerlink" title="å•çº¿ç¨‹+å¼‚æ­¥I/O"></a>å•çº¿ç¨‹+å¼‚æ­¥I/O</h3><blockquote><p>ä»£æ“ä½œç³»ç»Ÿå¯¹I/Oæ“ä½œçš„æ”¹è¿›ä¸­æœ€ä¸ºé‡è¦çš„å°±æ˜¯æ”¯æŒå¼‚æ­¥I/Oï¼Œåœ¨Pythonè¯­è¨€ä¸­ï¼Œå•çº¿ç¨‹+å¼‚æ­¥I/Oçš„ç¼–ç¨‹æ¨¡å‹ç§°ä¸ºåç¨‹ã€‚</p><p>æœ‰äº†åç¨‹çš„æ”¯æŒï¼Œå°±å¯ä»¥åŸºäºäº‹ä»¶é©±åŠ¨ç¼–å†™é«˜æ•ˆçš„å¤šä»»åŠ¡ç¨‹åºã€‚åç¨‹æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯æé«˜çš„æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºå­ç¨‹åºåˆ‡æ¢ä¸æ˜¯çº¿ç¨‹åˆ‡æ¢ï¼Œè€Œæ˜¯ç”±ç¨‹åºè‡ªèº«æ§åˆ¶ï¼Œå› æ­¤ï¼Œæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚åç¨‹çš„ç¬¬äºŒä¸ªä¼˜åŠ¿å°±æ˜¯ä¸éœ€è¦å¤šçº¿ç¨‹çš„é”æœºåˆ¶ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸å­˜åœ¨åŒæ—¶å†™å˜é‡å†²çªï¼Œåœ¨åç¨‹ä¸­æ§åˆ¶å…±äº«èµ„æºä¸ç”¨åŠ é”ï¼Œåªéœ€è¦åˆ¤æ–­çŠ¶æ€å°±å¥½äº†ï¼Œæ‰€ä»¥æ‰§è¡Œæ•ˆç‡æ¯”å¤šçº¿ç¨‹é«˜å¾ˆå¤šã€‚</p></blockquote><p>å¦‚æœæƒ³è¦å……åˆ†åˆ©ç”¨CPUçš„å¤šæ ¸ç‰¹æ€§ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å¤šè¿›ç¨‹+åç¨‹ï¼Œæ—¢å……åˆ†åˆ©ç”¨å¤šæ ¸ï¼Œåˆå……åˆ†å‘æŒ¥åç¨‹çš„é«˜æ•ˆç‡ï¼Œå¯è·å¾—æé«˜çš„æ€§èƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">crawl_page</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;crawling &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(url))</span><br><span class="line">    sleep_time = <span class="built_in">int</span>(url.split(<span class="string">&#x27;_&#x27;</span>)[-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(sleep_time)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;OK &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(url))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">urls</span>):</span></span><br><span class="line">    tasks = [asyncio.create_task(crawl_page(url)) <span class="keyword">for</span> url <span class="keyword">in</span> urls]</span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> tasks:</span><br><span class="line">        <span class="keyword">await</span> task</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    taskéå†çš„å¦ä¸€ç§å†™æ³•</span></span><br><span class="line"><span class="string">    await asyncio.gather(*tasks)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">%time asyncio.run(main([<span class="string">&#x27;url_1&#x27;</span>, <span class="string">&#x27;url_2&#x27;</span>, <span class="string">&#x27;url_3&#x27;</span>, <span class="string">&#x27;url_4&#x27;</span>]))</span><br><span class="line"> </span><br><span class="line"><span class="comment">########## è¾“å‡º ##########</span></span><br><span class="line"> </span><br><span class="line">crawling url_1</span><br><span class="line">crawling url_2</span><br><span class="line">crawling url_3</span><br><span class="line">crawling url_4</span><br><span class="line">OK url_1</span><br><span class="line">OK url_2</span><br><span class="line">OK url_3</span><br><span class="line">OK url_4</span><br><span class="line">Wall time: <span class="number">3.99</span> s</span><br></pre></td></tr></table></figure><ul><li>åç¨‹å’Œå¤šçº¿ç¨‹çš„åŒºåˆ«ï¼Œä¸»è¦åœ¨äºä¸¤ç‚¹ï¼Œä¸€æ˜¯åç¨‹ä¸ºå•çº¿ç¨‹ï¼›äºŒæ˜¯åç¨‹ç”±ç”¨æˆ·å†³å®šï¼Œåœ¨å“ªäº›åœ°æ–¹äº¤å‡ºæ§åˆ¶æƒï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</li><li>åç¨‹çš„å†™æ³•æ›´åŠ ç®€æ´æ¸…æ™°ï¼ŒæŠŠ async / await è¯­æ³•å’Œ create_task ç»“åˆæ¥ç”¨ï¼Œå¯¹äºä¸­å°çº§åˆ«çš„å¹¶å‘éœ€æ±‚å·²ç»æ¯«æ— å‹åŠ›ã€‚</li><li>å†™åç¨‹ç¨‹åºçš„æ—¶å€™ï¼Œä½ çš„è„‘æµ·ä¸­è¦æœ‰æ¸…æ™°çš„äº‹ä»¶å¾ªç¯æ¦‚å¿µï¼ŒçŸ¥é“ç¨‹åºåœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦æš‚åœã€ç­‰å¾… I/Oï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦ä¸€å¹¶æ‰§è¡Œåˆ°åº•ã€‚</li></ul><h3 id="æ•°æ®éš”ç¦»"><a href="#æ•°æ®éš”ç¦»" class="headerlink" title="æ•°æ®éš”ç¦»"></a>æ•°æ®éš”ç¦»</h3><ul><li>åœ¨åç¨‹ä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨å±€éƒ¨å˜é‡æˆ–åç¨‹ä¸Šä¸‹æ–‡æ¥å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªåç¨‹æ‹¥æœ‰è‡ªå·±çš„æ•°æ®ç©ºé—´ï¼Œä¸ä¼šå—åˆ°å…¶ä»–åç¨‹çš„å½±å“ã€‚åç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡å‚æ•°ä¼ é€’æˆ–å…¨å±€å˜é‡ç­‰æ–¹å¼æ¥è¿›è¡Œæ•°æ®äº¤äº’ï¼Œä½†æ˜¯æ•°æ®çš„ä¿®æ”¹åªä¼šå½±å“å½“å‰åç¨‹çš„æ•°æ®ç©ºé—´ï¼Œä¸ä¼šå½±å“å…¶ä»–åç¨‹çš„æ•°æ®ã€‚</li></ul><h2 id="concurrency"><a href="#concurrency" class="headerlink" title="concurrency"></a>concurrency</h2><blockquote><p>å¹¶å‘é€šå¸¸ç”¨äº I/O æ“ä½œé¢‘ç¹çš„åœºæ™¯ï¼Œè€Œå¹¶è¡Œåˆ™é€‚ç”¨äº CPU heavy çš„åœºæ™¯ã€‚</p></blockquote><h3 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h3><blockquote><p> åœ¨ Python ä¸­ï¼Œå¹¶å‘å¹¶ä¸æ˜¯æŒ‡åŒä¸€æ—¶åˆ»æœ‰å¤šä¸ªæ“ä½œï¼ˆthreadã€taskï¼‰åŒæ—¶è¿›è¡Œã€‚ç›¸åï¼ŒæŸä¸ªç‰¹å®šçš„æ—¶åˆ»ï¼Œå®ƒåªå…è®¸æœ‰ä¸€ä¸ªæ“ä½œå‘ç”Ÿï¼Œåªä¸è¿‡çº¿ç¨‹ / ä»»åŠ¡ä¹‹é—´ä¼šäº’ç›¸åˆ‡æ¢ï¼Œç›´åˆ°å®Œæˆ</p></blockquote><p><img src="/images/python/concurrency.png" alt="concurrency"></p><blockquote><p>å›¾ä¸­å‡ºç°äº† thread å’Œ task ä¸¤ç§åˆ‡æ¢é¡ºåºçš„ä¸åŒæ–¹å¼ï¼Œåˆ†åˆ«å¯¹åº” Python ä¸­å¹¶å‘çš„ä¸¤ç§å½¢å¼â€”â€”threading å’Œ asyncioã€‚</p></blockquote><p><strong>futureså®ç°å¹¶å‘</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_all</span>(<span class="params">sites</span>):</span></span><br><span class="line">    <span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=<span class="number">5</span>) <span class="keyword">as</span> executor:</span><br><span class="line">        executor.<span class="built_in">map</span>(download_one, sites)</span><br></pre></td></tr></table></figure><blockquote><p>è™½ç„¶çº¿ç¨‹çš„æ•°é‡å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œä½†æ˜¯çº¿ç¨‹æ•°å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå› ä¸ºçº¿ç¨‹çš„åˆ›å»ºã€ç»´æŠ¤å’Œåˆ é™¤ä¹Ÿä¼šæœ‰ä¸€å®šçš„å¼€é”€ã€‚æ‰€ä»¥å¦‚æœä½ è®¾ç½®çš„å¾ˆå¤§ï¼Œåè€Œå¯èƒ½ä¼šå¯¼è‡´é€Ÿåº¦å˜æ…¢ã€‚æˆ‘ä»¬å¾€å¾€éœ€è¦æ ¹æ®å®é™…çš„éœ€æ±‚åšä¸€äº›æµ‹è¯•ï¼Œæ¥å¯»æ‰¾æœ€ä¼˜çš„çº¿ç¨‹æ•°é‡ã€‚</p></blockquote><p><strong>å¤šçº¿ç¨‹æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„åŸå› </strong></p><blockquote><p>äº‹å®ä¸Šï¼ŒPython çš„è§£é‡Šå™¨å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸ºäº†è§£å†³ç”±æ­¤å¸¦æ¥çš„ race condition ç­‰é—®é¢˜ï¼ŒPython ä¾¿å¼•å…¥äº†å…¨å±€è§£é‡Šå™¨é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶åˆ»ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å½“ç„¶ï¼Œåœ¨æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è¢« block äº†ï¼Œå…¨å±€è§£é‡Šå™¨é”ä¾¿ä¼šè¢«é‡Šæ”¾ï¼Œä»è€Œè®©å¦ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚</p></blockquote><h3 id="å¹¶è¡Œ"><a href="#å¹¶è¡Œ" class="headerlink" title="å¹¶è¡Œ"></a>å¹¶è¡Œ</h3><blockquote><p> æ‰€è°“çš„å¹¶è¡Œï¼ŒæŒ‡çš„æ˜¯åŒä¸€æ—¶åˆ»ã€åŒæ—¶å‘ç”Ÿã€‚Python ä¸­çš„ multi-processing ä¾¿æ˜¯è¿™ä¸ªæ„æ€</p></blockquote><p><img src="/images/python/multi-processing.png"></p><ul><li>å¹¶å‘é€šå¸¸åº”ç”¨äº I/O æ“ä½œé¢‘ç¹çš„åœºæ™¯ï¼Œæ¯”å¦‚ä½ è¦ä»ç½‘ç«™ä¸Šä¸‹è½½å¤šä¸ªæ–‡ä»¶ï¼ŒI/O æ“ä½œçš„æ—¶é—´å¯èƒ½ä¼šæ¯” CPU è¿è¡Œå¤„ç†çš„æ—¶é—´é•¿å¾—å¤šã€‚</li><li>è€Œå¹¶è¡Œåˆ™æ›´å¤šåº”ç”¨äº CPU heavy çš„åœºæ™¯ï¼Œæ¯”å¦‚ MapReduce ä¸­çš„å¹¶è¡Œè®¡ç®—ï¼Œä¸ºäº†åŠ å¿«è¿è¡Œé€Ÿåº¦ï¼Œä¸€èˆ¬ä¼šç”¨å¤šå°æœºå™¨ã€å¤šä¸ªå¤„ç†å™¨æ¥å®Œæˆã€‚</li></ul><p><strong>futureså®ç°å¹¶è¡Œ</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_all</span>(<span class="params">sites</span>):</span></span><br><span class="line">    <span class="keyword">with</span> concurrent.futures.ProcessPoolExecutor(max_workers=<span class="number">5</span>) <span class="keyword">as</span> executor:</span><br><span class="line">        to_do = []</span><br><span class="line">        <span class="keyword">for</span> site <span class="keyword">in</span> sites:</span><br><span class="line">            future = executor.submit(download_one, site)</span><br><span class="line">            to_do.append(future)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">for</span> future <span class="keyword">in</span> concurrent.futures.as_completed(to_do):</span><br><span class="line">            future.result()</span><br></pre></td></tr></table></figure><blockquote><p>å‡½æ•° ProcessPoolExecutor() è¡¨ç¤ºåˆ›å»ºè¿›ç¨‹æ± ï¼Œä½¿ç”¨å¤šä¸ªè¿›ç¨‹å¹¶è¡Œçš„æ‰§è¡Œç¨‹åºã€‚ä¸è¿‡ï¼Œè¿™é‡Œæˆ‘ä»¬é€šå¸¸çœç•¥å‚æ•° workersï¼Œå› ä¸ºç³»ç»Ÿä¼šè‡ªåŠ¨è¿”å› CPU çš„æ•°é‡ä½œä¸ºå¯ä»¥è°ƒç”¨çš„è¿›ç¨‹æ•°ã€‚</p></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">if</span> io_bound:</span><br><span class="line">    <span class="keyword">if</span> io_slow:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Use Asyncio&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Use multi-threading&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> cpu_bound:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Use multi-processing&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="multiprocessing-vs-threading"><a href="#multiprocessing-vs-threading" class="headerlink" title="multiprocessing vs threading"></a>multiprocessing vs threading</h4><p> <code>multiprocessing</code> æ¨¡å—å¯ä»¥ç”¨æ¥åˆ›å»ºå’Œç®¡ç†å¤šä¸ªè¿›ç¨‹ï¼Œä»è€Œå®ç°å¹¶å‘ä»»åŠ¡å¤„ç†ã€‚è€Œ <code>threading</code> æ¨¡å—åˆ™æ˜¯ç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹ã€‚ä¸¤è€…åœ¨å®ç°å¹¶å‘ä»»åŠ¡æ—¶æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ï¼š</p><ol><li><strong>è¿›ç¨‹ vs çº¿ç¨‹</strong>:<ul><li><strong>å¤šè¿›ç¨‹ (multiprocessing)</strong>: æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´å’Œå…¨å±€è§£é‡Šå™¨é” (GIL) æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå› æ­¤å¤šè¿›ç¨‹é€‚åˆ CPU å¯†é›†å‹ä»»åŠ¡ï¼Œå› ä¸ºä¸åŒçš„è¿›ç¨‹å¯ä»¥åœ¨å¤šä¸ª CPU æ ¸å¿ƒä¸Šå¹¶è¡Œè¿è¡Œã€‚</li><li><strong>å¤šçº¿ç¨‹ (threading)</strong>: å¤šçº¿ç¨‹å…±äº«åŒä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜å’Œèµ„æºï¼Œå› æ­¤ç®¡ç†èµ·æ¥å¯èƒ½è¾ƒä¸ºå¤æ‚ã€‚Python ä¸­çš„çº¿ç¨‹å—åˆ° GIL çš„é™åˆ¶ï¼Œå³ä½¿åœ¨å¤šçº¿ç¨‹ä¸­ä¹Ÿæ˜¯åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ Python å­—èŠ‚ç ã€‚å¤šçº¿ç¨‹é€‚åˆ I/O å¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚ç½‘ç»œæ“ä½œã€æ–‡ä»¶è¯»å†™ç­‰ï¼‰ã€‚</li></ul></li><li><strong>å…¨å±€è§£é‡Šå™¨é” (GIL)</strong>:<ul><li><strong>multiprocessing</strong>: ä¸å— GIL çš„é™åˆ¶ï¼Œå› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è§£é‡Šå™¨å®ä¾‹ã€‚</li><li><strong>threading</strong>: å—GILçš„é™åˆ¶ï¼Œè¿™åœ¨ CPU å¯†é›†å‹ä»»åŠ¡ä¸­ä¼šæˆä¸ºç“¶é¢ˆï¼Œä½†åœ¨ I/O å¯†é›†å‹ä»»åŠ¡ä¸­å½±å“ä¸å¤§ã€‚</li></ul></li><li><strong>å†…å­˜ä½¿ç”¨</strong>:<ul><li><strong>multiprocessing</strong>: æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤ä¼šä½¿ç”¨æ›´å¤šçš„å†…å­˜å¼€é”€ã€‚</li><li><strong>threading</strong>: å…±äº«åŒä¸€å†…å­˜ç©ºé—´ï¼Œå› æ­¤å†…å­˜å¼€é”€è¾ƒå°ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çº¿ç¨‹ä¹‹é—´çš„æ•°æ®åŒæ­¥å’Œç«äº‰é—®é¢˜ã€‚</li></ul></li><li><strong>å¯åŠ¨æ—¶é—´å’Œå¼€é”€</strong>:<ul><li><strong>multiprocessing</strong>: è¿›ç¨‹å¯åŠ¨å’Œåˆ‡æ¢çš„å¼€é”€è¾ƒå¤§ï¼Œé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ã€‚</li><li><strong>threading</strong>: çº¿ç¨‹å¯åŠ¨å’Œåˆ‡æ¢çš„å¼€é”€è¾ƒå°ï¼Œé€‚åˆçŸ­æ—¶é—´ã€é«˜é¢‘ç‡ä»»åŠ¡çš„å¹¶å‘å¤„ç†ã€‚</li></ul></li><li><strong>æ•°æ®å…±äº«å’Œé€šä¿¡</strong>:<ul><li><strong>multiprocessing</strong>: è¿›ç¨‹é—´æ•°æ®é€šä¿¡éœ€è¦ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡ (IPC) æœºåˆ¶ï¼Œå¦‚é˜Ÿåˆ— (Queue)ã€ç®¡é“ (Pipe) æˆ–å…±äº«å†…å­˜ (Shared Memory)ï¼Œå®ç°èµ·æ¥è¾ƒä¸ºå¤æ‚ã€‚</li><li><strong>threading</strong>: çº¿ç¨‹é—´ç›´æ¥å…±äº«å†…å­˜ï¼Œå› æ­¤æ•°æ®å…±äº«è¾ƒä¸ºæ–¹ä¾¿ï¼Œä½†éœ€è¦æ³¨æ„åŒæ­¥é—®é¢˜ï¼Œä½¿ç”¨é” (Lock)ã€æ¡ä»¶å˜é‡ (Condition) ç­‰æœºåˆ¶æ¥é¿å…ç«äº‰æ¡ä»¶ã€‚</li></ul></li></ol><p>åœ¨ç¼–å†™å¹¶å‘ç¨‹åºæ—¶ï¼Œé€‰æ‹© <code>multiprocessing</code> æˆ– <code>threading</code> å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œä»»åŠ¡ç±»å‹ã€‚å¦‚æœæ˜¯ CPU å¯†é›†å‹ä»»åŠ¡ï¼Œæ¨èä½¿ç”¨ <code>multiprocessing</code>ï¼›å¦‚æœæ˜¯ I/O å¯†é›†å‹ä»»åŠ¡ï¼Œ<code>threading</code> å¯èƒ½æ›´ä¸ºåˆé€‚ã€‚</p><h4 id="multiprocessing-vs-concurrent-future-ProcessPoolExecutor"><a href="#multiprocessing-vs-concurrent-future-ProcessPoolExecutor" class="headerlink" title="multiprocessing vs concurrent.future.ProcessPoolExecutor"></a>multiprocessing vs concurrent.future.ProcessPoolExecutor</h4><ol><li>æ¨¡å—ä½ç½®<ul><li><strong>multiprocessing</strong>: ä½äº <code>multiprocessing</code> æ¨¡å—ä¸­ï¼Œæ˜¯ä¸“é—¨ç”¨äºå¤„ç†å¹¶è¡Œè¿›ç¨‹çš„æ¨¡å—ã€‚</li><li><strong>concurrent.futures.ProcessPoolExecutor</strong>: ä½äº <code>concurrent.futures</code> æ¨¡å—ä¸­ï¼Œæ˜¯ <code>concurrent.futures</code> æä¾›çš„é«˜å±‚æ¬¡å¼‚æ­¥å¹¶å‘æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºç®€åŒ–å¹¶å‘æ‰§è¡Œã€‚</li></ul></li><li>ä½¿ç”¨æ–¹å¼<ul><li><strong>multiprocessing</strong>: æä¾›äº†ç›¸å¯¹åº•å±‚çš„æ¥å£å’Œçµæ´»æ€§ï¼Œä¾‹å¦‚ <code>Process</code>, <code>Queue</code>, <code>Pipe</code> ç­‰ã€‚ä½ å¯ä»¥ç›´æ¥ç®¡ç†è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰‹åŠ¨å¯åŠ¨å’Œç»ˆæ­¢è¿›ç¨‹ï¼Œä»¥åŠå¤„ç†è¿›ç¨‹é—´é€šä¿¡ã€‚</li><li><strong>concurrent.futures.ProcessPoolExecutor</strong>: æä¾›äº†æ›´é«˜çº§åˆ«çš„æ¥å£ï¼Œç®€åŒ–äº†å¤šè¿›ç¨‹çš„ç®¡ç†ã€‚ä½¿ç”¨ <code>Executor</code> å¯¹è±¡æ¥ç®¡ç†è¿›ç¨‹æ± ï¼Œæäº¤ä»»åŠ¡ï¼Œè·å–ç»“æœæ›´åŠ æ–¹ä¾¿å’Œç›´è§‚ã€‚</li></ul></li><li>ä»»åŠ¡æäº¤å’Œç»“æœè·å–<ul><li><strong>multiprocessing</strong>: ä½ éœ€è¦è‡ªå·±æ‰‹åŠ¨ç®¡ç†ä»»åŠ¡çš„æäº¤å’Œç»“æœçš„æ±‡æ€»ï¼Œé€šå¸¸é€šè¿‡é˜Ÿåˆ— (Queue) æˆ–ç®¡é“ (Pipe) æ¥å®ç°ã€‚</li><li><strong>concurrent.futures.ProcessPoolExecutor</strong>: æä¾›äº† <code>submit</code> å’Œ <code>map</code> å‡½æ•°æ¥æäº¤ä»»åŠ¡ï¼Œå¹¶ä¸”è¿”å› Future å¯¹è±¡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚</li></ul></li><li>å¼‚æ­¥ç‰¹æ€§<ul><li><strong>multiprocessing</strong>: æä¾›äº†ä¸€äº›åŸºç¡€çš„å¼‚æ­¥ç‰¹æ€§ï¼Œä½†ä¸»è¦è¿˜æ˜¯åŒæ­¥è°ƒç”¨ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†å¼‚æ­¥ç»“æœã€‚</li><li><strong>concurrent.futures.ProcessPoolExecutor</strong>: ä¸“é—¨è®¾è®¡ä¸ºå¼‚æ­¥æ¡†æ¶ï¼Œä¸ Python çš„ <code>asyncio</code> æ›´åŠ å‹å¥½ï¼Œå¯ä»¥ä½¿ç”¨ <code>Future</code> å¯¹è±¡è¿›è¡Œå¼‚æ­¥ä»»åŠ¡çš„ç®¡ç†ã€‚</li></ul></li></ol><h2 id="GIL"><a href="#GIL" class="headerlink" title="GIL"></a>GIL</h2><blockquote><p> Global Interpreter Lockï¼Œå³å…¨å±€è§£é‡Šå™¨é”</p><p> ä»»ä½•çº¿ç¨‹æ‰§è¡Œå‰å¿…é¡»å…ˆè·å¾—GILé”ï¼Œç„¶åæ¯æ‰§è¡Œ100æ¡å­—èŠ‚ç ï¼Œè§£é‡Šå™¨å°±è‡ªåŠ¨é‡Šæ”¾GILé”ï¼Œè®©åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œ</p></blockquote><p><strong>pythonå¼•è¿›GILçš„åŸå› </strong></p><ul><li>ä¸€æ˜¯è®¾è®¡è€…ä¸ºäº†è§„é¿ç±»ä¼¼äºå†…å­˜ç®¡ç†è¿™æ ·çš„å¤æ‚çš„ç«äº‰é£é™©é—®é¢˜ï¼ˆrace conditionï¼‰ï¼›</li><li>äºŒæ˜¯å› ä¸º CPython å¤§é‡ä½¿ç”¨ C è¯­è¨€åº“ï¼Œä½†å¤§éƒ¨åˆ† C è¯­è¨€åº“éƒ½ä¸æ˜¯åŸç”Ÿçº¿ç¨‹å®‰å…¨çš„ï¼ˆçº¿ç¨‹å®‰å…¨ä¼šé™ä½æ€§èƒ½å’Œå¢åŠ å¤æ‚åº¦ï¼‰</li></ul><p><strong>å·¥ä½œæœºåˆ¶</strong></p><p><img src="/images/python/GIL.png"></p><p><strong>check interval</strong></p><blockquote><p>CPython ä¸­è¿˜æœ‰å¦ä¸€ä¸ªæœºåˆ¶ï¼Œå«åš check_intervalï¼Œæ„æ€æ˜¯ CPython è§£é‡Šå™¨ä¼šå»è½®è¯¢æ£€æŸ¥çº¿ç¨‹ GIL çš„é”ä½æƒ…å†µã€‚æ¯éš”ä¸€æ®µæ—¶é—´ï¼ŒPython è§£é‡Šå™¨å°±ä¼šå¼ºåˆ¶å½“å‰çº¿ç¨‹å»é‡Šæ”¾ GILï¼Œè¿™æ ·åˆ«çš„çº¿ç¨‹æ‰èƒ½æœ‰æ‰§è¡Œçš„æœºä¼šã€‚</p></blockquote><p><img src="/images/python/check-interval.png"></p><h2 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h2><blockquote><p>assert è¯­å¥ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸ª debug çš„å¥½å·¥å…·ï¼Œä¸»è¦ç”¨äºæµ‹è¯•ä¸€ä¸ªæ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚å¦‚æœæµ‹è¯•çš„æ¡ä»¶æ»¡è¶³ï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸åšï¼Œç›¸å½“äºæ‰§è¡Œäº† pass è¯­å¥ï¼›å¦‚æœæµ‹è¯•æ¡ä»¶ä¸æ»¡è¶³ï¼Œä¾¿ä¼šæŠ›å‡ºå¼‚å¸¸ AssertionErrorï¼Œå¹¶è¿”å›å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼ˆoptionalï¼‰</p></blockquote><p>è¯­æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert_stmt ::=  <span class="string">&quot;assert&quot;</span> expression [<span class="string">&quot;,&quot;</span> expression]</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹å­<span class="number">1</span>ï¼š</span><br><span class="line"><span class="keyword">assert</span> <span class="number">1</span> == <span class="number">2</span></span><br><span class="line">ç›¸å½“äº</span><br><span class="line"><span class="keyword">if</span> <span class="literal">__debug__</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> expression: <span class="keyword">raise</span> AssertionError</span><br><span class="line"></span><br><span class="line">ä¾‹å­<span class="number">2</span>ï¼š</span><br><span class="line"><span class="keyword">assert</span> <span class="number">1</span> == <span class="number">2</span>,  <span class="string">&#x27;assertion is wrong&#x27;</span></span><br><span class="line">ç›¸å½“äº</span><br><span class="line"><span class="keyword">if</span> <span class="literal">__debug__</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> expression1: <span class="keyword">raise</span> AssertionError(expression2)</span><br><span class="line">    </span><br><span class="line">ä¾‹å­<span class="number">3</span>ï¼ˆä¿ƒé”€ä»·æ ¼å¤§äº<span class="number">0</span>å…ƒï¼‰ï¼š</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">apply_discount</span>(<span class="params">price, discount</span>):</span></span><br><span class="line">    updated_price = price * (<span class="number">1</span> - discount)</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt;= updated_price &lt;= price, <span class="string">&#x27;price should be greater or equal to 0 and less or equal to original price&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> updated_price</span><br></pre></td></tr></table></figure><ul><li>ä¸è¦åœ¨ä½¿ç”¨ assert æ—¶åŠ å…¥æ‹¬å·ï¼Œå¦åˆ™æ— è®ºè¡¨è¾¾å¼å¯¹ä¸é”™ï¼Œassert æ£€æŸ¥æ°¸è¿œä¸ä¼š fail</li></ul><h2 id="with"><a href="#with" class="headerlink" title="with"></a>with</h2><blockquote><p>åœ¨ Python ä¸­ï¼Œè§£å†³èµ„æºæ³„éœ²çš„æ–¹å¼æ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆcontext managerï¼‰ã€‚ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ è‡ªåŠ¨åˆ†é…å¹¶ä¸”é‡Šæ”¾èµ„æºï¼Œå…¶ä¸­æœ€å…¸å‹çš„åº”ç”¨ä¾¿æ˜¯ with è¯­å¥</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ä¸€ï¼š</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">ç­‰åŒäº</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f.write(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹äºŒï¼š</span><br><span class="line">some_lock = threading.Lock()</span><br><span class="line"><span class="keyword">with</span> somelock:</span><br><span class="line">    ...</span><br><span class="line">ç­‰åŒäº</span><br><span class="line">some_lock = threading.Lock()</span><br><span class="line">some_lock.acquire()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    some_lock.release()</span><br></pre></td></tr></table></figure><ul><li><p>åŸºäºç±»çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨</p><blockquote><p>å½“æˆ‘ä»¬ç”¨ç±»æ¥åˆ›å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨æ—¶ï¼Œå¿…é¡»ä¿è¯è¿™ä¸ªç±»åŒ…æ‹¬æ–¹æ³•<code>â€__enter__()â€</code>å’Œæ–¹æ³•<code>â€œ__exit__()â€</code>ã€‚å…¶ä¸­ï¼Œæ–¹æ³•<code>â€œ__enter__()â€</code>è¿”å›éœ€è¦è¢«ç®¡ç†çš„èµ„æºï¼Œæ–¹æ³•<code>â€œ__exit__()â€</code>é‡Œé€šå¸¸ä¼šå­˜åœ¨ä¸€äº›é‡Šæ”¾ã€æ¸…ç†èµ„æºçš„æ“ä½œï¼Œæ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­çš„å…³é—­æ–‡ä»¶ç­‰ç­‰ã€‚</p></blockquote></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileManager</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, mode</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;calling __init__ method&#x27;</span>)</span><br><span class="line">        self.name = name</span><br><span class="line">        self.mode = mode </span><br><span class="line">        self.file = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;calling __enter__ method&#x27;</span>)</span><br><span class="line">        self.file = <span class="built_in">open</span>(self.name, self.mode)</span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;calling __exit__ method&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> self.file:</span><br><span class="line">            self.file.close()</span><br><span class="line"><span class="comment"># ä½¿ç”¨       </span></span><br><span class="line"><span class="keyword">with</span> FileManager(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ready to write to file&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>åŸºäºç”Ÿæˆå™¨çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨</li></ul><blockquote><p>ä½¿ç”¨è£…é¥°å™¨ contextlib.contextmanagerï¼Œæ¥å®šä¹‰è‡ªå·±æ‰€éœ€çš„åŸºäºç”Ÿæˆå™¨çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œç”¨ä»¥æ”¯æŒ with è¯­å¥</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"> </span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file_manager</span>(<span class="params">name, mode</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = <span class="built_in">open</span>(name, mode)</span><br><span class="line">        <span class="keyword">yield</span> f</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        f.close()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">with</span> file_manager(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;hello world&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="ASGI"><a href="#ASGI" class="headerlink" title="ASGI"></a>ASGI</h2><blockquote><p> the Asynchronous Server Gateway Interface.</p></blockquote><h2 id="æ€§èƒ½è°ƒè¯•"><a href="#æ€§èƒ½è°ƒè¯•" class="headerlink" title="æ€§èƒ½è°ƒè¯•"></a>æ€§èƒ½è°ƒè¯•</h2><h3 id="cProfile"><a href="#cProfile" class="headerlink" title="cProfile"></a>cProfile</h3><hr><h2 id="ç”¨æ³•-tips"><a href="#ç”¨æ³•-tips" class="headerlink" title="ç”¨æ³• tips"></a>ç”¨æ³• tips</h2><ul><li><p>å¼•ç”¨è§„èŒƒ <code>from your_file import function_name, class_name</code></p></li><li><p>å®šä¹‰å‡½æ•°æ—¶ï¼Œæ‰€æœ‰éé»˜è®¤å‚æ•°å°†åœ¨é»˜è®¤å‚æ•°ä¹‹å‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function</span>(<span class="params">arg1, arg3, arg2=<span class="string">&quot;default&quot;</span></span>):</span></span><br><span class="line">    <span class="comment"># å‡½æ•°å®ç°</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li><li><p><code>pass</code> æ˜¯ä¸€ä¸ªç”¨äºæš‚æ—¶å ä½æˆ–ä½œä¸ºç©ºå ä½ç¬¦çš„å…³é”®å­—ï¼Œå®ƒç¡®ä¿ä»£ç èƒ½å¤Ÿé¡ºåˆ©é€šè¿‡è¯­æ³•æ£€æŸ¥è€Œä¸åšä»»ä½•å®é™…çš„æ“ä½œã€‚</p></li><li><p>æ¯ä¸ªPythonæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡<code>__name__</code>ã€‚å½“ä¸€ä¸ªPythonæ–‡ä»¶è¢«ç›´æ¥è¿è¡Œæ—¶ï¼Œ<code>__name__</code>çš„å€¼è¢«è®¾ç½®ä¸º<code>&#39;__main__&#39;</code>ã€‚å½“ä¸€ä¸ªPythonæ–‡ä»¶è¢«å¯¼å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­æ—¶ï¼Œ<code>__name__</code>çš„å€¼è¢«è®¾ç½®ä¸ºè¯¥æ–‡ä»¶çš„åå­—ï¼Œæ‰€ä»¥ç”¨<code>if __name__ == &#39;__main__&#39;</code>æ¥é¿å¼€ import æ—¶æ‰§è¡Œã€‚</p></li><li><p>æ¯”è¾ƒå’Œæ‹·è´</p><ul><li><p><code>&#39;==&#39;</code>æ“ä½œç¬¦æ¯”è¾ƒå¯¹è±¡ä¹‹é—´çš„å€¼æ˜¯å¦ç›¸ç­‰</p></li><li><p><code>&#39;is&#39;</code>æ“ä½œç¬¦ï¼Œç›¸å½“äºæ¯”è¾ƒå¯¹è±¡ä¹‹é—´çš„ ID æ˜¯å¦ç›¸ç­‰</p><blockquote><p>å¯¹äºæ•´å‹æ•°å­—æ¥è¯´ï¼Œä»¥ä¸Š<code>a is b</code>ä¸º True çš„ç»“è®ºï¼Œåªé€‚ç”¨äº -5 åˆ° 256 èŒƒå›´å†…çš„æ•°å­—</p></blockquote></li></ul></li><li><p>å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’</p><ul><li>å˜é‡çš„èµ‹å€¼ï¼Œåªæ˜¯è¡¨ç¤ºè®©å˜é‡æŒ‡å‘äº†æŸä¸ªå¯¹è±¡ï¼Œå¹¶ä¸è¡¨ç¤ºæ‹·è´å¯¹è±¡ç»™å˜é‡ï¼›è€Œä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è¢«å¤šä¸ªå˜é‡æ‰€æŒ‡å‘ã€‚</li><li>å¯å˜å¯¹è±¡ï¼ˆåˆ—è¡¨ï¼Œå­—å…¸ï¼Œé›†åˆç­‰ç­‰ï¼‰çš„æ”¹å˜ï¼Œä¼šå½±å“æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å˜é‡ã€‚</li><li>å¯¹äºä¸å¯å˜å¯¹è±¡ï¼ˆå­—ç¬¦ä¸²ï¼Œæ•´å‹ï¼Œå…ƒç¥–ç­‰ç­‰ï¼‰ï¼Œæ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å˜é‡çš„å€¼æ€»æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿä¸ä¼šæ”¹å˜ã€‚ä½†æ˜¯é€šè¿‡æŸäº›æ“ä½œï¼ˆ+= ç­‰ç­‰ï¼‰æ›´æ–°ä¸å¯å˜å¯¹è±¡çš„å€¼æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li><li>å˜é‡å¯ä»¥è¢«åˆ é™¤ï¼Œä½†æ˜¯å¯¹è±¡æ— æ³•è¢«åˆ é™¤ã€‚</li></ul></li><li><p>å®¹å™¨æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œå¯è¿­ä»£å¯¹è±¡è°ƒç”¨ iter() å‡½æ•°ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªè¿­ä»£å™¨ã€‚è¿­ä»£å™¨å¯ä»¥é€šè¿‡ next() å‡½æ•°æ¥å¾—åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä»è€Œæ”¯æŒéå†ã€‚</p></li><li><p>ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼ˆæ³¨æ„è¿™ä¸ªé€»è¾‘å…³ç³»åä¹‹ä¸æˆç«‹ï¼‰ã€‚ä½¿ç”¨ç”Ÿæˆå™¨ï¼Œä½ å¯ä»¥å†™å‡ºæ¥æ›´åŠ æ¸…æ™°çš„ä»£ç ï¼›åˆç†ä½¿ç”¨ç”Ÿæˆå™¨ï¼Œå¯ä»¥é™ä½å†…å­˜å ç”¨ã€ä¼˜åŒ–ç¨‹åºç»“æ„ã€æé«˜ç¨‹åºé€Ÿåº¦ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kafka plain &amp; sasl_scram</title>
      <link href="/2023/09/11/kafka%20config%20plain%20with%20sasl_scram/"/>
      <url>/2023/09/11/kafka%20config%20plain%20with%20sasl_scram/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å·²éªŒè¯ kafka 2.3.1</p><p>æ­¤æ–¹æ¡ˆå¯ä»¥åŠ¨æ€åˆ›å»ºç”¨æˆ·ï¼Œæˆ–ä¿®æ”¹ç”¨æˆ·è´¦å·ä¿¡æ¯</p></blockquote><blockquote><p>SASLï¼ˆSimple Authentication and Security Layerï¼‰</p><p>å‚è€ƒ <a href="https://kafka.apache.org/documentation/#security_sasl_scram">https://kafka.apache.org/documentation/#security_sasl_scram</a></p></blockquote><h1 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h1><blockquote><p>ç¯å¢ƒ zookeeperç«¯å£22181 ï¼Œkafka brokerç«¯å£39092</p><p>æ— éœ€é‡å¯zookeeper</p></blockquote><h2 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»º-SCRAM-è¯ä¹¦"><a href="#ç¬¬ä¸€æ­¥ï¼šåˆ›å»º-SCRAM-è¯ä¹¦" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåˆ›å»º SCRAM è¯ä¹¦"></a>ç¬¬ä¸€æ­¥ï¼šåˆ›å»º SCRAM è¯ä¹¦</h2><blockquote><p>åœ¨brokerå¯åŠ¨ä¹‹å‰</p></blockquote><ul><li><p>åˆ›å»ºadminç”¨æˆ·è¯ä¹¦</p><p>å¯åŠ¨ä¹‹å‰ï¼ˆå¿…é¡»ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-configs.sh --zookeeper 172.20.58.93:22181 --alter --add-config &#x27;SCRAM-SHA-256=[password=datacanvas],SCRAM-SHA-512=[password=datacanvas]&#x27; --entity-type users --entity-name admin</span><br></pre></td></tr></table></figure><blockquote><p>ä¼šåœ¨ zookeeperç”Ÿäº§ç›®å½• configï¼Œä¸Šé¢zookeeperå‚æ•°å€¼ä¸kafka server.propertiesçš„zookeeper connecté…ç½®ä¸€è‡´ï¼Œä¹Ÿå’ŒoffsetExplorerçš„chroot pathä¸€è‡´</p></blockquote></li><li><p>åˆ—å‡ºç”¨æˆ·å·²æœ‰è¯ä¹¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-configs.sh --zookeeper 172.20.58.93:22181 --describe --entity-type users --entity-name alice</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ç”¨æˆ·è¯ä¹¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-configs.sh --zookeeper 172.20.58.93:22181 --alter --delete-config &#x27;SCRAM-SHA-512&#x27; --entity-type users --entity-name alice</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºæ™®é€šç”¨æˆ·aliceè¯ä¹¦</p><blockquote><p>å¯åœ¨å¯åŠ¨ä¹‹å‰æˆ–å¯åŠ¨ä¹‹åçš†å¯</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-configs.sh --zookeeper 172.20.58.93:22181 --alter --add-config &#x27;SCRAM-SHA-256=[iterations=8192,password=alice-secret]&#x27; --entity-type users --entity-name alice</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡kafka-server-jaas-confæ–‡ä»¶"><a href="#ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡kafka-server-jaas-confæ–‡ä»¶" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡kafka_server_jaas.confæ–‡ä»¶"></a>ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡kafka_server_jaas.confæ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">KafkaServer &#123;</span><br><span class="line">    org.apache.kafka.common.security.scram.ScramLoginModule required</span><br><span class="line">    username=&quot;admin&quot;</span><br><span class="line">    password=&quot;datacanvas&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äºŒæ­¥ï¼šè®¾ç½®kafka-server-start-sh"><a href="#ç¬¬äºŒæ­¥ï¼šè®¾ç½®kafka-server-start-sh" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šè®¾ç½®kafka-server-start.sh"></a>ç¬¬äºŒæ­¥ï¼šè®¾ç½®kafka-server-start.sh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KAFKA_OPTS=<span class="string">&quot;-Djava.security.auth.login.config=/home/sasl/kafka_2.13-3.3.2/config/kafka_server_jaas.conf&quot;</span></span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ä¿®æ”¹è·¯å¾„</li></ul><h2 id="ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®server-properties"><a href="#ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®server-properties" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®server.properties"></a>ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®server.properties</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">listeners</span>=<span class="string">PLAINTEXT://0.0.0.0:9092,SASL_PLAINTEXT://0.0.0.0:29092</span></span><br><span class="line"><span class="meta">advertised.listeners</span>=<span class="string">PLAINTEXT://172.20.58.93:9092,SASL_PLAINTEXT://172.20.58.93:29092</span></span><br><span class="line"><span class="meta">security.inter.broker.protocol</span>=<span class="string">SASL_PLAINTEXT</span></span><br><span class="line"><span class="meta">sasl.mechanism.inter.broker.protocol</span>=<span class="string">SCRAM-SHA-256</span></span><br><span class="line"><span class="meta">sasl.enabled.mechanisms</span>=<span class="string">SCRAM-SHA-256</span></span><br></pre></td></tr></table></figure><ul><li><p>listenersè®¾ç½®äº†ä¸¤ç§åè®® æ˜æ–‡è¿æ¥PLAINTEXT å’Œ å®‰å…¨è¿æ¥ SASL_SSL</p><ul><li><code>0.0.0.0</code> è¡¨ç¤º Kafka Broker å°†ç›‘å¬æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼Œè¿™æ„å‘³ç€å®ƒå°†æ¥å—æ¥è‡ªä»»ä½• IP åœ°å€çš„è¿æ¥è¯·æ±‚ã€‚</li></ul></li><li><p>æ³¨æ„zookeeerå­˜å‚¨çš„ä½ç½® (/brokers)</p></li><li><p>è®¾ç½®é»˜è®¤å‰¯æœ¬æ•° default.replication.factor=3 å’Œ num.partitions=1</p></li><li><p>æµ‹è¯•ä½¿ç”¨<code>log.dirs=/home/sasl/data/kafka-logs</code></p></li><li><p> ACLsç›¸å…³é…ç½®</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># authorizer.class.name=kafka.security.auth.SimpleAclAuthorizer æ—§ç‰ˆæœ¬é…ç½®</span></span><br><span class="line"><span class="meta">authorizer.class.name</span>=<span class="string">kafka.security.authorizer.AclAuthorizer</span></span><br><span class="line"><span class="comment"># è¿™é‡Œæ·»åŠ ANONYMOUSä¸ºè¶…çº§ç”¨æˆ·ï¼Œä¸»è¦ä¸ºäº†listener for plain(å¦‚ä½•åªç”¨saslï¼Œå¯ä»¥ä¸é…ç½®ANONYMOUS)</span></span><br><span class="line"><span class="meta">super.users</span>=<span class="string">User:admin;User:ANONYMOUS </span></span><br><span class="line"><span class="meta">allow.everyone.if.no.acl.found</span>=<span class="string">false </span></span><br></pre></td></tr></table></figure><blockquote><p> é»˜è®¤ä¸ºtrue,é»˜è®¤æƒ…å†µåªé€šè¿‡ç”¨æˆ·å¯†ç è®¤è¯ç®¡æ§ç”¨æˆ·ï¼Œaclåªä¼šå¯¹â€“deny-principalèµ·æ•ˆï¼ˆæ‰€ä»¥é»˜è®¤åŒæ—¶ä½¿ç”¨ plainå’Œscramï¼Œéœ€è¦ä¿æŒé»˜è®¤trueã€‚å¦‚æœå•ç‹¬ä½¿ç”¨scramï¼Œåˆ™éœ€è¦è®¾ç½®ä¸ºfalseï¼‰</p></blockquote><h2 id="ç¬¬å››æ­¥ï¼šè®¾ç½®acl-config-properties"><a href="#ç¬¬å››æ­¥ï¼šè®¾ç½®acl-config-properties" class="headerlink" title="ç¬¬å››æ­¥ï¼šè®¾ç½®acl-config.properties"></a>ç¬¬å››æ­¥ï¼šè®¾ç½®acl-config.properties</h2><p>åœ¨configç›®å½•æ–°å¢acl-config.propertiesè®¾ç½® adminä¿¡æ¯</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">sasl.jaas.config</span>=<span class="string">org.apache.kafka.common.security.scram.ScramLoginModule required username=&quot;admin&quot; password=&quot;datacanvas&quot;;</span></span><br><span class="line"><span class="meta">security.protocol</span>=<span class="string">SASL_PLAINTEXT</span></span><br><span class="line"><span class="meta">sasl.mechanism</span>=<span class="string">SCRAM-SHA-256</span></span><br></pre></td></tr></table></figure><h2 id="ç¬¬äº”æ­¥ï¼šå¯åŠ¨kafka-server"><a href="#ç¬¬äº”æ­¥ï¼šå¯åŠ¨kafka-server" class="headerlink" title="ç¬¬äº”æ­¥ï¼šå¯åŠ¨kafka server"></a>ç¬¬äº”æ­¥ï¼šå¯åŠ¨kafka server</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">bin/kafka-server-start.sh</span> <span class="string">-daemon ./config/server.properties</span></span><br></pre></td></tr></table></figure><h2 id="ç¬¬å…­æ­¥ï¼šé…ç½®ACLæˆæƒ"><a href="#ç¬¬å…­æ­¥ï¼šé…ç½®ACLæˆæƒ" class="headerlink" title="ç¬¬å…­æ­¥ï¼šé…ç½®ACLæˆæƒ"></a>ç¬¬å…­æ­¥ï¼šé…ç½®ACLæˆæƒ</h2><ul><li><p>æˆæƒbigdataç”¨æˆ·å¯ä»¥è®¿é—®ä¸»é¢˜å‰ç¼€ä¸ºODSçš„æ•°æ®ï¼Œä¸”é™åˆ¶æ¶ˆè´¹ç»„ GROUP-BIGDATA</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-acls.sh --bootstrap-server 172.20.58.93:29092 --command-config /path/to/config/acl-config.properties --add --allow-principal User:bigdata --operation Read --group GROUP-BIGDATA --topic ODS --resource-pattern-type prefixed</span><br></pre></td></tr></table></figure><ul><li>â€“resource-pattern-type prefixed æŒ‡å®šODSå‰ç¼€</li></ul></li><li><p>ç§»é™¤æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-acls.sh --bootstrap-server localhost:9092 --command-config /home/sasl/kafka_2.13-3.3.2/config/acl-config.properties --remove --allow-principal User:Bob --allow-principal User:Alice --allow-host 198.51.100.0 --allow-host 198.51.100.1 --operation Read --operation Write --topic Test-topic </span><br></pre></td></tr></table></figure></li></ul><ul><li><p>ç¦æ­¢åˆ é™¤æŒ‡å®šä¸»é¢˜çš„æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-acls.sh --bootstrap-server 172.20.58.93:29092 --command-config /home/sasl/kafka_2.13-3.3.2/config/acl-config.properties --add --deny-principal User:bigdata --operation Write --operation Delete --topic ODS --resource-pattern-type prefixed</span><br></pre></td></tr></table></figure></li></ul><hr><h1 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h1><ul><li><p>PLAINè¿æ¥ä¿æŒåŸå…ˆæ“ä½œ</p></li><li><p>SASL_PLAINTEXT</p><p>è¿æ¥é…ç½®æ·»åŠ ç”¨æˆ·ç™»å½•ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.kafka.common.security.scram.ScramLoginModule required username=&quot;admin&quot; password=&quot;datacanvas&quot;;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> kafka </category>
          
      </categories>
      
      
        <tags>
            
            <tag> config </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kafka plain &amp; sasl_plain</title>
      <link href="/2023/09/11/kafka%20config%20plain%20with%20sasl_plain/"/>
      <url>/2023/09/11/kafka%20config%20plain%20with%20sasl_plain/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å·²éªŒè¯Kafka 3.3.2</p><p>æ­¤æ–¹æ¡ˆçš„ç¼ºç‚¹ï¼Œåœ¨sasl_plaintextæ¨¡å¼ä¸‹ï¼Œä¸èƒ½åŠ¨æ€åˆ›å»ºç”¨æˆ·ï¼Œæˆ–ä¿®æ”¹ç”¨æˆ·è´¦å·ä¿¡æ¯</p><p>ä¼˜ç‚¹æ˜¯ï¼Œæ— éœ€åœ¨zookeeperä¸Šé…ç½®jaas</p></blockquote><h1 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h1><h2 id="ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡kafka-server-jaas-confæ–‡ä»¶"><a href="#ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡kafka-server-jaas-confæ–‡ä»¶" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡kafka_server_jaas.confæ–‡ä»¶"></a>ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡kafka_server_jaas.confæ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">KafkaServer &#123;</span><br><span class="line">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">    username=&quot;admin&quot;</span><br><span class="line">    password=&quot;datacanvas&quot;</span><br><span class="line">    user_admin=&quot;datacanvas&quot;</span><br><span class="line">    user_qlb=&quot;qlbrtdsp&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äºŒæ­¥ï¼šè®¾ç½®kafka-server-start-sh"><a href="#ç¬¬äºŒæ­¥ï¼šè®¾ç½®kafka-server-start-sh" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šè®¾ç½®kafka-server-start.sh"></a>ç¬¬äºŒæ­¥ï¼šè®¾ç½®kafka-server-start.sh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KAFKA_OPTS=<span class="string">&quot;-Djava.security.auth.login.config=/home/sasl/kafka_2.13-3.3.2/config/kafka_server_jaas.conf&quot;</span></span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ä¿®æ”¹è·¯å¾„</li></ul><h2 id="ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®server-properties"><a href="#ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®server-properties" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®server.properties"></a>ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®server.properties</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">listeners</span>=<span class="string">PLAINTEXT://0.0.0.0:9092,SASL_PLAINTEXT://0.0.0.0:29092</span></span><br><span class="line"><span class="meta">advertised.listeners</span>=<span class="string">PLAINTEXT://172.20.58.93:9092,SASL_PLAINTEXT://172.20.58.93:29092</span></span><br><span class="line"><span class="meta">security.inter.broker.protocol</span>=<span class="string">SASL_PLAINTEXT</span></span><br><span class="line"><span class="meta">sasl.mechanism.inter.broker.protocol</span>=<span class="string">PLAIN</span></span><br><span class="line"><span class="meta">sasl.enabled.mechanisms</span>=<span class="string">PLAIN</span></span><br></pre></td></tr></table></figure><ul><li><p>listenersè®¾ç½®äº†ä¸¤ç§åè®® æ˜æ–‡è¿æ¥PLAINTEXT å’Œ å®‰å…¨è¿æ¥ SASL_PLAINTEXT</p><ul><li><code>0.0.0.0</code> è¡¨ç¤º Kafka Broker å°†ç›‘å¬æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼Œè¿™æ„å‘³ç€å®ƒå°†æ¥å—æ¥è‡ªä»»ä½• IP åœ°å€çš„è¿æ¥è¯·æ±‚ã€‚</li></ul></li><li><p>æ³¨æ„zookeeerå­˜å‚¨çš„ä½ç½® (/brokers)</p></li><li><p>è®¾ç½®é»˜è®¤å‰¯æœ¬æ•° default.replication.factor=3 å’Œ num.partitions=1</p></li><li><p>æµ‹è¯•ä½¿ç”¨<code>log.dirs=/home/sasl/data/kafka-logs</code></p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># authorizer.class.name=kafka.security.auth.SimpleAclAuthorizer æ—§ç‰ˆæœ¬é…ç½®</span></span><br><span class="line"><span class="meta">authorizer.class.name</span>=<span class="string">kafka.security.authorizer.AclAuthorizer</span></span><br><span class="line"><span class="meta">super.users</span>=<span class="string">User:admin;User:ANONYMOUS</span></span><br><span class="line"><span class="meta">allow.everyone.if.no.acl.found</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure><h2 id="ç¬¬å››æ­¥ï¼šè®¾ç½®acl-config-properties"><a href="#ç¬¬å››æ­¥ï¼šè®¾ç½®acl-config-properties" class="headerlink" title="ç¬¬å››æ­¥ï¼šè®¾ç½®acl-config.properties"></a>ç¬¬å››æ­¥ï¼šè®¾ç½®acl-config.properties</h2><p>åœ¨configç›®å½•æ–°å¢acl-config.propertiesè®¾ç½® adminä¿¡æ¯</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">sasl.jaas.config</span>=<span class="string">org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;admin&quot; password=&quot;datacanvas&quot;;</span></span><br><span class="line"><span class="meta">security.protocol</span>=<span class="string">SASL_PLAINTEXT</span></span><br><span class="line"><span class="meta">sasl.mechanism</span>=<span class="string">PLAIN</span></span><br></pre></td></tr></table></figure><h2 id="ç¬¬äº”æ­¥ï¼šå¯åŠ¨kafka-server"><a href="#ç¬¬äº”æ­¥ï¼šå¯åŠ¨kafka-server" class="headerlink" title="ç¬¬äº”æ­¥ï¼šå¯åŠ¨kafka server"></a>ç¬¬äº”æ­¥ï¼šå¯åŠ¨kafka server</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">bin/kafka-server-start.sh</span> <span class="string">-daemon ./config/server.properties</span></span><br></pre></td></tr></table></figure><h2 id="ç¬¬å…­æ­¥ï¼šé…ç½®ACLæˆæƒ"><a href="#ç¬¬å…­æ­¥ï¼šé…ç½®ACLæˆæƒ" class="headerlink" title="ç¬¬å…­æ­¥ï¼šé…ç½®ACLæˆæƒ"></a>ç¬¬å…­æ­¥ï¼šé…ç½®ACLæˆæƒ</h2><ul><li><p>æˆæƒbigdataç”¨æˆ·å¯ä»¥è®¿é—®ä¸»é¢˜å‰ç¼€ä¸ºODSçš„æ•°æ®ï¼Œä¸”é™åˆ¶æ¶ˆè´¹ç»„ GROUP-BIGDATA</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-acls.sh --bootstrap-server 172.20.58.93:29092 --command-config /home/sasl/kafka_2.13-3.3.2/config/acl-config.properties --add --allow-principal User:bigdata --operation Read --topic ODS --group GROUP-BIGDATA --resource-pattern-type prefixed</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>ç¦æ­¢æŒ‡å®šç”¨æˆ·å†™å…¥ã€åˆ é™¤ä¸»é¢˜å‰ç¼€ä¸ºODSçš„æ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-acls.sh --bootstrap-server 172.20.58.93:29092 --command-config /home/sasl/kafka_2.13-3.3.2/config/acl-config.properties --add --deny-principal User:bigdata --operation Write --operation Delete --topic ODS --resource-pattern-type prefixed</span><br></pre></td></tr></table></figure></li></ul><hr><h1 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h1><ul><li><p>PLAINTEXTè¿æ¥ä¿æŒåŸå…ˆæ“ä½œ</p></li><li><p>SASL_PLAINTEXT</p><p>è¿æ¥é…ç½®æ·»åŠ ç”¨æˆ·ç™»å½•ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;admin&quot; password=&quot;datacanvas&quot;;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> kafka </category>
          
      </categories>
      
      
        <tags>
            
            <tag> config </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XC point</title>
      <link href="/2023/03/13/xc/"/>
      <url>/2023/03/13/xc/</url>
      
        <content type="html"><![CDATA[<h1 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h1><ul><li>ARMæ¶æ„</li></ul><p>â€‹    é£è…¾CPUã€é²²é¹CPU</p><ul><li>X86æ¶æ„</li></ul><p>â€‹    æµ·å…‰CPUï¼ˆä¸AMDåˆä½œï¼‰</p><p>â€‹    å…†èŠ¯ã€é¾™èŠ¯ã€ç”³å¨</p>]]></content>
      
      
      <categories>
          
          <category> point </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM Command</title>
      <link href="/2023/03/06/JVM%20command/"/>
      <url>/2023/03/06/JVM%20command/</url>
      
        <content type="html"><![CDATA[<h1 id="å®è·µä¸€-æŸ¥çœ‹è¿›ç¨‹å‚æ•°"><a href="#å®è·µä¸€-æŸ¥çœ‹è¿›ç¨‹å‚æ•°" class="headerlink" title="å®è·µä¸€: æŸ¥çœ‹è¿›ç¨‹å‚æ•°"></a>å®è·µä¸€: æŸ¥çœ‹è¿›ç¨‹å‚æ•°</h1><blockquote><p>æŸ¥çœ‹æœåŠ¡è®¾ç½®çš„jvm</p><p>jps -v</p><p>æŸ¥çœ‹æœåŠ¡jvmçš„é»˜è®¤å‚æ•°</p><p>jinfo -flags PID</p></blockquote><ul><li><p>å‚è€ƒkafkaæœåŠ¡çš„è¿è¡Œå‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-server</span><br><span class="line">-XX:+UseG1GC</span><br><span class="line">-XX:MaxGCPauseMillis=20</span><br><span class="line">-XX:InitiatingHeapOccupancyPercent=35</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrent</span><br></pre></td></tr></table></figure><p><strong>-XX:MaxGCPauseMillis=200</strong></p><p>ä¸ºæ‰€éœ€çš„æœ€é•¿æš‚åœæ—¶é—´è®¾ç½®ç›®æ ‡å€¼ã€‚é»˜è®¤å€¼æ˜¯ 200 æ¯«ç§’ã€‚è¿™ä¸ªæ•°å€¼æ˜¯ä¸€ä¸ªè½¯ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯è¯´JVMä¼šå°½ä¸€åˆ‡èƒ½åŠ›æ»¡è¶³è¿™ä¸ªæš‚åœè¦æ±‚ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ¯æ¬¡æš‚åœä¸€å®šåœ¨è¿™ä¸ªè¦æ±‚ä¹‹å†…ã€‚</p><p>æ ¹æ®æµ‹è¯•å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªå€¼è®¾å®šæˆ50æ¯«ç§’æˆ–è€…æ›´ä½çš„è¯ï¼ŒJVMä¸ºäº†è¾¾åˆ°è¿™ä¸ªè¦æ±‚ä¼šå°†å¹´è½»ä»£å†…å­˜ç©ºé—´è®¾å®šçš„éå¸¸å°ï¼Œä»è€Œå¯¼è‡´youngGCçš„é¢‘ç‡å¤§å¤§å¢é«˜ã€‚æ‰€ä»¥æˆ‘ä»¬å¹¶ä¸è®¾å®šè¿™ä¸ªå‚æ•°ã€‚</p><p><strong>-XX:InitiatingHeapOccupancyPercent=45</strong></p><p>è®¾ç½®è§¦å‘æ ‡è®°å‘¨æœŸçš„ Java å †å ç”¨ç‡é˜ˆå€¼ã€‚é»˜è®¤å ç”¨ç‡æ˜¯æ•´ä¸ª Java å †çš„ 45%ã€‚å°±æ˜¯è¯´å½“ä½¿ç”¨å†…å­˜å åˆ°å †æ€»å¤§å°çš„45%çš„æ—¶å€™ï¼ŒG1å°†å¼€å§‹<strong>å¹¶å‘æ ‡è®°é˜¶æ®µã€‚</strong>ä¸ºæ··åˆGCåšå‡†å¤‡ï¼Œè¿™ä¸ªæ•°å€¼åœ¨æµ‹è¯•çš„æ—¶å€™æˆ‘æƒ³è®©æ··åˆGCæ™šä¸€äº›å¤„ç†æ‰€ä»¥è®¾å®šæˆäº†70%ï¼Œç»è¿‡è§‚å¯Ÿå‘ç°å¦‚æœè¿™ä¸ªæ•°å€¼è®¾å®šè¿‡å¤§ä¼šå¯¼è‡´JVMæ— æ³•å¯åŠ¨å¹¶å‘æ ‡è®°ï¼Œç›´æ¥è¿›è¡ŒFullGCå¤„ç†ã€‚</p><p>G1çš„FullGCæ˜¯å•çº¿ç¨‹ï¼Œä¸€ä¸ª22Gçš„å¯¹GCå®Œæˆéœ€è¦8Sçš„æ—¶é—´ï¼Œæ‰€ä»¥è¿™ä¸ªå€¼åœ¨è°ƒä¼˜çš„æ—¶å€™å†™çš„45%</p></li></ul><blockquote><p>ä¹‹å‰æŸ¥çœ‹igniteï¼Œ12ç§’å›æ”¶äº†71G</p></blockquote><h1 id="å®è·µäºŒï¼šæŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„ç±»"><a href="#å®è·µäºŒï¼šæŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„ç±»" class="headerlink" title="å®è·µäºŒï¼šæŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„ç±»"></a>å®è·µäºŒï¼šæŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„ç±»</h1><blockquote><p>jcmdå‘½ä»¤è¦ä½¿ç”¨å¯åŠ¨ç›®æ ‡è¿›ç¨‹çš„ç”¨æˆ·æ‰§è¡Œ</p></blockquote><ol><li><p>ä½¿ç”¨dumpå†…å­˜ä¿¡æ¯åˆ°heap.binæ–‡ä»¶<br>ä½¿ç”¨å‘½ä»¤<code>jmap -dump:live,format=b,file=heap.bin pidï¼ˆè¿›ç¨‹å·ï¼‰</code>å°†è¿›ç¨‹pidçš„å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°heap.binæ–‡ä»¶ä¸­</p></li><li><p>ä½¿ç”¨jhat å¯¹heap.bin æ–‡ä»¶è¿›è¡Œåˆ†æ<br>å‘½ä»¤<code>jhat -J-mx512m heap.bin</code>ï¼Œ å¦‚æœè§£æè¿‡ç¨‹ä¸­å‡ºç°å†…å­˜ä¸è¶³ï¼Œéœ€è¦åŠ å¤§å†…å­˜å¦‚:<code>jhat -J-mx800m heap.bin</code></p></li><li><p>é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://ip:7000/</code>å³å¯çœ‹åˆ°åˆ†æç»“æœã€‚ç‚¹å‡»æ¯ä¸ªç±»ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯¥ç±»æ˜¯è¢«å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> jvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql HA &amp; keepalived</title>
      <link href="/2022/01/19/mysql%20HA/"/>
      <url>/2022/01/19/mysql%20HA/</url>
      
        <content type="html"><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul><li><p>the size of blob column</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  A BLOB can be 65535 bytes (64 KB) maximum.</span><br><span class="line">If you need more consider using:</span><br><span class="line">a MEDIUMBLOB for 16777215 bytes (16 MB)</span><br><span class="line">a LONGBLOB for 4294967295 bytes (4 GB).</span><br></pre></td></tr></table></figure></li><li><p>join sql</p></li><li><p>string convert to timstamp</p><p><code>SELECT STR_TO_DATE(&#39;2014-05-28 11:30:10&#39;,&#39;%Y-%m-%d %H:%i:%s&#39;);</code></p></li></ul><h3 id="sqlè¯­å¥"><a href="#sqlè¯­å¥" class="headerlink" title="sqlè¯­å¥"></a>sqlè¯­å¥</h3><ul><li>IN</li></ul><p>ç¡®å®šç»™å®šçš„å€¼æ˜¯å¦ä¸å­æŸ¥è¯¢æˆ–åˆ—è¡¨ä¸­çš„å€¼ç›¸åŒ¹é…ã€‚inåœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œé¦–å…ˆæŸ¥è¯¢å­æŸ¥è¯¢çš„è¡¨ï¼Œç„¶åå°†å†…è¡¨å’Œå¤–è¡¨åšä¸€ä¸ªç¬›å¡å°”ç§¯ï¼Œç„¶åæŒ‰ç…§æ¡ä»¶è¿›è¡Œç­›é€‰ã€‚æ‰€ä»¥ç›¸å¯¹å†…è¡¨æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œinçš„é€Ÿåº¦è¾ƒå¿«ã€‚ </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    `<span class="keyword">user</span>`</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    `<span class="keyword">user</span>`.id <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            `<span class="keyword">order</span>`.user_id</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">            `<span class="keyword">order</span>`</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>ä»¥ä¸ŠæŸ¥è¯¢ä½¿ç”¨äº†inè¯­å¥,in()åªæ‰§è¡Œä¸€æ¬¡,å®ƒæŸ¥å‡ºBè¡¨ä¸­çš„æ‰€æœ‰idå­—æ®µå¹¶ç¼“å­˜èµ·æ¥.ä¹‹å,æ£€æŸ¥Aè¡¨çš„idæ˜¯å¦ä¸Bè¡¨ä¸­çš„idç›¸ç­‰,å¦‚æœç›¸ç­‰åˆ™å°†Aè¡¨çš„è®°å½•åŠ å…¥ç»“æœé›†ä¸­,ç›´åˆ°éå†å®ŒAè¡¨çš„æ‰€æœ‰è®°å½•ã€‚</p><p>å¯ä»¥çœ‹å‡º,å½“Bè¡¨æ•°æ®è¾ƒå¤§æ—¶ä¸é€‚åˆä½¿ç”¨in(),å› ä¸ºå®ƒä¼šBè¡¨æ•°æ®å…¨éƒ¨éå†ä¸€æ¬¡. å¦‚:Aè¡¨æœ‰10000æ¡è®°å½•,Bè¡¨æœ‰1000000æ¡è®°å½•,é‚£ä¹ˆæœ€å¤šæœ‰å¯èƒ½éå†10000<code>*</code>1000000æ¬¡,æ•ˆç‡å¾ˆå·®. å†å¦‚:Aè¡¨æœ‰10000æ¡è®°å½•,Bè¡¨æœ‰100æ¡è®°å½•,é‚£ä¹ˆæœ€å¤šæœ‰å¯èƒ½éå†10000*100æ¬¡,éå†æ¬¡æ•°å¤§å¤§å‡å°‘,æ•ˆç‡å¤§å¤§æå‡ã€‚</p><ul><li>exists</li></ul><p>æŒ‡å®šä¸€ä¸ªå­æŸ¥è¯¢ï¼Œæ£€æµ‹è¡Œçš„å­˜åœ¨ã€‚éå†å¾ªç¯å¤–è¡¨ï¼Œç„¶åçœ‹å¤–è¡¨ä¸­çš„è®°å½•æœ‰æ²¡æœ‰å’Œå†…è¡¨çš„æ•°æ®ä¸€æ ·çš„ã€‚åŒ¹é…ä¸Šå°±å°†ç»“æœæ”¾å…¥ç»“æœé›†ä¸­ã€‚ </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.<span class="operator">*</span> <span class="keyword">from</span> A a <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> B b <span class="keyword">where</span> a.id<span class="operator">=</span>b.id)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸ŠæŸ¥è¯¢ä½¿ç”¨äº†existsè¯­å¥,exists()ä¼šæ‰§è¡ŒA.lengthæ¬¡,å®ƒå¹¶ä¸ç¼“å­˜exists()ç»“æœé›†,å› ä¸ºexists()ç»“æœé›†çš„å†…å®¹å¹¶ä¸é‡è¦,é‡è¦çš„æ˜¯ç»“æœé›†ä¸­æ˜¯å¦æœ‰è®°å½•,å¦‚æœæœ‰åˆ™è¿”å›true,æ²¡æœ‰åˆ™è¿”å›falseã€‚</p><p>å½“Bè¡¨æ¯”Aè¡¨æ•°æ®å¤§æ—¶é€‚åˆä½¿ç”¨exists(),å› ä¸ºå®ƒæ²¡æœ‰é‚£ä¹ˆéå†æ“ä½œ,åªéœ€è¦å†æ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢å°±è¡Œ. å¦‚:Aè¡¨æœ‰10000æ¡è®°å½•,Bè¡¨æœ‰1000000æ¡è®°å½•,é‚£ä¹ˆexists()ä¼šæ‰§è¡Œ10000æ¬¡å»åˆ¤æ–­Aè¡¨ä¸­çš„idæ˜¯å¦ä¸Bè¡¨ä¸­çš„idç›¸ç­‰. å¦‚:Aè¡¨æœ‰10000æ¡è®°å½•,Bè¡¨æœ‰100000000æ¡è®°å½•,é‚£ä¹ˆexists()è¿˜æ˜¯æ‰§è¡Œ10000æ¬¡,å› ä¸ºå®ƒåªæ‰§è¡ŒA.lengthæ¬¡,å¯è§Bè¡¨æ•°æ®è¶Šå¤š,è¶Šé€‚åˆexists()å‘æŒ¥æ•ˆæœ. å†å¦‚:Aè¡¨æœ‰10000æ¡è®°å½•,Bè¡¨æœ‰100æ¡è®°å½•,é‚£ä¹ˆexists()è¿˜æ˜¯æ‰§è¡Œ10000æ¬¡,è¿˜ä¸å¦‚ä½¿ç”¨in()éå†10000*100æ¬¡,å› ä¸ºin()æ˜¯åœ¨å†…å­˜é‡Œéå†æ¯”è¾ƒ,è€Œexists()éœ€è¦æŸ¥è¯¢æ•°æ®åº“,æˆ‘ä»¬éƒ½çŸ¥é“æŸ¥è¯¢æ•°æ®åº“æ‰€æ¶ˆè€—çš„æ€§èƒ½æ›´é«˜,è€Œå†…å­˜æ¯”è¾ƒå¾ˆå¿«. </p><ul><li>where</li></ul><p>sqlæŸ¥è¯¢æ¡ä»¶ä¸­<code>where 1=1,1=2å’Œ1=0</code>ï¼Œè¿™ç§å†™æ³•ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‹¼å‡‘åŠ¨æ€çš„sqlè¯­å¥ï¼Œå¦‚æœä½¿ç”¨ä¸å¥½ä¼šèµ·åˆ°å‰¯ä½œç”¨çš„ï¼Œæ˜¯æ ¹æ®ä¸ªäººçš„ä¸€äº›ä¹ æƒ¯ï¼Œæ˜¯ä¸ºäº†é¿å…where å…³é”®å­—åé¢çš„ç¬¬ä¸€ä¸ªè¯ç›´æ¥å°±æ˜¯ â€œandâ€è€Œå¯¼è‡´è¯­æ³•é”™è¯¯ï¼Œæ˜¯ä¸ºäº†åé¢é™„åŠ and â€¦æ–¹ä¾¿ç¨‹åºé€»è¾‘å¤„ç†ç”¨çš„ã€‚ </p><ul><li><p>select count(*)å’Œselect count(1)çš„åŒºåˆ«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSelect Count(*)å’ŒSelect Count(1)ä¸¤ç€è¿”å›ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå‡å¦‚è¡¨æ²¡æœ‰ä¸»é”®(Primary key), é‚£ä¹ˆcount(1)æ¯”count(*)å¿«ï¼Œå¦‚æœæœ‰ä¸»é”®çš„è¯ï¼Œé‚£ä¸»é”®ä½œä¸ºcountçš„æ¡ä»¶æ—¶å€™count(ä¸»é”®)æœ€å¿«ï¼Œå¦‚æœä½ çš„è¡¨åªæœ‰ä¸€ä¸ªå­—æ®µçš„è¯é‚£count(*)å°±æ˜¯æœ€å¿«çš„ã€‚</span><br></pre></td></tr></table></figure></li></ul><h3 id="äº‹ç‰©éš”ç¦»çº§åˆ«"><a href="#äº‹ç‰©éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹ç‰©éš”ç¦»çº§åˆ«"></a>äº‹ç‰©éš”ç¦»çº§åˆ«</h3><ul><li><p>read uncommittedï¼ˆè¯»å–æœªæäº¤æ•°æ®ï¼‰</p><blockquote><p>æˆ‘ä»¬å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºread uncommittedï¼Œå³ä¾¿æ˜¯äº‹åŠ¡æ²¡æœ‰commitï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶èƒ½è¯»åˆ°æœªæäº¤çš„æ•°æ®ï¼Œè¿™æ˜¯æ‰€æœ‰éš”ç¦»çº§åˆ«ä¸­æœ€ä½çš„ä¸€ç§ã€‚</p><p>è„è¯»</p></blockquote></li><li><p>read committedï¼ˆå¯ä»¥è¯»å–å…¶ä»–äº‹åŠ¡æäº¤çš„æ•°æ®ï¼‰</p><blockquote><p>å¤§å¤šæ•°æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«;</p><p>å½“æˆ‘ä»¬å°†å½“å‰ä¼šè¯çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºread committedçš„æ—¶å€™ï¼Œå½“å‰ä¼šè¯åªèƒ½è¯»å–åˆ°å…¶ä»–äº‹åŠ¡æäº¤çš„æ•°æ®ï¼Œæœªæäº¤çš„æ•°æ®è¯»ä¸åˆ°ã€‚</p></blockquote></li><li><p>repeatable readï¼ˆå¯é‡è¯»ï¼‰</p><blockquote><p>MySQLé»˜è®¤çš„éš”ç¦»çº§åˆ«</p><p>å½“æˆ‘ä»¬å°†å½“å‰ä¼šè¯çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºrepeatable readçš„æ—¶å€™ï¼Œå½“å‰ä¼šè¯å¯ä»¥é‡å¤è¯»ï¼Œå°±æ˜¯æ¯æ¬¡è¯»å–çš„ç»“æœé›†éƒ½ç›¸åŒï¼Œè€Œä¸ç®¡å…¶ä»–äº‹åŠ¡æœ‰æ²¡æœ‰æäº¤ã€‚</p><p>å¹»è¯»</p></blockquote></li><li><p>serializableï¼ˆä¸²è¡ŒåŒ–ï¼‰</p><blockquote><p>å½“æˆ‘ä»¬å°†å½“å‰ä¼šè¯çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºserializableçš„æ—¶å€™ï¼Œå…¶ä»–ä¼šè¯å¯¹è¯¥è¡¨çš„å†™æ“ä½œå°†è¢«æŒ‚èµ·ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯éš”ç¦»çº§åˆ«ä¸­æœ€ä¸¥æ ¼çš„ï¼Œä½†æ˜¯è¿™æ ·åšåŠ¿å¿…å¯¹æ€§èƒ½é€ æˆå½±å“ã€‚æ‰€ä»¥åœ¨å®é™…çš„é€‰ç”¨ä¸Šï¼Œæˆ‘ä»¬è¦æ ¹æ®å½“å‰å…·ä½“çš„æƒ…å†µé€‰ç”¨åˆé€‚çš„ã€‚</p></blockquote></li></ul><h3 id="DDL-VS-DML"><a href="#DDL-VS-DML" class="headerlink" title="DDL VS DML"></a>DDL VS DML</h3><p>DML statements are SQL statements that manipulate data. DML stands for Data Manipulation Language. The SQL statements that are in the DML class are INSERT, UPDATE and DELETE. Some people also lump the SELECT statement in the DML classification.</p><p>Data Definition Languages (DDL) are used to define the database structure. Any CREATE, DROP and ALTER commands are examples of DDL SQL statements.</p><h3 id="è®¾ç½®è¿œç¨‹ç™»å½•"><a href="#è®¾ç½®è¿œç¨‹ç™»å½•" class="headerlink" title="è®¾ç½®è¿œç¨‹ç™»å½•"></a>è®¾ç½®è¿œç¨‹ç™»å½•</h3><ul><li><p>mysql 8ç‰ˆæœ¬è®¾ç½®å¯ç”¨rootè¿œç¨‹è®¿é—®æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;password&#x27;;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></li></ul><h3 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h3><ul><li><p>å¯¼å‡ºæ•°æ®åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h127.0.0.1 -P3306 -uroot -p database &gt; file.sql</span><br><span class="line">å…¶ä¸­ -hå’Œ-På¯ä»¥çœç•¥ï¼ˆä¸è¿‡mysqlåœ¨dockerä¸­ä¸å¯ä»¥çœç•¥ï¼‰,databaseæ˜¯æ•°æ®åº“åç§°</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å‡ºæ•°æ®è¡¨æ•°æ®ï¼ˆæ ¹æ®sqlçš„whereæ¡ä»¶ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p database --tables tablename --where=&quot;id&gt;8&quot; &gt; result.sql </span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œsqlæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">source</span> /path/to/files/file.sql</span></span><br></pre></td></tr></table></figure></li><li><p>å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p --all-databases &gt; backup_filename.sql</span><br></pre></td></tr></table></figure></li><li><p>åªå¯¼å‡ºå»ºè¡¨è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>u your_username <span class="operator">-</span>p <span class="comment">--no-data your_database &gt; backup.sql</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="æ–°å¢ä¸»é”®"><a href="#æ–°å¢ä¸»é”®" class="headerlink" title="æ–°å¢ä¸»é”®"></a>æ–°å¢ä¸»é”®</h3><p>suppose you donâ€™t have column for auto increment like id, no, then you can add using following query:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> id <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">primary</span> key <span class="keyword">FIRST</span></span><br></pre></td></tr></table></figure><p>If youâ€™ve column, then alter to auto increment using following query:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name MODIFY column_name datatype(length) AUTO_INCREMENT <span class="keyword">PRIMARY</span></span><br></pre></td></tr></table></figure><h1 id="mysqlæ•°æ®å¤‡ä»½"><a href="#mysqlæ•°æ®å¤‡ä»½" class="headerlink" title="mysqlæ•°æ®å¤‡ä»½"></a>mysqlæ•°æ®å¤‡ä»½</h1><h2 id="æ–¹æ¡ˆä¸€ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“æ•°æ®æ–‡ä»¶"><a href="#æ–¹æ¡ˆä¸€ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“æ•°æ®æ–‡ä»¶" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“æ•°æ®æ–‡ä»¶"></a>æ–¹æ¡ˆä¸€ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“æ•°æ®æ–‡ä»¶</h2><h3 id="ä¸€ã€ç¼–å†™shellè„šæœ¬"><a href="#ä¸€ã€ç¼–å†™shellè„šæœ¬" class="headerlink" title="ä¸€ã€ç¼–å†™shellè„šæœ¬"></a>ä¸€ã€ç¼–å†™shellè„šæœ¬</h3><p>è„šæœ¬æ–‡ä»¶<strong>backup_mysql.sh</strong>ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç”¨æˆ·å</span></span><br><span class="line">username=root</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯†ç </span></span><br><span class="line">password=å¡«å†™å¯†ç </span><br><span class="line"><span class="meta">#</span><span class="bash">å°†è¦å¤‡ä»½çš„æ•°æ®åº“</span></span><br><span class="line">database_name=å¡«å†™éœ€è¦å¤‡ä»½çš„æ•°æ®åº“</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿å­˜å¤‡ä»½æ–‡ä»¶æœ€å¤šä¸ªæ•°</span></span><br><span class="line">count=30</span><br><span class="line"><span class="meta">#</span><span class="bash">å¤‡ä»½ä¿å­˜è·¯å¾„</span></span><br><span class="line">backup_path=/data/mysql_backup</span><br><span class="line"><span class="meta">#</span><span class="bash">æ—¥æœŸ</span></span><br><span class="line">date_time=`date +%Y-%m-%d-%H-%M`</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">if [ ! -d $backup_path ]; </span><br><span class="line">then     </span><br><span class="line">    mkdir -p $backup_path; </span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="bash">å¼€å§‹å¤‡ä»½</span></span><br><span class="line">mysqldump -u $username -p$password $database_name &gt; $backup_path/$database_name-$date_time.sql</span><br><span class="line"><span class="meta">#</span><span class="bash">å¼€å§‹å‹ç¼©</span></span><br><span class="line">cd $backup_path</span><br><span class="line">tar -zcvf $database_name-$date_time.tar.gz $database_name-$date_time.sql</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤æºæ–‡ä»¶</span></span><br><span class="line">rm -rf $backup_path/$database_name-$date_time.sql</span><br><span class="line"><span class="meta">#</span><span class="bash">æ›´æ–°å¤‡ä»½æ—¥å¿—</span></span><br><span class="line">echo &quot;create $backup_path/$database_name-$date_time.tar.gz&quot; &gt;&gt; $backup_path/dump.log</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">æ‰¾å‡ºéœ€è¦åˆ é™¤çš„å¤‡ä»½</span></span><br><span class="line">delfile=`ls -l -crt $backup_path/*.tar.gz | awk &#x27;&#123;print $9 &#125;&#x27; | head -1`</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ¤æ–­ç°åœ¨çš„å¤‡ä»½æ•°é‡æ˜¯å¦å¤§äºé˜ˆå€¼</span></span><br><span class="line">number=`ls -l -crt  $backup_path/*.tar.gz | awk &#x27;&#123;print $9 &#125;&#x27; | wc -l`</span><br><span class="line"></span><br><span class="line">if [ $number -gt $count ]</span><br><span class="line">then</span><br><span class="line"><span class="meta">  #</span><span class="bash">åˆ é™¤æœ€æ—©ç”Ÿæˆçš„å¤‡ä»½ï¼Œåªä¿ç•™countæ•°é‡çš„å¤‡ä»½</span></span><br><span class="line">  rm $delfile</span><br><span class="line"><span class="meta">  #</span><span class="bash">æ›´æ–°åˆ é™¤æ–‡ä»¶æ—¥å¿—</span></span><br><span class="line">  echo &quot;delete $delfile&quot; &gt;&gt; $backup_path/dump.log</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>è¯¥è„šæœ¬å®ç°çš„åŠŸèƒ½ï¼šå¤‡ä»½æŒ‡å®šæ•°æ®åº“çš„æ•°æ®ä¿¡æ¯åˆ°æŒ‡å®šç›®å½•ï¼Œå¹¶åªä¿å­˜æŒ‡å®šæ•°é‡çš„æœ€æ–°æ–‡ä»¶ã€‚</p><p>æ³¨æ„ï¼šè„šæœ¬ä¸­éœ€è¦è¡¥å…¨è„šæœ¬ä¸­çš„<strong>password</strong>å’Œ<strong>database_name</strong>ä¿¡æ¯ï¼Œå¯ä¿®æ”¹å¤‡ä»½ä¿å­˜è·¯å¾„<strong>backup_path</strong>ï¼Œä»¥åŠæœ€å¤šä¿å­˜çš„å¤‡ä»½æ–‡ä»¶æ•°é‡<strong>count</strong>ã€‚</p><p>ç¼–å†™å®Œè„šæœ¬ä¿¡æ¯ä¹‹åï¼Œéœ€è¦ç»™è„šæœ¬èµ‹äºˆå¯æ‰§è¡Œæƒé™ <code>chmod +x backup_mysql.sh</code></p><h3 id="äºŒã€è®¾å®šå®šæ—¶ä»»åŠ¡crontab"><a href="#äºŒã€è®¾å®šå®šæ—¶ä»»åŠ¡crontab" class="headerlink" title="äºŒã€è®¾å®šå®šæ—¶ä»»åŠ¡crontab"></a>äºŒã€è®¾å®šå®šæ—¶ä»»åŠ¡crontab</h3><p>è¿è¡Œcrontab -eå‘½ä»¤ï¼Œæ‰“å¼€ä¸€ä¸ªå¯ç¼–è¾‘çš„æ–‡æœ¬ï¼Œè¾“å…¥<code>0 1 * * * /path/to/backup_mysql.sh</code>  ä¿æœ¬å¹¶é€€å‡ºå³æ·»åŠ å®Œæˆã€‚</p><p>æ³¨æ„ï¼šå…¶ä¸­<code>0 1 * * *</code>ï¼Œè¡¨ç¤ºæ¯å¤©å‡Œæ™¨1ç‚¹è¿›è¡Œå¤‡ä»½æ“ä½œï¼Œå¯è‡ªè¡Œä¿®æ”¹1çš„å€¼ï¼ˆèŒƒå›´0ï½23ï¼‰</p><p>å…¶ä¸­è·¯å¾„ä¿¡æ¯<code>/path/to/backup_mysql.sh</code>éœ€è¦ä¿®æ”¹ä¸ºå®é™…çš„è„šæœ¬è·¯å¾„ã€‚</p><h2 id="æ–¹æ¡ˆäºŒï¼šåŒä¸»æœºHAéƒ¨ç½²"><a href="#æ–¹æ¡ˆäºŒï¼šåŒä¸»æœºHAéƒ¨ç½²" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šåŒä¸»æœºHAéƒ¨ç½²"></a>æ–¹æ¡ˆäºŒï¼šåŒä¸»æœºHAéƒ¨ç½²</h2><p><strong>å‰æ</strong>ï¼šå‡†å¤‡ä¸¤ä¸ªæœºå™¨master1ï¼ˆ172.20.3.113ï¼‰å’Œmaster2ï¼ˆ172.20.3.114ï¼‰ï¼Œä¸”åˆ†åˆ«å®‰è£…äº†mysqlï¼Œå…¶ä¸­IPåœ°å€æ ¹æ®ç”Ÿäº§å…·ä½“ipè¿›è¡Œæ›¿æ¢</p><h3 id="ä¸€ã€é…ç½®my-cnfä¿¡æ¯"><a href="#ä¸€ã€é…ç½®my-cnfä¿¡æ¯" class="headerlink" title="ä¸€ã€é…ç½®my.cnfä¿¡æ¯"></a>ä¸€ã€é…ç½®my.cnfä¿¡æ¯</h3><ul><li><p>é…ç½®/etc/my.cnfæ–‡ä»¶ï¼ˆä»mysql5.7å¼€å§‹ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆmy.cnfæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼‰my.cnfæ–‡ä»¶å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8         #è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†</span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306  #å¯è‡ªè¡Œæ›´æ”¹ç«¯å£</span><br><span class="line">basedir=/usr/local/mysql</span><br><span class="line">datadir=/usr/local/mysql/data</span><br><span class="line">max_connections = 500              #æœ€å¤§è¿æ¥æ•°</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id = 1                            #æœºå™¨1è®¾ç½®ä¸º1ï¼Œæœºå™¨2è®¾ç½®ä¸º2</span><br><span class="line">binlog_format=ROW</span><br><span class="line">auto-increment-increment = 2            #å­—æ®µå˜åŒ–å¢é‡å€¼</span><br><span class="line">auto-increment-offset = 1               #æœºå™¨1è®¾ç½®ä¸º1ï¼Œæœºå™¨2è®¾ç½®ä¸º2</span><br><span class="line">slave-skip-errors = all                 #å¿½ç•¥æ‰€æœ‰å¤åˆ¶äº§ç”Ÿçš„é”™è¯¯</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce-gtid-consistency=ON</span><br><span class="line"></span><br><span class="line">character-set-server = utf8</span><br><span class="line">default-storage-engine = INNODB</span><br><span class="line">lower_case_table_names = 1</span><br></pre></td></tr></table></figure><ul><li><p>[mysql]ä»£è¡¨æˆ‘ä»¬ä½¿ç”¨mysqlå‘½ä»¤ç™»å½•mysqlæ•°æ®åº“æ—¶çš„é»˜è®¤è®¾ç½® </p></li><li><p>[mysqld]ä»£è¡¨æ•°æ®åº“è‡ªèº«çš„é»˜è®¤è®¾ç½®</p><blockquote><p>æ³¨æ„ï¼šæœºå™¨1å’Œæœºå™¨2åªæœ‰server-idä¸åŒå’Œauto-increment-offsetä¸åŒ,å…¶ä»–å¿…é¡»ç›¸åŒã€‚</p><p>éƒ¨åˆ†é…ç½®é¡¹è§£é‡Šå¦‚ä¸‹ï¼š</p><p>binlog_format= ROWï¼šæŒ‡å®šmysqlçš„binlogæ—¥å¿—çš„æ ¼å¼ï¼Œæ—¥å¿—ä¸­ä¼šè®°å½•æˆæ¯ä¸€è¡Œæ•°æ®è¢«ä¿®æ”¹çš„å½¢å¼ï¼Œç„¶ååœ¨ slave ç«¯å†å¯¹ç›¸åŒçš„æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚</p><p>auto-increment-increment= 2ï¼šè¡¨ç¤ºè‡ªå¢é•¿å­—æ®µæ¯æ¬¡é€’å¢çš„é‡ï¼Œå…¶é»˜è®¤å€¼æ˜¯1ã€‚å®ƒçš„å€¼åº”è®¾ä¸ºæ•´ä¸ªç»“æ„ä¸­æœåŠ¡å™¨çš„æ€»æ•°ï¼Œæœ¬æ¡ˆä¾‹ç”¨åˆ°ä¸¤å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥å€¼è®¾ä¸º2ã€‚</p><p>auto-increment-offset= 2ï¼šç”¨æ¥è®¾å®šæ•°æ®åº“ä¸­è‡ªåŠ¨å¢é•¿çš„èµ·ç‚¹(å³åˆå§‹å€¼)ï¼Œå› ä¸ºè¿™ä¸¤èƒ½æœåŠ¡å™¨éƒ½è®¾å®šäº†ä¸€æ¬¡è‡ªåŠ¨å¢é•¿å€¼2ï¼Œæ‰€ä»¥å®ƒä»¬çš„èµ·ç‚¹å¿…é¡»å¾—ä¸åŒï¼Œè¿™æ ·æ‰èƒ½é¿å…ä¸¤å°æœåŠ¡å™¨æ•°æ®åŒæ­¥æ—¶å‡ºç°ä¸»é”®å†²çªã€‚</p><p>æ³¨ï¼šå¦å¤–è¿˜å¯ä»¥åœ¨my.cnfé…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ â€œbinlog_do_db=æ•°æ®åº“åâ€é…ç½®é¡¹ï¼ˆå¯ä»¥æ·»åŠ å¤šä¸ªï¼‰æ¥æŒ‡å®šè¦åŒæ­¥çš„æ•°æ®åº“ã€‚å¦‚æœé…ç½®äº†è¿™ä¸ªé…ç½®é¡¹ï¼Œå¦‚æœæ²¡æ·»åŠ åœ¨è¯¥é…ç½®é¡¹åé¢çš„æ•°æ®åº“ï¼Œåˆ™binlogä¸è®°å½•å®ƒçš„äº‹ä»¶ã€‚</p></blockquote></li></ul></li><li><p>åˆ‡æ¢åˆ°datacanvasç”¨æˆ·è¿›è¡Œmysqlå¯åŠ¨æœåŠ¡ ï¼ˆå»ºè®®ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨å·²ç»åˆ›å»ºè½¯è¿æ¥çš„å‰æä¸‹ï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œå¹¶å¯åŠ¨mysqlæœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯ç™»å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysql -uroot -p</span><br></pre></td></tr></table></figure><p>  è®¾ç½®å¯è¿œç¨‹ç™»å½•rootç”¨æˆ·</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä¸Šé¢çš„å¯†ç â€™123456â€™ä¿®æ”¹æˆçœŸå®çš„rootå¯†ç </p></blockquote></li></ul><h4 id="å¼€å§‹è®¾ç½®åŒä¸»å¤‡ä»½"><a href="#å¼€å§‹è®¾ç½®åŒä¸»å¤‡ä»½" class="headerlink" title="å¼€å§‹è®¾ç½®åŒä¸»å¤‡ä»½"></a>å¼€å§‹è®¾ç½®åŒä¸»å¤‡ä»½</h4><ul><li><p>åœ¨master1ä¸Šæ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å…ˆåœ¨master2ä¸Šæ‰§è¡Œï¼Œ</span><br><span class="line"><span class="keyword">show</span> master status;ï¼ˆè·å–master_log_fileå’Œmaster_log_posä¿¡æ¯ï¼‰</span><br><span class="line"></span><br><span class="line">åœ¨master1ä¸Šæ‰§è¡Œ</span><br><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;172.20.3.114&#x27;</span>,master_port<span class="operator">=</span><span class="number">3306</span>,master_user<span class="operator">=</span><span class="string">&#x27;rt&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;rt123&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000003&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">194</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> slave;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> slave status\G</span><br></pre></td></tr></table></figure></li><li><p>åœ¨master2ä¸Šæ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å…ˆåœ¨master1ä¸Šæ‰§è¡Œï¼Œ</span><br><span class="line"><span class="keyword">show</span> master status;ï¼ˆè·å–master_log_fileå’Œmaster_log_posä¿¡æ¯ï¼‰</span><br><span class="line">åœ¨master2ä¸Šæ‰§è¡Œ</span><br><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;172.20.3.113&#x27;</span>,master_port<span class="operator">=</span><span class="number">3306</span>,master_user<span class="operator">=</span><span class="string">&#x27;rt&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;rt123&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000004&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">194</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> slave;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> slave status\G</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="äºŒã€keepalivedå®‰è£…é…ç½®"><a href="#äºŒã€keepalivedå®‰è£…é…ç½®" class="headerlink" title="äºŒã€keepalivedå®‰è£…é…ç½®"></a>äºŒã€keepalivedå®‰è£…é…ç½®</h3><p>éœ€è¦åœ¨master1å’Œmaster2çš„æœºå™¨ä¸Šå®‰è£…keepalivedæœåŠ¡ï¼Œå®‰è£…è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li><p>é€šè¿‡åœ°å€<a href="https://pkgs.org/download/keepalived%E4%B8%8B%E8%BD%BD%E7%9B%B8%E5%BA%94%E7%9A%84%E5%AE%89%E8%A3%85%E7%89%88%E6%9C%AC%EF%BC%8C%E7%84%B6%E5%90%8E%E8%A7%A3%E5%8E%8B%E7%9A%84%E7%9B%B8%E5%85%B3%E7%9B%AE%E5%BD%95%E3%80%82">https://pkgs.org/download/keepalivedä¸‹è½½ç›¸åº”çš„å®‰è£…ç‰ˆæœ¬ï¼Œç„¶åè§£å‹çš„ç›¸å…³ç›®å½•ã€‚</a></p></li><li><p>æºç çš„å®‰è£…ä¸€èˆ¬ç”±3ä¸ªæ­¥éª¤ç»„æˆï¼šé…ç½®ï¼ˆconfigureï¼‰ã€ç¼–è¯‘ï¼ˆmakeï¼‰ã€å®‰è£…( make installï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/keepalived</span><br></pre></td></tr></table></figure><p> å¦‚æœæç¤ºé”™è¯¯ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configure: error: </span><br><span class="line">  !!! OpenSSL is not properly installed on your system. !!!</span><br><span class="line">  !!! Can not include OpenSSL headers files.            !!!</span><br></pre></td></tr></table></figure><p>éœ€è¦å®‰è£…yum install openssl openssl-develï¼ˆRedHatç³»ç»Ÿï¼‰ï¼Œ<br>å†æ¬¡æ‰§è¡Œ./configure â€“prefix=/usr/local/keepalived</p></li><li><p>åœ¨å®‰è£…ç›®å½•æ‰§è¡Œ<code>make &amp;&amp; make install</code>è¿›è¡Œç¼–è¯‘å®‰è£…</p></li><li><p>keepalivedé…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹keepalivedå¯åŠ¨æ—¶ä¼šå»/etc/keepalivedç›®å½•ä¸‹åŠ è½½é…ç½®æ–‡ä»¶keepalived.conf</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File forkeepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">notification_email &#123;</span><br><span class="line">[email protected]</span><br><span class="line"> &#125;</span><br><span class="line">notification_email_from  [email protected]</span><br><span class="line">smtp_server 127.0.0.1</span><br><span class="line">smtp_connect_timeout 30</span><br><span class="line">router_id MYSQL_HA      #æ ‡è¯†ï¼ŒåŒä¸»ç›¸åŒ</span><br><span class="line"> &#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line"> state BACKUP           #ä¸¤å°éƒ½è®¾ç½®BACKUP</span><br><span class="line"> interface eth0         #ç½‘å¡åç§°</span><br><span class="line"> virtual_router_id 51       #ä¸»å¤‡ç›¸åŒ</span><br><span class="line"> priority 100   #ä¼˜å…ˆçº§ï¼Œå¦ä¸€å°æ”¹ä¸º90    </span><br><span class="line"> advert_int 1    </span><br><span class="line"> nopreempt  #ä¸æŠ¢å ï¼Œåªåœ¨ä¼˜å…ˆçº§é«˜çš„æœºå™¨ä¸Šè®¾ç½®å³å¯ï¼Œä¼˜å…ˆçº§ä½çš„æœºå™¨ä¸è®¾ç½®    </span><br><span class="line"> authentication &#123;</span><br><span class="line"> auth_type PASS    #é‰´æƒï¼Œé»˜è®¤é€šè¿‡</span><br><span class="line"> auth_pass 1111    # é‰´æƒè®¿é—®å¯†ç </span><br><span class="line"> &#125;</span><br><span class="line"> virtual_ipaddress &#123;</span><br><span class="line">  172.20.3.200    #è™šæ‹Ÿip</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 172.20.3.200 3306 &#123;    </span><br><span class="line">     delay_loop 2   #æ¯ä¸ª2ç§’æ£€æŸ¥ä¸€æ¬¡real_serverçŠ¶æ€    </span><br><span class="line">     lb_algo wrr   #LVSç®—æ³•    </span><br><span class="line">     lb_kind DR    #LVSæ¨¡å¼    </span><br><span class="line">     persistence_timeout 60   #ä¼šè¯ä¿æŒæ—¶é—´    </span><br><span class="line">     protocol TCP    </span><br><span class="line">     real_server 172.20.3.113 3306 &#123;    </span><br><span class="line">         weight 1    #æŒ‡å®šäº†å½“å‰ä¸»æœºçš„æƒé‡    </span><br><span class="line">         notify_down /usr/local/keepalived/kill_keepalived.sh  #æ£€æµ‹åˆ°æœåŠ¡downåæ‰§è¡Œçš„è„šæœ¬    </span><br><span class="line">         TCP_CHECK &#123;    </span><br><span class="line">             connect_timeout 10    #è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">             delay_before_retry 3   #é‡è¿é—´éš”æ—¶é—´    </span><br><span class="line">             connect_port 3306   #å¥åº·æ£€æŸ¥ç«¯å£  </span><br><span class="line">         &#125;  </span><br><span class="line">     &#125;</span><br><span class="line">     real_server 172.20.3.114 3306 &#123;</span><br><span class="line">        weight 2</span><br><span class="line">        notify_down /usr/local/keepalived/kill_keepalived.sh  #æ£€æµ‹åˆ°æœåŠ¡downåæ‰§è¡Œçš„è„šæœ¬</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 3306</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå‚æ•°priorityä¸¤ä¸ªæœåŠ¡å™¨é…ç½®ä¸åŒï¼Œå…¶ä¸­virtual_ipaddressæ˜¯è™šæ‹Ÿipï¼Œä¹‹åé¡¹ç›®å¯é€šè¿‡è®¿é—® 172.20.3.200:3306è¿›è¡Œè®¿é—®åŒä¸»mysqlæœºç¾¤ã€‚</p><p>ä¸Šè¿°é…ç½®ä¸­ä¼šæ¶‰åŠ/usr/local/keepalived/kill_keepalived.shï¼Œåˆ†åˆ«åœ¨ä¸¤å°æœåŠ¡å™¨ä¸Šç¼–å†™kill_keepalived.shè„šæœ¬å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">pkill keepalived</span><br></pre></td></tr></table></figure><p>   ç„¶åç»™è„šæœ¬åŠ æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/local/keepalived/kill_keepalived.sh</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨keepalivedæœåŠ¡<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service keepalived start</span><br></pre></td></tr></table></figure>å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œå°è¯•è¾“å…¥<code>pkill -9 keepalived</code>ï¼Œç„¶åå†å°è¯•é‡å¯</li></ul><hr><h3 id="ä¸‰ã€è®¿é—®åŒä¸»mysqlé›†ç¾¤"><a href="#ä¸‰ã€è®¿é—®åŒä¸»mysqlé›†ç¾¤" class="headerlink" title="ä¸‰ã€è®¿é—®åŒä¸»mysqlé›†ç¾¤"></a>ä¸‰ã€è®¿é—®åŒä¸»mysqlé›†ç¾¤</h3><p>ä¸¤å°æœºå™¨çš„mysqlå’Œkeepalivedé…ç½®å®Œæˆä¹‹åï¼Œå³å¯åœ¨é¡¹ç›®ä¸­ï¼Œé€šè¿‡è®¿é—®è™šæ‹Ÿipåœ°å€ï¼ˆ172.20.3.200:3306ï¼‰è¿›è¡Œmysqlé›†ç¾¤çš„è®¿é—®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flink sql</title>
      <link href="/2022/01/04/flink%20sql/"/>
      <url>/2022/01/04/flink%20sql/</url>
      
        <content type="html"><![CDATA[<h1 id="table-vs-view"><a href="#table-vs-view" class="headerlink" title="table vs view"></a>table vs view</h1><blockquote><p>Temporary tables are always stored in memory and only exist for the duration of the Flink session they are created within. These tables are not visible to other sessions. They are not bound to any catalog or database but can be created in the namespace of one. Temporary tables are not dropped if their corresponding database is removed.</p></blockquote><blockquote><p>Tables can be either virtual (VIEWS) or regular (TABLES). VIEWS can be created from an existing Table object, usually the result of a Table API or SQL query. TABLES describe external data, such as a file, database table, or message queue.</p></blockquote><h1 id="grammer"><a href="#grammer" class="headerlink" title="grammer"></a>grammer</h1><ul><li>NOT ENFORCED</li></ul><blockquote><p>If you know that the data conforms to these constraints, you can use the NOT ENFORCED capability to help achieve two goals:</p><ul><li>Improve performance, primarily in insert, update, and delete operations on the table</li><li>Reduce space requirements that are associated with enforcing a primary key or unique constraint</li></ul></blockquote><h1 id="data-type"><a href="#data-type" class="headerlink" title="data type"></a>data type</h1><h3 id="å­—ç¬¦ä¸²ç±»å‹ï¼š"><a href="#å­—ç¬¦ä¸²ç±»å‹ï¼š" class="headerlink" title="å­—ç¬¦ä¸²ç±»å‹ï¼š"></a>å­—ç¬¦ä¸²ç±»å‹ï¼š</h3><ul><li>â­ CHARã€CHAR(n)ï¼šå®šé•¿å­—ç¬¦ä¸²ï¼Œå°±å’Œ Java ä¸­çš„ Char ä¸€æ ·ï¼Œn ä»£è¡¨å­—ç¬¦çš„å®šé•¿ï¼Œå–å€¼èŒƒå›´ [1, 2,147,483,647]ã€‚å¦‚æœä¸æŒ‡å®š nï¼Œåˆ™é»˜è®¤ä¸º 1ã€‚</li><li>â­ VARCHARã€VARCHAR(n)ã€STRINGï¼šå¯å˜é•¿å­—ç¬¦ä¸²ï¼Œå°±å’Œ Java ä¸­çš„ String ä¸€æ ·ï¼Œn ä»£è¡¨å­—ç¬¦çš„æœ€å¤§é•¿åº¦ï¼Œå–å€¼èŒƒå›´ [1, 2,147,483,647]ã€‚å¦‚æœä¸æŒ‡å®š nï¼Œåˆ™é»˜è®¤ä¸º 1ã€‚STRING ç­‰åŒäº VARCHAR(2147483647)ã€‚</li></ul><h3 id="äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹ï¼š"><a href="#äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹ï¼š" class="headerlink" title="äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹ï¼š"></a>äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹ï¼š</h3><ul><li>â­ BINARYã€BINARY(n)ï¼šå®šé•¿äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œn ä»£è¡¨å®šé•¿ï¼Œå–å€¼èŒƒå›´ [1, 2,147,483,647]ã€‚å¦‚æœä¸æŒ‡å®š nï¼Œåˆ™é»˜è®¤ä¸º 1ã€‚</li><li>â­ VARBINARYã€VARBINARY(n)ã€BYTESï¼šå¯å˜é•¿äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œn ä»£è¡¨å­—ç¬¦çš„æœ€å¤§é•¿åº¦ï¼Œå–å€¼èŒƒå›´ [1, 2,147,483,647]ã€‚å¦‚æœä¸æŒ‡å®š nï¼Œåˆ™é»˜è®¤ä¸º 1ã€‚BYTES ç­‰åŒäº VARBINARY(2147483647)ã€‚</li></ul><h3 id="ç²¾ç¡®æ•°å€¼ç±»å‹ï¼š"><a href="#ç²¾ç¡®æ•°å€¼ç±»å‹ï¼š" class="headerlink" title="ç²¾ç¡®æ•°å€¼ç±»å‹ï¼š"></a>ç²¾ç¡®æ•°å€¼ç±»å‹ï¼š</h3><ul><li>â­ DECIMALã€DECIMAL(p)ã€DECIMAL(p, s)ã€DECã€DEC(p)ã€DEC(p, s)ã€NUMERICã€NUMERIC(p)ã€NUMERIC(p, s)ï¼šå›ºå®šé•¿åº¦å’Œç²¾åº¦çš„æ•°å€¼ç±»å‹ï¼Œå°±å’Œ Java ä¸­çš„ BigDecimal ä¸€æ ·ï¼Œp ä»£è¡¨æ•°å€¼ä½æ•°ï¼ˆé•¿åº¦ï¼‰ï¼Œå–å€¼èŒƒå›´ [1, 38]ï¼›s ä»£è¡¨å°æ•°ç‚¹åçš„ä½æ•°ï¼ˆç²¾åº¦ï¼‰ï¼Œå–å€¼èŒƒå›´ [0, p]ã€‚å¦‚æœä¸æŒ‡å®šï¼Œp é»˜è®¤ä¸º 10ï¼Œs é»˜è®¤ä¸º 0ã€‚</li><li>â­ TINYINTï¼š-128 åˆ° 127 çš„ 1 å­—èŠ‚å¤§å°çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œå°±å’Œ Java ä¸­çš„ byte ä¸€æ ·ã€‚</li><li>â­ SMALLINTï¼š-32,768 to 32,767 çš„ 2 å­—èŠ‚å¤§å°çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œå°±å’Œ Java ä¸­çš„ short ä¸€æ ·ã€‚</li><li>â­ INTã€INTEGERï¼š-2,147,483,648 to 2,147,483,647 çš„ 4 å­—èŠ‚å¤§å°çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œå°±å’Œ Java ä¸­çš„ int ä¸€æ ·ã€‚</li><li>â­ BIGINTï¼š-9,223,372,036,854,775,808 to 9,223,372,036,854,775,807 çš„ 8 å­—èŠ‚å¤§å°çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œå°±å’Œ Java ä¸­çš„ long ä¸€æ ·ã€‚</li></ul><h3 id="æœ‰æŸç²¾åº¦æ•°å€¼ç±»å‹ï¼š"><a href="#æœ‰æŸç²¾åº¦æ•°å€¼ç±»å‹ï¼š" class="headerlink" title="æœ‰æŸç²¾åº¦æ•°å€¼ç±»å‹ï¼š"></a>æœ‰æŸç²¾åº¦æ•°å€¼ç±»å‹ï¼š</h3><ul><li>â­ FLOATï¼š4 å­—èŠ‚å¤§å°çš„å•ç²¾åº¦æµ®ç‚¹æ•°å€¼ï¼Œå°±å’Œ Java ä¸­çš„ float ä¸€æ ·ã€‚</li><li>â­ DOUBLEã€DOUBLE PRECISIONï¼š8 å­—èŠ‚å¤§å°çš„åŒç²¾åº¦æµ®ç‚¹æ•°å€¼ï¼Œå°±å’Œ Java ä¸­çš„ double ä¸€æ ·ã€‚</li><li>â­ å…³äº FLOAT å’Œ DOUBLE çš„åŒºåˆ«å¯è§ <a href="https://www.runoob.com/w3cnote/float-and-double-different.html">https://www.runoob.com/w3cnote/float-and-double-different.html</a></li></ul><h3 id="æ—¥æœŸã€æ—¶é—´ç±»å‹ï¼š"><a href="#æ—¥æœŸã€æ—¶é—´ç±»å‹ï¼š" class="headerlink" title="æ—¥æœŸã€æ—¶é—´ç±»å‹ï¼š"></a>æ—¥æœŸã€æ—¶é—´ç±»å‹ï¼š</h3><ul><li><p>â­ DATEï¼šç”± <code>å¹´-æœˆ-æ—¥</code> ç»„æˆçš„ <code>ä¸å¸¦æ—¶åŒºå«ä¹‰</code> çš„æ—¥æœŸç±»å‹ï¼Œå–å€¼èŒƒå›´ [0000-01-01, 9999-12-31]</p></li><li><p>â­ TIMEã€TIME(p)ï¼šç”± <code>å°æ—¶ï¼šåˆ†é’Ÿï¼šç§’[.å°æ•°ç§’]</code> ç»„æˆçš„ <code>ä¸å¸¦æ—¶åŒºå«ä¹‰</code> çš„çš„æ—¶é—´çš„æ•°æ®ç±»å‹ï¼Œç²¾åº¦é«˜è¾¾çº³ç§’ï¼Œå–å€¼èŒƒå›´ [00:00:00.000000000åˆ°23:59:59.9999999]ã€‚å…¶ä¸­ p ä»£è¡¨å°æ•°ç§’çš„ä½æ•°ï¼Œå–å€¼èŒƒå›´ [0, 9]ï¼Œå¦‚æœä¸æŒ‡å®š pï¼Œé»˜è®¤ä¸º 0ã€‚</p></li><li><p>â­ TIMESTAMPã€TIMESTAMP(p)ã€TIMESTAMP WITHOUT TIME ZONEã€TIMESTAMP(p) WITHOUT TIME ZONEï¼šç”± <code>å¹´-æœˆ-æ—¥ å°æ—¶ï¼šåˆ†é’Ÿï¼šç§’[.å°æ•°ç§’]</code> ç»„æˆçš„ <code>ä¸å¸¦æ—¶åŒºå«ä¹‰</code> çš„æ—¶é—´ç±»å‹ï¼Œå–å€¼èŒƒå›´ [0000-01-01 00:00:00.000000000, 9999-12-31 23:59:59.999999999]ã€‚å…¶ä¸­ p ä»£è¡¨å°æ•°ç§’çš„ä½æ•°ï¼Œå–å€¼èŒƒå›´ [0, 9]ï¼Œå¦‚æœä¸æŒ‡å®š pï¼Œé»˜è®¤ä¸º 6ã€‚</p><p>Timestamp precision can range from 0 (seconds) to 9 (nanoseconds). The default precision is 6.</p></li><li><p>â­ TIMESTAMP WITH TIME ZONEã€TIMESTAMP(p) WITH TIME ZONEï¼šç”± <code>å¹´-æœˆ-æ—¥ å°æ—¶ï¼šåˆ†é’Ÿï¼šç§’[.å°æ•°ç§’] æ—¶åŒº</code> ç»„æˆçš„ <code>å¸¦æ—¶åŒºå«ä¹‰</code> çš„æ—¶é—´ç±»å‹ï¼Œå–å€¼èŒƒå›´ [0000-01-01 00:00:00.000000000 +14:59, 9999-12-31 23:59:59.999999999 -14:59]ã€‚å…¶ä¸­ p ä»£è¡¨å°æ•°ç§’çš„ä½æ•°ï¼Œå–å€¼èŒƒå›´ [0, 9]ï¼Œå¦‚æœä¸æŒ‡å®š pï¼Œé»˜è®¤ä¸º 6ã€‚</p></li><li><p>â­ TIMESTAMP_LTZã€TIMESTAMP_LTZ(p)ï¼šç”± <code>å¹´-æœˆ-æ—¥ å°æ—¶ï¼šåˆ†é’Ÿï¼šç§’[.å°æ•°ç§’] æ—¶åŒº</code> ç»„æˆçš„ <code>å¸¦æ—¶åŒºå«ä¹‰</code> çš„æ—¶é—´ç±»å‹ï¼Œå–å€¼èŒƒå›´ [0000-01-01 00:00:00.000000000 +14:59, 9999-12-31 23:59:59.999999999 -14:59]ã€‚å…¶ä¸­ p ä»£è¡¨å°æ•°ç§’çš„ä½æ•°ï¼Œå–å€¼èŒƒå›´ [0, 9]ï¼Œå¦‚æœä¸æŒ‡å®š pï¼Œé»˜è®¤ä¸º 6ã€‚</p></li><li><p>â­ TIMESTAMP_LTZ ä¸ TIMESTAMP WITH TIME ZONE çš„åŒºåˆ«åœ¨äºï¼šTIMESTAMP WITH TIME ZONE çš„æ—¶åŒºä¿¡æ¯æ˜¯æºå¸¦åœ¨æ•°æ®ä¸­çš„ï¼Œä¸¾ä¾‹ï¼šå…¶è¾“å…¥æ•°æ®åº”è¯¥æ˜¯ 2022-01-01 00:00:00.000000000 +08:00ï¼›TIMESTAMP_LTZ çš„æ—¶åŒºä¿¡æ¯ä¸æ˜¯æºå¸¦åœ¨æ•°æ®ä¸­çš„ï¼Œè€Œæ˜¯ç”± Flink SQL ä»»åŠ¡çš„å…¨å±€é…ç½®å†³å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”± <code>table.local-time-zone</code> å‚æ•°æ¥è®¾ç½®æ—¶åŒºã€‚</p></li><li><p>â­ INTERVAL YEAR TO MONTHã€ INTERVAL DAY TO SECONDï¼šinterval çš„æ¶‰åŠåˆ°çš„ç§ç±»æ¯”è¾ƒå¤šã€‚INTERVAL ä¸»è¦æ˜¯ç”¨äºç»™ TIMESTAMPã€TIMESTAMP_LTZ æ·»åŠ åç§»é‡çš„ã€‚ä¸¾ä¾‹ï¼Œæ¯”å¦‚ç»™ TIMESTAMP åŠ ã€å‡å‡ å¤©ã€å‡ ä¸ªæœˆã€å‡ å¹´ã€‚INTERVAL å­å¥æ€»å…±æ¶‰åŠåˆ°çš„è¯­æ³•ç§ç±»å¦‚ä¸‹ Flink SQL æ¡ˆä¾‹æ‰€ç¤ºã€‚</p></li></ul><p>â€‹    <strong>æ³¨æ„ï¼šä½†æ˜¯åœ¨ Flink SQL ä¸­ï¼Œæ— æ³•ç›´æ¥å»æ‰æ—¶é—´å­—æ®µçš„å°æ•°ç§’éƒ¨åˆ†è€Œä¿ç•™æ—¶é—´ç±»å‹ã€‚</strong></p><h3 id="å…¶å®ƒç±»å‹"><a href="#å…¶å®ƒç±»å‹" class="headerlink" title="å…¶å®ƒç±»å‹"></a>å…¶å®ƒç±»å‹</h3><ol><li>å¸ƒå°”ç±»å‹ï¼šBOOLEAN</li><li>â­ NULL ç±»å‹ï¼šNULL</li><li>â­ Raw ç±»å‹ï¼šRAW(â€˜classâ€™, â€˜snapshotâ€™) ã€‚åªä¼šåœ¨æ•°æ®å‘ç”Ÿç½‘ç»œä¼ è¾“æ—¶è¿›è¡Œåºåˆ—åŒ–ï¼Œååºåˆ—åŒ–æ“ä½œï¼Œå¯ä»¥ä¿ç•™å…¶åŸå§‹æ•°æ®ã€‚ä»¥ Java ä¸¾ä¾‹ï¼Œ<code>class</code> å‚æ•°ä»£è¡¨å…·ä½“å¯¹åº”çš„ Java ç±»å‹ï¼Œ<code>snapshot</code> ä»£è¡¨ç±»å‹åœ¨å‘ç”Ÿç½‘ç»œä¼ è¾“æ—¶çš„åºåˆ—åŒ–å™¨</li></ol><h1 id="æ—¶é—´å±æ€§"><a href="#æ—¶é—´å±æ€§" class="headerlink" title="æ—¶é—´å±æ€§"></a>æ—¶é—´å±æ€§</h1><blockquote><p> åƒçª—å£ï¼ˆåœ¨ <a href="https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/tableapi/#group-windows">Table API</a> å’Œ <a href="https://nightlies.apache.org/flink/flink-docs-master/zh/docs/dev/table/sql/queries/window-agg/">SQL</a> ï¼‰è¿™ç§åŸºäºæ—¶é—´çš„æ“ä½œï¼Œéœ€è¦æœ‰æ—¶é—´ä¿¡æ¯ã€‚å› æ­¤ï¼ŒTable API ä¸­çš„è¡¨å°±éœ€è¦æä¾›<em>é€»è¾‘æ—¶é—´å±æ€§</em>æ¥è¡¨ç¤ºæ—¶é—´ï¼Œä»¥åŠæ”¯æŒæ—¶é—´ç›¸å…³çš„æ“ä½œã€‚</p></blockquote><p>æ¯ç§ç±»å‹çš„è¡¨éƒ½å¯ä»¥æœ‰æ—¶é—´å±æ€§ï¼Œæ—¶é—´å±æ€§å¯ä»¥é€šè¿‡</p><ol><li>ç”¨CREATE TABLE DDLåˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®š</li><li>å¯ä»¥åœ¨ <code>DataStream</code> ä¸­æŒ‡å®š</li><li>å¯ä»¥åœ¨å®šä¹‰ <code>TableSource</code> æ—¶æŒ‡å®šã€‚</li></ol><p>ä¸€æ—¦æ—¶é—´å±æ€§å®šä¹‰å¥½ï¼Œå®ƒå°±å¯ä»¥åƒæ™®é€šåˆ—ä¸€æ ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨æ—¶é—´ç›¸å…³çš„æ“ä½œä¸­ä½¿ç”¨ï¼Œåªè¦æ—¶é—´å±æ€§æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œè€Œæ˜¯ç®€å•åœ°ä»ä¸€ä¸ªè¡¨ä¼ é€’åˆ°å¦ä¸€ä¸ªè¡¨ï¼Œå®ƒå°±ä»ç„¶æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ—¶é—´å±æ€§ã€‚</p><p>æ—¶é—´å±æ€§å¯ä»¥åƒæ™®é€šçš„æ—¶é—´æˆ³çš„åˆ—ä¸€æ ·è¢«ä½¿ç”¨å’Œè®¡ç®—ã€‚ä¸€æ—¦æ—¶é—´å±æ€§è¢«ç”¨åœ¨äº†è®¡ç®—ä¸­ï¼Œå®ƒå°±ä¼šè¢«ç‰©åŒ–ï¼Œè¿›è€Œå˜æˆä¸€ä¸ªæ™®é€šçš„æ—¶é—´æˆ³ã€‚æ™®é€šçš„æ—¶é—´æˆ³æ˜¯æ— æ³•è·Ÿ Flink çš„æ—¶é—´ä»¥åŠwatermarkç­‰ä¸€èµ·ä½¿ç”¨çš„ï¼Œæ‰€ä»¥æ™®é€šçš„æ—¶é—´æˆ³å°±æ— æ³•ç”¨åœ¨æ—¶é—´ç›¸å…³çš„æ“ä½œä¸­ï¼ˆè¿™å¥è¯æ˜¯åªé™äºè¢«ä¿®æ”¹çš„æ™®é€šæ—¶é—´æˆ³ï¼Œè¿˜æ˜¯åŒ…å«æœªè¢«ä¿®æ”¹çš„æ—¶é—´æˆ³ï¼‰ã€‚</p><h3 id="å¤„ç†æ—¶é—´"><a href="#å¤„ç†æ—¶é—´" class="headerlink" title="å¤„ç†æ—¶é—´"></a>å¤„ç†æ—¶é—´</h3><blockquote><p>å¤„ç†æ—¶é—´æ˜¯åŸºäºæœºå™¨çš„æœ¬åœ°æ—¶é—´æ¥å¤„ç†æ•°æ®ï¼Œå®ƒæ˜¯æœ€ç®€å•çš„ä¸€ç§æ—¶é—´æ¦‚å¿µï¼Œä½†æ˜¯å®ƒä¸èƒ½æä¾›ç¡®å®šæ€§ã€‚å®ƒæ—¢ä¸éœ€è¦ä»æ•°æ®é‡Œè·å–æ—¶é—´ï¼Œä¹Ÿä¸éœ€è¦ç”Ÿæˆ watermarkã€‚</p></blockquote><p>å®šä¹‰å¤„ç†æ—¶é—´çš„ä¸‰ç§æ–¹æ³•:</p><ol><li><p>åœ¨åˆ›å»ºè¡¨çš„ DDL ä¸­å®šä¹‰</p><blockquote><p>ç”¨ <code>PROCTIME()</code> å°±å¯ä»¥å®šä¹‰å¤„ç†æ—¶é—´ï¼Œå‡½æ•° <code>PROCTIME()</code> çš„è¿”å›ç±»å‹æ˜¯ TIMESTAMP_LTZ </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE TABLE <span class="title">user_actions</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  user_name STRING,</span></span></span><br><span class="line"><span class="params"><span class="function">  data STRING,</span></span></span><br><span class="line"><span class="params"><span class="function">  user_action_time AS PROCTIME()</span> -- å£°æ˜ä¸€ä¸ªé¢å¤–çš„åˆ—ä½œä¸ºå¤„ç†æ—¶é—´å±æ€§</span></span><br><span class="line"><span class="function">) <span class="title">WITH</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  ...</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ DataStream åˆ° Table è½¬æ¢æ—¶å®šä¹‰</p><blockquote><p>å¤„ç†æ—¶é—´å±æ€§å¯ä»¥åœ¨ schema å®šä¹‰çš„æ—¶å€™ç”¨ <code>.proctime</code> åç¼€æ¥å®šä¹‰ã€‚æ—¶é—´å±æ€§ä¸€å®šä¸èƒ½å®šä¹‰åœ¨ä¸€ä¸ªå·²æœ‰å­—æ®µä¸Šï¼Œæ‰€ä»¥å®ƒåªèƒ½å®šä¹‰åœ¨ schema å®šä¹‰çš„æœ€åã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Tuple2&lt;String, String&gt;&gt; stream = ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªé¢å¤–çš„å­—æ®µä½œä¸ºæ—¶é—´å±æ€§å­—æ®µ</span></span><br><span class="line">Table table = tEnv.fromDataStream(stream, $(<span class="string">&quot;user_name&quot;</span>), $(<span class="string">&quot;data&quot;</span>), $(<span class="string">&quot;user_action_time&quot;</span>).proctime());</span><br><span class="line"></span><br><span class="line">WindowedTable windowedTable = table.window(</span><br><span class="line">        Tumble.over(lit(<span class="number">10</span>).minutes())</span><br><span class="line">            .on($(<span class="string">&quot;user_action_time&quot;</span>))</span><br><span class="line">            .as(<span class="string">&quot;userActionWindow&quot;</span>));</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ TableSource å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªç”±å¤„ç†æ—¶é—´å±æ€§çš„ table source</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserActionSource</span> <span class="keyword">implements</span> <span class="title">StreamTableSource</span>&lt;<span class="title">Row</span>&gt;, <span class="title">DefinedProctimeAttribute</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TypeInformation&lt;Row&gt; <span class="title">getReturnType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String[] names = <span class="keyword">new</span> String[] &#123;<span class="string">&quot;user_name&quot;</span> , <span class="string">&quot;data&quot;</span>&#125;;</span><br><span class="line">        TypeInformation[] types = <span class="keyword">new</span> TypeInformation[] &#123;Types.STRING(), Types.STRING()&#125;;</span><br><span class="line">        <span class="keyword">return</span> Types.ROW(names, types);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataStream&lt;Row&gt; <span class="title">getDataStream</span><span class="params">(StreamExecutionEnvironment execEnv)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// create stream</span></span><br><span class="line">        DataStream&lt;Row&gt; stream = ...;</span><br><span class="line">        <span class="keyword">return</span> stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProctimeAttribute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªåå­—çš„åˆ—ä¼šè¢«è¿½åŠ åˆ°æœ€åï¼Œä½œä¸ºç¬¬ä¸‰åˆ—</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user_action_time&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// register table source</span></span><br><span class="line">tEnv.registerTableSource(<span class="string">&quot;user_actions&quot;</span>, <span class="keyword">new</span> UserActionSource());</span><br><span class="line"></span><br><span class="line">WindowedTable windowedTable = tEnv</span><br><span class="line">    .from(<span class="string">&quot;user_actions&quot;</span>)</span><br><span class="line">    .window(Tumble</span><br><span class="line">        .over(lit(<span class="number">10</span>).minutes())</span><br><span class="line">        .on($(<span class="string">&quot;user_action_time&quot;</span>))</span><br><span class="line">        .as(<span class="string">&quot;userActionWindow&quot;</span>));</span><br></pre></td></tr></table></figure></li></ol><h3 id="äº‹ä»¶æ—¶é—´"><a href="#äº‹ä»¶æ—¶é—´" class="headerlink" title="äº‹ä»¶æ—¶é—´"></a>äº‹ä»¶æ—¶é—´</h3><blockquote><p>äº‹ä»¶æ—¶é—´å…è®¸ç¨‹åºæŒ‰ç…§æ•°æ®ä¸­åŒ…å«çš„æ—¶é—´æ¥å¤„ç†ï¼Œè¿™æ ·å¯ä»¥åœ¨æœ‰ä¹±åºæˆ–è€…æ™šåˆ°çš„æ•°æ®çš„æƒ…å†µä¸‹äº§ç”Ÿä¸€è‡´çš„å¤„ç†ç»“æœã€‚ä¸ºäº†èƒ½å¤Ÿå¤„ç†ä¹±åºçš„äº‹ä»¶ï¼Œå¹¶ä¸”åŒºåˆ†æ­£å¸¸åˆ°è¾¾å’Œæ™šåˆ°çš„äº‹ä»¶ï¼ŒFlink éœ€è¦ä»äº‹ä»¶ä¸­è·å–äº‹ä»¶æ—¶é—´å¹¶ä¸”äº§ç”Ÿ <a href="https://nightlies.apache.org/flink/flink-docs-master/zh/docs/concepts/time/">watermarks</a>ã€‚</p></blockquote><p>å®šä¹‰äº‹ä»¶æ—¶é—´çš„ä¸‰ç§æ–¹æ³•:</p><ol><li><p>åœ¨ DDL ä¸­å®šä¹‰</p><blockquote><p>WATERMARK è¯­å¥åœ¨ä¸€ä¸ªå·²æœ‰å­—æ®µä¸Šå®šä¹‰ä¸€ä¸ª watermark ç”Ÿæˆè¡¨è¾¾å¼ï¼ŒåŒæ—¶æ ‡è®°è¿™ä¸ªå·²æœ‰å­—æ®µä¸ºæ—¶é—´å±æ€§å­—æ®µã€‚</p></blockquote><p>Flink æ”¯æŒå’Œåœ¨ TIMESTAMP åˆ—å’Œ TIMESTAMP_LTZ åˆ—ä¸Šå®šä¹‰äº‹ä»¶æ—¶é—´ã€‚</p><ul><li><p>å¦‚æœæºæ•°æ®ä¸­çš„æ—¶é—´æˆ³æ•°æ®è¡¨ç¤ºä¸ºå¹´-æœˆ-æ—¥-æ—¶-åˆ†-ç§’ï¼Œåˆ™é€šå¸¸ä¸ºä¸å¸¦æ—¶åŒºä¿¡æ¯çš„å­—ç¬¦ä¸²å€¼ï¼Œä¾‹å¦‚ <code>2020-04-15 20:13:40.564</code>ï¼Œå»ºè®®å°†äº‹ä»¶æ—¶é—´å±æ€§å®šä¹‰åœ¨ <code>TIMESTAMP</code> åˆ—ä¸Š,</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE TABLE <span class="title">user_actions</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  user_name STRING,</span></span></span><br><span class="line"><span class="params"><span class="function">  data STRING,</span></span></span><br><span class="line"><span class="params"><span class="function">  user_action_time TIMESTAMP(<span class="number">3</span>)</span>,</span></span><br><span class="line"><span class="function">  -- å£°æ˜ user_action_time æ˜¯äº‹ä»¶æ—¶é—´å±æ€§ï¼Œå¹¶ä¸”ç”¨ å»¶è¿Ÿ 5 ç§’çš„ç­–ç•¥æ¥ç”Ÿæˆ watermark</span></span><br><span class="line"><span class="function">  WATERMARK FOR user_action_time AS user_action_time - INTERVAL &#x27;5&#x27; SECOND</span></span><br><span class="line"><span class="function">) <span class="title">WITH</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  ...</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">SELECT <span class="title">TUMBLE_START</span><span class="params">(user_action_time, INTERVAL <span class="string">&#x27;10&#x27;</span> MINUTE)</span>, <span class="title">COUNT</span><span class="params">(DISTINCT user_name)</span></span></span><br><span class="line"><span class="function">FROM user_actions</span></span><br><span class="line"><span class="function">GROUP BY <span class="title">TUMBLE</span><span class="params">(user_action_time, INTERVAL <span class="string">&#x27;10&#x27;</span> MINUTE)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœæºæ•°æ®ä¸­çš„æ—¶é—´æˆ³æ•°æ®ä¸ºå¸¦æ—¶åŒºä¿¡æ¯çš„å­—ç¬¦ä¸²å€¼ï¼Œä¾‹å¦‚æºæ•°æ®ä¸­çš„æ—¶é—´æˆ³æ•°æ®è¡¨ç¤ºä¸ºä¸€ä¸ªçºªå…ƒ (epoch) æ—¶é—´ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª long å€¼ï¼Œä¾‹å¦‚ <code>1618989564564</code>ï¼Œå»ºè®®å°†äº‹ä»¶æ—¶é—´å±æ€§å®šä¹‰åœ¨ <code>TIMESTAMP_LTZ</code> åˆ—ä¸Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE TABLE <span class="title">user_actions</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"> user_name STRING,</span></span></span><br><span class="line"><span class="params"><span class="function"> data STRING,</span></span></span><br><span class="line"><span class="params"><span class="function"> ts BIGINT,</span></span></span><br><span class="line"><span class="params"><span class="function"> time_ltz AS TO_TIMESTAMP_LTZ(ts, <span class="number">3</span>)</span>,</span></span><br><span class="line"><span class="function"> -- declare time_ltz as event time attribute and use 5 seconds delayed watermark strategy</span></span><br><span class="line"><span class="function"> WATERMARK FOR time_ltz AS time_ltz - INTERVAL &#x27;5&#x27; SECOND</span></span><br><span class="line"><span class="function">) <span class="title">WITH</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"> ...</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">SELECT <span class="title">TUMBLE_START</span><span class="params">(time_ltz, INTERVAL <span class="string">&#x27;10&#x27;</span> MINUTE)</span>, <span class="title">COUNT</span><span class="params">(DISTINCT user_name)</span></span></span><br><span class="line"><span class="function">FROM user_actions</span></span><br><span class="line"><span class="function">GROUP BY <span class="title">TUMBLE</span><span class="params">(time_ltz, INTERVAL <span class="string">&#x27;10&#x27;</span> MINUTE)</span></span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åœ¨ DataStream åˆ° Table è½¬æ¢æ—¶å®šä¹‰</p><blockquote><p>äº‹ä»¶æ—¶é—´å±æ€§å¯ä»¥ç”¨ <code>.rowtime</code> åç¼€åœ¨å®šä¹‰ <code>DataStream</code> schema çš„æ—¶å€™æ¥å®šä¹‰ã€‚</p><p><a href="https://nightlies.apache.org/flink/flink-docs-master/zh/docs/concepts/time/">æ—¶é—´æˆ³å’Œ watermark</a> åœ¨è¿™ä¹‹å‰ä¸€å®šæ˜¯åœ¨ <code>DataStream</code> ä¸Šå·²ç»å®šä¹‰å¥½äº†ã€‚ åœ¨ä» DataStream è½¬æ¢åˆ° Table æ—¶ï¼Œç”±äº <code>DataStream</code> æ²¡æœ‰æ—¶åŒºæ¦‚å¿µï¼Œå› æ­¤ Flink æ€»æ˜¯å°† <code>rowtime</code> å±æ€§è§£ææˆ <code>TIMESTAMP WITHOUT TIME ZONE</code> ç±»å‹ï¼Œå¹¶ä¸”å°†æ‰€æœ‰äº‹ä»¶æ—¶é—´çš„å€¼éƒ½è§†ä¸º UTC æ—¶åŒºçš„å€¼ã€‚</p></blockquote><ul><li>Option 1</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºäº stream ä¸­çš„äº‹ä»¶äº§ç”Ÿæ—¶é—´æˆ³å’Œ watermark</span></span><br><span class="line">DataStream&lt;Tuple2&lt;String, String&gt;&gt; stream = inputStream.assignTimestampsAndWatermarks(...);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªé¢å¤–çš„é€»è¾‘å­—æ®µä½œä¸ºäº‹ä»¶æ—¶é—´å±æ€§</span></span><br><span class="line">Table table = tEnv.fromDataStream(stream, $(<span class="string">&quot;user_name&quot;</span>), $(<span class="string">&quot;data&quot;</span>), $(<span class="string">&quot;user_action_time&quot;</span>).rowtime());</span><br></pre></td></tr></table></figure><ul><li>Option 2</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// ä»ç¬¬ä¸€ä¸ªå­—æ®µè·å–äº‹ä»¶æ—¶é—´ï¼Œå¹¶ä¸”äº§ç”Ÿ watermark</span></span><br><span class="line">DataStream&lt;Tuple3&lt;Long, String, String&gt;&gt; stream = inputStream.assignTimestampsAndWatermarks(...);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå­—æ®µå·²ç»ç”¨ä½œäº‹ä»¶æ—¶é—´æŠ½å–äº†ï¼Œä¸ç”¨å†ç”¨ä¸€ä¸ªæ–°å­—æ®µæ¥è¡¨ç¤ºäº‹ä»¶æ—¶é—´äº†</span></span><br><span class="line">Table table = tEnv.fromDataStream(stream, $(<span class="string">&quot;user_action_time&quot;</span>).rowtime(), $(<span class="string">&quot;user_name&quot;</span>), $(<span class="string">&quot;data&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage:</span></span><br><span class="line"></span><br><span class="line">WindowedTable windowedTable = table.window(Tumble</span><br><span class="line">      .over(lit(<span class="number">10</span>).minutes())</span><br><span class="line">      .on($(<span class="string">&quot;user_action_time&quot;</span>))</span><br><span class="line">      .as(<span class="string">&quot;userActionWindow&quot;</span>));</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ TableSource å®šä¹‰</p><blockquote><p>äº‹ä»¶æ—¶é—´å±æ€§å¯ä»¥åœ¨å®ç°äº† <code>DefinedRowTimeAttributes</code> çš„ <code>TableSource</code> ä¸­å®šä¹‰ã€‚<code>getRowtimeAttributeDescriptors()</code> æ–¹æ³•è¿”å› <code>RowtimeAttributeDescriptor</code> çš„åˆ—è¡¨ï¼ŒåŒ…å«äº†æè¿°äº‹ä»¶æ—¶é—´å±æ€§çš„å­—æ®µåå­—ã€å¦‚ä½•è®¡ç®—äº‹ä»¶æ—¶é—´ã€ä»¥åŠ watermark ç”Ÿæˆç­–ç•¥ç­‰ä¿¡æ¯ã€‚</p><p>åŒæ—¶éœ€è¦ç¡®ä¿ <code>getDataStream</code> è¿”å›çš„ <code>DataStream</code> å·²ç»å®šä¹‰å¥½äº†æ—¶é—´å±æ€§ã€‚</p><p>åªæœ‰åœ¨å®šä¹‰äº† <code>StreamRecordTimestamp</code> æ—¶é—´æˆ³åˆ†é…å™¨çš„æ—¶å€™ï¼Œæ‰è®¤ä¸º <code>DataStream</code> æ˜¯æœ‰æ—¶é—´æˆ³ä¿¡æ¯çš„ã€‚ åªæœ‰å®šä¹‰äº† <code>PreserveWatermarks</code> watermark ç”Ÿæˆç­–ç•¥çš„ <code>DataStream</code> çš„ watermark æ‰ä¼šè¢«ä¿ç•™ã€‚åä¹‹ï¼Œåˆ™åªæœ‰æ—¶é—´å­—æ®µçš„å€¼æ˜¯ç”Ÿæ•ˆçš„ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªæœ‰äº‹ä»¶æ—¶é—´å±æ€§çš„ table source</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserActionSource</span> <span class="keyword">implements</span> <span class="title">StreamTableSource</span>&lt;<span class="title">Row</span>&gt;, <span class="title">DefinedRowtimeAttributes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TypeInformation&lt;Row&gt; <span class="title">getReturnType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String[] names = <span class="keyword">new</span> String[] &#123;<span class="string">&quot;user_name&quot;</span>, <span class="string">&quot;data&quot;</span>, <span class="string">&quot;user_action_time&quot;</span>&#125;;</span><br><span class="line">        TypeInformation[] types =</span><br><span class="line">            <span class="keyword">new</span> TypeInformation[] &#123;Types.STRING(), Types.STRING(), Types.LONG()&#125;;</span><br><span class="line">        <span class="keyword">return</span> Types.ROW(names, types);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataStream&lt;Row&gt; <span class="title">getDataStream</span><span class="params">(StreamExecutionEnvironment execEnv)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ„é€  DataStream</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// åŸºäº &quot;user_action_time&quot; å®šä¹‰ watermark</span></span><br><span class="line">        DataStream&lt;Row&gt; stream = inputStream.assignTimestampsAndWatermarks(...);</span><br><span class="line">        <span class="keyword">return</span> stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;RowtimeAttributeDescriptor&gt; <span class="title">getRowtimeAttributeDescriptors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ ‡è®° &quot;user_action_time&quot; å­—æ®µæ˜¯äº‹ä»¶æ—¶é—´å­—æ®µ</span></span><br><span class="line">        <span class="comment">// ç»™ &quot;user_action_time&quot; æ„é€ ä¸€ä¸ªæ—¶é—´å±æ€§æè¿°ç¬¦</span></span><br><span class="line">        RowtimeAttributeDescriptor rowtimeAttrDescr = <span class="keyword">new</span> RowtimeAttributeDescriptor(</span><br><span class="line">            <span class="string">&quot;user_action_time&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> ExistingField(<span class="string">&quot;user_action_time&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> AscendingTimestamps());</span><br><span class="line">        List&lt;RowtimeAttributeDescriptor&gt; listRowtimeAttrDescr = Collections.singletonList(rowtimeAttrDescr);</span><br><span class="line">        <span class="keyword">return</span> listRowtimeAttrDescr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// register the table source</span></span><br><span class="line">tEnv.registerTableSource(<span class="string">&quot;user_actions&quot;</span>, <span class="keyword">new</span> UserActionSource());</span><br><span class="line"></span><br><span class="line">WindowedTable windowedTable = tEnv</span><br><span class="line">    .from(<span class="string">&quot;user_actions&quot;</span>)</span><br><span class="line">    .window(Tumble.over(lit(<span class="number">10</span>).minutes()).on($(<span class="string">&quot;user_action_time&quot;</span>)).as(<span class="string">&quot;userActionWindow&quot;</span>));</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="format"><a href="#format" class="headerlink" title="format"></a>format</h3><ul><li><p>timestamp</p><p>å¯ä»¥å°†æ—¶é—´æˆ³ç±»å‹æ•°æ®æœ€é«˜ç²¾ç¡®å¾®ç§’(ç™¾ä¸‡åˆ†ä¹‹ä¸€ç§’)ï¼Œæ•°æ®ç±»å‹å®šä¹‰ä¸ºtimestamp(N),Nå–å€¼èŒƒå›´ä¸º0-6ï¼Œé»˜è®¤ä¸º0ï¼Œå¦‚éœ€è¦ç²¾ç¡®åˆ°æ¯«ç§’åˆ™è®¾ç½®ä¸ºTimestamp(3)ï¼Œå¦‚éœ€è¦ç²¾ç¡®åˆ°å¾®ç§’åˆ™è®¾ç½®ä¸ºtimestamp(6)ï¼Œæ•°æ®ç²¾åº¦æé«˜çš„ä»£ä»·æ˜¯å…¶å†…éƒ¨å­˜å‚¨ç©ºé—´çš„å˜å¤§ï¼Œä½†ä»æœªæ”¹å˜æ—¶é—´æˆ³ç±»å‹çš„æœ€å°å’Œæœ€å¤§å–å€¼èŒƒå›´ã€‚</p></li></ul><h3 id="connector-kafka"><a href="#connector-kafka" class="headerlink" title="connector kafka"></a>connector kafka</h3><h1 id="deduplication"><a href="#deduplication" class="headerlink" title="deduplication"></a>deduplication</h1><ul><li><p>è¯­æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [column_list]</span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line"></span><br><span class="line">   <span class="keyword">SELECT</span> [column_list],</span><br><span class="line"></span><br><span class="line">     <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> ([<span class="keyword">PARTITION</span> <span class="keyword">BY</span> col1[, col2...]]</span><br><span class="line"></span><br><span class="line">       <span class="keyword">ORDER</span> <span class="keyword">BY</span> col1 [<span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>][, col2 [<span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>]...]) <span class="keyword">AS</span> rownum</span><br><span class="line"></span><br><span class="line">   <span class="keyword">FROM</span> table_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> rownum <span class="operator">&lt;=</span> N [<span class="keyword">AND</span> conditions]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ROW_NUMBER()</td><td>è®¡ç®—è¡Œå·çš„OVERçª—å£å‡½æ•°ã€‚è¡Œå·ä»1å¼€å§‹è®¡ç®—ã€‚</td></tr><tr><td>PARTITION BY col1[, col2..]</td><td>å¯é€‰ã€‚æŒ‡å®šåˆ†åŒºçš„åˆ—ï¼Œå³å»é‡çš„KEYSã€‚</td></tr><tr><td>ORDER BY timeAttributeCol asc desc</td><td>æŒ‡å®šæ’åºçš„åˆ—ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªçš„å­—æ®µï¼ˆå³Proctimeæˆ–Rowtimeï¼‰ã€‚å¯ä»¥æŒ‡å®šé¡ºåºï¼ˆKeep FirstRowï¼‰æˆ–è€…å€’åº ï¼ˆKeep LastRowï¼‰ã€‚</td></tr><tr><td>rownum</td><td>å¤–å±‚æŸ¥è¯¢ä¸­å¯¹æ’åè¿›è¡Œè¿‡æ»¤ï¼Œåªå–å‰Næ¡</td></tr></tbody></table><ul><li>Deduplicate Keep FirstRowä¿ç•™é¦–è¡Œçš„å»é‡ç­–ç•¥ï¼šä¿ç•™KEYä¸‹ç¬¬ä¸€æ¡å‡ºç°çš„æ•°æ®ï¼Œä¹‹åå‡ºç°è¯¥KEYä¸‹çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒæ‰ã€‚å› ä¸ºSTATEä¸­åªå­˜å‚¨äº†KEYæ•°æ®ï¼Œæ‰€ä»¥æ€§èƒ½è¾ƒä¼˜ã€‚</li><li>Deduplicate Keep LastRowä¿ç•™æœ«è¡Œçš„å»é‡ç­–ç•¥ï¼šä¿ç•™KEYä¸‹æœ€åä¸€æ¡å‡ºç°çš„æ•°æ®ã€‚å› æ­¤è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå˜æ›´çš„è®°å½•ï¼Œä¼šå‘ä¸‹æ¸¸å‘é€å˜æ›´çš„æ¶ˆæ¯ã€‚å› æ­¤ï¼Œsinkè¡¨éœ€è¦æ”¯æŒretractæ“ä½œã€‚</li></ul></li></ul><p>åœ¨ Deduplication å…³äºæ˜¯å¦ä¼šå‡ºç°å›æ’¤æµ</p><ol><li>â­ Order by äº‹ä»¶æ—¶é—´ DESCï¼šä¼šå‡ºç°å›æ’¤æµï¼Œå› ä¸ºå½“å‰ key ä¸‹ <code>å¯èƒ½ä¼šæœ‰</code> æ¯”å½“å‰äº‹ä»¶æ—¶é—´è¿˜å¤§çš„æ•°æ®</li><li>â­ Order by äº‹ä»¶æ—¶é—´ ASCï¼šä¼šå‡ºç°å›æ’¤æµï¼Œå› ä¸ºå½“å‰ key ä¸‹ <code>å¯èƒ½ä¼šæœ‰</code> æ¯”å½“å‰äº‹ä»¶æ—¶é—´è¿˜å°çš„æ•°æ®</li><li>â­ Order by å¤„ç†æ—¶é—´ DESCï¼šä¼šå‡ºç°å›æ’¤æµï¼Œå› ä¸ºå½“å‰ key ä¸‹ <code>å¯èƒ½ä¼šæœ‰</code> æ¯”å½“å‰å¤„ç†æ—¶é—´è¿˜å¤§çš„æ•°æ®</li><li>â­ Order by å¤„ç†æ—¶é—´ ASCï¼šä¸ä¼šå‡ºç°å›æ’¤æµï¼Œå› ä¸ºå½“å‰ key ä¸‹ <code>ä¸å¯èƒ½ä¼šæœ‰</code> æ¯”å½“å‰å¤„ç†æ—¶é—´è¿˜å°çš„æ•°æ®</li></ol><hr><p>reference</p><p><a href="https://www.modb.pro/db/232004">https://www.modb.pro/db/232004</a></p><h1 id="join"><a href="#join" class="headerlink" title="join"></a>join</h1><blockquote><p>ä½¿ç”¨ SQL è¿›è¡Œæ•°æ®åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œjoin æ˜¯ç»å¸¸è¦ä½¿ç”¨çš„æ“ä½œã€‚</p><p>åœ¨ç¦»çº¿åœºæ™¯ä¸­ï¼Œjoin çš„æ•°æ®é›†æ˜¯æœ‰è¾¹ç•Œçš„ï¼Œå¯ä»¥ç¼“å­˜æ•°æ®æœ‰è¾¹ç•Œçš„æ•°æ®é›†è¿›è¡ŒæŸ¥è¯¢ï¼Œæœ‰Nested Loop/Hash Join/Sort Merge Join ç­‰å¤šè¡¨ joinï¼›</p><p>è€Œåœ¨å®æ—¶åœºæ™¯ä¸­ï¼Œjoin ä¸¤ä¾§çš„æ•°æ®éƒ½æ˜¯æ— è¾¹ç•Œçš„æ•°æ®æµï¼Œæ‰€ä»¥ç¼“å­˜æ•°æ®é›†å¯¹é•¿æ—¶é—´ job æ¥è¯´ï¼Œå­˜å‚¨å’ŒæŸ¥è¯¢å‹åŠ›å¾ˆå¤§ï¼Œå¦å¤–åŒæµçš„åˆ°è¾¾æ—¶é—´å¯èƒ½ä¸ä¸€è‡´ï¼Œé€ æˆ join è®¡ç®—ç»“æœå‡†ç¡®åº¦ä¸å¤Ÿï¼›å› æ­¤ï¼ŒFlink SQL æä¾›äº†å¤šç§ join æ–¹æ³•ï¼Œæ¥å¸®åŠ©ç”¨æˆ·åº”å¯¹å„ç§ join åœºæ™¯ã€‚</p></blockquote><h3 id="regular-join"><a href="#regular-join" class="headerlink" title="regular join"></a>regular join</h3><blockquote><p>regular join æ˜¯æœ€é€šç”¨çš„ join ç±»å‹ï¼Œä¸æ”¯æŒæ—¶é—´çª—å£ä»¥åŠæ—¶é—´å±æ€§ï¼Œä»»ä½•ä¸€ä¾§æ•°æ®æµæœ‰æ›´æ”¹éƒ½æ˜¯å¯è§çš„ï¼Œç›´æ¥å½±å“æ•´ä¸ª join ç»“æœã€‚å¦‚æœæœ‰ä¸€ä¾§æ•°æ®æµå¢åŠ ä¸€ä¸ªæ–°çºªå½•ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šæŠŠå¦ä¸€ä¾§çš„æ‰€æœ‰çš„è¿‡å»å’Œå°†æ¥çš„æ•°æ®åˆå¹¶åœ¨ä¸€èµ·ï¼Œå› ä¸º regular join æ²¡æœ‰å‰”é™¤ç­–ç•¥ï¼Œè¿™å°±å½±å“æœ€æ–°è¾“å‡ºçš„ç»“æœ; æ­£å› ä¸ºå†å²æ•°æ®ä¸ä¼šè¢«æ¸…ç†ï¼Œæ‰€ä»¥ regular join æ”¯æŒæ•°æ®æµçš„ä»»ä½•æ›´æ–°æ“ä½œã€‚</p><p>å¯¹äº regular join æ¥è¯´ï¼Œæ›´é€‚åˆç”¨äºç¦»çº¿åœºæ™¯å’Œå°æ•°æ®é‡åœºæ™¯ã€‚</p></blockquote><ul><li><p>è¯­æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> columns</span><br><span class="line"><span class="keyword">FROM</span> t1  [<span class="keyword">AS</span> <span class="operator">&lt;</span>alias1<span class="operator">&gt;</span>]</span><br><span class="line">[<span class="keyword">LEFT</span><span class="operator">/</span><span class="keyword">INNER</span><span class="operator">/</span><span class="keyword">FULL</span> <span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> t2</span><br><span class="line"><span class="keyword">ON</span> t1.column1 <span class="operator">=</span> t2.key<span class="operator">-</span>name1</span><br></pre></td></tr></table></figure></li></ul><h3 id="interval-join"><a href="#interval-join" class="headerlink" title="interval join"></a>interval join</h3><blockquote><p>ç›¸å¯¹äº regular joinï¼Œinterval Join åˆ™åˆ©ç”¨çª—å£çš„ç»™ä¸¤ä¸ªè¾“å…¥è¡¨è®¾å®šä¸€ä¸ª Join çš„æ—¶é—´ç•Œé™ï¼Œè¶…å‡ºæ—¶é—´èŒƒå›´çš„æ•°æ®åˆ™å¯¹ join ä¸å¯è§å¹¶å¯ä»¥è¢«æ¸…ç†æ‰ï¼Œè¿™æ ·å°±èƒ½ä¿®æ­£ regular join å› ä¸ºæ²¡æœ‰å‰”é™¤æ•°æ®ç­–ç•¥å¸¦æ¥ join ç»“æœçš„è¯¯å·®ä»¥åŠéœ€è¦å¤§é‡çš„èµ„æºã€‚</p><p>ä½†æ˜¯ä½¿ç”¨interval joinï¼Œéœ€è¦å®šä¹‰å¥½æ—¶é—´å±æ€§å­—æ®µï¼Œå¯ä»¥æ˜¯è®¡ç®—å‘ç”Ÿçš„ Processing Timeï¼Œä¹Ÿå¯ä»¥æ˜¯æ ¹æ®æ•°æ®æœ¬èº«æå–çš„ Event Timeï¼›å¦‚æœæ˜¯å®šä¹‰çš„æ˜¯ Processing Timeï¼Œåˆ™Flink æ¡†æ¶æœ¬èº«æ ¹æ®ç³»ç»Ÿåˆ’åˆ†çš„æ—¶é—´çª—å£å®šæ—¶æ¸…ç†æ•°æ®ï¼›å¦‚æœå®šä¹‰çš„æ˜¯ Event Timeï¼ŒFlink æ¡†æ¶åˆ†é… Event Time çª—å£å¹¶æ ¹æ®è®¾ç½®çš„ watermark æ¥æ¸…ç†æ•°æ®ã€‚</p></blockquote><ul><li><p>è¯­æ³•1</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> columns</span><br><span class="line"><span class="keyword">FROM</span> t1  [<span class="keyword">AS</span> <span class="operator">&lt;</span>alias1<span class="operator">&gt;</span>]</span><br><span class="line">[<span class="keyword">LEFT</span><span class="operator">/</span><span class="keyword">INNER</span><span class="operator">/</span><span class="keyword">FULL</span> <span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> t2</span><br><span class="line"><span class="keyword">ON</span> t1.column1 <span class="operator">=</span> t2.key<span class="operator">-</span>name1 <span class="keyword">AND</span> t1.timestamp <span class="keyword">BETWEEN</span> t2.timestamp  <span class="keyword">AND</span>  <span class="keyword">BETWEEN</span> t2.timestamp <span class="operator">+</span> <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="string">&#x27;10&#x27;</span> <span class="keyword">MINUTE</span>;</span><br></pre></td></tr></table></figure></li><li><p>è¯­æ³•2</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> columns</span><br><span class="line"><span class="keyword">FROM</span> t1  [<span class="keyword">AS</span> <span class="operator">&lt;</span>alias1<span class="operator">&gt;</span>]</span><br><span class="line">[<span class="keyword">LEFT</span><span class="operator">/</span><span class="keyword">INNER</span><span class="operator">/</span><span class="keyword">FULL</span> <span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> t2</span><br><span class="line"><span class="keyword">ON</span> t1.column1 <span class="operator">=</span> t2.key<span class="operator">-</span>name1 <span class="keyword">AND</span> t2.timestamp <span class="operator">&lt;=</span> t1.timestamp <span class="keyword">and</span> t1.timestamp <span class="operator">&lt;=</span>  t2.timestamp <span class="operator">+</span> <span class="operator">+</span> <span class="type">INTERVAL</span> â€™<span class="number">10</span><span class="string">&#x27; MINUTE ;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="temproal-table-join"><a href="#temproal-table-join" class="headerlink" title="temproal table join"></a>temproal table join</h3><blockquote><p>interval Join æä¾›äº†å‰”é™¤æ•°æ®çš„ç­–ç•¥ï¼Œè§£å†³èµ„æºé—®é¢˜ä»¥åŠè®¡ç®—æ›´åŠ å‡†ç¡®ï¼Œè¿™æ˜¯æœ‰ä¸ªå‰æï¼šjoin çš„ä¸¤ä¸ªæµéœ€è¦æ—¶é—´å±æ€§ï¼Œéœ€è¦æ˜ç¡®æ—¶é—´çš„ä¸‹ç•Œï¼Œæ¥æ–¹ä¾¿å‰”é™¤æ•°æ®ï¼›</p><p>æ˜¾ç„¶ï¼Œè¿™ç§åœºæ™¯ä¸é€‚åˆç»´åº¦è¡¨çš„ joinï¼Œå› ä¸ºç»´åº¦è¡¨æ²¡æœ‰æ—¶é—´ç•Œé™ï¼Œå¯¹äºè¿™ç§åœºæ™¯ï¼ŒFlink æä¾›äº† temproal table join æ¥è¦†ç›–æ­¤ç±»åœºæ™¯ã€‚</p><p>åœ¨ regular joinå’Œinterval joinä¸­ï¼Œjoin ä¸¤ä¾§çš„è¡¨æ˜¯å¹³ç­‰çš„ï¼Œä»»æ„çš„ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œéƒ½ä¼šå»å’Œå¦å¤–çš„å†å²çºªå½•è¿›è¡ŒåŒ¹é…ï¼Œtemproal table çš„æ›´æ–°å¯¹å¦ä¸€è¡¨åœ¨è¯¥æ—¶é—´èŠ‚ç‚¹ä»¥å‰çš„è®°å½•æ˜¯ä¸å¯è§çš„ã€‚</p></blockquote><ul><li><p>è¯­æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> columns</span><br><span class="line"><span class="keyword">FROM</span> t1  [<span class="keyword">AS</span> <span class="operator">&lt;</span>alias1<span class="operator">&gt;</span>]</span><br><span class="line">[<span class="keyword">LEFT</span>] <span class="keyword">JOIN</span> t2 <span class="keyword">FOR</span> <span class="built_in">SYSTEM_TIME</span> <span class="keyword">AS</span> <span class="keyword">OF</span> t1.proctime [<span class="keyword">AS</span> <span class="operator">&lt;</span>alias2<span class="operator">&gt;</span>]</span><br><span class="line"><span class="keyword">ON</span> t1.column1 <span class="operator">=</span> t2.key<span class="operator">-</span>name1</span><br></pre></td></tr></table></figure></li></ul><h3 id="lookup-join"><a href="#lookup-join" class="headerlink" title="lookup join"></a>lookup join</h3><ul><li>ç»´è¡¨å¿…é¡»æŒ‡å®šä¸»é”®ã€‚ç»´è¡¨JOINæ—¶ï¼ŒONçš„æ¡ä»¶å¿…é¡»åŒ…å«æ‰€æœ‰ä¸»é”®çš„ç­‰å€¼æ¡ä»¶</li></ul><hr><p>reference:</p><p><a href="https://developer.aliyun.com/article/780048?accounttraceid=dd5fdbf3eed04f6185ed6461d8a33012zihq">Flink SQL å®æˆ˜ï¼šåŒæµ join åœºæ™¯åº”ç”¨-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº</a></p><p><a href="https://www.liangzl.com/get-article-detail-114889.html">Flink SQL åŠŸèƒ½è§£å¯†ç³»åˆ— â€”â€” ç»´è¡¨ JOIN ä¸å¼‚æ­¥ä¼˜åŒ–</a></p><h1 id="watermark"><a href="#watermark" class="headerlink" title="watermark"></a>watermark</h1><p>Watermarkæ˜¯Apache Flinkä¸ºäº†å¤„ç†EventTime çª—å£è®¡ç®—æå‡ºçš„ä¸€ç§æœºåˆ¶,æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§æ—¶é—´æˆ³ã€‚</p><p>ç”±Apache Flink Sourceæˆ–è€…è‡ªå®šä¹‰çš„Watermarkç”Ÿæˆå™¨æŒ‰ç…§éœ€æ±‚Punctuatedæˆ–è€…Periodicä¸¤ç§æ–¹å¼ç”Ÿæˆçš„ä¸€ç§ç³»ç»ŸEventï¼Œä¸æ™®é€šæ•°æ®æµEventä¸€æ ·æµè½¬åˆ°å¯¹åº”çš„ä¸‹æ¸¸ç®—å­ï¼Œæ¥æ”¶åˆ°Watermark Eventçš„ç®—å­ä»¥æ­¤ä¸æ–­è°ƒæ•´è‡ªå·±ç®¡ç†çš„EventTime clockã€‚</p><p>Apache Flink æ¡†æ¶ä¿è¯Watermarkå•è°ƒé€’å¢ï¼Œç®—å­æ¥æ”¶åˆ°ä¸€ä¸ªWatermarkæ—¶å€™ï¼Œæ¡†æ¶çŸ¥é“ä¸ä¼šå†æœ‰ä»»ä½•å°äºè¯¥Watermarkçš„æ—¶é—´æˆ³çš„æ•°æ®å…ƒç´ åˆ°æ¥äº†ï¼Œæ‰€ä»¥Watermarkå¯ä»¥çœ‹åšæ˜¯å‘Šè¯‰Apache Flinkæ¡†æ¶æ•°æ®æµå·²ç»å¤„ç†åˆ°ä»€ä¹ˆä½ç½®(æ—¶é—´ç»´åº¦)çš„æ–¹å¼ã€‚</p><p>Watermarkçš„äº§ç”Ÿå’ŒApache Flinkå†…éƒ¨å¤„ç†é€»è¾‘å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="/images/flink/flink_watermark.png"></p><h3 id="äº§ç”Ÿæ–¹å¼"><a href="#äº§ç”Ÿæ–¹å¼" class="headerlink" title="äº§ç”Ÿæ–¹å¼"></a>äº§ç”Ÿæ–¹å¼</h3><ul><li><p>Punctuated - æ•°æ®æµä¸­æ¯ä¸€ä¸ªé€’å¢çš„EventTimeéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªWatermarkã€‚ åœ¨å®é™…çš„ç”Ÿäº§ä¸­Punctuatedæ–¹å¼åœ¨TPSå¾ˆé«˜çš„åœºæ™¯ä¸‹ä¼šäº§ç”Ÿå¤§é‡çš„Watermarkåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹ä¸‹æ¸¸ç®—å­é€ æˆå‹åŠ›ï¼Œæ‰€ä»¥åªæœ‰åœ¨å®æ—¶æ€§è¦æ±‚éå¸¸é«˜çš„åœºæ™¯æ‰ä¼šé€‰æ‹©Punctuatedçš„æ–¹å¼è¿›è¡ŒWatermarkçš„ç”Ÿæˆã€‚</p></li><li><p>Periodic - å‘¨æœŸæ€§çš„ï¼ˆä¸€å®šæ—¶é—´é—´éš”æˆ–è€…è¾¾åˆ°ä¸€å®šçš„è®°å½•æ¡æ•°ï¼‰äº§ç”Ÿä¸€ä¸ªWatermarkã€‚åœ¨å®é™…çš„ç”Ÿäº§ä¸­Periodicçš„æ–¹å¼å¿…é¡»ç»“åˆæ—¶é—´å’Œç§¯ç´¯æ¡æ•°ä¸¤ä¸ªç»´åº¦ç»§ç»­å‘¨æœŸæ€§äº§ç”ŸWatermarkï¼Œå¦åˆ™åœ¨æç«¯æƒ…å†µä¸‹ä¼šæœ‰å¾ˆå¤§çš„å»¶æ—¶ã€‚</p></li></ul><h1 id="upsert-kafka"><a href="#upsert-kafka" class="headerlink" title="upsert kafka"></a>upsert kafka</h1><p>The Kafka connector in Flink SQL can work in two streaming modes. </p><p><strong>Upsert mode</strong> allows us to get the latest value for a specific entity automatically without any manual deduplication. One of the typical scenarios where you can leverage this mode is a SQL join of two tables, where one of the tables is keeping history of changes per some entity id. Once you join on such an entity id which is non-unique by design, you get unwanted rows, but you usually want to see the latest value of that entity. With upsert mode, Flink automatically normalizes before the tables are joined. Eventually it allows you to easily answer typical business questions on getting a real-time view of the shared resources like cars, planes, workers, etc.</p><p><strong>Append mode</strong> is still an option to go with, if a business query does not need to filter out all historical events, but rather show the history of changes at the end. In this scenario, query may run faster with append mode, as Flink does not need to do any changelog normalization.</p><h2 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h2><ul><li><p>upsert-kafka å¯ä»¥é…åˆ checkpointä½¿ç”¨ï¼Œè¿™æ ·ä¸éœ€è¦å†ä»å¤´æ¶ˆè´¹ä¹‹å‰çš„æ•°æ®</p></li><li><p>å¦‚æœkafkaä¸­keyæ²¡æœ‰å€¼ï¼Œæ˜¯ä¸ç¬¦åˆupsert-kafkaçš„æ ¼å¼çš„ï¼Œflink sqlå¼•ç”¨æ­¤ç±»topicä¸ºupsert-kafkaï¼Œåˆ™ä¸ä¼šè§¦å‘è®¡ç®—</p></li></ul><h2 id="deduplication-1"><a href="#deduplication-1" class="headerlink" title="deduplication"></a>deduplication</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [column_list]</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> [column_list],</span><br><span class="line">     <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> ([<span class="keyword">PARTITION</span> <span class="keyword">BY</span> col1[, col2...]]</span><br><span class="line">       <span class="keyword">ORDER</span> <span class="keyword">BY</span> time_attr [<span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>]) <span class="keyword">AS</span> rownum</span><br><span class="line">   <span class="keyword">FROM</span> table_name)</span><br><span class="line"><span class="keyword">WHERE</span> rownum <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ åœ¨å†…åµŒçš„ selectè¯­å¥ä¸­ï¼Œå»ºè®®ä½¿ç”¨ column_list æŸ¥è¯¢æŒ‡å®šçš„å­—æ®µï¼Œä¸è¦ä½¿ç”¨ * ä»£æŒ‡æ‰€æœ‰æŒ‡æ ‡ã€‚å¦åˆ™æŸ¥è¯¢upsert-kafkaä¼šï¼Œä¸€ç›´ä»æœ€æ–°çš„è®°å½•è¯»å–ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> flink </category>
          
      </categories>
      
      
        <tags>
            
            <tag> point </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hive snippet</title>
      <link href="/2022/01/04/hive%20snippet/"/>
      <url>/2022/01/04/hive%20snippet/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Hive-siteé‡Œé¢çš„é…ç½®ï¼ï¼ï¼</p></blockquote><h2 id="level-1"><a href="#level-1" class="headerlink" title="level-1"></a>level-1</h2><h3 id="get-started"><a href="#get-started" class="headerlink" title="get started"></a>get started</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nohup hive --service metastore &amp;</span><br><span class="line">nohup hive --service hiveserver2 &amp;</span><br></pre></td></tr></table></figure><h3 id="beeline"><a href="#beeline" class="headerlink" title="beeline"></a>beeline</h3><p>1ï¼‰metadata ï¼šhiveå…ƒæ•°æ®ï¼Œå³hiveå®šä¹‰çš„è¡¨åï¼Œå­—æ®µåï¼Œç±»å‹ï¼Œåˆ†åŒºï¼Œç”¨æˆ·è¿™äº›æ•°æ®ã€‚ä¸€èˆ¬å­˜å‚¨å…³ç³»å‹ä¹¦åº“mysqlä¸­ï¼Œåœ¨æµ‹è¯•é˜¶æ®µä¹Ÿå¯ä»¥ç”¨hiveå†…ç½®Derbyæ•°æ®åº“ã€‚</p><p>ï¼ˆ2ï¼‰metastore ï¼šhivestoreæœåŠ¡ç«¯ã€‚ä¸»è¦æä¾›å°†DDLï¼ŒDMLç­‰è¯­å¥è½¬æ¢ä¸ºMapReduceï¼Œæäº¤åˆ°hdfsä¸­ã€‚</p><p>ï¼ˆ3ï¼‰hiveserver2ï¼šhiveæœåŠ¡ç«¯ã€‚æä¾›hiveæœåŠ¡ã€‚å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡beelineï¼Œjdbcï¼ˆå³ç”¨javaä»£ç é“¾æ¥ï¼‰ç­‰å¤šç§æ–¹å¼é“¾æ¥åˆ°hiveã€‚</p><p>ï¼ˆ4ï¼‰beelineï¼šhiveå®¢æˆ·ç«¯é“¾æ¥åˆ°hiveçš„ä¸€ä¸ªå·¥å…·ã€‚å¯ä»¥ç†è§£æˆmysqlçš„å®¢æˆ·ç«¯ã€‚å¦‚ï¼šnavite cat ç­‰ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20191122115956341.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1NDQwMDQw,size_16,color_FFFFFF,t_70"></p><p>2 è¿æ¥hiveï¼š<br>ï¼ˆ1ï¼‰./bin/hive<br>é€šè¿‡ ./bin/hive å¯åŠ¨çš„hiveæœåŠ¡ï¼Œç¬¬ä¸€æ­¥ä¼šå…ˆå¯åŠ¨metastoreæœåŠ¡ï¼Œç„¶ååœ¨å¯åŠ¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°metastoreã€‚æ­¤æ—¶metastoreæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œåˆ«çš„æœºå™¨æ— æ³•è¿æ¥åˆ°metastoreï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•è¿æ¥åˆ°hiveã€‚è¿™ç§æ–¹å¼ä¸å¸¸ç”¨ï¼Œä¸€ç›´åªç”¨äºè°ƒè¯•ç¯èŠ‚ã€‚</p><p>ï¼ˆ2ï¼‰ ./bin/hive  â€“service metastore<br><strong>é€šè¿‡hive â€“service metastore ä¼šå¯åŠ¨ä¸€ä¸ª hive metastoreæœåŠ¡é»˜è®¤çš„ç«¯å£å·ä¸ºï¼š9083ã€‚metastoreæœåŠ¡é‡Œé¢é…ç½®metadataç›¸å…³çš„é…ç½®ã€‚æ­¤æ—¶å¯ä»¥æœ‰å¤šä¸ªhiveå®¢æˆ·ç«¯åœ¨hive-site.xmlé…ç½®hive.metastore.uris=thrift://ipxxx:9083  çš„æ–¹å¼é“¾æ¥åˆ°hiveã€‚motestore è™½ç„¶èƒ½ä½¿hiveæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«éƒ¨ç½²åˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å…³æ³¨metadataçš„ç›¸å…³é…ç½®ã€‚ä½†æ˜¯metastoreåªèƒ½é€šè¿‡åªèƒ½é€šè¿‡é…ç½®hive.metastore.urisçš„æ–¹å¼è¿æ¥ï¼Œæ— æ³•é€šè¿‡jdbcçš„æ–¹å¼è®¿é—®ã€‚</strong></p><p>ï¼ˆ3ï¼‰./bin/hiveserver2<br>hiveserver2 ä¼šå¯åŠ¨ä¸€ä¸ªhiveæœåŠ¡ç«¯é»˜è®¤ç«¯å£ä¸ºï¼š10000ï¼Œå¯ä»¥é€šè¿‡beelineï¼Œjdbcï¼Œodbcçš„æ–¹å¼é“¾æ¥åˆ°hiveã€‚<strong>hiveserver2å¯åŠ¨çš„æ—¶å€™ä¼šå…ˆæ£€æŸ¥æœ‰æ²¡æœ‰é…ç½®hive.metastore.urisï¼Œå¦‚æœæ²¡æœ‰ä¼šå…ˆå¯åŠ¨ä¸€ä¸ªmetastoreæœåŠ¡ï¼Œç„¶ååœ¨å¯åŠ¨hiveserver2ã€‚å¦‚æœæœ‰é…ç½®hive.metastore.urisã€‚ä¼šè¿æ¥åˆ°è¿œç¨‹çš„metastoreæœåŠ¡ã€‚è¿™ç§æ–¹å¼æ˜¯æœ€å¸¸ç”¨çš„ã€‚</strong>éƒ¨ç½²åœ¨å›¾å¦‚ä¸‹ï¼š</p><ul><li>ç™»å½•bin/beelineï¼Œå¯ä»¥å¯åŠ¨å®¢æˆ·ç«¯é“¾æ¥åˆ°hiveserver2ã€‚æ‰§è¡Œbeelineååœ¨æ§åˆ¶è¾“å…¥Â !connect jdbc:hive2://localhost:10000/defaultÂ root 123 å°±å¯ä»¥é“¾æ¥åˆ°Â hiveserver2äº†ï¼›defaultè¡¨ç¤ºé“¾æ¥åˆ°default databaseï¼Œ root å’Œ123 åˆ†åˆ«ä¸ºå¯†ç ã€‚æ³¨æ„è¿™é‡Œçš„å¯†ç ä¸æ˜¯mysqlçš„å¯†ç ï¼Œæ˜¯hiveä¸­çš„ç”¨æˆ·</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¿æ¥åº“</span><br><span class="line">!connect jdbc:hive2://localhost:10000/defaultÂ root 123</span><br></pre></td></tr></table></figure><h3 id="hiveä¸­å‡ ç§åˆ†å‰²ç¬¦"><a href="#hiveä¸­å‡ ç§åˆ†å‰²ç¬¦" class="headerlink" title="hiveä¸­å‡ ç§åˆ†å‰²ç¬¦"></a>hiveä¸­å‡ ç§åˆ†å‰²ç¬¦</h3><p><strong>åˆ†éš”ç¬¦</strong></p><p>\n    æ¯è¡Œä¸€æ¡è®°å½•<br>^A    åˆ†éš”åˆ—ï¼ˆå…«è¿›åˆ¶ \001ï¼‰<br>^B    åˆ†éš”ARRAYæˆ–è€…STRUCTä¸­çš„å…ƒç´ ï¼Œæˆ–è€…MAPä¸­å¤šä¸ªé”®å€¼å¯¹ä¹‹é—´åˆ†éš”ï¼ˆå…«è¿›åˆ¶ \002ï¼‰<br>^C    åˆ†éš”MAPä¸­é”®å€¼å¯¹çš„â€œé”®â€å’Œâ€œå€¼â€ï¼ˆå…«è¿›åˆ¶ \003ï¼‰</p><p><strong>ç”¨åˆ°äº†ç³»ç»Ÿé»˜è®¤åˆ†éš”ç¬¦ã€‚é€šå¸¸ä¸‹é¢2ä¸­æƒ…å†µæˆ‘ä»¬éœ€è¦éœ€è¦ç”¨åˆ°åˆ†éš”ç¬¦</strong></p><p>1ï¼Œåˆ¶ä½œtableçš„è¾“å…¥æ–‡ä»¶ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è¾“å…¥ä¸€äº›ç‰¹æ®Šçš„åˆ†éš”ç¬¦</p><p>2ï¼ŒæŠŠhiveè¡¨æ ¼å¯¼å‡ºåˆ°æœ¬åœ°æ—¶ï¼Œç³»ç»Ÿé»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯^Aï¼Œè¿™ä¸ªæ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œç›´æ¥catæˆ–è€…vimæ˜¯çœ‹ä¸åˆ°çš„</p><p><strong>åˆ†éš”ç¬¦åœ¨HIVEä¸­çš„ç”¨é€”</strong></p><table><thead><tr><th>åˆ†éš”ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>\n</td><td>å¯¹äºæ–‡æœ¬æ–‡ä»¶æ¥è¯´ï¼Œæ¯è¡Œéƒ½æ˜¯ä¸€æ¡è®°å½•ï¼Œå› æ­¤æ¢è¡Œç¬¦å¯ä»¥åˆ†éš”è®°å½•</td></tr><tr><td>^A(Ctrl+A)</td><td>ç”¨äºåˆ†éš”å­—æ®µ(åˆ—)ã€‚åœ¨CREATE TABLEè¯­å¥ä¸­å¯ä»¥ä½¿ç”¨å…«è¿›åˆ¶ç¼–ç \001è¡¨ç¤º</td></tr><tr><td>^B(Ctrl+B)</td><td>ç”¨äºåˆ†éš”ARRAYæˆ–è€…STRUCTä¸­çš„å…ƒç´ ï¼Œæˆ–ç”¨äºMAPä¸­é”®-å€¼å¯¹ä¹‹é—´çš„åˆ†éš”ã€‚åœ¨CREATE TABLEè¯­å¥ä¸­å¯ä»¥ä½¿ç”¨å…«è¿›åˆ¶ç¼–ç \002è¡¨ç¤º</td></tr><tr><td>^C(Ctrl+C)</td><td>ç”¨äºMAPä¸­é”®å’Œå€¼ä¹‹é—´çš„åˆ†éš”ã€‚åœ¨CREATE TABLEè¯­å¥ä¸­å¯ä»¥ä½¿ç”¨å…«è¿›åˆ¶ç¼–ç \003è¡¨ç¤º</td></tr></tbody></table><blockquote><p>Hive ä¸­æ²¡æœ‰å®šä¹‰ä¸“é—¨çš„æ•°æ®æ ¼å¼ï¼Œæ•°æ®æ ¼å¼å¯ä»¥ç”±ç”¨æˆ·æŒ‡å®šï¼Œç”¨æˆ·å®šä¹‰æ•°æ®æ ¼å¼éœ€è¦æŒ‡å®šä¸‰ä¸ªå±æ€§ï¼šåˆ—åˆ†éš”ç¬¦ï¼ˆé€šå¸¸ä¸ºç©ºæ ¼ã€â€\tâ€ã€â€\x001â€³ï¼‰ã€è¡Œåˆ†éš”ç¬¦ï¼ˆâ€\nâ€ï¼‰ä»¥åŠè¯»å–æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ã€‚ç”±äºåœ¨åŠ è½½æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦ä»ç”¨æˆ·æ•°æ®æ ¼å¼åˆ° Hive å®šä¹‰çš„æ•°æ®æ ¼å¼çš„è½¬æ¢ï¼Œå› æ­¤ï¼ŒHive åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¸ä¼šå¯¹æ•°æ®æœ¬èº«è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œè€Œåªæ˜¯å°†æ•°æ®å†…å®¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°ç›¸åº”çš„ HDFS ç›®å½•ä¸­ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥åœ¨createè¡¨æ ¼çš„æ—¶å€™ï¼Œé€‰æ‹©å¦‚ä¸‹ï¼Œè¡¨æ ¼åŠ è½½inputçš„æ–‡ä»¶çš„æ—¶å€™å°±ä¼šæŒ‰ç…§ä¸‹é¢æ ¼å¼åŒ¹é…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">row format delimited </span><br><span class="line">fields terminated by &#x27;\001&#x27; </span><br><span class="line">collection items terminated by &#x27;\002&#x27; </span><br><span class="line">map keys terminated by &#x27;\003&#x27;</span><br><span class="line">lines terminated by &#x27;\n&#x27; </span><br><span class="line">stored as textfile;</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•æŸ¥çœ‹å’Œä¿®æ”¹åˆ†å‰²ç¬¦ï¼Œç‰¹æ®Šç¬¦å·"><a href="#å¦‚ä½•æŸ¥çœ‹å’Œä¿®æ”¹åˆ†å‰²ç¬¦ï¼Œç‰¹æ®Šç¬¦å·" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹å’Œä¿®æ”¹åˆ†å‰²ç¬¦ï¼Œç‰¹æ®Šç¬¦å·"></a>å¦‚ä½•æŸ¥çœ‹å’Œä¿®æ”¹åˆ†å‰²ç¬¦ï¼Œç‰¹æ®Šç¬¦å·</h3><ol><li>æŸ¥çœ‹éšè—å­—ç¬¦çš„æ–¹æ³•</li></ol><p>1.1ï¼Œcat -A filename</p><p><img src="http://image.okcode.net/26FFE1BCC5620E19E94B26122C71BA2E.png" alt="img"></p><p>1.2ï¼Œvim filenameå å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set listæ˜¾ç¤ºç‰¹æ®Šç¬¦å·</span><br><span class="line">set nolist å–æ¶ˆæ˜¾ç¤ºç‰¹æ®Šç¬¦å·</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹éšè—å­—ç¬¦çš„æ–¹æ³•</li></ol><p>é¦–å…ˆæŒ‰ç…§1.2æ‰“å¼€æ˜¾ç¤ºç‰¹æ®Šç¬¦å·ã€‚è¿›å…¥INSERTæ¨¡å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctrl + V å¯ä»¥è¾“å…¥ ^ç¬¦å·</span><br><span class="line">ctrl + a å¯ä»¥è¾“å…¥A---&#x27;\001&#x27;</span><br><span class="line">ctrl + b å¯ä»¥è¾“å…¥A---&#x27;\002&#x27;</span><br><span class="line">ctrl + c å¯ä»¥è¾“å…¥A---&#x27;\003&#x27;</span><br></pre></td></tr></table></figure><p> æ³¨æ„ï¼šè™½ç„¶é”®ç›˜ä¸Šä½ èƒ½æ‰¾åˆ°^å’ŒAä½†ç›´æ¥è¾“å…¥æ—¶ä¸è¡Œçš„ï¼Œå¿…é¡»æŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•è¾“å…¥ã€‚</p><p>ç¬¬ä¸€è¡Œæ˜¯ç‰¹æ®Šç¬¦å·é¢œè‰²è“è‰²ï¼Œç¬¬äºŒè¡Œç›´æ¥è¾“å…¥ä¸æ˜¯ç‰¹æ®Šç¬¦å·ã€‚</p><p><img src="http://image.okcode.net/DD9ED976ABB6F4313B8F0F7C2DD5C33E.png" alt="img"></p><p>ç‰¹æ®Šå·ç›´æ¥catæ˜¯ä¸å¯ä»¥çœ‹è§çš„ï¼Œä½†æ˜¯ç¬¬äºŒè¡Œæ˜¯å¯è§çš„ï¼Œæ‰€ä»¥ä¸æ˜¯ç‰¹æ®Šç¬¦å·ã€‚</p><p><img src="http://image.okcode.net/75D96F800A1815F7A84A8CF543BD7063.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ROW FORMAT DELIMITED </span><br><span class="line">FIELDS TERMINATED BY &#x27;\u0001&#x27; </span><br><span class="line">COLLECTION ITEMS TERMINATED BY &#x27;\u0002&#x27; </span><br><span class="line">MAP KEYS TERMINATED BY &#x27;\u0003&#x27;</span><br><span class="line">\u0001æ˜¯ASCIIç¼–ç å€¼ï¼Œå¯¹åº”javaä»£ç ä¸­çš„&quot;\001&quot;</span><br></pre></td></tr></table></figure><p>æ„ä¹‰å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰FIELDSï¼Œå­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦æ˜¯â€™\u0001â€™</p><p>ï¼ˆ2ï¼‰COLLECTION ITEMSï¼Œå¤šä¸ªé›†åˆä¹‹é—´çš„åˆ†éš”ç¬¦æ˜¯â€™\u0002â€™ï¼Œä¾‹å¦‚ï¼ˆkv1ï¼Œkv2ï¼Œkv3ï¼‰è¿™ç§å¤šä¸ªé”®å€¼å¯¹ä¹‹é—´çš„åˆ†éš”ç¬¦å°±æ˜¯â€™\u0002â€™</p><p>ï¼ˆ3ï¼‰MAP KEYSï¼Œå•ä¸ªmapçš„kå’Œvä¹‹é—´çš„åˆ†éš”ç¬¦æ˜¯\u0003\ï¼Œä¾‹å¦‚kv1é‡Œï¼Œk \u0003 v</p><h3 id="æŸ¥çœ‹orcæ–‡ä»¶"><a href="#æŸ¥çœ‹orcæ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹orcæ–‡ä»¶"></a>æŸ¥çœ‹orcæ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive --orcfiledump &lt;hdfs-location-of-orc-file&gt;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å­—æ®µç±»å‹"><a href="#ä¿®æ”¹å­—æ®µç±»å‹" class="headerlink" title="ä¿®æ”¹å­—æ®µç±»å‹"></a>ä¿®æ”¹å­—æ®µç±»å‹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span> CHANGE <span class="operator">&lt;</span><span class="keyword">old</span><span class="operator">-</span>col<span class="operator">-</span>name<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">new</span><span class="operator">-</span>col<span class="operator">-</span>name<span class="operator">&gt;</span> <span class="operator">&lt;</span>data<span class="operator">-</span>type<span class="operator">&gt;</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee CHANGE e_id e_id <span class="type">INT</span>;</span><br></pre></td></tr></table></figure><h3 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h3><ul><li><p>Create ORC table</p></li><li><p>Login to the web console</p></li><li><p>Launch Hive by typing <code>hive</code> in the web console. Run the below commands in Hive.</p></li><li><p>Use your database by using the below command. <code>$&#123;env:USER&#125;</code> gets replaced by your username automatically:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use $&#123;env:USER&#125;;</span><br></pre></td></tr></table></figure></li><li><p>To create an ORC file format:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE orc_table (</span><br><span class="line">    first_name STRING, </span><br><span class="line">    last_name STRING</span><br><span class="line"> ) </span><br><span class="line"> STORED AS ORC;</span><br></pre></td></tr></table></figure></li><li><p>To insert values in the table:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO orc_table VALUES (&#x27;John&#x27;,&#x27;Gill&#x27;);</span><br></pre></td></tr></table></figure></li><li><p>To retrieve all the values in the table:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM orc_table;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><p>æŸ¥çœ‹hiveè¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps -ml  | grep Hive</span><br></pre></td></tr></table></figure><h2 id="level-2"><a href="#level-2" class="headerlink" title="level-2"></a>level-2</h2><h3 id="å†…éƒ¨è¡¨vså¤–éƒ¨è¡¨"><a href="#å†…éƒ¨è¡¨vså¤–éƒ¨è¡¨" class="headerlink" title="å†…éƒ¨è¡¨vså¤–éƒ¨è¡¨"></a>å†…éƒ¨è¡¨vså¤–éƒ¨è¡¨</h3><p><strong>å†…éƒ¨è¡¨</strong></p><ol><li>æŒ‰ç…§è¡¨æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å°†è¡¨åˆ†ä¸ºå†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨ä¸¤ç±»ï¼›</li><li>å†…éƒ¨è¡¨ä¹Ÿå«ç®¡ç†è¡¨æˆ–ä¸´æ—¶è¡¨ï¼Œè¯¥ç±»å‹è¡¨çš„ç”Ÿå‘½å‘¨æœŸæ—¶ç”±hiveæ§åˆ¶çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ•°æ®éƒ½å­˜æ”¾åœ¨/user/hive/warehouse/ä¸‹é¢ï¼›</li><li>åˆ é™¤è¡¨æ—¶æ•°æ®ä¼šè¢«åˆ é™¤ï¼›</li><li>ä»¥ä¸‹å‘½ä»¤åˆ›å»ºçš„å°±æ˜¯å†…éƒ¨è¡¨ï¼Œå¯è§å‰é¢ä¸¤ç¯‡æ–‡ç« ä¸­åˆ›å»ºçš„è¡¨éƒ½æ˜¯å†…éƒ¨è¡¨</li></ol><p><strong>å¤–éƒ¨è¡¨</strong></p><ul><li>åˆ›å»ºè¡¨çš„SQLè¯­å¥ä¸­åŠ ä¸Šexternalï¼Œåˆ›å»ºçš„å°±æ˜¯å¤–éƒ¨è¡¨äº†ï¼›</li><li>å¤–éƒ¨è¡¨çš„æ•°æ®ç”Ÿå‘½å‘¨æœŸä¸å—Hiveæ§åˆ¶ï¼›</li><li>åˆ é™¤å¤–éƒ¨è¡¨çš„æ—¶å€™ä¸ä¼šåˆ é™¤æ•°æ®ï¼›</li><li>å¤–éƒ¨è¡¨çš„æ•°æ®ï¼Œå¯ä»¥åŒæ—¶ä½œä¸ºå¤šä¸ªå¤–éƒ¨è¡¨çš„æ•°æ®æºå…±äº«ä½¿ç”¨ï¼›</li><li>æ¥ä¸‹æ¥å¼€å§‹å®è·µï¼Œä¸‹é¢æ˜¯å»ºè¡¨è¯­å¥ï¼š</li><li>åœ¨å®é™…ç”Ÿäº§ä¸šåŠ¡ç³»ç»Ÿå¼€å‘ä¸­ï¼Œå¤–éƒ¨è¡¨æ˜¯æˆ‘ä»¬ä¸»è¦åº”ç”¨çš„è¡¨ç±»å‹</li></ul>]]></content>
      
      
      <categories>
          
          <category> hive </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yarn point</title>
      <link href="/2021/12/31/yarn%20snippet/"/>
      <url>/2021/12/31/yarn%20snippet/</url>
      
        <content type="html"><![CDATA[<p><strong>Yet Another Resource Negotiator</strong></p><p>YARN çœ‹åšä¸€ä¸ªäº‘æ“ä½œç³»ç»Ÿï¼Œå®ƒè´Ÿè´£ä¸ºåº”ç”¨ç¨‹åºå¯ åŠ¨ ApplicationMasterï¼ˆç›¸å½“äºä¸»çº¿ç¨‹ï¼‰ï¼Œç„¶åå†ç”± ApplicationMaster è´Ÿè´£æ•°æ®åˆ‡åˆ†ã€ä»»åŠ¡åˆ†é…ã€ å¯åŠ¨å’Œç›‘æ§ç­‰å·¥ä½œï¼Œè€Œç”± ApplicationMaster å¯åŠ¨çš„å„ä¸ª Taskï¼ˆç›¸å½“äºå­çº¿ç¨‹ï¼‰ä»…è´Ÿè´£è‡ªå·±çš„è®¡ ç®—ä»»åŠ¡ã€‚å½“æ‰€æœ‰ä»»åŠ¡è®¡ç®—å®Œæˆåï¼ŒApplicationMaster è®¤ä¸ºåº”ç”¨ç¨‹åºè¿è¡Œå®Œæˆï¼Œç„¶åé€€å‡ºã€‚</p><p><img src="/images/yarn/yarn_construct.gif"></p><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h4 id="contrainer"><a href="#contrainer" class="headerlink" title="contrainer"></a>contrainer</h4><blockquote><p>å®¹å™¨ï¼ˆContainerï¼‰è¿™ä¸ªä¸œè¥¿æ˜¯ Yarn å¯¹èµ„æºåšçš„ä¸€å±‚æŠ½è±¡ã€‚å°±åƒæˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦å¯¹åº•å±‚ä¸€äº›ä¸œè¥¿è¿›è¡Œå°è£…ï¼Œåªæä¾›ç»™ä¸Šå±‚ä¸€ä¸ªè°ƒç”¨æ¥å£ä¸€æ ·ï¼ŒYarn å¯¹èµ„æºçš„ç®¡ç†ä¹Ÿæ˜¯ç”¨åˆ°äº†è¿™ç§æ€æƒ³ã€‚</p></blockquote><p><img src="/images/yarn/contrainer.jpeg"></p><blockquote><p>Yarn å°†CPUæ ¸æ•°ï¼Œå†…å­˜è¿™äº›è®¡ç®—èµ„æºéƒ½å°è£…æˆä¸ºä¸€ä¸ªä¸ªçš„å®¹å™¨ï¼ˆContainerï¼‰ã€‚Â Â Â Â </p></blockquote><ul><li>å®¹å™¨ç”± NodeManager å¯åŠ¨å’Œç®¡ç†ï¼Œå¹¶è¢«å®ƒæ‰€ç›‘æ§ã€‚</li><li>å®¹å™¨è¢« ResourceManager è¿›è¡Œè°ƒåº¦ã€‚</li></ul><h4 id="ResourceManager"><a href="#ResourceManager" class="headerlink" title="ResourceManager"></a>ResourceManager</h4><blockquote><p>è´Ÿè´£èµ„æºç®¡ç†çš„ï¼Œæ•´ä¸ªç³»ç»Ÿæœ‰ä¸”åªæœ‰ä¸€ä¸ª RM ï¼Œæ¥è´Ÿè´£èµ„æºçš„è°ƒåº¦ã€‚å®ƒä¹ŸåŒ…å«äº†ä¸¤ä¸ªä¸»è¦çš„ç»„ä»¶ï¼šå®šæ—¶è°ƒç”¨å™¨(Scheduler)ä»¥åŠåº”ç”¨ç®¡ç†å™¨(ApplicationManager)ã€‚</p></blockquote><ol><li>å®šæ—¶è°ƒåº¦å™¨(Scheduler)ï¼šä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®šæ—¶è°ƒåº¦å™¨å°±æ˜¯ä¸€ç§ç­–ç•¥ï¼Œæˆ–è€…è¯´ä¸€ç§ç®—æ³•ã€‚å½“ Client æäº¤ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œå®ƒä¼šæ ¹æ®æ‰€éœ€è¦çš„èµ„æºä»¥åŠå½“å‰é›†ç¾¤çš„èµ„æºçŠ¶å†µè¿›è¡Œåˆ†é…ã€‚æ³¨æ„ï¼Œå®ƒåªè´Ÿè´£å‘åº”ç”¨ç¨‹åºåˆ†é…èµ„æºï¼Œå¹¶ä¸åšç›‘æ§ä»¥åŠåº”ç”¨ç¨‹åºçš„çŠ¶æ€è·Ÿè¸ªã€‚</li><li>åº”ç”¨ç®¡ç†å™¨(ApplicationManager)ï¼šåŒæ ·ï¼Œå¬åå­—å°±èƒ½å¤§æ¦‚çŸ¥é“å®ƒæ˜¯å¹²å˜›çš„ã€‚åº”ç”¨ç®¡ç†å™¨å°±æ˜¯è´Ÿè´£ç®¡ç† Client ç”¨æˆ·æäº¤çš„åº”ç”¨ã€‚ä¸Šé¢ä¸æ˜¯è¯´åˆ°å®šæ—¶è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ä¸å¯¹ç”¨æˆ·æäº¤çš„ç¨‹åºç›‘æ§å˜›ï¼Œå…¶å®å•Šï¼Œç›‘æ§åº”ç”¨çš„å·¥ä½œæ­£æ˜¯ç”±åº”ç”¨ç®¡ç†å™¨ï¼ˆApplicationManagerï¼‰å®Œæˆçš„ã€‚</li></ol><h4 id="ApplicationMaster"><a href="#ApplicationMaster" class="headerlink" title="ApplicationMaster"></a>ApplicationMaster</h4><blockquote><p>æ¯å½“ Client æäº¤ä¸€ä¸ª Application æ—¶å€™ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ª ApplicationMaster ã€‚ç”±è¿™ä¸ª ApplicationMaster å»ä¸ ResourceManager ç”³è¯·å®¹å™¨èµ„æºï¼Œè·å¾—èµ„æºåä¼šå°†è¦è¿è¡Œçš„ç¨‹åºå‘é€åˆ°å®¹å™¨ä¸Šå¯åŠ¨ï¼Œç„¶åè¿›è¡Œåˆ†å¸ƒå¼è®¡ç®—ã€‚</p><p>ps: å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—çš„æ€æƒ³ï¼Œå¤§æ•°æ®éš¾ä»¥ç§»åŠ¨ï¼ˆæµ·é‡æ•°æ®ç§»åŠ¨æˆæœ¬å¤ªå¤§ï¼Œæ—¶é—´å¤ªé•¿ï¼‰ï¼Œé‚£å°±æŠŠå®¹æ˜“ç§»åŠ¨çš„åº”ç”¨ç¨‹åºå‘å¸ƒåˆ°å„ä¸ªèŠ‚ç‚¹è¿›è¡Œè®¡ç®—ã€‚</p></blockquote><h4 id="NodeManager"><a href="#NodeManager" class="headerlink" title="NodeManager"></a>NodeManager</h4><blockquote><p>NodeManager æ˜¯ ResourceManager åœ¨æ¯å°æœºå™¨çš„ä¸Šä»£ç†ï¼Œè´Ÿè´£å®¹å™¨çš„ç®¡ç†ï¼Œå¹¶ç›‘æ§ä»–ä»¬çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ˆcpuï¼Œå†…å­˜ï¼Œç£ç›˜åŠç½‘ç»œç­‰ï¼‰ï¼Œä»¥åŠå‘ ResourceManager/Scheduler æä¾›è¿™äº›èµ„æºä½¿ç”¨æŠ¥å‘Šã€‚</p></blockquote><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><h3 id="submit-application-to-yarn"><a href="#submit-application-to-yarn" class="headerlink" title="submit application to yarn"></a>submit application to yarn</h3><p><img src="/images/yarn/submit_app_flow.jpeg"></p><ol><li>Client å‘ Yarn æäº¤ Applicationï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾æ˜¯ä¸€ä¸ª MapReduce ä½œä¸šã€‚</li><li>ResourceManager å‘ NodeManager é€šä¿¡ï¼Œä¸ºè¯¥ Application åˆ†é…ç¬¬ä¸€ä¸ªå®¹å™¨ã€‚å¹¶åœ¨è¿™ä¸ªå®¹å™¨ä¸­è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºå¯¹åº”çš„ ApplicationMasterã€‚</li><li>ApplicationMaster å¯åŠ¨ä»¥åï¼Œå¯¹ ä½œä¸šï¼ˆä¹Ÿå°±æ˜¯ Applicationï¼‰ è¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ† task å‡ºæ¥ï¼Œè¿™äº› task å¯ä»¥è¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸­ã€‚ç„¶åå‘ ResourceManager ç”³è¯·è¦è¿è¡Œç¨‹åºçš„å®¹å™¨ï¼Œå¹¶å®šæ—¶å‘ ResourceManager å‘é€å¿ƒè·³ã€‚</li><li>ç”³è¯·åˆ°å®¹å™¨åï¼ŒApplicationMaster ä¼šå»å’Œå®¹å™¨å¯¹åº”çš„ NodeManager é€šä¿¡ï¼Œè€Œåå°†ä½œä¸šåˆ†å‘åˆ°å¯¹åº”çš„ NodeManager ä¸­çš„å®¹å™¨å»è¿è¡Œï¼Œè¿™é‡Œä¼šå°†æ‹†åˆ†åçš„ MapReduce è¿›è¡Œåˆ†å‘ï¼Œå¯¹åº”å®¹å™¨ä¸­è¿è¡Œçš„å¯èƒ½æ˜¯ Map ä»»åŠ¡ï¼Œä¹Ÿå¯èƒ½æ˜¯ Reduce ä»»åŠ¡ã€‚</li><li>å®¹å™¨ä¸­è¿è¡Œçš„ä»»åŠ¡ä¼šå‘ ApplicationMaster å‘é€å¿ƒè·³ï¼Œæ±‡æŠ¥è‡ªèº«æƒ…å†µã€‚å½“ç¨‹åºè¿è¡Œå®Œæˆåï¼Œ ApplicationMaster å†å‘ ResourceManager æ³¨é”€å¹¶é‡Šæ”¾å®¹å™¨èµ„æºã€‚</li></ol><h3 id="åœæ­¢åº”ç”¨"><a href="#åœæ­¢åº”ç”¨" class="headerlink" title="åœæ­¢åº”ç”¨"></a>åœæ­¢åº”ç”¨</h3><p><code>yarn application -kill appID</code></p><h2 id="å‚æ•°é…ç½®"><a href="#å‚æ•°é…ç½®" class="headerlink" title="å‚æ•°é…ç½®"></a>å‚æ•°é…ç½®</h2><p>æ¯ä¸ªjobæäº¤åˆ°yarnä¸Šæ‰§è¡Œæ—¶ï¼Œéƒ½ä¼šåˆ†é…Containerå®¹å™¨å»è¿è¡Œï¼Œè€Œè¿™ä¸ªå®¹å™¨éœ€è¦èµ„æºæ‰èƒ½è¿è¡Œï¼Œè¿™ä¸ªèµ„æºå°±æ˜¯Cpuå’Œå†…å­˜ã€‚</p><h3 id="CPUèµ„æºè°ƒåº¦"><a href="#CPUèµ„æºè°ƒåº¦" class="headerlink" title="CPUèµ„æºè°ƒåº¦"></a>CPUèµ„æºè°ƒåº¦</h3><p>ç›®å‰çš„CPUè¢«Yarnåˆ’åˆ†ä¸ºè™šæ‹ŸCPUï¼Œè¿™æ˜¯yarnè‡ªå·±å¼•å…¥çš„æ¦‚å¿µï¼Œå› ä¸ºæ¯ä¸ªæœåŠ¡å™¨çš„Cpuè®¡ç®—èƒ½åŠ›ä¸ä¸€æ ·ï¼Œæœ‰çš„æœºå™¨å¯èƒ½æ˜¯ å…¶ä»–æœºå™¨çš„è®¡ç®—èƒ½åŠ›çš„2å€ï¼Œç„¶åå¯ä»¥é€šè¿‡å¤šé…ç½®å‡ ä¸ªè™šæ‹Ÿå†…å­˜å¼¥è¡¥å·®å¼‚ã€‚åœ¨yarnä¸­ï¼Œcpuçš„ç›¸å…³é…ç½®å¦‚ä¸‹ã€‚</p><p>yarn.nodemanager.resource.cpu-vcores</p><p>è¡¨ç¤ºè¯¥èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šyarnå¯ä»¥ä½¿ç”¨çš„è™šæ‹Ÿçš„CPUä¸ªæ•°ï¼Œé»˜è®¤æ˜¯8ï¼Œæ¨èé…ç½®ä¸æ ¸å¿ƒä¸ªæ•°ç›¸åŒï¼Œå¦‚æœèŠ‚ç‚¹CPUçš„æ ¸å¿ƒä¸ªæ•°ä¸è¶³8ä¸ªï¼Œéœ€è¦è°ƒå°è¿™ä¸ªå€¼ï¼Œyarnä¸ä¼šæ™ºèƒ½çš„å»æ£€æµ‹ç‰©ç†æ ¸æ•°ã€‚å¦‚æœæœºå™¨æ€§èƒ½è¾ƒå¥½ï¼Œå¯ä»¥é…ç½®ä¸ºç‰©ç†æ ¸æ•°çš„2å€ã€‚</p><p>yarn.scheduler.minimum-allocation-vcores</p><p>è¡¨ç¤ºå•ä¸ªä»»åŠ¡æœ€å°å¯ä»¥ç”³è¯·çš„è™šæ‹Ÿæ ¸å¿ƒæ•°ï¼Œé»˜è®¤ä¸º1</p><p>yarn.sheduler.maximum-allocation-vcores</p><p>è¡¨ç¤ºå•ä¸ªä»»åŠ¡æœ€å¤§å¯ä»¥ç”³è¯·çš„è™šæ‹Ÿæ ¸æ•°ï¼Œé»˜è®¤ä¸º4ï¼›å¦‚æœç”³è¯·èµ„æºæ—¶ï¼Œè¶…è¿‡è¿™ä¸ªé…ç½®ï¼Œä¼šæŠ›å‡º InvalidResourceRequestException</p><h3 id="Memoryèµ„æºè°ƒåº¦"><a href="#Memoryèµ„æºè°ƒåº¦" class="headerlink" title="Memoryèµ„æºè°ƒåº¦"></a>Memoryèµ„æºè°ƒåº¦</h3><p>yarnä¸€èˆ¬å…è®¸ç”¨æˆ·é…ç½®æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¯ç”¨çš„ç‰©ç†èµ„æºï¼Œå¯ç”¨æŒ‡çš„æ˜¯å°†æœºå™¨ä¸Šå†…å­˜å‡å»hdfsçš„ï¼Œhbaseçš„ç­‰ç­‰å‰©ä¸‹çš„å¯ç”¨çš„å†…å­˜ã€‚</p><p>yarn.nodemanager.resource.memory-mb</p><p>è®¾ç½®è¯¥èŠ‚ç‚¹ä¸Šyarnå¯ä½¿ç”¨çš„å†…å­˜ï¼Œé»˜è®¤ä¸º8Gï¼Œå¦‚æœèŠ‚ç‚¹å†…å­˜ä¸è¶³8Gï¼Œè¦å‡å°‘è¿™ä¸ªå€¼ï¼Œyarnä¸ä¼šæ™ºèƒ½çš„å»æ£€æµ‹å†…å­˜èµ„æºï¼Œä¸€èˆ¬è¿™ä¸ªå€¼å¼yarnçš„å¯ç”¨å†…å­˜èµ„æºã€‚</p><p>yarn.scheduler.minmum-allocation-mb</p><p>å•ä¸ªä»»åŠ¡æœ€å°ç”³è¯·ç‰©ç†å†…å­˜é‡ï¼Œé»˜è®¤æ˜¯1024Mï¼Œæ ¹æ®è‡ªå·±ä¸šåŠ¡è®¾å®š</p><p>yarn.scheduler.maximum-allocation-mb</p><p>å•ä¸ªä»»åŠ¡æœ€å¤§å¯ä»¥ç”³è¯·çš„ç‰©ç†å†…å­˜é‡ï¼Œé»˜è®¤ä¸º8291M</p><p>äºŒã€å¦‚æœè®¾ç½®è¿™å‡ ä¸ªå‚æ•°<br>å¦‚æœä¸€ä¸ªæœåŠ¡å™¨æ˜¯32æ ¸ï¼Œè™šæ‹Ÿåä¸º64æ ¸ï¼Œ128Gå†…å­˜ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è®¾ç½®ä¸Šé¢çš„6ä¸ªå‚æ•°å‘¢ï¼Ÿå³å¦‚ä½•åšåˆ°èµ„æºæœ€å¤§åŒ–åˆ©ç”¨</p><p>ç”Ÿäº§ä¸Šæˆ‘ä»¬ä¸€èˆ¬è¦é¢„ç•™15-20%çš„å†…å­˜ï¼Œé‚£ä¹ˆå¯ç”¨å†…å­˜å°±æ˜¯128*0.8=102.4Gï¼Œå»é™¤å…¶ä»–ç»„ä»¶çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬è®¾ç½®æˆ90Gå°±å¯ä»¥äº†ã€‚</p><p>1ã€yarn.sheduler.maximum-allocation-vcores<br>1.<br>ä¸€èˆ¬å°±è®¾ç½®æˆ4ä¸ªï¼Œclouderaå…¬å¸åšè¿‡æ€§èƒ½æµ‹è¯•ï¼Œå¦‚æœCPUå¤§äºç­‰äº5ä¹‹åï¼ŒCPUçš„åˆ©ç”¨ç‡åè€Œä¸æ˜¯å¾ˆå¥½ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥æ ¹æ®ç”ŸæˆæœåŠ¡å™¨å†³å®šï¼Œæ¯”å¦‚å…¬å¸æœåŠ¡å™¨å¾ˆå¯Œè£•ï¼Œé‚£å°±ç›´æ¥è®¾ç½®æˆ1:1ï¼›è®¾ç½®æˆ32ï¼Œå¦‚æœä¸æ˜¯å¾ˆå¯Œè£•ï¼Œå¯ä»¥ç›´æ¥è®¾ç½®æˆ1:2ã€‚æˆ‘ä»¬ä»¥1:2æ¥è®¡ç®—ã€‚</p><p>2ã€yarn.scheduler.minimum-allocation-vcores<br>1.<br>å¦‚æœè®¾ç½®vcoure = 1ï¼Œé‚£ä¹ˆæœ€å¤§å¯ä»¥è·‘64/1=64ä¸ªcontainerï¼Œå¦‚æœè®¾ç½®æˆè¿™æ ·ï¼Œæœ€å°containeræ˜¯64/4=16ä¸ªã€‚</p><p>3ã€yarn.scheduler.minmum-allocation-mb</p><p>å¦‚æœè®¾ç½®æˆ2Gï¼Œé‚£ä¹ˆ90/2=45æœ€å¤šå¯ä»¥è·‘45ä¸ªcontainerï¼Œå¦‚æœè®¾ç½®æˆ4Gï¼Œé‚£ä¹ˆæœ€å¤šå¯ä»¥è·‘24ä¸ªï¼›vcoreæœ‰äº›æµªè´¹ã€‚</p><p>4ã€yarn.scheduler.maximum-allocation-mb</p><p>è¿™ä¸ªè¦æ ¹æ®è‡ªå·±å…¬å¸çš„ä¸šåŠ¡è®¾å®šï¼Œå¦‚æœæœ‰å¤§ä»»åŠ¡ï¼Œéœ€è¦5-6Gå†…å­˜ï¼Œé‚£å°±è®¾ç½®ä¸º8Gï¼Œé‚£ä¹ˆæœ€å¤§å¯ä»¥è·‘11ä¸ªcontainerã€‚</p><h2 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h2><h3 id="é…ç½®æŒ‡å®šç”¨æˆ·å¯åœ"><a href="#é…ç½®æŒ‡å®šç”¨æˆ·å¯åœ" class="headerlink" title="é…ç½®æŒ‡å®šç”¨æˆ·å¯åœ"></a>é…ç½®æŒ‡å®šç”¨æˆ·å¯åœ</h3><p><code>start-yarn.sh</code>å’Œ<code>stop-yarn.sh</code>æ·»åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">YARN_RESOURCEMANAGER_USER=xxx</span><br><span class="line">YARN_NODEMANAGER_USER=xxx</span><br></pre></td></tr></table></figure><p>ps: å¦‚æœæŸä¸ªèŠ‚ç‚¹nodemanageræ²¡æœ‰æ‹‰èµ·ï¼Œéœ€è¦æ‰§è¡Œ<code>./yarn --daemon start nodemanager</code></p><h3 id="åœ¨èµ„æºå¤Ÿç”¨çš„æƒ…å†µï¼Œæ— æ³•å‘å¸ƒæ–°çš„åº”ç”¨"><a href="#åœ¨èµ„æºå¤Ÿç”¨çš„æƒ…å†µï¼Œæ— æ³•å‘å¸ƒæ–°çš„åº”ç”¨" class="headerlink" title="åœ¨èµ„æºå¤Ÿç”¨çš„æƒ…å†µï¼Œæ— æ³•å‘å¸ƒæ–°çš„åº”ç”¨"></a>åœ¨èµ„æºå¤Ÿç”¨çš„æƒ…å†µï¼Œæ— æ³•å‘å¸ƒæ–°çš„åº”ç”¨</h3><p>ä¿®æ”¹<code>capacity-scheduler.xml</code><br> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.maximum-am-resource-percent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--&lt;value&gt;0.1&lt;/value&gt;--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">   Maximum percent of resources in the cluster which can be used to run</span><br><span class="line">   application masters i.e. controls number of concurrent running</span><br><span class="line">   applications.</span><br><span class="line"> <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p><hr><p>reference:</p><p><a href="https://zhuanlan.zhihu.com/p/54192454">https://zhuanlan.zhihu.com/p/54192454</a></p>]]></content>
      
      
      <categories>
          
          <category> yarn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> point </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Real-time Data Warehouse</title>
      <link href="/2021/12/30/realtime%20datahouse/"/>
      <url>/2021/12/30/realtime%20datahouse/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å½“è®¾è®¡ä¸€æ¬¾äº§å“æˆ–è€…å¹³å°çš„æ—¶å€™ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºä¸¤å±‚ï¼Œå³åº•å±‚å®ç°å’Œä¸Šå±‚æŠ½è±¡ã€‚</p></blockquote><p>å®æ—¶æ•°ä»“å’Œä¼ ç»Ÿæ•°ä»“çš„å¯¹æ¯”ä¸»è¦å¯ä»¥ä»å››ä¸ªæ–¹é¢è€ƒè™‘ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªæ˜¯<strong>åˆ†å±‚æ–¹å¼</strong>ï¼Œç¦»çº¿æ•°ä»“ä¸ºäº†è€ƒè™‘åˆ°æ•ˆç‡é—®é¢˜ï¼Œä¸€èˆ¬ä¼šé‡‡å–ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼ï¼Œå±‚çº§åˆ’åˆ†ä¼šæ¯”è¾ƒå¤šï¼›åˆ™å®æ—¶æ•°ä»“è€ƒè™‘åˆ°å®æ—¶æ€§é—®é¢˜ï¼Œä¸€èˆ¬åˆ†å±‚ä¼šæ¯”è¾ƒå°‘ï¼Œå¦å¤–ä¹Ÿå‡å°‘äº†ä¸­é—´æµç¨‹å‡ºé”™çš„å¯èƒ½æ€§ã€‚</li><li>ç¬¬äºŒä¸ªæ˜¯<strong>äº‹å®æ•°æ®</strong>å­˜å‚¨æ–¹é¢ï¼Œç¦»çº¿æ•°ä»“ä¼šåŸºäº HDFSï¼Œå®æ—¶æ•°ä»“åˆ™ä¼šåŸºäºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaï¼‰ã€‚</li><li>ç¬¬ä¸‰ä¸ªæ˜¯<strong>ç»´åº¦æ•°æ®</strong>å­˜å‚¨ï¼Œå®æ—¶æ•°ä»“ä¼šå°†æ•°æ®æ”¾åœ¨ KV å­˜å‚¨ä¸Šé¢ã€‚</li><li>ç¬¬å››ä¸ªæ˜¯<strong>æ•°æ®åŠ å·¥</strong>è¿‡ç¨‹ï¼Œç¦»çº¿æ•°ä»“ä¸€èˆ¬ä»¥ Hiveã€Spark ç­‰æ‰¹å¤„ç†ä¸ºä¸»ï¼Œè€Œå®æ—¶æ•°ä»“åˆ™æ˜¯åŸºäºå®æ—¶è®¡ç®—å¼•æ“å¦‚ Stormã€Flink ç­‰ï¼Œä»¥æµå¤„ç†ä¸ºä¸»ã€‚</li></ul><p>å®æ—¶æ•°ä»“ä¸»è¦æœ‰ä¸¤ä¸ªè¦ç‚¹ã€‚é¦–å…ˆæ˜¯åˆ†å±‚è®¾è®¡ä¸Šï¼Œä¸€èˆ¬ä¹Ÿæ˜¯å‚è€ƒç¦»çº¿æ•°ä»“çš„è®¾è®¡ï¼Œé€šå¸¸ä¼šåˆ†ä¸º</p><p>ODSæ“ä½œæ•°æ®å±‚</p><p>DWDæ˜ç»†å±‚</p><p>DWSæ±‡æ€»å±‚ï¼ˆè½»åº¦æ±‡æ€»/é«˜åº¦æ±‡æ€»ï¼‰</p><p>ADSåº”ç”¨å±‚</p><p>å¯èƒ½è¿˜ä¼šåˆ†å‡ºä¸€å±‚DIMç»´åº¦æ•°æ®å±‚ã€‚å¦å¤–åˆ†å±‚è®¾è®¡ä¸Šä¹Ÿæœ‰ä¸åŒçš„æ€è·¯ï¼Œæ¯”å¦‚å¯ä»¥å°†DWSå’ŒADSå½’ä¸ºDMæ•°æ®é›†å¸‚å±‚</p><ul><li><p><strong>ODS(Operational Data Store): è´´æºå±‚</strong></p><p>è¿™ä¸€å±‚åˆå«åšè´´æºå±‚,æœ€ä¸ºæ¥è¿‘æ•°æ®æºçš„ä¸€å±‚,éœ€è¦å­˜å‚¨çš„æ•°æ®é‡æ˜¯æœ€å¤§çš„,å­˜å‚¨çš„æ•°æ®ä¹Ÿæ˜¯æœ€åŸå§‹ã€‚å¯¹ä¼—å¤šæ•°æ®æºè€Œè¨€ï¼Œä»–ä»¬çš„æ•°æ®æ ¼å¼åŸºæœ¬ä¸ä¸€è‡´ï¼Œç»è¿‡ç»Ÿä¸€è§„æ ¼åŒ–åå¯ä»¥å¾—åˆ°è§„æ•´çš„æ•°æ®ï¼Œå°†æ•°æ®æºä¸­çš„æ•°æ®ç»è¿‡æŠ½å–ã€æ¸…æ´—ã€ä¼ è¾“åè£…å…¥ODSå±‚ã€‚</p></li><li><p><strong>DWD(Data Warehouse Detail)ï¼šæ•°æ®æ˜ç»†å±‚</strong></p><p>ä¸šåŠ¡å±‚ä¸æ•°æ®ä»“åº“çš„éš”ç¦»å±‚ï¼Œä¸»è¦å¯¹ODSå±‚åšä¸€äº›æ•°æ®æ¸…æ´—å’Œè§„èŒƒåŒ–çš„æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥æŒ‰ç…§ä¸åŒçš„è¡Œä¸ºç»´åº¦å¯¹æ•°æ®è¿›è¡Œåˆ’åˆ†ï¼Œä¾‹å¦‚æœ¬æ–‡å¯¹æ•°æ®æºå°±è¿›è¡Œäº†åˆ’åˆ†ï¼Œä¸»è¦åˆ†ä¸ºæµè§ˆã€æ›å…‰ã€ç‚¹å‡»ã€äº¤æ˜“ç­‰ä¸åŒçš„ç»´åº¦ï¼Œè¿™äº›ä¸åŒçš„ç»´åº¦èƒ½å¤Ÿå¯¹ä¸Šå±‚è°ƒç”¨æ–¹æä¾›æ›´ç»†ç²’åº¦çš„æ•°æ®æœåŠ¡ã€‚</p></li><li><p><strong>DWS(Data WareHouse Servce)ï¼šæ•°æ®æœåŠ¡å±‚</strong></p><p>å¯¹å„ä¸ªåŸŸè¿›è¡Œäº†é€‚åº¦æ±‡æ€»ï¼Œä¸»è¦ä»¥æ•°æ®åŸŸ+ä¸šåŠ¡åŸŸçš„ç†å¿µå»ºè®¾å…¬å…±æ±‡æ€»å±‚ï¼Œä¸ç¦»çº¿æ•°ä»“ä¸åŒçš„æ˜¯ï¼Œå®æ—¶æ•°ä»“çš„æ±‡æ€»å±‚åˆ†ä¸ºè½»åº¦æ±‡æ€»å±‚å’Œé«˜åº¦æ±‡æ€»å±‚ï¼Œä¾‹å¦‚å°†è½»åº¦æ±‡æ€»å±‚æ•°æ®å†™å…¥ ADSï¼Œç”¨äºå‰ç«¯äº§å“å¤æ‚çš„OLAPæŸ¥è¯¢åœºæ™¯ï¼Œæ»¡è¶³è‡ªåŠ©åˆ†æå’Œäº§å‡ºæŠ¥è¡¨çš„éœ€æ±‚ã€‚</p></li><li><p><strong>ADS(Application Data Store)ï¼šåº”ç”¨æ•°æ®æœåŠ¡å±‚</strong></p><p>ä¸»è¦æ˜¯ä¸ºäº†å…·ä½“éœ€æ±‚è€Œæ„å»ºçš„åº”ç”¨å±‚ï¼Œé€šè¿‡ RPC æ¡†æ¶å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¾‹å¦‚æœ¬æ–‡ä¸­æåˆ°çš„æ•°æ®æŠ¥è¡¨åˆ†æä¸å±•ç¤ºã€ç›‘æ§å‘Šè­¦ã€æµé‡è°ƒæ§ã€å¼€æ”¾å¹³å°ç­‰åº”ç”¨ã€‚</p></li><li><p><strong>DIM(Dimension)ï¼šç»´è¡¨</strong></p><p>åœ¨å®æ—¶è®¡ç®—ä¸­éå¸¸é‡è¦ï¼Œä¹Ÿæ˜¯é‡ç‚¹ç»´æŠ¤çš„éƒ¨åˆ†ï¼Œç»´è¡¨éœ€è¦å®æ—¶æ›´æ–°ï¼Œä¸”ä¸‹æ¸¸åŸºäºæœ€æ–°çš„ç»´è¡¨è¿›è¡Œè®¡ç®—</p></li></ul><hr><p>referenceï¼š</p><p><a href="https://cloud.tencent.com/developer/article/1618182">å®æ—¶æ•°ä»“ | ä½ æƒ³è¦çš„æ•°ä»“åˆ†å±‚è®¾è®¡ä¸æŠ€æœ¯é€‰å‹ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘</a></p><ul><li>å®æ—¶æ•°ä»“æ˜¯æŒ‡åœ¨æ•°æ®ä»“åº“çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å®æ—¶æ•°æ®å¤„ç†å’Œåˆ†æåŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ•°æ®ç”Ÿæˆåç«‹å³è¿›è¡Œå¤„ç†å’Œåˆ†æï¼Œå¹¶åŠæ—¶åé¦ˆç»™ä¸šåŠ¡ç”¨æˆ·ã€‚å®æ—¶æ•°ä»“çš„å»ºè®¾éœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</li></ul><ol><li>æ•°æ®æºæ¥å…¥ï¼šå®æ—¶æ•°ä»“éœ€è¦åŠæ—¶åœ°å¤„ç†å’Œåˆ†ææ•°æ®ï¼Œå› æ­¤æ•°æ®æºçš„æ¥å…¥å¿…é¡»å®æ—¶æˆ–è¿‘å®æ—¶ï¼Œéœ€è¦è€ƒè™‘æ•°æ®æºçš„å¤šæ ·æ€§å’Œé«˜å¹¶å‘æ€§ã€‚</li><li>æ•°æ®è´¨é‡ï¼šæ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§å¯¹äºå®æ—¶æ•°ä»“çš„å»ºè®¾å°¤ä¸ºé‡è¦ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ã€è¿‡æ»¤ã€æ ¡éªŒç­‰æ“ä½œï¼Œä¿è¯æ•°æ®çš„è´¨é‡ã€‚</li><li>æ•°æ®é›†æˆï¼šå®æ—¶æ•°ä»“éœ€è¦æ•´åˆå¤šä¸ªæ•°æ®æºçš„æ•°æ®ï¼Œå› æ­¤éœ€è¦è¿›è¡Œæ•°æ®é›†æˆå’Œèåˆï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ã€‚</li><li>æ•°æ®æ¨¡å‹è®¾è®¡ï¼šæ•°æ®æ¨¡å‹æ˜¯å®æ—¶æ•°ä»“å»ºè®¾çš„æ ¸å¿ƒï¼Œéœ€è¦è®¾è®¡åˆç†çš„æ•°æ®æ¨¡å‹ï¼Œç¡®ä¿æ•°æ®çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚</li><li>å®æ—¶è®¡ç®—å’Œåˆ†æï¼šå®æ—¶æ•°ä»“éœ€è¦å…·å¤‡å®æ—¶è®¡ç®—å’Œåˆ†æèƒ½åŠ›ï¼Œéœ€è¦ä½¿ç”¨å®æ—¶è®¡ç®—å¼•æ“å’Œåˆ†æå·¥å…·ï¼Œå¯¹æ•°æ®è¿›è¡Œå®æ—¶å¤„ç†å’Œåˆ†æã€‚</li><li>æ•°æ®å®‰å…¨ï¼šå®æ—¶æ•°ä»“ä¸­çš„æ•°æ®å¯èƒ½æ¶‰åŠæ•æ„Ÿä¿¡æ¯ï¼Œéœ€è¦é‡‡å–ä¸€å®šçš„å®‰å…¨æªæ–½ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚</li><li>ç³»ç»Ÿè¿ç»´ï¼šå®æ—¶æ•°ä»“éœ€è¦è¿›è¡Œç³»ç»Ÿè¿ç»´å’Œç›‘æ§ï¼ŒåŒ…æ‹¬æ•°æ®å¤‡ä»½å’Œæ¢å¤ã€ç³»ç»Ÿè°ƒä¼˜ã€æ•…éšœå¤„ç†ç­‰æ–¹é¢ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå®æ—¶æ•°ä»“çš„å»ºè®¾éœ€è¦å…³æ³¨æ•°æ®æºæ¥å…¥ã€æ•°æ®è´¨é‡ã€æ•°æ®é›†æˆã€æ•°æ®æ¨¡å‹è®¾è®¡ã€å®æ—¶è®¡ç®—å’Œåˆ†æã€æ•°æ®å®‰å…¨ä»¥åŠç³»ç»Ÿè¿ç»´ç­‰å¤šä¸ªæ–¹é¢ï¼Œéœ€è¦æ ¹æ®å®é™…éœ€æ±‚å’Œåœºæ™¯è¿›è¡Œç»¼åˆè€ƒè™‘å’Œè§„åˆ’ã€‚</p><h2 id="æ•°æ®æ¹–"><a href="#æ•°æ®æ¹–" class="headerlink" title="æ•°æ®æ¹–"></a>æ•°æ®æ¹–</h2><p>æ•°æ®æ¹–ï¼Œç›®å‰å…³æ³¨åº¦æ¯”è¾ƒé«˜çš„æœ‰ Databricks æ¨å‡ºçš„ Delta Lakeã€Uber çš„ Hudi ä»¥åŠ Netflix çš„ Iceberg</p><p>reference <a href="https://mp.weixin.qq.com/s/m8-iFg-ekykWGrG3gXlLew">https://mp.weixin.qq.com/s/m8-iFg-ekykWGrG3gXlLew</a></p>]]></content>
      
      
      <categories>
          
          <category> Data Warehouse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>database</title>
      <link href="/2021/12/29/database/"/>
      <url>/2021/12/29/database/</url>
      
        <content type="html"><![CDATA[<h1 id="hbase"><a href="#hbase" class="headerlink" title="hbase"></a>hbase</h1><table><thead><tr><th>èŠ‚ç‚¹</th><th>ç«¯å£å·</th><th>åè®®</th><th>ä½¿ç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>zookeeper</td><td>2181</td><td></td><td>zkCli.sh -server zookeeper1:2181</td><td>å®¢æˆ·ç«¯æ¥å…¥</td></tr><tr><td>2888,3888</td><td></td><td>N/A</td><td>é›†ç¾¤å†…éƒ¨é€šè®¯</td><td></td></tr><tr><td>HDFS Namenode</td><td>9000</td><td>HDFS</td><td>hdfs dfs -ls hdfs://namenode1:9000/</td><td>å®¢æˆ·ç«¯æ¥å…¥</td></tr><tr><td>50070</td><td>HTTP</td><td><a href="http://namenode1:50070/">http://namenode1:50070/</a></td><td>é›†ç¾¤ç›‘æ§</td><td></td></tr><tr><td>HDFS SecondaryNamenode</td><td>50090</td><td>HTTP</td><td><a href="http://namenode1:50090/">http://namenode1:50090/</a></td><td>secondaryç›‘æ§</td></tr><tr><td>HDFS Datanode</td><td>50010</td><td></td><td>N/A</td><td>å®¢æˆ·ç«¯æ¥å…¥/å…¶ä»–èŠ‚ç‚¹æ¥å…¥</td></tr><tr><td>50020</td><td></td><td>N/A</td><td></td><td></td></tr><tr><td>50075</td><td>HTTP</td><td><a href="http://datanode1:50075/">http://datanode1:50075/</a></td><td>èŠ‚ç‚¹ç›‘æ§</td><td></td></tr><tr><td>HBase Master</td><td>16000</td><td></td><td>hbase-client-1.x.x.jar</td><td>RegionServeræ¥å…¥</td></tr><tr><td>16010</td><td>HTTP</td><td><a href="http://namenode1:16010/">http://namenode1:16010/</a></td><td>é›†ç¾¤ç›‘æ§</td><td></td></tr><tr><td>HBase RegionServer</td><td>16020</td><td></td><td>N/A</td><td>å®¢æˆ·ç«¯æ¥å…¥</td></tr><tr><td>16030</td><td>HTTP</td><td><a href="http://datanode1:16030/">http://datanode1:16030/</a></td><td>èŠ‚ç‚¹ç›‘æ§</td><td></td></tr></tbody></table><h1 id="neo4j"><a href="#neo4j" class="headerlink" title="neo4j"></a>neo4j</h1><h2 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h2><ul><li>cypherè¯­æ³•å¯¹å¤§å°å†™æ•æ„Ÿï¼Œæ³¨æ„å±æ€§çš„å¤§å°å†™</li><li>å¯¼å…¥csvå‡ºç°ä¹±ç æ—¶ï¼Œéœ€è¦é€šè¿‡è®°äº‹æœ¬æ›´æ”¹ç¼–ç æ ¼å¼ï¼Œå¦‚æœæ–‡æœ¬è¿‡å¤§ï¼Œéœ€è¦ä¸€æ®µä¸€æ®µçš„å¤åˆ¶ç²˜è´´åˆ°æ–°æ–‡æœ¬ä¸­ï¼Œä¸”ä»¥UTF-8æ ¼å¼ç¼–ç </li><li>MERGEå‘½ä»¤æ˜¯CREATEå‘½ä»¤å’ŒMATCHå‘½ä»¤çš„ç»„åˆã€‚<code>MERGE = CREATE + MATCH</code></li></ul><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>1.<br>â€‹    <strong>ç°è±¡</strong>ï¼š åœ¨å¤–éƒ¨å¤„ç†csvæ•°æ®ï¼Œå¯¼å…¥æœåŠ¡å™¨ï¼Œç„¶åload csvåˆ°neo4jä¸­ï¼Œå¯èƒ½ç”±äºæ–‡ä»¶æ‰€å±é—®é¢˜ï¼Œä¸èƒ½æˆåŠŸå¯¼å…¥csvï¼Œæç¤º<code>Couldn&#39;t load the external resource</code>çš„é”™è¯¯ã€‚<br>â€‹    <strong>è§£å†³</strong>ï¼šå¤åˆ¶å¯ä»¥å¯¼å…¥çš„csvæ–‡ä»¶ä¸ºå‰¯æœ¬ï¼ŒæŠŠå¾…å¯¼å…¥çš„æ•°æ®ç²˜è´´åˆ°å‰¯æœ¬ä¸­ï¼Œload csvå‰¯æœ¬å³å¯</p><p>2.<br>â€‹    <strong>ç°è±¡</strong>ï¼š åœ¨å¤–éƒ¨å¤„ç†csvæ•°æ®ï¼Œè¿›è¡Œmergeæ“ä½œçš„æ—¶å€™ï¼Œæç¤º<code>cannot merge using null property value for uid</code>çš„é”™è¯¯ã€‚<br>â€‹    <strong>è§£å†³</strong>ï¼šç»å‘ç°ï¼Œæ˜¯ç”±äºæŒ‡ä»¤ä¸­çš„å±æ€§æ‹¼å†™é”™è¯¯ï¼Œå¯¼è‡´<code>Neo.ClientError.Statement.SemanticError</code>çš„é”™è¯¯ï¼Œä¾‹å¦‚æŠŠ<code>sfzh</code>æ‹¼å†™æˆ<code>sfhm</code>ã€‚</p><p>3.<br>â€‹    <strong>ç°è±¡</strong>ï¼š å¤§é‡æ•°æ®çš„å¯¼å…¥é—®é¢˜ã€‚<br>â€‹    <strong>è§£å†³</strong>ï¼šéœ€ä½¿ç”¨<a href="https://neo4j.com/docs/operations-manual/current/tools/import/" title="å¤§é‡æ•°æ®çš„å¯¼å…¥">https://neo4j.com/docs/operations-manual/current/tools/import/</a><br>â€‹    <strong>æ³¨æ„</strong>ï¼š<code>Import tool is only for newly created databases.</code><br>â€‹        <code>You can use LOAD CSV cypher command to load into an existing database.</code>ä¹Ÿå°±æ˜¯è¯´neo4j-admin importåªä¼šåœ¨æ–°å»ºæ•°æ®åº“çš„æ—¶å€™ä¼šç”¨åˆ°</p><h1 id="clickhouse"><a href="#clickhouse" class="headerlink" title="clickhouse"></a>clickhouse</h1><h2 id="å­˜å‚¨æ¶æ„"><a href="#å­˜å‚¨æ¶æ„" class="headerlink" title="å­˜å‚¨æ¶æ„"></a>å­˜å‚¨æ¶æ„</h2><blockquote><p>Clickhouse å­˜å‚¨ä¸­çš„æœ€å°å•ä½æ˜¯ DataPartï¼Œå†™å…¥é“¾è·¯ä¸ºäº†æå‡ååï¼Œæ”¾å¼ƒäº†éƒ¨åˆ†å†™å…¥å®æ—¶å¯è§æ€§ï¼Œå³æ•°æ®æ”’æ‰¹å†™å…¥ï¼Œä¸€æ¬¡æ‰¹é‡å†™å…¥çš„æ•°æ®ä¼šè½ç›˜æˆä¸€ä¸ª DataPart.</p><p>å®ƒä¸åƒ Druid é‚£æ ·ä¸€æ¡ä¸€æ¡å®æ—¶æ‘„å…¥ã€‚ä½† ClickHouse æŠŠæ•°æ®å»¶è¿Ÿæ”’æ‰¹å†™å…¥çš„å·¥ä½œäº¤ç»™æ¥å®¢æˆ·ç«¯å®ç°ï¼Œæ¯”å¦‚è¾¾åˆ° 10 æ¡è®°å½•æˆ–æ¯è¿‡ 5s é—´éš”å†™å…¥ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯ä»¥åœ¨ç”¨æˆ·ä¾§å¹³è¡¡ååé‡å’Œæ—¶å»¶ï¼Œå¦‚æœåœ¨ä¸šåŠ¡é«˜å³°æœŸæµé‡ä¸æ˜¯å¤ªå¤§ï¼Œå¯ä»¥ç»“åˆå®é™…åœºæ™¯å°†å‚æ•°è°ƒå°ï¼Œä»¥è¾¾åˆ°æè‡´çš„å®æ—¶æ•ˆæœã€‚</p></blockquote><h2 id="æŸ¥è¯¢æ¶æ„"><a href="#æŸ¥è¯¢æ¶æ„" class="headerlink" title="æŸ¥è¯¢æ¶æ„"></a>æŸ¥è¯¢æ¶æ„</h2><h3 id="è®¡ç®—èƒ½åŠ›æ–¹é¢"><a href="#è®¡ç®—èƒ½åŠ›æ–¹é¢" class="headerlink" title="è®¡ç®—èƒ½åŠ›æ–¹é¢"></a>è®¡ç®—èƒ½åŠ›æ–¹é¢</h3><p>Clickhouse é‡‡ç”¨å‘é‡åŒ–å‡½æ•°å’Œ aggregator ç®—å­æå¤§åœ°æå‡äº†èšåˆè®¡ç®—æ€§èƒ½ï¼Œé…åˆå®Œå¤‡çš„ SQL èƒ½åŠ›ä½¿å¾—æ•°æ®åˆ†æå˜å¾—æ›´åŠ ç®€å•ã€çµæ´»ã€‚</p><h3 id="æ•°æ®æ‰«ææ–¹é¢"><a href="#æ•°æ®æ‰«ææ–¹é¢" class="headerlink" title="æ•°æ®æ‰«ææ–¹é¢"></a>æ•°æ®æ‰«ææ–¹é¢</h3><p>ClickHouse æ˜¯å®Œå…¨åˆ—å¼çš„å­˜å‚¨è®¡ç®—å¼•æ“ï¼Œè€Œä¸”æ˜¯ä»¥æœ‰åºå­˜å‚¨ä¸ºæ ¸å¿ƒï¼Œåœ¨æŸ¥è¯¢æ‰«ææ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šæ ¹æ®å­˜å‚¨çš„æœ‰åºæ€§ã€åˆ—å­˜å—ç»Ÿè®¡ä¿¡æ¯ã€åˆ†åŒºé”®ç­‰ä¿¡æ¯æ¨æ–­å‡ºéœ€è¦æ‰«æçš„åˆ—å­˜å—ï¼Œç„¶åè¿›è¡Œå¹¶è¡Œçš„æ•°æ®æ‰«æï¼Œåƒè¡¨è¾¾å¼è®¡ç®—ã€èšåˆç®—å­éƒ½æ˜¯åœ¨æ­£è§„çš„è®¡ç®—å¼•æ“ä¸­å¤„ç†ã€‚ä»è®¡ç®—å¼•æ“åˆ°æ•°æ®æ‰«æï¼Œæ•°æ®æµè½¬éƒ½æ˜¯ä»¥åˆ—å­˜å—ä¸ºå•ä½ï¼Œé«˜åº¦å‘é‡åŒ–çš„ã€‚</p><h3 id="é«˜å¹¶å‘æœåŠ¡æ–¹é¢"><a href="#é«˜å¹¶å‘æœåŠ¡æ–¹é¢" class="headerlink" title="é«˜å¹¶å‘æœåŠ¡æ–¹é¢"></a>é«˜å¹¶å‘æœåŠ¡æ–¹é¢</h3><p>Clickhouse çš„å¹¶å‘èƒ½åŠ›å…¶å®æ˜¯ä¸å¹¶è¡Œè®¡ç®—é‡å’Œæœºå™¨èµ„æºå†³å®šçš„ã€‚å¦‚æœæŸ¥è¯¢éœ€è¦æ‰«æçš„æ•°æ®é‡å’Œè®¡ç®—å¤æ‚åº¦å¾ˆå¤§ï¼Œå¹¶å‘åº¦å°±ä¼šé™ä½ï¼Œä½†æ˜¯å¦‚æœä¿è¯å•ä¸ª query çš„ latency è¶³å¤Ÿä½ï¼ˆå¢åŠ å†…å­˜å’Œ cpu èµ„æºï¼‰ï¼Œéƒ¨åˆ†åœºæ™¯ä¸‹ç”¨æˆ·å¯ä»¥é€šè¿‡è®¾ç½®åˆé€‚çš„ç³»ç»Ÿå‚æ•°æ¥æå‡å¹¶å‘èƒ½åŠ›ï¼Œæ¯”å¦‚ max_threads ç­‰ã€‚å…¶ä»–åˆ†æå‹ç³»ç»Ÿï¼ˆä¾‹å¦‚ Elasticsearchï¼‰çš„å¹¶å‘èƒ½åŠ›ä¸ºä»€ä¹ˆå¾ˆå¥½ï¼Œä» Cache è®¾è®¡å±‚é¢æ¥çœ‹ï¼ŒES çš„ Cache åŒ…æ‹¬ Query Cache, Request Cacheï¼ŒData Cacheï¼ŒIndex Cacheï¼Œä»æŸ¥è¯¢ç»“æœåˆ°ç´¢å¼•æ‰«æç»“æœå±‚å±‚çš„ Cache åŠ é€Ÿï¼Œå› ä¸º Elasticsearch è®¤ä¸ºå®ƒçš„åœºæ™¯ä¸‹å­˜åœ¨çƒ­ç‚¹æ•°æ®ï¼Œå¯èƒ½è¢«åå¤æŸ¥è¯¢ã€‚åè§‚ ClickHouseï¼Œåªæœ‰ä¸€ä¸ªé¢å‘ IO çš„ UnCompressedBlockCache å’Œç³»ç»Ÿçš„ PageCacheï¼Œä¸ºäº†å®ç°æ›´ä¼˜ç§€çš„å¹¶å‘ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°åœ¨ Clickhouse å¤–é¢åŠ ä¸€å±‚ Cacheï¼Œæ¯”å¦‚ redisï¼Œä½†æ˜¯åˆ†æåœºæ™¯ä¸‹çš„æ•°æ®å’ŒæŸ¥è¯¢éƒ½æ˜¯å¤šå˜çš„ï¼ŒæŸ¥è¯¢ç»“æœç­‰ Cache éƒ½ä¸å®¹æ˜“å‘½ä¸­ï¼Œè€Œä¸”åœ¨å¹¿æŠ•ä¸šåŠ¡ä¸­å®æ—¶æŸ¥è¯¢çš„æ•°æ®æ˜¯åŸºäº T ä¹‹åä¸æ–­æ›´æ–°çš„æ•°æ®ï¼Œå¦‚æœå¤–æŒ‚ç¼“å­˜å°†é™ä½æ•°æ®æŸ¥è¯¢çš„æ—¶æ•ˆæ€§ã€‚</p><h2 id="æŠ€å·§"><a href="#æŠ€å·§" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h2><h3 id="å”¯ä¸€é”®çº¦æŸ"><a href="#å”¯ä¸€é”®çº¦æŸ" class="headerlink" title="å”¯ä¸€é”®çº¦æŸ"></a>å”¯ä¸€é”®çº¦æŸ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> qilu.t_01(</span><br><span class="line">C1 String,</span><br><span class="line">C2 String,</span><br><span class="line">C3 String,</span><br><span class="line">C4 <span class="type">Date</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (C1) # è¦è®¾ç½®ä¸»é”®</span><br><span class="line">) engine<span class="operator">=</span>ReplacingMergeTree() # å¼•æ“è¦ç”¨ReplacingMergeTree</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> C1; # è¦è®¾ç½®æ’åº</span><br><span class="line"></span><br><span class="line">optimize <span class="keyword">table</span> t_01 <span class="keyword">FINAL</span>; # è¦å¼ºåˆ¶åˆå¹¶åˆ†åŒº</span><br></pre></td></tr></table></figure><h1 id="sqlite"><a href="#sqlite" class="headerlink" title="sqlite"></a>sqlite</h1><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rocky</span></span><br><span class="line">dnf install -y sqlite</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ubuntu</span></span><br><span class="line">apt-get install -y sqlite3</span><br></pre></td></tr></table></figure><h2 id="export-sql-file"><a href="#export-sql-file" class="headerlink" title="export sql file"></a>export sql file</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> init database</span></span><br><span class="line">sqlite3 /path/to/databaseFile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dump database</span></span><br><span class="line"><span class="meta">sqlite&gt;</span><span class="bash"> .output /path/to/<span class="built_in">export</span>/sqlFile  <span class="comment"># config output file path</span></span></span><br><span class="line"><span class="meta">sqlite&gt;</span><span class="bash"> .dump</span></span><br><span class="line"><span class="meta">sqlite&gt;</span><span class="bash"> .<span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure><h1 id="rqlite"><a href="#rqlite" class="headerlink" title="rqlite"></a>rqlite</h1><h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $GOPATH/src/github.com/rqlite/rqlite</span><br><span class="line">go install ./...  # install in $GOPATH/bin/ directory</span><br></pre></td></tr></table></figure><h2 id="deploy-cluster"><a href="#deploy-cluster" class="headerlink" title="deploy cluster"></a>deploy cluster</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> node 1</span></span><br><span class="line">nohup rqlited -node-id 1 -http-addr host1:4001 -raft-addr host1:4002 ~/rqlite/node &gt; rqlite.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. rqlited -node-id 1 -http-addr 172.20.7.232:4001 -raft-addr 172.20.7.232:4002 ~/rqlite/node</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> enter shell with host1 ip</span></span><br><span class="line">rqlite -H x.x.x.x -p 4001 </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check health</span></span><br><span class="line">curl http://x.x.x.x:4001/status | jq .</span><br><span class="line">curl http://x.x.x.x:4001/status?pretty</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> join cluster</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> node 2</span></span><br><span class="line">rqlited -node-id 2 -http-addr host2:4001 -raft-addr host2:4002 -join host1:4002 ~/node</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. nohup rqlited -node-id 2 -http-addr 172.20.7.233:14001 -raft-addr 172.20.7.233:14002 -join 172.20.7.232:14002 ~/rqlite/node &gt; rqlite.log 2&gt;&amp;1 &amp;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> node 3</span></span><br><span class="line">rqlited -node-id 3 -http-addr host3:4001 -raft-addr host3:4002 -join host1:4002 ~/node</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. nohup rqlited -node-id 3 -http-addr 172.20.7.234:14001 -raft-addr 172.20.7.234:14002 -join 172.20.7.232:14002 ~/rqlite/node &gt; rqlite.log 2&gt;&amp;1 &amp;</span></span><br></pre></td></tr></table></figure><h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.nodes</span><br><span class="line">172.20.7.232:14001&gt; .nodes</span><br><span class="line">1:</span><br><span class="line">  leader: false</span><br><span class="line">  time: 2.63e-7</span><br><span class="line">  time_s: 433ns</span><br><span class="line">  id: 1</span><br><span class="line">  api_addr: http://172.20.7.232:14001</span><br><span class="line">  addr: 172.20.7.232:14002</span><br><span class="line">  voter: true</span><br><span class="line">  reachable: true</span><br><span class="line">2:</span><br><span class="line">  time_s: 409ns</span><br><span class="line">  id: 2</span><br><span class="line">  api_addr: http://172.20.7.233:14001</span><br><span class="line">  addr: 172.20.7.233:14002</span><br><span class="line">  voter: true</span><br><span class="line">  reachable: true</span><br><span class="line">  leader: true</span><br><span class="line">  time: 2.34e-7</span><br><span class="line">3:</span><br><span class="line">  api_addr: http://172.20.7.234:14001</span><br><span class="line">  addr: 172.20.7.234:14002</span><br><span class="line">  voter: true</span><br><span class="line">  reachable: true</span><br><span class="line">  leader: false</span><br><span class="line">  time: 1.91e-7</span><br><span class="line">  time_s: 354ns</span><br><span class="line">  id: 3</span><br></pre></td></tr></table></figure><h2 id="Restoring-from-SQLite"><a href="#Restoring-from-SQLite" class="headerlink" title="Restoring from SQLite"></a><a href="https://rqlite.io/docs/guides/backup/#restoring-from-sqlite">Restoring from SQLite</a></h2><h2 id="load"><a href="#load" class="headerlink" title="load"></a>load</h2><ul><li><p>method 1</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Convert SQLite database file to <span class="built_in">set</span> of SQL statements and <span class="keyword">then</span> load</span></span><br><span class="line">~ $ echo &#x27;.dump&#x27; | sqlite3 restore.sqlite &gt; restore.dump</span><br><span class="line">~ $ curl -XPOST localhost:4001/db/load -H &quot;Content-type: text/plain&quot; --data-binary @restore.dump</span><br></pre></td></tr></table></figure></li><li><p>method 2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Load directly from the SQLite file, <span class="built_in">which</span> is the recommended process.</span></span><br><span class="line">~ $ curl -v -XPOST localhost:4001/db/load -H &quot;Content-type: application/octet-stream&quot; --data-binary @restore.dump  # restore.dump æ˜¯ sqlite dumpçš„æ–‡ä»¶ï¼Œdumpåç¼€ååªæ˜¯å­—é¢å«ä¹‰ï¼Œä¸æ˜¯å¼ºåˆ¶è¦æ±‚ï¼Œå‚è€ƒä¸Šæ–‡sqliteçš„dumpæ–‡ä»¶ï¼Œå¯¹åº”çš„æ˜¯ sqlFile æˆ– databaseFile</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. curl -v -XPOST 172.20.0.52:14001/db/load -H <span class="string">&quot;Content-type: application/octet-stream&quot;</span> --data-binary @dingoadm.db</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€… curl -v -XPOST 172.20.0.52:14001/db/load -H <span class="string">&quot;Content-type: application/octet-stream&quot;</span> --data-binary @dingoadm.sql</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="postgreSQL"><a href="#postgreSQL" class="headerlink" title="postgreSQL"></a>postgreSQL</h1><h3 id="ç»ˆç«¯ç™»å½•pg"><a href="#ç»ˆç«¯ç™»å½•pg" class="headerlink" title="ç»ˆç«¯ç™»å½•pg"></a>ç»ˆç«¯ç™»å½•pg</h3><ul><li><p>å¦‚æœä¹‹å‰æ²¡æœ‰ç™»å½•è¿‡ï¼Œéœ€è¦è®¾ç½®å½“å‰ç”¨æˆ·è¿›è¡Œç™»å½•æ“ä½œ</p><p>There is no default username and password without you creating one. The simplest possible setup is to follow these steps to set up your own user as a superuser.</p><p>At a terminal prompt, create a postgres user with your own username</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres createuser --superuser $USER# $USERæ— é¡»æ›¿æ¢</span><br></pre></td></tr></table></figure><p>Start the postgresql command prompt as your username but running as root since you didnâ€™t set a password yet;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres psql</span><br></pre></td></tr></table></figure><p>At the postgresql prompt, set your password;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\password $USER    # å…¶ä¸­$USERéœ€è¦æ›¿æ¢æˆå½“å‰ç”¨æˆ·å</span><br></pre></td></tr></table></figure><p>After that, you should be able to log on just fine.</p></li></ul><ul><li><p>å¦‚æœä¹‹å‰è®¾ç½®äº†ä¸Šé¢çš„æ­¥éª¤ï¼Œå¯ç›´æ¥è¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql postgres</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¯¼å…¥æ–‡ä»¶"><a href="#å¯¼å…¥æ–‡ä»¶" class="headerlink" title="å¯¼å…¥æ–‡ä»¶"></a>å¯¼å…¥æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psql postgres# login command</span><br><span class="line">\c some_database# choose database</span><br><span class="line">\i \path\TO\file_name.sql# execute sql</span><br></pre></td></tr></table></figure><h3 id="è¿æ¥æŒ‡å®šschema"><a href="#è¿æ¥æŒ‡å®šschema" class="headerlink" title="è¿æ¥æŒ‡å®šschema"></a>è¿æ¥æŒ‡å®šschema</h3><ul><li><p>å¦‚æœä¸æŒ‡å®šschemaçš„è¯ï¼Œä¼šé»˜è®¤è®¿é—®publicçš„schema</p></li><li><p>æŒ‡å®šschema</p><p><code>jdbc:postgresql://localhost:5432/mydatabase?currentSchema=myschema</code></p></li></ul><h1 id="starrocks"><a href="#starrocks" class="headerlink" title="starrocks"></a>starrocks</h1><h2 id="å®‰è£…éƒ¨ç½²"><a href="#å®‰è£…éƒ¨ç½²" class="headerlink" title="å®‰è£…éƒ¨ç½²"></a>å®‰è£…éƒ¨ç½²</h2><h2 id="æ³¨æ„é¡¹"><a href="#æ³¨æ„é¡¹" class="headerlink" title="æ³¨æ„é¡¹"></a>æ³¨æ„é¡¹</h2><ul><li><p>å®‰è£…å‰é…ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export STARROCKS_HOME=xxx</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨mysqlå®¢æˆ·ç«¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h &lt;fe_ip&gt; -P&lt;fe_query_port&gt; -uroot -p # å¯†ç ä¸ºç©ºï¼Œç›´æ¥å›è½¦å³å¯</span><br></pre></td></tr></table></figure></li></ul><hr><h2 id="FE"><a href="#FE" class="headerlink" title="FE"></a>FE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp | grep 18030</span><br><span class="line">netstat -tunlp | grep 19010</span><br><span class="line">netstat -tunlp | grep 19020</span><br><span class="line">netstat -tunlp | grep 19030</span><br><span class="line"></span><br><span class="line">http_port = 18030</span><br><span class="line">rpc_port = 19020</span><br><span class="line">query_port = 19030</span><br><span class="line">edit_log_port = 19010</span><br></pre></td></tr></table></figure><ul><li><p>å¯åŠ¨FE<br><code>start_fe.sh --daemon</code></p></li><li><p>æŸ¥çœ‹FEçŠ¶æ€+<br><code>SHOW PROC &#39;/frontends&#39;\G</code></p></li><li><p>æ·»åŠ æ–°FEèŠ‚ç‚¹ï¼ˆfollowå’Œobserver)<br><code>./start_fe.sh --helper 172.18.244.74:19010 --daemon</code></p><p>æ³¨æ„ï¼š</p><ul><li><p>åœ¨mysql commandå…ˆå°†å®ä¾‹æ·»åŠ è¿›é›†ç¾¤ï¼Œç„¶åé€ä¸ªå¯åŠ¨å®ä¾‹ã€‚ï¼ˆåªåœ¨é¦–æ¬¡æ–°å¢èŠ‚ç‚¹æ—¶æ“ä½œï¼‰</p></li><li><p>å„ä¸ªèŠ‚ç‚¹çš„æ—¶é—´ä¸€å®šè¦åŒæ­¥ï¼Œä¸ç„¶FEçš„å¿ƒè·³è¶…è¿‡5sæ—¶å·®ï¼Œå°±ä¼šæŠ¥é”™</p></li></ul></li><li><p>æ‰©å®¹FE<br><code>ALTER SYSTEM ADD FOLLOWER &#39;ip:19010&#39;;</code><br><code>ALTER SYSTEM ADD observer &#39;ip:19010&#39;;</code></p></li><li><p>ç¼©å®¹FE<br><code>ALTER SYSTEM DROP follower &quot;ip:19010&quot;;</code><br><code>ALTER SYSTEM DROP observer &quot;ip:19010&quot;;</code></p></li></ul><hr><h2 id="BE"><a href="#BE" class="headerlink" title="BE"></a>BE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp | grep 19060</span><br><span class="line">netstat -tunlp | grep 18040</span><br><span class="line">netstat -tunlp | grep 19050</span><br><span class="line">netstat -tunlp | grep 18060</span><br><span class="line"></span><br><span class="line">be_port = 19060</span><br><span class="line">be_http_port = 18040</span><br><span class="line">heartbeat_service_port = 19050</span><br><span class="line">brpc_port = 18060</span><br></pre></td></tr></table></figure><ul><li><p>æŸ¥çœ‹BEçŠ¶æ€<br><code>SHOW PROC &#39;/backends&#39;\G</code></p></li><li><p>å¯åŠ¨BE<br><code>./start_be.sh --daemon</code></p></li><li><p>æ·»åŠ BEèŠ‚ç‚¹<br><code>ALTER SYSTEM ADD BACKEND &quot;172.18.244.74:19050&quot;;</code></p></li><li><p>ç¼©å®¹BEèŠ‚ç‚¹<br><code>ALTER SYSTEM DECOMMISSION BACKEND &quot;172.18.244.74:19050&quot;;</code><br>ç­‰å¾…è¯¥èŠ‚ç‚¹BEä»åˆ—è¡¨ä¸­æ¶ˆå¤±ï¼ˆæŸ¥çœ‹å‘½ä»¤SHOW PROC â€˜/backendsâ€™;ï¼‰ï¼Œå³å¯ä½¿ç”¨./stop_be.shåœæ‰æœåŠ¡</p></li><li><p>å´©æºƒæ’æŸ¥æ—¥å¿—<code>be.out</code></p></li></ul><hr><h2 id="é…ç½®ä¿®æ”¹"><a href="#é…ç½®ä¿®æ”¹" class="headerlink" title="é…ç½®ä¿®æ”¹"></a>é…ç½®ä¿®æ”¹</h2><ul><li>FEä¿®æ”¹ç«¯å£ä¿¡æ¯ï¼Œéœ€è¦æ¸…ç†meta</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. é‡å»ºmetaç›®å½•</span><br><span class="line">2. é‡å¯ä¸»èŠ‚ç‚¹FE</span><br><span class="line">3. ç™»å½•mysql commandï¼Œæ·»åŠ æ–°FEèŠ‚ç‚¹ï¼ˆfollowå’Œobserverï¼‰ï¼Œæ·»åŠ BEèŠ‚ç‚¹</span><br><span class="line">4. å¯åŠ¨followerå’ŒobserverèŠ‚ç‚¹</span><br></pre></td></tr></table></figure><ul><li>BEä¿®æ”¹ç«¯å£ä¿¡æ¯ï¼Œéœ€è¦æ¸…ç†storage</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. é‡å»ºstorageç›®å½•ï¼ˆæ˜¯å¦å¯ä»¥ä¿®æ”¹cluster_idè¿›è¡Œé›†ç¾¤å¤„ç†ï¼‰</span><br><span class="line">2. é€ä¸ªå¯åŠ¨BEæœåŠ¡</span><br><span class="line">3. ç™»å½•mysql commandï¼Œæ·»åŠ æ–°BEèŠ‚ç‚¹ï¼ˆALTER SYSTEM ADD BACKEND &quot;ip:19050&quot;;ï¼‰</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å¯†ç <br><code>SET PASSWORD = PASSWORD(&#39;datacanvas&#39;)</code></li></ul><h2 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h2><ul><li>èŠ‚ç‚¹æ—¶é—´éœ€è¦åŒæ­¥ï¼ˆå»¶è¿Ÿéœ€è¦åœ¨5ç§’å†…ï¼‰ï¼Œä¸ç„¶starrocksæ— æ³•æ‰©å®¹FEèŠ‚ç‚¹</li></ul><h1 id="tools"><a href="#tools" class="headerlink" title="tools"></a>tools</h1><h2 id="logstash"><a href="#logstash" class="headerlink" title="logstash"></a>logstash</h2><ul><li><p>Logstash Forwarder/Beatsè´Ÿè´£åœ¨æºæœåŠ¡å™¨ä¸Šæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°é›†ä¸­å¼çš„Logstashæˆ–KafkaæœåŠ¡å™¨ã€‚</p></li><li><p>Logstashæ˜¯ä¸€ä¸ªçµæ´»çš„æ•°æ®æ”¶é›†å¼•æ“ï¼Œå®ƒå¯ä»¥ä»å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬æ—¥å¿—æ–‡ä»¶ã€æ ‡å‡†è¾“å…¥ã€Beatsç­‰ï¼‰é‡‡é›†æ•°æ®ï¼Œè¿›è¡Œè½¬æ¢ã€è¿‡æ»¤å’Œè§£æï¼Œæœ€åå°†æ•°æ®å‘é€åˆ°å„ç§ç›®çš„åœ°ï¼Œæ¯”å¦‚Elasticsearchã€Kafkaç­‰ã€‚åœ¨æ—¥å¿—å¤„ç†ä¸­ï¼ŒLogstashå¸¸è¢«ç”¨ä½œæ•°æ®çš„è½¬æ¢å’Œé¢„å¤„ç†å·¥å…·ã€‚</p></li></ul><h1 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h1><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul><li><p>about date jdbcType</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#&#123;beginDate,jdbcType=DATE&#125; (no time of the day), or</span><br><span class="line">#&#123;beginDate,jdbcType=TIMESTAMP&#125; (if you need to include the time of the day).</span><br></pre></td></tr></table></figure></li></ul><p>And the Java parameter you want to apply should be of type:</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.sql.Date (date without time)</span><br><span class="line">java.sql.Timestamp (timestamp)</span><br><span class="line">java.util.Date (date and time).</span><br></pre></td></tr></table></figure><ul><li><p>the Greater Than/Equal Operator and the Less Than/Equal Operators:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ROWNUM &amp;gt;= 20</span><br><span class="line">ROWNUM &amp;lt;= 20</span><br></pre></td></tr></table></figure></li></ul><h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p>ä½¿ç”¨SpringMVC+Mybatisæ¡†æ¶å†™é¡¹ç›®çš„æ—¶å€™ï¼Œåœ¨mapperé‡Œé¢çš„sqlè¯­å¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">and update_time <span class="symbol">&amp;gt;</span> #&#123;updateTime,jdbcType=TIMESTAMP&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å‡ºé”™ï¼š<code>There is no getter for property named &#39;updateTime&#39; in &#39;class java.util.Date&#39;</code></p><p>åŸå› æ˜¯ï¼š<br>å¦‚æœå°†andè¯­å¥ä¸­çš„#ï½›å±æ€§ï½å†™åœ¨ifè¯­å¥ä¸­ï¼Œmybatisä¼šå»å¯¹è±¡ä¸­ä»å®ƒçš„getæ–¹æ³•ä¸­å–å€¼ï¼Œè€Œæˆ‘ä¹‹å‰æ˜¯ç›´æ¥ä¼ é€’çš„å€¼ï¼Œå¹¶æ²¡æœ‰å°è£…å¯¹è±¡ã€‚<br>è§£å†³åŠæ³•ï¼š</p><pre><code> 1. æŠŠupdateTimeéœ€æ”¹ä¸ºdate 2. æŠŠupdateTimeä»£è¡¨çš„å‚æ•°å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­</code></pre>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> point </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cdc &amp; å®æ—¶æ•°ä»“ points</title>
      <link href="/2021/12/29/cdc/"/>
      <url>/2021/12/29/cdc/</url>
      
        <content type="html"><![CDATA[<p><strong>Change Data Captureï¼ˆå˜æ›´æ•°æ®è·å–ï¼‰</strong></p><p>æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œç›‘æµ‹å¹¶æ•è·æ•°æ®åº“çš„å˜åŠ¨ï¼ˆåŒ…æ‹¬æ•°æ®æˆ–æ•°æ®è¡¨çš„æ’å…¥ã€æ›´æ–°ä»¥åŠåˆ é™¤ç­‰ï¼‰ï¼Œå°†è¿™äº›å˜æ›´æŒ‰å‘ç”Ÿçš„é¡ºåºå®Œæ•´è®°å½•ä¸‹æ¥ï¼Œå†™å…¥åˆ°æ¶ˆæ¯ä¸­é—´ä»¶ä¸­ä»¥ä¾›å…¶ä»–æœåŠ¡è¿›è¡Œè®¢é˜…åŠæ¶ˆè´¹ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li><strong>æ•°æ®åŒæ­¥</strong>ï¼Œç”¨äºå¤‡ä»½ï¼Œå®¹ç¾ï¼›</li><li><strong>æ•°æ®åˆ†å‘</strong>ï¼Œä¸€ä¸ªæ•°æ®æºåˆ†å‘ç»™å¤šä¸ªä¸‹æ¸¸ï¼›</li><li><strong>æ•°æ®é‡‡é›†</strong>(E)ï¼Œé¢å‘æ•°æ®ä»“åº“/æ•°æ®æ¹–çš„ ETL æ•°æ®é›†æˆã€‚</li></ul><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>ä¸»è¦åˆ†ä¸º<strong>åŸºäºæŸ¥è¯¢</strong>å’Œ<strong>åŸºäº Binlog</strong> ä¸¤ç§æ–¹å¼</p><h3 id="ä¼ ç»Ÿ-CDC-ETL"><a href="#ä¼ ç»Ÿ-CDC-ETL" class="headerlink" title="ä¼ ç»Ÿ CDC ETL"></a>ä¼ ç»Ÿ CDC ETL</h3><p><img src="/images/cdc/cdc_etl.png"></p><h3 id="åŸºäº-Flink-CDC-çš„-ETL-åˆ†æ"><a href="#åŸºäº-Flink-CDC-çš„-ETL-åˆ†æ" class="headerlink" title="åŸºäº Flink CDC çš„ ETL åˆ†æ"></a>åŸºäº Flink CDC çš„ ETL åˆ†æ</h3><p><img src="/images/cdc/flink_cdc_etl.png"></p><h3 id="åŸºäº-Flink-CDC-çš„èšåˆåˆ†æ"><a href="#åŸºäº-Flink-CDC-çš„èšåˆåˆ†æ" class="headerlink" title="åŸºäº Flink CDC çš„èšåˆåˆ†æ"></a>åŸºäº Flink CDC çš„èšåˆåˆ†æ</h3><p><img src="/images/cdc/flink_cdc_aggregate.png"></p><h3 id="åŸºäº-Flink-CDC-çš„æ•°æ®æ‰“å®½"><a href="#åŸºäº-Flink-CDC-çš„æ•°æ®æ‰“å®½" class="headerlink" title="åŸºäº Flink CDC çš„æ•°æ®æ‰“å®½"></a>åŸºäº Flink CDC çš„æ•°æ®æ‰“å®½</h3><p><img src="/images/cdc/flink_cdc_merge.png"></p><h2 id="æ€§èƒ½ç‚¹"><a href="#æ€§èƒ½ç‚¹" class="headerlink" title="æ€§èƒ½ç‚¹"></a>æ€§èƒ½ç‚¹</h2><p>å¤§æ•°æ®é¢†åŸŸçš„ 4 ç±»åœºæ™¯ï¼š</p><p><strong>B</strong>    batch    ç¦»çº¿è®¡ç®—</p><p><strong>A</strong>    Analytical    äº¤äº’å¼åˆ†æ</p><p><strong>S</strong>    Servering    é«˜å¹¶å‘çš„åœ¨çº¿æœåŠ¡</p><p><strong>T</strong>    Transaction    äº‹åŠ¡éš”ç¦»æœºåˆ¶</p><blockquote><p>ç¦»çº¿è®¡ç®—é€šå¸¸åœ¨è®¡ç®—å±‚ï¼Œæ‰€ä»¥åº”è¯¥é‡ç‚¹è€ƒè™‘ Aã€S å’Œ T</p></blockquote><h2 id="è€ƒè™‘ç‚¹"><a href="#è€ƒè™‘ç‚¹" class="headerlink" title="è€ƒè™‘ç‚¹"></a>è€ƒè™‘ç‚¹</h2><ul><li><p>ä¿è¯ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ï¼ŒåŒ…æ‹¬ç»´åº¦ä¸€è‡´æ€§ä»¥åŠå…¨æµç¨‹æ•°æ®ä¸€è‡´æ€§;</p></li><li><p>å®æ—¶æµå¤„ç†è¿‡ç¨‹ä¸­æ•°æ®åˆ°è¾¾é¡ºåºæ— æ³•é¢„çŸ¥æ—¶ï¼Œå¦‚ä½•ä¿è¯åŒæµ join æ—¶æ•°æ®èƒ½åŠæ—¶å…³è”åŒæ—¶ä¸é€ æˆæ•°æ®å µå¡ï¼›</p></li><li><p>Oracle</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.Oracle æ˜¯ç¬¬ä¸‰æ–¹å‚å•†ç»´æŠ¤çš„ï¼Œä¸å…è®¸å¯¹çº¿ä¸Šç³»ç»Ÿæœ‰è¿‡å¤šçš„ä¾µå…¥ï¼Œå®¹æ˜“é€ æˆç›‘å¬æ•…éšœç”šè‡³ç³»ç»Ÿç˜«ç—ªï¼Œ</span><br><span class="line">2.å½’æ¡£æ—¥å¿—æ˜¯åœ¨å¼€å¯é‚£ä¸€åˆ»èµ·æ‰å¼€å§‹ç”Ÿæˆçš„ï¼Œä¹‹å‰çš„å­˜é‡æ•°æ®éš¾ä»¥è¿›å…¥ kafkaï¼Œä½†æ˜¯åæ¥å®æ—¶æ•°æ®åˆå¿…é¡»ä¾èµ–å‰é¢çš„è®¡ç®—ç»“æœ</span><br></pre></td></tr></table></figure></li></ul><h2 id="å®æ—¶æ•°ä»“æ–¹æ¡ˆ"><a href="#å®æ—¶æ•°ä»“æ–¹æ¡ˆ" class="headerlink" title="å®æ—¶æ•°ä»“æ–¹æ¡ˆ"></a>å®æ—¶æ•°ä»“æ–¹æ¡ˆ</h2><h3 id="Lambda-æ¶æ„"><a href="#Lambda-æ¶æ„" class="headerlink" title="Lambda æ¶æ„"></a>Lambda æ¶æ„</h3><blockquote><p>ç›®å‰ä¸»æµçš„ä¸€å¥—å®æ—¶æ•°ä»“æ¶æ„ï¼Œå­˜åœ¨ç¦»çº¿å’Œå®æ—¶ä¸¤æ¡é“¾è·¯ã€‚å®æ—¶éƒ¨åˆ†ä»¥æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼å®æ—¶å¢é‡æ¶ˆè´¹ï¼Œä¸€èˆ¬ä»¥ Flink+Kafka çš„ç»„åˆå®ç°ï¼Œç»´åº¦è¡¨å­˜åœ¨å…³ç³»å‹æ•°æ®åº“æˆ–è€… HBaseï¼›ç¦»çº¿éƒ¨åˆ†ä¸€èˆ¬é‡‡ç”¨ T+1 å‘¨æœŸè°ƒåº¦åˆ†æå†å²å­˜é‡æ•°æ®ï¼Œæ¯å¤©å‡Œæ™¨äº§å‡ºï¼Œæ›´æ–°è¦†ç›–å‰ä¸€å¤©çš„ç»“æœæ•°æ®ï¼Œè®¡ç®—å¼•æ“é€šå¸¸ä¼šé€‰æ‹© Hive æˆ–è€… Sparkã€‚</p></blockquote><p><img src="/images/cdc/structure_lambda.png"></p><h3 id="Kappa-æ¶æ„"><a href="#Kappa-æ¶æ„" class="headerlink" title="Kappa æ¶æ„"></a>Kappa æ¶æ„</h3><blockquote><p>ç›¸è¾ƒäº Lambda æ¶æ„ï¼Œå®ƒç§»é™¤äº†ç¦»çº¿ç”Ÿäº§é“¾è·¯ï¼Œæ€è·¯æ˜¯é€šè¿‡ä¼ é€’ä»»æ„æƒ³è¦çš„ offset(åç§»é‡)æ¥è¾¾åˆ°é‡æ–°æ¶ˆè´¹å¤„ç†å†å²æ•°æ®çš„ç›®çš„ã€‚ä¼˜ç‚¹æ˜¯æ¶æ„ç›¸å¯¹ç®€åŒ–ï¼Œæ•°æ®æ¥æºå•ä¸€ï¼Œå…±ç”¨ä¸€å¥—ä»£ç ï¼Œå¼€å‘æ•ˆç‡é«˜ï¼›ç¼ºç‚¹æ˜¯å¿…é¡»è¦æ±‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¿å­˜äº†å­˜é‡æ•°æ®ï¼Œè€Œä¸”ä¸»è¦ä¸šåŠ¡é€»è¾‘åœ¨è®¡ç®—å±‚ï¼Œæ¯”è¾ƒæ¶ˆè€—å†…å­˜èµ„æºã€‚</p></blockquote><p><img src="/images/cdc/structure_kappa.png"></p><h3 id="OLAP-å˜ä½“æ¶æ„"><a href="#OLAP-å˜ä½“æ¶æ„" class="headerlink" title="OLAP å˜ä½“æ¶æ„"></a>OLAP å˜ä½“æ¶æ„</h3><blockquote><p>æ˜¯ Kappa æ¶æ„çš„è¿›ä¸€æ­¥æ¼”åŒ–ï¼Œå®ƒçš„æ€è·¯æ˜¯å°†èšåˆåˆ†æè®¡ç®—ç”± OLAP å¼•æ“æ‰¿æ‹…ï¼Œå‡è½»å®æ—¶è®¡ç®—éƒ¨åˆ†çš„èšåˆå¤„ç†å‹åŠ›ã€‚ä¼˜ç‚¹æ˜¯è‡ªç”±åº¦é«˜ï¼Œå¯ä»¥æ»¡è¶³æ•°æ®åˆ†æå¸ˆçš„å®æ—¶è‡ªåŠ©åˆ†æéœ€æ±‚ï¼Œå‡è½»äº†è®¡ç®—å¼•æ“çš„å¤„ç†å‹åŠ›ï¼›ç¼ºç‚¹æ˜¯å¿…é¡»è¦æ±‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¿å­˜å­˜é‡æ•°æ®ï¼Œä¸”å› ä¸ºæ˜¯å°†è®¡ç®—éƒ¨åˆ†çš„å‹åŠ›è½¬ç§»åˆ°äº†æŸ¥è¯¢å±‚ï¼Œå¯¹æŸ¥è¯¢å¼•æ“çš„ååå’Œå®æ—¶æ‘„å…¥æ€§èƒ½è¦æ±‚è¾ƒé«˜ã€‚</p></blockquote><p><img src="/images/cdc/structure_olap.png"></p><h3 id="æ•°æ®æ¹–æ¶æ„"><a href="#æ•°æ®æ¹–æ¶æ„" class="headerlink" title="æ•°æ®æ¹–æ¶æ„"></a>æ•°æ®æ¹–æ¶æ„</h3><blockquote><p>å­˜å‚¨ã€è®¡ç®—å’ŒæŸ¥è¯¢ï¼Œåˆ†åˆ«ç”±ä¸‰ä¸ªç‹¬ç«‹äº§å“è´Ÿè´£ï¼Œåˆ†åˆ«æ˜¯æ•°æ®æ¹–ã€Flink å’Œ Clickhouseã€‚æ•°ä»“åˆ†å±‚å­˜å‚¨å’Œç»´åº¦è¡¨ç®¡ç†å‡ç”±æ•°æ®æ¹–æ‰¿æ‹…ï¼ŒFlink SQL è´Ÿè´£æ‰¹æµä»»åŠ¡çš„ SQL åŒ–ååŒå¼€å‘ï¼ŒClickhouse å®ç°å˜ä½“çš„äº‹åŠ¡æœºåˆ¶ï¼Œä¸ºç”¨æˆ·æä¾›ç¦»çº¿åˆ†æå’Œäº¤äº’æŸ¥è¯¢ã€‚CDC åˆ°æ¶ˆæ¯é˜Ÿåˆ—è¿™ä¸€é“¾è·¯å°†æ¥æ˜¯å®Œå…¨å¯ä»¥å»æ‰çš„ï¼Œåªéœ€è¦ Flink CDC å®¶æ—ä¸­å†æ·»åŠ  Oracle CDC ä¸€å‘˜ã€‚æœªæ¥ï¼Œå®æ—¶æ•°ä»“æ¶æ„å°†å¾—åˆ°æè‡´çš„ç®€åŒ–å¹¶ä¸”æ€§èƒ½æœ‰è´¨çš„æå‡ã€‚</p></blockquote><p><img src="/images/cdc/structure_rtdb.png"></p>]]></content>
      
      
      <categories>
          
          <category> cdc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> point </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macos</title>
      <link href="/2021/12/20/macos/"/>
      <url>/2021/12/20/macos/</url>
      
        <content type="html"><![CDATA[<h1 id="shortcuts"><a href="#shortcuts" class="headerlink" title="shortcuts"></a>shortcuts</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">âŒƒâŒ˜+F   æœ€å¤§åŒ–çª—å£</span><br><span class="line">âŒ˜+M    æœ€å°åŒ–çª—å£</span><br><span class="line">âŒ˜+H    éšè—ç¨‹åºçš„æ‰€æœ‰çª—å£</span><br><span class="line">âŒ˜+W    å…³é—­çª—å£</span><br><span class="line">âŒ˜+Q    å…³é—­ç¨‹åº</span><br><span class="line">shift + âŒ˜ + 5    æˆªå±</span><br><span class="line">Homeé”®   Fn+å·¦æ–¹å‘</span><br><span class="line">Endé”®    Fn+å³æ–¹å‘</span><br><span class="line">Control+Space  è¾“å…¥æ³•åˆ‡æ¢</span><br><span class="line">command + shift + . æ˜¾ç¤º/éšè—æ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line">Fn-ä¸Šç®­å¤´ï¼šPage Upï¼šå‘ä¸Šæ»šåŠ¨ä¸€é¡µ</span><br><span class="line">Fn-ä¸‹ç®­å¤´ï¼šPage Downï¼šå‘ä¸‹æ»šåŠ¨ä¸€é¡µ</span><br><span class="line">Fn-å·¦ç®­å¤´ï¼šHomeï¼šæ»šåŠ¨åˆ°æ–‡ç¨¿å¼€å¤´</span><br><span class="line">Fn-å³ç®­å¤´ï¼šEndï¼šæ»šåŠ¨åˆ°æ–‡ç¨¿æœ«å°¾</span><br></pre></td></tr></table></figure><p><strong>tips</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> âŒ˜ = <span class="built_in">command</span></span></span><br><span class="line">æˆªå±ï¼šShift + Command + 4</span><br><span class="line">å±å¹•å½•åˆ¶ï¼šShift + Command + 5</span><br><span class="line">èƒŒæ™¯éŸ³ï¼šbackground sounds</span><br></pre></td></tr></table></figure><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><h2 id="brew"><a href="#brew" class="headerlink" title="brew"></a>brew</h2><ul><li><p>Disable  auto update when install </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">temp method 1:</span><br><span class="line">HOMEBREW_NO_AUTO_UPDATE=1 brew install &lt;formula&gt;</span><br><span class="line"></span><br><span class="line">temp method 2:</span><br><span class="line">export HOMEBREW_NO_AUTO_UPDATE=1</span><br><span class="line"></span><br><span class="line">permanently method:</span><br><span class="line"><span class="meta">$</span><span class="bash"> vim ~/.bashrc</span></span><br><span class="line">export HOMEBREW_NO_AUTO_UPDATE=1</span><br><span class="line">source ~/.bashrc</span><br><span class="line">or</span><br><span class="line"><span class="meta">$</span><span class="bash"> vim ~/.zshrc</span></span><br><span class="line">export HOMEBREW_NO_AUTO_UPDATE=1</span><br><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure></li><li><p>upgrade app</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOMEBREW_NO_AUTO_UPDATE=1 brew upgrade &lt;app&gt;  # disable update</span><br></pre></td></tr></table></figure></li></ul><h2 id="PORT"><a href="#PORT" class="headerlink" title="PORT"></a>PORT</h2><ul><li><p>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹pidçš„å ç”¨ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i -P -n | grep LISTEN | grep &#123;pid&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo asitop --interval 10</span><br></pre></td></tr></table></figure><h2 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h2><p>top -l 1 | head -n 10</p><h2 id="finder"><a href="#finder" class="headerlink" title="finder"></a>finder</h2><p>å¿«é€Ÿå®šä½ç›®å½• Shift + Command + G</p><p>æ˜¾ç¤ºéšè—æ–‡ä»¶ Shift + Command + .</p><h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><p>The Mac equivalent to <code>systemctl</code> or <code>service</code> is <code>launchctl</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„ plist æœåŠ¡</span></span><br><span class="line">launchctl list</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨æœåŠ¡</span></span><br><span class="line">launchctl <span class="built_in">disable</span> /Library/LaunchDaemons/com.simonkuang.macos.coredns.plist</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨æœåŠ¡</span></span><br><span class="line">launchctl <span class="built_in">disable</span> /Library/LaunchDaemons/com.simonkuang.macos.coredns.plist</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€æ­»è¿›ç¨‹ï¼ˆä¸ä¼˜é›…åœ°æ€ï¼Œç›´æ¥æ€è¿›ç¨‹ï¼‰å¹¶é‡å¯æœåŠ¡ã€‚å¯¹ä¸€äº›åœæ­¢å“åº”çš„æœåŠ¡æœ‰æ•ˆã€‚</span></span><br><span class="line">launchctl kickstart -k /Library/LaunchDaemons/com.simonkuang.macos.coredns.plist</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸ä¿®æ”¹ Disabled é…ç½®çš„å‰æä¸‹å¯åŠ¨æœåŠ¡</span></span><br><span class="line">launchctl start /Library/LaunchDaemons/com.simonkuang.macos.coredns.plist</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸ä¿®æ”¹ Disabled é…ç½®çš„å‰æä¸‹åœæ­¢æœåŠ¡</span></span><br><span class="line">launchctl stop /Library/LaunchDaemons/com.simonkuang.macos.coredns.plist</span><br></pre></td></tr></table></figure><h2 id="extract"><a href="#extract" class="headerlink" title="extract"></a>extract</h2><ul><li>zip</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ditto -V -x -k --sequesterRsrc filename.zip destination</span><br></pre></td></tr></table></figure><h2 id="File"><a href="#File" class="headerlink" title="File"></a>File</h2><ul><li>è§£å‹å¸¦æœ‰ä¸­æ–‡åç§°çš„zipåŒ…</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ditto -V -x -k --sequesterRsrc filename.zip destination</span><br></pre></td></tr></table></figure><ul><li><p>æŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶å¤¹å¤§å°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">du -d 1 -h    å‘½ä»¤æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤¹çš„å¤§å° -d æŒ‡æ·±åº¦ï¼Œåé¢åŠ ä¸€ä¸ªæ•°å€¼</span><br><span class="line">æˆ–</span><br><span class="line">du -hd1</span><br></pre></td></tr></table></figure></li></ul><h2 id="Install-pkg"><a href="#Install-pkg" class="headerlink" title="Install pkg"></a>Install pkg</h2><p>a.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo installer -pkg /path/to/package.pkg -target /</span><br><span class="line"><span class="comment"># will install the package in /Applications.</span></span><br></pre></td></tr></table></figure><p>Here <code>/</code> is the mount point of <code>Macintosh HD</code> volume. <code>-target</code> accepts path like <code>&quot;/Volumes/Macintosh HD&quot;</code>, or <code>/dev/disk0</code> also.</p><p>b.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">installer -pkg myapp.pkg -target CurrentUserHomeDirectory</span><br><span class="line"><span class="comment">#will install the package in ~/Applications.</span></span><br></pre></td></tr></table></figure><h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p><strong>Using base64 to decode some text</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base64 --decode</span><br><span class="line">VGhpcyBpcyBiYXNlNjQgZW5jb2RlZAo=</span><br><span class="line">[ctrl+d]</span><br></pre></td></tr></table></figure><h1 id="soft"><a href="#soft" class="headerlink" title="soft"></a>soft</h1><h2 id="wechat"><a href="#wechat" class="headerlink" title="wechat"></a>wechat</h2><ul><li><p>åœ¨ç³»ç»Ÿè¯­è¨€è®¾ç½®englishçš„æƒ…å†µä¸‹ï¼Œè®¾ç½®å¾®ä¿¡çš„language</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.tencent.xinWeChat AppleLanguages &#x27;(&quot;zh-CN&quot;)&#x27;</span><br></pre></td></tr></table></figure></li></ul><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><ul><li><a href="https://stackoverflow.com/questions/10757169/location-of-my-cnf-file-on-macos">https://stackoverflow.com/questions/10757169/location-of-my-cnf-file-on-macos</a>)</li></ul><p>æœªé€šè¿‡brewå®‰è£…ï¼Œå®‰è£…è·¯å¾„/usr/local/mysql</p><p>mysql    loginï¼š1qaz2wsx</p><ul><li><p>æš‚æœªé…ç½®my.cnfæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql --<span class="built_in">help</span> | grep my.cnf</span><br><span class="line">order of preference, my.cnf, <span class="variable">$MYSQL_TCP_PORT</span>,</span><br><span class="line">/etc/my.cnf /etc/mysql/my.cnf /usr/<span class="built_in">local</span>/mysql/etc/my.cnf ~/.my.cnf</span><br></pre></td></tr></table></figure></li><li><p><a href="https://stackoverflow.com/questions/10757169/location-of-my-cnf-file-on-macos">Location of my.cnf file on macOS</a></p></li></ul><h2 id="dbeaver"><a href="#dbeaver" class="headerlink" title="dbeaver"></a>dbeaver</h2><ul><li><p>scriptè„šæœ¬ä½ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/dongwei/Library/DBeaverData/workspace6/dingoDB/Scripts</span><br></pre></td></tr></table></figure></li></ul><h2 id="age"><a href="#age" class="headerlink" title="age"></a>age</h2><p>åŠ å¯†å·¥å…·ï¼Œé€šè¿‡brewå®‰è£…</p><h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><p>ç¯å¢ƒé…ç½® <code>ln -s /Applications/Docker.app/Contents/Resources/bin/docker /usr/local/bin/docker</code></p><p>å¯åŠ¨æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open -a Docker</span><br></pre></td></tr></table></figure><h2 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h2><ul><li>å®‰è£…ç›®å½• <code>/Users/dongwei/Applications/confluent-7.0.1</code></li><li>å¯åŠ¨å‘½ä»¤ å…ˆå¯åŠ¨zookeeperï¼Œç„¶åå¯åŠ¨kafka</li></ul><h2 id="wmvï¼ˆmicrosoftéŸ³é¢‘æ ¼å¼ï¼‰"><a href="#wmvï¼ˆmicrosoftéŸ³é¢‘æ ¼å¼ï¼‰" class="headerlink" title="wmvï¼ˆmicrosoftéŸ³é¢‘æ ¼å¼ï¼‰"></a>wmvï¼ˆmicrosoftéŸ³é¢‘æ ¼å¼ï¼‰</h2><ul><li>ä½¿ç”¨æ’­æ”¾è½¯ä»¶elmedia player</li></ul><h2 id="shadowsocksR-NG"><a href="#shadowsocksR-NG" class="headerlink" title="shadowsocksR-NG"></a>shadowsocksR-NG</h2><p>ä¼šæŠŠè‡ªå·±çš„logæ–‡ä»¶ï¼š<strong>ss-local.log</strong></p><p>ä¿å­˜åœ¨è·¯å¾„ï¼š~/Library/Logs/ss-local.log</p><p><a href="https://www.twisted-meadows.com/shadowsocksx-ng">https://www.twisted-meadows.com/shadowsocksx-ng</a></p><h2 id="clashx"><a href="#clashx" class="headerlink" title="clashx"></a>clashx</h2><p>è§£æåœ°å€å‡ºé”™æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ‚¨çš„è¿æ¥ä¸æ˜¯ç§å¯†è¿æ¥</span><br><span class="line">æ”»å‡»è€…å¯èƒ½ä¼šè¯•å›¾ä» [www.google.com](&lt;http://www.google.com/&gt;) çªƒå–æ‚¨çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šå¯†ç ã€é€šè®¯å†…å®¹æˆ–ä¿¡ç”¨å¡ä¿¡æ¯ï¼‰</span><br></pre></td></tr></table></figure><p>æ›´æ¢èŠ‚ç‚¹å³å¯</p><p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/11c3cef1-d99c-462a-b3c0-28a43b4b7f0a/Untitled.png" alt="Untitled"></p><h2 id="vscode"><a href="#vscode" class="headerlink" title="vscode"></a>vscode</h2><ul><li>å¤šè¡Œç¼–è¾‘  <code>option+shift+é€‰ä¸­</code></li></ul><h2 id="intellij-idea"><a href="#intellij-idea" class="headerlink" title="intellij idea"></a>intellij idea</h2><ul><li>å»é™¤æ— ç”¨çš„importå¼•ç”¨<code>control + option + o</code></li><li>ä»£ç æ ¼å¼åŒ–  <code>command + option + l</code></li></ul><h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><p>ä½¿ç”¨brewå®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start/stop/info redis</span><br></pre></td></tr></table></figure><h2 id="elastic"><a href="#elastic" class="headerlink" title="elastic"></a>elastic</h2><ul><li><p>å¯åŠ¨</p><p>./bin/elasticsearch</p></li></ul><h2 id="Translate"><a href="#Translate" class="headerlink" title="Translate"></a>Translate</h2><ul><li><p>homebrewå®‰è£…çš„translate-shell</p><p><a href="https://www.soimort.org/translate-shell/">https://www.soimort.org/translate-shell/</a></p><p>æš‚æ—¶è¿˜æœ‰é—®é¢˜</p><p>å®‰è£…gawkæ—¶æç¤ºï¼ˆ<a href="https://macappstore.org/gawk/%EF%BC%89">https://macappstore.org/gawk/ï¼‰</a></p><p>gawk: no bottle available!</p></li></ul><h2 id="karabiner"><a href="#karabiner" class="headerlink" title="karabiner"></a>karabiner</h2><h2 id="mc"><a href="#mc" class="headerlink" title="mc"></a>mc</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> binary file</span></span><br><span class="line">curl https://dl.min.io/client/mc/release/darwin-arm64/mc -o $HOME/Applications/minio-binaries/mc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directory</span></span><br><span class="line"><span class="meta">$</span><span class="bash">HOME/Applications/minio-binaries</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span> link</span></span><br><span class="line">sudo ln -s $HOME/Applications/minio-binaries/mc /usr/local/bin/mc</span><br></pre></td></tr></table></figure><h2 id="ç ´è§£è½¯ä»¶å®‰è£…"><a href="#ç ´è§£è½¯ä»¶å®‰è£…" class="headerlink" title="ç ´è§£è½¯ä»¶å®‰è£…"></a>ç ´è§£è½¯ä»¶å®‰è£…</h2><ul><li><p><a href="https://xmac.app/">https://xmac.app/</a></p><ul><li><p>ä¸‹è½½å®Œæˆä¹‹åï¼Œå®‰è£…dmgæ–‡ä»¶ä¹‹åï¼Œéœ€è¦æ‰§è¡ŒHelp.txté‡Œé¢çš„æ–‡å­—</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Option</span> <span class="symbol">I</span></span><br><span class="line"><span class="symbol">For</span> a certain application run in <span class="symbol">Terminal</span>:(æˆ‘é€‰æ‹©è¿™ç§æ–¹å¼)</span><br><span class="line">sudo xattr -rd com.apple.quarantine /<span class="symbol">Applications</span>/<span class="symbol">LockedApp</span>.app</span><br><span class="line"></span><br><span class="line"><span class="symbol">Option</span> <span class="symbol">II</span></span><br><span class="line"><span class="symbol">To</span> disable checks globally run in <span class="symbol">Terminal</span>:</span><br><span class="line">sudo spctl --master-disable</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="æœç‹—è¾“å…¥æ³•"><a href="#æœç‹—è¾“å…¥æ³•" class="headerlink" title="æœç‹—è¾“å…¥æ³•"></a>æœç‹—è¾“å…¥æ³•</h2><ul><li>ç®€ç¹ä½“åˆ‡æ¢<ul><li><code>ctrol + shift + F</code></li></ul></li></ul><h2 id="ja-netfilter"><a href="#ja-netfilter" class="headerlink" title="ja-netfilter"></a>ja-netfilter</h2><blockquote><p>jetbrains activate tool</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Appearance &amp; Behavior -&gt; System Settings -&gt; Language and Region -&gt; Region</span><br><span class="line">éœ€è¦é€‰æ‹© Asia(except china mainland)</span><br><span class="line">æ¿€æ´»è„šæœ¬ä¾ç„¶ä½¿ç”¨åŸæ¥çš„ script/install.sh</span><br></pre></td></tr></table></figure><h3 id="PlantUML"><a href="#PlantUML" class="headerlink" title="PlantUML"></a>PlantUML</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install plantuml</span><br></pre></td></tr></table></figure><h3 id="mermaid"><a href="#mermaid" class="headerlink" title="mermaid"></a>mermaid</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @mermaid-js/mermaid-cli</span><br></pre></td></tr></table></figure><h1 id="gpu"><a href="#gpu" class="headerlink" title="gpu"></a>gpu</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo asitop --interval 10</span><br></pre></td></tr></table></figure><h1 id="keyboard"><a href="#keyboard" class="headerlink" title="keyboard"></a>keyboard</h1><p><strong>Keyboard Combinations for Common Special Characters</strong></p><p>Here are a few of the most common symbols and their corresponding key combination.<br>Note that <strong>OPTION</strong> + <strong>2</strong> simply means hold down the option key (the alt key) and the number 2.</p><p><strong>Currency Symbols</strong></p><ul><li><strong>â‚¬</strong> (Euro sign): <strong>OPTION</strong> + <strong>2</strong></li><li><strong>Â¢</strong> (Cent sign): <strong>OPTION</strong> + <strong>4</strong></li><li><strong>Â¥</strong> (Yen sign): <strong>OPTION</strong> + <strong>y</strong></li></ul><p><strong>Copyright and Trademark Symbols</strong></p><ul><li><strong>Â®</strong> (registered trademark): <strong>OPTION</strong> + <strong>r</strong></li><li><strong>Â©</strong> (copyright): <strong>OPTION</strong> + <strong>g</strong></li><li><strong>â„¢</strong> (trademark): <strong>OPTION</strong> + <strong>shift</strong> + <strong>2</strong></li></ul><p><strong>Mathematical Symbols</strong></p><ul><li><strong>Ã·</strong> (division): <strong>OPTION</strong> + <strong>?</strong></li><li><strong>â‰¤</strong> (less than or equal to): <strong>OPTION</strong> + <strong>&lt;</strong></li><li><strong>â‰¥</strong> (greater than or equal to): <strong>OPTION</strong> + <strong>&gt;</strong></li><li><em><strong>*^*</strong></em> (circumflex): <em><strong>*OPTION** + **i*</strong></em></li><li><strong>âˆš</strong> (square root): <strong>OPTION</strong> + <strong>v</strong></li><li><strong>â‰ </strong> (not equal to): <strong>OPTION</strong> + <strong>=</strong></li><li><strong>â‰ˆ</strong> (almost equal to): <strong>OPTION</strong> + <strong>x</strong></li><li><strong>Â±</strong> (plus-minus): <strong>OPTION</strong> + <strong>shift</strong> + <strong>=</strong></li><li><strong>âˆ</strong> (infinity): <strong>OPTION</strong> + <strong>5</strong></li><li><strong>Ã¸</strong> (empty set): <strong>OPTION</strong> + <strong>o</strong></li><li><strong>âˆ‘</strong> (N-ary summation or Sigma): <strong>OPTION</strong> + <strong>w</strong></li><li><strong>Æ’</strong> (function): <strong>OPTION</strong> + <strong>f</strong></li><li><strong>âˆ«</strong> (integral): <strong>OPTION</strong> + <strong>b</strong></li><li><strong>âˆ‚</strong> (partial differential): <strong>OPTION</strong> + <strong>d</strong></li></ul><p><strong>Punctuation and Quote Marks</strong></p><ul><li><strong>â€œ</strong> (left double quotation mark): <strong>OPTION</strong> + <strong>[</strong></li><li><strong>â€</strong> (right double quotation mark): <strong>OPTION</strong> + <strong>SHIFT</strong> + <strong>[</strong></li><li><strong>â€˜</strong> (left single quotation mark): <strong>OPTION</strong> + <strong>]</strong></li><li><strong>â€™</strong> (right single quotation mark): <strong>OPTION</strong> + <strong>SHIFT</strong> + <strong>]</strong></li><li><strong>â€</strong> (double low-9 quotation mark): <strong>OPTION</strong> + <strong>SHIFT</strong> + <strong>w</strong></li><li><strong>Â¿</strong> (inverted question mark): <strong>OPTION</strong> + <strong>SHIFT</strong> + <strong>?</strong></li><li>â€¢ (bullet): <em>*<em>*</em>*OPTION**** + *</em>**8**<em>*</em>*</li></ul><p><strong>Miscellaneous</strong></p><ul><li><strong>ï£¿</strong> (Apple symbol): <strong>OPTION</strong> + <strong>SHIFT</strong> + <strong>k</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> macos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker image</title>
      <link href="/2021/12/17/docker%20image/"/>
      <url>/2021/12/17/docker%20image/</url>
      
        <content type="html"><![CDATA[<h1 id="concept"><a href="#concept" class="headerlink" title="concept"></a>concept</h1><ul><li><strong>é•œåƒï¼ˆImageï¼‰</strong>ï¼šDocker é•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ ubuntu:16.04 å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥— Ubuntu16.04 æœ€å°ç³»ç»Ÿçš„ root æ–‡ä»¶ç³»ç»Ÿã€‚</li><li><strong>å®¹å™¨ï¼ˆContainerï¼‰</strong>ï¼šé•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ç±»å’Œå®ä¾‹ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚</li><li><strong>ä»“åº“ï¼ˆRepositoryï¼‰</strong>ï¼šä»“åº“å¯çœ‹ç€ä¸€ä¸ªä»£ç æ§åˆ¶ä¸­å¿ƒï¼Œç”¨æ¥ä¿å­˜é•œåƒã€‚</li></ul><h2 id="operate"><a href="#operate" class="headerlink" title="operate"></a>operate</h2><h3 id="command"><a href="#command" class="headerlink" title="command"></a>command</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ„å»º ï¼ˆ--no-cache å¯ä»¥æ¸…ç†ç¼“å­˜è¿›è¡Œæ„å»ºï¼‰</span></span><br><span class="line">docker build --no-cache -t your-image-name .</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥æ‰¾</span></span><br><span class="line">docker search xxx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check Image Architecture</span></span><br><span class="line">docker image inspect &lt;imageId&gt;  | jq &#x27;.[].Architecture&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‹‰å–</span></span><br><span class="line">docker pull xxx (--platform=amd64)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œ(å®¹å™¨)</span></span><br><span class="line">docker run xxx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤</span></span><br><span class="line">docker rmi xxx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æ‰€æœ‰tagä¸º none çš„é•œåƒ</span></span><br><span class="line">docker images -q --filter &quot;dangling=true&quot; | sudo xargs docker rmi</span><br><span class="line"></span><br><span class="line">docker images : åˆ—å‡ºæœ¬åœ°é•œåƒã€‚</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¯­æ³•</span></span><br><span class="line">docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br><span class="line">OPTIONSè¯´æ˜ï¼š</span><br><span class="line">-a :åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒï¼ˆå«ä¸­é—´æ˜ åƒå±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æ»¤æ‰ä¸­é—´æ˜ åƒå±‚ï¼‰ï¼›</span><br><span class="line">â€“digests :æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯ï¼›</span><br><span class="line">-f :æ˜¾ç¤ºæ»¡è¶³æ¡ä»¶çš„é•œåƒï¼›</span><br><span class="line">â€“format :æŒ‡å®šè¿”å›å€¼çš„æ¨¡æ¿æ–‡ä»¶ï¼›</span><br><span class="line">â€“no-trunc :æ˜¾ç¤ºå®Œæ•´çš„é•œåƒä¿¡æ¯ï¼›</span><br><span class="line">-q :åªæ˜¾ç¤ºé•œåƒIDã€‚</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remove all dangling images:</span></span><br><span class="line">docker image prune -f</span><br></pre></td></tr></table></figure><ul><li><p>å¯¼å‡ºé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o &lt;output-file&gt;.tar &lt;image-name&gt;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load --input $PATH/$NAME.tar</span><br></pre></td></tr></table></figure></li><li><p>åœ¨é•œåƒä¸­è¿è¡Œå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 8899:8899 --name test $REPOSITORY:$TAG</span><br><span class="line"></span><br><span class="line">-itï¼šè¡¨ç¤ºäº¤äº’å¼ç»ˆç«¯çš„å®¹å™¨ï¼Œéå¯åŠ¨åç«‹åˆ»ç»“æŸçš„å®¹å™¨</span><br><span class="line">--name testï¼šç»™å®¹å™¨å–ä¸ªåå­—ï¼Œå«Œéº»çƒ¦å¯ä»¥çœå»</span><br><span class="line"><span class="meta">$</span><span class="bash">REPOSITORY:<span class="variable">$TAG</span>ï¼šå®¹å™¨æ˜¯ç”¨å“ªä¸ªé•œåƒå¯åŠ¨çš„ï¼ˆä¸€ä¸ªå®¹å™¨ï¼Œå¿…é¡»ä¾èµ–ä¸€ä¸ªé•œåƒå¯åŠ¨ï¼‰</span></span><br><span class="line">-v æŒ‡å®šäº†å®¿ä¸»æœºä¸Šçš„ç›®å½•ç”¨æ¥ä½œä¸ºdockerä»“åº“çš„å­˜å‚¨ä½ç½®ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œregistryé•œåƒé‡å¯ä¹‹åä¼šä¸¢å¤±å·²ç»å­˜å‚¨åœ¨æœ¬åœ°ä»“åº“çš„é•œåƒæ–‡ä»¶</span><br><span class="line">ğŸš¨-p hostPort:containerPort</span><br><span class="line">ğŸš¨-v hostVolume:containerVolume è¿™ä¸¤ä¸ªåœ°å€å¦‚æœä¸å­˜åœ¨éƒ½ä¼šåˆ›å»ºï¼Œä¸€æ—¦å®¹å™¨è¿è¡Œï¼Œä¸¤éƒ¨åˆ†ä¼šå®Œå…¨åŒæ­¥</span><br></pre></td></tr></table></figure><h4 id="volume"><a href="#volume" class="headerlink" title="volume"></a>volume</h4></li></ul><blockquote><p>Docker Imageå¯ä»¥ç†è§£æˆå¤šä¸ªåªè¯»æ–‡ä»¶å åŠ è€Œæˆï¼Œå› æ­¤Docker Imageæ˜¯åªè¯»çš„ã€‚</p><p>å½“æˆ‘ä»¬å°†å…¶è¿è¡Œèµ·æ¥ï¼Œå°±ç›¸å½“äºåœ¨åªè¯»çš„Imageå¤–åŒ…è£¹äº†ä¸€å±‚è¯»å†™å±‚å˜æˆäº†å®¹å™¨ã€‚</p><p>å½“ä½ åˆ é™¤å®¹å™¨ä¹‹åï¼Œä½¿ç”¨è¿™ä¸ªé•œåƒé‡æ–°åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œæ­¤æ—¶çš„é•œåƒçš„åªè¯»å±‚è¿˜å’ŒåŸæ¥çš„ä¸€æ ·ï¼Œä½†æ˜¯ä½ åœ¨è¯»å†™å±‚çš„ä¿®æ”¹å…¨éƒ¨éƒ½ä¼šä¸¢å¤±ï¼ˆæ²¡æœ‰ä½¿ç”¨åŸæœ‰volumeçš„å‰æä¸‹ï¼‰ã€‚</p><p>dockerä½¿ç”¨volumeå®ç°æ•°æ®çš„æŒä¹…åŒ–ï¼Œä¸ä»…å¦‚æ­¤volumeè¿˜èƒ½å¸®åŠ©å®¹å™¨å’Œå®¹å™¨ä¹‹é—´ï¼Œå®¹å™¨å’Œhostä¹‹é—´å…±äº«æ•°æ®ã€‚</p></blockquote><ul><li><p>è¿›å…¥é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it $IMAGE_ID bash</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> override the entrypoint or pass a different <span class="built_in">command</span></span></span><br><span class="line">docker run -it --entrypoint /bin/bash $IMAGE_ID</span><br></pre></td></tr></table></figure></li><li><p>è¿›å…¥è¿è¡Œçš„å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it $CONTAINER_ID /bin/bash</span><br></pre></td></tr></table></figure><ul><li><p>æ³¨æ„</p><p>å‘½ä»¤ä¸­çš„/bin/bashæ˜¯æ ¹æ®<code> docker inspect $image_id</code>ï¼Œæ ¹æ®â€Cmdâ€é…ç½®é¡¹å†³å®šçš„</p></li></ul></li><li><p>æµ‹è¯•è¿è¡Œé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•è¿è¡Œï¼ˆé•œåƒï¼‰ï¼Œ<span class="string">&#x27;sleep infinity&#x27;</span> <span class="built_in">command</span> could keep a container running interactively</span></span><br><span class="line">docker run -d $REPOSITORY:$TAG sleep infinity</span><br></pre></td></tr></table></figure></li></ul><h3 id="jar-gt-image"><a href="#jar-gt-image" class="headerlink" title="jar -&gt; image"></a>jar -&gt; image</h3><ul><li><p>step1: </p><p>ç¼–è¾‘dockerfile</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span>  openjdk:<span class="number">8</span>-jre</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šè·¯å¾„</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /data/justMicroservice/learning-cloudalibaba</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> JAR_FILE=nacos-provider/target/nacos-provider-<span class="number">0.0</span>.<span class="number">1</span>-SNAPSHOT.jar</span><br><span class="line"><span class="comment"># å¤åˆ¶jaræ–‡ä»¶åˆ°è·¯å¾„</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> <span class="variable">$&#123;JAR_FILE&#125;</span> nacos-provider.jar</span></span><br><span class="line"><span class="comment"># å¯åŠ¨ç½‘å…³æœåŠ¡</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;nacos-provider.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul><li><p>Step2: </p><p>åœ¨$pathçš„ä¸€çº§ç›®å½•æ‰§è¡Œï¼ˆæ¯”å¦‚dockerfileä½ç½®/a/b/dockerfileï¼Œé‚£å‘½ä»¤åœ¨aç›®å½•ä¸‹æ‰§è¡Œï¼‰</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t $repository -f $path/dockerfile .</span><br></pre></td></tr></table></figure><h2 id="archive-artifact"><a href="#archive-artifact" class="headerlink" title="archive artifact"></a>archive artifact</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1</span></span><br><span class="line">docker save -o /tmp/my_app_image.tar my_app:latest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2 save_image.tar is equal my_app_image.tar</span></span><br><span class="line">docker load -i /path/to/destination/save_immy_app_image.tarage.tar</span><br></pre></td></tr></table></figure><hr><h1 id="advanced"><a href="#advanced" class="headerlink" title="advanced"></a>advanced</h1><h2 id="add-git-commit-info-to-image-tag"><a href="#add-git-commit-info-to-image-tag" class="headerlink" title="add git commit info to image tag"></a>add git commit info to image tag</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">IMAGE_NAME=your-image-name</span><br><span class="line">echo &quot;image name: $IMAGE_NAME&quot;</span><br><span class="line"></span><br><span class="line">GIT_BRANCH=$(git symbolic-ref --short HEAD)</span><br><span class="line">LAST_COMMIT=$(git rev-parse HEAD)</span><br><span class="line">echo &quot;git commit info : $LAST_COMMIT&quot;</span><br><span class="line"></span><br><span class="line">docker build . -t $IMAGE_NAME:&quot;$GIT_BRANCH-$LAST_COMMIT&quot;</span><br></pre></td></tr></table></figure><h1 id="es"><a href="#es" class="headerlink" title="es"></a>es</h1><blockquote><p>æ–‡ä¸­hostAddresséœ€è¦æ›¿æ¢å…·ä½“çš„ipåœ°å€</p></blockquote><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><blockquote><p>æŸ¥çœ‹ç°æœ‰ç¯å¢ƒç›¸å…³å‚æ•°ulimit -a</p></blockquote><ul><li><p>è®¾ç½®æ–‡ä»¶å¥æŸ„æ•°ï¼Œåœ¨**/etc/security/limits.conf**ä¸­è®¾ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># End of file</span><br><span class="line">* hard nofile 65536</span><br><span class="line">* soft nofile 65536</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹max user processesè¿›ç¨‹æ•°ï¼Œåœ¨**/etc/security/limits.conf**ä¸­è®¾ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* soft nproc 65536</span><br><span class="line">* hard nproc 65536</span><br></pre></td></tr></table></figure></li><li><p>è°ƒæ•´vm.max_map_countçš„å¤§å°ï¼Œè¯¥å‚æ•°ä¼šé™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„æ•°é‡</p><p>é€šè¿‡ä¿®æ”¹**/etc/sysctl.conf**å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ<code>sysctl -p</code></p></li><li><p>è°ƒæ•´stack sizeçš„å¤§å°ï¼ˆå¯é€‰ï¼‰ï¼Œåœ¨**/etc/security/limits.conf**ä¸­è®¾ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* soft stack 1024</span><br><span class="line">* hard stack 1024</span><br></pre></td></tr></table></figure></li></ul><h2 id="manual-init-data"><a href="#manual-init-data" class="headerlink" title="manual init data"></a>manual init data</h2><ul><li><p>create index</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Content-Type: application/json&#x27; -d &#x27;@/data/es_mapping.json&#x27; -X PUT &#x27;http://localhost:9200/indexName&#x27;</span><br></pre></td></tr></table></figure></li><li><p>import data</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Content-Type: application/json&#x27; --data-binary &#x27;@/data/es_init_data.txt&#x27; &#x27;http://localhost:9200/_bulk&#x27;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æ‹‰å–è¿œç¨‹ä»“åº“é•œåƒæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull hostAddress/dlabel/service:elasticsearch</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name es_origin -e ES_JAVA_POTS=&quot;-Xms6g -Xmx6g&quot; -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; docker.elastic.co/elasticsearch/elasticsearch:7.16.1</span><br></pre></td></tr></table></figure></li></ul><h2 id="é•œåƒåˆ¶ä½œ"><a href="#é•œåƒåˆ¶ä½œ" class="headerlink" title="é•œåƒåˆ¶ä½œ"></a>é•œåƒåˆ¶ä½œ</h2><ol><li>å¯¼å‡ºESçš„å·²æœ‰ç´¢å¼•å’Œæ•°æ®</li></ol><ul><li><p>ç¯å¢ƒå‡†å¤‡</p><ul><li>å®‰è£…nodejsï¼Œå®‰è£…æ–‡ä»¶åœ°å€<a href="https://nodejs.org/en/download/">nodejs</a></li><li>å®‰è£…elasticdumpï¼Œå®‰è£…å‘½ä»¤<code>npm install -g elasticdump</code></li></ul></li><li><p>å¯¼å‡ºesç´¢å¼•æ–‡ä»¶<strong>es_mapping.json</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">/$</span><span class="bash">nodejs_home/lib/node_modules/elasticdump/bin/elasticdump \               --input=http://127.0.0.1:9200/indexName \</span></span><br><span class="line"><span class="bash">  --output=/data/es_mapping.json \</span></span><br><span class="line"><span class="bash">  --<span class="built_in">type</span>=mapping</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š$nodejs_homeä»£è¡¨nodejsçš„å®‰è£…ç›®å½•</p></blockquote></li><li><p>å¯¼å‡ºesæ•°æ®<strong>es_init_data.txt</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">/$</span><span class="bash">nodejs_home/lib/node_modules/elasticdump/bin/elasticdump \ </span>          </span><br><span class="line">  --input=http://127.0.0.1:9200/indexName \</span><br><span class="line">  --output=/data/es_init_data.txt \</span><br><span class="line">  --searchBody &#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123; &#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li><p>ç¼–å†™esæ•°æ®åˆå§‹åŒ–è„šæœ¬ <strong>initEs.sh</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">create index</span></span><br><span class="line">curl -H &#x27;Content-Type: application/json&#x27; -d &#x27;@/data/es_mapping.json&#x27; -X PUT &#x27;http://127.0.0.1:9200/indexName&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash">import data</span></span><br><span class="line">curl -H &#x27;Content-Type: application/json&#x27; --data-binary &#x27;@/data/es_init_data.txt&#x27; &#x27;http://127.0.0.1:9200/_bulk&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>initEs.shæ–‡ä»¶åŒ1,2æ“ä½œä¸­çš„æ–‡ä»¶å­˜æ”¾è·¯å¾„ä¿æŒä¸€è‡´ï¼Œå‡æ”¾åœ¨/dataç›®å½•ä¸‹</p></blockquote></li><li><p>åœ¨/dataç›®å½•ä¸‹åˆ›å»ºDockerfileæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM elasticsearch:7.16.1</span><br><span class="line">COPY ./data/* /data/</span><br><span class="line">RUN chown -R elasticsearch:root /data </span><br><span class="line">USER elasticsearch</span><br><span class="line">RUN elasticsearch -E discovery.type=single-node -p /tmp/epid &amp; /bin/bash /data/wait-for-it.sh -t 0 localhost:9200 -- /data/initEs.sh; kill $(cat /tmp/epid) &amp;&amp; wait $(cat /tmp/epid); exit 0;</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t dlabel:elasticsearch .</span><br></pre></td></tr></table></figure><blockquote><p>dlabel:esæ˜¯ REPOSITORY:TAGæ ¼å¼ï¼Œå¯è‡ªè¡Œæ›´æ”¹</p></blockquote></li><li><p>ç™»å½•è¿œç¨‹ä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login hostAddress</span><br></pre></td></tr></table></figure><p>æ ¹æ®æç¤ºï¼Œè¾“å…¥ç”¨æˆ·åadminï¼Œå¯†ç Harbor12345</p></li><li><p>æ˜ å°„è¿œç¨‹ä»“åº“REPOSITORY:TAG</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image tag dlabel:elasticsearch hostAddress/dlabel/service:elasticsearch</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­dlabel:elasticsearchå’Œæ“ä½œ3ä¸­ä¿æŒä¸€è‡´</p></blockquote></li><li><p>æ¨é€å½“åœ°é•œåƒåˆ°è¿œç¨‹ä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push hostAddress/dlabel/service:elasticsearch</span><br></pre></td></tr></table></figure></li></ol><h1 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h1><h2 id="é•œåƒåˆ¶ä½œ-1"><a href="#é•œåƒåˆ¶ä½œ-1" class="headerlink" title="é•œåƒåˆ¶ä½œ"></a>é•œåƒåˆ¶ä½œ</h2><ol><li><p>éœ€è¦å¤‡ä»½å½“å‰éœ€è¦åŒæ­¥çš„å…¨é‡æ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it dlabel_mysql mysqldump -uroot -p123456 dls &gt; /path/to/backup.sql</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„äº‹é¡¹ï¼š</p><p>å…¶ä¸­dlabel_mysqlï¼Œæ˜¯åœ¨ç¬¬äºŒæ­¥ä¸­è®¾ç½®çš„nameçš„åç§°</p><p>/path/to/backup.sqlæ˜¯å¯¼å‡ºsqlçš„åœ°å€è·¯å¾„ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿä¸åŒï¼Œéœ€è¦è‡ªè¡Œæ›´æ”¹</p><p>å‡å®šä»¥ä¸‹æ“ä½œæ˜¯åœ¨/path/toçš„ç›®å½•ä¸‹</p></blockquote></li></ol><ol start="2"><li><p>åœ¨/path/toç›®å½•ä¸‹åˆ›å»ºDockerfileæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Derived from official mysql image (our base image)</span></span><br><span class="line">FROM mysql:5.7.30</span><br><span class="line"><span class="meta">#</span><span class="bash"> Add the content of the sql-scripts/ directory to your image</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> All scripts <span class="keyword">in</span> docker-entrypoint-initdb.d/ are automatically</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> executed during container startup</span></span><br><span class="line">COPY ./backup.sql /docker-entrypoint-initdb.d/</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„COPYæŒ‡ä»¤ä¸­ï¼Œbackup.sqléœ€è¦å’Œæ“ä½œ1ä¸­çš„å¯¼å‡ºæ–‡ä»¶åä¿æŒä¸€è‡´</p></blockquote></li><li><p>åˆ›å»ºé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t dlabel:mysql20211216 .</span><br></pre></td></tr></table></figure><blockquote><p>dlabel:mysql20211216æ˜¯ REPOSITORY:TAGæ ¼å¼ï¼Œå¯è‡ªè¡Œæ›´æ”¹</p></blockquote></li><li><p>ç™»å½•è¿œç¨‹ä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login hostAddress</span><br></pre></td></tr></table></figure><p>æ ¹æ®æç¤ºï¼Œè¾“å…¥ç”¨æˆ·åadminï¼Œå¯†ç Harbor12345</p></li><li><p>æ˜ å°„è¿œç¨‹ä»“åº“REPOSITORY:TAG</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image tag dlabel:mysql20211216 hostAddress/dlabel/service:mysql20211216</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­dlabel:mysql20211216å’Œæ“ä½œ3ä¸­ä¿æŒä¸€è‡´</p><p>hostAddress/dlabel/service:mysql20211216ï¼Œæ ¼å¼ä¸ºhostAddress/library/REPOSITORY:TAGï¼Œå…¶ä¸­å¯è‡ªè¡Œä¿®æ”¹service:mysql20211216åç§°</p></blockquote></li><li><p>æ¨é€å½“åœ°é•œåƒåˆ°è¿œç¨‹ä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push hostAddress/dlabel/service:mysql20211216</span><br></pre></td></tr></table></figure></li><li><p>ç™»å½•<strong><a href="http://hostaddress/">http://hostAddress</a></strong>æŸ¥çœ‹é•œåƒä¸Šä¼ æƒ…å†µ</p></li><li><p>åœ¨é•œåƒè¯¦æƒ…ç•Œé¢ï¼Œç‚¹å‡»â€œæ‹‰å–å‘½åâ€æŒ‰é’®è¿›è¡Œå‘½ä»¤å¤åˆ¶ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤å³å¯æ‹‰å–è¯¥é•œåƒ</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> image </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker compose</title>
      <link href="/2021/12/17/docker%20compose/"/>
      <url>/2021/12/17/docker%20compose/</url>
      
        <content type="html"><![CDATA[<h3 id="Docker-File-vs-Docker-Compose"><a href="#Docker-File-vs-Docker-Compose" class="headerlink" title="Docker File vs Docker Compose"></a>Docker File vs Docker Compose</h3><p>DockerfileÂ is whatâ€™s used to create a container image, and a Compose file is whatâ€™s used to deploy an instance of that image as a container.</p><blockquote><p>Compose æ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚é€šè¿‡ Composeï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ YML æ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰æœåŠ¡ã€‚ç„¶åï¼Œä½¿ç”¨ä¸€ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥ä» YML æ–‡ä»¶é…ç½®ä¸­åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚</p></blockquote><h4 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h4><p>Dockerfile the predecessor of a container image. You build an image from a Dockerfile. A typical Dockerfile contains special build instructions, commands likeÂ <code>RUN</code>,Â <code>ADD</code>,Â <code>COPY</code>,Â <code>ENTRYPOINT</code>, etc.</p><h4 id="Compose-file"><a href="#Compose-file" class="headerlink" title="Compose file"></a>Compose file</h4><p>Compose files are used in two types of deployments: in the non-cluster deployment withÂ <code>docker-compose</code>Â and a cluster deployment withÂ <code>docker swarm</code>.</p><p>Compose files are used in two types of deployments: in the non-cluster deployment with <code>docker-compose</code> and a cluster deployment with <code>docker swarm</code>.</p><p>To distinguish the two types, Iâ€™m going to address the compose file responsible for cluster deployment as stack files. Iâ€™ll talk about stack files in a moment.</p><p>Compose files are part of a tool called <code>docker-compose</code>. Itâ€™s a client application to the docker daemon server, kind of like the <code>docker</code> CLI client, but instead of typing the whole <code>run</code> commands every time, with <code>docker-compose</code> you can re-use the same YAML file over and over again, and deploy the same container with the same configuration as you did in the first time.</p><p>Itâ€™s more readable, more maintainable, more intuitive. A single compose file can contain multiple container deployment configurations.</p><ul><li><p>æ‰§è¡Œ<code>docker-compose up</code>ï¼ŒæŠ¥é”™</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Couldnâ€™t connect to Docker daemon at http+docker:<span class="comment">//localhost - is it running?</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>docker-compose.yml</code>ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;redis:alpine&quot;</span></span><br></pre></td></tr></table></figure><ul><li><p>è§£å†³ï¼Œä½¿ç”¨sudoæƒé™</p><ol><li><p>Add user to docker group (if not already added)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure></li><li><p>create a symbolic link to /usr/bin using the following command</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure></li><li><p>Restart docker service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure></li><li><p>execute</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose up</span><br></pre></td></tr></table></figure></li></ol></li></ul></li></ul><p>è¿è¡Œdocker compose upæˆ–docker compose up -d(åå°è¿è¡Œ)è¿è¡Œæ‚¨çš„æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚ <code>æ³¨æ„ï¼šæ¯æ¬¡ä¿®æ”¹ä»»ä¸€é…ç½®æ–‡ä»¶åï¼Œéƒ½è¦ä½¿ç”¨ docker-compose up --build é‡æ–°æ„å»º</code></p><blockquote><p>æœ‰äº†docker-composeï¼Œå½“æˆ‘ä»¬æƒ³å¯åŠ¨å¤šä¸ªæœåŠ¡æ—¶ï¼Œæ— éœ€å†ä¸€ä¸ªä¸€ä¸ªè¿›è¡Œdocker runæ“ä½œï¼Œè€Œåªéœ€è¦ç¼–å†™docker-compose.ymlé…ç½®æ–‡ä»¶ï¼Œå³å¯ä¸€æ¬¡è¿è¡Œä½ çš„å…¨éƒ¨æœåŠ¡ã€‚</p></blockquote><hr><table><thead><tr><th>å±æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td>docker-compose build</td><td>(æ„å»ºymlä¸­æŸä¸ªæœåŠ¡çš„é•œåƒ)</td></tr><tr><td>docker-compose ps</td><td>(æŸ¥çœ‹å·²ç»å¯åŠ¨çš„æœåŠ¡çŠ¶æ€ï¼‰</td></tr><tr><td>docker-compose kill</td><td>(åœæ­¢æŸä¸ªæœåŠ¡ï¼‰</td></tr><tr><td>docker-compose logs</td><td>(å¯ä»¥æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„logï¼‰</td></tr><tr><td>docker-compose port</td><td>(æ‰“å°ç»‘å®šçš„public portï¼‰</td></tr><tr><td>docker-compose pull</td><td>(pullæœåŠ¡é•œåƒ)</td></tr><tr><td>docker-compose up</td><td>(å¯åŠ¨ymlå®šä¹‰çš„æ‰€æœ‰æœåŠ¡ï¼‰</td></tr><tr><td>docker-compose stop</td><td>(åœæ­¢ymlä¸­å®šä¹‰çš„æ‰€æœ‰æœåŠ¡ï¼‰</td></tr><tr><td>docker-compose start</td><td>(å¯åŠ¨è¢«åœæ­¢çš„ymlä¸­çš„æ‰€æœ‰æœåŠ¡ï¼‰</td></tr><tr><td>docker-compose kill</td><td>(å¼ºè¡Œåœæ­¢ymlä¸­å®šä¹‰çš„æ‰€æœ‰æœåŠ¡ï¼‰</td></tr><tr><td>docker-compose rm</td><td>ï¼ˆåˆ é™¤ymlä¸­å®šä¹‰çš„æ‰€æœ‰æœåŠ¡ï¼‰</td></tr><tr><td>docker-compose restart</td><td>(é‡å¯ymlä¸­å®šä¹‰çš„æ‰€æœ‰æœåŠ¡ï¼‰</td></tr><tr><td>docker-compose scale</td><td>(æ‰©å±•æŸä¸ªæœåŠ¡çš„ä¸ªæ•°ï¼Œå¯ä»¥å‘ä¸Šæˆ–å‘ä¸‹ï¼‰</td></tr><tr><td>docker-compose version</td><td>ï¼ˆæŸ¥çœ‹composeçš„ç‰ˆæœ¬ï¼‰</td></tr></tbody></table><p>æ—¥å¿—è¾“å‡º  </p><p>ç»ˆç«¯è¾“å‡ºï¼š<code>docker-compose --verbose up $service_name</code></p><p>æˆ–è€…docker-compose.ymlé…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stdin_open: true</span><br><span class="line">tty: true</span><br></pre></td></tr></table></figure><h3 id="é•œåƒé‡æ–°ç¼–è¯‘"><a href="#é•œåƒé‡æ–°ç¼–è¯‘" class="headerlink" title="é•œåƒé‡æ–°ç¼–è¯‘"></a>é•œåƒé‡æ–°ç¼–è¯‘</h3><p>å¦‚æœä¿®æ”¹äº† Dockerfileå†…å®¹é‡Œé¢ç›¸å…³çš„ä¿¡æ¯ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘é•œåƒï¼Œå¦‚æœä½¿ç”¨docker composeï¼Œåˆ™éœ€è¦ä½¿ç”¨å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up --build</span><br></pre></td></tr></table></figure><h3 id="åå°è¿è¡Œ"><a href="#åå°è¿è¡Œ" class="headerlink" title="åå°è¿è¡Œ"></a>åå°è¿è¡Œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h3 id="åœæ­¢"><a href="#åœæ­¢" class="headerlink" title="åœæ­¢"></a>åœæ­¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f ./docker-compose.yml down</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ–°ç‰ˆä½¿ç”¨ docker compose å‘½ä»¤</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker container</title>
      <link href="/2021/12/13/docker%20container/"/>
      <url>/2021/12/13/docker%20container/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker ä¼šä¸ºä½ æä¾›ä¸€ä¸ªéšå«çš„ ENTRYPOINTï¼Œå³ï¼š/bin/sh -cã€‚æ‰€ä»¥ï¼Œåœ¨ä¸æŒ‡å®š ENTRYPOINT æ—¶ï¼Œæ¯”å¦‚è¿è¡Œåœ¨å®¹å™¨é‡Œçš„å®Œæ•´è¿›ç¨‹æ˜¯ï¼š/bin/sh -c â€œpython xxx.pyâ€ï¼Œå³ CMD çš„å†…å®¹å°±æ˜¯ ENTRYPOINT çš„å‚æ•°</p></blockquote><h2 id="user"><a href="#user" class="headerlink" title="user"></a>user</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Add the current user</span></span><br><span class="line">sudo usermod -a -G docker $(whoami)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Add a specific user</span></span><br><span class="line">sudo usermod -a -G docker custom-user</span><br></pre></td></tr></table></figure><h1 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h1><ul><li><p>check</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ­£åœ¨è¿è¡Œ</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ‰€æœ‰</span></span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure></li><li><p>docker run</p><blockquote><p>docker run is a higher-level command that combines multiple subcommands (docker create, docker start, docker exec, etc.) into a single step.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºå®¹å™¨</span></span><br><span class="line">docker run -p &lt;å®¿ä¸»æœºç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt; &lt;é•œåƒåç§°&gt;[:æ ‡ç­¾]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®å®¹å™¨åœæ­¢ä¹‹åè‡ªåŠ¨æ¸…ç†å®¹å™¨</span></span><br><span class="line">docker run --rm xxx  # --rm This flag tells Docker to automatically remove the container when it exits.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Run a New Container with Volume Mount</span></span><br><span class="line">docker run -it --name my-container -v /host/path:/container/path my-image</span><br></pre></td></tr></table></figure></li><li><p>other</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨</span></span><br><span class="line">docker start å®¹å™¨åæˆ–å®¹å™¨ id</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç»ˆæ­¢</span></span><br><span class="line">docker stop [NAME]/[CONTAINER ID]:å°†å®¹å™¨é€€å‡ºã€‚</span><br><span class="line">docker kill [NAME]/[CONTAINER ID]:å¼ºåˆ¶åœæ­¢ä¸€ä¸ªå®¹å™¨ã€‚</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¸…ç†å·²ç»åœæ­¢çš„å®¹å™¨</span></span><br><span class="line">docker container prune</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å®¹å™¨ç«¯å£</span></span><br><span class="line">docker port &#123;container_id&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">docker inspect -f &#x27;&#123;&#123;.Config.Cmd&#125;&#125;&#x27; &#123;container_id&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å®¹å™¨æŒ‚è½½ä¿¡æ¯</span></span><br><span class="line">docker inspect &#123;container_id&#125; --format=&#x27;&#123;&#123;json .Mounts&#125;&#125;&#x27; | jq</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤</span></span><br><span class="line">docker rm -f å®¹å™¨id</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰¹é‡åˆ é™¤å·²åœæ­¢çš„å®¹å™¨</span></span><br><span class="line">docker rm $(docker ps -a -q -f &quot;status=exited&quot;)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡º</span></span><br><span class="line">docker export å®¹å™¨id &gt; xxx.tar</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å…¥</span></span><br><span class="line">docker import - test/xxx:v1</span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯</span></span><br><span class="line">docker restart $container_id</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ—¥å¿—</span></span><br><span class="line">docker logs $container_id</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤åˆ¶æ–‡ä»¶ åœ¨å®¹å™¨è¿è¡Œå’Œåœæ­¢çš„çŠ¶æ€å‡å¯æ‰§è¡Œ</span></span><br><span class="line">docker cp /host/path/ &lt;container_id&gt;:/path/to/file</span><br><span class="line">or</span><br><span class="line">docker cp &lt;container_id&gt;:/path/to/file /host/path/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Monitor Real-Time</span></span><br><span class="line">docker stats &lt;containerId&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check specify container<span class="string">&#x27;s PID</span></span></span><br><span class="line">docker inspect --format &#x27;&#123;&#123;.State.Pid&#125;&#125;&#x27; &lt;containerId&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="volume"><a href="#volume" class="headerlink" title="volume"></a>volume</h2><h3 id="Propagation-Modes"><a href="#Propagation-Modes" class="headerlink" title="Propagation Modes"></a>Propagation Modes</h3><blockquote><p>with rshared: Unmounting inside the container affects the hostâ€™s mount as well.</p><p>with rprivate: Unmounting inside the container only affects the container, leaving the hostâ€™s mounts untouched.</p></blockquote><ul><li><p>rprivate <strong>(Recursive Private)</strong>:</p><ul><li><p><strong>Isolated Mount Propagation</strong>: When a mount point is set to rprivate, any mount or unmount events within that mount are <strong>not propagated</strong> between the container and the host or vice versa. Changes in mounts within the container are isolated.</p><p><strong>Example</strong>: If you mount or unmount a file system inside the container, it wonâ€™t affect the corresponding mount on the host. Similarly, changes to the mounts on the host wonâ€™t reflect inside the container.</p></li></ul></li><li><p>rshared <strong>(Recursive Shared)</strong>:</p><ul><li><p><strong>Mount Propagation Between Host and Container</strong>: In rshared mode, mount and unmount events are <strong>propagated both ways</strong> between the host and the container.</p><p><strong>Example</strong>: If you unmount or mount something inside the container, it will be reflected on the host. Conversely, if the host unmounts or mounts a file system on that mount point, it will also reflect inside the container.</p></li></ul></li></ul><h2 id="network"><a href="#network" class="headerlink" title="network"></a>network</h2><table><thead><tr><th align="left">Driver</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>bridge</code></td><td align="left">The default network driver.</td></tr><tr><td align="left"><code>host</code></td><td align="left">Remove network isolation between the container and the Docker host.</td></tr><tr><td align="left"><code>none</code></td><td align="left">Completely isolate a container from the host and other containers.</td></tr><tr><td align="left"><code>overlay</code></td><td align="left">Overlay networks connect multiple Docker daemons together.</td></tr><tr><td align="left"><code>ipvlan</code></td><td align="left">IPvlan networks provide full control over both IPv4 and IPv6 addressing.</td></tr><tr><td align="left"><code>macvlan</code></td><td align="left">Assign a MAC address to a container.</td></tr></tbody></table><ul><li><p>åˆ—å‡ºdockerçš„æ‰€æœ‰ç½‘ç»œæ¨¡å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br></pre></td></tr></table></figure></li><li><p>é’ˆå¯¹bridgeå’Œhoståˆ†åˆ«æŸ¥æ‰¾æœ‰å“ªäº›containeråœ¨å…¶ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect bridge</span><br><span class="line">docker network inspect host</span><br></pre></td></tr></table></figure></li><li><p>ç›´æ¥æŸ¥çœ‹containerçš„ä¿¡æ¯ï¼Œæ‰¾åˆ°networkæ®µæŸ¥çœ‹ã€‚æˆ–è€…ç”¨grepç­›é€‰å‡ºnetworkã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect å®¹å™¨å/å®¹å™¨ID</span><br><span class="line">docker inspect å®¹å™¨å/å®¹å™¨ID | grep -i â€œnetworkâ€ # å…¶ä¸­grepçš„â€œ-iâ€è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ã€‚</span><br></pre></td></tr></table></figure></li></ul><h2 id="Exit-Codes"><a href="#Exit-Codes" class="headerlink" title="Exit Codes"></a>Exit Codes</h2><p>Common exit codes associated with docker containers are:</p><ul><li><p><strong>Exit Code 0</strong>: Absence of an attached foreground process</p></li><li><p><strong>Exit Code 1</strong>: Indicates failure due to application error</p></li><li><p><strong>Exit Code 137</strong>: Indicates failure as container received SIGKILL (Manual intervention or â€˜oom-killerâ€™ [OUT-OF-MEMORY])</p></li><li><p><strong>Exit Code 139</strong>: Indicates failure as container received SIGSEGV</p></li><li><p><strong>Exit Code 143</strong>: Indicates failure as container received SIGTERM</p></li><li><p><strong>Exit Code 126</strong>: Permission problem or command is not executable</p></li><li><p><strong>Exit Code 127</strong>: Possible typos in shell script with unrecognizable characters</p></li></ul><h2 id="third-container"><a href="#third-container" class="headerlink" title="third container"></a>third container</h2><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><ul><li><p>å¯†ç 123456</p></li><li><p>åˆ›å»ºå®¹å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql-server -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br><span class="line">æ³¨æ„ï¼š</span><br><span class="line">-d:è®©å®¹å™¨åœ¨åå°è¿è¡Œ</span><br><span class="line">-P(å¤§å†™):æ˜¯å®¹å™¨å†…éƒ¨ç«¯å£éšæœºæ˜ å°„åˆ°ä¸»æœºçš„é«˜ç«¯å£</span><br><span class="line">-p(å°å†™):æ˜¯å®¹å™¨å†…éƒ¨ç«¯å£ç»‘å®šåˆ°æŒ‡å®šçš„ä¸»æœºç«¯å£</span><br></pre></td></tr></table></figure></li><li><p>è¿›å…¥å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql-server /bin/bash</span><br><span class="line">æˆ–</span><br><span class="line">docker exec -it mysql-server /bin/sh</span><br></pre></td></tr></table></figure></li><li><p>è®¿é—®</p><p><code>docker exec -it mysql-server mysql -uroot -p</code></p></li><li><p>ä¿®æ”¹root å¯ä»¥é€šè¿‡ä»»ä½•å®¢æˆ·ç«¯è¿æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>ä»å¤–éƒ¨è®¿é—®docker mysql-server</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h127.0.0.1 -P3306 -uroot -p</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥sqlæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å…ˆå°†æ–‡ä»¶å¯¼å…¥åˆ°å®¹å™¨</span><br><span class="line">#docker cp **.sql å®¹å™¨å:/root/</span><br><span class="line">è¿›å…¥å®¹å™¨</span><br><span class="line">#docker exec -ti å®¹å™¨åæˆ–ID sh</span><br><span class="line">ç™»å½•æ•°æ®åº“</span><br><span class="line"># mysql -uroot -p </span><br><span class="line">å°†æ–‡ä»¶å¯¼å…¥æ•°æ®åº“</span><br><span class="line">source æ•°æ®åº“å &lt; /root/***.sql</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å‡ºæ•°æ®åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it  mysql-serverï¼ˆå®¹å™¨åï¼‰ mysqldump -uroot -p123456 æ•°æ®åº“åç§° &gt; /opt/sql_bak/test_db.sqlï¼ˆå¯¼å‡ºè¡¨æ ¼è·¯å¾„ï¼‰</span><br></pre></td></tr></table></figure></li></ul><h3 id="portainer"><a href="#portainer" class="headerlink" title="portainer"></a>portainer</h3><ul><li><p>å¯†ç é‡ç½®</p><ul><li><p>ä¸‹è½½å¸®åŠ©é•œåƒportainer/helper-reset-password</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull portainer/helper-reset-password</span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢è¿è¡Œçš„portainer</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop &quot;id-portainer-container&quot;</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œé‡ç½®å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -v portainer_data:/data portainer/helper-reset-password</span><br></pre></td></tr></table></figure></li><li><p>ç»“æœ</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>/<span class="number">06</span>/<span class="number">04</span> <span class="number">00</span>:<span class="number">13</span>:<span class="number">58</span> Password successfully updated <span class="keyword">for</span> user: admin</span><br><span class="line"><span class="number">2020</span>/<span class="number">06</span>/<span class="number">04</span> <span class="number">00</span>:<span class="number">13</span>:<span class="number">58</span> Use the following password to login: &amp;<span class="number">_4</span>#\<span class="number">3</span>^<span class="number">5</span>V8vLTd)E<span class="string">&quot;NWiJBs26G*9HPl1</span></span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°è¿è¡Œportainer,å¯†ç  ä¸ºğŸ‘†é‡ç½®çš„ &amp;_4#\3^5V8vLTd)Eâ€NWiJBs26G*9HPl1</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start &quot;id-portainer-container&quot;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç°åœ¨å¯†ç ä¸º admin/admin</p></li><li><p>é‡æ–°å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d -p 8000:8000 -p 9443:9443 --name portainer \</span><br><span class="line">    --restart=always \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">    -v portainer_data:/data \</span><br><span class="line">    cr.portainer.io/portainer/portainer-ce:2.9.3</span><br></pre></td></tr></table></figure></li></ul><h3 id="nacos"><a href="#nacos" class="headerlink" title="nacos"></a>nacos</h3><ul><li>run<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nacos -p 8848:8848 -e PREFER_HOST_MODE=hostname -e MODE=standalone nacos/nacos-server</span><br></pre></td></tr></table></figure><ul><li>Linux memory is insufficient<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -e JVM_XMS=256m -e JVM_XMX=256m --env MODE=standalone --name nacos -d -p 8848:8848 nacos/nacos-server</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><blockquote><p>ä½¿ç”¨docker-compose up rediså¯åŠ¨å®¹å™¨æ—¶ï¼Œå¦‚æœé…ç½®è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ redis.confï¼Œéœ€è¦è®¾ç½®</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br><span class="line">daemonize no</span><br></pre></td></tr></table></figure><blockquote><p>docker-compose.ymlæ–‡ä»¶å†…å®¹</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span>                                                                            <span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;redis:alpine&quot;</span></span><br><span class="line">    <span class="attr">stdin_open:</span> <span class="literal">true</span> <span class="comment">#æ‰“å¼€æ ‡å‡†è¾“å…¥ï¼Œå¯ä»¥æ¥å—å¤–éƒ¨è¾“å…¥ã€‚</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span>  <span class="comment">#æ¨¡æ‹Ÿä¸€ä¸ªä¼ªç»ˆç«¯ã€‚</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/docker/projects/test/redis.conf:/data/redis.conf</span> <span class="comment"># ä¸»æœºè·¯å¾„:å®¹å™¨è·¯å¾„</span></span><br><span class="line">    <span class="comment">#   - /docker/projects/test/redis/data:/data</span></span><br><span class="line">    <span class="comment">#   - /docker/projects/test/redis/logs:/logs</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--include</span> <span class="string">/data/redis.conf</span></span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨ docker-compose â€“verbose up rediså¯åŠ¨ï¼Œå¯æŸ¥çœ‹å¯åŠ¨è¯¦æƒ…</p></blockquote><h2 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h2><h3 id="ä¿®æ”¹å·²æœ‰å®¹å™¨çš„ç«¯å£æ˜ å°„"><a href="#ä¿®æ”¹å·²æœ‰å®¹å™¨çš„ç«¯å£æ˜ å°„" class="headerlink" title="ä¿®æ”¹å·²æœ‰å®¹å™¨çš„ç«¯å£æ˜ å°„"></a>ä¿®æ”¹å·²æœ‰å®¹å™¨çš„ç«¯å£æ˜ å°„</h3><ol><li><p>åœæ­¢å®¹å™¨ </p></li><li><p>åœæ­¢dockeræœåŠ¡(systemctl stop docker) </p></li><li><p>ä¿®æ”¹è¿™ä¸ªå®¹å™¨çš„hostconfig.jsonæ–‡ä»¶ä¸­çš„ç«¯å£ï¼ˆåŸå¸–æœ‰äººæåˆ°ï¼Œå¦‚æœconfig.v2.jsoné‡Œé¢ä¹Ÿè®°å½•äº†ç«¯å£ï¼Œä¹Ÿè¦ä¿®æ”¹ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /var/lib/docker/3b6ef264a040* #è¿™é‡Œæ˜¯CONTAINER ID</span><br><span class="line">vi hostconfig.json</span><br><span class="line">å¦‚æœä¹‹å‰æ²¡æœ‰ç«¯å£æ˜ å°„, åº”è¯¥æœ‰è¿™æ ·çš„ä¸€æ®µ:</span><br><span class="line">&quot;PortBindings&quot;:&#123;&#125;</span><br><span class="line">å¢åŠ ä¸€ä¸ªæ˜ å°„, è¿™æ ·å†™:</span><br><span class="line">&quot;PortBindings&quot;:&#123;&quot;3306/tcp&quot;:[&#123;&quot;HostIp&quot;:&quot;&quot;,&quot;HostPort&quot;:&quot;3307&quot;&#125;]&#125;</span><br><span class="line">å‰ä¸€ä¸ªæ•°å­—æ˜¯å®¹å™¨ç«¯å£, åä¸€ä¸ªæ˜¯å®¿ä¸»æœºç«¯å£. </span><br><span class="line">è€Œä¿®æ”¹ç°æœ‰ç«¯å£æ˜ å°„æ›´ç®€å•, æŠŠç«¯å£å·æ”¹æ‰å°±è¡Œ.</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨dockeræœåŠ¡(systemctl start docker) </p></li><li><p>å¯åŠ¨å®¹å™¨</p></li></ol><h3 id="é…ç½®å®¹å™¨çš„é•œåƒæºï¼ˆå®‰è£…vimï¼‰"><a href="#é…ç½®å®¹å™¨çš„é•œåƒæºï¼ˆå®‰è£…vimï¼‰" class="headerlink" title="é…ç½®å®¹å™¨çš„é•œåƒæºï¼ˆå®‰è£…vimï¼‰"></a>é…ç½®å®¹å™¨çš„é•œåƒæºï¼ˆå®‰è£…vimï¼‰</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"></span><br><span class="line">echo &quot;deb http://mirrors.163.com/debian/ jessie main non-free contrib&quot; &gt;/etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">echo &quot;deb http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">echo &quot;deb-src http://mirrors.163.com/debian/ jessie main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">echo &quot;deb-src http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list </span><br><span class="line"><span class="meta">#</span><span class="bash">æ›´æ–°å®‰è£…æº</span> </span><br><span class="line">apt-get update </span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœä¸‹è½½è¿‡ç¨‹ä¸­å¡åœ¨[waiting <span class="keyword">for</span> headers] åˆ é™¤/var/cache/apt/archives/ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">å®‰è£…vim</span> </span><br><span class="line">apt-get install vim</span><br></pre></td></tr></table></figure><h1 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h1><ul><li><p><strong>RUN</strong> is executed while the image is being build</p><p>while <strong>ENTRYPOINT</strong> is executed after the image has been built.</p></li></ul><h1 id="advanced"><a href="#advanced" class="headerlink" title="advanced"></a>advanced</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;/core/core.%e.%p.%t&quot; | sudo tee /proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Elastic Stack learn</title>
      <link href="/2021/12/03/elasticstatic/"/>
      <url>/2021/12/03/elasticstatic/</url>
      
        <content type="html"><![CDATA[<p><strong>ELK</strong></p><blockquote><p>Elasticsearch æ˜¯ä¸€ä¸ªæœç´¢å’Œåˆ†æå¼•æ“ã€‚Logstash æ˜¯æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤ŸåŒæ—¶ä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°è¯¸å¦‚ Elasticsearch ç­‰â€œå­˜å‚¨åº“â€ä¸­ã€‚Kibana åˆ™å¯ä»¥è®©ç”¨æˆ·åœ¨ Elasticsearch ä¸­ä½¿ç”¨å›¾å½¢å’Œå›¾è¡¨å¯¹æ•°æ®è¿›è¡Œå¯è§†åŒ–ã€‚</p></blockquote><p>Elasticsearch is the living heart of what is todayâ€™s the most popular log analytics platform â€” the ELK Stack (Elasticsearch, Logstash and Kibana). Elasticsearchâ€™s role is so central that it has become synonymous with the name of the stack itself.</p><p>Elasticsearch behaves like a REST API, so you can use either theÂ <code>POST</code>Â or theÂ <code>PUT</code>Â method to add data to it. You useÂ <code>PUT</code>Â when you know the or want to specify theÂ <code>id</code>Â of the data item, orÂ <code>POST</code>Â if you want Elasticsearch to generate anÂ <code>id</code>Â for the data item:</p><h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><h4 id="max-file-descriptors-4096-for-elasticsearch-process-is-too-low-increase-to-at-least-65535"><a href="#max-file-descriptors-4096-for-elasticsearch-process-is-too-low-increase-to-at-least-65535" class="headerlink" title="max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]"></a>max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]</h4><p>If you want to increase the limit shown by <code>ulimit -n</code>, you should:</p><ul><li><p>Modify <code>/etc/systemd/user.conf</code> and <code>/etc/systemd/system.conf</code> with the following line (this takes care of graphical login):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DefaultLimitNOFILE=65535</span><br></pre></td></tr></table></figure></li><li><p>Modify <code>/etc/security/limits.conf</code> with the following lines (this takes care of non-GUI login):</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* hard nofile 65535</span><br><span class="line">* soft nofile 65535</span><br></pre></td></tr></table></figure></li><li><p>Reboot your computer for changes to take effect.</p></li><li><p>check</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulimit -Hn</span><br><span class="line">ulimit -Sn</span><br></pre></td></tr></table></figure></li></ul><h4 id="max-virtual-memory-areas-vm-max-map-count-65530-is-too-low-increase-to-at-least-262144"><a href="#max-virtual-memory-areas-vm-max-map-count-65530-is-too-low-increase-to-at-least-262144" class="headerlink" title="max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]"></a>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</h4><ul><li><p><code>vim /etc/sysctl.confÂ </code></p><p>æ–°å¢<strong>vm.max_map_count=655360</strong></p></li><li><p><code>sysctl -p</code></p></li></ul><h4 id="the-default-discovery-settings-are-unsuitable-for-production-use-at-least-one-of-discovery-seed-hosts-discovery-seed-providers-cluster-initial-master-nodes-must-be-configured"><a href="#the-default-discovery-settings-are-unsuitable-for-production-use-at-least-one-of-discovery-seed-hosts-discovery-seed-providers-cluster-initial-master-nodes-must-be-configured" class="headerlink" title="the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured"></a>the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured</h4><p>in short, if you are running Elasticsearch locally(single node) or just with a single node on the cloud then just use below config in yourÂ <code>elasticsearch.yml</code>Â to avoid the production check, and to make it work, more info about this config inÂ <a href="https://stackoverflow.com/a/60426167/4039431">this SO</a>Â answer:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">discovery.type:</span> <span class="string">single-node</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Elasticsearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nacos snippet</title>
      <link href="/2021/12/01/nacos%20snippet/"/>
      <url>/2021/12/01/nacos%20snippet/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><a href="https://juejin.cn/post/7136952484903256077">https://juejin.cn/post/7136952484903256077</a></p><h5 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ³¨å†Œ"></a>æœåŠ¡æ³¨å†Œ</h5><p>Spring Cloud Alibaba Nacos Discovery éµå¾ªäº† Spring Cloud Common æ ‡å‡†ï¼Œå®ç°äº† AutoServiceRegistrationã€ServiceRegistryã€Registration è¿™ä¸‰ä¸ªæ¥å£ã€‚</p><p>åœ¨ Spring Cloud åº”ç”¨çš„å¯åŠ¨é˜¶æ®µï¼Œç›‘å¬äº† WebServerInitializedEvent äº‹ä»¶ï¼Œå½“ Web å®¹å™¨åˆå§‹åŒ–å®Œæˆåï¼Œå³æ”¶åˆ° WebServerInitializedEvent äº‹ä»¶åï¼Œä¼šè§¦å‘æ³¨å†Œçš„åŠ¨ä½œï¼Œè°ƒç”¨ ServiceRegistry çš„ register æ–¹æ³•ï¼Œå°†æœåŠ¡æ³¨å†Œåˆ° Nacos Serverã€‚</p><p>![nacoså®¢æˆ·ç«¯æ³¨å†Œæœºåˆ¶](/images/nacos/nacos client register mechanism.png)</p><ul><li><p>python nacos client</p><p><a href="https://pypi.org/project/nacos-client-python/">nacos-client-python</a></p></li></ul><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><ul><li>2.xç‰ˆæœ¬å¯åŠ¨ï¼Œéœ€è¦æ·»åŠ  -må±æ€§<code>./startup.sh -m standalone</code></li></ul><h2 id="å¿ƒè·³æœºåˆ¶"><a href="#å¿ƒè·³æœºåˆ¶" class="headerlink" title="å¿ƒè·³æœºåˆ¶"></a>å¿ƒè·³æœºåˆ¶</h2><h3 id="å¥åº·æ£€æŸ¥"><a href="#å¥åº·æ£€æŸ¥" class="headerlink" title="å¥åº·æ£€æŸ¥"></a>å¥åº·æ£€æŸ¥</h3><p>æœåŠ¡ç«¯æ¥å—åˆ°å®¢æˆ·ç«¯çš„æœåŠ¡æ³¨å†Œè¯·æ±‚åï¼Œåœ¨åˆ›å»ºç©ºçš„Serviceåï¼Œå°±ä¼šå¼€å¯å¥åº·æ£€æŸ¥ä»»åŠ¡</p><ul><li>åœ¨è¶…è¿‡15ç§’æ²¡æ”¶åˆ°å®¢æˆ·ç«¯å¿ƒè·³æ—¶ï¼Œå°±ä¼šæŠŠæ³¨å†Œè¡¨ä¸­å®ä¾‹çš„å¥åº·çŠ¶æ€æ”¹ä¸ºfalse</li><li>è¶…æ—¶30ç§’æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯å¿ƒè·³æ—¶ï¼Œå°±ä¼šä»æ³¨å†Œè¡¨è¡¨å‰”é™¤è¯¥å®ä¾‹ï¼Œä¼šä½¿ç”¨HTTP DELETEæ–¹å¼è°ƒç”¨/v1/ns/instanceåœ°å€</li></ul><h2 id="open-API"><a href="#open-API" class="headerlink" title="open API"></a>open API</h2><ul><li>è·å–æ‰€æœ‰æœåŠ¡åˆ—è¡¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &#x27;http://127.0.0.1:8848/nacos/v2/ns/service/list&#x27;</span><br></pre></td></tr></table></figure><ul><li>è·å–å¿ƒè·³</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &#x27;127.0.0.1:8848/nacos/v2/ns/instance/beat&#x27; \</span><br><span class="line">-d &#x27;&#123;</span><br><span class="line">      &quot;namespaceId&quot;: &quot;jarvex_space&quot;,</span><br><span class="line">      &quot;serviceName&quot;: &quot;jarvex-common-group@@entity-server&quot;,</span><br><span class="line">      &quot;ip&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">      &quot;port&quot;: &quot;5333&quot;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">æˆ–</span><br><span class="line">curl -X PUT &#x27;127.0.0.1:8848/nacos/v2/ns/instance/beat&#x27; \</span><br><span class="line">      -d &#x27;namespaceId=jarvex_space&#x27; \</span><br><span class="line">      -d &#x27;serviceName=jarvex-common-group@@entity-server&#x27; \</span><br><span class="line">      -d &#x27;ip=127.0.0.1&#x27; \</span><br><span class="line">      -d &#x27;port=5333&#x27;</span><br></pre></td></tr></table></figure><ul><li><p>åˆ›å»ºå‘½ä»¤ç©ºé—´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -d &#x27;namespaceId=jarvex_space&#x27; \</span><br><span class="line">  -d &#x27;namespaceName=jarvex&#x27; \</span><br><span class="line">  -X POST</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æŒä¹…åŒ–å®ä¾‹</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X DELETE &quot;http://127.0.0.1:8848/nacos/v2/ns/instance?serviceName=jarvex-gateway&amp;ip=192.168.1.148&amp;port=8085&amp;namespaceId=jarvex_space&amp;groupName=jarvex-common-group&amp;ephemeral=false&quot;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€é…ç½®"><a href="#åŠ¨æ€é…ç½®" class="headerlink" title="åŠ¨æ€é…ç½®"></a>åŠ¨æ€é…ç½®</h2><h3 id="æ–¹æ¡ˆä¸€-nacos-configé…ç½®ä¸­å¿ƒè·å–"><a href="#æ–¹æ¡ˆä¸€-nacos-configé…ç½®ä¸­å¿ƒè·å–" class="headerlink" title="æ–¹æ¡ˆä¸€: nacos configé…ç½®ä¸­å¿ƒè·å–"></a>æ–¹æ¡ˆä¸€: nacos configé…ç½®ä¸­å¿ƒè·å–</h3><ul><li><p>é€šè¿‡é…ç½®nacos configå’Œ controllerè·å–</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">config</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">enabled</span>: <span class="string">true</span></span><br><span class="line">  <span class="meta">server-addr</span>: <span class="string">$&#123;spring.cloud.nacos.server-addr&#125;</span></span><br><span class="line">  <span class="meta">file-extension</span>: <span class="string">yaml</span></span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">public</span></span><br></pre></td></tr></table></figure><p>controllerç±»ä½¿ç”¨ @Refreshï¼Œåˆ·æ–°åŠ¨æ€é…ç½®</p></li></ul><h3 id="æ–¹æ¡ˆäºŒï¼šnacos-client-ç›‘å¬æŒ‡å®šé…ç½®æ–‡ä»¶ï¼ˆrecommendedï¼‰"><a href="#æ–¹æ¡ˆäºŒï¼šnacos-client-ç›‘å¬æŒ‡å®šé…ç½®æ–‡ä»¶ï¼ˆrecommendedï¼‰" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šnacos client ç›‘å¬æŒ‡å®šé…ç½®æ–‡ä»¶ï¼ˆrecommendedï¼‰"></a>æ–¹æ¡ˆäºŒï¼šnacos client ç›‘å¬æŒ‡å®šé…ç½®æ–‡ä»¶ï¼ˆrecommendedï¼‰</h3><ul><li>ç¼–å†™ç›‘å¬ç±»</li><li>æ‰‹åŠ¨åˆ·æ–°é…ç½®</li></ul><h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><ul><li><a href="https://www.lijunyi.xyz/docs/SpringCloud/SpringCloud.html#%E6%95%B4%E4%BD%93%E5%A4%A7%E7%BA%B2%F0%9F%92%A8">https://www.lijunyi.xyz/docs/SpringCloud/SpringCloud.html#%E6%95%B4%E4%BD%93%E5%A4%A7%E7%BA%B2%F0%9F%92%A8</a></li><li><a href="http://47.109.59.205/2023/01/02/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/#1-Nacos%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86">http://47.109.59.205/2023/01/02/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/#1-Nacos%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86</a></li><li><a href="https://cloud.tencent.com/developer/article/2096938">https://cloud.tencent.com/developer/article/2096938</a></li><li><a href="https://www.cnblogs.com/taojietaoge/p/16638226.html">https://www.cnblogs.com/taojietaoge/p/16638226.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> spring cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu snippet</title>
      <link href="/2021/10/08/ubuntu%20snippet/"/>
      <url>/2021/10/08/ubuntu%20snippet/</url>
      
        <content type="html"><![CDATA[<h2 id="ç£ç›˜æŒ‚è½½"><a href="#ç£ç›˜æŒ‚è½½" class="headerlink" title="ç£ç›˜æŒ‚è½½"></a>ç£ç›˜æŒ‚è½½</h2><ol><li><p>Get the UUID of the partition</p><p><code>sudo blkid</code></p></li><li><p>Add partition to fstab</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> /data was on /dev/sda3</span></span><br><span class="line">UUID=0009091A00027E42 /data            ntfs   defaults,iocharset=utf8,fmask=111,dmask=002        0       2</span><br></pre></td></tr></table></figure></li></ol><h2 id="deepin-wine"><a href="#deepin-wine" class="headerlink" title="deepin wine"></a>deepin wine</h2><h2 id="ç™¾åº¦ç½‘ç›˜id"><a href="#ç™¾åº¦ç½‘ç›˜id" class="headerlink" title="ç™¾åº¦ç½‘ç›˜id"></a>ç™¾åº¦ç½‘ç›˜id</h2><ul><li><p>ä¸€ç›´åœç•™åœ¨ç™»å½•ç•Œé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ é™¤ã€€ï½/baidunetdiskæ–‡ä»¶å¤¹ï¼Œå†æ¬¡å¯åŠ¨å³å¯</span><br></pre></td></tr></table></figure></li></ul><h2 id="å…‰é©±ç›¸å…³"><a href="#å…‰é©±ç›¸å…³" class="headerlink" title="å…‰é©±ç›¸å…³"></a>å…‰é©±ç›¸å…³</h2><p>CDROM, DVD è¿™äº›è®¾å¤‡ç°åœ¨æ¥è¯´éƒ½æ˜¯å±äºå¤è‘£äº†ï¼Œä½†å› ä¸ºæœ‰äº›ç¬¬ä¸‰æ–¹è½¯ä»¶æ˜¯ä»¥CDROMçš„å½¢å¼æä¾›çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™è¿˜ä¼šé‡åˆ°å¦‚ä½•æŒ‚è½½çš„é—®é¢˜?</p><p>åœ¨Ubuntu Server 18.04ä¸­ï¼Œè¦æŒ‚è½½ CDROM(DVD)å¯ä»¥éµå¾ªä»¥ä¸‹æ­¥éª¤:</p><h4 id="æŒ‚è½½-CDROM-DVD"><a href="#æŒ‚è½½-CDROM-DVD" class="headerlink" title="æŒ‚è½½ CDROM(DVD)"></a>æŒ‚è½½ CDROM(DVD)</h4><ol><li>ç¡®è®¤è®¾å¤‡æ–‡ä»¶å, è¿›å…¥ dev ç›®å½•ï¼Œ æ‰§è¡Œï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /dev</span><br><span class="line">ls -lt | less</span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿæ˜¾ç¤ºä¸€ä¸ªè®¾å¤‡åˆ—è¡¨ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸¤ä¸ªç‰¹åˆ«çš„ï¼Œåˆ†åˆ«æ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cdrom -&gt; sr0</span><br><span class="line">dvd -&gt; sr0</span><br></pre></td></tr></table></figure><p>è¯´æ˜ç³»ç»Ÿå·²ç»å°† cdrom, dvd å‘½åä¸º sr0 çš„åˆ«åï¼Œå…¶å®æ˜¯åŒä¸€ä¸ªè®¾å¤‡ã€‚</p><ol><li>æ‰§è¡Œ mount å‘½ä»¤æŒ‚è½½cdrom, å› ä¸º ubuntu server 18.04ä¸­ï¼Œå·²ç»åœ¨æ ¹ç›®å½•ä¸‹å»ºäº†ä¸€ä¸ªåä¸º cdrom çš„ç›®å½•ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨è¿™ä¸ªç›®å½•æ¥æŒ‚è½½ï¼Œæ‰§è¡Œ:</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount /dev/cdrom /cdrom</span><br></pre></td></tr></table></figure><h4 id="å¸è½½-CDROM-DVD"><a href="#å¸è½½-CDROM-DVD" class="headerlink" title="å¸è½½ CDROM (DVD)"></a>å¸è½½ CDROM (DVD)</h4><p>è¦æƒ³å¸è½½ CDROM, å¯ä»¥ç®€å•çš„æ‰§è¡Œ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount /cdrom</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æƒ³æ¨å‡ºå½“å‰çš„å…‰ç›˜ï¼Œåˆ™å¯ä»¥æ‰§è¡Œ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo eject /cdrom</span><br></pre></td></tr></table></figure><h2 id="postgre"><a href="#postgre" class="headerlink" title="postgre"></a>postgre</h2><p>åœ¨æœ¬æœºå®‰è£…ï¼Œédockerï¼Œuser: postgres     pw:postgres </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres psql</span><br></pre></td></tr></table></figure><h2 id="æ›´æ”¹-Ubuntu-18-04-ç™»é™†èƒŒæ™¯"><a href="#æ›´æ”¹-Ubuntu-18-04-ç™»é™†èƒŒæ™¯" class="headerlink" title="æ›´æ”¹ Ubuntu 18.04 ç™»é™†èƒŒæ™¯"></a>æ›´æ”¹ Ubuntu 18.04 ç™»é™†èƒŒæ™¯</h2><ol><li><p><code>sudo vi /etc/alternatives/gdm3.css</code></p></li><li><p>ä¿®æ”¹ CSS æ–‡ä»¶å†…å®¹</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#lockDialogGroup</span> &#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">/*è‡ªå·±å–œæ¬¢çš„å›¾ç‰‡çš„è·¯å¾„ã€‚æ³¨æ„ï¼Œä¸éœ€è¦resource://å¼€å¤´*/</span>);</span><br><span class="line"><span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line"><span class="attribute">background-size</span>: cover;</span><br><span class="line"><span class="attribute">background-position</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="é…åˆelectron-ssrè¿›è¡Œç»ˆç«¯å¤–ç½‘è®¿é—®"><a href="#é…åˆelectron-ssrè¿›è¡Œç»ˆç«¯å¤–ç½‘è®¿é—®" class="headerlink" title="é…åˆelectron-ssrè¿›è¡Œç»ˆç«¯å¤–ç½‘è®¿é—®"></a>é…åˆelectron-ssrè¿›è¡Œç»ˆç«¯å¤–ç½‘è®¿é—®</h2><p>åœ¨<code>/etc/profile</code>ä¸­æ·»åŠ é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy=&quot;http://127.0.0.1:12333&quot;</span><br><span class="line">export https_proxy=&quot;http://127.0.0.1:12333&quot;</span><br></pre></td></tr></table></figure><p>ç„¶å<code>source /etc/profile</code>å³å¯</p><h2 id="å‡çº§åˆ°2204ç‰ˆæœ¬ä¸­æ–‡è¾“å…¥æ³•åªåœ¨ç»ˆç«¯å¯ç”¨è§£å†³"><a href="#å‡çº§åˆ°2204ç‰ˆæœ¬ä¸­æ–‡è¾“å…¥æ³•åªåœ¨ç»ˆç«¯å¯ç”¨è§£å†³" class="headerlink" title="å‡çº§åˆ°2204ç‰ˆæœ¬ä¸­æ–‡è¾“å…¥æ³•åªåœ¨ç»ˆç«¯å¯ç”¨è§£å†³"></a>å‡çº§åˆ°2204ç‰ˆæœ¬ä¸­æ–‡è¾“å…¥æ³•åªåœ¨ç»ˆç«¯å¯ç”¨è§£å†³</h2><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/508797663">https://zhuanlan.zhihu.com/p/508797663</a></p></blockquote><ul><li>/etc/profile æ·»åŠ </li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export XMODIFIERS=@im=fcitx</span><br><span class="line">export GTK_IM_MODULE=fcitx</span><br><span class="line">export QT_IM_MODULE=fcitx</span><br></pre></td></tr></table></figure><ul><li>~/.pam_environment æ·»åŠ ä»¥ä¸‹å‡ è¡Œï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GTK_IM_MODULE DEFAULT=fcitx</span><br><span class="line">QT_IM_MODULE DEFAULT=fcitx</span><br><span class="line">XMODIFIERS DEFAULT=@im=fcitx</span><br><span class="line">SDL_IM_MODULE DEFAULT=fcitx</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM Learn</title>
      <link href="/2021/09/01/JVM%20learn/"/>
      <url>/2021/09/01/JVM%20learn/</url>
      
        <content type="html"><![CDATA[<h2 id="å †å†…ä¸å †å¤–"><a href="#å †å†…ä¸å †å¤–" class="headerlink" title="å †å†…ä¸å †å¤–"></a>å †å†…ä¸å †å¤–</h2><h3 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h3><ul><li><p>å¸¸è¯´çš„å †ï¼ŒæŒ‡çš„æ˜¯å †å†…å†…å­˜ï¼Œç”±JVMã€Œæ‰˜ç®¡ã€çš„å†…å­˜åŒºåŸŸã€‚å¯¹åº”çš„è‹±æ–‡æ˜¯ï¼šon-heap Memoryã€‚æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯æ”¾åœ¨å †ä¸­ã€‚</p></li><li><p>å †çš„ç‰¹ç‚¹ï¼š</p></li><li><ul><li>ç”±GCç®¡ç†ï¼Œä¸€æ—¦å †å¤§å°å¤§äº1GBä¼šå‡ºç°æ¯”è¾ƒæ˜æ˜¾çš„æš‚åœã€‚</li><li>å¯¹è±¡å­˜å‚¨åˆ°GCä¸­æ— éœ€è¿›è¡Œåºåˆ—åŒ–ã€ååºåˆ—åŒ–çš„ã€‚</li></ul></li></ul><h3 id="å †å¤–"><a href="#å †å¤–" class="headerlink" title="å †å¤–"></a>å †å¤–</h3><ul><li><p>å †å¤–å°±æ˜¯JVMå¼€è¾Ÿå‡ºæ¥çš„ï¼Œå †ä»¥å¤–çš„ä¸€å—ã€Œéæ‰˜ç®¡ã€å†…å­˜åŒºåŸŸã€‚å¯¹åº”çš„è‹±æ–‡æ˜¯ï¼šoff-heap Memoryã€‚å †å¤–å†…å­˜ä¹Ÿæ˜¯ JVM è¿›ç¨‹å¼€è¾Ÿçš„ä¸€å—å†…å­˜ç©ºé—´ã€‚åªä¸è¿‡ï¼ŒGCä¸ä¼šã€Œå…‰é¡¾ã€è¿™é‡Œã€‚</p></li><li><p>å †å¤–çš„ç‰¹ç‚¹ï¼š</p></li><li><ul><li>ç”±æ“ä½œç³»ç»Ÿç›´æ¥ç®¡ç†ã€‚åˆ«çš„è¿›ç¨‹èƒ½å¤Ÿç›´æ¥è®¿é—®ã€‚</li><li>ç‰¹åˆ«é€‚åˆåˆ†é…æ¬¡æ•°å°‘ï¼Œè¯»å†™éå¸¸é¢‘ç¹çš„åœºæ™¯ã€‚</li><li>å¯ä»¥é¿å…åœ¨åˆ†é…GBçº§åˆ«çš„å†…å­˜è€Œé€ æˆGCå¼€é”€ã€‚</li></ul></li><li><p>å †å¤–çš„ç¼ºç‚¹ï¼š</p></li><li><ul><li>å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼ï¼Œéš¾ä»¥æ’æŸ¥ã€‚</li><li>å¯¹è±¡çš„å­˜å‚¨éœ€è¦åºåˆ—åŒ–ã€å’Œååºåˆ—åŒ–ã€‚</li></ul></li></ul><p>å› ä¸ºå †å¤–å†…å­˜ç”±æ­¤ç‰¹ç‚¹ï¼Œå¾ˆå¤šé«˜æ€§èƒ½çš„åº”ç”¨ç»„ä»¶åŸºäºoff-heapæ¥æé«˜æ€§èƒ½ã€‚</p><h4 id="å †å¤–å†…å­˜å¸¸é…åˆä½¿ç”¨System-GC"><a href="#å †å¤–å†…å­˜å¸¸é…åˆä½¿ç”¨System-GC" class="headerlink" title="å †å¤–å†…å­˜å¸¸é…åˆä½¿ç”¨System GC"></a>å †å¤–å†…å­˜å¸¸é…åˆä½¿ç”¨System GC</h4><blockquote><p>å †å¤–å†…å­˜ä¸»è¦é’ˆå¯¹java.nio.DirectByteBufferï¼Œè¿™äº›å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ä¼šé€šè¿‡Unsafeæ¥å£ç›´æ¥é€šè¿‡os::mallocæ¥åˆ†é…å†…å­˜ï¼Œç„¶åå°†å†…å­˜çš„èµ·å§‹åœ°å€å’Œå¤§å°å­˜åˆ°java.nio.DirectByteBufferå¯¹è±¡é‡Œï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥æ“ä½œè¿™äº›å†…å­˜ã€‚è¿™äº›å†…å­˜åªæœ‰åœ¨DirectByteBufferå›æ”¶æ‰ä¹‹åæ‰æœ‰æœºä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¦‚æœè¿™äº›å¯¹è±¡å¤§éƒ¨åˆ†éƒ½ç§»åˆ°äº†oldï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰è§¦å‘CMS GCæˆ–è€…Full GCï¼Œé‚£ä¹ˆæ‚²å‰§å°†ä¼šå‘ç”Ÿï¼Œå› ä¸ºä½ çš„ç‰©ç†å†…å­˜è¢«ä»–ä»¬è€—å°½äº†ï¼Œå› æ­¤ä¸ºäº†é¿å…è¿™ç§æ‚²å‰§çš„å‘ç”Ÿï¼Œé€šè¿‡-XX:MaxDirectMemorySizeæ¥æŒ‡å®šæœ€å¤§çš„å †å¤–å†…å­˜å¤§å°ï¼Œå½“ä½¿ç”¨è¾¾åˆ°äº†é˜ˆå€¼çš„æ—¶å€™å°†è°ƒç”¨System.gcæ¥åšä¸€æ¬¡full gcï¼Œä»¥æ­¤æ¥å›æ”¶æ‰æ²¡æœ‰è¢«ä½¿ç”¨çš„å †å¤–å†…å­˜ã€‚</p></blockquote><h3 id="System-gcå¸¸è¯†"><a href="#System-gcå¸¸è¯†" class="headerlink" title="System.gcå¸¸è¯†"></a>System.gcå¸¸è¯†</h3><ul><li>system.gcå…¶å®æ˜¯åšä¸€æ¬¡full gc</li><li>system.gcä¼šæš‚åœæ•´ä¸ªè¿›ç¨‹</li><li>system.gcä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬è¦ç¦æ‰ï¼Œä½¿ç”¨-XX:+DisableExplicitGC</li><li>system.gcåœ¨cms gcä¸‹æˆ‘ä»¬é€šè¿‡-XX:+ExplicitGCInvokesConcurrentæ¥åšä¸€æ¬¡ç¨å¾®é«˜æ•ˆç‚¹çš„GC(æ•ˆæœæ¯”Full GCè¦å¥½äº›)</li><li>system.gcæœ€å¸¸è§çš„åœºæ™¯æ˜¯RMI/NIOä¸‹çš„å †å¤–å†…å­˜åˆ†é…ç­‰</li></ul><h1 id="jvmå¸¸ç”¨å‚æ•°çš„è®¾ç½®å’Œå«ä¹‰"><a href="#jvmå¸¸ç”¨å‚æ•°çš„è®¾ç½®å’Œå«ä¹‰" class="headerlink" title="jvmå¸¸ç”¨å‚æ•°çš„è®¾ç½®å’Œå«ä¹‰"></a>jvmå¸¸ç”¨å‚æ•°çš„è®¾ç½®å’Œå«ä¹‰</h1><p><strong>1.è®¾ç½®å †çš„æœ€å¤§å’Œæœ€å°å€¼</strong><br> -Xmx20M(æœ€å¤§å€¼) ,-Xms20M(æœ€å°å€¼)ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmså’Œ-Xmxå®é™…ä¸Šæ˜¯ -XX:InitialHeapSize å’Œ-XX:MaxHeapSize çš„ç¼©å†™</span><br></pre></td></tr></table></figure><p><strong>2.è®¾ç½®æ ˆçš„å¤§å°</strong><br> -Xss128kï¼š è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚JDK5.0ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1Mï¼Œä»¥å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º256Kã€‚æ›´å…·åº”ç”¨çš„çº¿ç¨‹æ‰€éœ€å†…å­˜å¤§å°è¿›è¡Œè°ƒæ•´ã€‚åœ¨ç›¸åŒç‰©ç†å†… å­˜ä¸‹ï¼Œå‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨3000~5000å·¦å³ã€‚</p><p>åŠŸèƒ½å¼€å…³:</p><table><thead><tr><th>å‚æ•°</th><th>é»˜è®¤å€¼æˆ–é™åˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-XX:-AllowUserSignalHandlers</td><td>é™äºLinuxå’ŒSolarisï¼Œé»˜è®¤ä¸å¯ç”¨</td><td>å…è®¸ä¸ºjavaè¿›ç¨‹å®‰è£…ä¿¡å·å¤„ç†å™¨,ä¿¡å·å¤„ç†å‚è§ç±»:sun.misc.Signal, sun.misc.SignalHandler</td></tr><tr><td>-XX:+DisableExplicitGC</td><td>é»˜è®¤å¯ç”¨</td><td>ç¦æ­¢åœ¨è¿è¡ŒæœŸæ˜¾å¼åœ°è°ƒç”¨System.gc()</td></tr><tr><td>-XX:+FailOverToOldVerifier</td><td>Java6æ–°å¼•å…¥é€‰é¡¹ï¼Œé»˜è®¤å¯ç”¨</td><td>å¦‚æœæ–°çš„Classæ ¡éªŒå™¨æ£€æŸ¥å¤±è´¥ï¼Œåˆ™ä½¿ç”¨è€çš„æ ¡éªŒå™¨(å¤±è´¥åŸå› :å› ä¸ºJDK6æœ€é«˜å‘ä¸‹å…¼å®¹åˆ°JDK1.2ï¼Œè€ŒJDK1.2çš„class info ä¸JDK6çš„infoå­˜åœ¨è¾ƒå¤§çš„å·®å¼‚ï¼Œæ‰€ä»¥æ–°æ ¡éªŒå™¨å¯èƒ½ä¼šå‡ºç°æ ¡éªŒå¤±è´¥çš„æƒ…å†µ)</td></tr><tr><td>-XX:+HandlePromotionFailure</td><td>java5ä»¥å‰æ˜¯é»˜è®¤ä¸å¯ç”¨ï¼Œjava6é»˜è®¤å¯ç”¨</td><td>å…³é—­æ–°ç”Ÿä»£æ”¶é›†æ‹…ä¿</td></tr><tr><td>-XX:+MaxFDLimit</td><td>é™äºSolarisï¼Œé»˜è®¤å¯ç”¨</td><td>è®¾ç½®javaè¿›ç¨‹å¯ç”¨æ–‡ä»¶æè¿°ç¬¦ä¸ºæ“ä½œç³»ç»Ÿå…è®¸çš„æœ€å¤§å€¼ã€‚</td></tr><tr><td>-XX:PreBlockSpin=10</td><td>-XX:+UseSpinning å¿…é¡»å…ˆå¯ç”¨ï¼Œå¯¹äºjava6æ¥è¯´å·²ç»é»˜è®¤å¯ç”¨äº†ï¼Œè¿™é‡Œé»˜è®¤è‡ªæ—‹10æ¬¡</td><td>æ§åˆ¶å¤šçº¿ç¨‹è‡ªæ—‹é”ä¼˜åŒ–çš„è‡ªæ—‹æ¬¡æ•°</td></tr><tr><td>-XX:-RelaxAccessControlCheck</td><td>é»˜è®¤ä¸å¯ç”¨</td><td>åœ¨Classæ ¡éªŒå™¨ä¸­ï¼Œæ”¾æ¾å¯¹è®¿é—®æ§åˆ¶çš„æ£€æŸ¥,ä½œç”¨ä¸reflectioné‡Œçš„setAccessibleç±»ä¼¼</td></tr><tr><td>-XX:+ScavengeBeforeFullGC</td><td>é»˜è®¤å¯ç”¨</td><td>åœ¨Full GCå‰è§¦å‘ä¸€æ¬¡Minor GC</td></tr><tr><td>-XX:+UseAltSigs</td><td>é™äºSolarisï¼Œé»˜è®¤å¯ç”¨</td><td>ä¸ºäº†é˜²æ­¢ä¸å…¶ä»–å‘é€ä¿¡å·çš„åº”ç”¨ç¨‹åºå†²çªï¼Œå…è®¸ä½¿ç”¨å€™è¡¥ä¿¡å·æ›¿ä»£ SIGUSR1å’ŒSIGUSR2</td></tr><tr><td>-XX:+UseBoundThreads</td><td>é™äºSolaris, é»˜è®¤å¯ç”¨</td><td>ç»‘å®šæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹åˆ°å†…æ ¸çº¿ç¨‹, å‡å°‘çº¿ç¨‹è¿›å…¥é¥¥é¥¿çŠ¶æ€ï¼ˆå¾—ä¸åˆ°ä»»ä½•cpu timeï¼‰çš„æ¬¡æ•°</td></tr><tr><td>-XX:-UseConcMarkSweepGC</td><td>é»˜è®¤ä¸å¯ç”¨</td><td>å¯ç”¨CMSä½åœé¡¿åƒåœ¾æ”¶é›†å™¨,å‡å°‘FGCçš„æš‚åœæ—¶é—´</td></tr><tr><td>-XX:+UseGCOverheadLimit</td><td>é»˜è®¤å¯ç”¨</td><td>é™åˆ¶GCçš„è¿è¡Œæ—¶é—´ã€‚å¦‚æœGCè€—æ—¶è¿‡é•¿ï¼Œå°±æŠ›OOM</td></tr><tr><td>-XX:+UseLWPSynchronization</td><td>é™äºsolarisï¼Œé»˜è®¤å¯ç”¨</td><td>ä½¿ç”¨è½»é‡çº§è¿›ç¨‹ï¼ˆå†…æ ¸çº¿ç¨‹ï¼‰æ›¿æ¢çº¿ç¨‹åŒæ­¥</td></tr><tr><td>-XX:-UseParallelGC</td><td>-serveræ—¶å¯ç”¨,å…¶ä»–æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸å¯ç”¨</td><td>ç­–ç•¥ä¸ºæ–°ç”Ÿä»£ä½¿ç”¨å¹¶è¡Œæ¸…é™¤ï¼Œå¹´è€ä»£ä½¿ç”¨å•çº¿ç¨‹Mark-Sweep-Compactçš„åƒåœ¾æ”¶é›†å™¨</td></tr><tr><td>-XX:-UseParallelOldGC</td><td>é»˜è®¤ä¸å¯ç”¨</td><td>ç­–ç•¥ä¸ºè€å¹´ä»£å’Œæ–°ç”Ÿä»£éƒ½ä½¿ç”¨å¹¶è¡Œæ¸…é™¤çš„åƒåœ¾æ”¶é›†å™¨</td></tr><tr><td>-XX:-UseSerialGC</td><td>-clientæ—¶å¯ç”¨,å…¶ä»–æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸å¯ç”¨</td><td>ä½¿ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</td></tr><tr><td>-XX:-UseSpinning</td><td>java1.4.2å’Œ1.5éœ€è¦æ‰‹åŠ¨å¯ç”¨, java6é»˜è®¤å·²å¯ç”¨</td><td>å¯ç”¨å¤šçº¿ç¨‹è‡ªæ—‹é”ä¼˜åŒ–</td></tr><tr><td>-XX:+UseTLAB</td><td>1.4.2ä»¥å‰å’Œä½¿ç”¨-clienté€‰é¡¹æ—¶ï¼Œé»˜è®¤ä¸å¯ç”¨ï¼Œå…¶ä½™ç‰ˆæœ¬é»˜è®¤å¯ç”¨</td><td>å¯ç”¨çº¿ç¨‹æœ¬åœ°ç¼“å­˜åŒº</td></tr><tr><td>-XX:+UseSplitVerifier</td><td>java5é»˜è®¤ä¸å¯ç”¨, java6é»˜è®¤å¯ç”¨</td><td>ä½¿ç”¨æ–°çš„Classç±»å‹æ ¡éªŒå™¨</td></tr><tr><td>-XX:+UseThreadPriorities</td><td>é»˜è®¤å¯ç”¨</td><td>ä½¿ç”¨æœ¬åœ°çº¿ç¨‹çš„ä¼˜å…ˆçº§</td></tr><tr><td>-XX:+UseVMInterruptibleIO</td><td>é™äºsolarisï¼Œé»˜è®¤å¯ç”¨</td><td>åœ¨solarisä¸­ï¼Œå…è®¸è¿è¡Œæ—¶ä¸­æ–­çº¿ç¨‹</td></tr></tbody></table><p>æ€§èƒ½å‚æ•°:</p><table><thead><tr><th>å‚æ•°</th><th>é»˜è®¤å€¼æˆ–é™åˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-XX:+AggressiveOpts</td><td>JDK 5 update 6åå¼•å…¥ï¼Œä½†éœ€è¦æ‰‹åŠ¨å¯ç”¨, JDK6é»˜è®¤å¯ç”¨</td><td>å¯ç”¨JVMå¼€å‘å›¢é˜Ÿæœ€æ–°çš„è°ƒä¼˜æˆæœã€‚ä¾‹å¦‚ç¼–è¯‘ä¼˜åŒ–ï¼Œåå‘é”ï¼Œå¹¶è¡Œå¹´è€ä»£æ”¶é›†ç­‰</td></tr><tr><td>-XX:CompileThreshold=10000</td><td>1000</td><td>é€šè¿‡JITç¼–è¯‘å™¨ï¼Œå°†æ–¹æ³•ç¼–è¯‘æˆæœºå™¨ç çš„è§¦å‘é˜€å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºè°ƒç”¨æ–¹æ³•çš„æ¬¡æ•°ï¼Œä¾‹å¦‚è°ƒ1000æ¬¡ï¼Œå°†æ–¹æ³•ç¼–è¯‘ä¸ºæœºå™¨ç </td></tr><tr><td>-XX:LargePageSizeInBytes=4m</td><td>é»˜è®¤4m, amd64ä½ï¼š2m</td><td>è®¾ç½®å †å†…å­˜çš„å†…å­˜é¡µå¤§å°</td></tr><tr><td>-XX:MaxHeapFreeRatio=70</td><td>70</td><td>GCåï¼Œå¦‚æœå‘ç°ç©ºé—²å †å†…å­˜å åˆ°æ•´ä¸ªé¢„ä¼°ä¸Šé™å€¼çš„70%ï¼Œåˆ™æ”¶ç¼©é¢„ä¼°ä¸Šé™å€¼</td></tr><tr><td>-XX:MaxNewSize=size</td><td>1.3.1 Sparc: 32m, 1.3.1 x86: 2.5m</td><td>æ–°ç”Ÿä»£å æ•´ä¸ªå †å†…å­˜çš„æœ€å¤§å€¼</td></tr><tr><td>-XX:MaxPermSize=64m</td><td>5.0ä»¥å: 64 bit VMsä¼šå¢å¤§é¢„è®¾å€¼çš„30%, 1.4 amd64: 96m, 1.3.1 -client: 32m, å…¶ä»–é»˜è®¤ 64m</td><td>Permï¼ˆä¿—ç§°æ–¹æ³•åŒºï¼‰å æ•´ä¸ªå †å†…å­˜çš„æœ€å¤§å€¼</td></tr><tr><td>-XX:MinHeapFreeRatio=40</td><td>40</td><td>GCåï¼Œå¦‚æœå‘ç°ç©ºé—²å †å†…å­˜å åˆ°æ•´ä¸ªé¢„ä¼°ä¸Šé™å€¼çš„40%ï¼Œåˆ™å¢å¤§ä¸Šé™å€¼</td></tr><tr><td>-XX:NewRatio=2</td><td>Sparc -client: 8, x86 -server: 8, x86 -client: 12, -client: 4 (1.3), 8 (1.3.1+), x86: 12, å…¶ä»–é»˜è®¤ 2</td><td>æ–°ç”Ÿä»£å’Œå¹´è€ä»£çš„å †å†…å­˜å ç”¨æ¯”ä¾‹, ä¾‹å¦‚2è¡¨ç¤ºæ–°ç”Ÿä»£å å¹´è€ä»£çš„1/2ï¼Œå æ•´ä¸ªå †å†…å­˜çš„1/3</td></tr><tr><td>-XX:NewSize=2.125m</td><td>5.0ä»¥å: 64 bit Vms ä¼šå¢å¤§é¢„è®¾å€¼çš„30%, x86: 1m, x86, 5.0ä»¥å: 640k, å…¶ä»–é»˜è®¤ 2.125m</td><td>æ–°ç”Ÿä»£é¢„ä¼°ä¸Šé™çš„é»˜è®¤å€¼</td></tr><tr><td>-XX:ReservedCodeCacheSize=32m</td><td>Solaris 64-bit, amd64, -server x86: 48m, 1.5.0_06ä¹‹å‰, Solaris 64-bit amd64: 1024m, å…¶ä»–é»˜è®¤ 32m</td><td>è®¾ç½®ä»£ç ç¼“å­˜çš„æœ€å¤§å€¼ï¼Œç¼–è¯‘æ—¶ç”¨</td></tr><tr><td>-XX:SurvivorRatio=8</td><td>Solaris amd64: 6, Sparc in 1.3.1: 25, Solaris platforms 5.0ä»¥å‰: 32, å…¶ä»–é»˜è®¤ 8</td><td>Edenä¸Survivorçš„å ç”¨æ¯”ä¾‹ã€‚ä¾‹å¦‚8è¡¨ç¤ºï¼Œä¸€ä¸ªsurvivoråŒºå ç”¨ 1/8 çš„Edenå†…å­˜ï¼Œå³1/10çš„æ–°ç”Ÿä»£å†…å­˜ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯1/9ï¼Ÿ å› ä¸ºæˆ‘ä»¬çš„æ–°ç”Ÿä»£æœ‰2ä¸ªsurvivorï¼Œå³S0å’ŒS1ã€‚æ‰€ä»¥survivoræ€»å…±æ˜¯å ç”¨æ–°ç”Ÿä»£å†…å­˜çš„ 2/10ï¼ŒEdenä¸æ–°ç”Ÿä»£çš„å æ¯”åˆ™ä¸º 8/10</td></tr><tr><td>-XX:TargetSurvivorRatio=50</td><td>50</td><td>å®é™…ä½¿ç”¨çš„survivorç©ºé—´å¤§å°å æ¯”ã€‚é»˜è®¤æ˜¯50%ï¼Œæœ€é«˜90%</td></tr><tr><td>-XX:ThreadStackSize=512</td><td>Sparc: 512, Solaris x86: 320 (5.0ä»¥å‰ 256), Sparc 64 bit: 1024, Linux amd64: 1024 (5.0 ä»¥å‰ 0), å…¶ä»–é»˜è®¤ 512.</td><td>çº¿ç¨‹å †æ ˆå¤§å°</td></tr><tr><td>-XX:+UseBiasedLocking</td><td>JDK 5 update 6åå¼•å…¥ï¼Œä½†éœ€è¦æ‰‹åŠ¨å¯ç”¨, JDK6é»˜è®¤å¯ç”¨</td><td>å¯ç”¨åå‘é”</td></tr><tr><td>-XX:+UseFastAccessorMethods</td><td>é»˜è®¤å¯ç”¨</td><td>ä¼˜åŒ–åŸå§‹ç±»å‹çš„getteræ–¹æ³•æ€§èƒ½(get/set:Primitive Type)</td></tr><tr><td>-XX:-UseISM</td><td>é»˜è®¤å¯ç”¨</td><td>å¯ç”¨solarisçš„ISM</td></tr><tr><td>-XX:+UseLargePages</td><td>JDK 5 update 5åå¼•å…¥ï¼Œä½†éœ€è¦æ‰‹åŠ¨å¯ç”¨, JDK6é»˜è®¤å¯ç”¨</td><td>å¯ç”¨å¤§å†…å­˜åˆ†é¡µ</td></tr><tr><td>-XX:+UseMPSS</td><td>1.4.1 ä¹‹å‰: ä¸å¯ç”¨, å…¶ä½™ç‰ˆæœ¬é»˜è®¤å¯ç”¨</td><td>å¯ç”¨solarisçš„MPSSï¼Œä¸èƒ½ä¸ISMåŒæ—¶ä½¿ç”¨</td></tr><tr><td>-XX:+UseStringCache</td><td>é»˜è®¤å¼€å¯</td><td>å¯ç”¨ç¼“å­˜å¸¸ç”¨çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td>-XX:AllocatePrefetchLines=1</td><td>1</td><td>Number of cache lines to load after the last object allocation using prefetch instructions generated in JIT compiled code. Default values are 1 if the last allocated object was an instance and 3 if it was an array.</td></tr><tr><td>-XX:AllocatePrefetchStyle=1</td><td>1</td><td>Generated code style for prefetch instructions. 0 â€“ no prefetch instructions are generate<em>d</em>, 1 â€“ execute prefetch instructions after each allocation, 2 â€“ use TLAB allocation watermark pointer to gate when prefetch instructions are executed.</td></tr><tr><td>-XX:+UseCompressedStrings</td><td>Java 6 update 21æœ‰ä¸€é€‰é¡¹</td><td>å…¶ä¸­ï¼Œå¯¹äºä¸éœ€è¦16ä½å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨byte[] è€Œéchar[]ã€‚å¯¹äºè®¸å¤šåº”ç”¨ï¼Œè¿™å¯ä»¥èŠ‚çœå†…å­˜ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ï¼ˆ5ï¼…-10ï¼…ï¼‰</td></tr><tr><td>-XX:+OptimizeStringConcat</td><td>åœ¨Java 6æ›´æ–°20ä¸­å¼•å…¥</td><td>ä¼˜åŒ–å­—ç¬¦ä¸²è¿æ¥æ“ä½œåœ¨å¯èƒ½çš„æƒ…å†µä¸‹</td></tr></tbody></table><p>è°ƒè¯•å‚æ•°:</p><table><thead><tr><th>å‚æ•°</th><th>é»˜è®¤å€¼æˆ–é™åˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-XX:-CITime</td><td></td><td>æ‰“å°å‘è´¹åœ¨JITç¼–è¯‘ä¸Šçš„æ—¶é—´</td></tr><tr><td>-XX:ErrorFile=./hs_err_pid<pid>.log</td><td>JDK6ä¸­å¼•å…¥</td><td>é”™è¯¯æ–‡ä»¶</td></tr><tr><td>-XX:-ExtendedDTraceProbes</td><td>JDK6ä¸­å¼•å…¥ä»…åœ¨Solaris</td><td>å¯ç”¨æ€§èƒ½çš„å½±å“DTraceæ¢æµ‹å™¨</td></tr><tr><td>-XX:HeapDumpPath=./java_pid<pid>.hprof</td><td>1.4.2 update 12, 5.0 update 7</td><td>æŒ‡å®šHeapDumpçš„æ–‡ä»¶è·¯å¾„æˆ–ç›®å½•</td></tr><tr><td>-XX:-HeapDumpOnOutOfMemoryError</td><td>1.4.2 update 12, 5.0 update 7</td><td>å½“æŠ›å‡ºOOMæ—¶è¿›è¡ŒHeapDump</td></tr><tr><td>-XX:OnError=â€<cmd args>;<cmd args>â€</td><td>1.4.2 update 9</td><td>å½“å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤</td></tr><tr><td>-XX:OnOutOfMemoryError=â€<cmd args>; <cmd args>â€</td><td>1.4.2 update 12, 6</td><td>å½“å‘ç”ŸOOMæ—¶æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤</td></tr><tr><td>-XX:-PrintClassHistogram</td><td>1.4.2</td><td>å½“Ctrl+Breakå‘ç”Ÿæ—¶æ‰“å°Classå®ä¾‹ä¿¡æ¯,ä¸jmap -histoç›¸åŒ</td></tr><tr><td>-XX:-PrintConcurrentLocks</td><td>6</td><td>å½“Ctrl+Breakå‘ç”Ÿæ—¶æ‰“å°java.util.concurrentçš„é”ä¿¡æ¯, ä¸jstack -lç›¸åŒ</td></tr><tr><td>-XX:-PrintCommandLineFlags</td><td>5</td><td>æ‰“å°å‘½ä»¤è¡Œä¸Šçš„æ ‡è®°</td></tr><tr><td>-XX:-PrintCompilation</td><td></td><td>å½“æ–¹æ³•è¢«ç¼–è¯‘æ—¶æ‰“å°ä¿¡æ¯</td></tr><tr><td>-XX:-PrintGC</td><td></td><td>å½“GCå‘ç”Ÿæ—¶æ‰“å°ä¿¡æ¯</td></tr><tr><td>-XX:-PrintGCDetails</td><td>1.4.0</td><td>æ‰“å°GCè¯¦ç»†ä¿¡æ¯</td></tr><tr><td>-XX:-PrintGCTimeStamps</td><td>1.4.0</td><td>æ‰“å°GCç”¨æ—¶</td></tr><tr><td>-XX:-PrintTenuringDistribution</td><td></td><td>æ‰“å°Tenuringå¹´é¾„ä¿¡æ¯</td></tr><tr><td>-XX:-TraceClassLoading</td><td></td><td>è·Ÿè¸ªç±»åŠ è½½</td></tr><tr><td>-XX:-TraceClassLoadingPreorder</td><td>1.4.2</td><td>è·Ÿè¸ªæ‰€æœ‰åŠ è½½çš„å¼•ç”¨ç±»</td></tr><tr><td>-XX:-TraceClassResolution</td><td>1.4.2</td><td>è·Ÿè¸ªå¸¸é‡æ± çš„å˜åŒ–</td></tr><tr><td>-XX:-TraceClassUnloading</td><td></td><td>è·Ÿè¸ªç±»çš„å¸è½½</td></tr><tr><td>-XX:-TraceLoaderConstraints</td><td>6</td><td>Trace recording of loader constraints</td></tr><tr><td>-XX:+PerfSaveDataToFile</td><td></td><td>é€€å‡ºæ—¶ä¿å­˜jvmstatäºŒè¿›åˆ¶æ–‡ä»¶</td></tr><tr><td>-XX:ParallelGCThreads=</td><td></td><td>è®¾ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£å¹¶è¡Œåƒåœ¾å›æ”¶å™¨çš„çº¿ç¨‹æ•°</td></tr><tr><td>-XX:+UseCompressedOops</td><td></td><td>Enables the use of compressed pointers (object references represented as 32 bit offsets instead of 64-bit pointers) for optimized 64-bit performance with Java heap sizes less than 32gb.</td></tr><tr><td>-XX:+AlwaysPreTouch</td><td></td><td>Pre-touch the Java heap during JVM initialization. Every page of the heap is thus demand-zeroed during initialization rather than incrementally during application execution.</td></tr><tr><td>-XX:AllocatePrefetchDistance=</td><td></td><td>Sets the prefetch distance for object allocation. Memory about to be written with the value of new objects is prefetched into cache at this distance (in bytes) beyond the address of the last allocated object. Each Java thread has its own allocation point. The default value varies with the platform on which the JVM is running.</td></tr><tr><td>-XX:InlineSmallCode=</td><td></td><td>å½“ç¼–è¯‘çš„ä»£ç å°äºæŒ‡å®šçš„å€¼æ—¶,å†…è”ç¼–è¯‘çš„ä»£ç </td></tr><tr><td>-XX:MaxInlineSize=35</td><td></td><td>å†…è”æ–¹æ³•çš„æœ€å¤§å­—èŠ‚æ•°</td></tr><tr><td>-XX:FreqInlineSize=</td><td></td><td>å†…è”é¢‘ç¹æ‰§è¡Œçš„æ–¹æ³•çš„æœ€å¤§å­—èŠ‚ç å¤§å°</td></tr><tr><td>-XX:LoopUnrollLimit=</td><td></td><td>Unroll loop bodies with server compiler intermediate representation node count less than this value. The limit used by the server compiler is a function of this value, not the actual value. The default value varies with the platform on which the JVM is running.</td></tr><tr><td>-XX:InitialTenuringThreshold=7</td><td></td><td>è®¾ç½®åˆå§‹çš„å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­æœ€å¤§å­˜æ´»æ¬¡æ•°</td></tr><tr><td>-XX:MaxTenuringThreshold=</td><td></td><td>è®¾ç½®å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­æœ€å¤§çš„å­˜æ´»æ¬¡æ•°,æœ€å¤§å€¼15,å¹¶è¡Œå›æ”¶æœºåˆ¶é»˜è®¤ä¸º15,CMSé»˜è®¤ä¸º4</td></tr></tbody></table><h1 id="Garbage-Collectors"><a href="#Garbage-Collectors" class="headerlink" title="Garbage Collectors"></a>Garbage Collectors</h1><p>The JVM (Java Virtual Machine) has several different garbage collectors, including the <strong>Parallel Scavenge collector</strong> and the <strong>G1 (Garbage-First) collector</strong>. Both collectors have a â€œyoung generationâ€ that is responsible for storing newly created objects, but they work in different ways.</p><ul><li>Parallel Scavenge collector</li></ul><p>The Parallel Scavenge collectorâ€™s young generation, also known as the â€œPS young generationâ€, is divided into two regions called â€œEdenâ€ and â€œSurvivorâ€. The Eden region is where newly created objects are initially allocated, while the Survivor regions are used to store objects that have survived one or more garbage collection cycles. The idea is to quickly identify and collect objects that are no longer needed, while promoting long-lived objects to the older generation.</p><ul><li>G1 collector</li></ul><p>The G1 collector also has a young generation, which is referred to as the â€œG1 young generationâ€. Unlike the PS young generation, the G1 young generation does not have fixed regions like Eden and Survivor. Instead, the G1 collector divides the heap into equal-sized â€œregionsâ€ that can be used for both young and old objects, depending on their age and usage patterns. The G1 collector also uses a â€œremembered setâ€ to keep track of references between regions, which allows it to more efficiently identify and collect objects that are no longer needed.</p><p>Overall, both the PS and G1 collectors have their own strengths and weaknesses, and the best choice depends on the specific requirements and characteristics of the application. The G1 collector is generally considered to be more flexible and adaptive to different usage patterns, but the PS collector may be better suited for applications with short-lived objects and high object creation rates.</p><h1 id="classLoader"><a href="#classLoader" class="headerlink" title="classLoader"></a>classLoader</h1><h2 id="classå†²çª"><a href="#classå†²çª" class="headerlink" title="classå†²çª"></a>classå†²çª</h2><p>å¯ä»¥æ‰“å°å‡ºç±»çš„åŠ è½½é¡ºåºï¼Œå¯ä»¥ç”¨æ¥æ’æŸ¥ class çš„å†²çªé—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+TraceClassLoading</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker best practices</title>
      <link href="/2021/08/16/docker%20solution/"/>
      <url>/2021/08/16/docker%20solution/</url>
      
        <content type="html"><![CDATA[<h1 id="best-practices"><a href="#best-practices" class="headerlink" title="best practices"></a>best practices</h1><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><h3 id="dnf"><a href="#dnf" class="headerlink" title="dnf"></a>dnf</h3><ul><li><p>repo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li><li><p>install</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure></li><li><p>start</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl --now enable docker</span><br></pre></td></tr></table></figure></li><li><p>(optional) allow a non-root user to manage docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Add the current user</span></span><br><span class="line">sudo usermod -aG docker $USER</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Add a specific user</span></span><br><span class="line">sudo usermod -a -G docker custom-user</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">logout</span> and login new session</span> </span><br></pre></td></tr></table></figure></li></ul><h2 id="config-default-data-directory"><a href="#config-default-data-directory" class="headerlink" title="config default data directory"></a>config default data directory</h2><ul><li><p>default data directory <code>/var/lib/docker</code></p></li><li><p>change default directory</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1</span></span><br><span class="line">systemctl stop docker</span><br><span class="line">systemctl stop docker.socket</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2</span></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;data-root&quot;: &quot;/path/to/directory&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step3 (optional)</span></span><br><span class="line">sudo mv /var/lib/docker /path/to/directory</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2</span></span><br><span class="line">systemctl start docker.socket</span><br><span class="line">systemctl start docker </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check modify available</span></span><br><span class="line">docker info | grep &quot;Docker Root Dir&quot;</span><br></pre></td></tr></table></figure></li></ul><h2 id="non-root-user-manage-docker"><a href="#non-root-user-manage-docker" class="headerlink" title="non-root user manage docker"></a>non-root user manage docker</h2><ol><li><p>Create the <code>docker</code> group.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker</span><br></pre></td></tr></table></figure></li><li><p>Add your user to the <code>docker</code> group.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure></li><li><p>Log out and log back in so that your group membership is re-evaluated.</p><p>If testing on a virtual machine, it may be necessary to restart the virtual machine for changes to take effect.</p><p>On a desktop Linux environment such as X Windows, log out of your session completely and then log back in.</p><p>On Linux, you can also run the following command to activate the changes to groups:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newgrp docker </span><br></pre></td></tr></table></figure></li><li><p>Verify that you can run <code>docker</code> commands without <code>sudo</code>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure></li></ol><h2 id="migration"><a href="#migration" class="headerlink" title="migration"></a>migration</h2><p>reference </p><p><a href="https://bobcares.com/blog/move-docker-container-to-another-host/">5 ways to move Docker container to another host</a></p><p><a href="https://morioh.com/p/d8d9e7732952">Build a Docker Image with MySQL Database</a></p><h3 id="Plan-A"><a href="#Plan-A" class="headerlink" title="Plan A"></a>Plan A</h3><ul><li>Step1    create an Image From a Container</li></ul><blockquote><p>Create a new image from a containerâ€™s changes</p><p><a href="https://docs.docker.com/engine/reference/commandline/commit/">commit command</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure><p>options</p><table><thead><tr><th>Name, shorthand</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>--author</code> , <code>-a</code></td><td></td><td>Author (e.g., â€œwill brookâ€)</td></tr><tr><td><code>--change</code> , <code>-c</code></td><td></td><td>Apply Dockerfile instruction to the created image</td></tr><tr><td><code>--message</code> , <code>-m</code></td><td></td><td>Commit message</td></tr><tr><td><code>--pause</code> , <code>-p</code></td><td><code>true</code></td><td>Pause container during commit</td></tr></tbody></table><ul><li>Step 2    export the image to a file  </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker save -o /path/to/your_image.tar your_image_name</span><br></pre></td></tr></table></figure><ul><li>Step 3 load the Docker image file</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker load -i your_image.tar</span><br></pre></td></tr></table></figure><h3 id="Plan-B"><a href="#Plan-B" class="headerlink" title="Plan B"></a>Plan B</h3><ul><li>Step 1</li></ul><p>First save the new image by finding the container ID (usingÂ <a href="https://docs.docker.com/engine/reference/commandline/ps/"><code>docker container ls</code></a>) and then committing it to a new image name. Note that onlyÂ <code>a-z0-9-_.</code>Â are allowed when naming images:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> create image from container</span></span><br><span class="line">docker container commit c16378f943fe rhel-httpd:latest</span><br></pre></td></tr></table></figure><ul><li>Step 2</li></ul><p> tag the image with the host name or IP address, and the port of the registry:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> re-tag repository:tag info about image</span></span><br><span class="line">docker image tag rhel-httpd:latest registry-host:5000/myadmin/rhel-httpd:latest</span><br><span class="line">or</span><br><span class="line">docker tag 0e5574283393 registry-host:5000/myadmin/rhel-httpd:latest</span><br></pre></td></tr></table></figure><ul><li>Step 3</li></ul><p>log in from Docker client:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login &lt;harbor_address&gt;</span><br></pre></td></tr></table></figure><ul><li>Step 4</li></ul><p>push the image to the registry using the image ID. </p><p>In this example the registry is on host namedÂ <code>registry-host</code>Â and listening on portÂ <code>5000</code>. (harboré»˜è®¤é…ç½®ç«¯å£80ï¼Œè¯¦è§harbor.yml)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> push repository:tag,</span></span><br><span class="line">docker image push registry-host:5000/myadmin/rhel-httpd:latest</span><br><span class="line">or</span><br><span class="line">docker push registry-host:5000/myname/myimage</span><br></pre></td></tr></table></figure><h2 id="Pull-Image-from-Harbor"><a href="#Pull-Image-from-Harbor" class="headerlink" title="Pull Image from Harbor"></a>Pull Image from Harbor</h2><p><a href="https://goharbor.io/docs/2.0.0/install-config/run-installer-script/#connect-http">Connecting to Harbor via HTTP</a></p><ul><li>Step 1</li></ul><p>add the optionÂ <code>--insecure-registry</code>Â to your clientâ€™s Docker daemon. By default, the daemon file is located atÂ <code>/etc/docker/daemon.json</code>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;insecure-registries&quot; : [&quot;ip:port&quot;, &quot;0.0.0.0&quot;] #å¦‚æœportä¸º80ï¼Œåˆ™å¯çœç•¥</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Restart Docker Engine.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><ul><li>Step 2</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull hostAddress/library/REPOSITORY:TAG</span><br></pre></td></tr></table></figure><h2 id="check-docker-disk-usage"><a href="#check-docker-disk-usage" class="headerlink" title="check docker disk usage"></a>check docker disk usage</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Check Docker System Usage</span></span><br><span class="line">docker system df -v</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check volumes that are not attached to any containers</span></span><br><span class="line">docker volume ls -f dangling=true</span><br><span class="line"><span class="meta">#</span><span class="bash"> remove above dangling volume</span></span><br><span class="line">docker volume prune</span><br></pre></td></tr></table></figure><h2 id="removes-unused-containers-images-and-volumes"><a href="#removes-unused-containers-images-and-volumes" class="headerlink" title="removes unused containers, images, and volumes"></a>removes unused containers, images, and volumes</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> clear all build caches</span></span><br><span class="line">docker system prune -a</span><br><span class="line">or </span><br><span class="line">docker system prune</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, this removes:</span></span><br><span class="line">â€¢Stopped containers</span><br><span class="line">â€¢Dangling images</span><br><span class="line">â€¢Dangling networks</span><br><span class="line">â€¢Build cache</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> explicitly add the --volumes flag</span></span><br><span class="line">docker system prune --volumes</span><br></pre></td></tr></table></figure><h2 id="check-specify-repo-image-info"><a href="#check-specify-repo-image-info" class="headerlink" title="check specify repo image info"></a>check specify repo image info</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1: image list</span></span><br><span class="line">curl -s -u username:password &quot;https://&lt;repo-addr&gt;/api/v2.0/projects/&lt;project&gt;/repositories&quot; | jq .</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step2: check specify image tag list</span></span><br><span class="line">curl -s -u username:password &quot;https://&lt;repo-addr&gt;/api/v2.0/projects/&lt;project&gt;/repositories/&lt;image&gt;/artifacts&quot; | jq -r &#x27;.[].tags[].name&#x27;</span><br></pre></td></tr></table></figure><h2 id="fetch-current-login-user-info"><a href="#fetch-current-login-user-info" class="headerlink" title="fetch current login user info"></a>fetch current login user info</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.docker/config.json</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">print</span> like below</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;auths&quot;: &#123;</span><br><span class="line">    &quot;https://harbor.xxx.cn&quot;: &#123;</span><br><span class="line">      &quot;auth&quot;: &quot;xxxxx=&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;credsStore&quot;: &quot;desktop&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> decode base64 password</span> </span><br><span class="line">echo &#x27;xxx=&#x27; | base64 -d</span><br></pre></td></tr></table></figure><h2 id="temporary-env"><a href="#temporary-env" class="headerlink" title="temporary env"></a>temporary env</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ARG http_proxy=xxx</span><br><span class="line">ARG https_proxy=xxx</span><br></pre></td></tr></table></figure><h1 id="troubleshoot"><a href="#troubleshoot" class="headerlink" title="troubleshoot"></a>troubleshoot</h1><h2 id="Failed-to-load-listeners"><a href="#Failed-to-load-listeners" class="headerlink" title="Failed to load listeners"></a>Failed to load listeners</h2><blockquote><p> no sockets found via socket activation: make sure the service was started by systemd</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">edit the dockerâ€™s systemd unit file and change the ExecStart:</span><br><span class="line">sudo systemctl edit docker.service</span><br><span class="line"></span><br><span class="line">edite The value ExecStart, change fd:// to unix://:</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/bin/dockerd -H unix://</span><br></pre></td></tr></table></figure><h2 id="Error-creating-default-â€œbridgeâ€-network"><a href="#Error-creating-default-â€œbridgeâ€-network" class="headerlink" title="Error creating default â€œbridgeâ€ network"></a>Error creating default â€œbridgeâ€ network</h2><blockquote><p>cannot create network (docker0): conflicts with network (docker0): networks have same bridge name</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /var/lib/docker/network</span><br><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><h2 id="accident-delete-var-run-docker-sock"><a href="#accident-delete-var-run-docker-sock" class="headerlink" title="accident delete /var/run/docker.sock"></a>accident delete /var/run/docker.sock</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop docker</span><br><span class="line">sudo systemctl restart docker.socket</span><br><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><h2 id="check-run-image-error"><a href="#check-run-image-error" class="headerlink" title="check run image error"></a>check run image error</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format=&#x27;&#123;&#123;.State.Status&#125;&#125; &#123;&#123;.State.ExitCode&#125;&#125; &#123;&#123;.State.Error&#125;&#125;&#x27; $(docker ps -alq)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> practice </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰“å¡</title>
      <link href="/2021/04/16/record/"/>
      <url>/2021/04/16/record/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é‡‘é’±æ¢ä¸æ¥çš„ä¸œè¥¿æ‰ç®—çè´µï¼Œæ¯”å¦‚æ—¶é—´ã€å¥åº·ã€çŸ¥è¯†</p></blockquote><p>âœ”ï¸ </p><pre><code>    April   2021</code></pre><table><thead><tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td><a href="#41">1</a></td><td><a href="#42">2</a></td><td><a href="#43">3</a></td></tr><tr><td><a href="#44">4</a></td><td><a href="#45">5</a></td><td><a href="#46">6</a></td><td><a href="#47">7</a></td><td><a href="#48">8</a></td><td><a href="#49">9</a></td><td><a href="#410">10</a></td></tr><tr><td><a href="#411">11</a></td><td><a href="#412">12</a></td><td><a href="#413">13</a></td><td><a href="#414">14</a></td><td><a href="#415">15</a></td><td><a href="#416">16</a> âœ”ï¸</td><td><a href="#417">17</a></td></tr><tr><td><a href="#418">18</a></td><td><a href="#419">19</a></td><td><a href="#420">20</a></td><td><a href="#421">21</a></td><td><a href="#422">22</a></td><td><a href="#423">23</a></td><td><a href="#424">24</a></td></tr><tr><td><a href="#425">25</a></td><td><a href="#426">26</a></td><td><a href="#427">27</a></td><td><a href="#428">28</a></td><td><a href="#429">29</a></td><td><a href="#430">30</a></td><td></td></tr></tbody></table><pre><code>     June   2021          </code></pre><table><thead><tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr></thead><tbody><tr><td></td><td></td><td><a href="#61">1</a></td><td><a href="#62">2</a></td><td><a href="#63">3</a></td><td><a href="#64">4</a></td><td><a href="#65">5</a></td></tr><tr><td><a href="#66">6</a></td><td><a href="#67">7</a></td><td><a href="#68">8</a></td><td><a href="#69">9</a></td><td><a href="#610">10</a></td><td><a href="#611">11</a></td><td><a href="#612">12</a></td></tr><tr><td><a href="#613">13</a></td><td><a href="#614">14</a></td><td><a href="#615">15</a></td><td><a href="#616">16</a></td><td><a href="#617">17</a></td><td><a href="#618">18</a></td><td><a href="#619">19</a></td></tr><tr><td><a href="#620">20</a></td><td><a href="#621">21</a></td><td><a href="#622">22</a></td><td><a href="#623">23</a></td><td><a href="#624">24</a></td><td><a href="#625">25</a></td><td><a href="#626">26</a></td></tr><tr><td><a href="#627">27</a></td><td><a href="#628">28</a></td><td><a href="#629">29</a>âœ”ï¸</td><td><a href="#630">30</a>âœ”ï¸</td><td></td><td></td><td></td></tr></tbody></table><pre><code>     July   2021          </code></pre><table><thead><tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td><a href="#2021%E5%B9%B407%E6%9C%8801%E6%97%A5">1</a></td><td><a href="#72">2</a></td><td><a href="#73">3</a></td></tr><tr><td><a href="#74">4</a></td><td><a href="#75">5</a></td><td><a href="#76">6</a></td><td><a href="#77">7</a></td><td><a href="#78">8</a></td><td><a href="#79">9</a></td><td><a href="#710">10</a></td></tr><tr><td><a href="#711">11</a></td><td><a href="#712">12</a></td><td><a href="#713">13</a></td><td><a href="#714">14</a></td><td><a href="#715">15</a></td><td><a href="#716">16</a></td><td><a href="#717">17</a></td></tr><tr><td><a href="#718">18</a></td><td><a href="#719">19</a></td><td><a href="#720">20</a></td><td><a href="#721">21</a></td><td><a href="#722">22</a></td><td><a href="#723">23</a></td><td><a href="#724">24</a></td></tr><tr><td><a href="#725">25</a></td><td><a href="#726">26</a></td><td><a href="#727">27</a></td><td><a href="#728">28</a></td><td><a href="#729">29</a></td><td><a href="#730">30</a></td><td><a href="#731">31</a></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> will </category>
          
      </categories>
      
      
        <tags>
            
            <tag> record </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zookeeper learn</title>
      <link href="/2020/10/08/zookeeper%20learn/"/>
      <url>/2020/10/08/zookeeper%20learn/</url>
      
        <content type="html"><![CDATA[<h2 id="å‚æ•°é…ç½®"><a href="#å‚æ•°é…ç½®" class="headerlink" title="å‚æ•°é…ç½®"></a>å‚æ•°é…ç½®</h2><ul><li>tickTime</li></ul><p>Length of a single tick, in milliseconds. ZooKeeper uses tick as the basic time unit to regulate timeouts. Default is 2000.</p><ul><li>initLimit</li></ul><p>Number of ticks after which the ZooKeeper server times out during the synchronization process. Default is 10.</p><ul><li>syncLimit</li></ul><p>Maximum number of ticks for the followers to wait to synchronize with the leader before the followers time out. Default is 5.</p><ul><li>dataDir</li></ul><p>Absolute path for the ZooKeeper to store the in-memory snapshots of the data and the transactional log of updates to the database.</p><ul><li>clientPort</li></ul><p>Port on which the ZooKeeper server listens for client connections.</p><ul><li>maxClientCnxns</li></ul><p>Maximum number of concurrent connections that a single client can make to a single member of the ZooKeeper ensemble. Default is 10.</p><h2 id="ç»ˆç«¯æ“ä½œ"><a href="#ç»ˆç«¯æ“ä½œ" class="headerlink" title="ç»ˆç«¯æ“ä½œ"></a>ç»ˆç«¯æ“ä½œ</h2><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure><h3 id="æ–°å¢—èŠ‚ç‚¹"><a href="#æ–°å¢—èŠ‚ç‚¹" class="headerlink" title="æ–°å¢—èŠ‚ç‚¹"></a>æ–°å¢—èŠ‚ç‚¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create [-s] [-e] path data #å…¶ä¸­-s ä¸ºæœ‰åºèŠ‚ç‚¹ï¼Œ-eä¸´æ—¶èŠ‚ç‚¹ã€‚ä¸å†™ -s/-e é»˜è®¤ä¸ºåˆ›å»ºæŒä¹…åŒ–èŠ‚ç‚¹</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹èŠ‚ç‚¹"><a href="#æŸ¥çœ‹èŠ‚ç‚¹" class="headerlink" title="æŸ¥çœ‹èŠ‚ç‚¹"></a>æŸ¥çœ‹èŠ‚ç‚¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get path</span><br></pre></td></tr></table></figure><p><img src="/images/zookeeper/zkInfo.png"></p><ul><li>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stat path  #è¿”å›ç»“æœå’Œgetå‘½ä»¤ç±»ä¼¼ï¼Œä½†ä¸ä¼šè¿”å›èŠ‚ç‚¹æ•°æ®å†…å®¹ã€‚</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä¿®æ”¹èŠ‚ç‚¹"><a href="#ä¿®æ”¹èŠ‚ç‚¹" class="headerlink" title="ä¿®æ”¹èŠ‚ç‚¹"></a>ä¿®æ”¹èŠ‚ç‚¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set path data [dataVersion]</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨setå‘½ä»¤ä¿®æ”¹èŠ‚ç‚¹æ•°æ®ã€‚ä¹Ÿå¯ä»¥åŸºäºç‰ˆæœ¬å·è¿›è¡Œä¿®æ”¹ï¼Œå½“ä¼ å…¥çš„dataVersionä¸å½“å‰ç‰ˆæœ¬å·ä¸ä¸€è‡´æ—¶ï¼Œzookeeperä¼šæ‹’ç»ä¿®æ”¹ã€‚</p><p><img src="/images/zookeeper/modify.png"></p><h3 id="è¿”å›èŠ‚ç‚¹åˆ—è¡¨"><a href="#è¿”å›èŠ‚ç‚¹åˆ—è¡¨" class="headerlink" title="è¿”å›èŠ‚ç‚¹åˆ—è¡¨"></a>è¿”å›èŠ‚ç‚¹åˆ—è¡¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls   path</span><br><span class="line">ls2  path</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤èŠ‚ç‚¹"><a href="#åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤èŠ‚ç‚¹"></a>åˆ é™¤èŠ‚ç‚¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete path [dataVersion]</span><br></pre></td></tr></table></figure><p>Â ä¸æ›´æ–°èŠ‚ç‚¹ç±»ä¼¼ï¼Œåˆ é™¤ä¹Ÿå¯ä»¥ä¼ å…¥ç‰ˆæœ¬å·ï¼Œå½“ä¼ å…¥çš„dataVersionä¸å½“å‰ç‰ˆæœ¬å·ä¸ä¸€è‡´æ—¶ï¼Œzookeeperä¼šæ‹’ç»åˆ é™¤ã€‚</p><ul><li>è¦æƒ³åˆ é™¤æŸä¸ªèŠ‚ç‚¹åŠå…¶åä»£èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨é€’å½’åˆ é™¤<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmr path</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> zookeeper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flink runtime framework</title>
      <link href="/2020/10/01/flink%20architecture/"/>
      <url>/2020/10/01/flink%20architecture/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿è¡Œæ—¶æ¡†æ¶"><a href="#è¿è¡Œæ—¶æ¡†æ¶" class="headerlink" title="è¿è¡Œæ—¶æ¡†æ¶"></a>è¿è¡Œæ—¶æ¡†æ¶</h1><p><img src="/images/flink/flink_runtime_architecture.png"></p><h1 id="ä½œä¸šè°ƒåº¦æ¡†æ¶"><a href="#ä½œä¸šè°ƒåº¦æ¡†æ¶" class="headerlink" title="ä½œä¸šè°ƒåº¦æ¡†æ¶"></a>ä½œä¸šè°ƒåº¦æ¡†æ¶</h1><p><img src="/images/flink/flink_schedule_architecture.png"></p><h1 id="tableæ¨¡å—æ¶æ„"><a href="#tableæ¨¡å—æ¶æ„" class="headerlink" title="tableæ¨¡å—æ¶æ„"></a>tableæ¨¡å—æ¶æ„</h1><p><img src="/images/flink/flink_table_architecture.png"></p><h1 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h1><h2 id="TaskExecutor"><a href="#TaskExecutor" class="headerlink" title="TaskExecutor"></a>TaskExecutor</h2><ol><li><code>taskmanager.numberOfTaskSlots</code>ï¼šæŒ‡å®šæ¯ä¸ªTaskExecutorçš„ä»»åŠ¡æ§½æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å±æ€§è®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºæ¯ä¸ªTaskExecutoråªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚å¦‚æœéœ€è¦åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œåˆ™éœ€è¦å°†è¯¥å±æ€§è®¾ç½®ä¸ºå¤§äº1çš„å€¼ã€‚</li><li><code>taskmanager.memory.process.size</code>ï¼šæŒ‡å®šTaskExecutorè¿›ç¨‹çš„å†…å­˜å¤§å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å±æ€§è®¾ç½®ä¸º1GBã€‚å¯ä»¥æ ¹æ®èŠ‚ç‚¹çš„èµ„æºæƒ…å†µå’Œä½œä¸šçš„å†…å­˜éœ€æ±‚è¿›è¡Œé€‚å½“è°ƒæ•´ã€‚</li><li><code>taskmanager.cpu.cores</code>ï¼šæŒ‡å®šTaskExecutorå¯ä»¥ä½¿ç”¨çš„CPUæ ¸å¿ƒæ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å±æ€§è®¾ç½®ä¸ºæ‰€æœ‰å¯ç”¨çš„CPUæ ¸å¿ƒæ•°ã€‚å¯ä»¥æ ¹æ®èŠ‚ç‚¹çš„CPUèµ„æºæƒ…å†µå’Œä½œä¸šçš„CPUéœ€æ±‚è¿›è¡Œé€‚å½“è°ƒæ•´ã€‚</li><li><code>taskmanager.tmp.dirs</code>ï¼šæŒ‡å®šTaskExecutorä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å±æ€§è®¾ç½®ä¸ºç³»ç»Ÿçš„ä¸´æ—¶ç›®å½•ã€‚å¯ä»¥æ ¹æ®èŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´æƒ…å†µå’Œä½œä¸šçš„ç£ç›˜éœ€æ±‚è¿›è¡Œé€‚å½“è°ƒæ•´ã€‚</li></ol><h1 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h1><ul><li>flink-annotations: Flinkè‡ªå®šä¹‰çš„ä¸€äº›æ³¨è§£ï¼Œç”¨äºé…ç½®ã€æ§åˆ¶ç¼–è¯‘ç­‰åŠŸèƒ½ã€‚</li><li>flink-clients: Flinkå®¢æˆ·ç«¯ï¼Œç”¨äºå‘Flinké›†ç¾¤æäº¤ä»»åŠ¡ã€æŸ¥è¯¢çŠ¶æ€ç­‰ã€‚å…¶ä¸­org.apache.flink.client.cli.CliFrontendå°±æ˜¯æ‰§è¡Œ./flink runçš„å…¥å£ã€‚</li><li>flink-connectors: Flinkè¿æ¥å™¨ï¼Œç›¸å½“äºFlinkè¯»å†™å¤–éƒ¨ç³»ç»Ÿçš„å®¢æˆ·ç«¯ã€‚è¿™äº›è¿æ¥å™¨æŒ‡å®šäº†å¤–éƒ¨å­˜å‚¨å¦‚ä½•ä½œä¸ºFlinkçš„sourceæˆ–sinkã€‚ä¾‹å¦‚å¯¹äºkafkaæ¥è¯´ï¼Œflink-connector-kafka-xxå®šä¹‰äº†FlinkKafkaConsumerå’ŒFlinkKafkaProducerç±»åˆ†åˆ«ä½œä¸ºFlinkçš„sourceå’Œsinkï¼Œå®ç°äº†å¯¹kafkaæ¶ˆè´¹å’Œç”Ÿäº§çš„åŠŸèƒ½ã€‚ä»å›¾äºŒå¯ä»¥çœ‹å‡ºï¼Œflink 1.9ç›®å‰æ”¯æŒçš„å¤–éƒ¨å­˜å‚¨æœ‰Cassandraã€ESã€Kafkaã€Hiveç­‰ä¸€äº›å¼€æºå¤–éƒ¨å­˜å‚¨ã€‚</li><li>flink-container: Flinkå¯¹dockerå’Œkubernetesçš„æ”¯æŒã€‚</li><li>flink-contrib: ç¤¾åŒºå¼€å‘è€…æä¾›çš„ä¸€äº›æ–°ç‰¹æ€§ã€‚</li><li>flink-core: Flinkæ ¸å¿ƒçš„APIã€ç±»å‹çš„å®šä¹‰ï¼ŒåŒ…æ‹¬åº•å±‚çš„ç®—å­ã€çŠ¶æ€ã€æ—¶é—´çš„å®ç°ï¼Œæ˜¯Flinkæœ€é‡è¦çš„éƒ¨åˆ†ã€‚Flinkå†…éƒ¨çš„å„ç§å‚æ•°é…ç½®ä¹Ÿéƒ½å®šä¹‰åœ¨è¿™ä¸ªæ¨¡å—çš„configurationä¸­ã€‚ï¼ˆè¿™éƒ¨åˆ†ä»£ç è¿˜æ²¡æ€ä¹ˆçœ‹è¿‡ï¼Œå°±ä¸ç»†è®²äº†ï¼‰ã€‚</li><li>flink-dist: Flinkç¼–è¯‘å¥½ä¹‹åçš„jaråŒ…ä¼šæ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œä¹Ÿå°±æ˜¯ç½‘ä¸Šä¸‹è½½çš„å¯æ‰§è¡Œçš„ç‰ˆæœ¬ã€‚å…¶ä¸­ä¹ŸåŒ…æ‹¬é›†ç¾¤å¯åŠ¨ã€ç»ˆæ­¢çš„è„šæœ¬ï¼Œé›†ç¾¤çš„é…ç½®æ–‡ä»¶ç­‰ã€‚</li><li>flink-docs: è¿™ä¸ªæ¨¡å—å¹¶ä¸æ˜¯Flinkçš„æ–‡æ¡£ï¼Œè€Œæ˜¯Flinkæ–‡æ¡£ç”Ÿæˆçš„ä»£ç ã€‚å…¶ä¸­org.apache.flink.docs.configuration.ConfigOptionsDocGeneratoræ˜¯é…ç½®æ–‡æ¡£çš„ç”Ÿæˆå™¨ï¼Œä¿®æ”¹ç›¸å…³é…ç½®çš„keyæˆ–è€…é»˜è®¤å€¼ï¼Œé‡æ–°è¿è¡Œè¿™ä¸ªç±»å°±ä¼šæ›´æ–°docæ–‡ä»¶å¤¹ä¸‹çš„htmlæ–‡ä»¶ã€‚åŒæ ·org.apache.flink.docs.rest.RestAPIDocGeneratoræ˜¯Flink RestAPIæ–‡æ¡£çš„ç”Ÿæˆå™¨ã€‚</li><li>flink-fliesystems: Flinkå¯¹å„ç§æ–‡ä»¶ç³»ç»Ÿçš„æ”¯æŒï¼ŒåŒ…æ‹¬HDFSã€Azureã€AWS S3ã€é˜¿é‡Œäº‘OSSç­‰åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚</li><li>flink-formats: Flinkå¯¹å„ç§æ ¼å¼çš„æ•°æ®è¾“å…¥è¾“å‡ºçš„æ”¯æŒã€‚åŒ…æ‹¬Jsonã€CSVã€Avroç­‰å¸¸ç”¨çš„æ ¼å¼ã€‚</li><li>flink-java: Flink javaçš„APIï¼Œå°±æ˜¯å†™flinkåº”ç”¨æ—¶ç”¨åˆ°çš„mapã€windowã€keyByã€Stateç­‰ç±»æˆ–å‡½æ•°çš„å®ç°ã€‚</li><li>flink-jepsen: å¯¹Flinkåˆ†å¸ƒå¼ç³»ç»Ÿæ­£ç¡®æ€§çš„æµ‹è¯•ï¼Œä¸»è¦éªŒè¯Flinkçš„å®¹é”™æœºåˆ¶ã€‚</li><li>flink-libraries: Flinkçš„é«˜çº§APIï¼ŒåŒ…æ‹¬CEPï¼ˆå¤æ‚äº‹ä»¶å¤„ç†ï¼‰ã€Gellyå›¾å¤„ç†åº“ç­‰ã€‚</li><li>flink-mesos: Flinkå¯¹mesosé›†ç¾¤ç®¡ç†çš„æ”¯æŒã€‚</li><li>flink-metrics: Flinkç›‘æ§ä¸ŠæŠ¥ã€‚æ”¯æŒä¸ŠæŠ¥åˆ°influxdbã€prometheusç­‰ç›‘æ§ç³»ç»Ÿã€‚å…·ä½“çš„ä½¿ç”¨é…ç½®å¯ä»¥åœ¨flink-coreæ¨¡å—çš„org.apache.flink.configuration.MetricOptionsä¸­æ‰¾åˆ°ã€‚</li><li>flink-python: Flinkå¯¹pythonçš„æ”¯æŒï¼Œç›®å‰è¿˜æ¯”è¾ƒå¼±ã€‚</li><li>flink-queryable-state: Flinkå¯¹å¯æŸ¥è¯¢çŠ¶æ€çš„æ”¯æŒï¼Œå…¶ä¸­flink-queryable-state-runtimeå­æ¨¡å—å®ç°äº†StateClientProxyå’ŒStateServerã€‚è¿™ä¸¤éƒ¨åˆ†éƒ½è¿è¡Œåœ¨TaskManagerä¸Šï¼ŒStateClientProxyè´Ÿè´£æ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼ŒStateServeè´Ÿè´£ç®¡ç†å†…éƒ¨çš„queryable stateã€‚flink-queryable-state-client-javaå­æ¨¡å—å®ç°äº†QueryableStateClientï¼Œä½œä¸ºå¤–éƒ¨ç³»ç»Ÿè®¿é—®queryable stateçš„å®¢æˆ·ç«¯ã€‚</li><li>flink-runtime: flinkè¿è¡Œæ—¶æ ¸å¿ƒä»£ç ï¼Œåœ¨ç¬¬äºŒèŠ‚ç»†è¯´ã€‚</li><li>flink-runtime-web: Flink Web Dashboardçš„å®ç°ã€‚é»˜è®¤å¯åŠ¨standaloneé›†ç¾¤åï¼Œè®¿é—®<a href="http://localhost:8081/">http://localhost:8081</a> å‡ºç°çš„ç•Œé¢ã€‚</li><li>flink-scala: Flink scalaçš„APIã€‚</li><li>flink-scala-shell: Flinkæä¾›çš„scalaå‘½ä»¤è¡Œäº¤äº’æ¥å£ã€‚</li><li>flink-state-backends: flinkçŠ¶æ€å­˜å‚¨çš„æ–¹å¼ï¼Œç›®å‰è¿™ä¸ªæ¨¡å—ä¸­åªæœ‰RocksDBStateBackendï¼Œæœªæ¥å¯èƒ½ä¼šæ”¯æŒæ›´å¤šç§çš„çŠ¶æ€å­˜å‚¨ï¼Œä»¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚MemoryStateBackendå’ŒFsStateBackendçš„å®ç°å¹¶ä¸åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œè€Œæ˜¯åœ¨flink-runtimeç›®å½•ä¸‹ã€‚</li><li>flink-streaming-java: Flink Streamingçš„java APIã€‚</li><li>flink-streaming-scala: Flink Streamingçš„scala APIã€‚</li><li>flink-table: Flink Table APIï¼Œåœ¨ç¬¬ä¸‰å°èŠ‚ä¸­ç»†è¯´ã€‚</li><li>flink-yarn: Flinkå¯¹yarné›†ç¾¤ç®¡ç†çš„æ”¯æŒã€‚</li></ul><hr><ul><li><p>flink-runtimeæ¨¡å—æ˜¯Flinkæœ€æ ¸å¿ƒçš„æ¨¡å—ä¹‹ä¸€ï¼Œå®ç°äº†Flinkçš„è¿è¡Œæ—¶æ¡†æ¶ï¼Œå¦‚JobManagerã€TaskManagerã€ResourceManagerã€Schedulerã€Checkpoint Coordinator</p></li><li><p>flink-tableæ¨¡å—å±äºFlinkçš„ä¸Šå±‚APIï¼ŒåŒ…æ‹¬javaå’Œscalaç‰ˆæœ¬çš„table-apiï¼Œä»¥åŠSQLçš„è§£æå’ŒSQLçš„æ‰§è¡Œã€‚</p><blockquote><p>éšç€Flink SQLè¶Šæ¥è¶Šå—é‡è§†ï¼Œflink-tableä»flink-librariesä¸­ç§»äº†å‡ºæ¥ï¼Œæˆä¸ºäº†ç‹¬ç«‹çš„ä¸€çº§ç›®å½•ã€‚Flink 1.9ä¸­ï¼Œé˜¿é‡ŒæŠŠblink-plannerå¼€æºäº†å‡ºæ¥ï¼Œè¿™æ ·æ•´ä¸ªflink-tableä¸­å°±æœ‰äº†2ä¸ªplannerã€‚ä»é•¿æœŸæ¥çœ‹ï¼Œæµæ‰¹çš„ç»Ÿä¸€æ˜¯ä¸€ä¸ªè¶‹åŠ¿ï¼Œå› æ­¤blink-planneråªä½¿ç”¨äº†StreamTableEnvironmentä¸­ç›¸å…³çš„APIï¼Œè€Œæ²¡æœ‰ä½¿ç”¨BatchTableEnvironmentï¼Œå°†æ‰¹å½“åšä¸€ä¸ªæœ‰é™çš„æµæ¥å¤„ç†ï¼Œå¸Œæœ›é€šè¿‡è¿™ç§æ–¹å¼å®ç°æµå’Œæ‰¹çš„ç»Ÿä¸€ã€‚ç”±äºblink-table-planneræ›´å¥½çš„æ”¯æŒæµæ‰¹ç»Ÿä¸€ï¼Œä¸”æ€§èƒ½æ›´å¥½ï¼Œåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½å®Œå…¨æ›¿ä»£flink-table-plannerçš„åŠŸèƒ½ï¼Œè€Œflink-table-plannerå¯èƒ½å°†ä¼šè¢«ç§»é™¤ã€‚</p></blockquote></li></ul><h1 id="checkpoint"><a href="#checkpoint" class="headerlink" title="checkpoint"></a>checkpoint</h1><blockquote><p>åŸºäº Chandy-Lamport ç®—æ³•å®ç°äº†ä¸€ä¸ªåˆ†å¸ƒå¼çš„ä¸€è‡´æ€§çš„å¿«ç…§ï¼Œä»è€Œæä¾›äº†ä¸€è‡´æ€§çš„è¯­ä¹‰ã€‚</p><p>Chandy-Lamport ç®—æ³•å®é™…ä¸Šåœ¨ 1985 å¹´çš„æ—¶å€™å·²ç»è¢«æå‡ºæ¥ï¼Œä½†å¹¶æ²¡æœ‰è¢«å¾ˆå¹¿æ³›çš„åº”ç”¨ï¼Œè€Œ Flink åˆ™æŠŠè¿™ä¸ªç®—æ³•å‘æ‰¬å…‰å¤§äº†ã€‚</p></blockquote><p>checkpointæ˜¯ä½¿Flink èƒ½ä»æ•…éšœæ¢å¤çš„ä¸€ç§å†…éƒ¨æœºåˆ¶ã€‚æ£€æŸ¥ç‚¹æ˜¯ Flink åº”ç”¨çŠ¶æ€çš„ä¸€ä¸ªä¸€è‡´æ€§å‰¯æœ¬ï¼ŒåŒ…æ‹¬äº†è¾“å…¥çš„è¯»å–ä½ç‚¹ã€‚åœ¨å‘ç”Ÿæ•…éšœæ—¶ï¼ŒFlink é€šè¿‡ä»æ£€æŸ¥ç‚¹åŠ è½½åº”ç”¨ç¨‹åºçŠ¶æ€æ¥æ¢å¤ï¼Œå¹¶ä»æ¢å¤çš„è¯»å–ä½ç‚¹ç»§ç»­å¤„ç†ï¼Œå°±å¥½åƒä»€ä¹ˆäº‹æƒ…éƒ½æ²¡å‘ç”Ÿä¸€æ ·ã€‚Flinkçš„çŠ¶æ€å­˜å‚¨åœ¨Flinkçš„å†…éƒ¨,è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ä¸å†ä¾èµ–å¤–éƒ¨ç³»ç»Ÿ,é™ä½äº†å¯¹å¤–éƒ¨ç³»ç»Ÿçš„ä¾èµ–,åœ¨Flinkçš„å†…éƒ¨,é€šè¿‡è‡ªèº«çš„è¿›ç¨‹å»è®¿é—®çŠ¶æ€å˜é‡.åŒæ—¶ä¼šå®šæœŸçš„åšcheckpointæŒä¹…åŒ–,æŠŠcheckpointå­˜å‚¨åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼çš„æŒä¹…åŒ–ç³»ç»Ÿä¸­,å¦‚æœå‘ç”Ÿæ•…éšœ,å°±ä¼šä»æœ€è¿‘çš„ä¸€æ¬¡checkpointä¸­å°†æ•´ä¸ªæµçš„çŠ¶æ€è¿›è¡Œæ¢å¤.</p><h1 id="state"><a href="#state" class="headerlink" title="state"></a>state</h1><blockquote><p>ä¸°å¯Œçš„State APIï¼šValueStateã€ListStateã€MapStateã€ BroadcastState</p></blockquote><ul><li>what ?</li></ul><p>Stateæ˜¯æŒ‡æµè®¡ç®—è¿‡ç¨‹ä¸­è®¡ç®—èŠ‚ç‚¹çš„ä¸­é—´è®¡ç®—ç»“æœæˆ–å…ƒæ•°æ®å±æ€§ï¼Œæ¯”å¦‚ åœ¨aggregationè¿‡ç¨‹ä¸­è¦åœ¨stateä¸­è®°å½•ä¸­é—´èšåˆç»“æœï¼Œæ¯”å¦‚ Apache Kafka ä½œä¸ºæ•°æ®æºæ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿè¦è®°å½•å·²ç»è¯»å–è®°å½•çš„offsetï¼Œè¿™äº›Stateæ•°æ®åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¼šè¿›è¡ŒæŒä¹…åŒ–(æ’å…¥æˆ–æ›´æ–°)ã€‚æ‰€ä»¥Apache Flinkä¸­çš„Stateå°±æ˜¯ä¸æ—¶é—´ç›¸å…³çš„ï¼ŒApache Flinkä»»åŠ¡çš„å†…éƒ¨æ•°æ®ï¼ˆè®¡ç®—æ•°æ®å’Œå…ƒæ•°æ®å±æ€§ï¼‰çš„å¿«ç…§ã€‚</p><ul><li>why ?</li></ul><p>ä¸æ‰¹è®¡ç®—ç›¸æ¯”ï¼ŒStateæ˜¯æµè®¡ç®—ç‰¹æœ‰çš„ï¼Œæ‰¹è®¡ç®—æ²¡æœ‰failoveræœºåˆ¶ï¼Œè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆé‡æ–°è®¡ç®—ã€‚æµè®¡ç®—åœ¨ å¤§å¤šæ•°åœºæ™¯ ä¸‹æ˜¯å¢é‡è®¡ç®—ï¼Œæ•°æ®é€æ¡å¤„ç†ï¼ˆå¤§å¤šæ•°åœºæ™¯)ï¼Œæ¯æ¬¡è®¡ç®—æ˜¯åœ¨ä¸Šä¸€æ¬¡è®¡ç®—ç»“æœä¹‹ä¸Šè¿›è¡Œå¤„ç†çš„ï¼Œè¿™æ ·çš„æœºåˆ¶åŠ¿å¿…è¦å°†ä¸Šä¸€æ¬¡çš„è®¡ç®—ç»“æœè¿›è¡Œå­˜å‚¨ï¼ˆç”Ÿäº§æ¨¡å¼è¦æŒä¹…åŒ–ï¼‰ï¼Œå¦å¤–ç”±äº æœºå™¨ï¼Œç½‘ç»œï¼Œè„æ•°æ®ç­‰åŸå› å¯¼è‡´çš„ç¨‹åºé”™è¯¯ï¼Œåœ¨é‡å¯jobæ—¶å€™éœ€è¦ä»æˆåŠŸçš„æ£€æŸ¥ç‚¹(checkpointï¼Œåé¢ç¯‡ç« ä¼šä¸“é—¨ä»‹ç»)è¿›è¡Œstateçš„æ¢å¤ã€‚å¢é‡è®¡ç®—ï¼ŒFailoverè¿™äº›æœºåˆ¶éƒ½éœ€è¦stateçš„æ”¯æ’‘ã€‚</p><ul><li>how ?</li></ul><h2 id="å­˜å‚¨å®ç°"><a href="#å­˜å‚¨å®ç°" class="headerlink" title="å­˜å‚¨å®ç°"></a>å­˜å‚¨å®ç°</h2><ul><li><p>åŸºäºå†…å­˜çš„HeapStateBackend - åœ¨debugæ¨¡å¼ä½¿ç”¨ï¼Œä¸ å»ºè®®åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹åº”ç”¨ï¼›</p></li><li><p>åŸºäºHDFSçš„FsStateBackend - åˆ†å¸ƒå¼æ–‡ä»¶æŒä¹…åŒ–ï¼Œæ¯æ¬¡è¯»å†™éƒ½äº§ç”Ÿç½‘ç»œIOï¼Œæ•´ä½“æ€§èƒ½ä¸ä½³ï¼›</p></li><li><p>åŸºäºRocksDBçš„RocksDBStateBackend - æœ¬åœ°æ–‡ä»¶+å¼‚æ­¥HDFSæŒä¹…åŒ–ï¼›</p><blockquote><p>Apache Flinkç‰ˆæœ¬é€‰æ‹©ç”¨RocksDB+HDFSçš„æ–¹å¼è¿›è¡ŒStateçš„å­˜å‚¨ï¼ŒStateå­˜å‚¨åˆ†ä¸¤ä¸ªé˜¶æ®µï¼Œé¦–å…ˆæœ¬åœ°å­˜å‚¨åˆ°RocksDBï¼Œç„¶åå¼‚æ­¥çš„åŒæ­¥åˆ°è¿œç¨‹çš„HDFSã€‚ è¿™æ ·è€Œè®¾è®¡æ—¢æ¶ˆé™¤äº†HeapStateBackendçš„å±€é™ï¼ˆå†…å­˜å¤§å°ï¼Œæœºå™¨åæ‰ä¸¢å¤±ç­‰ï¼‰ï¼Œä¹Ÿå‡å°‘äº†çº¯åˆ†å¸ƒå¼å­˜å‚¨çš„ç½‘ç»œIOå¼€é”€ã€‚</p></blockquote></li><li><p>è¿˜æœ‰ä¸€ä¸ªæ˜¯åŸºäºNiagara(Alibabaå†…éƒ¨å®ç°)NiagaraStateBackend - åˆ†å¸ƒå¼æŒä¹…åŒ–- åœ¨Alibabaç”Ÿäº§ç¯å¢ƒåº”ç”¨ï¼›</p></li></ul><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>é€šè¿‡ç®—å­å’Œæ•°æ®å±‚é¢åˆ’åˆ†</p><ul><li><p>ç®—å­ç±»state</p><p>KeyedState - è¿™é‡Œé¢çš„keyæ˜¯æˆ‘ä»¬åœ¨SQLè¯­å¥ä¸­å¯¹åº”çš„GroupBy/PartitioneByé‡Œé¢çš„å­—æ®µï¼Œkeyçš„å€¼å°±æ˜¯groupby/PartitionByå­—æ®µç»„æˆçš„Rowçš„å­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸€ä¸ªkeyéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„Stateï¼Œkeyä¸keyä¹‹é—´çš„Stateæ˜¯ä¸å¯è§çš„</p></li><li><p>æ•°æ®ç±»state</p><p>OperatorState - Apache Flinkå†…éƒ¨çš„Source Connectorçš„å®ç°ä¸­å°±ä¼šç”¨OperatorStateæ¥è®°å½•sourceæ•°æ®è¯»å–çš„offsetã€‚</p></li></ul><h2 id="MemoryStateBackend"><a href="#MemoryStateBackend" class="headerlink" title="MemoryStateBackend"></a>MemoryStateBackend</h2><p>1 åŸºäºå†…å­˜çš„çŠ¶æ€ç®¡ç†å™¨ï¼Œèšåˆç±»ç®—å­çš„çŠ¶æ€ä¼šå­˜å‚¨åœ¨JobManagerçš„å†…å­˜ä¸­</p><p>2 å•æ¬¡çŠ¶æ€å¤§å°é»˜è®¤æœ€å¤§è¢«é™åˆ¶ä¸º5MBï¼Œå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æ¥æŒ‡å®šçŠ¶æ€åˆå§‹åŒ–å†…å­˜å¤§å°ã€‚æ— è®ºå•æ¬¡çŠ¶æ€å¤§å°æœ€å¤§è¢«é™åˆ¶ä¸ºå¤šå°‘ï¼Œéƒ½ä¸å¯å¤§äºakkaçš„frameå¤§å°ï¼ˆ1.5MBï¼ŒJobManagerå’ŒTaskManagerä¹‹é—´ä¼ è¾“æ•°æ®çš„æœ€å¤§æ¶ˆæ¯å®¹é‡ï¼‰ã€‚çŠ¶æ€çš„æ€»å¤§å°ä¸èƒ½è¶…è¿‡ JobManager çš„å†…å­˜ã€‚</p><p>3 æ˜¯Flinké»˜è®¤çš„åç«¯çŠ¶æ€ç®¡ç†å™¨ï¼Œé»˜è®¤æ˜¯å¼‚æ­¥çš„</p><p>4 ä¸»æœºå†…å­˜ä¸­çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼Œä»»åŠ¡å¯èƒ½æ— æ³•æ¢å¤</p><p>5 å°†å·¥ä½œstateä¿å­˜åœ¨TaskManagerçš„å†…å­˜ä¸­ï¼Œå¹¶å°†checkpointæ•°æ®å­˜å‚¨åœ¨JobManagerçš„å†…å­˜ä¸­</p><p>é€‚ç”¨ï¼šæœ¬åœ°å¼€å‘å’Œè°ƒè¯•ã€çŠ¶æ€æ¯”è¾ƒå°‘çš„ä½œä¸š</p><h2 id="FsStateBackend"><a href="#FsStateBackend" class="headerlink" title="FsStateBackend"></a>FsStateBackend</h2><p>1 åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€ç®¡ç†å™¨ï¼ˆè¿™é‡Œçš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥æ˜¯æœ¬åœ°<strong>å…±äº«</strong>æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥æ˜¯hdfsåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚ï¼‰</p><p>2 å¦‚æœä½¿ç”¨ï¼Œé»˜è®¤æ˜¯å¼‚æ­¥</p><p>3 æ¯”è¾ƒç¨³å®šï¼Œ3ä¸ªå‰¯æœ¬ï¼Œæ¯”è¾ƒå®‰å…¨ã€‚ä¸ä¼šå‡ºç°ä»»åŠ¡æ— æ³•æ¢å¤ç­‰é—®é¢˜</p><p>4 çŠ¶æ€å¤§å°å—ç£ç›˜å®¹é‡é™åˆ¶</p><p>5 å°†å·¥ä½œstateä¿å­˜åœ¨TaskManagerçš„å†…å­˜ä¸­ï¼Œå¹¶å°†checkpointæ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­</p><p>é€‚ç”¨ï¼šçŠ¶æ€æ¯”è¾ƒå¤§ï¼Œçª—å£æ¯”è¾ƒé•¿ï¼Œå¤§çš„KVçŠ¶æ€</p><h2 id="RocksDBStateBackend"><a href="#RocksDBStateBackend" class="headerlink" title="RocksDBStateBackend"></a>RocksDBStateBackend</h2><ol><li><p>RocksDBStateBackend é‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼è¿›è¡ŒçŠ¶æ€æ•°æ®çš„ Snapshotï¼Œ ä»»åŠ¡ä¸­çš„çŠ¶æ€æ•°æ®é¦–å…ˆè¢«å†™äºº RocksDB ä¸­ï¼Œç„¶åå†å¼‚æ­¥åœ°å°†çŠ¶æ€æ•°æ®å†™äººæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè¿™æ ·åœ¨rocksDBä¸­ä»…ä¼šå­˜å‚¨æ­£åœ¨è¿›è¡Œè®¡ç®—çš„çƒ­æ•°æ®ï¼Œå¯¹äºé•¿æ—¶é—´æ‰æ›´æ–°çš„æ•°æ®åˆ™å†™äººç£ç›˜ä¸­è¿›è¡Œå­˜å‚¨ã€‚è€Œå¯¹äºä½“é‡æ¯”è¾ƒå°çš„å…ƒæ•°æ®çŠ¶æ€ï¼Œåˆ™ç›´æ¥å­˜å‚¨åœ¨ JobManager çš„å†…å­˜ä¸­ã€‚</p></li><li><p>ä¸ FsStateBackend ç›¸æ¯”ï¼ŒRocksDBState Backend åœ¨æ€§èƒ½ä¸Šè¦æ¯” FsStateBackend é«˜ä¸€äº›ï¼Œä¸»è¦æ˜¯å› ä¸ºå€ŸåŠ©äº RocksDB å­˜å‚¨äº†æœ€æ–°çƒ­æ•°æ®ï¼Œç„¶åé€šè¿‡å¼‚æ­¥çš„æ–¹å¼å†åŒæ­¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä½† RocksDBState Backend å’Œ Memory State Backend ç›¸æ¯”æ€§èƒ½å°±ä¼šè¾ƒå¼±ä¸€äº›ã€‚</p></li><li><p>éœ€è¦æ³¨æ„çš„æ˜¯ROCksDBé€šè¿‡JNIçš„æ–¹å¼è¿›è¡Œæ•°æ®çš„äº¤äº’ï¼Œè€ŒJNIæ„å»ºåœ¨byte[]æ•°æ®ç»“æ„ä¹‹ä¸Šï¼Œå› æ­¤æ¯æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®é‡ä¸º2^31å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡åœ¨RocksDBState Backend åˆå¹¶çš„çŠ¶æ€æ•°æ®é‡å¤§å°ä¸èƒ½è¶…è¿‡ 2^31 å­—èŠ‚é™åˆ¶ï¼Œå¦åˆ™å°†ä¼šå¯¼è‡´çŠ¶æ€æ•°æ®æ— æ³•åŒæ­¥ï¼Œè¿™æ˜¯RocksDB é‡‡ç”¨JNI æ–¹å¼çš„é™åˆ¶ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åº”å½“æ³¨æ„ã€‚</p></li></ol><p>ç»¼ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒRocksDBState Backend å’Œ FsState Backend ä¸€æ ·ï¼Œé€‚åˆäºä»»åŠ¡çŠ¶æ€æ•°æ®éå¸¸å¤§çš„åœºæ™¯ã€‚åœ¨Flink æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œå·²ç»æä¾›äº†åŸºäº RocksDBState Backend å®ç°çš„å¢é‡ Checkpoints åŠŸèƒ½ï¼Œæå¤§åœ°æé«˜äº†çŠ¶æ€æ•°æ®åŒæ­¥åˆ°ä»‹è´¨ä¸­çš„æ•ˆç‡å’Œæ€§èƒ½ï¼Œåœ¨åç»­çš„ç¤¾åŒºå‘å±•ä¸­ï¼ŒRocksDBStateBackend ä¹Ÿä¼šä½œä¸ºçŠ¶æ€ç®¡ç†å™¨é‡ç‚¹ä½¿ç”¨çš„æ–¹å¼ä¹‹ä¸€ã€‚</p><h1 id="time"><a href="#time" class="headerlink" title="time"></a>time</h1><blockquote><p>å®ç°äº† Watermark çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿæ”¯æŒåŸºäºäº‹ä»¶çš„æ—¶é—´çš„å¤„ç†ï¼Œæˆ–è€…è¯´åŸºäºç³»ç»Ÿæ—¶é—´çš„å¤„ç†ï¼Œèƒ½å¤Ÿå®¹å¿æ•°æ®çš„å»¶æ—¶ã€å®¹å¿æ•°æ®çš„è¿Ÿåˆ°ã€å®¹å¿ä¹±åºçš„æ•°æ®ã€‚</p></blockquote><p><img src="/images/flink/flink_time.png"></p><ul><li><p>Event Timeï¼šæ˜¯äº‹ä»¶åˆ›å»ºçš„æ—¶é—´ã€‚å®ƒé€šå¸¸ç”±äº‹ä»¶ä¸­çš„æ—¶é—´æˆ³æè¿°ï¼Œä¾‹å¦‚é‡‡é›†çš„æ—¥å¿—æ•°æ®ä¸­ï¼Œæ¯ä¸€æ¡æ—¥å¿—éƒ½ä¼šè®°å½•è‡ªå·±çš„ç”Ÿæˆæ—¶é—´ï¼ŒFlink é€šè¿‡æ—¶é—´æˆ³åˆ†é…å™¨è®¿é—®äº‹ä»¶æ—¶é—´æˆ³ã€‚</p></li><li><p>Ingestion Timeï¼šæ˜¯æ•°æ®è¿›å…¥ Flink çš„æ—¶é—´ã€‚</p></li><li><p>Processing Timeï¼šæ˜¯æ¯ä¸€ä¸ªæ‰§è¡ŒåŸºäºæ—¶é—´æ“ä½œçš„ç®—å­çš„æœ¬åœ°ç³»ç»Ÿæ—¶é—´ï¼Œä¸æœºå™¨ç›¸å…³ï¼Œé»˜è®¤çš„æ—¶é—´å±æ€§å°±æ˜¯ Processing Timeã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œä¸€æ¡æ—¥å¿—è¿›å…¥ Flink çš„æ—¶é—´ä¸º 2019-08-12 10:00:00.123ï¼Œåˆ°è¾¾ Window çš„ç³»ç»Ÿæ—¶é—´ä¸º 2019-08-12 10:00:01.234ï¼Œæ—¥å¿—çš„å†…å®¹å¦‚ä¸‹ï¼š</p><p>2019-08-02 18:37:15.624 INFO Fail over to rm2</p><p>å¯¹äºä¸šåŠ¡æ¥è¯´ï¼Œè¦ç»Ÿè®¡ 1min å†…çš„æ•…éšœæ—¥å¿—ä¸ªæ•°ï¼Œå“ªä¸ªæ—¶é—´æ˜¯æœ€æœ‰æ„ä¹‰çš„ï¼Ÿâ€”â€” eventTimeï¼Œå› ä¸ºæˆ‘ä»¬è¦æ ¹æ®æ—¥å¿—çš„ç”Ÿæˆæ—¶é—´è¿›è¡Œç»Ÿè®¡ã€‚</p></blockquote></li></ul><h1 id="window"><a href="#window" class="headerlink" title="window"></a>window</h1><blockquote><p>Flink æä¾›äº†å¼€ç®±å³ç”¨çš„å„ç§çª—å£ï¼Œæ¯”å¦‚æ»‘åŠ¨çª—å£ã€æ»šåŠ¨çª—å£ã€ä¼šè¯çª—å£ä»¥åŠéå¸¸çµæ´»çš„è‡ªå®šä¹‰çš„çª—å£ã€‚</p></blockquote><p><img src="/images/flink/flink_window.png"></p><ul><li><p>æ»šåŠ¨çª—å£ï¼ˆTumbling Windowï¼‰</p><p>å°†æ•°æ®ä¾æ®å›ºå®šçš„çª—å£é•¿åº¦å¯¹æ•°æ®è¿›è¡Œåˆ‡ç‰‡, æ»šåŠ¨çª—å£åˆ†é…å™¨å°†æ¯ä¸ªå…ƒç´ åˆ†é…åˆ°ä¸€ä¸ªæŒ‡å®šçª—å£å¤§å°çš„çª—å£ä¸­ï¼Œæ»šåŠ¨çª—å£æœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°é‡å </p><p>ç‰¹ç‚¹ï¼š<strong>æ—¶é—´å¯¹é½ï¼Œçª—å£é•¿åº¦å›ºå®šï¼Œæ²¡æœ‰é‡å </strong></p><p>é€‚ç”¨åœºæ™¯ï¼šé€‚åˆåš BI ç»Ÿè®¡ç­‰ï¼ˆåšæ¯ä¸ªæ—¶é—´æ®µçš„èšåˆè®¡ç®—ï¼‰</p><p>ä¾‹å¦‚ï¼šå¦‚æœä½ æŒ‡å®šäº†ä¸€ä¸ª 5 åˆ†é’Ÿå¤§å°çš„æ»šåŠ¨çª—å£ï¼Œçª—å£çš„åˆ›å»ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/flink/flink_window_tumbling.png"></p></li><li><p>æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰</p><p>æ»‘åŠ¨çª—å£æ˜¯å›ºå®šçª—å£çš„æ›´å¹¿ä¹‰çš„ä¸€ç§å½¢å¼ï¼Œæ»‘åŠ¨çª—å£ç”±å›ºå®šçš„çª—å£é•¿åº¦å’Œæ»‘åŠ¨é—´éš”ç»„æˆã€‚</p><p>ç‰¹ç‚¹ï¼š<strong>æ—¶é—´å¯¹é½ï¼Œçª—å£é•¿åº¦å›ºå®šï¼Œæœ‰é‡å </strong></p><p>æ»‘åŠ¨çª—å£åˆ†é…å™¨å°†å…ƒç´ åˆ†é…åˆ°å›ºå®šé•¿åº¦çš„çª—å£ä¸­ï¼Œä¸æ»šåŠ¨çª—å£ç±»ä¼¼ï¼Œçª—å£çš„å¤§å°ç”±çª—å£å¤§å°å‚æ•°æ¥é…ç½®ï¼Œå¦ä¸€ä¸ªçª—å£æ»‘åŠ¨å‚æ•°æ§åˆ¶æ»‘åŠ¨çª—å£å¼€å§‹çš„é¢‘ç‡ã€‚å› æ­¤ï¼Œæ»‘åŠ¨çª—å£å¦‚æœæ»‘åŠ¨å‚æ•°å°äºçª—å£å¤§å°çš„è¯ï¼Œçª—å£æ˜¯å¯ä»¥é‡å çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å…ƒç´ ä¼šè¢«åˆ†é…åˆ°å¤šä¸ªçª—å£ä¸­ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå¯¹æœ€è¿‘ä¸€ä¸ªæ—¶é—´æ®µå†…çš„ç»Ÿè®¡ï¼ˆæ±‚æŸæ¥å£æœ€è¿‘ 5min çš„å¤±è´¥ç‡æ¥å†³å®šæ˜¯å¦è¦æŠ¥è­¦ï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼Œä½ æœ‰ 10 åˆ†é’Ÿçš„çª—å£å’Œ 5 åˆ†é’Ÿçš„æ»‘åŠ¨ï¼Œé‚£ä¹ˆæ¯ä¸ªçª—å£ä¸­ 5 åˆ†é’Ÿçš„çª—å£é‡ŒåŒ…å«ç€ä¸Šä¸ª 10 åˆ†é’Ÿäº§ç”Ÿçš„æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/flink/flink_window_sliding.png"></p></li><li><p>ä¼šè¯çª—å£ï¼ˆSession Windowï¼‰</p><p>ç”±ä¸€ç³»åˆ—äº‹ä»¶ç»„åˆä¸€ä¸ªæŒ‡å®šæ—¶é—´é•¿åº¦çš„ timeout é—´éš™ç»„æˆï¼Œç±»ä¼¼äº web åº”ç”¨çš„ sessionï¼Œä¹Ÿå°±æ˜¯ä¸€æ®µæ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ°æ–°æ•°æ®å°±ä¼šç”Ÿæˆæ–°çš„çª—å£ã€‚</p><p>ç‰¹ç‚¹ï¼š<strong>æ—¶é—´æ— å¯¹é½</strong></p><p>session çª—å£åˆ†é…å™¨é€šè¿‡ session æ´»åŠ¨æ¥å¯¹å…ƒç´ è¿›è¡Œåˆ†ç»„ï¼Œsession çª—å£è·Ÿæ»šåŠ¨çª—å£å’Œæ»‘åŠ¨çª—å£ç›¸æ¯”ï¼Œä¸ä¼šæœ‰é‡å å’Œå›ºå®šçš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´çš„æƒ…å†µï¼Œç›¸åï¼Œå½“å®ƒåœ¨ä¸€ä¸ªå›ºå®šçš„æ—¶é—´å‘¨æœŸå†…ä¸å†æ”¶åˆ°å…ƒç´ ï¼Œå³éæ´»åŠ¨é—´éš”äº§ç”Ÿï¼Œé‚£ä¸ªè¿™ä¸ªçª—å£å°±ä¼šå…³é—­ã€‚ä¸€ä¸ª session çª—å£é€šè¿‡ä¸€ä¸ª session é—´éš”æ¥é…ç½®ï¼Œè¿™ä¸ª session é—´éš”å®šä¹‰äº†éæ´»è·ƒå‘¨æœŸçš„é•¿åº¦ï¼Œå½“è¿™ä¸ªéæ´»è·ƒå‘¨æœŸäº§ç”Ÿï¼Œé‚£ä¹ˆå½“å‰çš„ session å°†å…³é—­å¹¶ä¸”åç»­çš„å…ƒç´ å°†è¢«åˆ†é…åˆ°æ–°çš„ session çª—å£ä¸­å»ã€‚</p></li></ul><p>â€‹        <img src="/images/flink/flink_window_session.png"></p><hr><p>flink API</p><p><img src="/images/flink/flink_runtime.png"></p><blockquote><p>Flink åˆ†åˆ«æä¾›äº†é¢å‘æµå¼å¤„ç†çš„æ¥å£ï¼ˆDataStream APIï¼‰å’Œé¢å‘æ‰¹å¤„ç†çš„æ¥å£ï¼ˆDataSet APIï¼‰ã€‚å› æ­¤ï¼ŒFlink æ—¢å¯ä»¥å®Œæˆæµå¤„ç†ï¼Œä¹Ÿå¯ä»¥å®Œæˆæ‰¹å¤„ç†ã€‚Flink æ”¯æŒçš„æ‹“å±•åº“æ¶‰åŠæœºå™¨å­¦ä¹ ï¼ˆFlinkMLï¼‰ã€å¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰ã€ä»¥åŠå›¾è®¡ç®—ï¼ˆGellyï¼‰ï¼Œè¿˜æœ‰åˆ†åˆ«é’ˆå¯¹æµå¤„ç†å’Œæ‰¹å¤„ç†çš„ Table APIã€‚</p></blockquote><h1 id="cdc"><a href="#cdc" class="headerlink" title="cdc"></a>cdc</h1><p><a href="https://developer.aliyun.com/article/848448?spm=a2c6h.12873639.0.d102020001.6a5a2de1EwwX6V&utm_content=g_1000316418">Flink Forward Aisa ç³»åˆ—ä¸“åˆŠï½œFlink CDC æ–°ä¸€ä»£æ•°æ®é›†æˆæ¡†æ¶ - æŠ€æœ¯åŸç†ã€å…¥é—¨ä¸ç”Ÿäº§å®è·µ-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº</a></p><h1 id="cep"><a href="#cep" class="headerlink" title="cep"></a>cep</h1><ul><li><p>åº”ç”¨åœºæ™¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">é£é™©æ§åˆ¶</span><br><span class="line">å¯¹ç”¨æˆ·å¼‚å¸¸è¡Œä¸ºæ¨¡å¼è¿›è¡Œå®æ—¶æ£€æµ‹ï¼Œå½“ä¸€ä¸ªç”¨æˆ·å‘ç”Ÿäº†ä¸è¯¥å‘ç”Ÿçš„è¡Œä¸ºï¼Œåˆ¤å®šè¿™ä¸ªç”¨æˆ·æ˜¯ä¸æ˜¯æœ‰è¿è§„æ“ä½œçš„å«Œç–‘ã€‚</span><br><span class="line"></span><br><span class="line">ç­–ç•¥è¥é”€</span><br><span class="line">ç”¨é¢„å…ˆå®šä¹‰å¥½çš„è§„åˆ™å¯¹ç”¨æˆ·çš„è¡Œä¸ºè½¨è¿¹è¿›è¡Œå®æ—¶è·Ÿè¸ªï¼Œå¯¹è¡Œä¸ºè½¨è¿¹åŒ¹é…é¢„å®šä¹‰è§„åˆ™çš„ç”¨æˆ·å®æ—¶å‘é€ç›¸åº”ç­–ç•¥çš„æ¨å¹¿ã€‚</span><br><span class="line"></span><br><span class="line">è¿ç»´ç›‘æ§</span><br><span class="line">çµæ´»é…ç½®å¤šæŒ‡æ ‡ã€å¤šä¾èµ–æ¥å®ç°æ›´å¤æ‚çš„ç›‘æ§æ¨¡å¼ã€‚</span><br></pre></td></tr></table></figure></li></ul><h1 id="streaming-warehouse"><a href="#streaming-warehouse" class="headerlink" title="streaming warehouse"></a>streaming warehouse</h1><p>æµå¼æ•°ä»“ï¼ˆStreaming Warehouseï¼‰æ›´å‡†ç¡®åœ°è¯´ï¼Œå…¶å®æ˜¯â€œmake data warehouse streamingâ€ï¼Œå°±æ˜¯è®©æ•´ä¸ªæ•°ä»“çš„æ•°æ®å…¨å®æ—¶åœ°æµåŠ¨èµ·æ¥ï¼Œä¸”æ˜¯ä»¥çº¯æµçš„æ–¹å¼è€Œä¸æ˜¯å¾®æ‰¹ï¼ˆmini-batchï¼‰çš„æ–¹å¼æµåŠ¨ã€‚</p><p>ç›®æ ‡æ˜¯å®ç°ä¸€ä¸ªå…·å¤‡ç«¯åˆ°ç«¯å®æ—¶æ€§çš„çº¯æµæœåŠ¡ï¼ˆStreaming Serviceï¼‰ï¼Œç”¨ä¸€å¥— API åˆ†ææ‰€æœ‰æµåŠ¨ä¸­çš„æ•°æ®ï¼Œå½“æºå¤´æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ¯”å¦‚æ•æ‰åˆ°åœ¨çº¿æœåŠ¡çš„ Log æˆ–æ•°æ®åº“çš„ Binlog ä»¥åï¼Œå°±æŒ‰ç…§æå‰å®šä¹‰å¥½çš„ Query é€»è¾‘æˆ–æ•°æ®å¤„ç†é€»è¾‘ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆ†æï¼Œåˆ†æåçš„æ•°æ®è½åˆ°æ•°ä»“çš„æŸä¸€ä¸ªåˆ†å±‚ï¼Œå†ä»ç¬¬ä¸€ä¸ªåˆ†å±‚å‘ä¸‹ä¸€ä¸ªåˆ†å±‚æµåŠ¨ï¼Œç„¶åæ•°ä»“æ‰€æœ‰åˆ†å±‚ä¼šå…¨éƒ¨æµåŠ¨èµ·æ¥ï¼Œæœ€ç»ˆæµåˆ°ä¸€ä¸ªåœ¨çº¿ç³»ç»Ÿé‡Œï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°æ•´ä¸ªæ•°ä»“çš„å…¨å®æ—¶æµåŠ¨æ•ˆæœã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æ˜¯ä¸»åŠ¨çš„ï¼Œè€ŒæŸ¥è¯¢æ˜¯è¢«åŠ¨çš„ï¼Œåˆ†æç”±æ•°æ®çš„å˜åŒ–æ¥é©±åŠ¨ã€‚åŒæ—¶åœ¨å‚ç›´æ–¹å‘ä¸Šï¼Œå¯¹æ¯ä¸€ä¸ªæ•°æ®æ˜ç»†å±‚ï¼Œç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œ Query è¿›è¡Œä¸»åŠ¨æŸ¥è¯¢ï¼Œå¹¶ä¸”èƒ½å®æ—¶è·å¾—æŸ¥è¯¢ç»“æœã€‚æ­¤å¤–ï¼Œå®ƒè¿˜èƒ½å…¼å®¹ç¦»çº¿åˆ†æåœºæ™¯ï¼ŒAPI ä¾ç„¶æ˜¯åŒä¸€å¥—ï¼Œå®ç°çœŸæ­£çš„ä¸€ä½“åŒ–ã€‚</p><h1 id="Flink-on-YARNæ¨¡å¼"><a href="#Flink-on-YARNæ¨¡å¼" class="headerlink" title="Flink on YARNæ¨¡å¼"></a>Flink on YARNæ¨¡å¼</h1><p>åœ¨è¿™ç§æ¨¡å¼ä¸‹Flinkçš„èµ„æºç”±YARNæ¥è¿›è¡Œç®¡ç†ï¼ŒFlinkæœåŠ¡è¢«æäº¤åˆ°YARNçš„ResourceManageråï¼ŒYARNçš„NodeManagerä¼šä¸ºFlinkç”Ÿæˆå¯¹åº”çš„å®¹å™¨ï¼ŒFlinkå†å°†JobManagerå’ŒTaskManagerå®ä¾‹éƒ¨ç½²åˆ°å®¹å™¨ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹Flinkå¯ä»¥é€šè¿‡JobManageræ‰€éœ€è¦çš„slotsæ•°é‡æ¥åŠ¨æ€çš„è°ƒæ•´TaskManagerçš„èµ„æºï¼Œè¾¾åˆ°äº†èµ„æºçš„å¯æ‹“å±•æ€§ã€‚Flinkå®˜æ–¹ä¹Ÿæ¨èæ­£å¼çš„ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¿™ç§éƒ¨ç½²æ¨¡å¼ã€‚<br>åœ¨YARNä¸Šï¼Œåˆåˆ†ä¸ºä¸‰ç§éƒ¨ç½²æ¨¡å¼ï¼š</p><h2 id="Session-Mode"><a href="#Session-Mode" class="headerlink" title="Session Mode"></a>Session Mode</h2><p>å…±äº«JobManagerå’ŒTaskManagerï¼Œæ‰€æœ‰æäº¤çš„ä»»åŠ¡éƒ½åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­è¿è¡Œï¼Œé›†ç¾¤çš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºä»»åŠ¡ï¼Œä»»åŠ¡çš„å¼€å§‹ã€ç»“æŸä¸å½±å“é›†ç¾¤çš„ç”Ÿå‘½å‘¨æœŸã€‚ç±»ä¼¼äºä¸Šé¢çš„Standalone-clusteræ¨¡å¼ï¼Œä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´ä¸éš”ç¦»ï¼Œå…±äº«åŒä¸€å¥—èµ„æºã€‚</p><h2 id="Per-Job-Mode"><a href="#Per-Job-Mode" class="headerlink" title="Per-Job Mode"></a>Per-Job Mode</h2><p>ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºå•ç‹¬çš„JobManagerå’ŒTaskManageré›†ç¾¤ï¼Œæ¯ä¸ªä»»åŠ¡ä¹‹é—´äº’ç›¸éš”ç¦»äº’ä¸å¹²æ‰°ï¼Œé›†ç¾¤çš„ç”Ÿå‘½å‘¨æœŸéšç€ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸç»“æŸè€Œç»“æŸã€‚è¿™ç§æ¨¡å¼çš„ä¼˜ç‚¹å°±æ˜¯ä»»åŠ¡ç‹¬å ä¸€ä¸ªé›†ç¾¤ï¼Œèµ„æºçš„éš”ç¦»æ€§å¥½ã€‚</p><h2 id="Application-Mode"><a href="#Application-Mode" class="headerlink" title="Application Mode"></a>Application Mode</h2><p>ä¸€ä¸ªApplicationå¯ä»¥å­˜åœ¨å¤šä¸ªä»»åŠ¡ï¼Œè¿™æ—¶YARNä¸ºæ¯ä¸ªApplicationåˆ›å»ºé›†ç¾¤ï¼ŒApplicationä¸­çš„ä»»åŠ¡å…±äº«è¯¥é›†ç¾¤ï¼Œèµ„æºçš„éš”ç¦»æ˜¯Applicationçº§åˆ«çš„ï¼Œé›†ç¾¤çš„ç”Ÿå‘½å‘¨æœŸéšç€Applicationçš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚è¿™ç§æ¨¡å¼æ›´åƒæ˜¯Session Modeå’ŒPre-Job Modeçš„æŠ˜ä¸­æ–¹æ¡ˆï¼Œæ—¢åšåˆ°äº†èµ„æºçš„éš”ç¦»ï¼Œåˆæé«˜äº†ä»»åŠ¡ä¹‹é—´èµ„æºçš„åˆ©ç”¨ç‡ã€‚</p><h2 id="interaction"><a href="#interaction" class="headerlink" title="interaction"></a>interaction</h2><p><img src="/images/flinkOnYarn/flink_on_yarn.png"> </p><h2 id="two-way-to-submit-job-on-yarn"><a href="#two-way-to-submit-job-on-yarn" class="headerlink" title="two way to submit job on yarn"></a>two way to submit job on yarn</h2><p><img src="/images/flinkOnYarn/submit_job.png"></p><h3 id="first-wayï¼šyarn-session"><a href="#first-wayï¼šyarn-session" class="headerlink" title="first wayï¼šyarn session"></a>first wayï¼šyarn session</h3><blockquote><p>(Start a long-running Flink cluster on YARN)è¿™ç§æ–¹å¼éœ€è¦å…ˆå¯åŠ¨é›†ç¾¤ï¼Œç„¶ååœ¨æäº¤ä½œä¸šï¼Œæ¥ç€ä¼šå‘yarnç”³è¯·ä¸€å—ç©ºé—´åï¼Œèµ„æºæ°¸è¿œä¿æŒä¸å˜ã€‚å¦‚æœèµ„æºæ»¡äº†ï¼Œä¸‹ä¸€ä¸ªä½œä¸šå°±æ— æ³•æäº¤ï¼Œåªèƒ½ç­‰åˆ°yarnä¸­çš„å…¶ä¸­ä¸€ä¸ªä½œä¸šæ‰§è¡Œå®Œæˆåï¼Œé‡Šæ”¾äº†èµ„æºï¼Œé‚£ä¸‹ä¸€ä¸ªä½œä¸šæ‰ä¼šæ­£å¸¸æäº¤.</p><p>ps:æ‰€æœ‰ä½œä¸šå…±äº«Dispatcherå’ŒResourceManagerï¼›å…±äº«èµ„æºï¼›é€‚åˆè§„æ¨¡å°æ‰§è¡Œæ—¶é—´çŸ­çš„ä½œä¸š.é€‚ç”¨äºæœ¬åœ°æµ‹è¯•æˆ–è€…å¼€å‘</p></blockquote><h4 id="mode-one-å®¢æˆ·ç«¯æ¨¡å¼"><a href="#mode-one-å®¢æˆ·ç«¯æ¨¡å¼" class="headerlink" title="mode one: å®¢æˆ·ç«¯æ¨¡å¼"></a>mode one: å®¢æˆ·ç«¯æ¨¡å¼</h4><blockquote><p>å¯ä»¥å¯åŠ¨å¤šä¸ªyarn sessionï¼Œä¸€ä¸ªyarn sessionæ¨¡å¼å¯¹åº”ä¸€ä¸ªJobManager,å¹¶æŒ‰ç…§éœ€æ±‚æäº¤ä½œä¸šï¼ŒåŒä¸€ä¸ªSessionä¸­å¯ä»¥æäº¤å¤šä¸ªFlinkä½œä¸šã€‚å¦‚æœæƒ³è¦åœæ­¢Flink Yarn Applicationï¼Œéœ€è¦é€šè¿‡yarn application -killå‘½ä»¤æ¥åœæ­¢.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/yarn-session.sh -n 2 -jm 1024 -tm 4096 -s 6</span><br></pre></td></tr></table></figure><ul><li><p>YarnSessionClusterEntrypointè¿›ç¨‹</p><p>ä»£è¡¨æœ¬èŠ‚ç‚¹å¯ä»¥å‘½ä»¤æ–¹å¼æäº¤jobï¼Œè€Œä¸”å¯ä»¥ä¸ç”¨æŒ‡å®š-må‚æ•°ã€‚</p><ul><li><p>æœ¬èŠ‚ç‚¹æäº¤ä»»åŠ¡</p><p><code>bin/flink run ~/flink-demo-wordcount.jar</code></p></li><li><p>å¦‚æœéœ€è¦åœ¨å…¶ä»–ä¸»æœºèŠ‚ç‚¹æäº¤ä»»åŠ¡</p><p><code>bin/flink run -m vmhome10.com:43258 examples/batch/WordCount.jar</code></p></li></ul></li><li><p>FlinkYarnSessionCliè¿›ç¨‹</p><p>ä»£è¡¨yarn-sessioné›†ç¾¤å…¥å£ï¼Œå®é™…å°±æ˜¯jobmanagerèŠ‚ç‚¹ï¼Œä¹Ÿæ˜¯yarnçš„ApplicationMasterèŠ‚ç‚¹ã€‚</p></li></ul><h4 id="mode-two-åˆ†ç¦»å¼æ¨¡å¼"><a href="#mode-two-åˆ†ç¦»å¼æ¨¡å¼" class="headerlink" title="mode two: åˆ†ç¦»å¼æ¨¡å¼"></a>mode two: åˆ†ç¦»å¼æ¨¡å¼</h4><blockquote><p>JobManagerçš„ä¸ªæ•°åªèƒ½æ˜¯ä¸€ä¸ªï¼ŒåŒä¸€ä¸ªSessionä¸­å¯ä»¥æäº¤å¤šä¸ªFlinkä½œä¸šã€‚å¦‚æœæƒ³è¦åœæ­¢Flink Yarn Applicationï¼Œéœ€è¦é€šè¿‡yarn application -killå‘½ä»¤æ¥åœæ­¢ã€‚é€šè¿‡-dæŒ‡å®šåˆ†ç¦»æ¨¡å¼.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/yarn-session.sh -nm test3 -d</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹åªä¼šå‡ºç°ä¸€ä¸ª YarnSessionClusterEntrypointè¿›ç¨‹</p></blockquote><h3 id="second-way-flink-run"><a href="#second-way-flink-run" class="headerlink" title="second way: flink run"></a>second way: flink run</h3><blockquote><p>ç›´æ¥åœ¨YARNä¸Šæäº¤è¿è¡ŒFlinkä½œä¸š(Run a Flink job on YARN)ï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ä¸€ä¸ªä»»åŠ¡ä¼šå¯¹åº”ä¸€ä¸ªjob,å³æ²¡æäº¤ä¸€ä¸ªä½œä¸šä¼šæ ¹æ®è‡ªèº«çš„æƒ…å†µï¼Œå‘yarnç”³è¯·èµ„æºï¼Œç›´åˆ°ä½œä¸šæ‰§è¡Œå®Œæˆï¼Œå¹¶ä¸ä¼šå½±å“ä¸‹ä¸€ä¸ªä½œä¸šçš„æ­£å¸¸è¿è¡Œï¼Œé™¤éæ˜¯yarnä¸Šé¢æ²¡æœ‰ä»»ä½•èµ„æºçš„æƒ…å†µä¸‹ã€‚</p><p>ps:é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå¯å¯åŠ¨å¤šä¸ªyarn session ï¼ˆbin/yarn-session.sh -nm ipOrHostNameï¼‰</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/flink run -m addressOfJobmanager -yn 1 -yjm 1024 -ytm 1024 ./examples/batch/WordCount.jar</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä½¿ç”¨å‚æ•°-m yarn-clusteræäº¤åˆ°yarné›†ç¾¤ã€‚</p><ul><li><p>è¿è¡Œåˆ°æŒ‡å®šçš„yarn session</p><p>å¯ä»¥æŒ‡å®š -yid,â€“yarnapplicationId <arg> Attach to running YARN sessionæ¥é™„åŠ åˆ°åˆ°ç‰¹å®šçš„yarn sessionä¸Šè¿è¡Œ</p></li></ul><hr><p>reference</p><p><a href="https://www.jianshu.com/p/1b05202c4fb6">Flink on yarnéƒ¨ç½²æ¨¡å¼ - ç®€ä¹¦</a></p><p><a href="https://www.cnblogs.com/asker009/p/11327533.html">flink on yarnæ¨¡å¼ä¸‹ä¸¤ç§æäº¤jobæ–¹å¼ - æˆ‘æ˜¯å±è½¦çš„ - åšå®¢å›­</a></p><p><a href="https://blog.csdn.net/u013411339/article/details/95421500?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164455981216780357293300%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=164455981216780357293300&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-21-95421500.nonecase&utm_term=%E2%80%9Cflink+cep%E2%80%9D&spm=1018.2226.3001.4450">Flink-On-Yarnçš„éƒ¨ç½²æ¨¡å¼</a></p><h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><h2 id="ä¾èµ–å†²çª"><a href="#ä¾èµ–å†²çª" class="headerlink" title="ä¾èµ–å†²çª"></a>ä¾èµ–å†²çª</h2><p><a href="https://flink.apache.org/getting-help/#i-see-a-classcastexception-x-cannot-be-cast-to-x">https://flink.apache.org/getting-help/#i-see-a-classcastexception-x-cannot-be-cast-to-x</a></p><p><a href="https://nightlies.apache.org/flink/flink-docs-release-1.17/docs/ops/debugging/debugging_classloading">https://nightlies.apache.org/flink/flink-docs-release-1.17/docs/ops/debugging/debugging_classloading</a></p><p>æ’æŸ¥åŠæ³•</p><ul><li>ä½¿ç”¨arthaså®šä½ä¾èµ–ç±»æ‰€åœ¨jaråŒ…</li></ul><p>è§£å†³åŠæ³•</p><ul><li><p>å¯¹å†²çªjaråŒ…ä½¿ç”¨maven shaded çš„excludeæˆ–relocation è¿›è¡Œæ“ä½œ</p></li><li><p>ä½¿ç”¨7zipç­‰è§£å‹è½¯ä»¶å¯¹jaræ–‡ä»¶è§£å‹åˆ é™¤ï¼ˆäººå·¥shadedï¼‰</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> flink </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java profiler</title>
      <link href="/2019/11/11/java%20profiler/"/>
      <url>/2019/11/11/java%20profiler/</url>
      
        <content type="html"><![CDATA[<h2 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a>æ ¸å¿ƒ</h2><p>â€œçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œâ€ã€‚</p><p>å­¦ä¼šé€è¿‡ç°è±¡çœ‹æœ¬è´¨</p><p><strong>1. æ‰å®çš„è®¡ç®—æœºåŸºç¡€</strong></p><blockquote><p>æˆ‘ä»¬éœ€è¦å‚¨å¤‡è®¡ç®—æœºç»„æˆåŸç†ã€æ“ä½œç³»ç»Ÿã€ç½‘ç»œåè®®ä»¥åŠæ•°æ®åº“ç­‰åŸºç¡€çŸ¥è¯†ã€‚å…·ä½“çš„æ€§èƒ½é—®é¢˜å¾€å¾€è¿˜ä¸ä¼ è¾“ã€è®¡ç®—ã€å­˜å‚¨æ•°æ®ç­‰ç›¸å…³ï¼Œé‚£æˆ‘ä»¬è¿˜éœ€è¦å‚¨å¤‡æ•°æ®ç»“æ„ã€ç®—æ³•ä»¥åŠæ•°å­¦ç­‰åŸºç¡€çŸ¥è¯†ã€‚</p></blockquote><p><strong>2. ä¹ æƒ¯é€è¿‡æºç äº†è§£æŠ€æœ¯æœ¬è´¨</strong></p><blockquote><p>æˆ‘ä»¬éœ€è¦æ·±å…¥æºç ï¼Œé€šè¿‡åˆ†ææ¥å­¦ä¹ ã€æ€»ç»“ä¸€é¡¹æŠ€æœ¯çš„å®ç°åŸç†å’Œä¼˜ç¼ºç‚¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ›´å®¢è§‚åœ°å»å­¦ä¹ ä¸€é¡¹æŠ€æœ¯ï¼Œè¿˜èƒ½é€è¿‡æºç æ¥å­¦ä¹ ç‰›äººçš„æ€ç»´æ–¹å¼ï¼Œæ”¶è·æ›´å¥½çš„ç¼–ç å®ç°æ–¹å¼ã€‚</p></blockquote><p><strong>3. å–„äºè¿½é—®å’Œæ€»ç»“</strong></p><blockquote><p>â€œçŸ¥å…¶ç„¶ä¸”çŸ¥æ‰€ä»¥ç„¶â€æ‰æ˜¯æˆ‘ä»¬ç§¯ç´¯ç»éªŒçš„å…³é”®ã€‚çŸ¥é“äº†ä¸€é¡¹æŠ€æœ¯èƒŒåçš„å®ç°åŸç†ï¼Œæˆ‘ä»¬æ‰èƒ½åœ¨é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶ï¼Œåšåˆ°è§¦ç±»æ—é€šã€‚</p></blockquote><h2 id="è°ƒä¼˜æ”¿ç­–"><a href="#è°ƒä¼˜æ”¿ç­–" class="headerlink" title="è°ƒä¼˜æ”¿ç­–"></a>è°ƒä¼˜æ”¿ç­–</h2><ul><li>åˆ†ææŸ¥æ‰¾é—®é¢˜æ˜¯ä¸€ä¸ªå¤æ‚è€Œåˆç»†è‡´çš„è¿‡ç¨‹ï¼ŒæŸä¸ªæ€§èƒ½é—®é¢˜å¯èƒ½æ˜¯ä¸€ä¸ªåŸå› å¯¼è‡´çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯å‡ ä¸ªåŸå› å…±åŒå¯¼è‡´çš„ç»“æœã€‚æˆ‘ä»¬åˆ†ææŸ¥æ‰¾é—®é¢˜å¯ä»¥é‡‡ç”¨è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼ï¼Œè€Œæˆ‘ä»¬è§£å†³ç³»ç»Ÿæ€§èƒ½é—®é¢˜ï¼Œåˆ™å¯ä»¥é‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ–¹å¼é€çº§ä¼˜åŒ–ã€‚</li></ul><p><strong>1. ä¼˜åŒ–ä»£ç </strong></p><p><strong>2. ä¼˜åŒ–è®¾è®¡</strong></p><p><strong>3. ä¼˜åŒ–ç®—æ³•</strong></p><p><strong>4. æ—¶é—´æ¢ç©ºé—´</strong></p><p><strong>5. ç©ºé—´æ¢æ—¶é—´</strong></p><p><strong>6. å‚æ•°è°ƒä¼˜</strong></p><p><strong>7. å…œåº•ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§</strong></p><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p><strong>æ•°ç»„</strong>ï¼šé‡‡ç”¨ä¸€æ®µè¿ç»­çš„å­˜å‚¨å•å…ƒæ¥å­˜å‚¨æ•°æ®ã€‚å¯¹äºæŒ‡å®šä¸‹æ ‡çš„æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œä½†åœ¨æ•°ç»„ä¸­é—´ä»¥åŠå¤´éƒ¨æ’å…¥æ•°æ®æ—¶ï¼Œéœ€è¦å¤åˆ¶ç§»åŠ¨åé¢çš„å…ƒç´ ã€‚</p><p><strong>é“¾è¡¨</strong>ï¼šä¸€ç§åœ¨ç‰©ç†å­˜å‚¨å•å…ƒä¸Šéè¿ç»­ã€éé¡ºåºçš„å­˜å‚¨ç»“æ„ï¼Œæ•°æ®å…ƒç´ çš„é€»è¾‘é¡ºåºæ˜¯é€šè¿‡é“¾è¡¨ä¸­çš„æŒ‡é’ˆé“¾æ¥æ¬¡åºå®ç°çš„ã€‚ç”±äºé“¾è¡¨ä¸ç”¨å¿…é¡»æŒ‰é¡ºåºå­˜å‚¨ï¼Œæ‰€ä»¥é“¾è¡¨åœ¨æ’å…¥çš„æ—¶å€™å¯ä»¥è¾¾åˆ° O(1) çš„å¤æ‚åº¦ï¼Œä½†æŸ¥æ‰¾ä¸€ä¸ªç»“ç‚¹æˆ–è€…è®¿é—®ç‰¹å®šç¼–å·çš„ç»“ç‚¹éœ€è¦ O(n) çš„æ—¶é—´ã€‚</p><p><strong>å“ˆå¸Œè¡¨</strong>ï¼šæ ¹æ®å…³é”®ç å€¼ï¼ˆKey valueï¼‰ç›´æ¥è¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æ„ã€‚é€šè¿‡æŠŠå…³é”®ç å€¼æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œä»¥åŠ å¿«æŸ¥æ‰¾çš„é€Ÿåº¦ã€‚è¿™ä¸ªæ˜ å°„å‡½æ•°å«åšå“ˆå¸Œå‡½æ•°ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„å°±å«åšå“ˆå¸Œè¡¨ã€‚</p><p><strong>æ ‘</strong>ï¼šç”± nï¼ˆnâ‰¥1ï¼‰ä¸ªæœ‰é™ç»“ç‚¹ç»„æˆçš„ä¸€ä¸ªå…·æœ‰å±‚æ¬¡å…³ç³»çš„é›†åˆï¼Œå°±åƒæ˜¯ä¸€æ£µå€’æŒ‚çš„æ ‘ã€‚</p><h3 id="å­—ç¬¦ä¸²æ€§èƒ½ä¼˜åŒ–"><a href="#å­—ç¬¦ä¸²æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="å­—ç¬¦ä¸²æ€§èƒ½ä¼˜åŒ–"></a>å­—ç¬¦ä¸²æ€§èƒ½ä¼˜åŒ–</h3><p><a href="https://imgchr.com/i/MGD7wV"><img src="https://s2.ax1x.com/2019/11/13/MGD7wV.md.jpg" alt="MGD7wV.md.jpg"></a></p><ul><li><p>ä¸€ä¸ª char å­—ç¬¦å  16 ä½ï¼Œ2 ä¸ªå­—èŠ‚ã€‚è¿™ä¸ªæƒ…å†µä¸‹ï¼Œå­˜å‚¨å•å­—èŠ‚ç¼–ç å†…çš„å­—ç¬¦ï¼ˆå ä¸€ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼‰å°±æ˜¾å¾—éå¸¸æµªè´¹ã€‚JDK1.9 çš„ String ç±»ä¸ºäº†èŠ‚çº¦å†…å­˜ç©ºé—´ï¼Œäºæ˜¯ä½¿ç”¨äº†å  8 ä½ï¼Œ1 ä¸ªå­—èŠ‚çš„ byte æ•°ç»„æ¥å­˜æ”¾å­—ç¬¦ä¸²</p></li><li><p>String å¯¹è±¡çš„ä¸å¯å˜æ€§</p></li><li><p>å¯¹è±¡å’Œå¯¹è±¡å¼•ç”¨</p></li><li><p>ä½¿ç”¨ String.intern æ¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œä»è€Œä¼˜åŒ– String å¯¹è±¡çš„å­˜å‚¨</p><blockquote><p>å…·ä½“åšæ³•å°±æ˜¯ï¼Œåœ¨æ¯æ¬¡èµ‹å€¼çš„æ—¶å€™ä½¿ç”¨ String çš„ intern æ–¹æ³•ï¼Œå¦‚æœå¸¸é‡æ± ä¸­æœ‰ç›¸åŒå€¼ï¼Œå°±ä¼šé‡å¤ä½¿ç”¨è¯¥å¯¹è±¡ï¼Œè¿”å›å¯¹è±¡å¼•ç”¨ï¼Œè¿™æ ·ä¸€å¼€å§‹çš„å¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶æ‰ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä½¿é‡å¤æ€§éå¸¸é«˜çš„åœ°å€ä¿¡æ¯å­˜å‚¨å¤§å°ä» 20G é™åˆ°å‡ ç™¾å…†ã€‚</p><p>å¦‚æœè°ƒç”¨ intern æ–¹æ³•ï¼Œä¼šå»æŸ¥çœ‹å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç­‰äºè¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±åœ¨å¸¸é‡æ± ä¸­æ–°å¢è¯¥å¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡å¼•ç”¨ï¼›å¦‚æœæœ‰ï¼Œå°±è¿”å›å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¼•ç”¨ã€‚å †å†…å­˜ä¸­åŸæœ‰çš„å¯¹è±¡ç”±äºæ²¡æœ‰å¼•ç”¨æŒ‡å‘å®ƒï¼Œå°†ä¼šé€šè¿‡åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String a =<span class="keyword">new</span> String(<span class="string">&quot;abc&quot;</span>).intern();</span><br><span class="line">String b = <span class="keyword">new</span> String(<span class="string">&quot;abc&quot;</span>).intern();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a==b) &#123;<span class="comment">// a å’Œ b å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</span></span><br><span class="line">    System.out.print(<span class="string">&quot;a==b&quot;</span>);<span class="comment">//æ­£å¸¸è¾“å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç”¨ String.indexOf() æ–¹æ³•ä»£æ›¿ Split() æ–¹æ³•å®Œæˆå­—ç¬¦ä¸²çš„åˆ†å‰² </p></li></ul><h3 id="æ…é‡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ…é‡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ…é‡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼"></a>æ…é‡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</h3><p><a href="https://imgchr.com/i/MGDWWQ"><img src="https://s2.ax1x.com/2019/11/13/MGDWWQ.md.jpg" alt="MGDWWQ.md.jpg"></a></p><blockquote><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªç”¨æ­£åˆ™ç¬¦å·å†™å‡ºçš„å…¬å¼ï¼Œç¨‹åºå¯¹è¿™ä¸ªå…¬å¼è¿›è¡Œè¯­æ³•åˆ†æï¼Œå»ºç«‹ä¸€ä¸ªè¯­æ³•åˆ†ææ ‘ï¼Œå†æ ¹æ®è¿™ä¸ªåˆ†ææ ‘ç»“åˆæ­£åˆ™è¡¨è¾¾å¼çš„å¼•æ“ç”Ÿæˆæ‰§è¡Œç¨‹åºï¼ˆè¿™ä¸ªæ‰§è¡Œç¨‹åºæˆ‘ä»¬æŠŠå®ƒç§°ä½œçŠ¶æ€æœºï¼Œä¹Ÿå«çŠ¶æ€è‡ªåŠ¨æœºï¼‰ï¼Œç”¨äºå­—ç¬¦åŒ¹é…ã€‚</p><p>å¦‚æœä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼èƒ½ä½¿ä½ çš„ä»£ç ç®€æ´æ–¹ä¾¿ï¼Œé‚£ä¹ˆåœ¨åšå¥½æ€§èƒ½æ’æŸ¥çš„å‰æä¸‹ï¼Œå¯ä»¥å»ä½¿ç”¨ï¼›å¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆæ­£åˆ™è¡¨è¾¾å¼èƒ½ä¸ç”¨å°±ä¸ç”¨ï¼Œä»¥æ­¤é¿å…é€ æˆæ›´å¤šçš„æ€§èƒ½é—®é¢˜ã€‚</p></blockquote><h3 id="ArrayList-VS-LinkedList"><a href="#ArrayList-VS-LinkedList" class="headerlink" title="ArrayList VS LinkedList"></a>ArrayList VS LinkedList</h3><ul><li>ç”±äº ArrayList æ˜¯æ•°ç»„å®ç°çš„ï¼Œè€Œæ•°ç»„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œåœ¨æ·»åŠ å…ƒç´ åˆ°æ•°ç»„å¤´éƒ¨çš„æ—¶å€™ï¼Œéœ€è¦å¯¹å¤´éƒ¨ä»¥åçš„æ•°æ®è¿›è¡Œå¤åˆ¶é‡æ’ï¼Œæ‰€ä»¥æ•ˆç‡å¾ˆä½ï¼›è€Œ LinkedList æ˜¯åŸºäºé“¾è¡¨å®ç°ï¼Œåœ¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šé€šè¿‡å¾ªç¯æŸ¥æ‰¾åˆ°æ·»åŠ å…ƒç´ çš„ä½ç½®ï¼Œå¦‚æœè¦æ·»åŠ çš„ä½ç½®å¤„äº List çš„å‰åŠæ®µï¼Œå°±ä»å‰å¾€åæ‰¾ï¼›è‹¥å…¶ä½ç½®å¤„äºååŠæ®µï¼Œå°±ä»åå¾€å‰æ‰¾ã€‚å› æ­¤ LinkedList æ·»åŠ å…ƒç´ åˆ°å¤´éƒ¨æ˜¯éå¸¸é«˜æ•ˆçš„ã€‚</li><li>LinkedList çš„ for å¾ªç¯æ€§èƒ½æ˜¯æœ€å·®çš„ï¼Œè€Œ ArrayList çš„ for å¾ªç¯æ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚</li></ul><h2 id="jconsole"><a href="#jconsole" class="headerlink" title="jconsole"></a>jconsole</h2><h3 id="jconsoleé…ç½®è¿œç¨‹ç›‘æ§"><a href="#jconsoleé…ç½®è¿œç¨‹ç›‘æ§" class="headerlink" title="jconsoleé…ç½®è¿œç¨‹ç›‘æ§"></a>jconsoleé…ç½®è¿œç¨‹ç›‘æ§</h3><ul><li><p>è¿œç¨‹jvmè¿›ç¨‹éœ€é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">env.java.opts: </span><br><span class="line">-Dcom.sun.management.jmxremote </span><br><span class="line">-Dcom.sun.management.jmxremote.port=9999</span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate=false </span><br><span class="line">-Dcom.sun.management.jmxremote.ssl=false</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­9999ä¸ºæŒ‡å®šç›‘æ§ç«¯å£</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> course </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ignite snippet</title>
      <link href="/2019/11/01/ignite_snippet/"/>
      <url>/2019/11/01/ignite_snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h1><ul><li><p>æ¸…ç©ºæ•°æ®</p><p><code>cache -clear -c=xxxxx</code></p></li><li><p>lostPart</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cache -rebalance -c=xxxx</span><br><span class="line">cache -rebalance å‘½ä»¤ä¸éœ€è¦ä¾èµ–äº cache -stop çš„æ“ä½œã€‚å¯åŠ¨æˆ–é‡æ–°å¯åŠ¨åˆ†åŒºé‡å¹³è¡¡å¯ä»¥åœ¨ç¼“å­˜è¿è¡ŒæœŸé—´è¿›è¡Œï¼Œä¸éœ€è¦åœæ­¢ç¼“å­˜ã€‚</span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢å¤šä¸ªç¼“å­˜è¡¨</p></li></ul><p>â€‹    <code>cache -stop --caches=myCache_*</code></p><ul><li>é‡æ–°å¹³è¡¡å¤šä¸ªç¼“å­˜è¡¨</li></ul><p>â€‹    <code>cache -rebalance --caches=myCache1,myCache2,myCache3</code></p><ul><li><p>åœæ­¢æ‰€æœ‰ç¼“å­˜è¡¨ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cache -stop --all </span><br><span class="line">cache -start --all</span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°åŠ è½½æ‰€æœ‰ç¼“å­˜è¡¨å¹¶é‡æ–°å¹³è¡¡</p><p><code>cache -l -r --all</code></p><p><code>cache -clear</code> å‘½ä»¤åªæ˜¯æ¸…ç©ºç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä½†æ˜¯ç¼“å­˜ä»ç„¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼›è€Œ<code>cache -stop</code> å‘½ä»¤åˆ™åœæ­¢äº†ç¼“å­˜ï¼Œå¹¶ä¸”æ¸…ç©ºäº†æ‰€æœ‰æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨ <code>cache -start</code> å‘½ä»¤é‡æ–°å¯åŠ¨ç¼“å­˜ï¼Œå¹¶é‡æ–°åŠ è½½æ•°æ®ã€‚</p></li></ul><p>â€‹    <code>cache -start</code> å‘½ä»¤ç”¨äºå¯åŠ¨ä¸€ä¸ªå·²ç»åœæ­¢çš„ç¼“å­˜ã€‚å¦‚æœç¼“å­˜ä¹‹å‰å·²ç»å­˜åœ¨å¹¶è¢«åœæ­¢ï¼Œä½¿ç”¨ <code>cache -start</code> å‘½ä»¤å¯ä»¥é‡æ–°å¯åŠ¨è¯¥ç¼“å­˜ï¼Œå¹¶å¼€å§‹åŠ è½½æ•°æ®ã€‚å¦‚æœè¯¥ç¼“å­˜ä¹‹å‰ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å­˜å¹¶å¼€å§‹åŠ è½½æ•°æ®ã€‚</p><ul><li>æŸ¥çœ‹è¡¨çš„çŠ¶æ€</li></ul><p>ä½¿ç”¨ <code>cache -state</code> å‘½ä»¤æŸ¥çœ‹æŒ‡å®šç¼“å­˜è¡¨çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ç¼“å­˜å¤§å°ã€åˆ†åŒºæ•°é‡ã€å¤åˆ¶å’Œå¤‡ä»½æ•°ç­‰ä¿¡æ¯ã€‚</p><hr><p>è®¾ç½®å¤åˆ¶å’Œå¤‡ä»½æ•°é‡ï¼š<br>cache -rebalance -r <replicas> -b <backups><br>å…¶ä¸­<replicas>æ˜¯è¦è®¾ç½®çš„å¤åˆ¶æ•°é‡ï¼Œ<backups>æ˜¯è¦è®¾ç½®çš„å¤‡ä»½æ•°é‡ã€‚</p><p>è®¾ç½®å¤‡ä»½æ•°é‡ä¸º1ï¼Œå³æ¯ä¸ªåˆ†åŒºéƒ½åœ¨ä¸€ä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸Šä¿ç•™1ä¸ªå¤‡ä»½æ•°é‡<br>è®¾ç½®å¤åˆ¶æ•°é‡ä¸º2ï¼Œå³æ¯ä¸ªç¼“å­˜è¡¨çš„åˆ†åŒºéƒ½ä¼šåœ¨é›†ç¾¤ä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šå¤åˆ¶</p><p>å¤åˆ¶å’Œå¤‡ä»½éƒ½æ˜¯ä¸ºäº†æé«˜æ•°æ®å¯ç”¨æ€§å’Œå¯é æ€§ï¼Œä½†å¤åˆ¶æ˜¯å°†åŒä¸€ä»½æ•°æ®å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œè€Œå¤‡ä»½æ˜¯å°†æ•°æ®å‰¯æœ¬å­˜å‚¨åœ¨é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸Šã€‚åœ¨é…ç½®Igniteç¼“å­˜è¡¨æ—¶ï¼Œå¯ä»¥åŒæ—¶è®¾ç½®å¤åˆ¶å’Œå¤‡ä»½çš„æ•°é‡æ¥ç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨æ€§å’Œå¯é æ€§ã€‚</p><hr><p>å¦‚æœæœ‰ä¸‰ä¸ªIgniteèŠ‚ç‚¹ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹å»ºè®®è®¾ç½®ç¼“å­˜è¡¨çš„å¤åˆ¶å’Œå¤‡ä»½æ•°é‡ï¼š</p><p>å¤åˆ¶å› å­å»ºè®®è®¾ç½®ä¸º2ï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒºçš„æ•°æ®éƒ½ä¼šåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå¤‡ä»½ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå¯ä»¥ä¿è¯æ•°æ®çš„å¯é æ€§ã€‚<br>ä¾‹å¦‚ï¼Œä½¿ç”¨ignitevisorcmd.shå‘½ä»¤å¯ä»¥è¿™æ ·è®¾ç½®ï¼šcache -set-replicas myCache 2<br>å¤‡ä»½æ•°é‡å»ºè®®è®¾ç½®ä¸º1ï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒºçš„æ•°æ®éƒ½ä¼šåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå¤‡ä»½ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå¯ä»¥ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œå¹¶ä¸”å‡å°‘é¢å¤–çš„ç½‘ç»œå¼€é”€ã€‚<br>ä¾‹å¦‚ï¼Œä½¿ç”¨ignitevisorcmd.shå‘½ä»¤å¯ä»¥è¿™æ ·è®¾ç½®ï¼šcache -set-backups myCache 1</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¾ç½®å¤åˆ¶å’Œå¤‡ä»½æ•°é‡ä¼šå¢åŠ ç½‘ç»œå’Œå­˜å‚¨å¼€é”€ï¼Œå› æ­¤éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯è¿›è¡Œæƒè¡¡å’Œè°ƒæ•´ã€‚<br>æ­¤å¤–ï¼Œè¿˜éœ€è¦æ ¹æ®æ•°æ®å¤§å°ã€è®¿é—®æ¨¡å¼ã€èŠ‚ç‚¹é…ç½®ç­‰å› ç´ è¿›è¡Œæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–ã€‚</p><h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><h2 id="ignite-2-7-0"><a href="#ignite-2-7-0" class="headerlink" title="ignite-2.7.0"></a>ignite-2.7.0</h2><ul><li>ç¼–è¯‘ignite-coreæ¨¡å—çš„æ—¶å€™éœ€è¦ä½¿ç”¨jdk8ï¼Œå› ä¸ºä¼šæŠ¥jdk.internal.misc.SharedSecretsæ‰¾ä¸åˆ°çš„é”™è¯¯åŸå› ï¼šä¼°è®¡æ˜¯åœ¨GridUnsafe.javaä¸­çš„miscPackageæ–¹æ³•ä»¥åŠjavaNioAccessObjectçš„<code>Class&lt;?&gt; cls = Class.forName(pkgName + &quot;.misc.SharedSecrets&quot;);</code>å‡ºç°çš„é—®é¢˜ï¼Œjdk11ä¸­SharedSecretså‡ºç°çš„ä½ç½®æ˜¯<code>jdk.internal.access.SharedSecrets</code></li></ul><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><ul><li>Igniteçš„åŸç”ŸæŒä¹…åŒ–ä¼šåœ¨ç£ç›˜ä¸Šå­˜å‚¨ä¸€ä¸ªæ•°æ®çš„è¶…é›†ï¼Œä»¥åŠæ ¹æ®å®¹é‡åœ¨å†…å­˜ä¸­å­˜å‚¨ä¸€ä¸ªå­é›†ã€‚æ¯”å¦‚ï¼Œå¦‚æœæœ‰100ä¸ªæ¡ç›®ï¼Œç„¶åå†…å­˜åªèƒ½å­˜å‚¨20æ¡ï¼Œé‚£ä¹ˆç£ç›˜ä¸Šä¼šå­˜å‚¨æ‰€æœ‰çš„100æ¡ï¼Œç„¶åä¸ºäº†æé«˜æ€§èƒ½åœ¨å†…å­˜ä¸­ç¼“å­˜20æ¡ã€‚</li><li>å’Œçº¯å†…å­˜çš„ä½¿ç”¨åœºæ™¯ä¸€æ ·ï¼Œå½“æ‰“å¼€æŒä¹…åŒ–æ—¶ï¼Œæ¯ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹åªä¼šæŒä¹…åŒ–æ•°æ®çš„ä¸€ä¸ªå­é›†ï¼Œä¸ç®¡æ˜¯ä¸»è¿˜æ˜¯å¤‡èŠ‚ç‚¹ï¼Œéƒ½æ˜¯åªåŒ…æ‹¬èŠ‚ç‚¹æ‰€å±çš„åˆ†åŒºçš„æ•°æ®ï¼Œæ€»çš„æ¥è¯´ï¼Œæ•´ä¸ªé›†ç¾¤åŒ…æ‹¬äº†å®Œæ•´çš„æ•°æ®é›†ã€‚</li><li>åœ¨å¼€å‘åº”ç”¨æ—¶å¯èƒ½éœ€è¦ä¿®æ”¹è‡ªå®šä¹‰å¯¹è±¡å­—æ®µçš„ç±»å‹ã€‚ä¾‹å¦‚å‡è®¾å¯¹è±¡Açš„å­—æ®µç±»å‹<code>A.range</code>ä¸º<code>int</code>ç±»å‹ï¼Œç„¶åå†³å®šå°†<code>A.range</code>çš„ç±»å‹ä¿®æ”¹ä¸º<code>long</code>ç±»å‹ã€‚ä¹‹åä¼šå‘ç°é›†ç¾¤æˆ–åº”ç”¨å°†æ— æ³•é‡å¯ï¼Œå› ä¸ºIgniteä¸æ”¯æŒå­—æ®µ/åˆ—ç±»å‹çš„æ›´æ”¹ã€‚</li><li>æ— æ³•å˜æ›´æšä¸¾å€¼çš„é¡ºåºï¼Œä¹Ÿæ— æ³•åœ¨æšä¸¾å€¼åˆ—è¡¨çš„å¼€å§‹æˆ–è€…ä¸­éƒ¨æ·»åŠ æ–°çš„å¸¸é‡ï¼Œä½†æ˜¯å¯ä»¥åœ¨åˆ—è¡¨çš„æœ«å°¾æ·»åŠ æ–°çš„å¸¸é‡ã€‚</li></ul><h3 id="ZooKeeper-Discovery"><a href="#ZooKeeper-Discovery" class="headerlink" title="ZooKeeper Discovery"></a>ZooKeeper Discovery</h3><p>ZooKeeper Discoveryæ˜¯ä¸ºéœ€è¦ä¿æŒæ˜“æ‰©å±•æ€§å’Œçº¿æ€§æ€§èƒ½çš„å¤§è§„æ¨¡éƒ¨ç½²è€Œè®¾è®¡çš„ã€‚ç„¶è€Œï¼ŒåŒæ—¶ä½¿ç”¨Igniteå’ŒZooKeeperéœ€è¦é…ç½®å’Œç®¡ç†ä¸¤ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®ä½ åªæœ‰åœ¨è®¡åˆ’æ‰©å±•åˆ°100ä¸ªæˆ–1000ä¸ªèŠ‚ç‚¹æ—¶æ‰ä½¿ç”¨ZooKeeper Discoveryã€‚å¦åˆ™ï¼Œæœ€å¥½ä½¿ç”¨TCP/IPå‘ç°ã€‚</p><hr><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><ul><li><p>marshaller</p><blockquote><p> $IGNITE_HOME/work/db/marshaller    ç±»classpathä¿¡æ¯</p></blockquote></li><li><p>binary_meta</p><blockquote><p>$IGNITE_HOME/work/db/binary_meta    ç±»çš„å…ƒç´ ä¿¡æ¯</p></blockquote></li></ul><p><strong>ä¸‹é¢ä¸‰ä¸ªé…ç½®é¡¹æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®</strong></p><ul><li><p>storagePath</p><blockquote><p>$RDX_HOME/data/ignite/persistent    æŒä¹…åŒ–æ–‡ä»¶</p></blockquote></li><li><p>walPath</p><blockquote><p>$RDX_HOME/data/ignite/wal_store    æŒä¹…åŒ–æ•°æ®çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ˆç±»åã€å…ƒç´ åã€ä½ç½®ï¼‰</p></blockquote><ul><li>walPathå’ŒstoragePathå­˜å‚¨çš„æ•°æ®çš„å…³è”</li></ul></li><li><p>walArchivePath</p><blockquote><p>$RDX_HOME/data/ignite/wal_archive</p></blockquote><ul><li>å’ŒwalPathå­˜å‚¨çš„æ•°æ®ç»“æ„ä¸€æ ·ï¼ŒäºŒè€…çš„å…³ç³»</li></ul></li></ul><h3 id="Ignite-and-ZooKeeper-Configuration-Considerations"><a href="#Ignite-and-ZooKeeper-Configuration-Considerations" class="headerlink" title="Ignite and ZooKeeper Configuration Considerations"></a>Ignite and ZooKeeper Configuration Considerations</h3><ul><li>zookeeperä¸­ tickTimeå’ŒsyncLimitå‚æ•°çš„å®šä¹‰</li></ul><p>When using ZooKeeper Discovery, you need to make sure that the configuration parameters of the ZooKeeper cluster and Ignite cluster match each other.</p><p>Consider a sample ZooKeeper configuration, as follows:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># The number of milliseconds of each tick</span><br><span class="line">tickTime=2000</span><br><span class="line"></span><br><span class="line"># The number of ticks that can pass between sending a request and getting an acknowledgement</span><br><span class="line">syncLimit=5</span><br></pre></td></tr></table></figure><ul><li>åœ¨zookeeperä¸­ tickTimeå’ŒsyncLimitå‚æ•°çš„ä½œç”¨</li></ul><p>Configured this way, ZooKeeper server detects its own segmentation from the rest of the ZooKeeper cluster only afterÂ <code>tickTime * syncLimit</code>Â elapses. Until this event is detected at ZooKeeper level, all Ignite nodes connected to the segmented ZooKeeper server do not try to reconnect to the other ZooKeeper servers.</p><ul><li>åœ¨igniteä¸­ sessionTimeoutå‚æ•°ä¸zookeeperçš„tickTimeå’ŒsyncLimitå‚æ•°çš„å…³è”</li></ul><p>On the other hand, there is aÂ <code>sessionTimeout</code>Â parameter on the Ignite side that defines how soon ZooKeeper closes an Ignite nodeâ€™s session if the node gets disconnected from the ZooKeeper cluster. IfÂ <code>sessionTimeout</code>Â is smaller thanÂ <code>tickTime * syncLimit</code>Â , then the Ignite node is notified by the segmented ZooKeeper server too late â€” its session expires before it tries to reconnect to other ZooKeeper servers.</p><p>To avoid this situation,Â <code>sessionTimeout</code>Â should be bigger thanÂ <code>tickTime * syncLimit</code>.</p><h1 id="sqlline"><a href="#sqlline" class="headerlink" title="sqlline"></a>sqlline</h1><blockquote><p>TIPS:</p><ol><li><p>Keep in mind that, in Ignite, the concepts of a SQL table and a key-value cache are two equivalent representations of the same (internal) data structure. You can access your data using either the key-value API or SQL statements, or both.</p></li><li><p>A cache is a collection of key-value pairs that can be accessed through the key-value API. A SQL table in Ignite corresponds to the notion of tables in traditional RDBMSs with some additional constraints; for example, each SQL table must have a primary key.</p><p>A table with a primary key can be presented as a key-value cache, in which the primary key column serves as the key, and the rest of the table columns represent the fields of the object (the value).</p></li></ol></blockquote><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">IGNITE_HOME/bin/sqlline.sh --verbose=<span class="literal">true</span> -u jdbc:ignite:thin://ipåœ°å€/PUBLIC</span></span><br></pre></td></tr></table></figure><h1 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h1><h3 id="BinaryObjectException-Conflicting-enum-values"><a href="#BinaryObjectException-Conflicting-enum-values" class="headerlink" title="BinaryObjectException: Conflicting enum values"></a>BinaryObjectException: Conflicting enum values</h3><ul><li><p>åŸå› </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å­˜å…¥igniteçš„æ•°æ®æ ¼å¼</span><br><span class="line">key: String , value: Map&lt;Enum, BigDecimal&gt;</span><br><span class="line">Enumç±»å‹åŒ…å«</span><br><span class="line">&#123;A,B,C&#125;</span><br><span class="line"></span><br><span class="line">åœ¨ä¹‹åç”±äºä¸šåŠ¡å˜æ›´ï¼Œéœ€è¦æ–°å¢æ–°çš„enumé¡¹ç›®ï¼Œå¹¶æ·»åŠ Dåœ¨Aä¸Bä¹‹é—´</span><br><span class="line">&#123;A,D,B,C&#125;</span><br></pre></td></tr></table></figure></li><li><p>åˆ†æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”±äºåœ¨æ•°æ®å­˜å…¥igniteä¹‹åï¼Œigniteä¼šä¿å­˜æ•°æ®ç›¸å…³çš„schemaä¿¡æ¯,æ­¤æ—¶åœ¨enumé¡¹ç›®ä¹‹é—´ä¿®æ”¹itemï¼Œä¼šæ‰“ä¹±ä¹‹å‰çš„index</span><br></pre></td></tr></table></figure></li><li><p>è§£å†³ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ–¹æ³•ä¸€ï¼š</span><br><span class="line">æ›´æ”¹enumç±»çš„åç§°ï¼Œä¸å†ä½¿ç”¨åŸæœ‰çš„schemaä¿¡æ¯</span><br><span class="line">æ–¹æ³•äºŒï¼š</span><br><span class="line">enumç±»æ–°å¢é¡¹ç›®æ—¶ï¼Œéœ€è¦åœ¨æœ€åé¢æ·»åŠ ï¼Œé¿å…æ‰“ä¹±å·²æœ‰çš„schemaç´¢å¼•</span><br><span class="line">æ–¹æ³•ä¸‰ï¼ˆæœªéªŒè¯ï¼‰ï¼š</span><br><span class="line">åˆ é™¤ $IGNITE_HOME/work/binary_meta/Nodexé‡Œé¢çš„æ–‡ä»¶</span><br></pre></td></tr></table></figure></li><li><p>å®˜æ–¹è¯´æ˜</p><blockquote><ul><li>You cannot change the types of existing fields.</li><li>You cannot change the order of enum values or add new constants at the beginning or in the middle of the list of enumâ€™s values. You can add new constants to the end of the list though.</li></ul></blockquote></li><li><p><strong>å¤„ç†conflict enum values, éœ€è¦æ¸…é™¤æ•°æ®</strong></p></li></ul><blockquote><p>éœ€è¦æ¸…ç† $IGNITE_HOME/work/dbç›®å½•ä¸‹çš„ binary_metaã€marshaller</p><p>éœ€è¦éªŒè¯æ˜¯å¦æ¸…ç† storagePathã€walPathã€walArchivePath</p></blockquote><h3 id="gc"><a href="#gc" class="headerlink" title="gc"></a>gc</h3><p><img src="/images/ignite/gc_collect.png"></p><blockquote><p>3sè¿›è¡Œgc  (110060-52672)/1024=56.04G</p></blockquote><p><img src="/images/ignite/gc_2.png"></p><blockquote><p>17sè¿›è¡Œgc (109952-52658)/1024=55.95G</p></blockquote><h3 id="IgniteCacheException"><a href="#IgniteCacheException" class="headerlink" title="IgniteCacheException"></a>IgniteCacheException</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ERROR org<span class="variable">.apache</span><span class="variable">.ignite</span><span class="variable">.spi</span><span class="variable">.communication</span><span class="variable">.tcp</span><span class="variable">.TcpCommunicationSpi</span>  [] - Failed to send message to remote node [node=ZookeeperClusterNode [id=<span class="number">1</span>c8a032d-<span class="number">042</span>e-<span class="number">4386</span>-<span class="number">9</span>ce8-<span class="number">2605</span>c0699304, addrs=[<span class="number">17</span><span class="variable">.9</span><span class="variable">.11</span><span class="variable">.11</span>], order=<span class="number">1</span>, loc=false, client=false], msg=GridIoMessage [plc=<span class="number">2</span>, topic=TOPIC_CACHE, topicOrd=<span class="number">8</span>, ordered=false, timeout=<span class="number">0</span>, skipOnTimeout=false, msg=GridNearLockRequest [topVer=AffinityTopologyVersion [topVer=<span class="number">358</span>, minorTopVer=<span class="number">0</span>], miniId=<span class="number">1</span>, dhtVers=GridCacheVersion[] [<span class="literal">null</span>], subjId=a5dbdc1d-e76e-<span class="number">49</span>c2-<span class="number">85</span>d7-ed7f1c7db7bd, taskNameHash=<span class="number">0</span>, createTtl=-<span class="number">1</span>, accessTtl=-<span class="number">1</span>, flags=<span class="number">3</span>, txLbl=<span class="literal">null</span>, filter=<span class="literal">null</span>, <span class="keyword">super</span>=GridDistributedLockRequest [nodeId=a5dbdc1d-e76e-<span class="number">49</span>c2-<span class="number">85</span>d7-ed7f1c7db7bd, nearXidVer=GridCacheVersion [topVer=<span class="number">245500806</span>, order=<span class="number">1638786801426</span>, nodeOrder=<span class="number">336</span>], threadId=<span class="number">11960694</span>, futId=<span class="number">96</span>c1bf42d71-<span class="number">90702925</span>-<span class="number">3</span>ef9-<span class="number">4</span>c70-b7a7-<span class="number">4</span>be2fb6d75ba, timeout=<span class="number">0</span>, isInTx=true, isInvalidate=false, isRead=true, isolation=REPEATABLE_READ, retVals=[true], txSize=<span class="number">0</span>, flags=<span class="number">0</span>, keysCnt=<span class="number">1</span>, <span class="keyword">super</span>=GridDistributedBaseMessage [ver=GridCacheVersion [topVer=<span class="number">245500806</span>, order=<span class="number">1638786801426</span>, nodeOrder=<span class="number">336</span>], committedVers=<span class="literal">null</span>, rolledbackVers=<span class="literal">null</span>, cnt=<span class="number">1</span>, <span class="keyword">super</span>=GridCacheIdMessage [cacheId=-<span class="number">182240380</span>, <span class="keyword">super</span>=GridCacheMessage [msgId=<span class="number">1360862</span>, depInfo=<span class="literal">null</span>, lastAffChangedTopVer=AffinityTopologyVersion [topVer=<span class="number">336</span>, minorTopVer=<span class="number">0</span>], err=<span class="literal">null</span>, skipPrepare=false]]]]]]]</span><br><span class="line"></span><br><span class="line">org<span class="variable">.apache</span><span class="variable">.ignite</span><span class="variable">.IgniteCheckedException</span>: Failed to connect to node due to unrecoverable exception (is node still alive?). Make sure that each ComputeTask <span class="keyword">and</span> cache Transaction has a timeout set in order to prevent parties from waiting <span class="keyword">forever</span> in <span class="keyword">case</span> of network issues [nodeId=d0a258e5-ec1b-<span class="number">4</span>f79-<span class="number">89</span>ad-<span class="number">80</span>c27708f895, addrs=[x/x<span class="variable">.x</span><span class="variable">.x</span><span class="variable">.x</span>:<span class="number">47100</span>], err= <span class="keyword">class</span> org<span class="variable">.apache</span><span class="variable">.ignite</span><span class="variable">.IgniteCheckedException</span>: Remote node does <span class="keyword">not</span> observe current node in topology : d0a258e5-ec1b-<span class="number">4</span>f79-<span class="number">89</span>ad-<span class="number">80</span>c27708f895]</span><br><span class="line"></span><br><span class="line">Caused by: org<span class="variable">.apache</span><span class="variable">.ignite</span><span class="variable">.IgniteCheckedException</span>: Remote node does <span class="keyword">not</span> observe current node in topology : d0a258e5-ec1b-<span class="number">4</span>f79-<span class="number">89</span>ad-<span class="number">80</span>c27708f895</span><br></pre></td></tr></table></figure><ul><li>gcçš„ç­–ç•¥</li><li>ignite clientçš„å¼‚å¸¸æ•è·</li><li></li></ul>]]></content>
      
      
      <categories>
          
          <category> ignite </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flink Memory Model</title>
      <link href="/2019/10/01/flink%20Memory%20Model/"/>
      <url>/2019/10/01/flink%20Memory%20Model/</url>
      
        <content type="html"><![CDATA[<h2 id="å†…å­˜æ¨¡å‹"><a href="#å†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜æ¨¡å‹"></a>å†…å­˜æ¨¡å‹</h2><h3 id="jobmanager"><a href="#jobmanager" class="headerlink" title="jobmanager"></a>jobmanager</h3><p><img src="/images/flink/jobmanager.jpg"></p><ul><li>JVM Heapå¤§å°è®¾ç½®å¯¹åº”é…ç½®æ–‡ä»¶<code>flink-conf.yaml</code>çš„<strong>jobmanager.heap.size</strong></li></ul><h3 id="taskmanager"><a href="#taskmanager" class="headerlink" title="taskmanager"></a>taskmanager</h3><p><img src="/images/flink/taskmanager.jpg"></p><ul><li>Total Flink Memoryå¯¹åº”<code>flink-conf.yaml</code>çš„<strong>taskmanager.memory.flink.size</strong></li><li>JVM Metaspaceå¯¹åº”<code>flink-conf.yaml</code>çš„<strong>taskmanager.memory.jvm-metaspace.size</strong></li><li>Total Process Memoryå¯¹åº”<code>flink-conf.yaml</code>çš„<strong>taskmanager.memory.process.size</strong></li></ul><h4 id="Flinkæ€»å†…å­˜ï¼ˆTotal-Flink-Memoryï¼‰"><a href="#Flinkæ€»å†…å­˜ï¼ˆTotal-Flink-Memoryï¼‰" class="headerlink" title="Flinkæ€»å†…å­˜ï¼ˆTotal Flink Memoryï¼‰"></a>Flinkæ€»å†…å­˜ï¼ˆTotal Flink Memoryï¼‰</h4><ul><li><p><strong>å«ä¹‰</strong><br>TaskManagerè¿›ç¨‹å ç”¨çš„æ‰€æœ‰ä¸Flinkç›¸å…³çš„å†…å­˜ï¼ˆä¸åŒ…æ‹¬JVMå…ƒç©ºé—´å’Œå…¶ä»–é¢å¤–å¼€é”€ï¼‰ã€‚å…·ä½“åŒ…å«4å¤§å—ï¼šFlinkæ¡†æ¶å†…å­˜ï¼ˆå †å†…ã€å †å¤–ï¼‰ã€æ‰˜ç®¡å†…å­˜ï¼ˆä»…å †å¤–ï¼‰ã€ç½‘ç»œç¼“å­˜ï¼ˆä»…å †å¤–ï¼‰ã€ä»»åŠ¡å†…å­˜ï¼ˆå †å†…ã€å †å¤–ï¼‰ã€‚</p></li><li><p><strong>å‚æ•°</strong><br><code>taskmanager.memory.flink.size</code>ï¼šæ— é»˜è®¤å€¼ï¼Œéœ€è¦ç”¨æˆ·æŒ‡å®šã€‚</p></li></ul><h4 id="Flinkæ¡†æ¶ï¼ˆFrameworkï¼‰å†…å­˜"><a href="#Flinkæ¡†æ¶ï¼ˆFrameworkï¼‰å†…å­˜" class="headerlink" title="Flinkæ¡†æ¶ï¼ˆFrameworkï¼‰å†…å­˜"></a>Flinkæ¡†æ¶ï¼ˆFrameworkï¼‰å†…å­˜</h4><ul><li><p>å«ä¹‰<br>Flink Runtimeåº•å±‚å ç”¨çš„å†…å­˜ï¼Œä¸€èˆ¬æ¥è®²ç›¸å¯¹å›ºå®šï¼Œä¸éœ€è¦æ›´æ”¹ã€‚æç‰¹æ®Šæƒ…å†µä¸‹æ‰éœ€è¦è°ƒå¤§ä¸€äº›ï¼Œæ¯”å¦‚éå¸¸é«˜çš„ç®—å­å¹¶è¡Œåº¦ï¼Œæˆ–è€…ä¸å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚Hadoopï¼‰æœ‰å¯†é›†äº¤äº’ç­‰ç­‰ã€‚</p></li><li><p>å‚æ•°</p><p><code>taskmanager.memory.framework.heap.size</code>ï¼šå †å†…éƒ¨åˆ†ï¼ˆFramework Heapï¼‰ï¼Œé»˜è®¤å€¼128MBï¼›</p><p><code>taskmanager.memory.framework.off-heap.size</code>ï¼šå †å¤–éƒ¨åˆ†ï¼ˆFramework Off-Heapï¼‰ï¼Œä»¥ç›´æ¥å†…å­˜å½¢å¼åˆ†é…ï¼Œé»˜è®¤å€¼128MBã€‚</p></li></ul><h4 id="æ‰˜ç®¡ï¼ˆManagedï¼‰å†…å­˜"><a href="#æ‰˜ç®¡ï¼ˆManagedï¼‰å†…å­˜" class="headerlink" title="æ‰˜ç®¡ï¼ˆManagedï¼‰å†…å­˜"></a>æ‰˜ç®¡ï¼ˆManagedï¼‰å†…å­˜</h4><ul><li><p>å«ä¹‰<br>çº¯å †å¤–å†…å­˜ï¼Œç”±MemoryManagerç®¡ç†ï¼Œç”¨äºä¸­é—´ç»“æœç¼“å­˜ã€æ’åºã€å“ˆå¸Œè¡¨ç­‰ï¼Œä»¥åŠRocksDBçŠ¶æ€åç«¯ã€‚å¯è§ï¼ŒRocksDBæ¶ˆè€—çš„å†…å­˜å¯ä»¥ç”±ç”¨æˆ·æ˜¾å¼æ§åˆ¶äº†ï¼Œä¸å†åƒæ—§ç‰ˆæœ¬ä¸€æ ·éš¾ä»¥é¢„æµ‹å’Œè°ƒèŠ‚ã€‚</p></li><li><p>å‚æ•°</p><p><code>taskmanager.memory.managed.fraction</code>ï¼šæ‰˜ç®¡å†…å­˜å Flinkæ€»å†…å­˜<code>taskmanager.memory.flink.sizeçš„æ¯”ä¾‹</code>ï¼Œé»˜è®¤å€¼0.4ï¼›<code>taskmanager.memory.managed.size</code>ï¼šæ‰˜ç®¡å†…å­˜çš„å¤§å°ï¼Œæ— é»˜è®¤å€¼ï¼Œä¸€èˆ¬ä¹Ÿä¸æŒ‡å®šï¼Œè€Œæ˜¯ä¾ç…§ä¸Šè¿°æ¯”ä¾‹æ¥æ¨å®šï¼Œæ›´åŠ çµæ´»ã€‚</p></li></ul><h4 id="ç½‘ç»œï¼ˆNetworkï¼‰ç¼“å­˜"><a href="#ç½‘ç»œï¼ˆNetworkï¼‰ç¼“å­˜" class="headerlink" title="ç½‘ç»œï¼ˆNetworkï¼‰ç¼“å­˜"></a>ç½‘ç»œï¼ˆNetworkï¼‰ç¼“å­˜</h4><ul><li><p>å«ä¹‰<br>çº¯å †å¤–å†…å­˜ï¼Œç”¨äºTaskManagerä¹‹é—´ï¼ˆshuffleã€å¹¿æ’­ç­‰ï¼‰åŠä¸å¤–éƒ¨ç»„ä»¶çš„æ•°æ®ä¼ è¾“ï¼Œä»¥ç›´æ¥å†…å­˜å½¢å¼åˆ†é…ã€‚</p></li><li><p>å‚æ•°</p><p><code>taskmanager.memory.network.min</code>ï¼šç½‘ç»œç¼“å­˜çš„æœ€å°å€¼ï¼Œé»˜è®¤64MBï¼›<code>taskmanager.memory.network.max</code>ï¼šç½‘ç»œç¼“å­˜çš„æœ€å¤§å€¼ï¼Œé»˜è®¤1GBï¼›<code>taskmanager.memory.network.fraction</code>ï¼šç½‘ç»œç¼“å­˜å Flinkæ€»å†…å­˜<code>taskmanager.memory.flink.size</code>çš„æ¯”ä¾‹ï¼Œé»˜è®¤å€¼0.1ã€‚è‹¥æ ¹æ®æ­¤æ¯”ä¾‹ç®—å‡ºçš„å†…å­˜é‡æ¯”æœ€å°å€¼å°æˆ–æ¯”æœ€å¤§å€¼å¤§ï¼Œå°±ä¼šé™åˆ¶åˆ°æœ€å°å€¼æˆ–è€…æœ€å¤§å€¼ã€‚</p></li></ul><h4 id="ä»»åŠ¡ï¼ˆTaskï¼‰å†…å­˜"><a href="#ä»»åŠ¡ï¼ˆTaskï¼‰å†…å­˜" class="headerlink" title="ä»»åŠ¡ï¼ˆTaskï¼‰å†…å­˜"></a>ä»»åŠ¡ï¼ˆTaskï¼‰å†…å­˜</h4><ul><li><p>å«ä¹‰<br>é¡¾åæ€ä¹‰ï¼Œæ˜¯ç®—å­é€»è¾‘å’Œç”¨æˆ·ä»£ç ã€è‡ªå®šä¹‰æ•°æ®ç»“æ„çœŸæ­£å ç”¨çš„å†…å­˜ã€‚</p></li><li><p>å‚æ•°</p><p><code>taskmanager.memory.task.heap.size</code>ï¼šå †å†…éƒ¨åˆ†ï¼ˆTask Heapï¼‰ï¼Œæ— é»˜è®¤å€¼ï¼Œä¸€èˆ¬ä¸å»ºè®®è®¾ç½®ï¼Œä¼šè‡ªåŠ¨ç”¨Flinkæ€»å†…å­˜å‡å»æ¡†æ¶ã€æ‰˜ç®¡ã€ç½‘ç»œä¸‰éƒ¨åˆ†çš„å†…å­˜æ¨ç®—å¾—å‡ºã€‚<code>taskmanager.memory.task.off-heap.size</code>ï¼šå †å¤–éƒ¨åˆ†ï¼ˆTask Off-Heapï¼‰ï¼Œä»¥ç›´æ¥å†…å­˜å½¢å¼åˆ†é…ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå³ä¸ä½¿ç”¨ã€‚</p></li></ul><h5 id="TaskManagerè¿›ç¨‹æ€»å†…å­˜ï¼ˆTotal-Process-Memoryï¼‰"><a href="#TaskManagerè¿›ç¨‹æ€»å†…å­˜ï¼ˆTotal-Process-Memoryï¼‰" class="headerlink" title="TaskManagerè¿›ç¨‹æ€»å†…å­˜ï¼ˆTotal Process Memoryï¼‰"></a>TaskManagerè¿›ç¨‹æ€»å†…å­˜ï¼ˆTotal Process Memoryï¼‰</h5><ul><li><p><strong>å«ä¹‰</strong><br>åœ¨å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆon YARN/K8s/Mesosï¼‰ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œæ˜¯Flinkæ€»å†…å­˜ã€JVMå…ƒç©ºé—´ä¸JVMé¢å¤–å†…å­˜å¼€é”€çš„å’Œï¼Œä¹Ÿå°±æ˜¯å®¹å™¨æœ¬èº«çš„å†…å­˜å¤§å°ã€‚</p></li><li><p><strong>å‚æ•°</strong><br><code>taskmanager.memory.process.size</code>ï¼šæ— é»˜è®¤å€¼ï¼Œéœ€è¦ç”¨æˆ·æŒ‡å®šã€‚</p></li></ul><h5 id="JVMå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰"><a href="#JVMå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰" class="headerlink" title="JVMå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰"></a>JVMå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</h5><ul><li><p><strong>å«ä¹‰</strong><br>å­˜æ”¾å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œå³ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç </strong></p></li><li><p><strong>å‚æ•°</strong><br><code>taskmanager.memory.jvm-metaspace.size</code>ï¼šé»˜è®¤å€¼256MBã€‚</p></li></ul><h4 id="JVMé¢å¤–å¼€é”€ï¼ˆOverheadï¼‰"><a href="#JVMé¢å¤–å¼€é”€ï¼ˆOverheadï¼‰" class="headerlink" title="JVMé¢å¤–å¼€é”€ï¼ˆOverheadï¼‰"></a>JVMé¢å¤–å¼€é”€ï¼ˆOverheadï¼‰</h4><ul><li><p>å«ä¹‰<br>ä¸ºJVMé¢„ç•™çš„å…¶ä»–æœ¬åœ°å†…å­˜ï¼Œç”¨äºçº¿ç¨‹æ ˆã€ä»£ç ç¼“å­˜ç­‰ï¼Œä½œç”¨æœ‰äº›ç±»ä¼¼äºä¹‹å‰ç‰ˆæœ¬ä¸­ä¸ºå®¹å™¨é¢„ç•™çš„æˆªæ–­ï¼ˆcutoffï¼‰å†…å­˜ã€‚å½“ç„¶åœ¨1.10ç‰ˆæœ¬ä¸­ï¼ŒåŸå…ˆçš„containerized.heap-cutoff-ratioä¸containerized.heap-cutoff-minå‚æ•°å¯¹TMå°±ä¸å†ç”Ÿæ•ˆäº†ã€‚</p></li><li><p>å‚æ•°</p><p><code>taskmanager.memory.jvm-overhead.min</code>ï¼šJVMé¢å¤–å¼€é”€çš„æœ€å°å€¼ï¼Œé»˜è®¤192MBï¼›<code>taskmanager.memory.jvm-overhead.max</code>ï¼šJVMé¢å¤–å¼€é”€çš„æœ€å¤§å€¼ï¼Œé»˜è®¤1GBï¼›<code>taskmanager.memory.jvm-overhead.fraction</code>ï¼šJVMé¢å¤–å¼€é”€å TMè¿›ç¨‹æ€»å†…å­˜<code>taskmanager.memory.process.size</code>ï¼ˆæ³¨æ„ä¸æ˜¯Flinkæ€»å†…å­˜ï¼‰çš„æ¯”ä¾‹ï¼Œé»˜è®¤å€¼0.1ã€‚è‹¥æ ¹æ®æ­¤æ¯”ä¾‹ç®—å‡ºçš„å†…å­˜é‡æ¯”æœ€å°å€¼å°æˆ–æ¯”æœ€å¤§å€¼å¤§ï¼Œå°±ä¼šé™åˆ¶åˆ°æœ€å°å€¼æˆ–è€…æœ€å¤§å€¼ã€‚</p></li></ul><h3 id="Flinkå†…å­˜å‚æ•°ä¸JVMå‚æ•°çš„å…³ç³»"><a href="#Flinkå†…å­˜å‚æ•°ä¸JVMå‚æ•°çš„å…³ç³»" class="headerlink" title="Flinkå†…å­˜å‚æ•°ä¸JVMå‚æ•°çš„å…³ç³»"></a>Flinkå†…å­˜å‚æ•°ä¸JVMå‚æ•°çš„å…³ç³»</h3><p>ä¸Šè¿°å†…å­˜å‚æ•°ä¼šç›´æ¥å½±å“å¯åŠ¨TaskManageræ—¶ä½¿ç”¨çš„JVMå‚æ•°ï¼Œä½¿ç”¨ç›¸å…³å·¥å…·å¯ä»¥è§‚å¯Ÿåˆ°ã€‚</p><ul><li><p><code>-Xmx</code>/<code>-Xms</code>ï¼šå¯¹åº”å †å†…æ¡†æ¶å†…å­˜ä¸ä»»åŠ¡å†…å­˜ä¹‹å’Œï¼›</p></li><li><p><code>-XX:MaxDirectMemorySize</code>ï¼šå¯¹åº”ä¸‰å—ç›´æ¥å†…å­˜ï¼Œå³å †å¤–æ¡†æ¶å†…å­˜ã€ä»»åŠ¡å†…å­˜ä¸ç½‘ç»œç¼“å­˜ä¹‹å’Œï¼›</p></li><li><p><code>-XX:MaxMetaspaceSize</code>ï¼šå¯¹åº”JVMå…ƒç©ºé—´è®¾ç½®ã€‚</p></li></ul><h2 id="é…ç½®ä¼˜åŒ–"><a href="#é…ç½®ä¼˜åŒ–" class="headerlink" title="é…ç½®ä¼˜åŒ–"></a>é…ç½®ä¼˜åŒ–</h2><ul><li><strong>èŠ‚ç‚¹å¹³å‡åˆ†é…</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.evenly-spread-out-slots:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ul><hr><p>reference</p><p><a href="https://blog.51cto.com/u_14222592/2892910">Flink 1.10ä¹‹æ”¹è¿›çš„TaskManagerå†…å­˜æ¨¡å‹ä¸é…ç½®ã€é™„æºç ã€‘_wx5c7a97e3804fd_51CTOåšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> flink </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript&#39;s this</title>
      <link href="/2019/08/14/javascript&#39;s%20this/"/>
      <url>/2019/08/14/javascript&#39;s%20this/</url>
      
        <content type="html"><![CDATA[<p>æ–‡å­—è½¬è½½è‡ª<a href="https://juejin.im/post/5d51feaef265da039005219e#heading-5">JS ä¸­ this åœ¨å„ä¸ªåœºæ™¯ä¸‹çš„æŒ‡å‘</a></p><h2 id="1-this-çš„å¥¥ç§˜"><a href="#1-this-çš„å¥¥ç§˜" class="headerlink" title="1. this çš„å¥¥ç§˜"></a>1. this çš„å¥¥ç§˜</h2><p>å¾ˆå¤šæ—¶å€™, JS ä¸­çš„ <code>this</code> å¯¹äºå’±ä»¬çš„åˆå­¦è€…å¾ˆå®¹æ˜“äº§ç”Ÿå›°æƒ‘ä¸è§£ã€‚ <code>this</code> çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä½†éœ€è¦ä¸€å®šä»˜å‡ºæ‰èƒ½æ…¢æ…¢ç†è§£å®ƒã€‚</p><p>å¯¹Javaã€PHPæˆ–å…¶ä»–æ ‡å‡†è¯­è¨€æ¥çœ‹ï¼Œ<code>this</code> è¡¨ç¤ºç±»æ–¹æ³•ä¸­å½“å‰å¯¹è±¡çš„å®ä¾‹ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>this</code>ä¸èƒ½åœ¨æ–¹æ³•ä¹‹å¤–ä½¿ç”¨ï¼Œè¿™æ ·å°±æ¯”è¾ƒä¸ä¼šé€ æˆæ··æ·†ã€‚</p><p>åœ¨Jè¦ä¸­æƒ…å†µå°±æœ‰æ‰€ä¸åŒ: <code>this</code>è¡¨ç¤ºå‡½æ•°çš„å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ŒJS ä¸­å‡½æ•°è°ƒç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ul><li>å‡½æ•°è°ƒç”¨: <code>alert(&#39;Hello World!&#39;)</code></li><li>æ–¹æ³•è°ƒç”¨: <code>console.log(&#39;Hello World!&#39;)</code></li><li>æ„é€ å‡½æ•°: <code>new RegExp(&#39;\\d&#39;)</code></li><li>éšå¼è°ƒç”¨: <code>alert.call(undefined, &#39;Hello World!&#39;)</code></li></ul><p>æ¯ç§è°ƒç”¨ç±»å‹ä»¥è‡ªå·±çš„æ–¹å¼å®šä¹‰ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥å°±å¾ˆå®¹æ˜“äº§ç”Ÿæ··æ·†ã€‚</p><p>æ­¤å¤–ï¼Œä¸¥æ ¼æ¨¡å¼ä¹Ÿä¼šå½±å“æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><p>ç†è§£<code>this</code>å…³é”®æ˜¯è¦æ¸…æ¥šçš„çŸ¥é“å‡½æ•°è°ƒç”¨åŠå…¶å¦‚ä½•å½±å“ä¸Šä¸‹æ–‡ã€‚</p><p>æœ¬æ–‡ä¸»è¦è¯´æ˜å‡½æ•°çš„è°ƒç”¨æ–¹å¼åŠå¦‚ä½•å½±å“ <code>this</code>ï¼Œå¹¶ä¸”è¯´æ˜æ‰§è¡Œä¸Šä¸‹æ–‡çš„å¸¸è§é™·é˜±ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆçŸ¥é“å‡ ä¸ªæœ¯è¯­ï¼š</p><p>è°ƒç”¨å‡½æ•°æ­£åœ¨æ‰§è¡Œåˆ›å»ºå‡½æ•°ä½“çš„ä»£ç ï¼Œæˆ–è€…åªæ˜¯è°ƒç”¨å‡½æ•°ã€‚ ä¾‹å¦‚ï¼ŒparseIntå‡½æ•°è°ƒç”¨æ˜¯parseIntï¼ˆâ€™15â€™ï¼‰ã€‚</p><ul><li><strong>å‡½æ•°è°ƒç”¨</strong>ï¼šæ‰§è¡Œæ„æˆå‡½æ•°ä¸»ä½“çš„ä»£ç ï¼šä¾‹å¦‚ï¼Œ<code>parseInt</code>å‡½æ•°è°ƒç”¨æ˜¯<code>parseInt(&#39;15&#39;)</code>ã€‚</li><li><strong>è°ƒç”¨çš„ä¸Šä¸‹æ–‡</strong>ï¼šæŒ‡ <code>this</code> åœ¨å‡½æ•°ä½“å†…çš„å€¼ã€‚ ä¾‹å¦‚ï¼Œ<code>map.set(&#39;key&#39;, &#39;value&#39;)</code>çš„è°ƒç”¨ä¸Šä¸‹æ–‡æ˜¯ <code>map</code>ã€‚</li><li><strong>å‡½æ•°çš„ä½œç”¨åŸŸ</strong>ï¼šæ˜¯åœ¨å‡½æ•°ä½“ä¸­å¯è®¿é—®çš„å˜é‡ã€å¯¹è±¡å’Œå‡½æ•°çš„é›†åˆã€‚</li></ul><h2 id="2-å‡½æ•°è°ƒç”¨"><a href="#2-å‡½æ•°è°ƒç”¨" class="headerlink" title="2.å‡½æ•°è°ƒç”¨"></a>2.å‡½æ•°è°ƒç”¨</h2><p>å½“ä¸€ä¸ªè¡¨è¾¾å¼ä¸ºå‡½æ•°æ¥ç€ä¸€ä¸ª<code>(</code>ï¼Œä¸€äº›ç”¨é€—å·åˆ†éš”çš„å‚æ•°ä»¥åŠä¸€ä¸ª<code>ï¼‰</code>æ—¶ï¼Œå‡½æ•°è°ƒç”¨è¢«æ‰§è¡Œï¼Œä¾‹å¦‚<code>parseInt(&#39;18&#39;)</code>ã€‚</p><p>å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼ä¸èƒ½æ˜¯å±æ€§æ–¹å¼çš„è°ƒç”¨ï¼Œå¦‚ <code>obj.myFunc()</code>ï¼Œè¿™ç§æ˜¯åˆ›å»ºä¸€ä¸ªæ–¹æ³•è°ƒç”¨ã€‚å†å¦‚ <code>[1,5].join(&#39;,&#39;)</code>ä¸æ˜¯å‡½æ•°è°ƒç”¨ï¼Œè€Œæ˜¯æ–¹æ³•è°ƒç”¨ï¼Œ<strong>è¿™ç§åŒºåˆ«éœ€è¦è®°ä½å“ˆï¼Œå¾ˆé‡è¦æ»´</strong>ã€‚</p><p>å‡½æ•°è°ƒç”¨çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function hello(name) &#123;</span><br><span class="line">  return &#x27;Hello &#x27; + name + &#x27;!&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">// å‡½æ•°è°ƒç”¨</span><br><span class="line">const message = hello(&#x27;World&#x27;);</span><br><span class="line">console.log(message); // =&gt; &#x27;Hello World!&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>hello(&#39;World&#39;)</code>æ˜¯å‡½æ•°è°ƒç”¨: <code>hello</code>è¡¨è¾¾å¼ç­‰ä»·äºä¸€ä¸ªå‡½æ•°ï¼Œè·Ÿåœ¨å®ƒåé¢çš„æ˜¯ä¸€å¯¹æ‹¬å·ä»¥åŠ<code>&#39;World&#39;</code>å‚æ•°ã€‚</p><p>ä¸€ä¸ªæ›´é«˜çº§çš„ä¾‹å­æ˜¯<strong>IIFE</strong>(ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const message = (function(name) &#123;</span><br><span class="line">   return &#x27;Hello &#x27; + name + &#x27;!&#x27;;</span><br><span class="line">&#125;)(&#x27;World&#x27;);</span><br><span class="line">console.log(message) // =&gt; &#x27;Hello World!&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><strong>IIFE</strong>ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨:ç¬¬ä¸€å¯¹åœ†æ‹¬å·<code>(function(name) &#123;...&#125;)</code>æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒçš„è®¡ç®—ç»“æœæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œåé¢è·Ÿç€ä¸€å¯¹åœ†æ‹¬å·ï¼Œåœ†æ‹¬å·çš„å‚æ•°æ˜¯<code>â€œWorldâ€</code>ã€‚</p><h4 id="2-1-åœ¨å‡½æ•°è°ƒç”¨ä¸­çš„this"><a href="#2-1-åœ¨å‡½æ•°è°ƒç”¨ä¸­çš„this" class="headerlink" title="2.1. åœ¨å‡½æ•°è°ƒç”¨ä¸­çš„this"></a>2.1. åœ¨å‡½æ•°è°ƒç”¨ä¸­çš„this</h4><blockquote><p>this åœ¨å‡½æ•°è°ƒç”¨ä¸­æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡</p></blockquote><p>å±€å¯¹è±¡ç”±æ‰§è¡Œç¯å¢ƒå†³å®šã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œ<code>this</code>æ˜¯ <code>window</code> å¯¹è±¡ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884b811a409ab?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>åœ¨å‡½æ•°è°ƒç”¨ä¸­ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯å…¨å±€å¯¹è±¡ã€‚</p><p>å†æ¥çœ‹çœ‹ä¸‹é¢å‡½æ•°ä¸­çš„ä¸Šä¸‹æ–‡åˆæ˜¯ä»€ä¹ˆé¬¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function sum(a, b) &#123;</span><br><span class="line">   console.log(this === window); // =&gt; true</span><br><span class="line">   this.myNumber = 20; // å°†&#x27;myNumber&#x27;å±æ€§æ·»åŠ åˆ°å…¨å±€å¯¹è±¡</span><br><span class="line">   return a + b;</span><br><span class="line">&#125;</span><br><span class="line">// sum() is invoked as a function</span><br><span class="line">// sum() ä¸­çš„ `this` æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆwindowï¼‰</span><br><span class="line">sum(15, 16);     // =&gt; 31</span><br><span class="line">window.myNumber; // =&gt; 20</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨<code>sum(15,16)</code>æ—¶ï¼ŒJS è‡ªåŠ¨å°†<code>this</code>è®¾ç½®ä¸ºå…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­è¯¥å¯¹è±¡æ˜¯<code>window</code>ã€‚</p><p>å½“<code>this</code>åœ¨ä»»ä½•å‡½æ•°ä½œç”¨åŸŸ(æœ€é¡¶å±‚ä½œç”¨åŸŸ:å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡)ä¹‹å¤–ä½¿ç”¨ï¼Œ<code>this</code> è¡¨ç¤º <code>window</code> å¯¹è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">console.log(this === window); // =&gt; true</span><br><span class="line">this.myString = &#x27;Hello World!&#x27;;</span><br><span class="line">console.log(window.myString); // =&gt; &#x27;Hello World!&#x27;</span><br><span class="line"></span><br><span class="line">&lt;!-- In an html file --&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">   console.log(this === window); // =&gt; true</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h4 id="2-2-ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å‡½æ•°è°ƒç”¨-this-åˆæ˜¯ä»€ä¹ˆæ ·çš„"><a href="#2-2-ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å‡½æ•°è°ƒç”¨-this-åˆæ˜¯ä»€ä¹ˆæ ·çš„" class="headerlink" title="2.2 ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å‡½æ•°è°ƒç”¨ this åˆæ˜¯ä»€ä¹ˆæ ·çš„"></a>2.2 ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å‡½æ•°è°ƒç”¨ this åˆæ˜¯ä»€ä¹ˆæ ·çš„</h4><blockquote><p><code>this</code> åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å‡½æ•°è°ƒç”¨ä¸­ä¸º <strong>undefined</strong></p></blockquote><p>ä¸¥æ ¼æ¨¡å¼æ˜¯åœ¨ ECMAScript 5.1ä¸­å¼•å…¥çš„ï¼Œå®ƒæä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§å’Œæ›´å¼ºçš„é”™è¯¯æ£€æŸ¥ã€‚</p><p>è¦å¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œå‡½æ•°å¤´éƒ¨å†™å…¥<code>use strict</code> å³å¯ã€‚</p><p>å¯ç”¨åï¼Œä¸¥æ ¼æ¨¡å¼ä¼šå½±å“æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œ<code>this</code> åœ¨å¸¸è§„å‡½æ•°è°ƒç”¨ä¸­å€¼ä¸º<code>undefined</code>ã€‚ ä¸ä¸Šè¿°æƒ…å†µ<code>2.1</code>ç›¸åï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡ä¸å†æ˜¯å…¨å±€å¯¹è±¡ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884ceb97a4874?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>ä¸¥æ ¼æ¨¡å¼å‡½æ•°è°ƒç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function multiply(a, b) &#123;</span><br><span class="line">  &#x27;use strict&#x27;; // å¯ç”¨ä¸¥æ ¼æ¨¡å¼</span><br><span class="line">  console.log(this === undefined); // =&gt; true</span><br><span class="line">  return a * b;</span><br><span class="line">&#125;</span><br><span class="line">multiply(2, 5); // =&gt; 10</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å½“<code>multiply(2,5)</code>ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œ<code>this</code>æ˜¯<code>undefined</code>ã€‚</p><p>ä¸¥æ ¼æ¨¡å¼ä¸ä»…åœ¨å½“å‰ä½œç”¨åŸŸä¸­æœ‰æ•ˆï¼Œåœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­ä¹Ÿæ˜¯æœ‰æ•ˆçš„(å¯¹äºåœ¨å†…éƒ¨å£°æ˜çš„æ‰€æœ‰å‡½æ•°):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function execute() &#123;</span><br><span class="line">   &#x27;use strict&#x27;; // å¼€å¯ä¸¥æ ¼æ¨¡å¼  </span><br><span class="line">   function concat(str1, str2) &#123;</span><br><span class="line">     // ä¸¥æ ¼æ¨¡å¼ä»ç„¶æœ‰æ•ˆ  </span><br><span class="line">     console.log(this === undefined); // =&gt; true</span><br><span class="line">     return str1 + str2;</span><br><span class="line">   &#125;</span><br><span class="line">   // concat() åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä½œä¸ºå‡½æ•°è°ƒç”¨</span><br><span class="line">   // this in concat() is undefined</span><br><span class="line">   concat(&#x27;Hello&#x27;, &#x27; World!&#x27;); // =&gt; &quot;Hello World!&quot;</span><br><span class="line">&#125;</span><br><span class="line">execute();</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>&#39;use strict&#39;</code>è¢«æ’å…¥åˆ°æ‰§è¡Œä½“çš„é¡¶éƒ¨ï¼Œåœ¨å…¶ä½œç”¨åŸŸå†…å¯ç”¨ä¸¥æ ¼æ¨¡å¼ã€‚ å› ä¸ºå‡½æ•°<code>concat</code>æ˜¯åœ¨æ‰§è¡Œçš„ä½œç”¨åŸŸä¸­å£°æ˜çš„ï¼Œæ‰€ä»¥å®ƒç»§æ‰¿äº†ä¸¥æ ¼æ¨¡å¼ã€‚</p><p>å•ä¸ªJSæ–‡ä»¶å¯èƒ½åŒ…å«ä¸¥æ ¼å’Œéä¸¥æ ¼æ¨¡å¼ã€‚ å› æ­¤ï¼Œå¯¹äºç›¸åŒçš„è°ƒç”¨ç±»å‹ï¼Œå¯ä»¥åœ¨å•ä¸ªè„šæœ¬ä¸­å…·æœ‰ä¸åŒçš„ä¸Šä¸‹æ–‡è¡Œä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function nonStrictSum(a, b) &#123;</span><br><span class="line">  // éä¸¥æ ¼æ¨¡å¼</span><br><span class="line">  console.log(this === window); // =&gt; true</span><br><span class="line">  return a + b;</span><br><span class="line">&#125;</span><br><span class="line">function strictSum(a, b) &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  // å¯ç”¨ä¸¥æ ¼æ¨¡å¼</span><br><span class="line">  console.log(this === undefined); // =&gt; true</span><br><span class="line">  return a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nonStrictSum(5, 6); // =&gt; 11</span><br><span class="line">strictSum(8, 12); // =&gt; 20</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h4 id="2-3-é™·é˜±-this-åœ¨å†…éƒ¨å‡½æ•°ä¸­çš„æ—¶å€™"><a href="#2-3-é™·é˜±-this-åœ¨å†…éƒ¨å‡½æ•°ä¸­çš„æ—¶å€™" class="headerlink" title="2.3 é™·é˜±:this åœ¨å†…éƒ¨å‡½æ•°ä¸­çš„æ—¶å€™"></a>2.3 é™·é˜±:<code>this</code> åœ¨å†…éƒ¨å‡½æ•°ä¸­çš„æ—¶å€™</h4><p>å‡½æ•°è°ƒç”¨çš„ä¸€ä¸ªå¸¸è§é™·é˜±æ˜¯ï¼Œè®¤ä¸º<code>this</code>åœ¨å†…éƒ¨å‡½æ•°ä¸­çš„æƒ…å†µä¸å¤–éƒ¨å‡½æ•°ä¸­çš„æƒ…å†µç›¸åŒã€‚</p><p>æ­£ç¡®åœ°è¯´ï¼Œå†…éƒ¨å‡½æ•°çš„ä¸Šä¸‹æ–‡åªä¾èµ–äºå®ƒçš„è°ƒç”¨ç±»å‹ï¼Œè€Œä¸ä¾èµ–äºå¤–éƒ¨å‡½æ•°çš„ä¸Šä¸‹æ–‡ã€‚</p><p>è¦å°† <code>this</code> è®¾ç½®ä¸ºæ‰€éœ€çš„å€¼ï¼Œå¯ä»¥é€šè¿‡ <code>.call()</code>æˆ–<code>.apply()</code>ä¿®æ”¹å†…éƒ¨å‡½æ•°çš„ä¸Šä¸‹æ–‡æˆ–ä½¿ç”¨<code>.bind()</code>åˆ›å»ºç»‘å®šå‡½æ•°ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­æ˜¯è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const numbers = &#123;</span><br><span class="line">   numberA: 5,</span><br><span class="line">   numberB: 10,</span><br><span class="line">   sum: function() &#123;</span><br><span class="line">     console.log(this === numbers); // =&gt; true</span><br><span class="line">     function calculate() &#123;</span><br><span class="line">       console.log(this === numbers); // =&gt; false</span><br><span class="line">       return this.numberA + this.numberB;</span><br><span class="line">     &#125;</span><br><span class="line">     return calculate();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line">numbers.sum(); // =&gt; NaN</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>sum()</code>æ˜¯å¯¹è±¡ä¸Šçš„æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥<code>sum</code>ä¸­çš„ä¸Šä¸‹æ–‡æ˜¯<code>numbers</code>å¯¹è±¡ã€‚<code>calculate</code>å‡½æ•°æ˜¯åœ¨<code>sum</code>ä¸­å®šä¹‰çš„ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨<code>calculate()</code>ä¸­<code>this</code>ä¹Ÿè¡¨ç¤º<code>number</code>å¯¹è±¡ã€‚</p><p><code>calculate()</code>æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨(ä¸æ˜¯æ–¹æ³•è°ƒç”¨)ï¼Œå®ƒå°†<code>this</code>ä½œä¸ºå…¨å±€å¯¹è±¡<code>window</code>(éä¸¥æ ¼æ¨¡ä¸‹)ã€‚å³ä½¿å¤–éƒ¨å‡½æ•°<code>sum</code>å°†ä¸Šä¸‹æ–‡ä½œä¸º<code>number</code>å¯¹è±¡ï¼Œå®ƒåœ¨<code>calculate</code>é‡Œé¢æ²¡æœ‰å½±å“ã€‚</p><p><code>sum()</code>çš„è°ƒç”¨ç»“æœæ˜¯<code>NaN</code>ï¼Œä¸æ˜¯é¢„æœŸçš„ç»“æœ<code>5 + 10 = 15</code>ï¼Œè¿™éƒ½æ˜¯å› ä¸ºæ²¡æœ‰æ­£ç¡®è°ƒç”¨<code>calculate</code>ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<code>calculate</code>å‡½æ•°ä¸­ä¸Šä¸‹æ–‡åº”è¯¥ä¸ <code>sum</code> ä¸­çš„ä¸€æ ·ï¼Œä»¥ä¾¿å¯ä»¥è®¿é—®<code>numberA</code>å’Œ<code>numberB</code>å±æ€§ã€‚</p><p>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡è°ƒç”¨<code>calculator.call(this)</code>æ‰‹åŠ¨å°†<code>calculate</code>ä¸Šä¸‹æ–‡æ›´æ”¹ä¸ºæ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const numbers = &#123;</span><br><span class="line">   numberA: 5,</span><br><span class="line">   numberB: 10,</span><br><span class="line">   sum: function() &#123;</span><br><span class="line">     console.log(this === numbers); // =&gt; true</span><br><span class="line">     function calculate() &#123;</span><br><span class="line">       console.log(this === numbers); // =&gt; true</span><br><span class="line">       return this.numberA + this.numberB;</span><br><span class="line">     &#125;</span><br><span class="line">     // ä½¿ç”¨ .call() æ–¹æ³•ä¿®æ”¹ä¸Šä¸‹æ–‡</span><br><span class="line">     return calculate.call(this);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line">numbers.sum(); // =&gt; 15</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>call(this)</code>åƒå¾€å¸¸ä¸€æ ·æ‰§è¡Œ<code>calculate</code>å‡½æ•°ï¼Œä½† <code>call</code> ä¼šæŠŠä¸Šä¸‹æ–‡ä¿®æ”¹ä¸ºæŒ‡å®šä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚</p><p>ç°åœ¨<code>this.numberA</code> + <code>this.numberB</code>ç›¸å½“äº<code>numbers.numberA + numbers.numberB</code>ã€‚ è¯¥å‡½æ•°è¿”å›é¢„æœŸç»“æœ<code>5 + 10 = 15</code>ã€‚</p><p>å¦ä¸€ç§å°±æ˜¯ä½¿ç”¨ç®­å¤´å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const numbers = &#123;</span><br><span class="line">   numberA: 5,</span><br><span class="line">   numberB: 10,</span><br><span class="line">   sum: function() &#123;</span><br><span class="line">     console.log(this === numbers); // =&gt; true</span><br><span class="line">     const calculate = () =&gt; &#123;</span><br><span class="line">       console.log(this === numbers); // =&gt; true</span><br><span class="line">       return this.numberA + this.numberB;</span><br><span class="line">     &#125;</span><br><span class="line">     return calculate();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line">numbers.sum(); // =&gt; 15</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h2 id="3-æ–¹æ³•è°ƒç”¨"><a href="#3-æ–¹æ³•è°ƒç”¨" class="headerlink" title="3.æ–¹æ³•è°ƒç”¨"></a>3.æ–¹æ³•è°ƒç”¨</h2><p>æ–¹æ³•æ˜¯å­˜å‚¨åœ¨å¯¹è±¡å±æ€§ä¸­çš„å‡½æ•°ã€‚ä¾‹å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const myObject = &#123;</span><br><span class="line">  // helloFunction æ˜¯ä¸€ä¸ªæ–¹æ³•</span><br><span class="line">  helloFunction: function() &#123;</span><br><span class="line">    return &#x27;Hello World!&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">const message = myObject.helloFunction();</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>helloFunction</code>æ˜¯<code>myObject</code>çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¦è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¯ä»¥è¿™æ ·å­è°ƒç”¨ :<code>myObject.helloFunction</code>ã€‚</p><p>å½“ä¸€ä¸ªè¡¨è¾¾å¼ä»¥å±æ€§è®¿é—®çš„å½¢å¼æ‰§è¡Œæ—¶ï¼Œæ‰§è¡Œçš„æ˜¯æ–¹æ³•è°ƒç”¨ï¼Œå®ƒç›¸å½“äºä»¥ä¸ªå‡½æ•°æ¥ç€(ï¼Œä¸€ç»„ç”¨é€—å·åˆ†éš”çš„å‚æ•°ä»¥åŠ)ã€‚</p><p>åˆ©ç”¨å‰é¢çš„ä¾‹å­ï¼Œ<code>myObject.helloFunction()</code>æ˜¯å¯¹è±¡<code>myObject</code>ä¸Šçš„ä¸€ä¸ª<code>helloFunction</code>çš„æ–¹æ³•è°ƒç”¨ã€‚<code>[1, 2].join(&#39;,&#39;)</code> æˆ–<code>/\s/.test(&#39;beautiful world&#39;)</code>ä¹Ÿè¢«è®¤ä¸ºæ˜¯æ–¹æ³•è°ƒç”¨ã€‚</p><p>åŒºåˆ†å‡½æ•°è°ƒç”¨å’Œæ–¹æ³•è°ƒç”¨éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„ç±»å‹ã€‚ä¸»è¦åŒºåˆ«åœ¨äºæ–¹æ³•è°ƒç”¨éœ€è¦ä¸€ä¸ªå±æ€§è®¿é—®å™¨å½¢å¼æ¥è°ƒç”¨å‡½æ•°(<code>obj.myFunc()</code>æˆ–<code>obj[&#39;myFunc&#39;]()</code>)ï¼Œè€Œå‡½æ•°è°ƒç”¨ä¸éœ€è¦(<code>myFunc()</code>)ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;Hello&#x27;, &#x27;World&#x27;].join(&#x27;, &#x27;); // æ–¹æ³•è°ƒç”¨</span><br><span class="line">(&#123; ten: function() &#123; return 10; &#125; &#125;).ten(); // æ–¹æ³•è°ƒç”¨</span><br><span class="line">const obj = &#123;&#125;;</span><br><span class="line">obj.myFunction = function() &#123;</span><br><span class="line">  return new Date().toString();</span><br><span class="line">&#125;;</span><br><span class="line">obj.myFunction(); // æ–¹æ³•è°ƒç”¨</span><br><span class="line"></span><br><span class="line">const otherFunction = obj.myFunction;</span><br><span class="line">otherFunction();     // å‡½æ•°è°ƒç”¨</span><br><span class="line">parseFloat(&#x27;16.60&#x27;); // å‡½æ•°è°ƒç”¨</span><br><span class="line">isNaN(0);            // å‡½æ•°è°ƒç”¨</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç†è§£å‡½æ•°è°ƒç”¨å’Œæ–¹æ³•è°ƒç”¨ä¹‹é—´çš„åŒºåˆ«æœ‰åŠ©äºæ­£ç¡®è¯†åˆ«ä¸Šä¸‹æ–‡ã€‚</p><h4 id="3-1-æ–¹æ³•è°ƒç”¨ä¸­-this-æ˜¯è‚¿ä¹ˆæ ·"><a href="#3-1-æ–¹æ³•è°ƒç”¨ä¸­-this-æ˜¯è‚¿ä¹ˆæ ·" class="headerlink" title="3.1 æ–¹æ³•è°ƒç”¨ä¸­ this æ˜¯è‚¿ä¹ˆæ ·"></a>3.1 æ–¹æ³•è°ƒç”¨ä¸­ this æ˜¯è‚¿ä¹ˆæ ·</h4><blockquote><p>åœ¨æ–¹æ³•è°ƒç”¨ä¸­ï¼Œ<code>this</code>æ˜¯æ‹¥æœ‰è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡</p></blockquote><p>å½“è°ƒç”¨å¯¹è±¡ä¸Šçš„æ–¹æ³•æ—¶ï¼Œ<code>this</code>å°±å˜æˆäº†å¯¹è±¡æœ¬èº«ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884d308092da0?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ‰ä¸€ä¸ªé€’å¢æ•°å­—çš„æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const calc = &#123;</span><br><span class="line">  num: 0,</span><br><span class="line">  increment: function() &#123;</span><br><span class="line">    console.log(this === calc); // =&gt; true</span><br><span class="line">    this.num += 1;</span><br><span class="line">    return this.num;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">// method invocation. this is calc</span><br><span class="line">calc.increment(); // =&gt; 1</span><br><span class="line">calc.increment(); // =&gt; 2</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è°ƒç”¨<code>calc.increment()</code>ä½¿<code>increment</code>å‡½æ•°çš„ä¸Šä¸‹æ–‡æˆä¸º<code>calc</code>å¯¹è±¡ã€‚æ‰€ä»¥ä½¿ç”¨<code>this.num</code>æ¥å¢åŠ <code>num</code>å±æ€§æ˜¯æœ‰æ•ˆçš„ã€‚</p><p>å†æ¥çœ‹çœ‹å¦ä¸€ä¸ªä¾‹å­ã€‚JSå¯¹è±¡ä»åŸå‹ç»§æ‰¿ä¸€ä¸ªæ–¹æ³•ï¼Œå½“åœ¨å¯¹è±¡ä¸Šè°ƒç”¨ç»§æ‰¿çš„æ–¹æ³•æ—¶ï¼Œè°ƒç”¨çš„ä¸Šä¸‹æ–‡ä»ç„¶æ˜¯å¯¹è±¡æœ¬èº«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const myDog = Object.create(&#123;</span><br><span class="line">  sayName: function() &#123;</span><br><span class="line">     console.log(this === myDog); // =&gt; true</span><br><span class="line">     return this.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">myDog.name = &#x27;Milo&#x27;;</span><br><span class="line">// æ–¹æ³•è°ƒç”¨ this æŒ‡å‘ myDog</span><br><span class="line">myDog.sayName(); // =&gt; &#x27;Milo&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>Object.create()</code>åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡<code>myDog</code>ï¼Œå¹¶æ ¹æ®ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®å…¶åŸå‹ã€‚<code>myDog</code>å¯¹è±¡ç»§æ‰¿<code>sayName</code>æ–¹æ³•ã€‚</p><p>æ‰§è¡Œ<code>myDog. sayname()</code>æ—¶ï¼Œ<code>myDog</code>æ˜¯è°ƒç”¨çš„ä¸Šä¸‹æ–‡ã€‚</p><p>åœ¨EC6 <code>class</code> è¯­æ³•ä¸­ï¼Œæ–¹æ³•è°ƒç”¨ä¸Šä¸‹æ–‡ä¹Ÿæ˜¯å®ä¾‹æœ¬èº«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Planet &#123;</span><br><span class="line">  constructor(name) &#123;</span><br><span class="line">    this.name = name;    </span><br><span class="line">  &#125;</span><br><span class="line">  getName() &#123;</span><br><span class="line">    console.log(this === earth); // =&gt; true</span><br><span class="line">    return this.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">var earth = new Planet(&#x27;Earth&#x27;);</span><br><span class="line">// method invocation. the context is earth</span><br><span class="line">earth.getName(); // =&gt; &#x27;Earth&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h4 id="3-2-é™·é˜±-å°†æ–¹æ³•ä¸å…¶å¯¹è±¡åˆ†ç¦»"><a href="#3-2-é™·é˜±-å°†æ–¹æ³•ä¸å…¶å¯¹è±¡åˆ†ç¦»" class="headerlink" title="3.2 é™·é˜±:å°†æ–¹æ³•ä¸å…¶å¯¹è±¡åˆ†ç¦»"></a>3.2 é™·é˜±:å°†æ–¹æ³•ä¸å…¶å¯¹è±¡åˆ†ç¦»</h4><p>æ–¹æ³•å¯ä»¥ä»å¯¹è±¡ä¸­æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„å˜é‡<code>const alone = myObj.myMethod</code>ã€‚å½“æ–¹æ³•å•ç‹¬è°ƒç”¨æ—¶ï¼Œä¸åŸå§‹å¯¹è±¡<code>alone()</code>åˆ†ç¦»ï¼Œä½ å¯èƒ½è®¤ä¸ºå½“å‰çš„<code>this</code>å°±æ˜¯å®šä¹‰æ–¹æ³•çš„å¯¹è±¡<code>myObject</code>ã€‚</p><p>å¦‚æœæ–¹æ³•åœ¨æ²¡æœ‰å¯¹è±¡çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œé‚£ä¹ˆå‡½æ•°è°ƒç”¨å°±ä¼šå‘ç”Ÿï¼Œæ­¤æ—¶çš„<code>this</code>æŒ‡å‘å…¨å±€å¯¹è±¡<code>window</code>ä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯<code>undefined</code>ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹å®šä¹‰äº†<code>Animal</code>æ„é€ å‡½æ•°å¹¶åˆ›å»ºäº†å®ƒçš„ä¸€ä¸ªå®ä¾‹:<code>myCat</code>ã€‚ç„¶å<code>setTimout()</code>åœ¨1ç§’åæ‰“å°<code>myCat</code>å¯¹è±¡ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Animal(type, legs) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.legs = legs;  </span><br><span class="line">  this.logInfo = function() &#123;</span><br><span class="line">    console.log(this === myCat); // =&gt; false</span><br><span class="line">    console.log(&#x27;The &#x27; + this.type + &#x27; has &#x27; + this.legs + &#x27; legs&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const myCat = new Animal(&#x27;Cat&#x27;, 4);</span><br><span class="line">// The undefined has undefined legs</span><br><span class="line">setTimeout(myCat.logInfo, 1000);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½è®¤ä¸º<code>setTimout</code>è°ƒç”¨<code>myCat.loginfo()</code>æ—¶ï¼Œå®ƒåº”è¯¥æ‰“å°å…³äº<code>myCat</code>å¯¹è±¡çš„ä¿¡æ¯ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œæ–¹æ³•åœ¨ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ä¸å¯¹è±¡æ˜¯åˆ†ç¦»ï¼Œ<code>setTimout(myCat.logInfo)</code>ä»¥ä¸‹æƒ…å†µæ˜¯ç­‰æ•ˆçš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setTimout(myCat.logInfo);</span><br><span class="line">// ç­‰ä»·äº</span><br><span class="line">const extractedLogInfo = myCat.logInfo;</span><br><span class="line">setTimout(extractedLogInfo);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å°†åˆ†ç¦»çš„<code>logInfo</code>ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œ<code>this</code>æ˜¯å…¨å±€ <code>window</code>,æ‰€ä»¥å¯¹è±¡ä¿¡æ¯æ²¡æœ‰æ­£ç¡®åœ°æ‰“å°ã€‚</p><p>å‡½æ•°å¯ä»¥ä½¿ç”¨<code>.bind()</code>æ–¹æ³•ä¸å¯¹è±¡ç»‘å®š,å°±å¯ä»¥è§£å†³ <code>this</code> æŒ‡å‘çš„é—®é¢˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Animal(type, legs) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.legs = legs;  </span><br><span class="line">  this.logInfo = function() &#123;</span><br><span class="line">    console.log(this === myCat); // =&gt; true</span><br><span class="line">    console.log(&#x27;The &#x27; + this.type + &#x27; has &#x27; + this.legs + &#x27; legs&#x27;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">const myCat = new Animal(&#x27;Cat&#x27;, 4);</span><br><span class="line">// logs &quot;The Cat has 4 legs&quot;</span><br><span class="line">setTimeout(myCat.logInfo.bind(myCat), 1000);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>myCat.logInfo.bind(myCat)</code>è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå®ƒçš„æ‰§è¡Œæ–¹å¼ä¸<code>logInfo</code>å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯æ­¤æ—¶çš„ <code>this</code> æŒ‡å‘ <code>myCat</code>ï¼Œå³ä½¿åœ¨å‡½æ•°è°ƒç”¨ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>å¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å°†<code>logInfo()</code>æ–¹æ³•å®šä¹‰ä¸ºä¸€ä¸ªç®­å¤´å‡½æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Animal(type, legs) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.legs = legs;  </span><br><span class="line">  this.logInfo = () =&gt; &#123;</span><br><span class="line">    console.log(this === myCat); // =&gt; true</span><br><span class="line">    console.log(&#x27;The &#x27; + this.type + &#x27; has &#x27; + this.legs + &#x27; legs&#x27;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">const myCat = new Animal(&#x27;Cat&#x27;, 4);</span><br><span class="line">// logs &quot;The Cat has 4 legs&quot;</span><br><span class="line">setTimeout(myCat.logInfo, 1000);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h2 id="4-æ„é€ å‡½æ•°è°ƒç”¨"><a href="#4-æ„é€ å‡½æ•°è°ƒç”¨" class="headerlink" title="4. æ„é€ å‡½æ•°è°ƒç”¨"></a>4. æ„é€ å‡½æ•°è°ƒç”¨</h2><p>å½“<code>new</code>å…³é”®è¯ç´§æ¥ç€å‡½æ•°å¯¹è±¡,(,ä¸€ç»„é€—å·åˆ†éš”çš„å‚æ•°ä»¥åŠ)æ—¶è¢«è°ƒç”¨ï¼Œæ‰§è¡Œçš„æ˜¯æ„é€ å‡½æ•°è°ƒç”¨å¦‚<code>new RegExp(&#39;\\d&#39;)</code>ã€‚</p><p>å£°æ˜äº†ä¸€ä¸ª<code>Country</code>å‡½æ•°ï¼Œå¹¶ä¸”å°†å®ƒä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function Country(name, traveled) &#123;</span><br><span class="line">   this.name = name ? name : &#x27;United Kingdom&#x27;;</span><br><span class="line">   this.traveled = Boolean(traveled);</span><br><span class="line">&#125;</span><br><span class="line">Country.prototype.travel = function() &#123;</span><br><span class="line">  this.traveled = true;</span><br><span class="line">&#125;;</span><br><span class="line">// æ„é€ å‡½æ•°è°ƒç”¨</span><br><span class="line">const france = new Country(&#x27;France&#x27;, false);</span><br><span class="line">// æ„é€ å‡½æ•°è°ƒç”¨</span><br><span class="line">const unitedKingdom = new Country;</span><br><span class="line"></span><br><span class="line">france.travel(); // Travel to France</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>new Country(&#39;France&#39;, false)</code>æ˜¯<code>Country</code>å‡½æ•°çš„æ„é€ å‡½æ•°è°ƒç”¨ã€‚å®ƒçš„æ‰§è¡Œç»“æœæ˜¯ä¸€ä¸ª<code>name</code>å±æ€§ä¸º<code>&#39;France&#39;</code>çš„æ–°çš„å¯¹è±¡ã€‚ å¦‚æœè¿™ä¸ªæ„é€ å‡½æ•°è°ƒç”¨æ—¶ä¸éœ€è¦å‚æ•°ï¼Œé‚£ä¹ˆæ‹¬å·å¯ä»¥çœç•¥ï¼š<code>new Country</code>ã€‚</p><p>ä»ES6å¼€å§‹ï¼ŒJS å…è®¸ç”¨<code>class</code>å…³é”®è¯æ¥å®šä¹‰æ„é€ å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class City &#123;</span><br><span class="line">  constructor(name, traveled) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.traveled = false;</span><br><span class="line">  &#125;</span><br><span class="line">  travel() &#123;</span><br><span class="line">    this.traveled = true;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// Constructor invocation</span><br><span class="line">const paris = new City(&#x27;Paris&#x27;, false);</span><br><span class="line">paris.travel();</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>new City(&#39;Paris&#39;)</code>æ˜¯æ„é€ å‡½æ•°è°ƒç”¨ã€‚è¿™ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–ç”±è¿™ä¸ªç±»ä¸­ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•<code>constructor</code>æ¥å¤„ç†ã€‚å…¶ä¸­ï¼Œ<code>this</code>æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</p><p>æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºçš„å¯¹è±¡ï¼Œå®ƒä»æ„é€ å‡½æ•°çš„åŸå‹ç»§æ‰¿äº†å±æ€§ã€‚æ„é€ å‡½æ•°çš„ä½œç”¨å°±æ˜¯å»åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡ã€‚ å¯èƒ½ä½ å·²ç»çŸ¥é“äº†ï¼Œåœ¨è¿™ç§ç±»å‹çš„è°ƒç”¨ä¸­ï¼Œä¸Šä¸‹æ–‡æŒ‡å‘æ–°åˆ›å»ºçš„å®ä¾‹ã€‚</p><p>å½“å±æ€§è®¿é—®<code>myObject.myFunction</code>å‰é¢æœ‰ä¸€ä¸ª<code>new</code>å…³é”®è¯æ—¶ï¼ŒJSä¼šæ‰§è¡Œæ„é€ å‡½æ•°è°ƒç”¨è€Œä¸æ˜¯åŸæ¥çš„æ–¹æ³•è°ƒç”¨ã€‚</p><p>ä¾‹å¦‚<code>new myObject.myFunction()</code>ï¼šå®ƒç›¸å½“äºå…ˆç”¨å±æ€§è®¿é—®æŠŠæ–¹æ³•æå–å‡ºæ¥<code>extractedFunction = myObject.myFunction</code>ï¼Œç„¶ååˆ©ç”¨æŠŠå®ƒä½œä¸ºæ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼š <code>new extractedFunction()</code>ã€‚</p><h2 id="4-1-æ„é€ å‡½æ•°ä¸­çš„-this"><a href="#4-1-æ„é€ å‡½æ•°ä¸­çš„-this" class="headerlink" title="4.1. æ„é€ å‡½æ•°ä¸­çš„ this"></a>4.1. æ„é€ å‡½æ•°ä¸­çš„ this</h2><blockquote><p>åœ¨æ„é€ å‡½æ•°è°ƒç”¨ä¸­ this æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡</p></blockquote><p>æ„é€ å‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚å®ƒåˆ©ç”¨æ„é€ å‡½æ•°çš„å‚æ•°åˆå§‹åŒ–æ–°çš„å¯¹è±¡ï¼Œè®¾å®šå±æ€§çš„åˆå§‹å€¼ï¼Œæ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ç­‰ç­‰ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884d774863ecb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>æ¥çœ‹çœ‹ä¸‹é¢ç¤ºä¾‹ä¸­çš„ä¸Šä¸‹æ–‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function Foo () &#123;</span><br><span class="line">  console.log(this instanceof Foo); // =&gt; true</span><br><span class="line">  this.property = &#x27;Default Value&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">// Constructor invocation</span><br><span class="line">const fooInstance = new Foo();</span><br><span class="line">fooInstance.property; // =&gt; &#x27;Default Value&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>new Foo()</code> æ­£åœ¨è¿›è¡Œæ„é€ å‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­ä¸Šä¸‹æ–‡æ˜¯<code>fooInstance</code>ã€‚ åœ¨<code>Foo</code>å†…éƒ¨åˆå§‹åŒ–å¯¹è±¡ï¼š<code>this.property</code>è¢«èµ‹å€¼ä¸ºé»˜è®¤å€¼ã€‚</p><p>åŒæ ·çš„æƒ…å†µåœ¨ç”¨<code>class</code>è¯­æ³•ï¼ˆä»ES6èµ·ï¼‰æ—¶ä¹Ÿä¼šå‘ç”Ÿï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åˆå§‹åŒ–åœ¨<code>constructor</code>æ–¹æ³•ä¸­è¿›è¡Œ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Bar &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    console.log(this instanceof Bar); // =&gt; true</span><br><span class="line">    this.property = &#x27;Default Value&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// Constructor invocation</span><br><span class="line">const barInstance = new Bar();</span><br><span class="line">barInstance.property; // =&gt; &#x27;Default Value&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h4 id="4-2-é™·é˜±-å¿˜äº†ä½¿ç”¨-new"><a href="#4-2-é™·é˜±-å¿˜äº†ä½¿ç”¨-new" class="headerlink" title="4.2. é™·é˜±: å¿˜äº†ä½¿ç”¨ new"></a>4.2. é™·é˜±: å¿˜äº†ä½¿ç”¨ new</h4><p>æœ‰äº›JSå‡½æ•°ä¸æ˜¯åªåœ¨ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ‰åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ä¹Ÿä¼šï¼Œä¾‹å¦‚<code>RegExp</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var reg1 = new RegExp(&#x27;\\w+&#x27;);</span><br><span class="line">var reg2 = RegExp(&#x27;\\w+&#x27;);</span><br><span class="line"></span><br><span class="line">reg1 instanceof RegExp;      // =&gt; true</span><br><span class="line">reg2 instanceof RegExp;      // =&gt; true</span><br><span class="line">reg1.source === reg2.source; // =&gt; true</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œçš„ <code>new RegExp(&#39;\\w+&#39;)</code>å’Œ<code>RegExp(&#39;\\w+&#39;)</code>æ—¶ï¼ŒJS ä¼šåˆ›å»ºç­‰ä»·çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ã€‚</p><p>ä½¿ç”¨å‡½æ•°è°ƒç”¨æ¥åˆ›å»ºå¯¹è±¡å­˜åœ¨ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜(ä¸åŒ…æ‹¬å·¥å‚æ¨¡å¼)ï¼Œå› ä¸ºä¸€äº›æ„é€ å‡½æ•°å¯èƒ½ä¼šå¿½ç•¥åœ¨ç¼ºå°‘<code>new</code>å…³é”®å­—æ—¶åˆå§‹åŒ–å¯¹è±¡çš„é€»è¾‘ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Vehicle(type, wheelsCount) &#123;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.wheelsCount = wheelsCount;</span><br><span class="line">  return this;</span><br><span class="line">&#125;</span><br><span class="line">// å¿˜è®°ä½¿ç”¨ new</span><br><span class="line">const car = Vehicle(&#x27;Car&#x27;, 4);</span><br><span class="line">car.type;       // =&gt; &#x27;Car&#x27;</span><br><span class="line">car.wheelsCount // =&gt; 4</span><br><span class="line">car === window  // =&gt; true</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>Vehicle</code>æ˜¯ä¸€ä¸ªåœ¨ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šè®¾ç½®<code>type</code>å’Œ<code>wheelsCount</code>å±æ€§çš„å‡½æ•°ã€‚</p><p>å½“æ‰§è¡Œ<code>Vehicle(&#39;Car&#39;ï¼Œ 4)</code>æ—¶ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡<code>Car</code>ï¼Œå®ƒå…·æœ‰æ­£ç¡®çš„å±æ€§:<code>Car.type</code> ä¸º <code>Car</code>å’Œ<code>Car.wheelsCount</code> ä¸º<code>4</code>ï¼Œä½ å¯èƒ½è®¤ä¸ºå®ƒå¾ˆé€‚åˆåˆ›å»ºå’Œåˆå§‹åŒ–æ–°å¯¹è±¡ã€‚</p><p>ç„¶è€Œï¼Œåœ¨å‡½æ•°è°ƒç”¨ä¸­ï¼Œ<code>this</code>æ˜¯<code>window</code>å¯¹è±¡ ï¼Œå› æ­¤ <code>Vehicleï¼ˆ&#39;Car&#39;ï¼Œ4ï¼‰</code>åœ¨ <code>window</code> å¯¹è±¡ä¸Šè®¾ç½®å±æ€§ã€‚ æ˜¾ç„¶è¿™æ˜¯é”™è¯¯ï¼Œå®ƒå¹¶æ²¡æœ‰åˆ›å»ºæ–°å¯¹è±¡ã€‚</p><p>å½“ä½ å¸Œæœ›è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œç¡®ä¿ä½ ä½¿ç”¨äº†<code>new</code>æ“ä½œç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Vehicle(type, wheelsCount) &#123;</span><br><span class="line">  if (!(this instanceof Vehicle)) &#123;</span><br><span class="line">    throw Error(&#x27;Error: Incorrect invocation&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  this.type = type;</span><br><span class="line">  this.wheelsCount = wheelsCount;</span><br><span class="line">  return this;</span><br><span class="line">&#125;</span><br><span class="line">// Constructor invocation</span><br><span class="line">const car = new Vehicle(&#x27;Car&#x27;, 4);</span><br><span class="line">car.type               // =&gt; &#x27;Car&#x27;</span><br><span class="line">car.wheelsCount        // =&gt; 4</span><br><span class="line">car instanceof Vehicle // =&gt; true</span><br><span class="line"></span><br><span class="line">// Function invocation. Throws an error.</span><br><span class="line">const brokenCar = Vehicle(&#x27;Broken Car&#x27;, 3);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>new Vehicle(&#39;Car&#39;ï¼Œ4)</code> è¿è¡Œæ­£å¸¸ï¼šåˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå› ä¸ºæ„é€ å‡½æ•°è°ƒç”¨ä¸­æ—¶ä½¿ç”¨äº†<code>new</code>å…³é”®å­—ã€‚</p><p>åœ¨æ„é€ å‡½æ•°é‡Œæ·»åŠ äº†ä¸€ä¸ªéªŒè¯<code>this instanceof Vehicle</code>æ¥ç¡®ä¿æ‰§è¡Œçš„ä¸Šä¸‹æ–‡æ˜¯æ­£ç¡®çš„å¯¹è±¡ç±»å‹ã€‚å¦‚æœ<code>this</code>ä¸æ˜¯<code>Vehicle</code>ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚è¿™æ ·ï¼Œå¦‚æœæ‰§è¡Œ<code>Vehicle(&#39;Broken Car&#39;, 3)</code>(æ²¡æœ‰<code>new</code>)ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸ï¼š<code>Error: Incorrect invocation</code>ã€‚</p><h2 id="5-éšå¼è°ƒç”¨"><a href="#5-éšå¼è°ƒç”¨" class="headerlink" title="5. éšå¼è°ƒç”¨"></a>5. éšå¼è°ƒç”¨</h2><p>ä½¿ç”¨<code>myFun.call()</code>æˆ–<code>myFun.apply()</code>æ–¹æ³•è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ‰§è¡Œçš„æ˜¯éšå¼è°ƒç”¨ã€‚</p><p>JSä¸­çš„å‡½æ•°æ˜¯ç¬¬ä¸€ç±»å¯¹è±¡ï¼Œè¿™æ„å‘³ç€å‡½æ•°å°±æ˜¯å¯¹è±¡ï¼Œå¯¹è±¡çš„ç±»å‹ä¸º<code>Function</code>ã€‚ä»å‡½æ•°å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ä¸­ï¼Œ<code>.call()</code>å’Œ<code>.apply()</code>ç”¨äºè°ƒç”¨å…·æœ‰å¯é…ç½®ä¸Šä¸‹æ–‡çš„å‡½æ•°ã€‚</p><ul><li>æ–¹æ³• <code>.call(thisArg[, arg1[, arg2[, ...]]])</code>å°†æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>thisArg</code>ä½œä¸ºè°ƒç”¨æ—¶çš„ä¸Šä¸‹æ–‡ï¼Œ<code>arg1, arg2, ...</code>è¿™äº›åˆ™ä½œä¸ºå‚æ•°ä¼ å…¥è¢«è°ƒç”¨çš„å‡½æ•°ã€‚</li><li>æ–¹æ³•<code>.apply(thisArg, [args])</code>å°†æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>thisArg</code>ä½œä¸ºè°ƒç”¨æ—¶çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ¥å—å¦ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡<code>[arg1, arg2, ...]</code>ä½œä¸ºè¢«è°ƒç”¨å‡½æ•°çš„å‚æ•°ä¼ å…¥ã€‚</li></ul><p>ä¸‹é¢æ˜¯éšå¼è°ƒç”¨çš„ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function increment(number) &#123;</span><br><span class="line">  return ++number;  </span><br><span class="line">&#125;</span><br><span class="line">increment.call(undefined, 10);    // =&gt; 11</span><br><span class="line">increment.apply(undefined, [10]); // =&gt; 11</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>increment.call()</code>å’Œ<code>increment.apply()</code>éƒ½ç”¨å‚æ•°<code>10</code>è°ƒç”¨äº†è¿™ä¸ªè‡ªå¢å‡½æ•°ã€‚</p><p>ä¸¤è€…çš„åŒºåˆ«æ˜¯<code>.call()</code>æ¥å—ä¸€ç»„å‚æ•°ï¼Œä¾‹å¦‚<code>myFunction.call(thisValue, &#39;value1&#39;, &#39;value2&#39;)</code>ã€‚è€Œ<code>.apply()</code>æ¥å—çš„ä¸€ç»„å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œä¾‹å¦‚<code>myFunction.apply(thisValue, [&#39;value1&#39;, &#39;value2&#39;]</code>)ã€‚</p><h4 id="5-1-éšå¼è°ƒç”¨ä¸­çš„this"><a href="#5-1-éšå¼è°ƒç”¨ä¸­çš„this" class="headerlink" title="5.1. éšå¼è°ƒç”¨ä¸­çš„this"></a>5.1. éšå¼è°ƒç”¨ä¸­çš„this</h4><blockquote><p>åœ¨éšå¼è°ƒç”¨.call()æˆ–.apply()ä¸­ï¼Œthisæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°</p></blockquote><p>å¾ˆæ˜æ˜¾ï¼Œåœ¨éšå¼è°ƒç”¨ä¸­ï¼Œ<code>this</code>ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™<code>.call()</code>æˆ–<code>.apply()</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var rabbit = &#123; name: &#x27;White Rabbit&#x27; &#125;;</span><br><span class="line">function concatName(string) &#123;</span><br><span class="line">  console.log(this === rabbit); // =&gt; true</span><br><span class="line">  return string + this.name;</span><br><span class="line">&#125;</span><br><span class="line">concatName.call(rabbit, &#x27;Hello &#x27;);  // =&gt; &#x27;Hello White Rabbit&#x27;</span><br><span class="line">concatName.apply(rabbit, [&#x27;Bye &#x27;]); // =&gt; &#x27;Bye White Rabbit&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å½“åº”è¯¥ä½¿ç”¨ç‰¹å®šä¸Šä¸‹æ–‡æ‰§è¡Œå‡½æ•°æ—¶ï¼Œéšå¼è°ƒç”¨éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ä¸ºäº†è§£å†³æ–¹æ³•è°ƒç”¨æ—¶ï¼Œ<code>this</code>æ€»æ˜¯<code>window</code>æˆ–ä¸¥æ ¼æ¨¡å¼ä¸‹çš„<code>undefined</code>çš„ä¸Šä¸‹æ–‡é—®é¢˜ã€‚éšå¼è°ƒç”¨å¯ä»¥ç”¨äºæ¨¡æ‹Ÿåœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨æŸä¸ªæ–¹æ³•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Runner(name) &#123;</span><br><span class="line">  console.log(this instanceof Rabbit); // =&gt; true</span><br><span class="line">  this.name = name;  </span><br><span class="line">&#125;</span><br><span class="line">function Rabbit(name, countLegs) &#123;</span><br><span class="line">  console.log(this instanceof Rabbit); // =&gt; true</span><br><span class="line">  Runner.call(this, name);</span><br><span class="line">  this.countLegs = countLegs;</span><br><span class="line">&#125;</span><br><span class="line">const myRabbit = new Rabbit(&#x27;White Rabbit&#x27;, 4);</span><br><span class="line">myRabbit; // &#123; name: &#x27;White Rabbit&#x27;, countLegs: 4 &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>Rabbit</code>ä¸­çš„<code>Runner.call(this, name)</code>éšå¼è°ƒç”¨äº†çˆ¶ç±»çš„å‡½æ•°æ¥åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡ã€‚</p><h2 id="6-ç»‘å®šå‡½æ•°"><a href="#6-ç»‘å®šå‡½æ•°" class="headerlink" title="6. ç»‘å®šå‡½æ•°"></a>6. ç»‘å®šå‡½æ•°</h2><p>ç»‘å®šå‡½æ•°æ˜¯ä¸å¯¹è±¡è¿æ¥çš„å‡½æ•°ã€‚é€šå¸¸ä½¿ç”¨<code>.bind()</code>æ–¹æ³•ä»åŸå§‹å‡½æ•°åˆ›å»ºã€‚åŸå§‹å‡½æ•°å’Œç»‘å®šå‡½æ•°å…±äº«ç›¸åŒçš„ä»£ç å’Œä½œç”¨åŸŸï¼Œä½†æ‰§è¡Œæ—¶ä¸Šä¸‹æ–‡ä¸åŒã€‚</p><p>æ–¹æ³• <code>myFunc.bind(thisArg[, arg1[, arg2[, ...]]])</code>æ¥å—ç¬¬ä¸€ä¸ªå‚æ•°<code>thisArg</code>ä½œä¸ºç»‘å®šå‡½æ•°æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å®ƒæ¥å—ä¸€ç»„å¯é€‰çš„å‚æ•° <code>arg1, arg2, ...</code>ä½œä¸ºè¢«è°ƒç”¨å‡½æ•°çš„å‚æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªç»‘å®šäº†<code>thisArg</code>çš„æ–°å‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function multiply(number) &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  return this * number;</span><br><span class="line">&#125;</span><br><span class="line">const double = multiply.bind(2);</span><br><span class="line"></span><br><span class="line">double(3);  // =&gt; 6</span><br><span class="line">double(10); // =&gt; 20</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>bind(2)</code>è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°å¯¹è±¡<code>double</code>ï¼Œ<code>double</code> ç»‘å®šäº†æ•°å­—<code>2</code>ã€‚<code>multiply</code>å’Œ<code>double</code>å…·æœ‰ç›¸åŒçš„ä»£ç å’Œä½œç”¨åŸŸã€‚</p><p>ä¸<code>.apply()</code>å’Œ<code>.call()</code> æ–¹æ³•ç›¸åï¼Œå®ƒä¸ä¼šç«‹å³è°ƒç”¨è¯¥å‡½æ•°ï¼Œ<code>.bind()</code>æ–¹æ³•åªè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œåœ¨ä¹‹åè¢«è°ƒç”¨ï¼Œåªæ˜¯this<code>å·²ç»</code>è¢«æå‰è®¾ç½®å¥½äº†ã€‚</p><h4 id="6-1-ç»‘å®šå‡½æ•°ä¸­çš„this"><a href="#6-1-ç»‘å®šå‡½æ•°ä¸­çš„this" class="headerlink" title="6.1. ç»‘å®šå‡½æ•°ä¸­çš„this"></a>6.1. ç»‘å®šå‡½æ•°ä¸­çš„this</h4><blockquote><p>åœ¨è°ƒç”¨ç»‘å®šå‡½æ•°æ—¶ï¼Œ<code>this</code>æ˜¯<code>.bind()</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p></blockquote><p><code>.bind()</code>çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå°†ä¸Šä¸‹æ–‡ä½œä¸ºä¼ é€’ç»™<code>.bind()</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚å®ƒæ˜¯ä¸€ç§å¼ºå¤§çš„æŠ€æœ¯ï¼Œä½¿å’±ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå®šä¹‰äº†<code>this</code>å€¼çš„å‡½æ•°ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884dceeb04418?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>æ¥çœ‹çœ‹ï¼Œå¦‚ä½•åœ¨å¦‚ä½•åœ¨ç»‘å®šå‡½æ•°è®¾ç½® <code>this</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const numbers = &#123;</span><br><span class="line">  array: [3, 5, 10],</span><br><span class="line">  getNumbers: function() &#123;</span><br><span class="line">    return this.array;    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">const boundGetNumbers = numbers.getNumbers.bind(numbers);</span><br><span class="line">boundGetNumbers(); // =&gt; [3, 5, 10]</span><br><span class="line">// Extract method from object</span><br><span class="line">const simpleGetNumbers = numbers.getNumbers;</span><br><span class="line">simpleGetNumbers(); // =&gt; undefined (ä¸¥æ ¼æ¨¡å¼ä¸‹æŠ¥é”™)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>numbers.getNumbers.bind(numbers)</code>è¿”å›ç»‘å®š<code>numbers</code>å¯¹è±¡<code>boundGetNumbers</code>å‡½æ•°ã€‚<code>boundGetNumbers()</code>è°ƒç”¨æ—¶çš„<code>this</code>æ˜¯<code>number</code>å¯¹è±¡ï¼Œå¹¶èƒ½å¤Ÿè¿”å›æ­£ç¡®çš„æ•°ç»„å¯¹è±¡ã€‚</p><p>å¯ä»¥å°†å‡½æ•°<code>numbers.getNumbers</code>æå–åˆ°å˜é‡<code>simpleGetNumbers</code>ä¸­è€Œä¸è¿›è¡Œç»‘å®šã€‚åœ¨ä¹‹åçš„å‡½æ•°è°ƒç”¨ä¸­<code>simpleGetNumbers()</code>çš„<code>this</code>æ˜¯<code>window</code>(ä¸¥æ ¼æ¨¡å¼ä¸‹ä¸º<code>undefined</code>)ï¼Œä¸æ˜¯<code>number</code>å¯¹è±¡ã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œ<code>simpleGetNumbers()</code>ä¸ä¼šæ­£ç¡®è¿”å›æ•°ç»„ã€‚</p><h4 id="6-2-ç´§å¯†çš„ä¸Šä¸‹æ–‡ç»‘å®š"><a href="#6-2-ç´§å¯†çš„ä¸Šä¸‹æ–‡ç»‘å®š" class="headerlink" title="6.2 ç´§å¯†çš„ä¸Šä¸‹æ–‡ç»‘å®š"></a>6.2 ç´§å¯†çš„ä¸Šä¸‹æ–‡ç»‘å®š</h4><p><code>.bind()</code>åˆ›å»ºä¸€ä¸ªæ°¸ä¹…çš„ä¸Šä¸‹æ–‡é“¾æ¥ï¼Œå¹¶å§‹ç»ˆä¿æŒå®ƒã€‚ ä¸€ä¸ªç»‘å®šå‡½æ•°ä¸èƒ½é€šè¿‡<code>.call()</code>æˆ–è€…<code>.apply()</code>æ¥æ”¹å˜å®ƒçš„ä¸Šä¸‹æ–‡ï¼Œç”šè‡³æ˜¯å†æ¬¡ç»‘å®šä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆä½œç”¨ã€‚</p><p>åªæœ‰ç»‘å®šå‡½æ•°çš„æ„é€ å‡½æ•°è°ƒç”¨æ‰èƒ½æ›´æ”¹å·²ç»ç»‘å®šçš„ä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯å¾ˆä¸æ¨èçš„åšæ³•(æ„é€ å‡½æ•°è°ƒç”¨å¿…é¡»ä½¿ç”¨å¸¸è§„çš„éç»‘å®šå‡½æ•°)ã€‚</p><p>ä¸‹é¢ç¤ºä¾‹åˆ›å»ºä¸€ä¸ªç»‘å®šå‡½æ•°ï¼Œç„¶åå°è¯•æ›´æ”¹å…¶å·²é¢„å…ˆå®šä¹‰å¥½çš„ä¸Šä¸‹æ–‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function getThis() &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  return this;</span><br><span class="line">&#125;</span><br><span class="line">const one = getThis.bind(1);</span><br><span class="line">// ç»‘å®šå‡½æ•°è°ƒç”¨</span><br><span class="line">one(); // =&gt; 1</span><br><span class="line">// ä½¿ç”¨å¸¦æœ‰.apply()å’Œ.call()çš„ç»‘å®šå‡½æ•°</span><br><span class="line">one.call(2);  // =&gt; 1</span><br><span class="line">one.apply(2); // =&gt; 1</span><br><span class="line">// å†æ¬¡ç»‘å®š</span><br><span class="line">one.bind(2)(); // =&gt; 1</span><br><span class="line">// ä»¥æ„é€ å‡½æ•°çš„å½¢å¼è°ƒç”¨ç»‘å®šå‡½æ•°</span><br><span class="line">new one(); // =&gt; Object</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>åªæœ‰<code>new one()</code>æ”¹å˜äº†ç»‘å®šå‡½æ•°çš„ä¸Šä¸‹æ–‡ï¼Œå…¶ä»–æ–¹å¼çš„è°ƒç”¨ä¸­<code>this</code>æ€»æ˜¯ç­‰äº1ã€‚</p><h2 id="7-ç®­å¤´å‡½æ•°"><a href="#7-ç®­å¤´å‡½æ•°" class="headerlink" title="7. ç®­å¤´å‡½æ•°"></a>7. ç®­å¤´å‡½æ•°</h2><p>ç®­å¤´å‡½æ•°ç”¨äºä»¥æ›´çŸ­çš„å½¢å¼å£°æ˜å‡½æ•°ï¼Œå¹¶åœ¨è¯æ³•ä¸Šç»‘å®šä¸Šä¸‹æ–‡ã€‚å®ƒå¯ä»¥è¿™æ ·ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const hello = (name) =&gt; &#123;</span><br><span class="line">  return &#x27;Hello &#x27; + name;</span><br><span class="line">&#125;;</span><br><span class="line">hello(&#x27;World&#x27;); // =&gt; &#x27;Hello World&#x27;</span><br><span class="line">// Keep only even numbers</span><br><span class="line">[1, 2, 5, 6].filter(item =&gt; item % 2 === 0); // =&gt; [2, 6]</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç®­å¤´å‡½æ•°è¯­æ³•ç®€å•ï¼Œæ²¡æœ‰å†—é•¿çš„<code>function</code> å…³é”®å­—ã€‚å½“ç®­å¤´å‡½æ•°åªæœ‰ä¸€æ¡è¯­å¥æ—¶ï¼Œç”šè‡³å¯ä»¥çœç•¥<code>return</code>å…³é”®å­—ã€‚</p><p>ç®­å¤´å‡½æ•°æ˜¯åŒ¿åçš„ï¼Œè¿™æ„å‘³ç€<code>name</code>å±æ€§æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²<code>&#39;&#39;</code>ã€‚è¿™æ ·å®ƒå°±æ²¡æœ‰è¯æ³•ä¸Šå‡½æ•°å(å‡½æ•°åå¯¹äºé€’å½’ã€åˆ†ç¦»äº‹ä»¶å¤„ç†ç¨‹åºéå¸¸æœ‰ç”¨)</p><p>åŒæ—¶ï¼Œè·Ÿå¸¸è§„å‡½æ•°ç›¸åï¼Œå®ƒä¹Ÿä¸æä¾›<code>arguments</code>å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œè¿™åœ¨ES6ä¸­é€šè¿‡<code>rest parameters</code>ä¿®å¤äº†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const sumArguments = (...args) =&gt; &#123;</span><br><span class="line">   console.log(typeof arguments); // =&gt; &#x27;undefined&#x27;</span><br><span class="line">   return args.reduce((result, item) =&gt; result + item);</span><br><span class="line">&#125;;</span><br><span class="line">sumArguments.name      // =&gt; &#x27;&#x27;</span><br><span class="line">sumArguments(5, 5, 6); // =&gt; 16</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h4 id="7-1-ç®­å¤´å‡½æ•°ä¸­çš„this"><a href="#7-1-ç®­å¤´å‡½æ•°ä¸­çš„this" class="headerlink" title="7.1. ç®­å¤´å‡½æ•°ä¸­çš„this"></a>7.1. ç®­å¤´å‡½æ•°ä¸­çš„this</h4><blockquote><p>this å®šä¹‰ç®­å¤´å‡½æ•°çš„å°é—­ä¸Šä¸‹æ–‡</p></blockquote><p>ç®­å¤´å‡½æ•°ä¸ä¼šåˆ›å»ºè‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè€Œæ˜¯ä»å®šä¹‰å®ƒçš„å¤–éƒ¨å‡½æ•°ä¸­è·å– <code>this</code>ã€‚ æ¢å¥è¯è¯´ï¼Œç®­å¤´å‡½æ•°åœ¨è¯æ±‡ä¸Šç»‘å®š <code>this</code>ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/13/16c884dfd5bf33de?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†è¿™ä¸ªä¸Šä¸‹æ–‡é€æ˜çš„ç‰¹æ€§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Point &#123;</span><br><span class="line">  constructor(x, y) &#123;</span><br><span class="line">    this.x = x;</span><br><span class="line">    this.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">  log() &#123;</span><br><span class="line">    console.log(this === myPoint); // =&gt; true</span><br><span class="line">    setTimeout(()=&gt; &#123;</span><br><span class="line">      console.log(this === myPoint);      // =&gt; true</span><br><span class="line">      console.log(this.x + &#x27;:&#x27; + this.y); // =&gt; &#x27;95:165&#x27;</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const myPoint = new Point(95, 165);</span><br><span class="line">myPoint.log();</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>setTimeout</code>ä½¿ç”¨ä¸<code>log()</code>æ–¹æ³•ç›¸åŒçš„ä¸Šä¸‹æ–‡(<code>myPoint</code>å¯¹è±¡)è°ƒç”¨ç®­å¤´å‡½æ•°ã€‚æ­£å¦‚æ‰€è§ï¼Œç®­å¤´å‡½æ•°ä»å®šä¹‰å®ƒçš„å‡½æ•°ç»§æ‰¿ä¸Šä¸‹æ–‡ã€‚</p><p>å¦‚æœåœ¨è¿™ä¸ªä¾‹å­é‡Œå°è¯•ç”¨å¸¸è§„å‡½æ•°,å®ƒåˆ›å»ºè‡ªå·±çš„ä¸Šä¸‹æ–‡(<code>window</code>æˆ–ä¸¥æ ¼æ¨¡å¼ä¸‹çš„<code>undefined</code>)ã€‚å› æ­¤ï¼Œè¦ä½¿ç›¸åŒçš„ä»£ç æ­£ç¡®åœ°ä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼ï¼Œéœ€è¦æ‰‹åŠ¨ç»‘å®šä¸Šä¸‹æ–‡:<code>setTimeout(function()&#123;â€¦&#125;.bind(this))</code>ã€‚è¿™å¾ˆå†—é•¿ï¼Œä½¿ç”¨ç®­å¤´å‡½æ•°æ˜¯ä¸€ç§æ›´ç®€æ´ã€æ›´çŸ­çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å¦‚æœç®­å¤´å‡½æ•°åœ¨æœ€é¡¶å±‚çš„ä½œç”¨åŸŸä¸­å®šä¹‰ï¼ˆåœ¨ä»»ä½•å‡½æ•°ä¹‹å¤–ï¼‰ï¼Œåˆ™ä¸Šä¸‹æ–‡å§‹ç»ˆæ˜¯å…¨å±€å¯¹è±¡ï¼ˆæµè§ˆå™¨ä¸­çš„ windowï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">onst getContext = () =&gt; &#123;</span><br><span class="line">   console.log(this === window); // =&gt; true</span><br><span class="line">   return this;</span><br><span class="line">&#125;;</span><br><span class="line">console.log(getContext() === window); // =&gt; true</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç®­å¤´å‡½æ•°ä¸€åŠ³æ°¸é€¸åœ°ä¸è¯æ±‡ä¸Šä¸‹æ–‡ç»‘å®šã€‚ å³ä½¿ä¿®æ”¹ä¸Šä¸‹æ–‡ï¼Œ<code>this</code>ä¹Ÿä¸èƒ½è¢«æ”¹å˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const numbers = [1, 2];</span><br><span class="line">(function() &#123;  </span><br><span class="line">  const get = () =&gt; &#123;</span><br><span class="line">    console.log(this === numbers); // =&gt; true</span><br><span class="line">    return this;</span><br><span class="line">  &#125;;</span><br><span class="line">  console.log(this === numbers); // =&gt; true</span><br><span class="line">  get(); // =&gt; [1, 2]</span><br><span class="line">  // Use arrow function with .apply() and .call()</span><br><span class="line">  get.call([0]);  // =&gt; [1, 2]</span><br><span class="line">  get.apply([0]); // =&gt; [1, 2]</span><br><span class="line">  // Bind</span><br><span class="line">  get.bind([0])(); // =&gt; [1, 2]</span><br><span class="line">&#125;).call(numbers);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ— è®ºå¦‚ä½•è°ƒç”¨ç®­å¤´å‡½æ•°<code>get</code>ï¼Œå®ƒæ€»æ˜¯ä¿ç•™è¯æ±‡ä¸Šä¸‹æ–‡<code>numbers</code>ã€‚ ç”¨å…¶ä»–ä¸Šä¸‹æ–‡çš„éšå¼è°ƒç”¨(é€šè¿‡ <code>get.call([0])</code>æˆ–<code>get.apply([0])</code>)æˆ–è€…é‡æ–°ç»‘å®š(é€šè¿‡<code>.bind()</code>)éƒ½ä¸ä¼šèµ·ä½œç”¨ã€‚</p><p>ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ã€‚ å°†å®ƒä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨(<code>new get()</code>)ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼š<code>TypeError: get is not a constructor</code>ã€‚</p><h4 id="7-2-é™·é˜±-ç”¨ç®­å¤´å‡½æ•°å®šä¹‰æ–¹æ³•"><a href="#7-2-é™·é˜±-ç”¨ç®­å¤´å‡½æ•°å®šä¹‰æ–¹æ³•" class="headerlink" title="7.2. é™·é˜±: ç”¨ç®­å¤´å‡½æ•°å®šä¹‰æ–¹æ³•"></a>7.2. é™·é˜±: ç”¨ç®­å¤´å‡½æ•°å®šä¹‰æ–¹æ³•</h4><p>ä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥å£°æ˜ä¸€ä¸ªå¯¹è±¡ä¸Šçš„æ–¹æ³•ã€‚ç®­å¤´å‡½æ•°çš„å®šä¹‰ç›¸æ¯”äºå‡½æ•°è¡¨è¾¾å¼çŸ­å¾—å¤šï¼š<code>(param) =&gt; &#123;...&#125; instead of function(param) &#123;..&#125;</code>ã€‚</p><p>æ¥çœ‹çœ‹ä¾‹å­ï¼Œç”¨ç®­å¤´å‡½æ•°åœ¨Periodç±»ä¸Šå®šä¹‰äº†<code>format()</code>æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Period (hours, minutes) &#123;  </span><br><span class="line">  this.hours = hours;</span><br><span class="line">  this.minutes = minutes;</span><br><span class="line">&#125;</span><br><span class="line">Period.prototype.format = () =&gt; &#123;</span><br><span class="line">  console.log(this === window); // =&gt; true</span><br><span class="line">  return this.hours + &#x27; hours and &#x27; + this.minutes + &#x27; minutes&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">const walkPeriod = new Period(2, 30);  </span><br><span class="line">walkPeriod.format(); // =&gt; &#x27;undefined hours and undefined minutes&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç”±äº<code>format</code>æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œå¹¶ä¸”åœ¨å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆæœ€é¡¶å±‚çš„ä½œç”¨åŸŸï¼‰ä¸­å®šä¹‰ï¼Œå› æ­¤ <code>this</code> æŒ‡å‘<code>window</code>å¯¹è±¡ã€‚</p><p>å³ä½¿<code>format</code>ä½œä¸ºæ–¹æ³•åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šè¢«è°ƒç”¨å¦‚<code>walkPeriod.format()</code>ï¼Œ<code>window</code>ä»ç„¶æ˜¯è¿™æ¬¡è°ƒç”¨çš„ä¸Šä¸‹æ–‡ã€‚ä¹‹æ‰€ä»¥ä¼šè¿™æ ·æ˜¯å› ä¸ºç®­å¤´å‡½æ•°æœ‰é™æ€çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸ä¼šéšç€è°ƒç”¨æ–¹å¼çš„æ”¹å˜è€Œæ”¹å˜ã€‚</p><p>è¯¥æ–¹æ³•è¿”å›<code>&#39;undefined hourså’Œundefined minutes&#39;</code>ï¼Œè¿™ä¸æ˜¯å’±ä»¬æƒ³è¦çš„ç»“æœã€‚</p><p>å‡½æ•°è¡¨è¾¾å¼è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå¸¸è§„å‡½æ•°ç¡®å®èƒ½æ ¹æ®å®é™…è°ƒç”¨æ”¹å˜å®ƒçš„ä¸Šä¸‹æ–‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Period (hours, minutes) &#123;  </span><br><span class="line">  this.hours = hours;</span><br><span class="line">  this.minutes = minutes;</span><br><span class="line">&#125;</span><br><span class="line">Period.prototype.format = function() &#123;</span><br><span class="line">  console.log(this === walkPeriod); // =&gt; true</span><br><span class="line">  return this.hours + &#x27; hours and &#x27; + this.minutes + &#x27; minutes&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">const walkPeriod = new Period(2, 30);  </span><br><span class="line">walkPeriod.format(); // =&gt; &#x27;2 hours and 30 minutes&#x27;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>walkPeriod.format()</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ä¸Šçš„æ–¹æ³•è°ƒç”¨ï¼Œå®ƒçš„ä¸Šä¸‹æ–‡æ˜¯<code>walkPeriod</code>å¯¹è±¡ã€‚<code>this.hours</code>ç­‰äº<code>2</code>ï¼Œ<code>this.minutes</code>ç­‰äº<code>30</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•è¿”å›äº†æ­£ç¡®çš„ç»“æœï¼š<code>&#39;2 hours and 30 minutes&#39;</code>ã€‚</p><p><strong>åŸæ–‡ï¼šdmitripavlutin.com/gentle-explâ€¦</strong></p><p><strong>ä»£ç éƒ¨ç½²åå¯èƒ½å­˜åœ¨çš„BUGæ²¡æ³•å®æ—¶çŸ¥é“ï¼Œäº‹åä¸ºäº†è§£å†³è¿™äº›BUGï¼ŒèŠ±äº†å¤§é‡çš„æ—¶é—´è¿›è¡Œlog è°ƒè¯•ï¼Œè¿™è¾¹é¡ºä¾¿ç»™å¤§å®¶æ¨èä¸€ä¸ªå¥½ç”¨çš„BUGç›‘æ§å·¥å…· Fundebugã€‚</strong></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸ºå‡½æ•°è°ƒç”¨å¯¹<code>this</code>å½±å“æœ€å¤§ï¼Œä»ç°åœ¨å¼€å§‹ä¸è¦é—®è‡ªå·±ï¼š</p><blockquote><p>this æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ</p></blockquote><p>è€Œæ˜¯è¦çœ‹çœ‹</p><blockquote><p>å‡½æ•°æ˜¯æ€ä¹ˆè¢«è°ƒç”¨çš„ï¼Ÿ</p></blockquote><p>å¯¹äºç®­å¤´å‡½æ•°ï¼Œéœ€è¦æƒ³æƒ³</p><blockquote><p>åœ¨è¿™ä¸ªç®­å¤´å‡½æ•°è¢«å®šä¹‰çš„åœ°æ–¹ï¼Œthisæ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>è¿™æ˜¯å¤„ç†<code>this</code>æ—¶çš„æ­£ç¡®æƒ³æ³•ï¼Œå®ƒä»¬å¯ä»¥è®©ä½ å…äºå¤´ç—›ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>alt snippet</title>
      <link href="/2019/07/31/alt/"/>
      <url>/2019/07/31/alt/</url>
      
        <content type="html"><![CDATA[<h2 id="dig-mineral"><a href="#dig-mineral" class="headerlink" title="dig mineral"></a>dig mineral</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config.json ï¼ˆæŒ–çŸ¿é…ç½®ï¼‰ã€</span><br><span class="line">sysupdate ï¼ˆXMR æŒ–çŸ¿è½¯ä»¶ï¼‰ã€</span><br><span class="line">update.sh ï¼ˆæœ¬è„šæœ¬ï¼‰ã€</span><br><span class="line">networkservice(scanneræ‰«æå¹¶å…¥ä¾µå…¶ä»–çš„ä¸»æœº)ã€</span><br><span class="line">sysguard(watchdog ç”¨äºç›‘æ§å¹¶ä¿è¯ç—…æ¯’çš„æ­£å¸¸è¿è¡Œä»¥åŠæ›´æ–°) å¹¶ä¿è¯ä»–ä»¬ä»¥ root æƒé™è¿è¡Œã€‚</span><br></pre></td></tr></table></figure><ol><li><p>æŸ¥çœ‹ç—…æ¯’çš„ PID å·</p></li><li><p>è·å–ç»å¯¹è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /proc/&#123;pid å·&#125;/exe</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤/tmpæ–‡ä»¶å¤¹çš„æ‰€æœ‰æ–‡ä»¶</p></li><li><p>æ£€æŸ¥ä¸‹å®šæ—¶ä»»åŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l æˆ–è€… cat /var/spool/cron/will</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„willä¸ºå½“å‰ç”¨æˆ·å</p><p>æŸ¥çœ‹å®šæ—¶ä»»åŠ¡çš„æ—¥å¿—</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more /var/<span class="built_in">log</span>/cron <span class="built_in">log</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤å®šæ—¶ä»»åŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /var/spool/cron/root æˆ–è€… crontab -r åˆ é™¤å®šæ—¶ä»»åŠ¡</span><br></pre></td></tr></table></figure></li><li><p>kill å‘½ä»¤å°†ç›¸å…³è¿›ç¨‹å¹²æ‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sysupdate</span><br><span class="line">networkservice</span><br><span class="line">sysguard</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> alt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java io</title>
      <link href="/2019/07/10/java%20point/"/>
      <url>/2019/07/10/java%20point/</url>
      
        <content type="html"><![CDATA[<h1 id="base"><a href="#base" class="headerlink" title="base"></a>base</h1><h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h2><ul><li><p>intå˜é‡è‡ªå¢ æ•ˆç‡é—®é¢˜ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i++;å’Œi += 1;å½¢æˆçš„æŒ‡ä»¤æ•°è¾ƒå°‘ï¼Œä¸”ä¸éœ€è¦æ“ä½œæ•°æ ˆã€‚ç›¸å¯¹è€Œè¨€ï¼Œi = i+1;éœ€è¦è‡³å°‘2ä¸ªæ“ä½œæ•°æ ˆæ·±åº¦ï¼Œå¹¶ä¸”å½¢æˆçš„æŒ‡ä»¤æ•°è¾ƒå¤šã€‚æ•…ï¼Œi++;å’Œi+= 1;çš„æ•ˆç‡ä¸€æ ·ï¼Œå¹¶ä¸”äºŒè€…çš„æ•ˆç‡éƒ½ä¼˜äºi = i+1;</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h2><p><strong>Tï¼ŒEï¼ŒKï¼ŒVï¼Œï¼Ÿæ˜¯è¿™æ ·çº¦å®šçš„ï¼š</strong></p><ul><li>ï¼Ÿè¡¨ç¤ºä¸ç¡®å®šçš„ java ç±»å‹</li><li>T (type) è¡¨ç¤ºå…·ä½“çš„ä¸€ä¸ªjavaç±»å‹</li><li>K V (key value) åˆ†åˆ«ä»£è¡¨javaé”®å€¼ä¸­çš„Key Value</li><li>E (element) ä»£è¡¨Element</li></ul><p><strong>ï¼Ÿå’Œ T çš„åŒºåˆ«</strong>ï¼š</p><p><img src="https://mmbiz.qpic.cn/mmbiz/knmrNHnmCLFRVA73vYfkqVGfia90X5nyEsksfM8Vz6btFZCRd3PCSJC1XkZhaJ0ufxcoohxAdr8X1tykU9CZPUQ/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p><p>ï¼Ÿå’Œ T éƒ½è¡¨ç¤ºä¸ç¡®å®šçš„ç±»å‹ï¼ŒåŒºåˆ«åœ¨äºæˆ‘ä»¬å¯ä»¥å¯¹ T è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯å¯¹ ï¼Ÿä¸è¡Œï¼Œæ¯”å¦‚å¦‚ä¸‹è¿™ç§ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å¯ä»¥</span><br><span class="line">T t = operate();</span><br><span class="line"></span><br><span class="line">// ä¸å¯ä»¥</span><br><span class="line">ï¼Ÿcar = operate();</span><br></pre></td></tr></table></figure><p>ç®€å•æ€»ç»“ä¸‹ï¼š</p><p>T æ˜¯ä¸€ä¸ª ç¡®å®šçš„ ç±»å‹ï¼Œé€šå¸¸ç”¨äºæ³›å‹ç±»å’Œæ³›å‹æ–¹æ³•çš„å®šä¹‰ï¼Œï¼Ÿæ˜¯ä¸€ä¸ª ä¸ç¡®å®š çš„ç±»å‹ï¼Œé€šå¸¸ç”¨äºæ³›å‹æ–¹æ³•çš„è°ƒç”¨ä»£ç å’Œå½¢å‚ï¼Œä¸èƒ½ç”¨äºå®šä¹‰ç±»å’Œæ³›å‹æ–¹æ³•ã€‚</p><p><strong>PECSï¼ˆProducer Extends Consumer Superï¼‰</strong>åŸåˆ™ï¼šä½œä¸ºç”Ÿäº§è€…æä¾›æ•°æ®ï¼ˆå¾€å¤–è¯»å–ï¼‰æ—¶ï¼Œé€‚åˆç”¨ä¸Šç•Œé€šé…ç¬¦ï¼ˆextendsï¼‰ï¼›ä½œä¸ºæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®ï¼ˆå¾€é‡Œå†™å…¥ï¼‰æ—¶ï¼Œé€‚åˆç”¨ä¸‹ç•Œé€šé…ç¬¦ï¼ˆsuperï¼‰ã€‚</p><h2 id="æ—¶é—´"><a href="#æ—¶é—´" class="headerlink" title="æ—¶é—´"></a>æ—¶é—´</h2><p>åœ¨ JDK8 ä»¥åï¼Œå»ºè®®ä½¿ç”¨ DateTimeFormatter ä»£æ›¿ SimpleDateFormat ï¼Œå› ä¸º SimpleDateFormat æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œè€Œ DateTimeFormatter æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„çº¿ç¨‹å®‰å…¨æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°ï¼Œæ¯”å¦‚ apache çš„ DateFormatUtils å·¥å…·ç±»ã€‚</p><h2 id="dynamic-compile"><a href="#dynamic-compile" class="headerlink" title="dynamic compile"></a>dynamic compile</h2><p>é™æ€ç¼–è¯‘ï¼šç¼–è¯‘æ—¶å°±æŠŠæ‰€æœ‰ç”¨åˆ°çš„Javaä»£ç å…¨éƒ½ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œæ˜¯ä¸€æ¬¡æ€§ç¼–è¯‘ã€‚</p><p>åŠ¨æ€ç¼–è¯‘ï¼šåœ¨Javaç¨‹åºè¿è¡Œæ—¶æ‰æŠŠéœ€è¦çš„Javaä»£ç çš„ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œæ˜¯æŒ‰éœ€ç¼–è¯‘ã€‚</p><p>ä»JDK1.6å¼€å§‹ï¼Œå¼•å…¥äº†Javaä»£ç é‡å†™è¿‡çš„ç¼–è¯‘å™¨æ¥å£ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶ç¼–è¯‘Javaæºä»£ç ï¼Œç„¶åå†é€šè¿‡ç±»åŠ è½½å™¨å°†ç¼–è¯‘å¥½çš„ç±»åŠ è½½è¿›JVM,è¿™ç§åœ¨è¿è¡Œæ—¶ç¼–è¯‘ä»£ç çš„æ“ä½œå°±å«åšåŠ¨æ€ç¼–è¯‘ã€‚</p><hr><p><a href="https://blog.nowcoder.net/n/d2a7554ea2ec4e4b978cf4a74c3c41b2">ã€JavaåŠ¨æ€ç¼–è¯‘ã€‘åŠ¨æ€ç¼–è¯‘çš„åº”ç”¨_ç‰›å®¢åšå®¢</a></p><p><a href="https://segmentfault.com/a/1190000016842546">JavaåŠ¨æ€æ€§(1) - åŠ¨æ€ç¼–è¯‘(DynamicCompile)</a></p><h2 id="IOæµ"><a href="#IOæµ" class="headerlink" title="IOæµ"></a>IOæµ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æµåŒ…æ‹¬å­—ç¬¦æµå’Œå­—èŠ‚æµï¼Œæµä»æ¦‚å¿µä¸Šæ¥è¯´æ˜¯ä¸€ä¸ªè¿ç»­çš„æ•°æ®æµã€‚å½“ç¨‹åºéœ€è¦è¯»æ•°æ®çš„æ—¶å€™å°±éœ€è¦ä½¿ç”¨è¾“å…¥æµè¯»å–æ•°æ®ï¼Œå½“éœ€è¦å¾€å¤–å†™æ•°æ®çš„æ—¶å€™å°±éœ€è¦è¾“å‡ºæµ</span><br></pre></td></tr></table></figure><ul><li><p>å­—èŠ‚æµï¼šå­—èŠ‚æµä¸»è¦ç”¨æ¥å¤„ç†å­—èŠ‚æˆ–äºŒè¿›åˆ¶å¯¹è±¡<code>InputStreamã€OutputStreamï¼Œ</code></p><blockquote><p>åœ¨ä½¿ç”¨å­—èŠ‚æµçš„æ—¶å€™ï¼ŒInputStreamå’ŒOutputStreaméƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–çš„éƒ½æ˜¯ä»–ä»¬çš„å­ç±»ï¼Œæ¯ä¸€ä¸ªå­ç±»éƒ½æœ‰è‡ªå·±çš„ä½œç”¨èŒƒå›´</p></blockquote><p><img src="https://i.imgur.com/s39Xj3r.png"></p></li><li><p>å­—ç¬¦æµï¼šå­—ç¬¦æµç”¨æ¥å¤„ç†å­—ç¬¦æ–‡æœ¬æˆ–å­—ç¬¦ä¸²<code>Readerã€Writer</code></p><blockquote><p>åœ¨ä½¿ç”¨å­—ç¬¦æµçš„æ—¶å€™ä¹Ÿæ˜¯ï¼ŒReaderå’ŒWriteréƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–çš„éƒ½æ˜¯ä»–ä»¬çš„å­ç±»ï¼Œæ¯ä¸€ä¸ªå­ç±»éƒ½æœ‰è‡ªå·±çš„ä½œç”¨èŒƒå›´</p></blockquote><p><img src="https://i.imgur.com/RMD0koG.png"></p></li><li><p>å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ</p><blockquote><p>ä½¿ç”¨<code>InputStreamReaderã€OutputStreamWriter</code>å¯ä»¥å°†è¾“å…¥å­—èŠ‚æµè½¬åŒ–ä¸ºè¾“å…¥å­—ç¬¦æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Reader reader  =  <span class="keyword">new</span> InputStreamReader(inputStream);</span><br><span class="line">Writer writer = <span class="keyword">new</span> OutputStreamWriter(outputStream)</span><br></pre></td></tr></table></figure></blockquote></li></ul><p>è¾“å…¥å­—èŠ‚æµï¼š<strong>InputStream</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/a.txt&quot;</span>);</span><br><span class="line">    InputStream inputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) file.length()];</span><br><span class="line">    inputStream.read(bytes);</span><br><span class="line">    System.out.println(<span class="keyword">new</span> String(bytes));</span><br><span class="line">    inputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥å­—ç¬¦æµï¼š<strong>Reader</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/a.txt&quot;</span>);</span><br><span class="line">    Reader reader = <span class="keyword">new</span> FileReader(file);</span><br><span class="line">    <span class="keyword">char</span>[] bytes = <span class="keyword">new</span> <span class="keyword">char</span>[(<span class="keyword">int</span>) file.length()];</span><br><span class="line">    reader.read(bytes);</span><br><span class="line">    System.out.println(<span class="keyword">new</span> String(bytes));</span><br><span class="line">    reader.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå­—èŠ‚æµï¼š<strong>OutputStream</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    String <span class="keyword">var</span> = <span class="string">&quot;hai this is a test&quot;</span>;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/b.txt&quot;</span>);</span><br><span class="line">    OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">    outputStream.write(<span class="keyword">var</span>.getBytes());</span><br><span class="line">    outputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå­—ç¬¦æµï¼š<strong>Writer</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    String <span class="keyword">var</span> = <span class="string">&quot;hai this is a test&quot;</span>;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/b.txt&quot;</span>);</span><br><span class="line">    Writer writer = <span class="keyword">new</span> FileWriter(file);</span><br><span class="line">    writer.write(<span class="keyword">var</span>);</span><br><span class="line">    writer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>BufferedInputStream</strong></p><blockquote><p>åœ¨ä½¿ç”¨InputStreamçš„æ—¶å€™ï¼Œéƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è¯»æˆ–å†™ï¼Œè€ŒBufferedInputStreamä¸ºè¾“å…¥å­—èŠ‚æµæä¾›äº†ç¼“å†²åŒºï¼Œè¯»æ•°æ®çš„æ—¶å€™ä¼šä¸€æ¬¡è¯»å–ä¸€å—æ•°æ®æ”¾åˆ°ç¼“å†²åŒºé‡Œï¼Œå½“ç¼“å†²åŒºé‡Œçš„æ•°æ®è¢«è¯»å®Œä¹‹åï¼Œè¾“å…¥æµä¼šå†æ¬¡å¡«å……æ•°æ®ç¼“å†²åŒºï¼Œç›´åˆ°è¾“å…¥æµè¢«è¯»å®Œï¼Œæœ‰äº†ç¼“å†²åŒºå°±èƒ½å¤Ÿæé«˜å¾ˆå¤šioé€Ÿåº¦</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * inputStream è¾“å…¥æµ</span></span><br><span class="line"><span class="comment"> * 1024 å†…éƒ¨ç¼“å†²åŒºå¤§å°ä¸º1024byte</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">BufferedInputStream bufferedInputStream = <span class="keyword">new</span> BufferedInputStream(inputStream,<span class="number">1024</span>);</span><br></pre></td></tr></table></figure><p><strong>BufferedOutputStream</strong></p><blockquote><p>BufferedOutputStreamå¯ä»¥ä¸ºè¾“å‡ºå­—èŠ‚æµæä¾›ç¼“å†²åŒºï¼Œä½œç”¨ä¸BufferedInputStreamç±»ä¼¼ï¼Œä½¿ç”¨æ–¹å¼å°†è¾“å‡ºæµåŒ…è£…åˆ°BufferedOutputStreamä¸­</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * outputStream è¾“å‡ºæµ</span></span><br><span class="line"><span class="comment"> * 1024 å†…éƒ¨ç¼“å†²åŒºå¤§å°ä¸º1024byte</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">BufferedOutputStream bufferedOutputStream = <span class="keyword">new</span> BufferedOutputStream(outputStream,<span class="number">1024</span>);</span><br></pre></td></tr></table></figure><p><strong>BufferedReader</strong></p><blockquote><p>ä¸ºè¾“å…¥å­—ç¬¦æµæä¾›ç¼“å†²åŒº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(reader,<span class="number">1024</span>);</span><br></pre></td></tr></table></figure><p><strong>BufferedWriter</strong></p><blockquote><p>ä¸ºè¾“å‡ºå­—ç¬¦æµæä¾›ç¼“å†²åŒº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(writer,<span class="number">1024</span>);</span><br></pre></td></tr></table></figure><h2 id="ioæ¨¡å‹"><a href="#ioæ¨¡å‹" class="headerlink" title="ioæ¨¡å‹"></a>ioæ¨¡å‹</h2><h3 id="bio"><a href="#bio" class="headerlink" title="bio"></a>bio</h3><blockquote><p>åŒæ­¥é˜»å¡IOæ¨¡å‹</p><p>JDK 1.4ç‰ˆæœ¬ä»¥å‰</p></blockquote><p><img src="https://chenmingyu.top/nio/bio%E7%BA%BF%E7%A8%8B.png"></p><p>åœ¨è¿™ç§æ¨¡å¼ä¸­é€šå¸¸ç”¨ä¸€ä¸ªçº¿ç¨‹å»æ¥å—è¯·æ±‚ï¼Œç„¶åç”¨ä¸€ä¸ªçº¿ç¨‹æ± å»å¤„ç†è¯·æ±‚ï¼Œç”¨è¿™ç§æ–¹å¼å¹¶å‘ç®¡ç†å¤šä¸ªSocketå®¢æˆ·ç«¯è¿æ¥</p><p><img src="https://chenmingyu.top/nio/BIO%E7%BA%BF%E7%A8%8B+%E7%BA%BF%E7%A8%8B%E6%B1%A0.png"></p><h3 id="nio"><a href="#nio" class="headerlink" title="nio"></a>nio</h3><blockquote><p>åŒæ­¥éé˜»å¡IOæ¨¡å‹</p><p>JDK 1.4ç‰ˆæœ¬ä»¥å</p></blockquote><p>æˆç†Ÿçš„æ¡†æ¶ï¼Œæ¯”å¦‚Netty</p><h3 id="aio"><a href="#aio" class="headerlink" title="aio"></a>aio</h3><blockquote><p>å¼‚æ­¥éé˜»å¡IOæ¨¡å‹</p><p>JDK1.7å‡çº§äº†Nioç±»åº“ï¼Œæˆä¸ºNio2.0ï¼Œæœ€ä¸»è¦çš„æ˜¯æä¾›äº†å¼‚æ­¥æ–‡ä»¶çš„IOæ“ä½œï¼Œä»¥åŠäº‹ä»¶é©±åŠ¨IOï¼ŒAIOçš„å¼‚æ­¥å¥—æ¥å­—é€šé“æ˜¯çœŸæ­£çš„å¼‚æ­¥éé˜»å¡IO</p></blockquote><p><img src="https://chenmingyu.top/nio/%E5%90%84IO%E6%A8%A1%E5%9E%8B%E5%AF%B9%E6%AF%94.png"></p><hr><p>å‚è€ƒï¼š</p><p><a href="https://chenmingyu.top/nio/">ä¸€æ–‡çœ‹æ‡‚java ioç³»ç»Ÿ</a></p><h1 id="Web-Application"><a href="#Web-Application" class="headerlink" title="Web Application"></a>Web Application</h1><h3 id="HTML-and-HTTP"><a href="#HTML-and-HTTP" class="headerlink" title="HTML and HTTP"></a>HTML and HTTP</h3><ul><li>HTML:HyperText Markup Language.</li><li>HTTP:HyperText Transfer Protocol<ul><li>HTTP is the communication protocol between server and client. HTTP runs on top of TCP/IP communication protocol.</li><li>Port numbers 0 to 1023 are reserved ports for well known services, for example 80 for HTTP, 443 for HTTPS, 21 for FTP etc.</li></ul></li><li>Java Servlet and JSPs are server side technologies to extend the capability of web servers by providing support for dynamic response and data persistence.</li></ul><h3 id="Web-Container"><a href="#Web-Container" class="headerlink" title="Web Container"></a>Web Container</h3><ul><li>When web container gets the request and if itâ€™s for servlet then container creates two Objects HTTPServletRequest and HTTPServletResponse. Then it finds the correct servlet based on the URL and creates a thread for the request. Then it invokes the servlet service() method and based on the HTTP method service() method invokes doGet() or doPost() methods. Servlet methods generate the dynamic page and write it to response. Once servlet thread is complete, container converts the response to HTTP response and send it back to client.</li><li>Some of the important work done by web container are:<ul><li>Communication Support â€“ Container provides easy way of communication between web server and the servlets and JSPs. Because of container, we donâ€™t need to build a server socket to listen for any request from web server, parse the request and generate response. All these important and complex tasks are done by container and all we need to focus is on our business logic for our applications.<ul><li>Lifecycle and Resource Management â€“ Container takes care of managing the life cycle of servlet. Container takes care of loading the servlets into memory, initializing servlets, invoking servlet methods and destroying them. Container also provides utility like JNDI for resource pooling and management.</li><li>Multithreading Support â€“ Container creates new thread for every request to the servlet and when itâ€™s processed the thread dies. So servlets are not initialized for each request and saves time and memory.</li><li>JSP Support â€“ JSPs doesnâ€™t look like normal java classes and web container provides support for JSP. Every JSP in the application is compiled by container and converted to Servlet and then container manages them like other servlets.</li><li>Miscellaneous Task â€“ Web container manages the resource pool, does memory optimizations, run garbage collector, provides security configurations, support for multiple applications, hot deployment and several other tasks behind the scene that makes our life easier.</li></ul></li></ul></li><li>Java Web Applications are packaged as Web Archive (WAR) and it has a defined structure.<br><img src="https://cdn.journaldev.com/wp-content/uploads/2013/08/WAR-directory-structure.png"></li></ul><h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><ul><li>Servlet API Hierarchy<br><img src="https://cdn.journaldev.com/wp-content/uploads/2013/08/Servlet-Hierarchy.png"></li></ul><h2 id="Session-Management"><a href="#Session-Management" class="headerlink" title="Session Management"></a>Session Management</h2><h3 id="What-is-a-Session"><a href="#What-is-a-Session" class="headerlink" title="What is a Session?"></a>What is a Session?</h3><ul><li>HTTP protocol and Web Servers are stateless, what it means is that for web server every request is a new request to process and they canâ€™t identify if itâ€™s coming from client that has been sending request previously.</li><li>Session is a conversional state between client and server and it can consists of multiple request and response between client and server. Since HTTP and Web Server both are stateless, the only way to maintain a session is when some unique information about the session (session id) is passed between server and client in every request and response.</li></ul><h3 id="JSESSIONID-Cookie"><a href="#JSESSIONID-Cookie" class="headerlink" title="JSESSIONID Cookie"></a>JSESSIONID Cookie</h3><ul><li>When we use HttpServletRequest getSession() method and it creates a new request, it creates the new HttpSession object and also add a Cookie to the response object with name JSESSIONID and value as session id. This cookie is used to identify the HttpSession object in further requests from client. If the cookies are disabled at client side and we are using URL rewriting then this method uses the jsessionid value from the request URL to find the corresponding session. JSESSIONID cookie is used for session tracking, so we should not use it for our application purposes to avoid any session related issues.</li><li>When a JSP resource is used, container automatically creates a session for it, so we canâ€™t check if session is null to make sure if user has come through login page, so we are using session attribute to validate request.</li><li>As we saw in last section that we can manage a session with HttpSession but if we disable the cookies in browser, it wonâ€™t work because server will not receive the JSESSIONID cookie from client. </li></ul><h4 id="Cookie-Basics"><a href="#Cookie-Basics" class="headerlink" title="Cookie Basics"></a>Cookie Basics</h4><ul><li>a cookie is a small piece of data stored on the client-side which servers use when communicating with clients.Theyâ€™re used to identify a client when sending a subsequent request. They can also be used for passing some data from one servlet to another.</li></ul><h1 id="design-pattern"><a href="#design-pattern" class="headerlink" title="design pattern"></a>design pattern</h1><h2 id="Creational-Design-Patterns"><a href="#Creational-Design-Patterns" class="headerlink" title="Creational Design Patterns"></a>Creational Design Patterns</h2><blockquote><p>These design patterns provide a way to create objects while hiding the creation logic, rather than instantiating objects directly using new operator. This gives program more flexibility in deciding which objects need to be created for a given use case.</p></blockquote><h3 id="Singleton"><a href="#Singleton" class="headerlink" title="Singleton"></a>Singleton</h3><blockquote><p>In Factory pattern, we create object without exposing the creation logic to the client and refer to newly created object using a common interface.</p></blockquote><ul><li><p>different approaches to implement:</p><ul><li>Private constructor to restrict instantiation of the class from other classes.</li><li>Private static variable of the same class that is the only instance of the class.</li><li>Public static method that returns the instance of the class, this is the global access point for outer world to get the instance of the singleton class.</li></ul></li><li><p>design concerns with the implementation</p><ul><li>Eager initialization</li><li>Static block initialization</li><li>Lazy Initialization</li><li>Thread Safe Singleton</li><li>Bill Pugh Singleton Implementation</li><li>Using Reflection to destroy Singleton Pattern</li><li>Enum Singleton</li><li>Serialization and Singleton</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SingleObject.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//create an object of SingleObject</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> SingleObject instance = <span class="keyword">new</span> SingleObject();</span><br><span class="line"></span><br><span class="line">   <span class="comment">//make the constructor private so that this class cannot be</span></span><br><span class="line">   <span class="comment">//instantiated</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">SingleObject</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//Get the only object available</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleObject <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//SingletonPatternDemo.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonPatternDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//illegal construct</span></span><br><span class="line">      <span class="comment">//Compile Time Error: The constructor SingleObject() is not visible</span></span><br><span class="line">      <span class="comment">//SingleObject object = new SingleObject();</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//Get the only object available</span></span><br><span class="line">      SingleObject object = SingleObject.getInstance();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//show the message</span></span><br><span class="line">      object.showMessage();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Factory"><a href="#Factory" class="headerlink" title="Factory"></a>Factory</h3><ul><li>Factory design pattern provides approach to code for interface rather than implementation.</li><li>Factory pattern removes the instantiation of actual implementation classes from client code. Factory pattern makes our code more robust, less coupled and easy to extend. For example, we can easily change PC class implementation because client program is unaware of this.</li><li>Factory pattern provides abstraction between implementation and client classes through inheritance.</li></ul><h3 id="Abstract-Factory"><a href="#Abstract-Factory" class="headerlink" title="Abstract Factory"></a>Abstract Factory</h3><ul><li>Abstract Factory design pattern provides approach to code for interface rather than implementation.</li><li>Abstract Factory pattern is â€œfactory of factoriesâ€ and can be easily extended to accommodate more products, for example we can add another sub-class Laptop and a factory LaptopFactory.</li><li>Abstract Factory pattern is robust and avoid conditional logic of Factory pattern.</li></ul><h3 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h3><ul><li>Builder pattern solves the issue with large number of optional parameters and inconsistent state by providing a way to build the object step-by-step and provide a method that will actually return the final Object.</li></ul><h3 id="Prototype"><a href="#Prototype" class="headerlink" title="Prototype"></a>Prototype</h3><ul><li>Prototype design pattern is used when the Object creation is a costly affair and requires a lot of time and resources and you have a similar object already existing.Prototype pattern provides a mechanism to copy the original object to a new object and then modify it according to our needs. Prototype design pattern uses java cloning to copy the object.</li></ul><h2 id="Structural-Design-Patterns"><a href="#Structural-Design-Patterns" class="headerlink" title="Structural Design Patterns"></a>Structural Design Patterns</h2><blockquote><p>These design patterns concern class and object composition. Concept of inheritance is used to compose interfaces and define ways to compose objects to obtain new functionalities.</p></blockquote><h3 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h3><ul><li>Adapter design pattern is one of the structural design pattern and its used so that two unrelated interfaces can work together. The object that joins these unrelated interface is called an Adapter.</li></ul><h3 id="Composite"><a href="#Composite" class="headerlink" title="Composite"></a>Composite</h3><ul><li>Composite design pattern is used when we have to represent a part-whole hierarchy.</li></ul><h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><ul><li>Proxy design pattern common uses are to control access or to provide a wrapper implementation for better performance.</li></ul><h3 id="Flyweight"><a href="#Flyweight" class="headerlink" title="Flyweight"></a>Flyweight</h3><ul><li>Use sharing to support large numbers of fine-grained objects efficiently</li></ul><h3 id="Facade"><a href="#Facade" class="headerlink" title="Facade"></a>Facade</h3><ul><li>Provide a unified interface to a set of interfaces in a subsystem. Facade Pattern defines a higher-level interface that makes the subsystem easier to use.</li></ul><h3 id="Bridge"><a href="#Bridge" class="headerlink" title="Bridge"></a>Bridge</h3><ul><li>Decouple an abstraction from its implementation so that the two can vary independently.</li></ul><h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><ul><li>Decorator design pattern is helpful in providing runtime modification abilities and hence more flexible. Its easy to maintain and extend when the number of choices are more.</li><li>The disadvantage of decorator design pattern is that it uses a lot of similar kind of objects (decorators).</li></ul><h2 id="Behavioral-Design-Patterns"><a href="#Behavioral-Design-Patterns" class="headerlink" title="Behavioral Design Patterns"></a>Behavioral Design Patterns</h2><blockquote><p>These design patterns are specifically concerned with communication between objects.</p></blockquote><h3 id="Template-Method"><a href="#Template-Method" class="headerlink" title="Template Method"></a>Template Method</h3><ul><li>Template method should consists of certain steps whose order is fixed and for some of the methods, implementation differs from base class to subclass. Template method should be final.</li><li>Most of the times, subclasses calls methods from super class but in template pattern, superclass template method calls methods from subclasses, this is known as Hollywood Principle â€“ â€œdonâ€™t call us, weâ€™ll call you.â€.</li><li>Methods in base class with default implementation are referred as Hooks and they are intended to be overridden by subclasses, if you want some of the methods to be not overridden, you can make them final, for example in our case we can make buildFoundation() method final because if we donâ€™t want subclasses to override it.</li></ul><h3 id="Media"><a href="#Media" class="headerlink" title="Media"></a>Media</h3><ul><li>Allows loose coupling by encapsulating the way disparate sets of objects interact and communicate with each other. Allows for the actions of each object set to vary independently of one another.</li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kafka learn</title>
      <link href="/2019/06/11/kafka%20snippet/"/>
      <url>/2019/06/11/kafka%20snippet/</url>
      
        <content type="html"><![CDATA[<h2 id="portï¼ˆconfluent-referenceï¼‰"><a href="#portï¼ˆconfluent-referenceï¼‰" class="headerlink" title="portï¼ˆconfluent referenceï¼‰"></a>portï¼ˆconfluent referenceï¼‰</h2><table><thead><tr><th align="left">Component</th><th align="left">Default Port</th></tr></thead><tbody><tr><td align="left">Zookeeper</td><td align="left">2181</td></tr><tr><td align="left">Apache Kafka brokers (plain text)</td><td align="left">9092</td></tr><tr><td align="left">Schema Registry REST API</td><td align="left">8081</td></tr><tr><td align="left">REST Proxy</td><td align="left">8082</td></tr><tr><td align="left">Kafka Connect REST API</td><td align="left">8083</td></tr><tr><td align="left">Confluent Control Center</td><td align="left">9021</td></tr></tbody></table><h2 id="System-Architecture"><a href="#System-Architecture" class="headerlink" title="System Architecture"></a>System Architecture</h2><p><img src="https://i.imgur.com/gG71h6m.png"></p><ul><li><strong>kafka Producer API:</strong> Applications directly producing data (ex: clickstream, logs, IoT).</li><li><strong>Kafka Connect Source API:</strong> Applications bridging between a datastore we donâ€™t control and Kafka (ex: CDC, Postgres, MongoDB, Twitter, REST API).</li><li><strong>Kafka Streams API / KSQL:</strong> Applications wanting to consume from Kafka and produce back into Kafka, also called stream processing. Use KSQL if you think you can write your real-time job as SQL-like, use Kafka Streams API if you think youâ€™re going to need to write complex logic for your job.</li><li><strong>Kafka Consumer API:</strong> Read a stream and perform real-time actions on it (e.g. send emailâ€¦)</li><li><strong>Kafka Connect Sink API</strong>: Read a stream and store it into a target store (ex: Kafka to S3, Kafka to HDFS, Kafka to PostgreSQL, Kafka to MongoDB, etc.)</li></ul><p><img src="https://www.sohamkamani.com/basic_arch-e0b11d2ab5b62a78cb7fd26d3a9d279b.svg"></p><ol><li><strong>Zookeeper</strong> : Which is used by Kafka to maintain state between the nodes of the cluster.</li><li><strong>Kafka brokers</strong> : The â€œpipesâ€ in our pipeline, which store and emit data.</li><li><strong>Producers</strong> : That insert data into the cluster.</li><li><strong>Consumers</strong> : That read data from the cluster.</li></ol><p><img src="https://kafka.apache.org/22/images/kafka-apis.png"></p><h3 id="Creating-a-topic"><a href="#Creating-a-topic" class="headerlink" title="Creating a topic"></a>Creating a topic</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh \</span><br><span class="line">--create \</span><br><span class="line">--topic my-kafka-topic \</span><br><span class="line">--zookeeper localhost:2181 \</span><br><span class="line">--partitions 3 \</span><br><span class="line">--replication-factor 2</span><br></pre></td></tr></table></figure><ul><li>The <code>paritions</code> options lets you decide how many brokers you want your data to be split between. Since we set up 3 brokers, we can set this option to 3.</li><li>The <code>replication-factor</code> describes how many copies of you data you want (in case one of the brokers goes down, you still have your data on the others).</li></ul><h3 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-producer.sh \</span><br><span class="line">--broker-list localhost:9093,localhost:9094,localhost:9095 \</span><br><span class="line">--topic my-kafka-topic</span><br></pre></td></tr></table></figure><h3 id="Consumers"><a href="#Consumers" class="headerlink" title="Consumers"></a>Consumers</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh \</span><br><span class="line">--bootstrap-server localhost:9093 \</span><br><span class="line">--topic my-kafka-topic \</span><br><span class="line">--from-beginning</span><br></pre></td></tr></table></figure><ul><li>The <code>bootstrap-server</code> can be any one of the brokers in the cluster.</li><li>The <code>from-beginning</code> option tells the cluster that you want all the messages that it currently has with it, even messages that we put into it previously.</li></ul><p>Try starting another consumer in a different terminal window:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh \</span><br><span class="line">--bootstrap-server localhost:9093 \</span><br><span class="line">--topic my-kafka-topic \</span><br><span class="line">--from-beginning \</span><br><span class="line">--group group2</span><br></pre></td></tr></table></figure><h2 id="Kafka-as-a-Messaging-System"><a href="#Kafka-as-a-Messaging-System" class="headerlink" title="Kafka as a Messaging System"></a>Kafka as a Messaging System</h2><ul><li><p>As with a queue the consumer group allows you to divide up processing over a collection of processes (the members of the consumer group). As with publish-subscribe, Kafka allows you to broadcast messages to multiple consumer groups.</p><p><img src="https://kafka.apache.org/22/images/consumer-groups.png"></p></li><li><p>Kafka does it better. By having a notion of parallelismâ€”the partitionâ€”within the topics, Kafka is able to provide both ordering guarantees and load balancing over a pool of consumer processes. This is achieved by assigning the partitions in the topic to the consumers in the consumer group so that each partition is consumed by exactly one consumer in the group. By doing this we ensure that the consumer is the only reader of that partition and consumes the data in order. Since there are many partitions this still balances the load over many consumer instances. Note however that there cannot be more consumer instances in a consumer group than partitions.</p></li><li><p>Each record consists of a key, a value, and a timestamp.</p></li></ul><h2 id="Kafka-as-a-Storage-System"><a href="#Kafka-as-a-Storage-System" class="headerlink" title="Kafka as a Storage System"></a>Kafka as a Storage System</h2><h2 id="Kafka-as-Stream-Processing"><a href="#Kafka-as-Stream-Processing" class="headerlink" title="Kafka as Stream Processing"></a>Kafka as Stream Processing</h2><h2 id="source-code"><a href="#source-code" class="headerlink" title="source code"></a>source code</h2><h3 id="æºç æ–‡ä»¶ç»“æ„"><a href="#æºç æ–‡ä»¶ç»“æ„" class="headerlink" title="æºç æ–‡ä»¶ç»“æ„"></a>æºç æ–‡ä»¶ç»“æ„</h3><table><thead><tr><th>ç›®å½•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>bin</td><td>å­˜æ”¾å¯ç›´æ¥åœ¨Linuxæˆ–Windowsä¸Šè¿è¡Œçš„.shæ–‡ä»¶å’Œ.batæ–‡ä»¶ï¼ŒåŒ…å«Kafkaå¸¸ç”¨æ“ä½œä»¥åŠZooKeeperä¾¿æ·è„šæœ¬</td></tr><tr><td>checkstyle</td><td>å­˜æ”¾ä»£ç è§„èŒƒæ£€æŸ¥æ–‡æ¡£</td></tr><tr><td>clients</td><td>å®¢æˆ·ç«¯çš„å®ç°</td></tr><tr><td>config</td><td>å­˜æ”¾é…ç½®æ–‡ä»¶</td></tr><tr><td>connetct</td><td>Kafka Connectå·¥å…·çš„å®ç°</td></tr><tr><td>core</td><td>æ ¸å¿ƒæ¨¡å—</td></tr><tr><td>docs</td><td>å®˜æ–¹æ–‡æ¡£</td></tr><tr><td>examples</td><td>Kafkaç”Ÿäº§è€…æ¶ˆè´¹è€…ç®€å•Demo</td></tr><tr><td>jmh-benchmarks</td><td>åŸºå‡†æµ‹è¯•æ¨¡å—</td></tr><tr><td>log4j-appender</td><td>æ—¥å¿—æ¨¡å—</td></tr><tr><td>streams</td><td>Kafka Streamså®¢æˆ·ç«¯åº“</td></tr><tr><td>tools</td><td>å·¥å…·ç±»</td></tr></tbody></table><h3 id="æ ¸å¿ƒæ¨¡å—ç»“æ„"><a href="#æ ¸å¿ƒæ¨¡å—ç»“æ„" class="headerlink" title="æ ¸å¿ƒæ¨¡å—ç»“æ„"></a>æ ¸å¿ƒæ¨¡å—ç»“æ„</h3><table><thead><tr><th>ç›®å½•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>admin</td><td>ç®¡ç†æ¨¡å—ï¼Œæ“ä½œå’Œç®¡ç†topicï¼Œ broker, consumer groupï¼Œ recordsç­‰</td></tr><tr><td>api</td><td>å°è£…è°ƒç”¨</td></tr><tr><td>client</td><td>Producerç”Ÿäº§çš„å…ƒæ•°æ®ä¿¡æ¯çš„ä¼ é€’</td></tr><tr><td>cluster</td><td>å­˜æ´»çš„Brokeré›†ç¾¤ã€åˆ†åŒºã€å‰¯æœ¬ä»¥åŠä»–ä»¬çš„åº•å±‚å±æ€§å’Œç›¸äº’å…³ç³»</td></tr><tr><td>common</td><td>å¼‚å¸¸ç±»ã€æšä¸¾ç±»ã€æ ¼å¼åŒ–ç±»ã€é…ç½®ç±»ç­‰</td></tr><tr><td>consumer</td><td>æ—§ç‰ˆæœ¬çš„åºŸå¼ƒæ¶ˆè´¹è€…ç±»</td></tr><tr><td>controller</td><td>Kafkaé›†ç¾¤æ§åˆ¶ä¸­å¿ƒçš„é€‰ä¸¾ï¼Œåˆ†åŒºçŠ¶æ€ç®¡ç†ï¼Œåˆ†åŒºå‰¯æœ¬çŠ¶æ€ç®¡ç†ï¼Œç›‘å¬ZooKeeperæ•°æ®å˜åŒ–ç­‰</td></tr><tr><td>coordinator</td><td>GroupCoordinatorå¤„ç†ä¸€èˆ¬ç»„æˆå‘˜èµ„æ ¼å’Œåç§»é‡ã€‚transactionç®¡ç†äº‹åŠ¡</td></tr><tr><td>javaapi</td><td>ç»™javaè°ƒç”¨çš„ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€æ¶ˆæ¯é›†api</td></tr><tr><td>log</td><td>ç®¡ç†logï¼Œå®ƒæ˜¯æ¶ˆæ¯å­˜å‚¨çš„å½¢å¼ï¼Œå¯å¯¹åº”åˆ°ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¤¹</td></tr><tr><td>message</td><td>ç”±æ¶ˆæ¯å°è£…è€Œæˆçš„ä¸€ä¸ªå‹ç¼©æ¶ˆæ¯é›†</td></tr><tr><td>metrics</td><td>Kafkaç›‘æ§æ¨¡å—</td></tr><tr><td>network</td><td>ç½‘ç»œç®¡ç†æ¨¡å—ï¼Œå¯¹å®¢æˆ·ç«¯è¿æ¥çš„å¤„ç†</td></tr><tr><td>producer</td><td>æ—§ç‰ˆæœ¬çš„åºŸå¼ƒç”Ÿäº§è€…ç±»</td></tr><tr><td>security</td><td>æƒé™ç®¡ç†</td></tr><tr><td>serializer</td><td>æ¶ˆæ¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ–å¤„ç†</td></tr><tr><td>server</td><td>æœåŠ¡å™¨ç«¯çš„å®ç°</td></tr><tr><td>tools</td><td>å„ç§æ§åˆ¶å°å·¥å…·çš„å®ç°</td></tr><tr><td>utils</td><td>å·¥å…·ç±»</td></tr><tr><td>zk</td><td>æä¾›ä¸ZooKeeperäº¤äº’çš„ç®¡ç†æ–¹æ³•å’Œåœ¨ç®¡é“ä¹‹ä¸Šçš„æ›´é«˜çº§åˆ«çš„Kafkaç‰¹å®šæ“ä½œ</td></tr><tr><td>zookeeper</td><td>ä¸€ä¸ªä¿ƒè¿›ç®¡é“ä¼ è¾“è¯·æ±‚çš„ZooKeeperå®¢æˆ·ç«¯</td></tr></tbody></table><h1 id="ä¸»é¢˜åˆ†åŒº"><a href="#ä¸»é¢˜åˆ†åŒº" class="headerlink" title="ä¸»é¢˜åˆ†åŒº"></a>ä¸»é¢˜åˆ†åŒº</h1><ul><li>è°ƒæ•´åˆ†åŒº</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper localhost:2181 --alter --topic my-topic --partitions 10</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹åˆ†åŒº</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper localhost:2181 --describe --topic my-topic</span><br></pre></td></tr></table></figure><h1 id="Restful-API"><a href="#Restful-API" class="headerlink" title="Restful API"></a>Restful API</h1><h2 id="AVROä¸»é¢˜ç›¸å…³"><a href="#AVROä¸»é¢˜ç›¸å…³" class="headerlink" title="AVROä¸»é¢˜ç›¸å…³"></a>AVROä¸»é¢˜ç›¸å…³</h2><blockquote><p>ä¸€èˆ¬schema registry é»˜è®¤ç«¯å£æ˜¯8081ï¼ˆæœ‰æ—¶å€™é¿å…ä¸flink-jobmanagerç«¯å£å†²çªï¼Œæ”¹ä¸ºåˆ«çš„ç«¯å£å· 8091ï¼‰</p></blockquote><ul><li><p>è·å–æ‰€æœ‰ä¸»é¢˜ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;http://&lt;schema-registry-url&gt;:&lt;port&gt;/subjects&quot;</span><br></pre></td></tr></table></figure></li><li><p>æ ¹æ®schema idæŸ¥ä¸‹ç›¸å…³ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;http://&lt;schema-registry-url&gt;:&lt;port&gt;/schemas/ids/&lt;schema-id&gt;&quot;</span><br></pre></td></tr></table></figure></li><li><p>è·å–æŒ‡å®šä¸»é¢˜key/valueç›¸å…³schemaä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://&lt;schema-registry-url&gt;:&lt;port&gt;/subjects/&lt;topic-name&gt;-value/versions/latest</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://&lt;schema-registry-url&gt;:&lt;port&gt;/subjects/&lt;topic-name&gt;-key/versions/latest</span><br></pre></td></tr></table></figure></li></ul><h1 id="å‚æ•°è°ƒä¼˜"><a href="#å‚æ•°è°ƒä¼˜" class="headerlink" title="å‚æ•°è°ƒä¼˜"></a>å‚æ•°è°ƒä¼˜</h1><h1 id="producer"><a href="#producer" class="headerlink" title="producer"></a>producer</h1><ul><li>batch.size é»˜è®¤16384</li><li>request.time.ms é»˜è®¤30000ï¼ˆ30ç§’ï¼‰</li></ul><h2 id="åˆ†åŒºå’Œå‰¯æœ¬"><a href="#åˆ†åŒºå’Œå‰¯æœ¬" class="headerlink" title="åˆ†åŒºå’Œå‰¯æœ¬"></a>åˆ†åŒºå’Œå‰¯æœ¬</h2><p>Kafkaä¸­çš„åˆ†åŒºï¼ˆPartitionï¼‰å’Œå‰¯æœ¬ï¼ˆReplicaï¼‰æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œå®ƒä»¬åœ¨æ¶ˆæ¯ä¼ è¾“å’Œå­˜å‚¨æ–¹é¢èµ·åˆ°ä¸åŒçš„ä½œç”¨ã€‚</p><ol><li>åˆ†åŒºï¼ˆPartitionï¼‰</li></ol><p>Kafkaçš„æ¯ä¸ªTopicéƒ½å¯ä»¥è¢«åˆ†æˆå¤šä¸ªPartitionï¼Œæ¯ä¸ªPartitionåªä¼šè¢«ä¸€ä¸ªConsumer Groupä¸­çš„ä¸€ä¸ªConsumeræ¶ˆè´¹ã€‚åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šè¿‡å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªPartitionä¸­ï¼Œå¯ä»¥ä½¿å¾—å„ä¸ªèŠ‚ç‚¹è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†æ›´å¤§é‡çº§çš„æ•°æ®ã€‚æ¯ä¸ªPartitionå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªé€’å¢çš„offsetï¼ˆåç§»é‡ï¼‰ï¼Œé€šè¿‡offsetæ¥æ ‡è¯†Consumeråœ¨è¯¥Partitionä¸­å·²ç»æ¶ˆè´¹çš„æ¶ˆæ¯ä½ç½®ã€‚</p><ol><li>å‰¯æœ¬ï¼ˆReplicaï¼‰</li></ol><p>Kafkaä¸­çš„å‰¯æœ¬æ˜¯æŒ‡æ¯ä¸ªPartitionçš„å¤‡ä»½ï¼Œä¸€ä¸ªPartitionå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½ä¿å­˜ç€å®Œæ•´çš„æ•°æ®å‰¯æœ¬ã€‚å‰¯æœ¬ä¹‹é—´æœ‰ä¸€ä¸ªLeader-Followerçš„å…³ç³»ï¼Œå…¶ä¸­ä¸€ä¸ªå‰¯æœ¬ä½œä¸ºLeaderï¼Œå…¶ä»–å‰¯æœ¬ä½œä¸ºFollowerã€‚å®¢æˆ·ç«¯åªèƒ½å‘Leaderå‘é€è¯»å†™è¯·æ±‚ï¼Œè€ŒFolloweråªç”¨äºå¤‡ä»½å’ŒåŒæ­¥æ•°æ®ï¼Œä¸èƒ½ç›´æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚å½“Leaderå‡ºç°æ•…éšœæ—¶ï¼ŒKafkaä¼šè‡ªåŠ¨å°†Followerå‡çº§ä¸ºæ–°çš„Leaderï¼Œä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚</p><p><strong>æ€»ç»“ï¼šåˆ†åŒºå®ç°äº†æ•°æ®çš„æ°´å¹³åˆ‡åˆ†å’Œè´Ÿè½½å‡è¡¡ï¼Œè€Œå‰¯æœ¬åˆ™æä¾›äº†æ•°æ®çš„å†—ä½™å¤‡ä»½å’Œé«˜å¯ç”¨æ€§ï¼Œç¡®ä¿æ•°æ®å®‰å…¨å’Œä¸šåŠ¡è¿ç»­æ€§ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯è§„åˆ’æ¥è®¾ç½®åˆ†åŒºå’Œå‰¯æœ¬çš„æ•°é‡ï¼Œä»¥æé«˜KafkaæœåŠ¡çš„å¯é æ€§å’Œæ€§èƒ½ã€‚</strong></p><h2 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><ul><li><p>æ¶ˆè´¹sasl_plaintext scram-sha-256è®¤è¯çš„ä¸»é¢˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer.sh --bootstrap-server your_kafka_bootstrap_servers --topic your_topic --group your_consumer_group --consumer.config client-sasl.properties --from-beginning</span><br></pre></td></tr></table></figure><p>å…¶ä¸­client-sasl.propertiesä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.mechanism=SCRAM-SHA-256</span><br><span class="line">sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required username=&quot;your_username&quot; password=&quot;your_password&quot;;</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ¶ˆè´¹è€…ç»„"><a href="#æ¶ˆè´¹è€…ç»„" class="headerlink" title="æ¶ˆè´¹è€…ç»„"></a>æ¶ˆè´¹è€…ç»„</h2><ul><li><p>æŸ¥è¯¢æ¶ˆè´¹è€…ç»„çš„åç§»é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-consumer-groups.sh --bootstrap-server &lt;bootstrap-server&gt; --group &lt;consumer-group&gt; --describe</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šæ¶ˆè´¹è€…ç»„çš„åç§»é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-consumer-groups.sh --bootstrap-server &lt;bootstrap-server&gt; --group &lt;consumer-group&gt; --topic &lt;topic&gt; --reset-offsets --to-offset &lt;new-offset&gt; --execute</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šæ¶ˆè´¹ç»„åç§»é‡åˆ°æœ€æ—©</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-consumer-groups.sh --bootstrap-server &lt;bootstrap-server&gt; --group &lt;consumer-group&gt; --reset-offsets --to-earliest --execute --topic your_topic</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h2><ul><li><p>ä½¿ä¸ºç‰¹å®šä¸»é¢˜ï¼ˆtopicï¼‰é…ç½®æ•°æ®çš„ä¿ç•™æ—¶é—´ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-configs.sh --bootstrap-server &lt;KAFKA_BROKER_ADDRESS&gt; --alter --entity-type topics --entity-name &lt;TOPIC_NAME&gt; --add-config retention.ms=&lt;RETENTION_TIME_IN_MILLISECONDS&gt;</span><br></pre></td></tr></table></figure><p>eg:(è®¾ç½®my-topicä¸»é¢˜ä¿ç•™ä¸€å¤©æ•°æ®)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-configs.sh --bootstrap-server localhost:9092 --alter --entity-type topics --entity-name my-topic --add-config retention.ms=86400000</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> kafka </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javarevisited</title>
      <link href="/2019/05/24/hadoop%20learn/"/>
      <url>/2019/05/24/hadoop%20learn/</url>
      
        <content type="html"><![CDATA[<p><img src="./img/Hadoop-Multi-node-Cluster.png"></p><p><img src="./img/hdfsarchitecture.gif"></p><h3 id="NameNode"><a href="#NameNode" class="headerlink" title="NameNode"></a>NameNode</h3><ul><li>The <strong>NameNode</strong> executes file system namespace operations like opening, closing, and renaming files and directories.It also determines the mapping of blocks to DataNodes.</li></ul><h3 id="DataNodes"><a href="#DataNodes" class="headerlink" title="DataNodes"></a>DataNodes</h3><ul><li>The <strong>DataNodes</strong> are responsible for serving read and write requests from the file systemâ€™s clients. The DataNodes also perform block creation, deletion, and replication upon instruction from the NameNode.</li><li>The DataNode stores HDFS data in files in its local file system.The DataNode has no knowledge about HDFS files. It stores each block of HDFS data in a separate file in its local file system.</li></ul><h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><ul><li><p>a file is split into one or more blocks and these blocks are stored in a set of DataNodes. </p></li><li><p>all blocks in a file except the last block are the same size.</p></li><li><p>Files in HDFS are write-once and have strictly one writer at any time.</p></li></ul><h3 id="The-Persistence-of-File-System-Metadata"><a href="#The-Persistence-of-File-System-Metadata" class="headerlink" title="The Persistence of File System Metadata"></a>The Persistence of File System Metadata</h3><ul><li>The NameNode uses a transaction log called the <strong>EditLog</strong> to persistently record every change that occurs to file system metadata.</li><li>The entire file system namespace, including the mapping of blocks to files and file system properties, is stored in a file called the <strong>FsImage</strong>. The FsImage is stored as a file in the NameNodeâ€™s local file system too.</li></ul><hr><p><strong>Blockreport</strong>: DataNode scans through its local file system, generates a list of all HDFS data blocks that correspond to each of these local files and sends this report to the NameNode</p><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p>2.7.3æºç </p><ul><li>ç¼–è¯‘é—®é¢˜</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é—®é¢˜ï¼šFailed to parse plugin descriptor for org.apache.hadoop:hadoop-maven-plugins</span><br><span class="line"></span><br><span class="line">è§£å†³ï¼šcdåˆ°hadoop-maven-pluginsï¼Œæ‰§è¡Œmvn clean ç„¶å install ä¸€ä¸‹ï¼Œå†æ‰§è¡Œç¼–è¯‘é€šè¿‡</span><br></pre></td></tr></table></figure><h1 id="ç«¯å£"><a href="#ç«¯å£" class="headerlink" title="ç«¯å£"></a>ç«¯å£</h1><h1 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h1><h2 id="DataNode"><a href="#DataNode" class="headerlink" title="DataNode"></a>DataNode</h2><pre><code> 50010  dfs.datanode.address   datanodeæœåŠ¡ç«¯å£ï¼Œç”¨äºæ•°æ®ä¼ è¾“50075  dfs.datanode.http.address  httpæœåŠ¡çš„ç«¯å£50475  dfs.datanode.https.address  httpsæœåŠ¡çš„ç«¯å£50020  dfs.datanode.ipc.address   ipcæœåŠ¡çš„ç«¯å£</code></pre><h2 id="NameNode-1"><a href="#NameNode-1" class="headerlink" title="NameNode"></a>NameNode</h2><p>â€‹     50070  dfs.namenode.http-address  httpæœåŠ¡çš„ç«¯å£ ï¼ˆ<strong>è®¿é—®hadoopçš„ç®¡ç†é¡µé¢</strong>ï¼‰<br>â€‹    50470  dfs.namenode.https-address  httpsæœåŠ¡çš„ç«¯å£<br>â€‹    8020   fs.defaultFS   æ¥æ”¶Clientè¿æ¥çš„RPCç«¯å£ï¼Œç”¨äºè·å–æ–‡ä»¶ç³»ç»Ÿmetadataä¿¡æ¯ã€‚</p><h2 id="journalnode"><a href="#journalnode" class="headerlink" title="journalnode"></a>journalnode</h2><pre><code> 8485   dfs.journalnode.rpc-address   RPCæœåŠ¡ 8480   dfs.journalnode.http-address   HTTPæœåŠ¡</code></pre><h2 id="ZKFC"><a href="#ZKFC" class="headerlink" title="ZKFC"></a>ZKFC</h2><pre><code> 8019   dfs.ha.zkfc.port   ZooKeeper FailoverControllerï¼Œç”¨äºNN HA</code></pre><h2 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h2><h2 id="ResourceManager"><a href="#ResourceManager" class="headerlink" title="ResourceManager"></a>ResourceManager</h2><pre><code>8032  yarn.resourcemanager.address   RMçš„applications manager(ASM)ç«¯å£8030  yarn.resourcemanager.scheduler.address  schedulerç»„ä»¶çš„IPCç«¯å£8031  yarn.resourcemanager.resource-tracker.address  IPC8033  yarn.resourcemanager.admin.address  IPC8088  yarn.resourcemanager.webapp.address   httpæœåŠ¡ç«¯å£ï¼ˆ**è®¿é—®yarnçš„ç®¡ç†é¡µé¢**ï¼‰</code></pre><h2 id="NodeManager"><a href="#NodeManager" class="headerlink" title="NodeManager"></a>NodeManager</h2> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">8040  yarn.nodemanager.localizer.address  localizer IPC</span><br><span class="line">8042  yarn.nodemanager.webapp.address   httpæœåŠ¡ç«¯å£ï¼ˆ**ä»èŠ‚ç‚¹nodeç®¡ç†ç•Œé¢ï¼Œå¯æŸ¥çœ‹èŠ‚ç‚¹çš„ä»»åŠ¡å¤„ç†ä¿¡æ¯**ï¼‰</span><br><span class="line">8041  yarn.nodemanager.address   NMä¸­container managerçš„ç«¯å£</span><br></pre></td></tr></table></figure><h2 id="JobHistory-Server"><a href="#JobHistory-Server" class="headerlink" title="JobHistory Server"></a>JobHistory Server</h2><pre><code>10020   mapreduce.jobhistory.address   IPC19888   mapreduce.jobhistory.webapp.address   httpæœåŠ¡ç«¯å£</code></pre><h1 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h1>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Master</span><br><span class="line">    60000   hbase.master.port  IPC</span><br><span class="line">    60010   hbase.master.info.port  httpæœåŠ¡ç«¯å£</span><br><span class="line">RegionServer</span><br><span class="line">    60020   hbase.regionserver.port   IPC</span><br><span class="line">    60030   hbase.regionserver.info.port   httpæœåŠ¡ç«¯å£</span><br><span class="line">HQuorumPeer</span><br><span class="line">    2181  hbase.zookeeper.property.clientPort   HBase-managed ZK modeï¼Œä½¿ç”¨ç‹¬ç«‹çš„ZooKeeperé›†ç¾¤åˆ™ä¸ä¼šå¯ç”¨è¯¥ç«¯å£ã€‚</span><br><span class="line">    2888  hbase.zookeeper.peerport   HBase-managed ZK modeï¼Œä½¿ç”¨ç‹¬ç«‹çš„ZooKeeperé›†ç¾¤åˆ™ä¸ä¼šå¯ç”¨è¯¥ç«¯å£ã€‚</span><br><span class="line">    3888  hbase.zookeeper.leaderport  HBase-managed ZK modeï¼Œä½¿ç”¨ç‹¬ç«‹çš„ZooKeeperé›†ç¾¤åˆ™ä¸ä¼šå¯ç”¨è¯¥ç«¯å£ã€‚</span><br></pre></td></tr></table></figure><h1 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Metastore</span><br><span class="line">     9083  /etc/default/hive-metastoreä¸­export PORT=&lt;port&gt;æ¥æ›´æ–°é»˜è®¤ç«¯å£   </span><br><span class="line">HiveServer</span><br><span class="line">     10000   /etc/hive/conf/hive-env.shä¸­export HIVE_SERVER2_THRIFT_PORT=&lt;port&gt;æ¥æ›´æ–°é»˜è®¤ç«¯å£   </span><br></pre></td></tr></table></figure><h1 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Server</span><br><span class="line">     2181  /etc/zookeeper/conf/zoo.cfgä¸­clientPort=&lt;port&gt;  å¯¹å®¢æˆ·ç«¯æä¾›æœåŠ¡çš„ç«¯å£</span><br><span class="line">     2888  /etc/zookeeper/conf/zoo.cfgä¸­server.x=[hostname]:nnnnn[:nnnnn]ï¼Œæ ‡è“éƒ¨åˆ†  followerç”¨æ¥è¿æ¥åˆ°leaderï¼Œåªåœ¨leaderä¸Šç›‘å¬è¯¥ç«¯å£ã€‚</span><br><span class="line">     3888  /etc/zookeeper/conf/zoo.cfgä¸­server.x=[hostname]:nnnnn[:nnnnn]ï¼Œæ ‡è“éƒ¨åˆ†  ç”¨äºleaderé€‰ä¸¾çš„ã€‚åªåœ¨electionAlgæ˜¯1,2æˆ–3(é»˜è®¤)æ—¶éœ€è¦ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hadoop snippet</title>
      <link href="/2019/05/24/hadoop%20snippt/"/>
      <url>/2019/05/24/hadoop%20snippt/</url>
      
        <content type="html"><![CDATA[<h1 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h1><h2 id="1-Create-a-directory-in-HDFS-at-given-path-s"><a href="#1-Create-a-directory-in-HDFS-at-given-path-s" class="headerlink" title="1. Create a directory in HDFS at given path(s)."></a>1. Create a directory in HDFS at given path(s).</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mkdir &lt;paths&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop dfs -mkdir /user/saurzcode/dir1 /user/saurzcode/dir2</span><br></pre></td></tr></table></figure><h2 id="2-List-the-contents-of-a-directory"><a href="#2-List-the-contents-of-a-directory" class="headerlink" title="2.  List the contents of a directory."></a>2.  List the contents of a directory.</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -ls &lt;args&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -ls /user/saurzcode</span><br></pre></td></tr></table></figure><h2 id="3-Upload-and-download-a-file-in-HDFS"><a href="#3-Upload-and-download-a-file-in-HDFS" class="headerlink" title="3. Upload and download a file in HDFS."></a>3. Upload and download a file in HDFS.</h2><p><strong>Upload:</strong></p><p><strong>hdfs fs -put:</strong></p><p>Copy single src file, or multiple src files from local file system to the hdfs data file system</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -put &lt;localsrc&gt; ... &lt;HDFS_dest_Path&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -put /home/saurzcode/Samplefile.txt  /user/saurzcode/dir3/</span><br></pre></td></tr></table></figure><p><strong>*Download:</strong>*</p><p><strong>hdfs fs -get:</strong></p><p>Copies/Downloads files to the local file system</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -get &lt;hdfs_src&gt; &lt;localdst&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -get /user/saurzcode/dir3/Samplefile.txt /home/</span><br></pre></td></tr></table></figure><h2 id="4-See-contents-of-a-file"><a href="#4-See-contents-of-a-file" class="headerlink" title="4. See contents of a file"></a>4. See contents of a file</h2><p>Same as unix cat command:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -cat &lt;path[filename]&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -cat /user/saurzcode/dir1/abc.txt</span><br></pre></td></tr></table></figure><h2 id="5-Copy-a-file-from-source-to-destination"><a href="#5-Copy-a-file-from-source-to-destination" class="headerlink" title="5. Copy a file from source to destination"></a>5. Copy a file from source to destination</h2><p>This command allows multiple sources as well in which case the destination must be a directory.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -cp &lt;source&gt; &lt;dest&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -cp /user/saurzcode/dir1/abc.txt /user/saurzcode/dir2</span><br></pre></td></tr></table></figure><h2 id="6-Copy-a-file-from-To-Local-file-system-to-HDFS"><a href="#6-Copy-a-file-from-To-Local-file-system-to-HDFS" class="headerlink" title="6. Copy a file from/To Local file system to HDFS"></a>6. Copy a file from/To Local file system to HDFS</h2><p><strong>copyFromLocal</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -copyFromLocal &lt;localsrc&gt; URI</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -copyFromLocal /home/saurzcode/abc.txt  /user/saurzcode/abc.txt</span><br></pre></td></tr></table></figure><p>Similar to put command, except that the source is restricted to a local file reference.</p><p><strong>copyToLocal</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -copyToLocal [-ignorecrc] [-crc] URI &lt;localdst&gt;</span><br></pre></td></tr></table></figure><p>Similar to get command, except that the destination is restricted to a local file reference.</p><h2 id="7-Move-file-from-source-to-destination"><a href="#7-Move-file-from-source-to-destination" class="headerlink" title="7. Move file from source to destination."></a>7. Move file from source to destination.</h2><p>Note:- Moving files across filesystem is not permitted.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mv &lt;src&gt; &lt;dest&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mv /user/saurzcode/dir1/abc.txt /user/saurzcode/dir2</span><br></pre></td></tr></table></figure><h2 id="8-Remove-a-file-or-directory-in-HDFS"><a href="#8-Remove-a-file-or-directory-in-HDFS" class="headerlink" title="8. Remove a file or directory in HDFS."></a>8. Remove a file or directory in HDFS.</h2><p>Remove files specified as argument. Deletes directory only when it is empty</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rm &lt;arg&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rm /user/saurzcode/dir1/abc.txt</span><br></pre></td></tr></table></figure><p><strong>*Recursive version of delete.</strong>*</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rmr &lt;arg&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rmr /user/saurzcode/</span><br></pre></td></tr></table></figure><h2 id="9-Display-last-few-lines-of-a-file"><a href="#9-Display-last-few-lines-of-a-file" class="headerlink" title="9. Display last few lines of a file."></a>9. Display last few lines of a file.</h2><p>Similar to tail command in Unix.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -tail &lt;path[filename]&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -tail /user/saurzcode/dir1/abc.txt</span><br></pre></td></tr></table></figure><h2 id="10-Display-the-aggregate-length-of-a-file"><a href="#10-Display-the-aggregate-length-of-a-file" class="headerlink" title="10. Display the aggregate length of a file."></a>10. Display the aggregate length of a file.</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage :</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -du &lt;path&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">hdfs dfs -du /user/saurzcode/dir1/abc.txt</span><br></pre></td></tr></table></figure><p>Please comment which of these commands you found most useful while dealing with Hadoop /HDFS.</p><h2 id="11-æŸ¥çœ‹æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶"><a href="#11-æŸ¥çœ‹æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶" class="headerlink" title="11. æŸ¥çœ‹æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶"></a>11. æŸ¥çœ‹æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -lsr /your/hdfs/directory</span><br></pre></td></tr></table></figure><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="Hadoop-Operation-category-READ-is-not-supported-in-state-standby"><a href="#Hadoop-Operation-category-READ-is-not-supported-in-state-standby" class="headerlink" title="Hadoop Operation category READ is not supported in state standby"></a>Hadoop Operation category READ is not supported in state standby</h2><ul><li><p>æŠ¥é”™åŸå› <br>hadoopé›†ç¾¤ä¸­çš„ä¸¤ä¸ªNameNodeå‡ä¸ºstandbyçŠ¶æ€ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hdfs haadmin -getServiceState nn1</span><br><span class="line">hdfs haadmin -getServiceState nn2</span><br></pre></td></tr></table></figure></li></ul><p>â€‹        å¦‚æœä¸¤ä¸ªNameNodeå‡ä¸ºstandbyçŠ¶æ€ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯DFSZKFailoverControllerå‡ºç°äº†é—®é¢˜ã€‚</p><ul><li><p>æŠ¥é”™è§£å†³</p><ul><li><p>æ‰‹åŠ¨æ”¹å˜å…¶ä¸­ä¸€ä¸ªNameNodeçš„çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs haadmin -transitionToActive -forcemanual nn1</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœæ‰‹åŠ¨æ”¹å˜çŠ¶æ€ä¸èƒ½è§£å†³é—®é¢˜ï¼Œé‚£å°±é‡å¯dfs</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop-dfs.sh</span><br><span class="line">start-dfs.sh</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å†æ£€æŸ¥NameNodeçŠ¶æ€</p><p>æ­¤æ—¶æ­£å¸¸çŠ¶æ€æ˜¯nn1ä¸ºactiveï¼Œnn2ä¸ºstandby</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> hadoop </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rabbitmq learn</title>
      <link href="/2019/05/14/rabbitmq/"/>
      <url>/2019/05/14/rabbitmq/</url>
      
        <content type="html"><![CDATA[<ul><li><p>æŸ¥è¯¢å·²æœ‰queue</p><p><code>sudo rabbitmqctl list_queues</code></p></li><li><p>æŸ¥è¯¢å·²æœ‰exchanges</p><p><code>sudo rabbitmqctl list_exchanges</code></p></li></ul><h2 id="Publish-Subscribe"><a href="#Publish-Subscribe" class="headerlink" title="Publish/Subscribe"></a>Publish/Subscribe</h2><ul><li><p>Exchanges</p><p>There are a few exchange types available: <strong>direct</strong>, <strong>topic</strong>, <strong>headers</strong> and <strong>fanout</strong>.</p></li><li><p>Bindings</p><p>A binding is a relationship between an exchange and a queue</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bigdata snippet</title>
      <link href="/2019/05/05/bigdata/"/>
      <url>/2019/05/05/bigdata/</url>
      
        <content type="html"><![CDATA[<h2 id="BIG-DATA-What-is-Types-Characteristics-amp-Example"><a href="#BIG-DATA-What-is-Types-Characteristics-amp-Example" class="headerlink" title="BIG DATA: What is, Types, Characteristics &amp; Example"></a>BIG DATA: What is, Types, Characteristics &amp; Example</h2><ul><li>Big Data is defined as data that is huge in size. Bigdata is a term used to describe a collection of data that is huge in size and yet growing exponentially with time.</li><li>Examples of Big Data generation includes stock exchanges, social media sites, jet engines, etc.</li><li>Big Data could be 1) Structured, 2) Unstructured, 3) Semi-structured</li><li>Volume, Variety, Velocity, and Variability are few Characteristics of Bigdata</li><li>Improved customer service, better operational efficiency, Better Decision Making are few advantages of Bigdata</li></ul><h2 id="Hadoop-EcoSystem-and-Components"><a href="#Hadoop-EcoSystem-and-Components" class="headerlink" title="Hadoop EcoSystem and Components"></a>Hadoop EcoSystem and Components</h2><p><img src="./img/061114_0803_LearnHadoop4.png"></p><h3 id="Hadoop-Architecture"><a href="#Hadoop-Architecture" class="headerlink" title="Hadoop Architecture"></a>Hadoop Architecture</h3><p><img src="./img/hadoop-architecture.png"></p><h4 id="HDFS-Architecture"><a href="#HDFS-Architecture" class="headerlink" title="HDFS Architecture"></a>HDFS Architecture</h4><p>HDFS cluster primarily consists of a <strong>NameNode</strong> that manages the file system <strong>Metadata</strong> and a <strong>DataNodes</strong> that stores the <strong>actual data</strong>.</p><ul><li><p>Read Operation In HDFS</p><p><img src="./img/061114_0923_LearnHDFSAB1.png"></p></li><li><p>Write Operation In HDFS</p><p><img src="./img/061114_0923_LearnHDFSAB2.png"></p></li></ul><h4 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h4><p>The whole process goes through four phases of execution namely, splitting, mapping, shuffling, and reducing.</p><p><img src="./img/061114_0930_Introductio1.png"></p><ol><li><strong>Jobtracker</strong>: Acts like a <strong>master</strong> (responsible for complete execution of submitted job)</li><li><strong>Multiple Task Trackers</strong>: Acts like <strong>slaves,</strong> each of them performing the job</li></ol><p><img src="./img/061114_0930_Introductio2.png"></p>]]></content>
      
      
      <categories>
          
          <category> bigdata </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vmware snippet</title>
      <link href="/2019/04/20/vmware/"/>
      <url>/2019/04/20/vmware/</url>
      
        <content type="html"><![CDATA[<h3 id="ç”¨æˆ·"><a href="#ç”¨æˆ·" class="headerlink" title="ç”¨æˆ·"></a>ç”¨æˆ·</h3><ul><li><p>æ–°å¢ç”¨æˆ·</p><p><code>adduser username</code></p><p><code>passwd username</code></p><p><code>usermod -aG wheel username</code></p><p><code>su - username</code></p></li></ul><h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3><ul><li><p>å®‰è£…å®Œæ¯•ä¹‹åï¼Œéœ€è¦è®¾ç½®IPåˆ†é…</p><ol><li><p><code>cd /etc/sysconfig/network-scripts/</code></p></li><li><p>å†è¿›å…¥ç¼–è¾‘<code>ifcfg-e**</code> æ–‡ä»¶ æ‰§è¡Œå‘½ä»¤<br><code>vi ifcfg-e**</code></p></li><li><p>ä¿®æ”¹ONBOOTé¡¹</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å…¶ä¸­éƒ¨åˆ†å†…å®¹å¦‚ä¸‹ï¼š </span><br><span class="line">DEVICE=eth0 #è®¾å¤‡åç§°ï¼Œå¯æ ¹æ®ifcofnigå‘½ä»¤æŸ¥çœ‹åˆ°ã€‚ </span><br><span class="line">BOOTPROTO=dhcp #è¿æ¥æ–¹å¼ï¼Œdhcpä¼šè‡ªåŠ¨åˆ†é…åœ°å€ï¼Œæ­¤æ—¶ä¸éœ€è¦åœ¨ä¸‹é¢è®¾ç½®ipå’Œç½‘å…³ </span><br><span class="line">ONBOOT=yes #yesè¡¨ç¤ºå¯åŠ¨å°±æ‰§è¡Œè¯¥é…ç½®ï¼Œéœ€è¦æ”¹ä¸ºyes</span><br></pre></td></tr></table></figure><ol start="4"><li><p>ä¿®æ”¹å®Œåéœ€è¦é‡å¯ç½‘ç»œè®¾ç½®ï¼Œæ‰§è¡Œ</p><p><code>service network restart</code></p></li></ol></li><li><p>è®¾ç½®é™æ€IP</p><ul><li><p><a href="https://blog.csdn.net/clevercode/article/details/50574695">è™šæ‹Ÿæœºè®¾ç½®</a></p></li><li><p>å®¿ä¸»æœºå™¨è®¾ç½®</p><p>éœ€è¦è®¾ç½®vmnet8çš„ipä¸ºåŒä¸€ç½‘æ®µçš„é…ç½®</p></li></ul></li></ul><h3 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h3><ul><li><p>å®‰è£…jdk</p><p><code>sudo yum install java-1.8.0-openjdk-devel</code></p><ul><li>find path</li></ul><p><code>update-alternatives --config java</code></p><ul><li>config .bashrc</li></ul><p><code>export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.191.b12-1.el7_6.x86_64/jre</code></p></li></ul><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><ul><li><p>æˆæƒæ‰€æœ‰æœºå™¨å¯ä»¥ä»å¤–ç•Œè®¿é—®mysql</p><p><code>GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;will&#39;;</code></p><p><code>FLUSH PRIVILEGES;</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> vmware </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscode</title>
      <link href="/2019/04/12/vscode%20snippet/"/>
      <url>/2019/04/12/vscode%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="Skill"><a href="#Skill" class="headerlink" title="Skill"></a>Skill</h1><ul><li><p>open tab in new window</p><ul><li>Press Ctrl + k</li><li>Release the Ctrl and k keys</li><li>press O (the letter O, not Zero).</li></ul></li><li><p>save all</p><ul><li>Press Ctrl + k</li><li>Release the Ctrl and k keys</li><li>Press s</li></ul></li><li><p>copy line</p><p>Shift+Alt+Down and Shift+Alt+Up</p></li></ul><h1 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h1><h2 id="fileheader"><a href="#fileheader" class="headerlink" title="fileheader"></a>fileheader</h2><p><code>ctrl+alt+i</code> can insert comments in the head.</p><h2 id="copilot"><a href="#copilot" class="headerlink" title="copilot"></a>copilot</h2><ul><li><p>switch Sign in from  <code>GHE.com</code> to <code>github</code></p><p><code>setting.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;github.copilot.advanced&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;authProvider&quot;</span>: <span class="string">&quot;github&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ul><h1 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h1><h2 id="golang"><a href="#golang" class="headerlink" title="golang"></a>golang</h2>]]></content>
      
      
      <categories>
          
          <category> vscode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redux learn</title>
      <link href="/2019/04/07/redux%20learn/"/>
      <url>/2019/04/07/redux%20learn/</url>
      
        <content type="html"><![CDATA[<h3 id="Passing-Data-Between-Adjacent-Components"><a href="#Passing-Data-Between-Adjacent-Components" class="headerlink" title="Passing Data Between Adjacent Components"></a>Passing Data Between Adjacent Components</h3><p>If you have components that are siblings and need to share data, the way to do that in React is to pull that data up into a parent component and pass it down with props.</p><p>That can be cumbersome though. Redux can help by giving you one global â€œparentâ€ where you can store the data, and then you can <code>connect</code> the sibling components to the data with React-Redux.</p><h3 id="redux-vs-react-redux"><a href="#redux-vs-react-redux" class="headerlink" title="redux vs react-redux"></a>redux vs react-redux</h3><p><code>redux</code> knows nothing about React <em>at all</em>. (The <code>redux</code> library can be used outside of a React app too. Itâ€™ll work with Vue, Angular, and even backend Node/Express apps.)</p><p><code>react-redux</code> lets you connect pieces of the state to React components.</p><h3 id="store"><a href="#store" class="headerlink" title="store"></a>store</h3><p>in charge for orchestrating all the interactions</p><p>the <strong>state</strong> is the data, and the <strong>store</strong> is where itâ€™s kept.</p><h3 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h3><p>the producer to make the state</p><blockquote><p>(state, action) =&gt; newState</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> letters = [<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;x&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// `reduce` takes 2 arguments:</span></span><br><span class="line"><span class="comment">//   - a function to do the reducing (you might say, a &quot;reducer&quot;)</span></span><br><span class="line"><span class="comment">//   - an initial value for accumulatedResult</span></span><br><span class="line"><span class="keyword">var</span> word = letters.reduce(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">accumulatedResult, arrayItem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> accumulatedResult + arrayItem;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="string">&#x27;&#x27;</span>); <span class="comment">// &lt;-- notice this empty string argument: it&#x27;s the initial value</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(word) <span class="comment">// =&gt; &quot;redux&quot;</span></span><br></pre></td></tr></table></figure><p>**Important Rule of Reducers **:</p><ul><li>Never return undefined from a reducer.</li><li>Reducers must be pure functions.(This means that they canâ€™t modify their arguments, and they canâ€™t have side effects.)</li></ul><h3 id="action"><a href="#action" class="headerlink" title="action"></a>action</h3><p>plain JavaScript objects with a property named type. </p><blockquote><p>An action object describes a change you want to make (like â€œplease increment the counterâ€) or an event that happenend (like â€œthe request to the server failed with this errorâ€).</p><p>action donâ€™t really <em>do</em> anything. Not on their own, anyway.</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;add an item&quot;</span>,</span><br><span class="line">  <span class="attr">item</span>: <span class="string">&quot;Apple&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="number">7008</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;INCREMENT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In order to make an action DO something, you need to <strong>dispatch</strong> it.</p><hr><h3 id="redux-tips"><a href="#redux-tips" class="headerlink" title="redux tips"></a>redux tips</h3><h4 id="Redux-avoids-these-problems-with-some-simple-rules"><a href="#Redux-avoids-these-problems-with-some-simple-rules" class="headerlink" title="Redux avoids these problems with some simple rules."></a>Redux avoids these problems with some simple rules.</h4><ul><li>State is read-only, and actions are the only way to modify it.</li><li>Changes happen one way, and one way only: dispatch(action) -&gt; reducer -&gt; new state.</li><li>The reducer function must be â€œpureâ€ â€“ it cannot modify its arguments, and it canâ€™t have side effects.</li></ul><h4 id="The-most-important-methods"><a href="#The-most-important-methods" class="headerlink" title="The most important methods."></a>The most important methods.</h4><ul><li>getState for <strong>accessing the current state</strong> of the application</li><li>dispatch for <strong>dispatching an action</strong></li><li>subscribe for <strong>listening on state changes</strong></li></ul><h3 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h3><h4 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h4><p>By wrapping the entire app with the <code>Provider</code> component, <em>every component</em> in the app tree will be able to access the Redux store if it wants to.</p><h4 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h4><p>all of components can access the Redux store, but not automatically , Weâ€™ll need to use the <code>connect</code> function on our components to access the store.</p><h4 id="connects-a-React-component-with-the-Redux-store"><a href="#connects-a-React-component-with-the-Redux-store" class="headerlink" title="connects a React component with the Redux store."></a>connects a React component with the Redux store.</h4><ul><li>the mapStateToProps function</li><li>the mapDispatchToProps function</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">&quot;./logo.svg&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; fetching, dog, onRequestDog, error &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        ......</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">fetching</span>: state.fetching,</span><br><span class="line">    <span class="attr">dog</span>: state.dog,</span><br><span class="line">    <span class="attr">error</span>: state.error</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">onRequestDog</span>: <span class="function">() =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;API_CALL_REQUEST&quot;</span> &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(App);</span><br></pre></td></tr></table></figure><h3 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h3><p>It is a <strong>middleware</strong>, basically a plugin for Redux, that enables Redux to deal with actions like <code>getUser()</code>, ie.<code>dispatch(getUser())</code></p><p>thunk: itâ€™s an action creator that returns a function instead of a plain action object, like this:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doStuff</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">dispatch, getState</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// dispatch actions here</span></span><br><span class="line">    <span class="comment">// or fetch data</span></span><br><span class="line">    <span class="comment">// or whatever</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>the 2 agruments in return function,Most of the time youâ€™ll only need <code>dispatch</code>, but sometimes you want to do something conditionally, based on some value in the Redux state. In that case, call <code>getState()</code> and youâ€™ll have the entire state to read as needed.</p><h4 id="setup-redux-thunk"><a href="#setup-redux-thunk" class="headerlink" title="setup redux thunk"></a>setup redux thunk</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(</span><br><span class="line">  reducer,</span><br><span class="line">  applyMiddleware(thunk)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="redux-saga"><a href="#redux-saga" class="headerlink" title="redux-saga"></a>redux-saga</h3><p><code>redux-saga</code> relies on generators, but does a decent amount of the work for us, so (in my fairly limited experience) a deep understanding of them for this use-case isnâ€™t necessary.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; takeLatest, call, put &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// watcher saga: watches for actions dispatched to the store, starts worker saga</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">watcherSaga</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> takeLatest(<span class="string">&quot;API_CALL_REQUEST&quot;</span>, workerSaga);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// function that makes the api request and returns a Promise for response</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchDog</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;https://dog.ceo/api/breeds/image/random&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// worker saga: makes the api call when watcher saga sees the action</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">workerSaga</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">yield</span> call(fetchDog);</span><br><span class="line">    <span class="keyword">const</span> dog = response.data.message;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dispatch a success action to the store with the new dog</span></span><br><span class="line">    <span class="keyword">yield</span> put(&#123; <span class="attr">type</span>: <span class="string">&quot;API_CALL_SUCCESS&quot;</span>, dog &#125;);</span><br><span class="line">  </span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// dispatch a failure action to the store with the error</span></span><br><span class="line">    <span class="keyword">yield</span> put(&#123; <span class="attr">type</span>: <span class="string">&quot;API_CALL_FAILURE&quot;</span>, error &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> redux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6 learn</title>
      <link href="/2019/04/04/ES6%20learn/"/>
      <url>/2019/04/04/ES6%20learn/</url>
      
        <content type="html"><![CDATA[<h3 id="Let"><a href="#Let" class="headerlink" title="Let"></a>Let</h3><p>let is similar to var but let has scope. let is only accessible in the block level it is defined.</p><p>example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"> <span class="keyword">let</span> a = <span class="number">40</span>;</span><br><span class="line"> <span class="built_in">console</span>.log(a); <span class="comment">//40</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>and</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">50</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"> <span class="keyword">let</span> a = <span class="number">60</span>;</span><br><span class="line"> <span class="keyword">var</span> c = <span class="number">10</span>;</span><br><span class="line"> <span class="built_in">console</span>.log(a/c); <span class="comment">// 6</span></span><br><span class="line"> <span class="built_in">console</span>.log(b/c); <span class="comment">// 10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 10</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><h3 id="Const"><a href="#Const" class="headerlink" title="Const"></a>Const</h3><p>Const is used to assign a constant value to the variable. And the value cannot be changed. Its fixed.</p><p>example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">50</span>;</span><br><span class="line">a = <span class="number">60</span>; <span class="comment">// shows error. You cannot change the value of const.</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="string">&quot;Constant variable&quot;</span>;</span><br><span class="line">b = <span class="string">&quot;Assigning new value&quot;</span>; <span class="comment">// shows error.</span></span><br></pre></td></tr></table></figure><p>Whenever you define a const variable, Javascript references the address of the value to the variable.</p><p>example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> LANGUAGES = [<span class="string">&#x27;Js&#x27;</span>, <span class="string">&#x27;Ruby&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Go&#x27;</span>];</span><br><span class="line">LANGUAGES = <span class="string">&quot;Javascript&quot;</span>; <span class="comment">// shows error.</span></span><br><span class="line">LANGUAGES.push(<span class="string">&#x27;Java&#x27;</span>); <span class="comment">// Works fine.</span></span><br><span class="line"><span class="built_in">console</span>.log(LANGUAGES); <span class="comment">// [&#x27;Js&#x27;, &#x27;Ruby&#x27;, &#x27;Python&#x27;, &#x27;Go&#x27;, &#x27;Java&#x27;]</span></span><br></pre></td></tr></table></figure><p>the variable â€˜LANGUAGESâ€™ actually references to the memory allocated to the array. So you cannot change the variable to reference some other memory location later. Throughout the program it only references to the array.</p><h3 id="Arrow-Function"><a href="#Arrow-Function" class="headerlink" title="Arrow Function"></a>Arrow Function</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Old Syntax</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">oldOne</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&quot;Hello World..!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// New Syntax</span></span><br><span class="line"><span class="keyword">var</span> newOne = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&quot;Hello World..!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>and</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> NewOneWithParameters = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(a+b); <span class="comment">// 30</span></span><br><span class="line">&#125;</span><br><span class="line">NewOneWithParameters(<span class="number">10</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure><p>There are two things to explain here.</p><ol><li>If you have a function with single parameter, you donâ€™t need (). In our case <strong>element</strong> is the parameter.</li><li>And If you have single line as the body of the function you donâ€™t need {} and also JS will implicitly returns the value after executing the function. You donâ€™t have to use <strong>return</strong> keyword.</li><li>Arrow functions shine best with anything that requires <code>this</code> to be bound to the context, and not the function itself.</li></ol><h3 id="For-of-loop"><a href="#For-of-loop" class="headerlink" title="For of loop"></a>For of loop</h3><p>for..of iterates through list of elements (i.e) like Array and returns the elements (not their index) one by one.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> arr) &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>and</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> string = <span class="string">&quot;Javascript&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> char <span class="keyword">of</span> string) &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(char);</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line">J</span><br><span class="line">a</span><br><span class="line">v</span><br><span class="line">a</span><br><span class="line">s</span><br><span class="line">c</span><br><span class="line">r</span><br><span class="line">i</span><br><span class="line">p</span><br><span class="line">t</span><br></pre></td></tr></table></figure><h3 id="Spread-attributes"><a href="#Spread-attributes" class="headerlink" title="Spread attributes"></a>Spread attributes</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> SumElements = <span class="function">(<span class="params">arr</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(arr); <span class="comment">// [10, 20, 40, 60, 90]</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">let</span> element <span class="keyword">of</span> arr) &#123;</span><br><span class="line"> sum += element;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="built_in">console</span>.log(sum); <span class="comment">// 220. </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SumElements([<span class="number">10</span>, <span class="number">20</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">90</span>]);</span><br></pre></td></tr></table></figure><p>consider the same example with spread attributes:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> SumElements = <span class="function">(<span class="params">...arr</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(arr); <span class="comment">// [10, 20, 40, 60, 90]</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">let</span> element <span class="keyword">of</span> arr) &#123;</span><br><span class="line"> sum += element;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="built_in">console</span>.log(sum); <span class="comment">// 220. </span></span><br><span class="line">&#125;</span><br><span class="line">SumElements(<span class="number">10</span>, <span class="number">20</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">90</span>); <span class="comment">// Note we are not passing array here. Instead we are passing the elements as arguments.</span></span><br></pre></td></tr></table></figure><p>Math.max is a simple method that returns the maximum element from given list. It doesnâ€™t accept an array.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">60</span>];</span><br><span class="line"><span class="built_in">Math</span>.max(arr); <span class="comment">// Shows error. Doesn&#x27;t accept an array.</span></span><br></pre></td></tr></table></figure><p>So lets use our savior:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">60</span>];</span><br><span class="line"><span class="built_in">Math</span>.max(...arr); <span class="comment">// 60</span></span><br></pre></td></tr></table></figure><h3 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h3><p>Map holds key-value pairs. Itâ€™s similar to an array but we can define our own index. And indexes are unique in maps.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">map.set(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;John&#x27;</span>);</span><br><span class="line">map.set(<span class="string">&#x27;id&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">map.get(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// John</span></span><br><span class="line">map.get(<span class="string">&#x27;id&#x27;</span>); <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">map.size; <span class="comment">// 2. Returns the size of the map.</span></span><br><span class="line">map.keys(); <span class="comment">// outputs only the keys. </span></span><br><span class="line">map.values(); <span class="comment">// outputs only the values.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> map.keys()) &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line">name</span><br><span class="line">id</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(key+<span class="string">&quot; - &quot;</span>+value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line">name - John</span><br><span class="line">id - <span class="number">10</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Sets"><a href="#Sets" class="headerlink" title="Sets"></a>Sets</h3><p>Sets are used to store the unique values of any type.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sets = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">sets.add(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">sets.add(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">sets.add(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// We are adding duplicate value.</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> element <span class="keyword">of</span> sets) &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(element);</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line"></span><br><span class="line">sets.size; <span class="comment">// returns 2. Size of the set.</span></span><br><span class="line">sets.has(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// returns true. </span></span><br><span class="line">sets.has(<span class="string">&#x27;c&#x27;</span>); <span class="comment">// returns false.</span></span><br></pre></td></tr></table></figure><h3 id="Static-methods"><a href="#Static-methods" class="headerlink" title="Static methods"></a>Static methods</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line"> <span class="keyword">static</span> <span class="function"><span class="title">Callme</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&quot;Static method&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">Example.Callme();</span><br><span class="line">Output:</span><br><span class="line">Static method</span><br></pre></td></tr></table></figure><p> you can call the function without creating any instance for the class.</p><h3 id="Getters-and-Setters"><a href="#Getters-and-Setters" class="headerlink" title="Getters and Setters"></a>Getters and Setters</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line"> <span class="built_in">this</span>.name = name;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="title">setName</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line"> <span class="built_in">this</span>.name = name;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> People(<span class="string">&quot;Jon Snow&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person.getName());</span><br><span class="line">person.setName(<span class="string">&quot;Dany&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person.getName());</span><br><span class="line">Output:</span><br><span class="line">Jon Snow</span><br><span class="line">Dany</span><br></pre></td></tr></table></figure><h3 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h3><p> They are used to make <strong>async</strong> operations such as API request, file handling, downloading images, etc.</p><p>Before promises, programmers used to define <strong>callbacks.</strong> Callbacks are normal functions in Javascript which executes when the async operation is complete.</p><ul><li><p>three states in promises</p><ol><li><strong>Pending</strong>: In this state the promise is just executing the async operation. For example, Itâ€™s making some API request to the server or downloading some images from cdn.  from this state promise can move to either to <strong>Fulfilled</strong> or to <strong>Rejected</strong></li><li><strong>Fulfilled</strong>: If the promise has reached this state, then it means that the async operation is complete and we have the output. For example, we have the response from the API.</li><li><strong>Rejected:</strong> If the promise has reached this state, it means that the async operation is not successful and we have the error which caused the operation to fail.</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> apiCall = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> ( API request to get some data ) &#123;</span><br><span class="line">  resolve(<span class="string">&quot;The request is successful and the response is &quot;</span>+ response);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> &#123;</span><br><span class="line">  reject(<span class="string">&quot;The request is not successful. The error is &quot;</span>+error);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Then the <strong>resolve</strong> function is called if we get the response from the server. And if there is some error <strong>reject</strong> function is called with the error message.</p></li><li><p>We use <strong>handlers</strong> to get the output from the promise.</p><blockquote><p>Handlers are just functions which executes when some event occurs such as clicking a button, moving the cursor, etc.</p><p>So we can use handlers to handle when the <strong>resolve</strong> function is called or **reject **function is called.</p></blockquote><ul><li>The handler <strong>then</strong> executes its <strong>function parameter</strong> when the <strong>resolve</strong> function is called inside the promise.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// calling the promise with some handlers.</span></span><br><span class="line">apiCall.then(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;<span class="built_in">console</span>.log(x); &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output</span></span><br><span class="line">The request is successful and the response is &#123;<span class="attr">name</span>: <span class="string">&quot;Jon Snow&quot;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>Catch</strong> handler looks out for <strong>reject</strong> function.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apiCall</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(x); </span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line"><span class="comment">// Assuming the request is not successful ( reject function is called in the promise. )</span></span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line">The request is not successful</span><br></pre></td></tr></table></figure></li></ul><h3 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async / Await"></a>Async / Await</h3><h4 id="async"><a href="#async" class="headerlink" title="async"></a>async</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&quot;Hello Promise..!&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The above code is equivalent to the below code:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// executor function body.</span></span><br><span class="line"> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (a &lt; b) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Greater&quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Not Greater&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">hello(<span class="number">14</span>, <span class="number">10</span>)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&quot;Good..! &quot;</span> + x); </span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&quot;Oops..! &quot;</span> + x); </span><br><span class="line">&#125;)</span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line">Oops..! Not Greater. </span><br><span class="line"><span class="comment">// if you call hello(4, 10) you get &quot;Good..! Greater&quot;</span></span><br></pre></td></tr></table></figure><p>Donâ€™t forget that async function will return a promise. So of course, you can call <strong>resolve</strong> and <strong>reject</strong> function inside <strong>async</strong> function too. </p><p>example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">Max</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (a &gt; b) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">&quot;Error&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">Max(<span class="number">4</span>, <span class="number">10</span>)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&quot;Good &quot;</span> + x); </span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&quot;Oops &quot;</span> + x); </span><br><span class="line">&#125;);</span><br><span class="line">Output:</span><br><span class="line">Oops <span class="built_in">Error</span></span><br><span class="line"><span class="comment">// If we pass Max(14, 10) then we should get &quot;Good Success&quot; :)</span></span><br></pre></td></tr></table></figure><h4 id="await"><a href="#await" class="headerlink" title="await"></a>await</h4><p> It makes the Javascript to wait until you get the response from the endpoint. And then it resumes the execution.</p><p><strong>await can be used only inside async function. It doesnâ€™t work outside async function</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(<span class="string">&#x27;https://api.github.com/&#x27;</span>);</span><br><span class="line"> <span class="comment">// above line fetches the response from the given API endpoint.</span></span><br><span class="line"> <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br><span class="line">hello()</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(x); </span><br><span class="line">&#125;);</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line">Response <span class="keyword">from</span> the API.</span><br></pre></td></tr></table></figure><h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><h4 id="Array-Map"><a href="#Array-Map" class="headerlink" title="Array Map"></a>Array Map</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> modifiedArr = arr.map(<span class="function"><span class="keyword">function</span>(<span class="params">element, index, arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> element * <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(modifiedArr);</span><br><span class="line">Output:</span><br><span class="line">[<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>]</span><br></pre></td></tr></table></figure><p>And also note we have to return some value in the end. Which will be the modified value of that element. If you didnâ€™t return anything then the particular element will be undefined.</p><p>One more thing I like to add is the second and third parameter is only optional. Only the first parameter is mandatory. for example :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> modifiedArr = arr.map(<span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> element * <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>write the map operator with arrow functions:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> modifiedArr = arr.map(<span class="function">(<span class="params">element, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;index &quot;</span>+index);</span><br><span class="line">  <span class="keyword">return</span> element * <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(modifiedArr);</span><br><span class="line">Output:</span><br><span class="line">index <span class="number">0</span></span><br><span class="line">index <span class="number">1</span></span><br><span class="line">index <span class="number">2</span></span><br><span class="line">index <span class="number">3</span></span><br><span class="line">index <span class="number">4</span></span><br><span class="line">[<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>]</span><br></pre></td></tr></table></figure><p>better:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> modifiedArr = arr.map(<span class="function"><span class="params">element</span> =&gt;</span> element * <span class="number">10</span>);</span><br><span class="line"><span class="built_in">console</span>.log(modifiedArr);</span><br></pre></td></tr></table></figure><h4 id="Array-Filter"><a href="#Array-Filter" class="headerlink" title="Array Filter"></a>Array Filter</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="keyword">let</span> modifiedArr = arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">element, index, array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> element % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(modifiedArr);</span><br><span class="line">Output:</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure><p>try by arrow function:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> modifiedAarr = arr.filter(<span class="function">(<span class="params">element, index</span>) =&gt;</span> element%<span class="number">2</span> == <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>we have to return a boolean value for each element of the array. If you wonâ€™t return any boolean value at the end then the filter takes it as <strong>false</strong> and deletes the element.</p><h4 id="Array-Reduce"><a href="#Array-Reduce" class="headerlink" title="Array Reduce"></a>Array Reduce</h4><p>Array reduce is used to aggregate all the elements of an array and return a single value.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"><span class="keyword">let</span> total= arr.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">sum, element, index, array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> sum + element;</span><br><span class="line">&#125;,<span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;total is &quot;</span>+total);</span><br><span class="line">Output:</span><br><span class="line">total is <span class="number">21</span></span><br></pre></td></tr></table></figure><p>Unlike filter and map, reduce takes a function with four parameters and also a additional element. Unlike filter and map, the first two parameters are mandatory. Other two are optional.</p><p>The first parameter is the aggregator element.In our case itâ€™s 0. </p><p>Like filter and map you have to return the end result.</p><p>write the same code with arrow functions:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> totalSum = arr.reduce(<span class="function">(<span class="params">sum, element</span>) =&gt;</span> element+sum, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="Template-Literals"><a href="#Template-Literals" class="headerlink" title="Template Literals"></a>Template Literals</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;Srebalaji&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> languages = <span class="function">() =&gt;</span> &#123;<span class="keyword">return</span> <span class="string">&quot;Ruby, Js, Java, Python&quot;</span>&#125;</span><br><span class="line"><span class="keyword">let</span> msg = <span class="string">`My name is <span class="subst">$&#123;name&#125;</span></span></span><br><span class="line"><span class="string">My age is <span class="subst">$&#123;<span class="number">20</span>+<span class="number">3</span>&#125;</span></span></span><br><span class="line"><span class="string">And I code in <span class="subst">$&#123;languages()&#125;</span>`</span></span><br><span class="line"><span class="attr">Output</span>:</span><br><span class="line">My name is Srebalaji</span><br><span class="line">My age is <span class="number">23</span></span><br><span class="line">And I code <span class="keyword">in</span> Ruby, Js, Java, Python</span><br></pre></td></tr></table></figure><h3 id="Imports-and-Exports"><a href="#Imports-and-Exports" class="headerlink" title="Imports and Exports"></a>Imports and Exports</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> name = <span class="string">&quot;Jon&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> age = <span class="number">23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;name, age&#125; <span class="keyword">from</span> <span class="string">&#x27;./app&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(name);</span><br><span class="line"><span class="built_in">console</span>.log(age);</span><br><span class="line"></span><br><span class="line"><span class="comment">//index.html</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">Jon</span><br><span class="line"><span class="number">23</span></span><br></pre></td></tr></table></figure><p>and:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">let</span> sum = <span class="function">() =&gt;</span> a+b;</span><br><span class="line"><span class="keyword">export</span> &#123;a,b&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> sum</span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> variables <span class="keyword">from</span> <span class="string">&#x27;./app&#x27;</span></span><br><span class="line"><span class="keyword">import</span> addition <span class="keyword">from</span> <span class="string">&#x27;./app&#x27;</span> <span class="comment">// default value</span></span><br><span class="line"><span class="built_in">console</span>.log(variables.a);</span><br><span class="line"><span class="built_in">console</span>.log(variables.b);</span><br><span class="line"><span class="built_in">console</span>.log(addition());</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure><ol><li><p>If you are using * to import values then you have to use <strong>alias</strong> (i.e) names that will refer to imported values. In our example we have used <strong>variables</strong> as alias.</p></li><li><p>Using * to import values doesnâ€™t import default value. You have to import it separately.</p><p>for example:<code>import addition, * as variables from &#39;./app&#39;</code></p></li></ol><h3 id="Destructuring-objects-and-arrays"><a href="#Destructuring-objects-and-arrays" class="headerlink" title="Destructuring objects and arrays"></a>Destructuring objects and arrays</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;<span class="attr">firstName</span>: <span class="string">&quot;Jon&quot;</span>, <span class="attr">lastName</span>: <span class="string">&quot;Snow&quot;</span>, <span class="attr">age</span>: <span class="number">23</span>&#125;</span><br><span class="line"><span class="keyword">const</span> &#123;firstName, lastName, age&#125; = person</span><br><span class="line"><span class="built_in">console</span>.log(firstName);</span><br><span class="line"><span class="built_in">console</span>.log(lastName);</span><br><span class="line"><span class="built_in">console</span>.log(age);</span><br><span class="line">Output:</span><br><span class="line">Jon</span><br><span class="line">Snow</span><br><span class="line"><span class="number">23</span></span><br></pre></td></tr></table></figure><h3 id="Extend-and-Super"><a href="#Extend-and-Super" class="headerlink" title="Extend and Super"></a>Extend and Super</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"> <span class="function"><span class="title">constructor</span>(<span class="params">firstName, lastName, age</span>)</span> &#123;</span><br><span class="line">   <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">   <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">   <span class="built_in">this</span>.age = age;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="title">displayName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span> - <span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="title">constructor</span>(<span class="params">firstName, lastName, age, salary</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>(firstName, lastName, age);</span><br><span class="line">  <span class="built_in">this</span>.salary = salary;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="title">displaySalary</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.salary&#125;</span>`</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="title">displayName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">super</span>.displayName();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="title">displayAge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> manager = <span class="keyword">new</span> Employee(<span class="string">&quot;Jon&quot;</span>, <span class="string">&quot;Snow&quot;</span>, <span class="number">23</span>, <span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.log(manager.displaySalary());</span><br><span class="line"><span class="built_in">console</span>.log(manager.displayName());</span><br><span class="line"><span class="built_in">console</span>.log(manager.displayAge());</span><br><span class="line">Output:</span><br><span class="line"><span class="number">100</span></span><br><span class="line">Jon Snow</span><br><span class="line"><span class="number">23</span></span><br></pre></td></tr></table></figure><p>And then we have used <strong>super</strong> keyword to call the constructor of the parent class. And we also have called the method declared in the parent class using <strong>super</strong>.</p><h3 id="Generator-functions"><a href="#Generator-functions" class="headerlink" title="Generator functions"></a>Generator functions</h3><ul><li>Generator functions are written using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*"><code>function*</code></a> syntax. When called initially, generator functions do not execute any of their code, instead returning a type of iterator called a Generator. </li><li>When a value is consumed by calling the generatorâ€™s <strong>next</strong> method, the Generator function executes until it encounters the <strong>yield</strong> keyword.<ul><li>Each <code>yield</code> in a generator basically represents an asynchronous step in a more synchronous/sequential processâ€Šâ€”â€Šsomewhat like <code>await</code> in an <code>async</code>function.</li></ul></li><li>The function can be called as many times as desired and returns a new Generator each time, however each Generator may only be iterated once.</li></ul><h3 id="some-method"><a href="#some-method" class="headerlink" title="some method"></a>some method</h3><ul><li><p>includes</p><p>construct an array of the items, and use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes"><code>includes</code></a>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>].includes(<span class="string">&#x27;b&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> ES6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring boot learn</title>
      <link href="/2019/03/31/regex%20learn/"/>
      <url>/2019/03/31/regex%20learn/</url>
      
        <content type="html"><![CDATA[<p align="center">    <br/>    <a href="https://github.com/ziishaned/learn-regex">        <img src="https://i.imgur.com/bYwl7Vf.png" alt="Learn Regex">    </a>    <br /><br />    <p>        <a href="https://twitter.com/home?status=Learn%20regex%20the%20easy%20way%20by%20%40ziishaned%20http%3A//github.com/ziishaned/learn-regex">            <img src="https://img.shields.io/badge/twitter-tweet-blue.svg?style=flat-square"/>        </a>        <a href="https://twitter.com/ziishaned">            <img src="https://img.shields.io/badge/feedback-@ziishaned-blue.svg?style=flat-square" />        </a>    </p></p>ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼?<blockquote><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç»„ç”±å­—æ¯å’Œç¬¦å·ç»„æˆçš„ç‰¹æ®Šæ–‡æœ¬, å®ƒå¯ä»¥ç”¨æ¥ä»æ–‡æœ¬ä¸­æ‰¾å‡ºæ»¡è¶³ä½ æƒ³è¦çš„æ ¼å¼çš„å¥å­.</p></blockquote><p>ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ˜¯åœ¨ä¸€ä¸ªä¸»ä½“å­—ç¬¦ä¸²ä¸­ä»å·¦åˆ°å³åŒ¹é…å­—ç¬¦ä¸²æ—¶çš„ä¸€ç§æ ·å¼.<br>â€œRegular expressionâ€è¿™ä¸ªè¯æ¯”è¾ƒæ‹—å£, æˆ‘ä»¬å¸¸ä½¿ç”¨ç¼©å†™çš„æœ¯è¯­â€regexâ€æˆ–â€regexpâ€.<br>æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ä»ä¸€ä¸ªåŸºç¡€å­—ç¬¦ä¸²ä¸­æ ¹æ®ä¸€å®šçš„åŒ¹é…æ¨¡å¼æ›¿æ¢æ–‡æœ¬ä¸­çš„å­—ç¬¦ä¸²ã€éªŒè¯è¡¨å•ã€æå–å­—ç¬¦ä¸²ç­‰ç­‰.</p><p>æƒ³è±¡ä½ æ­£åœ¨å†™ä¸€ä¸ªåº”ç”¨, ç„¶åä½ æƒ³è®¾å®šä¸€ä¸ªç”¨æˆ·å‘½åçš„è§„åˆ™, è®©ç”¨æˆ·ååŒ…å«å­—ç¬¦,æ•°å­—,ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦,ä»¥åŠé™åˆ¶å­—ç¬¦çš„ä¸ªæ•°,å¥½è®©åå­—çœ‹èµ·æ¥æ²¡é‚£ä¹ˆä¸‘.<br>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼æ¥éªŒè¯ä¸€ä¸ªç”¨æˆ·å:</p><p><img src="https://i.imgur.com/H5uDOzW.png"></p><p>ä»¥ä¸Šçš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥æ¥å— <code>john_doe</code>, <code>jo-hn_doe</code>, <code>john12_as</code>.<br>ä½†ä¸åŒ¹é…<code>Jo</code>, å› ä¸ºå®ƒåŒ…å«äº†å¤§å†™çš„å­—æ¯è€Œä¸”å¤ªçŸ­äº†.</p><h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><ul><li><a href="#1-%E5%9F%BA%E6%9C%AC%E5%8C%B9%E9%85%8D">1. åŸºæœ¬åŒ¹é…</a></li><li><a href="#2-%E5%85%83%E5%AD%97%E7%AC%A6">2. å…ƒå­—ç¬¦</a><pre><code> * [2.1 ç‚¹è¿ç®—ç¬¦ .](#21-ç‚¹è¿ç®—ç¬¦-) * [2.2 å­—ç¬¦é›†](#22-å­—ç¬¦é›†) * [2.2.1 å¦å®šå­—ç¬¦é›†](#221-å¦å®šå­—ç¬¦é›†)</code></pre><ul><li><a href="#23-%E9%87%8D%E5%A4%8D%E6%AC%A1%E6%95%B0">2.3 é‡å¤æ¬¡æ•°</a><ul><li><a href="#231--%E5%8F%B7">2.3.1 * å·</a></li><li><a href="#232--%E5%8F%B7">2.3.2 + å·</a></li><li><a href="#233--%E5%8F%B7">2.3.3 ? å·</a></li></ul></li><li><a href="#24--%E5%8F%B7">2.4 {} å·</a></li><li><a href="#25--%E7%89%B9%E5%BE%81%E6%A0%87%E7%BE%A4">2.5 (â€¦) ç‰¹å¾æ ‡ç¾¤</a></li><li><a href="#26--%E6%88%96%E8%BF%90%E7%AE%97%E7%AC%A6">2.6 | æˆ–è¿ç®—ç¬¦</a></li><li><a href="#27-%E8%BD%AC%E7%A0%81%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6">2.7 è½¬ç ç‰¹æ®Šå­—ç¬¦</a></li><li><a href="#28-%E9%94%9A%E7%82%B9">2.8 é”šç‚¹</a><ul><li><a href="#281--%E5%8F%B7">2.8.1 ^ å·</a></li><li><a href="#282--%E5%8F%B7">2.8.2 $ å·</a></li></ul></li></ul></li><li><a href="#3-%E7%AE%80%E5%86%99%E5%AD%97%E7%AC%A6%E9%9B%86">3. ç®€å†™å­—ç¬¦é›†</a></li><li><a href="#4-%E9%9B%B6%E5%AE%BD%E5%BA%A6%E6%96%AD%E8%A8%80%E5%89%8D%E5%90%8E%E9%A2%84%E6%9F%A5">4. é›¶å®½åº¦æ–­è¨€(å‰åé¢„æŸ¥)</a><ul><li><a href="#41--%E6%AD%A3%E5%85%88%E8%A1%8C%E6%96%AD%E8%A8%80">4.1 ?=â€¦ æ­£å…ˆè¡Œæ–­è¨€</a></li><li><a href="#42--%E8%B4%9F%E5%85%88%E8%A1%8C%E6%96%AD%E8%A8%80">4.2 ?!â€¦ è´Ÿå…ˆè¡Œæ–­è¨€</a></li><li><a href="#43---%E6%AD%A3%E5%90%8E%E5%8F%91%E6%96%AD%E8%A8%80">4.3 ?&lt;= â€¦ æ­£åå‘æ–­è¨€</a></li><li><a href="#44--%E8%B4%9F%E5%90%8E%E5%8F%91%E6%96%AD%E8%A8%80">4.4 ?&lt;!â€¦ è´Ÿåå‘æ–­è¨€</a></li></ul></li><li><a href="#5-%E6%A0%87%E5%BF%97">5. æ ‡å¿—</a><ul><li><a href="#51-%E5%BF%BD%E7%95%A5%E5%A4%A7%E5%B0%8F%E5%86%99-case-insensitive">5.1 å¿½ç•¥å¤§å°å†™ (Case Insensitive)</a></li><li><a href="#52-%E5%85%A8%E5%B1%80%E6%90%9C%E7%B4%A2-global-search">5.2 å…¨å±€æœç´¢ (Global search)</a></li><li><a href="#53-%E5%A4%9A%E8%A1%8C%E4%BF%AE%E9%A5%B0%E7%AC%A6-multiline">5.3 å¤šè¡Œä¿®é¥°ç¬¦ (Multiline)</a></li></ul></li><li><a href="#%E9%A2%9D%E5%A4%96%E8%A1%A5%E5%85%85">é¢å¤–è¡¥å……</a></li><li><a href="#%E8%B4%A1%E7%8C%AE">è´¡çŒ®</a></li><li><a href="#%E8%AE%B8%E5%8F%AF%E8%AF%81">è®¸å¯è¯</a></li></ul><h2 id="1-åŸºæœ¬åŒ¹é…"><a href="#1-åŸºæœ¬åŒ¹é…" class="headerlink" title="1. åŸºæœ¬åŒ¹é…"></a>1. åŸºæœ¬åŒ¹é…</h2><p>æ­£åˆ™è¡¨è¾¾å¼å…¶å®å°±æ˜¯åœ¨æ‰§è¡Œæœç´¢æ—¶çš„æ ¼å¼, å®ƒç”±ä¸€äº›å­—æ¯å’Œæ•°å­—ç»„åˆè€Œæˆ.<br>ä¾‹å¦‚: ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ <code>the</code>, å®ƒè¡¨ç¤ºä¸€ä¸ªè§„åˆ™: ç”±å­—æ¯<code>t</code>å¼€å§‹,æ¥ç€æ˜¯<code>h</code>,å†æ¥ç€æ˜¯<code>e</code>.</p><pre>"the" => The fat cat sat on <a href="#learn-regex"><strong>the</strong></a> mat.</pre><p><a href="https://regex101.com/r/dmRygT/1">åœ¨çº¿ç»ƒä¹ </a></p><p>æ­£åˆ™è¡¨è¾¾å¼<code>123</code>åŒ¹é…å­—ç¬¦ä¸²<code>123</code>. å®ƒé€ä¸ªå­—ç¬¦çš„ä¸è¾“å…¥çš„æ­£åˆ™è¡¨è¾¾å¼åšæ¯”è¾ƒ.</p><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¤§å°å†™æ•æ„Ÿçš„, æ‰€ä»¥<code>The</code>ä¸ä¼šåŒ¹é…<code>the</code>.</p><pre>"The" => <a href="#learn-regex"><strong>The</strong></a> fat cat sat on the mat.</pre><p><a href="https://regex101.com/r/1paXsy/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="2-å…ƒå­—ç¬¦"><a href="#2-å…ƒå­—ç¬¦" class="headerlink" title="2. å…ƒå­—ç¬¦"></a>2. å…ƒå­—ç¬¦</h2><p>æ­£åˆ™è¡¨è¾¾å¼ä¸»è¦ä¾èµ–äºå…ƒå­—ç¬¦.<br>å…ƒå­—ç¬¦ä¸ä»£è¡¨ä»–ä»¬æœ¬èº«çš„å­—é¢æ„æ€, ä»–ä»¬éƒ½æœ‰ç‰¹æ®Šçš„å«ä¹‰. ä¸€äº›å…ƒå­—ç¬¦å†™åœ¨æ–¹æ‹¬å·ä¸­çš„æ—¶å€™æœ‰ä¸€äº›ç‰¹æ®Šçš„æ„æ€. ä»¥ä¸‹æ˜¯ä¸€äº›å…ƒå­—ç¬¦çš„ä»‹ç»:</p><table><thead><tr><th align="center">å…ƒå­—ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td align="center">.</td><td>å¥å·åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦é™¤äº†æ¢è¡Œç¬¦.</td></tr><tr><td align="center">[ ]</td><td>å­—ç¬¦ç§ç±». åŒ¹é…æ–¹æ‹¬å·å†…çš„ä»»æ„å­—ç¬¦.</td></tr><tr><td align="center">[^ ]</td><td>å¦å®šçš„å­—ç¬¦ç§ç±». åŒ¹é…é™¤äº†æ–¹æ‹¬å·é‡Œçš„ä»»æ„å­—ç¬¦</td></tr><tr><td align="center">*</td><td>åŒ¹é…&gt;=0ä¸ªé‡å¤çš„åœ¨*å·ä¹‹å‰çš„å­—ç¬¦.</td></tr><tr><td align="center">+</td><td>åŒ¹é…&gt;=1ä¸ªé‡å¤çš„+å·å‰çš„å­—ç¬¦.</td></tr><tr><td align="center">?</td><td>æ ‡è®°?ä¹‹å‰çš„å­—ç¬¦ä¸ºå¯é€‰.</td></tr><tr><td align="center">{n,m}</td><td>åŒ¹é…numä¸ªå¤§æ‹¬å·ä¹‹å‰çš„å­—ç¬¦ (n &lt;= num &lt;= m).</td></tr><tr><td align="center">(xyz)</td><td>å­—ç¬¦é›†, åŒ¹é…ä¸ xyz å®Œå…¨ç›¸ç­‰çš„å­—ç¬¦ä¸².</td></tr><tr><td align="center">&#124;</td><td>æˆ–è¿ç®—ç¬¦,åŒ¹é…ç¬¦å·å‰æˆ–åçš„å­—ç¬¦.</td></tr><tr><td align="center">&#92;</td><td>è½¬ä¹‰å­—ç¬¦,ç”¨äºåŒ¹é…ä¸€äº›ä¿ç•™çš„å­—ç¬¦ <code>[ ] ( ) &#123; &#125; . * + ? ^ $ \ &#124;</code></td></tr><tr><td align="center">^</td><td>ä»å¼€å§‹è¡Œå¼€å§‹åŒ¹é….</td></tr><tr><td align="center">$</td><td>ä»æœ«ç«¯å¼€å§‹åŒ¹é….</td></tr></tbody></table><h2 id="2-1-ç‚¹è¿ç®—ç¬¦"><a href="#2-1-ç‚¹è¿ç®—ç¬¦" class="headerlink" title="2.1 ç‚¹è¿ç®—ç¬¦ ."></a>2.1 ç‚¹è¿ç®—ç¬¦ <code>.</code></h2><p><code>.</code>æ˜¯å…ƒå­—ç¬¦ä¸­æœ€ç®€å•çš„ä¾‹å­.<br><code>.</code>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦, ä½†ä¸åŒ¹é…æ¢è¡Œç¬¦.<br>ä¾‹å¦‚, è¡¨è¾¾å¼<code>.ar</code>åŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦åé¢è·Ÿç€æ˜¯<code>a</code>å’Œ<code>r</code>çš„å­—ç¬¦ä¸².</p><pre>".ar" => The <a href="#learn-regex"><strong>car</strong></a> <a href="#learn-regex"><strong>par</strong></a>ked in the <a href="#learn-regex"><strong>gar</strong></a>age.</pre><p><a href="https://regex101.com/r/xc9GkU/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="2-2-å­—ç¬¦é›†"><a href="#2-2-å­—ç¬¦é›†" class="headerlink" title="2.2 å­—ç¬¦é›†"></a>2.2 å­—ç¬¦é›†</h2><p>å­—ç¬¦é›†ä¹Ÿå«åšå­—ç¬¦ç±».<br>æ–¹æ‹¬å·ç”¨æ¥æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†.<br>åœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨è¿å­—ç¬¦æ¥æŒ‡å®šå­—ç¬¦é›†çš„èŒƒå›´.<br>åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦é›†ä¸å…³å¿ƒé¡ºåº.<br>ä¾‹å¦‚, è¡¨è¾¾å¼<code>[Tt]he</code> åŒ¹é… <code>the</code> å’Œ <code>The</code>.</p><pre>"[Tt]he" => <a href="#learn-regex"><strong>The</strong></a> car parked in <a href="#learn-regex"><strong>the</strong></a> garage.</pre><p><a href="https://regex101.com/r/2ITLQ4/1">åœ¨çº¿ç»ƒä¹ </a></p><p>æ–¹æ‹¬å·çš„å¥å·å°±è¡¨ç¤ºå¥å·.<br>è¡¨è¾¾å¼ <code>ar[.]</code> åŒ¹é… <code>ar.</code>å­—ç¬¦ä¸²</p><pre>"ar[.]" => A garage is a good place to park a c<a href="#learn-regex"><strong>ar.</strong></a></pre><p><a href="https://regex101.com/r/wL3xtE/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="2-2-1-å¦å®šå­—ç¬¦é›†"><a href="#2-2-1-å¦å®šå­—ç¬¦é›†" class="headerlink" title="2.2.1 å¦å®šå­—ç¬¦é›†"></a>2.2.1 å¦å®šå­—ç¬¦é›†</h3><p>ä¸€èˆ¬æ¥è¯´ <code>^</code> è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼€å¤´, ä½†å®ƒç”¨åœ¨ä¸€ä¸ªæ–¹æ‹¬å·çš„å¼€å¤´çš„æ—¶å€™, å®ƒè¡¨ç¤ºè¿™ä¸ªå­—ç¬¦é›†æ˜¯å¦å®šçš„.<br>ä¾‹å¦‚, è¡¨è¾¾å¼<code>[^c]ar</code> åŒ¹é…ä¸€ä¸ªåé¢è·Ÿç€<code>ar</code>çš„é™¤äº†<code>c</code>çš„ä»»æ„å­—ç¬¦.</p><pre>"[^c]ar" => The car <a href="#learn-regex"><strong>par</strong></a>ked in the <a href="#learn-regex"><strong>gar</strong></a>age.</pre><p><a href="https://regex101.com/r/nNNlq3/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="2-3-é‡å¤æ¬¡æ•°"><a href="#2-3-é‡å¤æ¬¡æ•°" class="headerlink" title="2.3 é‡å¤æ¬¡æ•°"></a>2.3 é‡å¤æ¬¡æ•°</h2><p>åé¢è·Ÿç€å…ƒå­—ç¬¦ <code>+</code>, <code>*</code> or <code>?</code> çš„, ç”¨æ¥æŒ‡å®šåŒ¹é…å­æ¨¡å¼çš„æ¬¡æ•°.<br>è¿™äº›å…ƒå­—ç¬¦åœ¨ä¸åŒçš„æƒ…å†µä¸‹æœ‰ç€ä¸åŒçš„æ„æ€.</p><h3 id="2-3-1-å·"><a href="#2-3-1-å·" class="headerlink" title="2.3.1 * å·"></a>2.3.1 <code>*</code> å·</h3><p><code>*</code>å·åŒ¹é… åœ¨<code>*</code>ä¹‹å‰çš„å­—ç¬¦å‡ºç°<code>å¤§äºç­‰äº0</code>æ¬¡.<br>ä¾‹å¦‚, è¡¨è¾¾å¼ <code>a*</code> åŒ¹é…ä»¥0æˆ–æ›´å¤šä¸ªaå¼€å¤´çš„å­—ç¬¦, å› ä¸ºæœ‰0ä¸ªè¿™ä¸ªæ¡ä»¶, å…¶å®ä¹Ÿå°±åŒ¹é…äº†æ‰€æœ‰çš„å­—ç¬¦. è¡¨è¾¾å¼<code>[a-z]*</code> åŒ¹é…ä¸€ä¸ªè¡Œä¸­æ‰€æœ‰ä»¥å°å†™å­—æ¯å¼€å¤´çš„å­—ç¬¦ä¸².</p><pre>"[a-z]*" => T<a href="#learn-regex"><strong>he</strong></a> <a href="#learn-regex"><strong>car</strong></a> <a href="#learn-regex"><strong>parked</strong></a> <a href="#learn-regex"><strong>in</strong></a> <a href="#learn-regex"><strong>the</strong></a> <a href="#learn-regex"><strong>garage</strong></a> #21.</pre><p><a href="https://regex101.com/r/7m8me5/1">åœ¨çº¿ç»ƒä¹ </a></p><p><code>*</code>å­—ç¬¦å’Œ<code>.</code>å­—ç¬¦æ­é…å¯ä»¥åŒ¹é…æ‰€æœ‰çš„å­—ç¬¦<code>.*</code>.<br><code>*</code>å’Œè¡¨ç¤ºåŒ¹é…ç©ºæ ¼çš„ç¬¦å·<code>\s</code>è¿èµ·æ¥ç”¨, å¦‚è¡¨è¾¾å¼<code>\s*cat\s*</code>åŒ¹é…0æˆ–æ›´å¤šä¸ªç©ºæ ¼å¼€å¤´å’Œ0æˆ–æ›´å¤šä¸ªç©ºæ ¼ç»“å°¾çš„catå­—ç¬¦ä¸².</p><pre>"\s*cat\s*" => The fat<a href="#learn-regex"><strong> cat </strong></a>sat on the con<a href="#learn-regex"><strong>cat</strong></a>enation.</pre><p><a href="https://regex101.com/r/gGrwuz/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="2-3-2-å·"><a href="#2-3-2-å·" class="headerlink" title="2.3.2 + å·"></a>2.3.2 <code>+</code> å·</h3><p><code>+</code>å·åŒ¹é…<code>+</code>å·ä¹‹å‰çš„å­—ç¬¦å‡ºç° &gt;=1 æ¬¡.<br>ä¾‹å¦‚è¡¨è¾¾å¼<code>c.+t</code> åŒ¹é…ä»¥é¦–å­—æ¯<code>c</code>å¼€å¤´ä»¥<code>t</code>ç»“å°¾,ä¸­é—´è·Ÿç€ä»»æ„ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸².</p><pre>"c.+t" => The fat <a href="#learn-regex"><strong>cat sat on the mat</strong></a>.</pre><p><a href="https://regex101.com/r/Dzf9Aa/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="2-3-3-å·"><a href="#2-3-3-å·" class="headerlink" title="2.3.3 ? å·"></a>2.3.3 <code>?</code> å·</h3><p>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å…ƒå­—ç¬¦ <code>?</code> æ ‡è®°åœ¨ç¬¦å·å‰é¢çš„å­—ç¬¦ä¸ºå¯é€‰, å³å‡ºç° 0 æˆ– 1 æ¬¡.<br>ä¾‹å¦‚, è¡¨è¾¾å¼ <code>[T]?he</code> åŒ¹é…å­—ç¬¦ä¸² <code>he</code> å’Œ <code>The</code>.</p><pre>"[T]he" => <a href="#learn-regex"><strong>The</strong></a> car is parked in the garage.</pre><p><a href="https://regex101.com/r/cIg9zm/1">åœ¨çº¿ç»ƒä¹ </a></p><pre>"[T]?he" => <a href="#learn-regex"><strong>The</strong></a> car is parked in t<a href="#learn-regex"><strong>he</strong></a> garage.</pre><p><a href="https://regex101.com/r/kPpO2x/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="2-4-å·"><a href="#2-4-å·" class="headerlink" title="2.4 {} å·"></a>2.4 <code>&#123;&#125;</code> å·</h2><p>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ <code>&#123;&#125;</code> æ˜¯ä¸€ä¸ªé‡è¯, å¸¸ç”¨æ¥ä¸€ä¸ªæˆ–ä¸€ç»„å­—ç¬¦å¯ä»¥é‡å¤å‡ºç°çš„æ¬¡æ•°.<br>ä¾‹å¦‚,  è¡¨è¾¾å¼ <code>[0-9]&#123;2,3&#125;</code> åŒ¹é…æœ€å°‘ 2 ä½æœ€å¤š 3 ä½ 0~9 çš„æ•°å­—.</p><pre>"[0-9]{2,3}" => The number was 9.<a href="#learn-regex"><strong>999</strong></a>7 but we rounded it off to <a href="#learn-regex"><strong>10</strong></a>.0.</pre><p><a href="https://regex101.com/r/juM86s/1">åœ¨çº¿ç»ƒä¹ </a></p><p>æˆ‘ä»¬å¯ä»¥çœç•¥ç¬¬äºŒä¸ªå‚æ•°.<br>ä¾‹å¦‚, <code>[0-9]&#123;2,&#125;</code> åŒ¹é…è‡³å°‘ä¸¤ä½ 0~9 çš„æ•°å­—.</p><p>å¦‚æœé€—å·ä¹Ÿçœç•¥æ‰åˆ™è¡¨ç¤ºé‡å¤å›ºå®šçš„æ¬¡æ•°.<br>ä¾‹å¦‚, <code>[0-9]&#123;3&#125;</code> åŒ¹é…3ä½æ•°å­—</p><pre>"[0-9]{2,}" => The number was 9.<a href="#learn-regex"><strong>9997</strong></a> but we rounded it off to <a href="#learn-regex"><strong>10</strong></a>.0.</pre><p><a href="https://regex101.com/r/Gdy4w5/1">åœ¨çº¿ç»ƒä¹ </a></p><pre>"[0-9]{3}" => The number was 9.<a href="#learn-regex"><strong>999</strong></a>7 but we rounded it off to 10.0.</pre><p><a href="https://regex101.com/r/Sivu30/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="2-5-ç‰¹å¾æ ‡ç¾¤"><a href="#2-5-ç‰¹å¾æ ‡ç¾¤" class="headerlink" title="2.5 (...) ç‰¹å¾æ ‡ç¾¤"></a>2.5 <code>(...)</code> ç‰¹å¾æ ‡ç¾¤</h2><p>ç‰¹å¾æ ‡ç¾¤æ˜¯ä¸€ç»„å†™åœ¨ <code>(...)</code> ä¸­çš„å­æ¨¡å¼. ä¾‹å¦‚ä¹‹å‰è¯´çš„ <code>&#123;&#125;</code> æ˜¯ç”¨æ¥è¡¨ç¤ºå‰é¢ä¸€ä¸ªå­—ç¬¦å‡ºç°æŒ‡å®šæ¬¡æ•°. ä½†å¦‚æœåœ¨ <code>&#123;&#125;</code> å‰åŠ å…¥ç‰¹å¾æ ‡ç¾¤åˆ™è¡¨ç¤ºæ•´ä¸ªæ ‡ç¾¤å†…çš„å­—ç¬¦é‡å¤ N æ¬¡. ä¾‹å¦‚, è¡¨è¾¾å¼ <code>(ab)*</code> åŒ¹é…è¿ç»­å‡ºç° 0 æˆ–æ›´å¤šä¸ª <code>ab</code>.</p><p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ <code>()</code> ä¸­ç”¨æˆ–å­—ç¬¦ <code>|</code> è¡¨ç¤ºæˆ–. ä¾‹å¦‚, <code>(c|g|p)ar</code> åŒ¹é… <code>car</code> æˆ– <code>gar</code> æˆ– <code>par</code>.</p><pre>"(c|g|p)ar" => The <a href="#learn-regex"><strong>car</strong></a> is <a href="#learn-regex"><strong>par</strong></a>ked in the <a href="#learn-regex"><strong>gar</strong></a>age.</pre><p><a href="https://regex101.com/r/tUxrBG/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="2-6-æˆ–è¿ç®—ç¬¦"><a href="#2-6-æˆ–è¿ç®—ç¬¦" class="headerlink" title="2.6 | æˆ–è¿ç®—ç¬¦"></a>2.6 <code>|</code> æˆ–è¿ç®—ç¬¦</h2><p>æˆ–è¿ç®—ç¬¦å°±è¡¨ç¤ºæˆ–, ç”¨ä½œåˆ¤æ–­æ¡ä»¶.</p><p>ä¾‹å¦‚ <code>(T|t)he|car</code> åŒ¹é… <code>(T|t)he</code> æˆ– <code>car</code>.</p><pre>"(T|t)he|car" => <a href="#learn-regex"><strong>The</strong></a> <a href="#learn-regex"><strong>car</strong></a> is parked in <a href="#learn-regex"><strong>the</strong></a> garage.</pre><p><a href="https://regex101.com/r/fBXyX0/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="2-7-è½¬ç ç‰¹æ®Šå­—ç¬¦"><a href="#2-7-è½¬ç ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="2.7 è½¬ç ç‰¹æ®Šå­—ç¬¦"></a>2.7 è½¬ç ç‰¹æ®Šå­—ç¬¦</h2><p>åæ–œçº¿ <code>\</code> åœ¨è¡¨è¾¾å¼ä¸­ç”¨äºè½¬ç ç´§è·Ÿå…¶åçš„å­—ç¬¦. ç”¨äºæŒ‡å®š <code>&#123; &#125; [ ] / \ + * . $ ^ | ?</code> è¿™äº›ç‰¹æ®Šå­—ç¬¦. å¦‚æœæƒ³è¦åŒ¹é…è¿™äº›ç‰¹æ®Šå­—ç¬¦åˆ™è¦åœ¨å…¶å‰é¢åŠ ä¸Šåæ–œçº¿ <code>\</code>.</p><p>ä¾‹å¦‚ <code>.</code> æ˜¯ç”¨æ¥åŒ¹é…é™¤æ¢è¡Œç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦çš„. å¦‚æœæƒ³è¦åŒ¹é…å¥å­ä¸­çš„ <code>.</code> åˆ™è¦å†™æˆ <code>\.</code> ä»¥ä¸‹è¿™ä¸ªä¾‹å­ <code>\.?</code>æ˜¯é€‰æ‹©æ€§åŒ¹é…<code>.</code></p><pre>"(f|c|m)at\.?" => The <a href="#learn-regex"><strong>fat</strong></a> <a href="#learn-regex"><strong>cat</strong></a> sat on the <a href="#learn-regex"><strong>mat.</strong></a></pre><p><a href="https://regex101.com/r/DOc5Nu/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="2-8-é”šç‚¹"><a href="#2-8-é”šç‚¹" class="headerlink" title="2.8 é”šç‚¹"></a>2.8 é”šç‚¹</h2><p>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­, æƒ³è¦åŒ¹é…æŒ‡å®šå¼€å¤´æˆ–ç»“å°¾çš„å­—ç¬¦ä¸²å°±è¦ä½¿ç”¨åˆ°é”šç‚¹. <code>^</code> æŒ‡å®šå¼€å¤´, <code>$</code> æŒ‡å®šç»“å°¾.</p><h3 id="2-8-1-å·"><a href="#2-8-1-å·" class="headerlink" title="2.8.1 ^ å·"></a>2.8.1 <code>^</code> å·</h3><p><code>^</code> ç”¨æ¥æ£€æŸ¥åŒ¹é…çš„å­—ç¬¦ä¸²æ˜¯å¦åœ¨æ‰€åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´.</p><p>ä¾‹å¦‚, åœ¨ <code>abc</code> ä¸­ä½¿ç”¨è¡¨è¾¾å¼ <code>^a</code> ä¼šå¾—åˆ°ç»“æœ <code>a</code>. ä½†å¦‚æœä½¿ç”¨ <code>^b</code> å°†åŒ¹é…ä¸åˆ°ä»»ä½•ç»“æœ. å› ä¸ºåœ¨å­—ç¬¦ä¸² <code>abc</code> ä¸­å¹¶ä¸æ˜¯ä»¥ <code>b</code> å¼€å¤´.</p><p>ä¾‹å¦‚, <code>^(T|t)he</code> åŒ¹é…ä»¥ <code>The</code> æˆ– <code>the</code> å¼€å¤´çš„å­—ç¬¦ä¸².</p><pre>"(T|t)he" => <a href="#learn-regex"><strong>The</strong></a> car is parked in <a href="#learn-regex"><strong>the</strong></a> garage.</pre><p><a href="https://regex101.com/r/5ljjgB/1">åœ¨çº¿ç»ƒä¹ </a></p><pre>"^(T|t)he" => <a href="#learn-regex"><strong>The</strong></a> car is parked in the garage.</pre><p><a href="https://regex101.com/r/jXrKne/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="2-8-2-å·"><a href="#2-8-2-å·" class="headerlink" title="2.8.2 `###  å·"></a>2.8.2 `###  å·</h3><p>åŒç†äº <code>^</code> å·, <code>$</code> å·ç”¨æ¥åŒ¹é…å­—ç¬¦æ˜¯å¦æ˜¯æœ€åä¸€ä¸ª.</p><p>ä¾‹å¦‚, <code>(at\.)$</code> åŒ¹é…ä»¥ <code>at.</code> ç»“å°¾çš„å­—ç¬¦ä¸².</p><pre>"(at\.)" => The fat c<a href="#learn-regex"><strong>at.</strong></a> s<a href="#learn-regex"><strong>at.</strong></a> on the m<a href="#learn-regex"><strong>at.</strong></a></pre><p><a href="https://regex101.com/r/y4Au4D/1">åœ¨çº¿ç»ƒä¹ </a></p><pre>"(at\.)$" => The fat cat. sat. on the m<a href="#learn-regex"><strong>at.</strong></a></pre><p><a href="https://regex101.com/r/t0AkOd/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="3-ç®€å†™å­—ç¬¦é›†"><a href="#3-ç®€å†™å­—ç¬¦é›†" class="headerlink" title="3. ç®€å†™å­—ç¬¦é›†"></a>3. ç®€å†™å­—ç¬¦é›†</h2><p>æ­£åˆ™è¡¨è¾¾å¼æä¾›ä¸€äº›å¸¸ç”¨çš„å­—ç¬¦é›†ç®€å†™. å¦‚ä¸‹:</p><table><thead><tr><th align="center">ç®€å†™</th><th>æè¿°</th></tr></thead><tbody><tr><td align="center">.</td><td>é™¤æ¢è¡Œç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦</td></tr><tr><td align="center">\w</td><td>åŒ¹é…æ‰€æœ‰å­—æ¯æ•°å­—, ç­‰åŒäº <code>[a-zA-Z0-9_]</code></td></tr><tr><td align="center">\W</td><td>åŒ¹é…æ‰€æœ‰éå­—æ¯æ•°å­—, å³ç¬¦å·, ç­‰åŒäº: <code>[^\w]</code></td></tr><tr><td align="center">\d</td><td>åŒ¹é…æ•°å­—: <code>[0-9]</code></td></tr><tr><td align="center">\D</td><td>åŒ¹é…éæ•°å­—: <code>[^\d]</code></td></tr><tr><td align="center">\s</td><td>åŒ¹é…æ‰€æœ‰ç©ºæ ¼å­—ç¬¦, ç­‰åŒäº: <code>[\t\n\f\r\p&#123;Z&#125;]</code></td></tr><tr><td align="center">\S</td><td>åŒ¹é…æ‰€æœ‰éç©ºæ ¼å­—ç¬¦: <code>[^\s]</code></td></tr><tr><td align="center">\f</td><td>åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦</td></tr><tr><td align="center">\n</td><td>åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦</td></tr><tr><td align="center">\r</td><td>åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦</td></tr><tr><td align="center">\t</td><td>åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦</td></tr><tr><td align="center">\v</td><td>åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦</td></tr><tr><td align="center">\p</td><td>åŒ¹é… CR/LF (ç­‰åŒäº <code>\r\n</code>)ï¼Œç”¨æ¥åŒ¹é… DOS è¡Œç»ˆæ­¢ç¬¦</td></tr></tbody></table><h2 id="4-é›¶å®½åº¦æ–­è¨€-å‰åé¢„æŸ¥"><a href="#4-é›¶å®½åº¦æ–­è¨€-å‰åé¢„æŸ¥" class="headerlink" title="4. é›¶å®½åº¦æ–­è¨€(å‰åé¢„æŸ¥)"></a>4. é›¶å®½åº¦æ–­è¨€(å‰åé¢„æŸ¥)</h2><p>å…ˆè¡Œæ–­è¨€å’Œåå‘æ–­è¨€éƒ½å±äº<strong>éæ•è·ç°‡</strong>(ä¸æ•è·æ–‡æœ¬ ï¼Œä¹Ÿä¸é’ˆå¯¹ç»„åˆè®¡è¿›è¡Œè®¡æ•°).<br>å…ˆè¡Œæ–­è¨€ç”¨äºåˆ¤æ–­æ‰€åŒ¹é…çš„æ ¼å¼æ˜¯å¦åœ¨å¦ä¸€ä¸ªç¡®å®šçš„æ ¼å¼ä¹‹å‰, åŒ¹é…ç»“æœä¸åŒ…å«è¯¥ç¡®å®šæ ¼å¼(ä»…ä½œä¸ºçº¦æŸ).</p><p>ä¾‹å¦‚, æˆ‘ä»¬æƒ³è¦è·å¾—æ‰€æœ‰è·Ÿåœ¨ <code>$</code> ç¬¦å·åçš„æ•°å­—, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£åå‘æ–­è¨€ <code>(?&lt;=\$)[0-9\.]*</code>.<br>è¿™ä¸ªè¡¨è¾¾å¼åŒ¹é… <code>$</code> å¼€å¤´, ä¹‹åè·Ÿç€ <code>0,1,2,3,4,5,6,7,8,9,.</code> è¿™äº›å­—ç¬¦å¯ä»¥å‡ºç°å¤§äºç­‰äº 0 æ¬¡.</p><p>é›¶å®½åº¦æ–­è¨€å¦‚ä¸‹:</p><table><thead><tr><th align="center">ç¬¦å·</th><th>æè¿°</th></tr></thead><tbody><tr><td align="center">?=</td><td>æ­£å…ˆè¡Œæ–­è¨€-å­˜åœ¨</td></tr><tr><td align="center">?!</td><td>è´Ÿå…ˆè¡Œæ–­è¨€-æ’é™¤</td></tr><tr><td align="center">?&lt;=</td><td>æ­£åå‘æ–­è¨€-å­˜åœ¨</td></tr><tr><td align="center">?&lt;!</td><td>è´Ÿåå‘æ–­è¨€-æ’é™¤</td></tr></tbody></table><h3 id="4-1-æ­£å…ˆè¡Œæ–­è¨€"><a href="#4-1-æ­£å…ˆè¡Œæ–­è¨€" class="headerlink" title="4.1 ?=... æ­£å…ˆè¡Œæ–­è¨€"></a>4.1 <code>?=...</code> æ­£å…ˆè¡Œæ–­è¨€</h3><p><code>?=...</code> æ­£å…ˆè¡Œæ–­è¨€, è¡¨ç¤ºç¬¬ä¸€éƒ¨åˆ†è¡¨è¾¾å¼ä¹‹åå¿…é¡»è·Ÿç€ <code>?=...</code>å®šä¹‰çš„è¡¨è¾¾å¼.</p><p>è¿”å›ç»“æœåªåŒ…å«æ»¡è¶³åŒ¹é…æ¡ä»¶çš„ç¬¬ä¸€éƒ¨åˆ†è¡¨è¾¾å¼.<br>å®šä¹‰ä¸€ä¸ªæ­£å…ˆè¡Œæ–­è¨€è¦ä½¿ç”¨ <code>()</code>. åœ¨æ‹¬å·å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªé—®å·å’Œç­‰å·: <code>(?=...)</code>. </p><p>æ­£å…ˆè¡Œæ–­è¨€çš„å†…å®¹å†™åœ¨æ‹¬å·ä¸­çš„ç­‰å·åé¢.<br>ä¾‹å¦‚, è¡¨è¾¾å¼ <code>(T|t)he(?=\sfat)</code> åŒ¹é… <code>The</code> å’Œ <code>the</code>, åœ¨æ‹¬å·ä¸­æˆ‘ä»¬åˆå®šä¹‰äº†æ­£å…ˆè¡Œæ–­è¨€ <code>(?=\sfat)</code> ,å³ <code>The</code> å’Œ <code>the</code> åé¢ç´§è·Ÿç€ <code>(ç©ºæ ¼)fat</code>.</p><pre>"(T|t)he(?=\sfat)" => <a href="#learn-regex"><strong>The</strong></a> fat cat sat on the mat.</pre><p><a href="https://regex101.com/r/IDDARt/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="4-2-è´Ÿå…ˆè¡Œæ–­è¨€"><a href="#4-2-è´Ÿå…ˆè¡Œæ–­è¨€" class="headerlink" title="4.2 ?!... è´Ÿå…ˆè¡Œæ–­è¨€"></a>4.2 <code>?!...</code> è´Ÿå…ˆè¡Œæ–­è¨€</h3><p>è´Ÿå…ˆè¡Œæ–­è¨€ <code>?!</code> ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœ, ç­›é€‰æ¡ä»¶ä¸º å…¶åä¸è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼.<br><code>æ­£å…ˆè¡Œæ–­è¨€</code>  å®šä¹‰å’Œ <code>è´Ÿå…ˆè¡Œæ–­è¨€</code> ä¸€æ ·, åŒºåˆ«å°±æ˜¯ <code>=</code> æ›¿æ¢æˆ <code>!</code> ä¹Ÿå°±æ˜¯ <code>(?!...)</code>.</p><p>è¡¨è¾¾å¼ <code>(T|t)he(?!\sfat)</code> åŒ¹é… <code>The</code> å’Œ <code>the</code>, ä¸”å…¶åä¸è·Ÿç€ <code>(ç©ºæ ¼)fat</code>.</p><pre>"(T|t)he(?!\sfat)" => The fat cat sat on <a href="#learn-regex"><strong>the</strong></a> mat.</pre><p><a href="https://regex101.com/r/V32Npg/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="4-3-lt-æ­£åå‘æ–­è¨€"><a href="#4-3-lt-æ­£åå‘æ–­è¨€" class="headerlink" title="4.3 ?&lt;= ... æ­£åå‘æ–­è¨€"></a>4.3 <code>?&lt;= ...</code> æ­£åå‘æ–­è¨€</h3><p>æ­£åå‘æ–­è¨€ è®°ä½œ<code>(?&lt;=...)</code> ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœ, ç­›é€‰æ¡ä»¶ä¸º å…¶å‰è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼.<br>ä¾‹å¦‚, è¡¨è¾¾å¼ <code>(?&lt;=(T|t)he\s)(fat|mat)</code> åŒ¹é… <code>fat</code> å’Œ <code>mat</code>, ä¸”å…¶å‰è·Ÿç€ <code>The</code> æˆ– <code>the</code>.</p><pre>"(?<=(T|t)he\s)(fat|mat)" => The <a href="#learn-regex"><strong>fat</strong></a> cat sat on the <a href="#learn-regex"><strong>mat</strong></a>.</pre><p><a href="https://regex101.com/r/avH165/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="4-4-lt-è´Ÿåå‘æ–­è¨€"><a href="#4-4-lt-è´Ÿåå‘æ–­è¨€" class="headerlink" title="4.4 ?&lt;!... è´Ÿåå‘æ–­è¨€"></a>4.4 <code>?&lt;!...</code> è´Ÿåå‘æ–­è¨€</h3><p>è´Ÿåå‘æ–­è¨€ è®°ä½œ <code>(?&lt;!...)</code> ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœ, ç­›é€‰æ¡ä»¶ä¸º å…¶å‰ä¸è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼.<br>ä¾‹å¦‚, è¡¨è¾¾å¼ <code>(?&lt;!(T|t)he\s)(cat)</code> åŒ¹é… <code>cat</code>, ä¸”å…¶å‰ä¸è·Ÿç€ <code>The</code> æˆ– <code>the</code>.</p><pre>"(?&lt;!(T|t)he\s)(cat)" => The cat sat on <a href="#learn-regex"><strong>cat</strong></a>.</pre><p><a href="https://regex101.com/r/8Efx5G/1">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="5-æ ‡å¿—"><a href="#5-æ ‡å¿—" class="headerlink" title="5. æ ‡å¿—"></a>5. æ ‡å¿—</h2><p>æ ‡å¿—ä¹Ÿå«æ¨¡å¼ä¿®æ­£ç¬¦, å› ä¸ºå®ƒå¯ä»¥ç”¨æ¥ä¿®æ”¹è¡¨è¾¾å¼çš„æœç´¢ç»“æœ.<br>è¿™äº›æ ‡å¿—å¯ä»¥ä»»æ„çš„ç»„åˆä½¿ç”¨, å®ƒä¹Ÿæ˜¯æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†.</p><table><thead><tr><th align="center">æ ‡å¿—</th><th>æè¿°</th></tr></thead><tbody><tr><td align="center">i</td><td>å¿½ç•¥å¤§å°å†™.</td></tr><tr><td align="center">g</td><td>å…¨å±€æœç´¢.</td></tr><tr><td align="center">m</td><td>å¤šè¡Œçš„: é”šç‚¹å…ƒå­—ç¬¦ <code>^</code> <code>$</code> å·¥ä½œèŒƒå›´åœ¨æ¯è¡Œçš„èµ·å§‹.</td></tr></tbody></table><h3 id="5-1-å¿½ç•¥å¤§å°å†™-Case-Insensitive"><a href="#5-1-å¿½ç•¥å¤§å°å†™-Case-Insensitive" class="headerlink" title="5.1 å¿½ç•¥å¤§å°å†™ (Case Insensitive)"></a>5.1 å¿½ç•¥å¤§å°å†™ (Case Insensitive)</h3><p>ä¿®é¥°è¯­ <code>i</code> ç”¨äºå¿½ç•¥å¤§å°å†™.<br>ä¾‹å¦‚, è¡¨è¾¾å¼ <code>/The/gi</code> è¡¨ç¤ºåœ¨å…¨å±€æœç´¢ <code>The</code>, åœ¨åé¢çš„ <code>i</code> å°†å…¶æ¡ä»¶ä¿®æ”¹ä¸ºå¿½ç•¥å¤§å°å†™, åˆ™å˜æˆæœç´¢ <code>the</code> å’Œ <code>The</code>, <code>g</code> è¡¨ç¤ºå…¨å±€æœç´¢.</p><pre>"The" => <a href="#learn-regex"><strong>The</strong></a> fat cat sat on the mat.</pre><p><a href="https://regex101.com/r/dpQyf9/1">åœ¨çº¿ç»ƒä¹ </a></p><pre>"/The/gi" => <a href="#learn-regex"><strong>The</strong></a> fat cat sat on <a href="#learn-regex"><strong>the</strong></a> mat.</pre><p><a href="https://regex101.com/r/ahfiuh/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="5-2-å…¨å±€æœç´¢-Global-search"><a href="#5-2-å…¨å±€æœç´¢-Global-search" class="headerlink" title="5.2 å…¨å±€æœç´¢ (Global search)"></a>5.2 å…¨å±€æœç´¢ (Global search)</h3><p>ä¿®é¥°ç¬¦ <code>g</code> å¸¸ç”¨äºæ‰§è¡Œä¸€ä¸ªå…¨å±€æœç´¢åŒ¹é…, å³(ä¸ä»…ä»…è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„, è€Œæ˜¯è¿”å›å…¨éƒ¨).<br>ä¾‹å¦‚, è¡¨è¾¾å¼ <code>/.(at)/g</code> è¡¨ç¤ºæœç´¢ ä»»æ„å­—ç¬¦(é™¤äº†æ¢è¡Œ) + <code>at</code>, å¹¶è¿”å›å…¨éƒ¨ç»“æœ.</p><pre>"/.(at)/" => The <a href="#learn-regex"><strong>fat</strong></a> cat sat on the mat.</pre><p><a href="https://regex101.com/r/jnk6gM/1">åœ¨çº¿ç»ƒä¹ </a></p><pre>"/.(at)/g" => The <a href="#learn-regex"><strong>fat</strong></a> <a href="#learn-regex"><strong>cat</strong></a> <a href="#learn-regex"><strong>sat</strong></a> on the <a href="#learn-regex"><strong>mat</strong></a>.</pre><p><a href="https://regex101.com/r/dO1nef/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="5-3-å¤šè¡Œä¿®é¥°ç¬¦-Multiline"><a href="#5-3-å¤šè¡Œä¿®é¥°ç¬¦-Multiline" class="headerlink" title="5.3 å¤šè¡Œä¿®é¥°ç¬¦ (Multiline)"></a>5.3 å¤šè¡Œä¿®é¥°ç¬¦ (Multiline)</h3><p>å¤šè¡Œä¿®é¥°ç¬¦ <code>m</code> å¸¸ç”¨è¯­æ‰§è¡Œä¸€ä¸ªå¤šè¡ŒåŒ¹é….</p><p>åƒä¹‹å‰ä»‹ç»çš„ <code>(^,$)</code> ç”¨äºæ£€æŸ¥æ ¼å¼æ˜¯å¦æ˜¯åœ¨å¾…æ£€æµ‹å­—ç¬¦ä¸²çš„å¼€å¤´æˆ–ç»“å°¾. ä½†æˆ‘ä»¬å¦‚æœæƒ³è¦å®ƒåœ¨æ¯è¡Œçš„å¼€å¤´å’Œç»“å°¾ç”Ÿæ•ˆ, æˆ‘ä»¬éœ€è¦ç”¨åˆ°å¤šè¡Œä¿®é¥°ç¬¦ <code>m</code>.</p><p>ä¾‹å¦‚, è¡¨è¾¾å¼ <code>/at(.)?$/gm</code> è¡¨ç¤ºå°å†™å­—ç¬¦ <code>a</code> åè·Ÿå°å†™å­—ç¬¦ <code>t</code> , æœ«å°¾å¯é€‰é™¤æ¢è¡Œç¬¦å¤–ä»»æ„å­—ç¬¦. æ ¹æ® <code>m</code> ä¿®é¥°ç¬¦, ç°åœ¨è¡¨è¾¾å¼åŒ¹é…æ¯è¡Œçš„ç»“å°¾.</p><pre>"/.at(.)?$/" => The fat                cat sat                on the <a href="#learn-regex"><strong>mat.</strong></a></pre><p><a href="https://regex101.com/r/hoGMkP/1">åœ¨çº¿ç»ƒä¹ </a></p><pre>"/.at(.)?$/gm" => The <a href="#learn-regex"><strong>fat</strong></a>                  cat <a href="#learn-regex"><strong>sat</strong></a>                  on the <a href="#learn-regex"><strong>mat.</strong></a></pre><p><a href="https://regex101.com/r/E88WE2/1">åœ¨çº¿ç»ƒä¹ </a></p><h3 id="6-è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é…-Greedy-vs-lazy-matching"><a href="#6-è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é…-Greedy-vs-lazy-matching" class="headerlink" title="6. è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é… (Greedy vs lazy matching)"></a>6. è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é… (Greedy vs lazy matching)</h3><p>æ­£åˆ™è¡¨è¾¾å¼é»˜è®¤é‡‡ç”¨è´ªå©ªåŒ¹é…æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹æ„å‘³ç€ä¼šåŒ¹é…å°½å¯èƒ½é•¿çš„å­ä¸²ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>?</code> å°†è´ªå©ªåŒ¹é…æ¨¡å¼è½¬åŒ–ä¸ºæƒ°æ€§åŒ¹é…æ¨¡å¼ã€‚</p><pre>"/(.*at)/" => <a href="#learn-regex"><strong>The fat cat sat on the mat</strong></a>. </pre><p><a href="https://regex101.com/r/AyAdgJ/1">åœ¨çº¿ç»ƒä¹ </a></p><pre>"/(.*?at)/" => <a href="#learn-regex"><strong>The fat</strong></a> cat sat on the mat. </pre><p><a href="https://regex101.com/r/AyAdgJ/2">åœ¨çº¿ç»ƒä¹ </a></p><h2 id="è´¡çŒ®"><a href="#è´¡çŒ®" class="headerlink" title="è´¡çŒ®"></a>è´¡çŒ®</h2><ul><li>æŠ¥å‘Šé—®é¢˜</li><li>å¼€æ”¾åˆå¹¶è¯·æ±‚</li><li>ä¼ æ’­æ­¤æ–‡æ¡£</li><li>ç›´æ¥å’Œæˆ‘è”ç³» <a href="mailto:&#x7a;&#x69;&#x69;&#115;&#x68;&#97;&#x6e;&#101;&#x64;&#x40;&#103;&#x6d;&#97;&#105;&#108;&#x2e;&#99;&#111;&#x6d;">&#x7a;&#x69;&#x69;&#115;&#x68;&#97;&#x6e;&#101;&#x64;&#x40;&#103;&#x6d;&#97;&#105;&#108;&#x2e;&#99;&#111;&#x6d;</a> æˆ– <a href="https://twitter.com/ziishaned"><img src="https://img.shields.io/twitter/url/https/twitter.com/ziishaned.svg?style=social&label=Follow%20@ziishaned" alt="Twitter URL"></a></li></ul><h2 id="è®¸å¯è¯"><a href="#è®¸å¯è¯" class="headerlink" title="è®¸å¯è¯"></a>è®¸å¯è¯</h2><p>MIT &copy; <a href="https://twitter.com/ziishaned">Zeeshan Ahmad</a></p>]]></content>
      
      
      <categories>
          
          <category> spring boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>reactjs learn</title>
      <link href="/2019/03/29/reactjs%20learn/"/>
      <url>/2019/03/29/reactjs%20learn/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Like any unfamiliar technology, React does have a learning curve. With practice and some patience, you <em>will</em> get the hang of it.</p></blockquote><ul><li>React also streamlines how data is stored and handled, using <strong>state</strong> and <strong>props</strong>.</li></ul><h3 id="create-react-app"><a href="#create-react-app" class="headerlink" title="create react app"></a>create react app</h3><ul><li><code>npm install -g create-react-app</code></li><li><code>npx create-react-app my-app</code> or <code>npm init react-app my-app</code></li></ul><h2 id="JSX-JavaScript-XML"><a href="#JSX-JavaScript-XML" class="headerlink" title="JSX: JavaScript + XML"></a>JSX: JavaScript + XML</h2><blockquote><p>Babel compiles JSX down to <code>React.createElement()</code> calls.</p></blockquote><p>jsx</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> heading = <span class="xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;site-heading&quot;</span>&gt;</span>Hello, React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>non-jsx</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const heading = React.createElement(&#x27;h1&#x27;, &#123; className: &#x27;site-heading&#x27; &#125;, &#x27;Hello, React!&#x27;)</span><br></pre></td></tr></table></figure><p>the feature of jsx:</p><ul><li><code>className</code> is used instead of <code>class</code> for adding CSS classes, as <code>class</code> is a reserved keyword in JavaScript.</li><li>Properties and methods in JSX are camelCase - <code>onclick</code> will become <code>onClick</code>.</li><li>Self-closing tags <em>must</em> end in a slash - e.g. <code>&lt;img /&gt;</code></li></ul><h2 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h2><blockquote><p>Whether you declare a component <a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components">as a function or a class</a>, it must never modify its own props. </p></blockquote><h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p>The simplest way to define a component is to write a JavaScript function:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Welcome</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Class-Components"><a href="#Class-Components" class="headerlink" title="Class Components"></a>Class Components</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Table</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Job<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Charlie<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>Janitor<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Table</span><br></pre></td></tr></table></figure><h3 id="Simple-Components"><a href="#Simple-Components" class="headerlink" title="Simple Components"></a>Simple Components</h3><blockquote><p>The other type of component in React is the <strong>simple component</strong>, which is a function. This component doesnâ€™t use the <code>class</code> keyword. Letâ€™s take our <code>Table</code> and make two simple components for it - a table header, and a table body.</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TableHeader = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">thead</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>Job<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TableBody = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>Charlie<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>Janitor<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Table</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">TableHeader</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">TableBody</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>Everything should appear as it did before. As you can see, components can be nested in other components, and simple and class components can be mixed.</p><p><strong>A class component must include <code>render()</code>, and the <code>return</code> can only return one parent element.</strong></p><h3 id="Converting-a-Function-to-a-Class"><a href="#Converting-a-Function-to-a-Class" class="headerlink" title="Converting a Function to a Class"></a>Converting a Function to a Class</h3><p>convert a function component to a class in five steps:</p><ol><li>Create an <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Classes">ES6 class</a>, with the same name, that extends <code>React.Component</code>.</li><li>Add a single empty method to it called <code>render()</code>.</li><li>Move the body of the function into the <code>render()</code> method.</li><li>Replace <code>props</code> with <code>this.props</code> in the <code>render()</code> body.</li><li>Delete the remaining empty function declaration.</li></ol><h2 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h2><blockquote><p>Props are an effective way to pass existing data to a React component, however the component cannot change the props - theyâ€™re read-only. </p></blockquote><ul><li><em>props</em> are a way of passing data from parent to child.</li></ul><h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><p>State is similar to props, but it is private and fully controlled by the component.</p><p>State is reserved only for interactivity, that is, data that changes over time. </p><blockquote><p>You can think of state as any data that should be saved and modified without necessarily being added to a database - for example, adding and removing items from a shopping cart before confirming your purchase.</p></blockquote><ul><li><p>You must use <code>this.setState()</code> to modify an array. Simply applying a new value to <code>this.state.property</code> will not work.</p><p> ie.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="built_in">this</span>.state.comment = <span class="string">&#x27;Hello&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="built_in">this</span>.setState(&#123;<span class="attr">comment</span>: <span class="string">&#x27;Hello&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure></li></ul><p>tips:</p><p>Because <code>this.props</code> and <code>this.state</code> may be updated asynchronously, you should not rely on their values for calculating the next state.</p><p>ie.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="built_in">this</span>.setState(&#123;</span><br><span class="line">  <span class="attr">counter</span>: <span class="built_in">this</span>.state.counter + <span class="built_in">this</span>.props.increment,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>use a second form of <code>setState()</code> that accepts a function rather than an object. That function will receive the previous state as the first argument, and the props at the time the update is applied as the second argument:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="built_in">this</span>.setState(<span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">counter</span>: state.counter + props.increment</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h3 id="The-Data-Flows-Down"><a href="#The-Data-Flows-Down" class="headerlink" title="The Data Flows Down"></a>The Data Flows Down</h3><blockquote><p>If you imagine a component tree as a waterfall of props, each componentâ€™s state is like an additional water source that joins it at an arbitrary point but also flows down.</p></blockquote><p>Neither parent nor child components can know if a certain component is stateful or stateless, and they shouldnâ€™t care whether it is defined as a function or a class.</p><p>This is why state is often called local or encapsulated. It is not accessible to any component other than the one that owns and sets it.</p><p>This is commonly called a â€œtop-downâ€ or â€œunidirectionalâ€ data flow. Any state is always owned by some specific component, and any data or UI derived from that state can only affect components â€œbelowâ€ them in the tree.</p><h2 id="Lifecycle-methods"><a href="#Lifecycle-methods" class="headerlink" title="Lifecycle methods"></a>Lifecycle methods</h2><h3 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h3><h3 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount"></a>componentDidMount</h3><blockquote><p>The <code>componentDidMount()</code> method runs after the component output has been rendered to the DOM. </p></blockquote><h3 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount"></a>componentWillUnmount</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;<span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.timerID = <span class="built_in">setInterval</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="built_in">this</span>.tick(),</span><br><span class="line">      <span class="number">1000</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentWillUnmount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timerID);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">tick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>It is &#123;this.state.date.toLocaleTimeString()&#125;.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Clock</span> /&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>Letâ€™s quickly recap whatâ€™s going on and the order in which the methods are called:</p><ol><li>When <code>&lt;Clock /&gt;</code> is passed to <code>ReactDOM.render()</code>, React calls the constructor of the <code>Clock</code>component. Since <code>Clock</code> needs to display the current time, it initializes <code>this.state</code> with an object including the current time. We will later update this state.</li><li>React then calls the <code>Clock</code> componentâ€™s <code>render()</code> method. This is how React learns what should be displayed on the screen. React then updates the DOM to match the <code>Clock</code>â€™s render output.</li><li>When the <code>Clock</code> output is inserted in the DOM, React calls the <code>componentDidMount()</code> lifecycle method. Inside it, the <code>Clock</code> component asks the browser to set up a timer to call the componentâ€™s <code>tick()</code> method once a second.</li><li>Every second the browser calls the <code>tick()</code> method. Inside it, the <code>Clock</code> component schedules a UI update by calling <code>setState()</code> with an object containing the current time. Thanks to the <code>setState()</code> call, React knows the state has changed, and calls the <code>render()</code> method again to learn what should be on the screen. This time, <code>this.state.date</code> in the <code>render()</code> method will be different, and so the render output will include the updated time. React updates the DOM accordingly.</li><li>If the <code>Clock</code> component is ever removed from the DOM, React calls the <code>componentWillUnmount()</code> lifecycle method so the timer is stopped.</li></ol><p>æ€»ç»“ï¼šconstructor-&gt;render()-&gt;componentDidMount()</p><p>stateæ”¹å˜-&gt;render()</p><h3 id="componentWillReceiveProps"><a href="#componentWillReceiveProps" class="headerlink" title="componentWillReceiveProps"></a>componentWillReceiveProps</h3><p>componentWillReceivePropsåœ¨åˆå§‹åŒ–renderçš„æ—¶å€™ä¸ä¼šæ‰§è¡Œï¼Œå®ƒä¼šåœ¨Componentæ¥å—åˆ°æ–°çš„çŠ¶æ€(Props)æ—¶è¢«è§¦å‘ï¼Œä¸€èˆ¬ç”¨äºçˆ¶ç»„ä»¶çŠ¶æ€æ›´æ–°æ—¶å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p><p>åœ¨componentWillReceivePropsä¸­æƒ³ä½œä»»ä½•å˜æ›´æœ€å¥½éƒ½å°†ä¸¤ä¸ªçŠ¶æ€è¿›è¡Œæ¯”è¾ƒï¼Œå‡å¦‚çŠ¶æ€æœ‰å¼‚æ‰æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚ä¸ç„¶å®¹æ˜“é€ æˆç»„ä»¶çš„å¤šæ¬¡æ¸²æŸ“ï¼Œå¹¶ä¸”è¿™äº›æ¸²æŸ“éƒ½æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p><h2 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h2><h2 id="Conditional-Rendering"><a href="#Conditional-Rendering" class="headerlink" title="Conditional Rendering"></a>Conditional Rendering</h2><blockquote><p>Also remember that whenever conditions become too complex, it might be a good time to <a href="https://reactjs.org/docs/components-and-props.html#extracting-components">extract a component</a>.</p></blockquote><ul><li>Returning <code>null</code> from a componentâ€™s <code>render</code> method does not affect the firing of the componentâ€™s lifecycle methods. For instance <code>componentDidUpdate</code> will still be called.</li></ul><h2 id="Lists-and-Keys"><a href="#Lists-and-Keys" class="headerlink" title="Lists and Keys"></a>Lists and Keys</h2><blockquote><p>Keep in mind that if the <code>map()</code> body is too nested, it might be a good time to <a href="https://reactjs.org/docs/components-and-props.html#extracting-components">extract a component</a>.</p></blockquote><h2 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h2><h2 id="Lifting-State-Up"><a href="#Lifting-State-Up" class="headerlink" title="Lifting State Up"></a>Lifting State Up</h2><h2 id="Composition-vs-Inheritance"><a href="#Composition-vs-Inheritance" class="headerlink" title="Composition vs Inheritance"></a>Composition vs Inheritance</h2><ul><li>Remember that components may accept arbitrary props, including primitive values, React elements, or functions.</li></ul><h2 id="Thinking-in-React"><a href="#Thinking-in-React" class="headerlink" title="Thinking in React"></a>Thinking in React</h2><ul><li>You can build top-down or bottom-up. That is, you can either start with building the components higher up in the hierarchy or with the ones lower in it. In simpler examples, itâ€™s usually easier to go top-down, and on larger projects, itâ€™s easier to go bottom-up and write tests as you build.</li><li><strong>Remember</strong>: React is all about one-way data flow down the component hierarchy. </li></ul>]]></content>
      
      
      <categories>
          
          <category> react </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript learn</title>
      <link href="/2019/03/29/javascript%20learn/"/>
      <url>/2019/03/29/javascript%20learn/</url>
      
        <content type="html"><![CDATA[<h3 id="types"><a href="#types" class="headerlink" title="types"></a>types</h3><ul><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number"><code>Number</code></a></p></li><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String"><code>String</code></a></p></li><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean"><code>Boolean</code></a></p><blockquote><p>false, 0, empty strings (â€œâ€), NaN, null, and undefined all become false.</p></blockquote></li><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol"><code>Symbol</code></a> (new in ES2015)</p></li><li><p><code>Object</code></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function"><code>Function</code></a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array"><code>Array</code></a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"><code>Date</code></a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp"><code>RegExp</code></a></li></ul></li><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/null"><code>null</code></a></p></li><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a></p><blockquote><p>declare a variable without assigning a value to it. If you do this, the variableâ€™s type is <code>undefined</code>. <code>undefined</code> is actually a constant.</p></blockquote></li></ul><h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><ul><li><p>let</p><blockquote><p><strong>let</strong> allows you to declare block-level variables. The declared variable is available from the <em>block</em> it is enclosed in.</p></blockquote></li><li><p>const</p><blockquote><p><strong>const</strong> allows you to declare variables whose values are never intended to change. The variable is available from the <em>block</em> it is declared in.</p></blockquote></li><li><p>var</p><blockquote><p>A variable declared with the <strong>var</strong> keyword is available from the written out <em>function</em> (as opposed to an anonymous function) it is declared in.</p></blockquote></li></ul><h3 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h3><blockquote><p><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> , <code>%</code> ,<code>=</code>,<code>+=</code> and <code>-=</code></p></blockquote><h3 id="Control-structures"><a href="#Control-structures" class="headerlink" title="Control structures"></a>Control structures</h3><ul><li><p>Conditional statements are supported by <code>if</code> and <code>else</code></p></li><li><p> <code>while</code> loops and <code>do-while</code> loops.</p></li><li><p> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for"><code>for</code> loop</a> is the same as that in C and Java</p></li></ul>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// Will execute 5 times</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> array) &#123;</span><br><span class="line">  <span class="comment">// do something with value</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> property <span class="keyword">in</span> object) &#123;</span><br><span class="line">  <span class="comment">// do something with object property</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>&amp;&amp;</code> and <code>||</code> operators</p></li><li><p> a ternary operator for conditional expressions:</p></li></ul><p>  <code>var allowed = (age &gt; 18) ? &#39;yes&#39; : &#39;no&#39;;</code></p><ul><li> <code>switch</code> statement </li></ul><h3 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h3><blockquote><p>objects can be thought of as simple collections of name-value pairs, like HashMaps in Java.</p><p>The â€œnameâ€ part is a JavaScript string, while the value can be any JavaScript value â€” including more objects.</p></blockquote><ul><li><p>two basic ways to create an empty object:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">a[<span class="number">0</span>] = <span class="string">&#x27;dog&#x27;</span>;</span><br><span class="line">a[<span class="number">1</span>] = <span class="string">&#x27;cat&#x27;</span>;</span><br><span class="line">a[<span class="number">2</span>] = <span class="string">&#x27;hen&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = [<span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;hen&#x27;</span>];</span><br><span class="line"></span><br><span class="line">a.length; <span class="comment">// 3</span></span><br><span class="line">b.length;<span class="comment">//3</span></span><br></pre></td></tr></table></figure><ul><li><p>terating over an array</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;hen&#x27;</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, array</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Do something with currentValue or array[index]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><blockquote><p>A JavaScript function can take 0 or more named parameters. The function body can contain as many statements as you like and can declare its own variables which are local to that function. The <code>return</code> statement can be used to return a value at any time, terminating the function. If no return statement is used (or an empty return with no value), JavaScript returns <code>undefined</code>.</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">avg</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> args) &#123;</span><br><span class="line">    sum += value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum / args.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//above defined is equivalent to below</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> avg = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = <span class="built_in">arguments</span>.length; i &lt; j; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum / <span class="built_in">arguments</span>.length;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">avg(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>); <span class="comment">// 3.5</span></span><br></pre></td></tr></table></figure><h3 id="Custom-objects"><a href="#Custom-objects" class="headerlink" title="Custom objects"></a>Custom objects</h3><blockquote><p>JavaScript uses functions as classes. </p></blockquote><ul><li><p>the way to attach a function to an object.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makePerson</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">first</span>: first,</span><br><span class="line">    <span class="attr">last</span>: last,</span><br><span class="line">    <span class="attr">fullName</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.first + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.last;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fullNameReversed</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.last + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">this</span>.first;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = makePerson(<span class="string">&#x27;Simon&#x27;</span>, <span class="string">&#x27;Willison&#x27;</span>);</span><br><span class="line">s.fullName(); <span class="comment">// &quot;Simon Willison&quot;</span></span><br><span class="line">s.fullNameReversed(); <span class="comment">// &quot;Willison, Simon&quot;</span></span><br></pre></td></tr></table></figure><p>good:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.first = first;</span><br><span class="line">  <span class="built_in">this</span>.last = last;</span><br><span class="line">  <span class="built_in">this</span>.fullName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.first + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.last;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">this</span>.fullNameReversed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.last + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">this</span>.first;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Person(<span class="string">&#x27;Simon&#x27;</span>, <span class="string">&#x27;Willison&#x27;</span>);</span><br></pre></td></tr></table></figure><p>better:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFullName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.first + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.last;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFullNameReversed</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.last + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">this</span>.first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.first = first;</span><br><span class="line">  <span class="built_in">this</span>.last = last;</span><br><span class="line">  <span class="built_in">this</span>.fullName = personFullName;</span><br><span class="line">  <span class="built_in">this</span>.fullNameReversed = personFullNameReversed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>best:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.first = first;</span><br><span class="line">  <span class="built_in">this</span>.last = last;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.fullName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.first + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.last;</span><br><span class="line">&#125;;</span><br><span class="line">Person.prototype.fullNameReversed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.last + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">this</span>.first;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p><code>this</code> refers to the current object. </p><blockquote><p>What that actually means is specified by the way in which you called that function.</p><p> If you called it using dot notation or bracket notation on an object, that object becomes <code>this</code>.</p><p> If dot notation wasnâ€™t used for the call, <code>this</code> refers to the global object.</p></blockquote></li><li><p><code>new</code> is strongly related to <code>this</code>.</p><blockquote><p>Functions that are designed to be called by <code>new</code> are called constructor functions. Common practice is to capitalize these functions as a reminder to call them with <code>new</code>.</p></blockquote></li><li><p><code>Person.prototype</code> is an object shared by all instances of <code>Person</code>.</p><blockquote><p><strong>prototype chain</strong>:any time you attempt to access a property of <code>Person</code> that isnâ€™t set, JavaScript will check <code>Person.prototype</code> to see if that property exists there instead. As a result, anything assigned to <code>Person.prototype</code> becomes available to all instances of that constructor via the <code>this</code> object.</p></blockquote><ul><li><p>JavaScript lets you modify somethingâ€™s prototype at any time in your program, which means you can add extra methods to existing objects at runtime:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Person(<span class="string">&#x27;Simon&#x27;</span>, <span class="string">&#x27;Willison&#x27;</span>);</span><br><span class="line">s.firstNameCaps(); <span class="comment">// TypeError on line 1: s.firstNameCaps is not a function</span></span><br><span class="line"></span><br><span class="line">Person.prototype.firstNameCaps = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.first.toUpperCase();</span><br><span class="line">&#125;;</span><br><span class="line">s.firstNameCaps(); <span class="comment">// &quot;SIMON&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>the prototype forms part of a chain. The root of that chain is <code>Object.prototype</code>, whose methods include <code>toString()</code> â€” it is this method that is called when you try to represent an object as a string. </p></li></ul></li><li><p>The <strong>call()</strong> method calls a function with a given <code>this</code> value and arguments provided individually.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Product</span>(<span class="params">name, price</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.price = price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Food</span>(<span class="params">name, price</span>) </span>&#123;</span><br><span class="line">  Product.call(<span class="built_in">this</span>, name, price);</span><br><span class="line">  <span class="built_in">this</span>.category = <span class="string">&#x27;food&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Food(<span class="string">&#x27;cheese&#x27;</span>, <span class="number">5</span>).name);</span><br><span class="line"><span class="comment">// expected output: &quot;cheese&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>The <strong>apply()</strong> method calls a function with a given <code>this</code> value, and <code>arguments</code> provided as an array (or an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Indexed_collections#Working_with_array-like_objects">array-like object</a>).</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> max = <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, numbers);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(max);</span><br><span class="line"><span class="comment">// expected output: 7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> min = <span class="built_in">Math</span>.min.apply(<span class="literal">null</span>, numbers);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(min);</span><br><span class="line"><span class="comment">// expected output: 2</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="Inner-functions"><a href="#Inner-functions" class="headerlink" title="Inner functions"></a>Inner functions</h4><p>æ–¹æ³•æ˜¯å­˜å‚¨åœ¨å¯¹è±¡å±æ€§ä¸­çš„å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parentFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">nestedFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">4</span>; <span class="comment">// parentFunc can&#x27;t use this</span></span><br><span class="line">    <span class="keyword">return</span> a + b; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nestedFunc(); <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Closures"><a href="#Closures" class="headerlink" title="Closures"></a>Closures</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeAdder</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> x = makeAdder(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">var</span> y = makeAdder(<span class="number">20</span>);</span><br><span class="line">x(<span class="number">6</span>); <span class="comment">// returns 11</span></span><br><span class="line">y(<span class="number">7</span>); <span class="comment">// returns 27</span></span><br></pre></td></tr></table></figure><blockquote><p>Scope objects form a chain called the scope chain, similar to the prototype chain used by JavaScriptâ€™s object system.</p></blockquote><h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><p><strong>curly braces</strong></p><p>æ‹¬å·ï¼ˆï¼‰</p><p><strong>Spread syntax</strong></p><p>çœç•¥å·</p><ul><li>The spread syntax is simply three dots: <code>...</code></li><li>It allows an iterable to expand in places where 0+ arguments are expected.</li></ul><h4 id="asterisk"><a href="#asterisk" class="headerlink" title="asterisk"></a>asterisk</h4><p>æ˜Ÿå· *</p><h3 id="regular-expression"><a href="#regular-expression" class="headerlink" title="regular expression"></a>regular expression</h3><ul><li><p>æ ¡éªŒå«æœ‰ç©ºæ ¼</p><p><code>reg = /^((?! ).)*$/;</code></p></li><li><p>æ ¡éªŒåªæœ‰æ•°å­—ã€å­—æ¯å’Œä¸‹åˆ’çº¿</p><p><code>reg = /^[_0-9a-z]*$/;</code></p></li></ul><h3 id="setInterval"><a href="#setInterval" class="headerlink" title="setInterval"></a>setInterval</h3><p>å®šæ—¶è°ƒåº¦</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Algorithms + Data Structures = Programs</title>
      <link href="/2018/12/18/Algorithms%20+%20Data%20Structures%20=%20Programs/"/>
      <url>/2018/12/18/Algorithms%20+%20Data%20Structures%20=%20Programs/</url>
      
        <content type="html"><![CDATA[<h3 id="What-is-a-Data-Structure"><a href="#What-is-a-Data-Structure" class="headerlink" title="What is a Data Structure"></a>What is a Data Structure</h3><blockquote><p>a data structure is a container that stores data in a specific layout. </p></blockquote><h3 id="Why-do-we-need-Data-Structure"><a href="#Why-do-we-need-Data-Structure" class="headerlink" title="Why do we need Data Structure"></a>Why do we need Data Structure</h3><blockquote><p>As data structures are used to store data in an organized form, and since data is the most crucial entity in computer science.</p><p>Based on different scenarios, data needs to be stored in a specific format. We have a handful of data structures that cover our need to store data in different formats.</p></blockquote><h3 id="Commonly-used-Data-Structure"><a href="#Commonly-used-Data-Structure" class="headerlink" title="Commonly used Data Structure"></a>Commonly used Data Structure</h3><h4 id="1-Arrays"><a href="#1-Arrays" class="headerlink" title="1. Arrays"></a>1. Arrays</h4><blockquote><p>An array is the simplest and most widely used data structure. Other data structures like stacks and queues are derived from arrays.</p></blockquote><ul><li>the two types of arrays:<ul><li>One-dimensional arrays</li><li>Multi-dimensional arrays</li></ul></li><li>basic operations<ul><li>Inserts an element at given index</li><li>Getâ€Šâ€”â€ŠReturns the element at given index</li><li>Deleteâ€Šâ€”â€ŠDeletes an element at given index</li><li>Sizeâ€Šâ€”â€ŠGet the total number of elements in array</li></ul></li></ul><h4 id="2-Stacks"><a href="#2-Stacks" class="headerlink" title="2. Stacks"></a>2. Stacks</h4><blockquote><p>LIFO (Last In First Out)</p></blockquote><ul><li>basic operations<ul><li>Pushâ€Šâ€”â€ŠInserts an element at the top</li><li>Popâ€Šâ€”â€ŠReturns the top element after removing from the stack</li><li>isEmptyâ€Šâ€”â€ŠReturns true if the stack is empty</li><li>Topâ€Šâ€”â€ŠReturns the top element without removing from the stack</li></ul></li></ul><h4 id="3-Queues"><a href="#3-Queues" class="headerlink" title="3. Queues"></a>3. Queues</h4><blockquote><p>Similar to Stack, Queue is another linear data structure that stores the element in a sequential manner. The only significant difference between Stack and Queue is that instead of using the LIFO method, Queue implements the FIFO method, which is short for First in First Out.</p></blockquote><ul><li>basic operations<ul><li>Enqueue()â€Šâ€”â€ŠInserts element to the end of the queue</li><li>Dequeue()â€Šâ€”â€ŠRemoves an element from the start of the queue</li><li>isEmpty()â€Šâ€”â€ŠReturns true if queue is empty</li><li>Top()â€Šâ€”â€ŠReturns the first element of the queue</li></ul></li></ul><h4 id="4-Linked-List"><a href="#4-Linked-List" class="headerlink" title="4. Linked List"></a>4. Linked List</h4><blockquote><p>A linked list is like a chain of nodes, where each node contains information like data and a pointer to the succeeding node in the chain.</p></blockquote><ul><li>the types of linked lists<ul><li>Singly Linked List (Unidirectional)</li><li>Doubly Linked List (Bi-directional)</li></ul></li><li>basic operations<ul><li><em>InsertAtEnd</em>â€Šâ€”â€ŠInserts given element at the end of the linked list</li><li><em>InsertAtHead</em>â€Šâ€”â€ŠInserts given element at the start/head of the linked list</li><li><em>Delete</em>â€Šâ€”â€ŠDeletes given element from the linked list</li><li><em>DeleteAtHead</em>â€Šâ€”â€ŠDeletes first element of the linked list</li><li><em>Search</em>â€Šâ€”â€ŠReturns the given element from a linked list</li><li><em>isEmpty</em>â€Šâ€”â€ŠReturns true if the linked list is empty</li></ul></li></ul><h4 id="5-Graphs"><a href="#5-Graphs" class="headerlink" title="5. Graphs"></a>5. Graphs</h4><blockquote><p>A graph is a set of nodes that are connected to each other in the form of a network. Nodes are also called vertices. A <strong>pair(x,y)</strong> is called an <strong>edge</strong><em>,</em> which indicates that vertex <strong>x</strong> is connected to vertex <strong>y</strong>. An edge may contain weight/cost, showing how much cost is required to traverse from vertex x to y*.*</p></blockquote><p><img src="https://i.imgur.com/9sHq0Ek.png"></p><ul><li>types of Graphs<ul><li>Undirected Graph</li><li>Directed Graph</li></ul></li></ul><h4 id="6-Trees"><a href="#6-Trees" class="headerlink" title="6. Trees"></a>6. Trees</h4><blockquote><p>A tree is a hierarchical data structure consisting of vertices (nodes) and edges that connect them. Trees are similar to graphs, but the key point that differentiates a tree from the graph is that a cycle cannot exist in a tree.</p></blockquote><p><img src="https://i.imgur.com/R6zwf9U.png"></p><ul><li>the types of trees<ul><li>N-ary Tree</li><li>Balanced Tree</li><li>Binary Tree</li><li>Binary Search Tree</li><li>AVL Tree</li><li>Red Black Tree</li><li>2â€“3 Tree</li></ul><blockquote><p>Out of the above, Binary Tree and Binary Search Tree are the most commonly used trees.</p></blockquote></li></ul><h4 id="7-Trie"><a href="#7-Trie" class="headerlink" title="7. Trie"></a>7. Trie</h4><blockquote><p>Trie, which is also known as â€œPrefix Treesâ€, is a tree-like data structure which proves to be quite efficient for solving problems related to strings. It provides fast retrieval, and is mostly used for searching words in a dictionary, providing auto suggestions in a search engine, and even for IP routing.</p></blockquote><h4 id="8-Hash-Table"><a href="#8-Hash-Table" class="headerlink" title="8. Hash Table"></a>8. Hash Table</h4><blockquote><p>Hashing is a process used to uniquely identify objects and store each object at some pre-calculated unique index called its â€œkey.â€</p><p>Hash tables are generally implemented using arrays.</p></blockquote><ul><li>The performance of hashing data structure depends upon these three factors:<ul><li>Hash Function</li><li>Size of the Hash Table</li><li>Collision Handling Method</li></ul></li></ul><p>Hereâ€™s an illustration of how the hash is mapped in an array. The index of this array is calculated through a Hash Function.</p><p><img src="https://i.imgur.com/fkxWuxr.png"></p><p>reference:</p><ul><li><a href="https://www.cnblogs.com/xdecode/p/9321848.html">å›¾è§£Javaå¸¸ç”¨æ•°æ®ç»“æ„</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> DSA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rpc vs mq</title>
      <link href="/2018/12/08/rpc%20vs%20mq/"/>
      <url>/2018/12/08/rpc%20vs%20mq/</url>
      
        <content type="html"><![CDATA[<h1 id="ç³»ç»Ÿç»“æ„"><a href="#ç³»ç»Ÿç»“æ„" class="headerlink" title="ç³»ç»Ÿç»“æ„"></a>ç³»ç»Ÿç»“æ„</h1><h2 id="rpc"><a href="#rpc" class="headerlink" title="rpc"></a>rpc</h2><blockquote><p> Remote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨</p></blockquote><p>æœåŠ¡ä¹‹é—´çš„è°ƒç”¨å¤§å¤šé‡‡ç”¨rpcçš„æ–¹å¼è°ƒç”¨ï¼Œæˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼è¿›è¡Œè§£è€¦ã€‚</p><p>RPCä¸httpè°ƒç”¨çš„åŒºåˆ«<br>rpcæ˜¯åŸºäºTCP/IPåè®®çš„ï¼Œè€ŒHTTPæœåŠ¡ä¸»è¦æ˜¯åŸºäºHTTPåè®®çš„ï¼Œè€Œhttpåè®®æ˜¯åœ¨ä¼ è¾“å±‚åè®®TCPä¹‹ä¸Šçš„ã€‚æ‰€ä»¥rpcæ•ˆç‡æ›´å¥½ã€‚</p><p>RPCæ˜¯æŒ‡è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤å°æœåŠ¡å™¨Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„å‡½æ•°/æ–¹æ³•ï¼Œ<br>ç”±äºä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚</p><p>ç”±äºè®¡ç®—èƒ½åŠ›éœ€è¦æ¨ªå‘æ‰©å±•ï¼Œéœ€è¦åœ¨å¤šå°æœºå™¨ç»„æˆçš„é›†ç¾¤ä¸Šéƒ¨ç½²åº”ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Consumer =&gt; Provider</span><br><span class="line">Consumerè°ƒç”¨çš„Provideræä¾›çš„æœåŠ¡ã€‚</span><br></pre></td></tr></table></figure><ul><li>åŒæ­¥è°ƒç”¨ï¼Œå¯¹äºè¦ç­‰å¾…è¿”å›ç»“æœ/å¤„ç†ç»“æœçš„åœºæ™¯ï¼ŒRPCæ˜¯å¯ä»¥éå¸¸è‡ªç„¶ç›´è§‰çš„ä½¿ç”¨æ–¹å¼ã€‚</li><li>ç”±äºç­‰å¾…ç»“æœï¼ŒConsumerï¼ˆClientï¼‰ä¼šæœ‰çº¿ç¨‹æ¶ˆè€—ã€‚</li><li>RPCä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œå¦‚æœä»¥å¼‚æ­¥RPCçš„æ–¹å¼ä½¿ç”¨ï¼ŒConsumerï¼ˆClientï¼‰çº¿ç¨‹æ¶ˆè€—å¯ä»¥å»æ‰ã€‚ä½†ä¸èƒ½åšåˆ°åƒæ¶ˆæ¯ä¸€æ ·æš‚å­˜æ¶ˆæ¯/è¯·æ±‚ï¼Œå‹åŠ›ä¼šç›´æ¥ä¼ å¯¼åˆ°æœåŠ¡Providerã€‚</li></ul><h2 id="message-queue"><a href="#message-queue" class="headerlink" title="message queue"></a>message queue</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Sender =&gt; Queue &lt;= Receiver</span><br><span class="line">Senderå‘é€æ¶ˆæ¯ç»™Queue;Receiverä»Queueæ‹¿åˆ°æ¶ˆæ¯æ¥å¤„ç†</span><br></pre></td></tr></table></figure><ul><li>Message QueueæŠŠè¯·æ±‚çš„å‹åŠ›ä¿å­˜ä¸€ä¸‹ï¼Œé€æ¸é‡Šæ”¾å‡ºæ¥ï¼Œè®©å¤„ç†è€…æŒ‰ç…§è‡ªå·±çš„èŠ‚å¥æ¥å¤„ç†ã€‚</li><li>Message Queueå¼•å…¥ä¸€ä¸‹æ–°çš„ç»“ç‚¹ï¼Œè®©ç³»ç»Ÿçš„å¯é æ€§ä¼šå—Message Queueç»“ç‚¹çš„å½±å“ã€‚</li><li>Message Queueæ˜¯<strong>å¼‚æ­¥å•å‘</strong>çš„æ¶ˆæ¯ã€‚å‘é€æ¶ˆæ¯è®¾è®¡æˆæ˜¯<strong>ä¸éœ€è¦ç­‰å¾…</strong>æ¶ˆæ¯å¤„ç†çš„å®Œæˆã€‚</li></ul><h3 id="view"><a href="#view" class="headerlink" title="view"></a>view</h3><ul><li>è¿™ä¸¤è€…å¯ä»¥æ‹¿æ¥æ¯”è¾ƒï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰å¹¶ä¸æ˜¯åŒä¸€ä¸ªå±‚é¢çš„é—®é¢˜ã€‚RPCæ˜¯åˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´è°ƒç”¨çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ˜¯æˆ‘ä»¬åœ¨åšæ¶æ„è®¾è®¡å†³ç­–æ—¶åŒåˆ†å¸ƒå¼å¯¹è±¡ï¼ŒRESTç­‰å±‚é¢çš„ä¸œè¥¿æ¯”è¾ƒï¼Œå†³ç­–çš„ä¸€ä¸ªæ–¹æ¡ˆï¼ æ¶ˆæ¯ç³»ç»Ÿæ›´å¤šæ˜¯æˆ‘ä»¬ä¸ºäº†è§£å†³ç³»ç»Ÿä¹‹é—´çš„è§£è€¦ï¼Œä»¥åŠæ€§èƒ½é—®é¢˜ç­‰æ–¹é¢æ‰€è€ƒè™‘çš„æ–¹æ¡ˆã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> a vs b </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>words fragment</title>
      <link href="/2018/08/28/words%20fragment/"/>
      <url>/2018/08/28/words%20fragment/</url>
      
        <content type="html"><![CDATA[<h3 id="è‹±æ–‡ç¢ç‰‡"><a href="#è‹±æ–‡ç¢ç‰‡" class="headerlink" title="è‹±æ–‡ç¢ç‰‡"></a>è‹±æ–‡ç¢ç‰‡</h3><ul><li>Life is measured by thought and action, not by time.</li><li>Books and friends should be few but good.</li><li>Donâ€™t give your past the power to define your future.</li><li>People will forget what you said, people will forget what you did, but people will never forget how you made them feel.</li><li>Success isnâ€™t about being the best. Itâ€™s about always getting better.</li><li>Be yourself. Everyone else is already taken.</li><li>Itâ€™s kind of fun to do the impossible.</li><li>â€œSimplicity is the ultimate sophistication.â€Leonardo da Vinci</li><li>Build a dream and the dream will build you.</li><li>Always make a total effort, even when the odds are against you.</li><li>You can, you should, and if youâ€™re brave enough to start, you will.</li><li>Never give up, for that is just the place and time that the tide will turn.</li><li>Awareness is the greatest agent for change.</li><li>Nothing can dim the light which shines from within.</li><li>Our dreams can come true if we have the courage to pursue them.</li><li>Patience and perseverance have a magical effect before which difficulties disappear and obstacles vanish.</li><li>What you do makes a difference, and you have to decide what kind of difference you want to make.</li><li>The thing that is really hard, and really amazing, is giving up on being perfect and beginning the work of becoming yourself.</li><li>You are what you do, not what you say youâ€™ll do.</li><li>This is the real secret to lifeâ€”to be completely engaged with what you are doing in the here and now. And instead of calling it work, realize it is play.</li><li>I am strong because Iâ€™ve been weak. I am fearless because Iâ€™ve been afraid. I am wise because Iâ€™ve been foolish.</li><li>Every moment you live in the past is a moment you waste in the present.</li><li>Some changes look negative on the surface, but you will soon realize that space is being created in your life for something new to emerge.</li><li>The world breaks everyone and afterward many are strong at the broken places.</li><li>Donâ€™t bury your failures. Let them inspire you.</li><li>Whether you think you can or you think you canâ€™t, you are right.</li><li>â€œAn investment in knowledge pays the best interest.â€Benjamin Franklin</li><li>Be brave. Take risks. Nothing can substitute experience.</li><li>Learn to walk before run</li><li>This is love, deep in the trenches, worthy of respect, admiration and gratitude.</li><li>You will learn more in three days of acting than in six months of researching.</li></ul><h3 id="ä¸­æ–‡ç¢ç‰‡"><a href="#ä¸­æ–‡ç¢ç‰‡" class="headerlink" title="ä¸­æ–‡ç¢ç‰‡"></a>ä¸­æ–‡ç¢ç‰‡</h3><ul><li><p>è™½åƒä¸‡äººï¼Œå¾å¾€çŸ£ã€‚</p></li><li><p>åœ¨ä¸€ä¸ªè·ªä¸‹å»æ‰èƒ½æ´»ç€çš„æ—¶ä»£ï¼Œè¯·ç»™ç«™ç€çš„äººä¸€ç‚¹æŒå£°</p></li><li><p>ä¸€ä¸ªäººä¸€æ—¦æ¥è§¦åˆ°çœŸç›¸ï¼Œä¾¿æ— æ³•å†å›å¤´å»ç›¸ä¿¡è°è¨€</p></li><li><p>ç å†œä¸é—®å‡ºå¤„ï¼Œå¤§ä½¬ä¸çœ‹å²æ•°</p></li><li><p>è‹±é›„ä¸é—®å‡ºå¤„ï¼Œæµæ°“ä¸çœ‹å²æ•°</p></li><li><p>é•¿å¤šå¤§å±è‚¡ï¼Œç©¿å¤šå¤§è£¤è¡©</p></li><li><p>æ²¡æœ‰æœ€å¥½çš„å¼€å‘è¯­è¨€ï¼Œåªæœ‰æœ€å¥½çš„å¼€å‘è€…</p></li><li><p>æŠŠæ¯ä¸€æ¬¡ç»ƒä¹ éƒ½å½“æˆä¸€æ¬¡è€ƒè¯•</p></li></ul><h3 id="åäººç¢ç‰‡"><a href="#åäººç¢ç‰‡" class="headerlink" title="åäººç¢ç‰‡"></a>åäººç¢ç‰‡</h3><ul><li>ææ·±çš„æš´åŠ›å½“ä¸­éšè—ç€æè‡´çš„æ¸©æŸ”    (åŒ—é‡æ­¦)</li></ul><h3 id="å…¶å®ƒç¢ç‰‡"><a href="#å…¶å®ƒç¢ç‰‡" class="headerlink" title="å…¶å®ƒç¢ç‰‡"></a>å…¶å®ƒç¢ç‰‡</h3><ul><li>arithmetic<ul><li>addition, subtraction, multiplication and division calculations</li></ul></li><li>Promise(æ‰¿è¯º)ã€Earnest(è¯šæŒš)ã€Respect(å°Šé‡)ã€Forgiveness(å®½å®¹)ã€Enioy(äº«å—)ã€Cherish(çæƒœ)ã€Trust(ä¿¡ä»»)</li><li>In any case, measure, donâ€™t guess! Only a measurement will tell you if the parallelism is worth it or not.(from stack overflowâ€™s someone)</li></ul><h3 id="æŠ€æœ¯ç¢ç‰‡"><a href="#æŠ€æœ¯ç¢ç‰‡" class="headerlink" title="æŠ€æœ¯ç¢ç‰‡"></a>æŠ€æœ¯ç¢ç‰‡</h3><ul><li><p>compare two things at different points, this not only makes them easy to compare but also makes it easy to remember differences.</p></li><li><p><strong>WET</strong>(Write everything twice) is a reminder for programmers to strive for excellence in writing readable, well-documented, and maintainable code that benefits both themselves and their colleagues.</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> words </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fragment </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2018/06/01/frontend%20snippet/"/>
      <url>/2018/06/01/frontend%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="http"><a href="#http" class="headerlink" title="http"></a>http</h1><h2 id="http-1-0-http-1-1"><a href="#http-1-0-http-1-1" class="headerlink" title="http 1.0 http 1.1"></a>http 1.0 http 1.1</h2><ul><li><p>HTTP1.0æœ€æ—©åœ¨ç½‘é¡µä¸­ä½¿ç”¨æ˜¯1996å¹´ï¼Œé‚£ä¸ªæ—¶å€™åªæ˜¯ä½¿ç”¨ä¸€äº›è¾ƒä¸ºç®€å•çš„ç½‘é¡µå’Œç½‘ç»œçš„è¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å»ºç«‹ä¸€ä¸ªå•ç‹¬çš„è¿æ¥ï¼Œä¸Šä¸€æ¬¡å’Œä¸‹ä¸€æ¬¡è¯·æ±‚å®Œå…¨åˆ†ç¦»ã€‚è¿™ç§åšæ³•ï¼Œå³ä½¿æ¯æ¬¡çš„è¯·æ±‚é‡éƒ½å¾ˆå°ï¼Œä½†æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¯æ¬¡å»ºç«‹TCPè¿æ¥å’Œå…³é—­TCPè¿æ¥éƒ½æ˜¯ç›¸å¯¹æ¯”è¾ƒè´¹æ—¶çš„è¿‡ç¨‹ï¼Œä¸¥é‡å½±å“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ€§èƒ½ã€‚</p></li><li><p>åŸºäºä»¥ä¸Šçš„é—®é¢˜ï¼ŒHTTP1.1åœ¨1999å¹´å¹¿æ³›åº”ç”¨äºç°åœ¨çš„å„å¤§æµè§ˆå™¨ç½‘ç»œè¯·æ±‚ä¸­ï¼ŒåŒæ—¶HTTP1.1ä¹Ÿæ˜¯å½“å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„HTTPåè®®ï¼ˆ2015å¹´è¯ç”Ÿäº†HTTP2ï¼Œä½†æ˜¯è¿˜æœªå¤§è§„æ¨¡åº”ç”¨ï¼‰ï¼Œè¿™é‡Œä¸è¯¦ç»†å¯¹æ¯”HTTP1.1é’ˆå¯¹HTTP1.0æ”¹è¿›äº†ä»€ä¹ˆï¼Œåªæ˜¯åœ¨è¿æ¥è¿™å—ï¼ŒHTTP1.1æ”¯æŒåœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šä¼ é€å¤šä¸ªHTTPè¯·æ±‚å’Œå“åº”ï¼Œå‡å°‘äº†å»ºç«‹å’Œå…³é—­è¿æ¥çš„æ¶ˆè€—å»¶è¿Ÿï¼Œä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥äº†HTTP1.0æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ›å»ºè¿æ¥çš„ç¼ºç‚¹ï¼Œè¿™å°±æ˜¯é•¿è¿æ¥ï¼ŒHTTP1.1é»˜è®¤ä½¿ç”¨é•¿è¿æ¥ã€‚</p></li><li><p>é‚£ä¹ˆï¼Œé•¿è¿æ¥æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜ç¡®ä¸€ä¸‹ï¼Œé•¿çŸ­è¿æ¥æ˜¯é€šä¿¡å±‚ï¼ˆTCPï¼‰çš„æ¦‚å¿µï¼ŒHTTPæ˜¯åº”ç”¨å±‚åè®®ï¼Œå®ƒåªèƒ½è¯´å‘Šè¯‰é€šä¿¡å±‚æˆ‘æ‰“ç®—ä¸€æ®µæ—¶é—´å†…å¤ç”¨TCPé€šé“è€Œæ²¡æœ‰è‡ªå·±å»å»ºç«‹ã€é‡Šæ”¾TCPé€šé“çš„èƒ½åŠ›ã€‚</p></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/eZzl4LXykQwdKAeT5rjMFfDXeITCDnbwnNXWrFDaIIhBibAk4N83H5dKXAkMNleqewC53Y8WQ6cOhRjA7k4SuMw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"></p><ul><li>httpçš„keep-aliveå’Œtcpçš„keep-aliveçš„åŒºåˆ«<ul><li>httpçš„keep-aliveæ˜¯ä¸ºäº†å¤ç”¨å·²æœ‰è¿æ¥</li><li>tcpçš„keep-aliveæ˜¯ä¸ºäº†ä¿æ´»ï¼Œå³ä¿è¯å¯¹ç«¯è¿˜å­˜æ´»ï¼Œä¸ç„¶å¯¹ç«¯å·²ç»ä¸åœ¨äº†æˆ‘è¿™è¾¹è¿˜å ç€å’Œå¯¹ç«¯çš„è¿™ä¸ªè¿æ¥ï¼Œæµªè´¹æœåŠ¡å™¨èµ„æºï¼Œåšæ³•æ˜¯éš”ä¸€æ®µæ—¶é—´å‘é€ä¸€ä¸ªå¿ƒè·³åŒ…åˆ°å¯¹ç«¯æœåŠ¡å™¨ï¼Œä¸€æ—¦é•¿æ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ°åº”ç­”ï¼Œå°±ä¸»åŠ¨å…³é—­è¿æ¥</li></ul></li></ul><h2 id="WebSockets"><a href="#WebSockets" class="headerlink" title="WebSockets"></a>WebSockets</h2><p>WebSockets provide a persistent connection between a client and server that both parties can use to start sending data at any time.**</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Create a new WebSocket.</span><br><span class="line">var socket = new WebSocket(&#x27;ws://echo.websocket.org&#x27;);</span><br></pre></td></tr></table></figure><ul><li><p>Once the connection has been established the <code>open</code> event will be fired on your WebSocket instance.</p></li><li><p>è¯·æ±‚</p><p><code>ws://localhost:9095/webSocket/d72b3660-29a8-4276-9eb1-3373e82fdd92</code></p></li><li><p>åå°è¯·æ±‚çš„ç»“æœä¼ å…¥websocketæ˜¯é€šè¿‡sessionå»ºç«‹å…³è”çš„</p></li></ul><h2 id="SSEï¼ˆServer-Sent-Eventsï¼‰"><a href="#SSEï¼ˆServer-Sent-Eventsï¼‰" class="headerlink" title="SSEï¼ˆServer-Sent Eventsï¼‰"></a>SSEï¼ˆServer-Sent Eventsï¼‰</h2><p><img src="/images/http/overview-sse.webp"></p><h3 id="client"><a href="#client" class="headerlink" title="client"></a>client</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET/POST /api/v1/live-scores </span><br><span class="line">Accept: text/event-stream</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure><blockquote><p><code>Accept: text/event-stream</code> indicates the client waiting for event stream from the server, <code>Cache-Control: no-cache</code> indicates that disabling the caching and <code>Connection: keep-alive</code> indicates the persistent connection. This request will give us an open connection which we are going to use to fetch updates. After the connection, the server can send messages when the events are ready to send by the server. The important thing is that events are text messages in <code>UTF-8</code> encoding.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;Accept: text/event-stream&quot; -H &quot;Cache-Control: no-cache&quot; -N &lt;SSE_ENDPOINT_URL&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g.</span></span><br><span class="line">curl -X POST -H &quot;Accept: text/event-stream&quot; -H &quot;Cache-Control: no-cache&quot; -H &quot;User-Key: dongwei&quot; -H &quot;Authorization: Bearer xxxxx&quot; -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;content&quot;: &quot;ä½ å¥½&quot;&#125;&#x27; -N http://xxx/api</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¹ç…§éæµå¼</span></span><br><span class="line">curl -X POST -H &quot;Accept: application/json&quot; -H &quot;User-Key: dongwei&quot; -H &quot;Authorization: Bearer xxxxx&quot; -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;content&quot;: &quot;ä½ æœ‰å“ªäº›èƒ½åŠ›&quot;&#125;&#x27; http://xxx/api/</span><br></pre></td></tr></table></figure><h3 id="server"><a href="#server" class="headerlink" title="server"></a>server</h3><h3 id="Disadvantages"><a href="#Disadvantages" class="headerlink" title="Disadvantages"></a>Disadvantages</h3><ul><li>One potential downside of using Server-Sent Events is the limitations in data format. Since SSE is restricted to transporting UTF-8 messages, binary data is not supported.</li><li>When not used over HTTP/2, another limitation is the restricted number of concurrent connections per browser. With only six concurrent open SSE connections allowed at any given time, opening multiple tabs with SSE connections can become a bottleneck. (Credit: Dan Messenger)</li></ul><h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><ul><li>Cookies are text string stored as key/value</li><li>The server Create the cookie and send it to the userâ€™s browser where itâ€™ll be stored.</li><li>The Browser will send that cookie every time it send a request to that server.</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HttpOnly: è¿™ä¸ªå±æ€§ç”¨æ¥é™åˆ¶cookieåªèƒ½é€šè¿‡HTTP(S)åè®®è®¿é—®ï¼Œä¸èƒ½é€šè¿‡å®¢æˆ·ç«¯è„šæœ¬ï¼ˆå¦‚JavaScriptï¼‰è®¿é—®ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰çš„é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…ä¸èƒ½é€šè¿‡è„šæœ¬è¯»å–åˆ°è¿™äº›cookieã€‚</span><br><span class="line"></span><br><span class="line">Max-Age: è¿™ä¸ªå±æ€§å®šä¹‰äº†cookieçš„ç”Ÿå‘½å‘¨æœŸï¼Œå•ä½æ˜¯ç§’ã€‚åœ¨ä½ çš„ä¾‹å­ä¸­ï¼ŒMax-Age=3600è¡¨ç¤ºcookieå°†åœ¨3600ç§’åè¿‡æœŸï¼Œå³1å°æ—¶åã€‚è¿‡æœŸåï¼Œcookieå°†ä¸å†å‘é€åˆ°æœåŠ¡å™¨ã€‚</span><br><span class="line"></span><br><span class="line">Path: è¿™ä¸ªå±æ€§å®šä¹‰äº†cookieçš„è·¯å¾„ï¼Œå³cookieåªèƒ½è¢«å‘é€åˆ°è¿™ä¸ªè·¯å¾„æˆ–å…¶å­è·¯å¾„ä¸‹çš„è¯·æ±‚ä¸­ã€‚Path=/è¡¨ç¤ºcookieå¯¹äºæ•´ä¸ªåŸŸåæ˜¯æœ‰æ•ˆçš„ï¼Œæ— è®ºè¯·æ±‚å“ªä¸ªè·¯å¾„ã€‚</span><br><span class="line"></span><br><span class="line">SameSite: è¿™ä¸ªå±æ€§ç”¨æ¥æ§åˆ¶cookieçš„è·¨ç«™è¯·æ±‚ã€‚SameSite=laxæ˜¯ä¸€ç§è®¾ç½®ï¼Œå®ƒå…è®¸cookieåœ¨é¡¶çº§å¯¼èˆªä¸­è·Ÿéšè·¨ç«™è¯·æ±‚ï¼Œä½†åœ¨ç¬¬ä¸‰æ–¹è¯·æ±‚ä¸­ä¸ä¼šè·Ÿéšã€‚è¿™æ˜¯ä¸€ç§æŠ˜ä¸­çš„æ–¹æ³•ï¼Œæ—¨åœ¨æä¾›ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§ï¼ŒåŒæ—¶å…è®¸ä¸€äº›åˆç†çš„è·¨ç«™è¯·æ±‚ã€‚laxæ¨¡å¼æ¯”strictæ¨¡å¼æ›´å®½æ¾ï¼Œä½†æ¯”æ²¡æœ‰SameSiteå±æ€§æˆ–è®¾ç½®ä¸ºNoneæ›´å®‰å…¨ã€‚</span><br><span class="line"></span><br><span class="line">Secure: è¿™ä¸ªå±æ€§æŒ‡ç¤ºcookieåªèƒ½é€šè¿‡HTTPSåè®®ä¼ è¾“ï¼Œä¸èƒ½é€šè¿‡HTTPã€‚è¿™å¢åŠ äº†cookieçš„å®‰å…¨æ€§ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šè¢«æ˜æ–‡ä¼ è¾“ï¼Œå‡å°‘äº†ä¸­é—´äººæ”»å‡»çš„é£é™©ã€‚</span><br></pre></td></tr></table></figure><h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><ul><li>This session is associated with a randomly generated unique ID, which is created by the server. Itâ€™s called â€œsession IDâ€.</li><li>The generated session ID is then sent to the userâ€™s browser and stored as a cookie, while the session data is stored on the server-side.</li><li>Sessions are often used to store sensitive information such as user credentials and financial data. They are more secure than cookies because the information is stored on the server-side and not on the client-side.</li></ul><h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><ul><li><a href="https://medium.com/deliveryherotechhub/what-is-server-sent-events-sse-and-how-to-implement-it-904938bffd73">https://medium.com/deliveryherotechhub/what-is-server-sent-events-sse-and-how-to-implement-it-904938bffd73</a></li></ul><h1 id="html"><a href="#html" class="headerlink" title="html"></a>html</h1><h2 id="label"><a href="#label" class="headerlink" title="label"></a>label</h2><ul><li><p>chromeé¡µé¢è·³è½¬ï¼Œéœ€è¦ä½¿ç”¨ i æ ‡ç­¾ï¼Œä¸èƒ½ä½¿ç”¨ button æ ‡ç­¾ï¼Œå› ä¸ºåœ¨buttonçš„ç‚¹å‡»äº‹ä»¶ä¸­ï¼Œwindow.location.hrefä¸èµ·ä½œç”¨ã€‚ï¼ˆä½†firefoxèµ·ä½œç”¨ï¼‰</p></li><li><p>textareaæ ‡ç­¾é‡Œé¢çš„å±æ€§è¦ç´§é ä¹¦å†™ï¼Œä¸”ä¸è¦æ¢è¡Œï¼Œä¸ç„¶ï¼Œä¼šæ˜¾ç¤ºtextareaé»˜è®¤èµ‹å€¼ä¸ºå¤šä¸ªç©ºæ ¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span><span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span><span class="attr">id</span>=<span class="string">&quot;obj_address&quot;</span><span class="attr">placeholder</span>=<span class="string">&quot;åœ°å€ï¼ˆå¿…å¡«ï¼‰&quot;</span><span class="attr">name</span>=<span class="string">&quot;address&quot;</span><span class="attr">isvalid</span>=<span class="string">&quot;yes&quot;</span><span class="attr">checkexpession</span>=<span class="string">&quot;NotNull&quot;</span><span class="attr">errormsg</span>=<span class="string">&quot;åœ°å€&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="css"><a href="#css" class="headerlink" title="css"></a>css</h2><h3 id="display"><a href="#display" class="headerlink" title="display"></a>display</h3><p>æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„ display ç±»å‹<br>ä¸è¿‡ä½ å¯ä»¥éšæ—¶éšåœ°çš„é‡å†™å®ƒï¼å¦‚å¸¸è§çš„ä¾‹å­æ˜¯ï¼šæŠŠ li å…ƒç´ ä¿®æ”¹æˆ inlineï¼Œåˆ¶ä½œæˆæ°´å¹³èœå•ã€‚</p><p>pæ ‡ç­¾æ˜¯å—çº§å…ƒç´ ï¼Œspanå…ƒç´ æ˜¯è¡Œå†…å…ƒç´ ã€‚å†…å…ƒç´ å¯ä»¥å†™åœ¨å—çº§å…ƒç´ é‡Œé¢  æ¯”å¦‚<code>&lt;p&gt;&lt;span&gt;å†…å®¹&lt;/span&gt;&lt;/p&gt;</code></p><ul><li>block</li></ul><p>å€¼ä¸ºblockçš„ä¸ºå—çº§å…ƒç´ ï¼Œ å¦‚ï¼špã€formã€headerã€footerã€section</p><ul><li>inline</li></ul><p>å€¼ä¸ºinlineçš„ä¸ºè¡Œå†…å…ƒç´ </p><h3 id="position"><a href="#position" class="headerlink" title="position"></a>position</h3><ul><li>static</li></ul><p>staticæ˜¯é»˜è®¤å€¼ï¼Œä¸€ä¸ªstaticå…ƒç´ è¡¨ç¤ºå®ƒä¸ä¼šè¢«â€positionedâ€,ä¸€ä¸ªpositionå±æ€§è¢«è®¾ç½®ä¸ºå…¶å®ƒå€¼å¾—å…ƒç´ è¡¨ç¤ºå®ƒä¼šè¢«â€positionedâ€</p><ul><li>relative</li></ul><p>relative,åœ¨ä¸€ä¸ªç›¸å¯¹å®šä½ï¼ˆpositionå±æ€§çš„å€¼ä¸ºrelativeï¼‰çš„å…ƒç´ ä¸Šè®¾ç½® top ã€ right ã€ bottom å’Œ left å±æ€§ä¼šä½¿å…¶åç¦»å…¶æ­£å¸¸ä½ç½®ã€‚<br>å…¶ä»–çš„å…ƒç´ çš„ä½ç½®åˆ™ä¸ä¼šå—è¯¥å…ƒç´ çš„å½±å“å‘ç”Ÿä½ç½®æ”¹å˜æ¥å¼¥è¡¥å®ƒåç¦»åå‰©ä¸‹çš„ç©ºéš™ã€‚</p><ul><li>fixed</li></ul><p>fixed,ä¸€ä¸ªå›ºå®šå®šä½ï¼ˆpositionå±æ€§çš„å€¼ä¸ºfixedï¼‰å…ƒç´ ä¼šç›¸å¯¹äºè§†çª—æ¥å®šä½ï¼Œè¿™æ„å‘³ç€å³ä¾¿é¡µé¢æ»šåŠ¨ï¼Œå®ƒè¿˜æ˜¯ä¼šåœç•™åœ¨ç›¸åŒçš„ä½ç½®ã€‚<br>å’Œ relative ä¸€æ ·ï¼Œ top ã€ right ã€ bottom å’Œ left å±æ€§éƒ½å¯ç”¨ã€‚</p><ul><li>absolute</li></ul><p>absolute, å®ƒä¸ fixed çš„è¡¨ç°ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä¸æ˜¯ç›¸å¯¹äºè§†çª—è€Œæ˜¯ç›¸å¯¹äºæœ€è¿‘çš„â€œpositionedâ€ç¥–å…ˆå…ƒç´ ã€‚<br>å¦‚æœç»å¯¹å®šä½ï¼ˆpositionå±æ€§çš„å€¼ä¸ºabsoluteï¼‰çš„å…ƒç´ æ²¡æœ‰â€œpositionedâ€ç¥–å…ˆå…ƒç´ ï¼Œé‚£ä¹ˆå®ƒæ˜¯ç›¸å¯¹äºæ–‡æ¡£çš„ body å…ƒç´ ï¼Œå¹¶ä¸”å®ƒä¼šéšç€é¡µé¢æ»šåŠ¨è€Œç§»åŠ¨ã€‚<br>è®°ä½ä¸€ä¸ªâ€œpositionedâ€å…ƒç´ æ˜¯æŒ‡ position å€¼ä¸æ˜¯ static çš„å…ƒç´ ã€‚</p><h3 id="mbp"><a href="#mbp" class="headerlink" title="mbp"></a>mbp</h3><p><img src="https://mdn.mozillademos.org/files/13647/box-model-standard-small.png"></p><ul><li><p>margin</p><blockquote><p>æ˜¯è®¾ç½®ä¸¤ä¸ªæ ‡ç­¾çš„é—´éš”ï¼Œä¹Ÿå°±æ˜¯è·ç¦»</p></blockquote></li><li><p>padding</p><blockquote><p>æ¯”å¦‚ä¸€ä¸ªpæ ‡ç­¾ï¼Œå®ƒæ˜¯100px*100px,æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™pæ ‡ç­¾çš„æ–‡å­—æ˜¯è´´ç€pæ ‡ç­¾çš„æœ€å·¦ä¾§çš„ï¼Œæƒ³è¦å®ƒçš„æ–‡å­—è·ç¦»è¾¹ç•Œè¿œä¸€ç‚¹ï¼Œå¥½çœ‹ä¸€ç‚¹ï¼Œå°±æ˜¯éœ€è¦åšä¸€ä¸ªæ ·å¼çš„è°ƒæ•´ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åˆ°paddingè¿™ä¸ªå±æ€§ï¼Œå‡å¦‚è¯´è®¾ç½®æ˜¯10pxï¼Œå°±æ˜¯è¯´è¿™ä¸ªpæ ‡ç­¾çš„å¤§å°ä¾ç„¶æ˜¯100px*100pxï¼Œä½†æ˜¯å®ƒçš„å†…å®¹æ˜¯å˜æˆäº†90px*90pxï¼›</p></blockquote></li><li><p>border</p><blockquote><p>boarderæ˜¯è®¾ç½®è¾¹æ¡†çš„æ„æ€ï¼Œä»–å’Œpaddingçš„åŒºåˆ«åœ¨äºï¼Œpaddingæ˜¯åœ¨æ ‡ç­¾è¾¹ç¼˜å¾€é‡Œç¼©å‡ï¼Œè€Œborderæ˜¯åœ¨æ ‡ç­¾çš„è¾¹ç¼˜å¾€å¤–æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯ä¸€ä¸ª100px*100pxçš„æ ‡ç­¾ï¼Œæˆ‘è®¾ç½®ä»–çš„borderä¸º20pxï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ•´ä¸ªæ ‡ç­¾çš„å¤§å°æ˜¯å˜æˆäº†120px*120pxï¼Œä¹Ÿå°±æ˜¯è¯´å¤šå‡ºæ¥äº†120pxï¼Œå…¶æ ‡ç­¾çš„å†…å®¹ä¹Ÿè¿˜æ˜¯100px*100pxçš„</p></blockquote></li></ul><h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><h2 id="ç‰ˆæœ¬ç®¡ç†"><a href="#ç‰ˆæœ¬ç®¡ç†" class="headerlink" title="ç‰ˆæœ¬ç®¡ç†"></a>ç‰ˆæœ¬ç®¡ç†</h2><ul><li>å¯ä»¥ç”¨ nvm è¿›è¡Œç®¡ç†</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vueé¡¹ç›®ï¼š npm run dev  ä¼šåœ¨å¼€å‘ç¯å¢ƒä¸‹ ç«‹å³å¯åŠ¨é¡¹ç›®   </span><br><span class="line"></span><br><span class="line">reacté¡¹ç›®ï¼š npm run start  ä¼šåœ¨å¼€å‘ç¯å¢ƒä¸‹ ç«‹å³å¯åŠ¨é¡¹ç›®</span><br><span class="line"></span><br><span class="line">ç¼–è¯‘æ‰“åŒ…é¡¹ç›®:npm run build  </span><br></pre></td></tr></table></figure><h1 id="jquery"><a href="#jquery" class="headerlink" title="jquery"></a>jquery</h1><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><ul><li><p>è®¾ç½®æ ‡ç­¾å±æ€§</p><p><code>$(&quot;div&quot;).attr(&quot;å±æ€§å&quot;,&quot;å±æ€§å€¼&quot;);</code></p></li><li><p>è®¾ç½®æ ‡ç­¾æ ·å¼</p><p><code>$(&quot;div&quot;).css(&quot;color&quot;,&quot;yellow&quot;); </code>æˆ–<code>$(&quot;div&quot;).css(&quot;padding-left&quot;))</code></p></li><li><p>ç§»é™¤å±æ€§</p><p><code> $(&quot;div&quot;).removeAttr(&quot;id&quot;);</code></p></li><li><p>éå†æ•°ç»„</p><ul><li><p>åŸç”Ÿjsæœ‰ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨[for(var i;i&lt;arr.length;i++){},for(var i in arr){}] </p></li><li><p>jqueryæœ‰ä¸¤ä¸ªå‡½æ•°å…±è®¡å››ç§æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$.each(arr,<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;&#125;),</span><br><span class="line">$(arr).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;&#125;), </span><br><span class="line">$.map(arr,<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;&#125;), </span><br><span class="line">$(arr).map(<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>éå†å¯¹è±¡ </p><ul><li><p>åŸç”Ÿjsæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨[for(var i in obj){}] </p></li><li><p>jqueryæœ‰ä¸¤ä¸ªå‡½æ•°å…±è®¡ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$.each(obj,<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;&#125;)</span><br><span class="line">$.map(obj,<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Jqueryä¸­çš„ajaxåœ¨é»˜è®¤ä¸å†™asyncæƒ…å†µä¸‹ï¼Œè¯·æ±‚ä¸ºå¼‚æ­¥è¯·æ±‚ï¼›å³ï¼šasync:true</p></li><li><p><code>$(function()&#123; &#125;)</code>æ˜¯å®šä¹‰ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå®ƒæ˜¯<code>$(document).ready(function()&#123;&#125;)</code>çš„ç®€å†™</p></li></ul><h1 id="jpa"><a href="#jpa" class="headerlink" title="jpa"></a>jpa</h1><h2 id="What-is"><a href="#What-is" class="headerlink" title="What is"></a>What is</h2><blockquote><p>Java Persistence API is a collection of classes and methods to persistently store the vast amounts of data into a database which is provided by the Oracle Corporation.</p></blockquote><h2 id="Where-to-use"><a href="#Where-to-use" class="headerlink" title="Where to use"></a>Where to use</h2><blockquote><p>To reduce the burden of writing codes for relational object management, a programmer follows the â€˜JPA Providerâ€™ framework, which allows easy interaction with database instance. Here the required framework is taken over by JPA.</p></blockquote><p><img src="https://www.tutorialspoint.com/jpa/images/jpa_provider.png"></p><ul><li><p>JPA Pro</p><blockquote><p>JPA is an open source API, therefore various enterprise vendors such as Oracle, Redhat, Eclipse, etc. provide new products by adding the JPA persistence flavor in them. Some of these products include:<strong>Hibernate, Eclipselink, Toplink, Spring Data JPA, etc.</strong></p></blockquote></li></ul><h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><p><img src="https://www.tutorialspoint.com/jpa/images/jpa_class_level_architecture.png"></p><ul><li><p>jpa class relationships</p><p><img src="https://www.tutorialspoint.com/jpa/images/jpa_class_relationships.png"></p></li><li><p>ORM Architecture</p><p><img src="https://www.tutorialspoint.com/jpa/images/object_relational_mapping.png"></p></li><li><p>Entity Relationships</p><ul><li>@ManyToOne Relation</li><li>@OneToMany Relation</li><li>@OneToOne Relation</li><li>@ManyToMany Relation</li></ul></li></ul><h2 id="session-1"><a href="#session-1" class="headerlink" title="session"></a>session</h2><blockquote><p>Session simply means a particular interval of time.<br>Session Tracking is a way to maintain state (data) of an user. It is also known as session management in servlet.</p></blockquote><ul><li><p>HTTP is stateless that means each request is considered as the new request. It is shown in the figure given below:<br><img src="https://www.javatpoint.com/images/newrequest.JPG"></p></li><li><p>There are four techniques used in Session tracking:</p><ul><li>Cookies</li><li>Hidden Form Field</li><li>URL Rewriting</li><li>HttpSession</li></ul></li></ul><h2 id="cookie-1"><a href="#cookie-1" class="headerlink" title="cookie"></a>cookie</h2><blockquote><p>A cookie is a small piece of information that is persisted between the multiple client requests.<br>A cookie has a name, a single value, and optional attributes such as a comment, path and domain qualifiers, a maximum age, and a version number.</p></blockquote><h3 id="how-cookie-work"><a href="#how-cookie-work" class="headerlink" title="how cookie work"></a>how cookie work</h3><p><img src="https://www.javatpoint.com/phppages/images/cookie.png"></p><h3 id="type-of-cookie"><a href="#type-of-cookie" class="headerlink" title="type of cookie"></a>type of cookie</h3><ul><li><p>Non-persistent cookie</p><blockquote><p>It is valid for single session only. It is removed each time when user closes the browser.</p></blockquote></li><li><p>Persistent cookie</p><blockquote><p>It is valid for multiple session . It is not removed each time when user closes the browser. It is removed only if user logout or signout.</p></blockquote></li><li><p>Advantage </p><ul><li>Simplest technique of maintaining the state.</li><li>Cookies are maintained at client side.</li></ul></li><li><p>Disadvantage</p><ul><li>It will not work if cookie is disabled from the browser.</li><li>Only textual information can be set in Cookie object.</li></ul></li></ul><h1 id="HttpSession-Interface"><a href="#HttpSession-Interface" class="headerlink" title="HttpSession Interface"></a>HttpSession Interface</h1><ul><li>An object of HttpSession can be used to perform two tasks:<ul><li>bind objects</li><li>view and manipulate information about a session, such as the session identifier, creation time, and last accessed time.<br><img src="https://www.javatpoint.com/images/httpsession.JPG"></li></ul></li></ul><h1 id="DVA"><a href="#DVA" class="headerlink" title="DVA"></a>DVA</h1><p>dva = React-Router + Redux + Redux-saga</p><ul><li>è·¯ç”±ï¼š <a href="https://github.com/ReactTraining/react-router/tree/v2.8.1">React-Router</a></li><li>æ¶æ„ï¼š <a href="https://github.com/reactjs/redux">Redux</a></li><li>å¼‚æ­¥æ“ä½œï¼š <a href="https://github.com/yelouafi/redux-saga">Redux-saga</a></li></ul><p><img src="/Users/dongwei/Documents/hexo/source/_posts/img/PPrerEAKbIoDZYr.png"></p><h3 id="State"><a href="#State" class="headerlink" title="State"></a>State</h3><p>tate è¡¨ç¤º Model çš„çŠ¶æ€æ•°æ®</p><h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p>Action æ˜¯ä¸€ä¸ªæ™®é€š javascript å¯¹è±¡ï¼Œå®ƒæ˜¯æ”¹å˜ State çš„å”¯ä¸€é€”å¾„ã€‚</p><ul><li>action å¿…é¡»å¸¦æœ‰ <code>type</code> å±æ€§æŒ‡æ˜å…·ä½“çš„è¡Œä¸ºï¼Œå…¶å®ƒå­—æ®µå¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœè¦å‘èµ·ä¸€ä¸ª action éœ€è¦ä½¿ç”¨ <code>dispatch</code> å‡½æ•°ï¼›éœ€è¦æ³¨æ„çš„æ˜¯ <code>dispatch</code> æ˜¯åœ¨ç»„ä»¶ connect Modelsä»¥åï¼Œé€šè¿‡ props ä¼ å…¥çš„ã€‚</li></ul><h3 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h3><p>dispatching function æ˜¯ä¸€ä¸ªç”¨äºè§¦å‘ action çš„å‡½æ•°</p><ul><li><p>action æ˜¯æ”¹å˜ State çš„å”¯ä¸€é€”å¾„ï¼Œä½†æ˜¯actionåªæè¿°äº†ä¸€ä¸ªè¡Œä¸ºï¼Œè€Œ dipatch å¯ä»¥çœ‹ä½œæ˜¯è§¦å‘è¿™ä¸ªè¡Œä¸ºçš„æ–¹å¼ï¼Œè€Œ Reducer åˆ™æ˜¯æè¿°å¦‚ä½•æ”¹å˜æ•°æ®çš„ã€‚</p></li><li><p>connect Model çš„ç»„ä»¶é€šè¿‡ props å¯ä»¥è®¿é—®åˆ° dispatchï¼Œå¯ä»¥è°ƒç”¨ Model ä¸­çš„ Reducer æˆ–è€… Effects.</p></li></ul><h3 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h3><p>Reducerå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¹‹å‰å·²ç»ç´¯ç§¯è¿ç®—çš„ç»“æœå’Œå½“å‰è¦è¢«ç´¯ç§¯çš„å€¼ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ç´¯ç§¯ç»“æœã€‚è¯¥å‡½æ•°æŠŠä¸€ä¸ªé›†åˆå½’å¹¶æˆä¸€ä¸ªå•å€¼ã€‚</p><ul><li>åœ¨ dva ä¸­ï¼Œreducers èšåˆç§¯ç´¯çš„ç»“æœæ˜¯å½“å‰ model çš„ state å¯¹è±¡ã€‚é€šè¿‡ actions ä¸­ä¼ å…¥çš„å€¼ï¼Œä¸å½“å‰ reducers ä¸­çš„å€¼è¿›è¡Œè¿ç®—è·å¾—æ–°çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯æ–°çš„ stateï¼‰ã€‚</li></ul><h3 id="Effect"><a href="#Effect" class="headerlink" title="Effect"></a>Effect</h3><p>Effect è¢«ç§°ä¸ºå‰¯ä½œç”¨ï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œæœ€å¸¸è§çš„å°±æ˜¯å¼‚æ­¥æ“ä½œã€‚</p><ul><li><p>å®ƒæ¥è‡ªäºå‡½æ•°ç¼–ç¨‹çš„æ¦‚å¿µï¼Œä¹‹æ‰€ä»¥å«å‰¯ä½œç”¨æ˜¯å› ä¸ºå®ƒä½¿å¾—æˆ‘ä»¬çš„å‡½æ•°å˜å¾—ä¸çº¯ï¼ŒåŒæ ·çš„è¾“å…¥ä¸ä¸€å®šè·å¾—åŒæ ·çš„è¾“å‡ºã€‚</p></li><li><p>dva ä¸ºäº†æ§åˆ¶å‰¯ä½œç”¨çš„æ“ä½œï¼Œå°†å¼‚æ­¥è½¬æˆåŒæ­¥å†™æ³•ï¼Œä»è€Œå°†effectsè½¬ä¸ºçº¯å‡½æ•°</p></li></ul><h3 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h3><p>Subscriptions æ˜¯ä¸€ç§ä» <strong>æº</strong> è·å–æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒæ¥è‡ªäº elmã€‚</p><ul><li>Subscription è¯­ä¹‰æ˜¯è®¢é˜…ï¼Œç”¨äºè®¢é˜…ä¸€ä¸ªæ•°æ®æºï¼Œç„¶åæ ¹æ®æ¡ä»¶ dispatch éœ€è¦çš„ actionã€‚</li></ul><h3 id="æ•°æ®æµå›¾"><a href="#æ•°æ®æµå›¾" class="headerlink" title="æ•°æ®æµå›¾"></a>æ•°æ®æµå›¾</h3><p><img src="/Users/dongwei/Documents/hexo/source/_posts/img/hUFIivoOFjVmwNXjjfPE.png"></p><ul><li><p>State æ˜¯å‚¨å­˜æ•°æ®çš„åœ°æ–¹ï¼Œæ”¶åˆ° Action ä»¥åï¼Œä¼šæ›´æ–°æ•°æ®ã€‚</p></li><li><p>View å°±æ˜¯ React ç»„ä»¶æ„æˆçš„ UI å±‚ï¼Œä» State å–æ•°æ®åï¼Œæ¸²æŸ“æˆ HTML ä»£ç ã€‚åªè¦ State æœ‰å˜åŒ–ï¼ŒView å°±ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p></li><li><p>Action æ˜¯ç”¨æ¥æè¿° UI å±‚äº‹ä»¶çš„ä¸€ä¸ªå¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dispatch(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;click-submit-button&#x27;</span>,</span><br><span class="line">  <span class="attr">payload</span>: <span class="built_in">this</span>.form.data</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>connect æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç»‘å®š State åˆ° Viewã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;dva&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">todos</span>: state.todos &#125;;</span><br><span class="line">&#125;</span><br><span class="line">connect(mapStateToProps)(App);</span><br></pre></td></tr></table></figure><p>connect æ–¹æ³•è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª React ç»„ä»¶ï¼Œé€šå¸¸ç§°ä¸ºå®¹å™¨ç»„ä»¶ã€‚å› ä¸ºå®ƒæ˜¯åŸå§‹ UI ç»„ä»¶çš„å®¹å™¨ï¼Œå³åœ¨å¤–é¢åŒ…äº†ä¸€å±‚ Stateã€‚</p></li><li><p>dispatch æ˜¯ä¸€ä¸ªå‡½æ•°æ–¹æ³•ï¼Œç”¨æ¥å°† Action å‘é€ç»™ Stateã€‚</p><p><strong>è¢« connect çš„ Component ä¼šè‡ªåŠ¨åœ¨ props ä¸­æ‹¥æœ‰ dispatch æ–¹æ³•ã€‚</strong></p></li></ul><h3 id="æ•°æ®æµå›¾äºŒ"><a href="#æ•°æ®æµå›¾äºŒ" class="headerlink" title="æ•°æ®æµå›¾äºŒ"></a>æ•°æ®æµå›¾äºŒ</h3><p><img src="/Users/dongwei/Documents/hexo/source/_posts/img/pHTYrKJxQHPyJGAYOzMu.png"></p><h3 id="Model-å¯¹è±¡çš„å±æ€§"><a href="#Model-å¯¹è±¡çš„å±æ€§" class="headerlink" title="Model å¯¹è±¡çš„å±æ€§"></a>Model å¯¹è±¡çš„å±æ€§</h3><blockquote><p>æ¯ä¸ªmodelï¼Œå®é™…ä¸Šéƒ½æ˜¯æ™®é€šçš„JavaScriptå¯¹è±¡</p></blockquote><ul><li><p>namespace: å½“å‰ Model çš„åç§°ã€‚æ•´ä¸ªåº”ç”¨çš„ Stateï¼Œç”±å¤šä¸ªå°çš„ Model çš„ State ä»¥ namespace ä¸º key åˆæˆ</p></li><li><p>state: è¯¥ Model å½“å‰çš„çŠ¶æ€ã€‚æ•°æ®ä¿å­˜åœ¨è¿™é‡Œï¼Œç›´æ¥å†³å®šäº†è§†å›¾å±‚çš„è¾“å‡º</p></li><li><p>reducers: Action å¤„ç†å™¨ï¼Œå¤„ç†åŒæ­¥åŠ¨ä½œï¼Œç”¨æ¥ç®—å‡ºæœ€æ–°çš„ State</p></li><li><p>effectsï¼šAction å¤„ç†å™¨ï¼Œå¤„ç†å¼‚æ­¥åŠ¨ã€‚dva æä¾›å¤šä¸ª effect å‡½æ•°å†…éƒ¨çš„å¤„ç†å‡½æ•°ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ <code>call</code> å’Œ <code>put</code>ã€‚</p><ul><li>callï¼šæ‰§è¡Œå¼‚æ­¥å‡½æ•°</li><li>putï¼šå‘å‡ºä¸€ä¸ª Actionï¼Œç±»ä¼¼äº dispatch</li></ul></li><li><p>subscriptions</p></li></ul><h1 id="restful"><a href="#restful" class="headerlink" title="restful"></a>restful</h1><ul><li><strong>GET</strong>: A safe read-only method that reads a single or a list of resources.</li><li><strong>POST</strong>: Creates a new resource.</li><li><strong>PUT</strong>: Completely replaces the resource(s) at the given location with the new data.</li><li><strong>PATCH</strong>: Merges the resource(s) at the given location with the new data.</li><li><strong>DELETE</strong>: Deletes the resource(s) at a location.</li><li><strong>HEAD</strong>: Same as GET but only returns the header and no data.</li></ul><p><strong>ç”¨ URL è¡¨ç¤ºè¦æ“ä½œçš„èµ„æºï¼Œç”¨ä¸åŒçš„ HTTP è¯·æ±‚ï¼ˆGETï¼ŒPOSTï¼ŒPUTï¼ŒDELETEï¼‰æè¿°å¯¹èµ„æºçš„æ“ä½œï¼Œé€šè¿‡ HTTP çš„çŠ¶æ€ç æ¥åˆ¤æ–­æ­¤æ¬¡å¯¹èµ„æºæ“ä½œçš„ç»“æœ</strong>ï¼Œè¿™å°±æ˜¯ Restfulé£æ ¼ã€‚ </p><ol><li>GET ç”¨æ¥è·å–èµ„æº</li><li>POST ç”¨æ¥æ–°å¢èµ„æº</li><li>PUT ç”¨æ¥æ›´æ–°èµ„æº</li><li>DELETE ç”¨æ¥åˆ é™¤èµ„æº</li></ol><ul><li>putå’Œdeleteè™½ç„¶æ˜¯httpåè®®çš„è§„èŒƒ ,ä½†æ˜¯é—æ†¾çš„æ˜¯,æ‰€æœ‰çš„æ— è®ºæ˜¯html4è¿˜æ˜¯h5éƒ½ä¸æ”¯æŒ,æ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…å¼€å¼€å‘è¿‡ç¨‹å½“ä¸­è¦æ¨¡æ‹Ÿè¿™ä¸¤ç§çŠ¶æ€ã€‚ </li></ul><h2 id="Restfulæœ‰ä»€ä¹ˆæ„ä¹‰"><a href="#Restfulæœ‰ä»€ä¹ˆæ„ä¹‰" class="headerlink" title="Restfulæœ‰ä»€ä¹ˆæ„ä¹‰"></a>Restfulæœ‰ä»€ä¹ˆæ„ä¹‰</h2><ul><li>ç½‘ç»œä¸Šçš„æ‰€æœ‰çš„ä¿¡æ¯ä½“éƒ½çœ‹ä½œä¸€ç§èµ„æºï¼Œå¯¹ç½‘ç»œèµ„æºçš„æŸç§æ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡ method æ¥ç¡®å®šçš„ã€‚ </li><li>å¯¹äºç°åœ¨çš„æ•°æ®æˆ–è€…èµ„æºæä¾›æ–¹ï¼Œå¯¹å¤–é€éœ²çš„æ¥å£ä¸€èˆ¬æ˜¯ restful é£æ ¼çš„ï¼Œæœ‰åˆ©äºä¸åŒç³»ç»Ÿä¹‹é—´çš„èµ„æºå…±äº«,è€Œä¸”åªéœ€è¦éµå®ˆè§„èŒƒä¸éœ€è¦åšå¦å¤–çš„é…ç½®å°±èƒ½è¾¾åˆ°èµ„æºå…±äº«ã€‚ </li></ul><p><strong>restful æ˜¯ç”¨æ¥å¤–æä¾›æ¥å£çš„ï¼Œä¸»è¦ç”¨äºåœ¨ä¸åŒçš„ç³»ç»Ÿä¹‹é—´è¿›è¡Œæ•°æ®çš„äº¤äº’ã€‚</strong></p><p><strong>psï¼šå…¶å®åœ¨åšå†…éƒ¨ç³»ç»Ÿçš„æ—¶å€™å¹¶ä¸ä¼šä½¿ç”¨ restful é£æ ¼çš„ url è¯·æ±‚ï¼Œåªç”¨æ™®é€šçš„ @RequestMapping æ¥åŒ¹é…è¯·æ±‚å°±è¡Œäº†ã€‚</strong></p><h2 id="è¿”å›ç "><a href="#è¿”å›ç " class="headerlink" title="è¿”å›ç "></a>è¿”å›ç </h2><p>RESTful API ä¸­çš„æ ‡å‡†è¿”å›ç é€šå¸¸éµå¾ª HTTP çŠ¶æ€ç ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ“ä½œå’Œç»“æœè¿”å›ä¸åŒçš„çŠ¶æ€ç ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ HTTP çŠ¶æ€ç åŠå…¶é€šå¸¸çš„å«ä¹‰ï¼š</p><ul><li><strong>200 OK</strong>: è¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚é€šå¸¸ç”¨äº GET è¯·æ±‚ã€‚</li><li><strong>201 Created</strong>: è¡¨ç¤ºæˆåŠŸåˆ›å»ºäº†æ–°çš„èµ„æºã€‚é€šå¸¸ç”¨äº POST è¯·æ±‚ã€‚</li><li><strong>204 No Content</strong>: è¡¨ç¤ºè¯·æ±‚æˆåŠŸå¤„ç†ï¼Œä½†æ²¡æœ‰è¿”å›å†…å®¹ã€‚é€šå¸¸ç”¨äº DELETE è¯·æ±‚ã€‚</li><li><strong>400 Bad Request</strong>: è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£ã€‚</li><li><strong>401 Unauthorized</strong>: è¡¨ç¤ºè¯·æ±‚éœ€è¦ç”¨æˆ·è®¤è¯ï¼Œç”¨æˆ·æ²¡æœ‰æä¾›æœ‰æ•ˆçš„è®¤è¯ä¿¡æ¯ã€‚</li><li><strong>403 Forbidden</strong>: è¡¨ç¤ºæœåŠ¡å™¨ç†è§£è¯·æ±‚ï¼Œä½†æ‹’ç»æ‰§è¡Œï¼Œé€šå¸¸å› ä¸ºæƒé™é—®é¢˜ã€‚</li><li><strong>404 Not Found</strong>: è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ã€‚</li><li><strong>405 Method Not Allowed</strong>: è¡¨ç¤ºè¯·æ±‚æ–¹æ³•ä¸è¢«å…è®¸ã€‚</li><li><strong>409 Conflict</strong>: è¡¨ç¤ºè¯·æ±‚å¯èƒ½å¼•å‘å†²çªï¼Œä¾‹å¦‚æ›´æ–°èµ„æºæ—¶çš„ç‰ˆæœ¬å†²çªã€‚</li><li><strong>500 Internal Server Error</strong>: è¡¨ç¤ºæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚</li><li>502 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502">Bad Gateway</a> - This indicates an invalid response from an upstream server.</li><li>503 Service Unavailable - This indicates that something unexpected happened on server side (It can be anything like server overload, some parts of the system failed, etc.).</li></ul><p>RESTful API çš„è¿”å›ç å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé€‚å½“æ‰©å±•å’Œè°ƒæ•´ï¼Œä½†é€šå¸¸éµå¾ªä»¥ä¸ŠåŸºæœ¬çš„ HTTP çŠ¶æ€ç æ ‡å‡†ã€‚</p><h2 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h2><ul><li>urlä¸­åŒ…å«ä¼ å‚æ—¶ï¼Œä¾‹å¦‚delete  /auth/user/{å‚æ•°}ï¼Œé‚£æ­¤æ—¶å…¶ä»–deleteæ–¹æ³• /auth/user/otherï¼Œä¼šå‘ç”Ÿå†²çªï¼Œéœ€è¦åœ¨è·¯å¾„ä¾¯åé¢æ·»åŠ â€œ/â€ï¼Œå˜æˆ/auth/user/other/</li></ul><hr><ul><li>reference <a href="https://stackoverflow.blog/2020/03/02/best-practices-for-rest-api-design/">Best practices for REST API design</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> frontend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java thread</title>
      <link href="/2018/06/01/java%20thread/"/>
      <url>/2018/06/01/java%20thread/</url>
      
        <content type="html"><![CDATA[<p>çº¿ç¨‹å®‰å…¨æ˜¯ç¼–ç¨‹ä¸­çš„æœ¯è¯­ï¼ŒæŒ‡æŸä¸ªå‡½æ•°ã€å‡½æ•°åº“åœ¨å¹¶å‘ç¯å¢ƒä¸­è¢«è°ƒç”¨æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡ï¼Œä½¿ç¨‹åºåŠŸèƒ½æ­£ç¡®å®Œæˆã€‚å³åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œä¸å‘ç”Ÿæœ‰åºæ€§ã€åŸå­æ€§ä»¥åŠå¯è§æ€§é—®é¢˜ã€‚</p><h3 id="how-to-avoid-deadlock"><a href="#how-to-avoid-deadlock" class="headerlink" title="how to avoid deadlock"></a>how to avoid deadlock</h3><p><img src="https://2.bp.blogspot.com/-63RZ-BTlAFs/VfGeHMnGdFI/AAAAAAAADuw/gwqtrVliMsM/s400/Deadlock%2Bof%2BThreads.jpg"></p><h3 id="ConcurrentHashMap-faster-than-Hashtable"><a href="#ConcurrentHashMap-faster-than-Hashtable" class="headerlink" title="ConcurrentHashMap faster than Hashtable"></a>ConcurrentHashMap faster than Hashtable</h3><blockquote><p> ConcurrentHashMap is introduced as an alternative of Hashtable in Java 5, it is faster because of its design. ConcurrentHashMap divides the whole map into different segments and only lock a particular segment during the update operation, instead of <a href="http://javarevisited.blogspot.com/2012/01/java-hashtable-example-tutorial-code.html">Hashtable</a>, which locks whole Map.</p></blockquote><p><img src="https://1.bp.blogspot.com/-s28yqJthVWo/V10_G31sSCI/AAAAAAAAGNY/8oJE5cDD5BUa5VBiCI8Bx-UdpD8_MoeSwCLcB/s400/Internal%2Bimplementation%2Bof%2BConcurrentHashMap%2Bin%2BJava.png"></p><h3 id="submit-and-execute-method-of-Executor-and-ExecutorService"><a href="#submit-and-execute-method-of-Executor-and-ExecutorService" class="headerlink" title="submit() and execute() method of Executor and ExecutorService"></a>submit() and execute() method of Executor and ExecutorService</h3><blockquote><p> The main difference between submit and execute method from ExecutorService interface is that former return a result in the form of a Future object, while later doesnâ€™t return a result. By the way, both are used to submit a task to thread pool in Java but one is defined in Executor interface,while other is added into ExecutorService interface.</p></blockquote><p><img src="https://2.bp.blogspot.com/-ybewy1bWbFs/VxZFewRdKbI/AAAAAAAAFt4/fuAHJBE1r_8nlfUz34YTKI1j70UdqaMiQCLcB/s640/Difference%2Bbetween%2Bsubmit%2Bvs%2Bexecute%2Bmethod%2Bin%2BJava.png"></p><h4 id="when-to-use"><a href="#when-to-use" class="headerlink" title="when to use"></a>when to use</h4><blockquote><ul><li>In general, if you are doing computational task e.g. calculating some risk stats, <a href="http://java67.blogspot.com/2015/09/how-to-use-biginteger-class-in-java.html">calculating factorial of large numbers</a> or doing some time-consuming computation e which results in some value then use the submit() method. It immediately returns a Future object, which can be later queried to get the value of computation by calling get() method.</li></ul></blockquote><blockquote><ul><li>Remember, get() is a <a href="http://javarevisited.blogspot.com/2012/02/what-is-blocking-methods-in-java-and.html">blocking call</a> so always call the version which accepts a timeout. While you can use the execute() method if you just want your code to be run in parallel by worker threads of the thread pool.</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Future future = executorService.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Asynchronous task&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">future.get();  <span class="comment">//returns null if the task has finished correctly.</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Future future = executorService.submit(<span class="keyword">new</span> Callable()&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Asynchronous Callable&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Callable Result&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;future.get() = &quot;</span> + future.get());</span><br></pre></td></tr></table></figure><h3 id="ReentrantLock-vs-synchronized"><a href="#ReentrantLock-vs-synchronized" class="headerlink" title="ReentrantLock vs synchronized"></a>ReentrantLock vs synchronized</h3><h4 id="the-advantages-of-ReentrantLock"><a href="#the-advantages-of-ReentrantLock" class="headerlink" title="the advantages of ReentrantLock"></a>the advantages of ReentrantLock</h4><ol><li><p>Ability to lock interruptibly.</p></li><li><p>Ability to timeout while waiting for lock.</p></li><li><p>Power to create fair lock.</p></li><li><p>API to get list of waiting thread for lock.</p></li><li><p>Flexibility to try for lock without blocking.</p></li></ol><h4 id="the-disadvantages-of-ReentrantLock"><a href="#the-disadvantages-of-ReentrantLock" class="headerlink" title="the disadvantages of ReentrantLock"></a>the disadvantages of ReentrantLock</h4><ol><li><p>  Major drawback of using ReentrantLock in Java is wrapping method body inside <a href="http://javarevisited.blogspot.com/2012/11/difference-between-final-finally-and-finalize-java.html">try-finally block</a>, which makes code unreadable and hides business logic. </p></li><li><p>programmer is responsible for acquiring and releasing lock, which is a power but also opens gate for new subtle bugs, when programmer forget to release the lock in finally block.</p></li></ol><h3 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h3><p><img src="https://4.bp.blogspot.com/-yYqp8m0BGdk/V11A-s0qwVI/AAAAAAAAGNw/LL_qGX5_qD4dHTFMe3kklI4jYWyDHzIyQCLcB/s400/ReadWriteLock%2Bin%2BJava.jpg"></p><h3 id="stop-thread"><a href="#stop-thread" class="headerlink" title="stop thread"></a>stop thread</h3><blockquote><ul><li>There was some control methods in JDK 1.0 e.g. stop(), suspend() and resume() which was deprecated in later releases due to potential deadlock threats, from then Java API designers has not made any effort to provide a consistent, thread-safe and elegant way to stop threads.</li></ul></blockquote><blockquote><ul><li>Programmers mainly rely on the fact that thread stops automatically as soon as they finish execution of run() or call() method. To manually stop, programmers either take advantage of volatile boolean variable and check in every iteration if run method has loops or interrupt threads to abruptly cancel tasks.</li></ul></blockquote><h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><blockquote><ul><li>The <code>ThreadLocal</code> class in Java enables you to create variables that can only be read and written by the same thread. Thus, even if two threads are executing the same code, and the code has a reference to a<code>ThreadLocal</code> variable, then the two threads cannot see each otherâ€™s <code>ThreadLocal</code> variables.</li><li>Each thread holds an exclusive copy of ThreadLocal variable which becomes eligible to Garbage collection after thread finished or died, normally or due to any Exception, Given those ThreadLocal variable doesnâ€™t have any other live references.</li><li>ThreadLocal variables in Java are generally private static fields in Classes and maintain its state inside Thread.</li></ul></blockquote><h3 id="synchronized-vs-concurrent-collection"><a href="#synchronized-vs-concurrent-collection" class="headerlink" title="synchronized vs concurrent collection"></a>synchronized vs concurrent collection</h3><blockquote><p>later is more scalable than former</p><p> synchronized collections locks the whole collection e.g. whole Map or List while concurrent collection never locks the whole Map or List. They achieve thread safety by using advanced and sophisticated techniques like lock stripping. For example, the ConcurrentHashMap divides the whole map into several segments and locks only the relevant segments, which allows multiple threads to access other segments of same ConcurrentHashMap without locking.</p></blockquote><h4 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h4><blockquote><p> CopyOnWriteArrayList allows multiple reader threads to read without synchronization and when a write happens it copies the whole ArrayList and swap with a newer one.</p></blockquote><h3 id="Stack-and-Heap"><a href="#Stack-and-Heap" class="headerlink" title="Stack and Heap"></a>Stack and Heap</h3><blockquote><ul><li>Each thread has their own stack, which is used to store local variables, method parameters and call stack. Variable stored in one Threadâ€™s stack is not visible to other.</li><li>heap is a common memory area which is shared by all threads.Objects whether local or at any level is created inside heap.</li></ul></blockquote><ul><li>To improve performance thread tends to cache values from heap into their stack, which can create problems if that variable is modified by more than one thread, this is where volatile variables comes in picture. volatile suggest threads to read value of variable always from main memory. </li><li>If there is no memory left in the stack for storing function call or local variable, JVM will throw java.lang.StackOverFlowError, while if there is no more heap space for creating an object, JVM will throw java.lang.OutOfMemoryError: Java Heap Space</li><li>Variables stored in stacks are only visible to the owner Thread while objects created in the heap are visible to all thread. In other words, stack memory is kind of private memory of Java Threads while heap memory is shared among all threads.</li></ul><h3 id="thread-pool"><a href="#thread-pool" class="headerlink" title="thread pool"></a>thread pool</h3><blockquote><p>Java API provides Executor framework, which allows you to create different types of thread pools e.g. single thread pool, which process one task at a time, fixed thread pool (a pool of fixed number of thread) or cached thread pool (an expandable thread pool suitable for applications with many short lived tasks).</p></blockquote><h4 id="the-benefits"><a href="#the-benefits" class="headerlink" title="the benefits"></a>the benefits</h4><ul><li><p>Use of Thread Pool reduces response time by avoiding thread creation during request or task processing.</p></li><li><p>Use of Thread Pool allows you to change your execution policy as you need. you can go from single thread to multiple threads by just replacing ExecutorService implementation.</p></li><li><p>Thread Pool in Java application increases the stability of the system by creating a configured number of threads decided based on system load and available resource.</p></li><li><p>Thread Pool frees application developer from thread management stuff and allows to focus on business logic.</p></li></ul><h3 id="volatile-vs-atomic-variable"><a href="#volatile-vs-atomic-variable" class="headerlink" title="volatile vs atomic variable"></a>volatile vs atomic variable</h3><blockquote><p>Volatile variable provides you happens-before guarantee that a write will happen before any subsequent write, it doesnâ€™t guarantee atomicity. For example count++ operation will not become atomic just by declaring count variable as volatile. On the other hand AtomicInteger class provides atomic method to perform such compound operation atomically.</p></blockquote><h3 id="3-multi-threading-best-practice"><a href="#3-multi-threading-best-practice" class="headerlink" title="3 multi-threading best practice"></a>3 multi-threading best practice</h3><ul><li><p>Always give meaningful name to your thread</p></li><li><p>Avoid locking or Reduce scope of Synchronization</p></li><li><p>Prefer Synchronizers over wait and notify</p></li><li><p>Prefer Concurrent Collection over Synchronized Collection</p></li></ul><h3 id="Waitã€Sleepã€Yield"><a href="#Waitã€Sleepã€Yield" class="headerlink" title="Waitã€Sleepã€Yield"></a>Waitã€Sleepã€Yield</h3><ul><li><p>sleep() and yield() methods are defined in thread class while wait() is defined in the Object class</p></li><li><p>The key difference between wait() and sleep() is that former is used for inter-thread communication while later is used to introduced to pause the current thread for a short duration. </p></li><li><p>This difference is more obvious from the fact that, when a thread calls the wait() method, it releases the monitor or lock it was holding on that object, but when a thread calls the sleep() method, it never releases the monitor even if it is holding. </p></li><li><p>yield() just releases the CPU hold by Thread to give another thread an opportunity to run though itâ€™s not guaranteed who will get the CPU. It totally depends upon thread scheduler and <strong>itâ€™s even possible that the thread which calls the yield() method gets the CPU again</strong>(æœ‰å¯èƒ½è‡ªå·±ä¼šå†æ¬¡è·å–åˆ°cpuæ‰§è¡Œæ—¶é—´). Hence, itâ€™s not reliable to depend upon yield() method, itâ€™s just on best effort basis.</p><ul><li>If there is no waiting thread or all the waiting threads have a lower priority then the same thread will continue its execution.</li></ul></li></ul><h3 id="Future-and-FutureTask"><a href="#Future-and-FutureTask" class="headerlink" title="Future and FutureTask"></a>Future and FutureTask</h3><blockquote><ul><li>A <strong>Future</strong> interface provides methods <strong>to check if the computation is complete, to wait for its completion and to retrieve the results of the computation</strong>. The result is retrieved using Futureâ€™s get() method when the computation has completed, and it blocks until it is completed.</li><li><strong>FutureTask</strong><pre><code>1. FutureTask implementation Future interface and RunnableFuture Interface, means one can use FutureTask as Runnable and can be submitted to ExecutorService for execution.2. When one call Future.submit() Callable or Runnable objects then most of time ExecutorService creates FutureTask, and one can create it manually also.3. FutureTask acts like a latch.4. Computation represent by FutureTask is implemented with Callable interface.5. It implements Future or Callable interface.6. Behaviour of get() method depends on the state of the task. If tasks are not completed get() method waits or blocks till the task is completed. Once task completed, it returns the result or throws an ExecutionException.</code></pre></li></ul></blockquote><p><img src="https://cdncontribute.geeksforgeeks.org/wp-content/uploads/pool2.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java program do two FutureTask </span></span><br><span class="line"><span class="comment">// using Runnable Interface </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*; </span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level; </span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> waitTime; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MyRunnable</span><span class="params">(<span class="keyword">int</span> timeInMillis)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="keyword">this</span>.waitTime = timeInMillis; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="keyword">try</span> &#123; </span><br><span class="line"><span class="comment">// sleep for user given millisecond </span></span><br><span class="line"><span class="comment">// before checking again </span></span><br><span class="line">Thread.sleep(waitTime); </span><br><span class="line"></span><br><span class="line"><span class="comment">// return current thread name </span></span><br><span class="line">System.out.println(Thread </span><br><span class="line">.currentThread() </span><br><span class="line">.getName()); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">catch</span> (InterruptedException ex) &#123; </span><br><span class="line">Logger </span><br><span class="line">.getLogger(MyRunnable.class.getName()) </span><br><span class="line">.log(Level.SEVERE, <span class="keyword">null</span>, ex); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// Class FutureTaskExample excute two future task </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FutureTaskExample</span> </span>&#123; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="comment">// create two object of MyRunnable class </span></span><br><span class="line"><span class="comment">// for FutureTask and sleep 1000, 2000 </span></span><br><span class="line"><span class="comment">// millisecond before checking again </span></span><br><span class="line">MyRunnable myrunnableobject1 = <span class="keyword">new</span> MyRunnable(<span class="number">1000</span>); </span><br><span class="line">MyRunnable myrunnableobject2 = <span class="keyword">new</span> MyRunnable(<span class="number">2000</span>); </span><br><span class="line"></span><br><span class="line">FutureTask&lt;String&gt; </span><br><span class="line">futureTask1 = <span class="keyword">new</span> FutureTask&lt;&gt;(myrunnableobject1, </span><br><span class="line"><span class="string">&quot;FutureTask1 is complete&quot;</span>); </span><br><span class="line">FutureTask&lt;String&gt; </span><br><span class="line">futureTask2 = <span class="keyword">new</span> FutureTask&lt;&gt;(myrunnableobject2, </span><br><span class="line"><span class="string">&quot;FutureTask2 is complete&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// create thread pool of 2 size for ExecutorService </span></span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// submit futureTask1 to ExecutorService </span></span><br><span class="line">executor.submit(futureTask1); </span><br><span class="line"></span><br><span class="line"><span class="comment">// submit futureTask2 to ExecutorService </span></span><br><span class="line">executor.submit(futureTask2); </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123; </span><br><span class="line"><span class="keyword">try</span> &#123; </span><br><span class="line"></span><br><span class="line"><span class="comment">// if both future task complete </span></span><br><span class="line"><span class="keyword">if</span> (futureTask1.isDone() &amp;&amp; futureTask2.isDone()) &#123; </span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;Both FutureTask Complete&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// shut down executor service </span></span><br><span class="line">executor.shutdown(); </span><br><span class="line"><span class="keyword">return</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!futureTask1.isDone()) &#123; </span><br><span class="line"></span><br><span class="line"><span class="comment">// wait indefinitely for future </span></span><br><span class="line"><span class="comment">// task to complete </span></span><br><span class="line">System.out.println(<span class="string">&quot;FutureTask1 output = &quot;</span></span><br><span class="line">+ futureTask1.get()); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;Waiting for FutureTask2 to complete&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// Wait if necessary for the computation to complete, </span></span><br><span class="line"><span class="comment">// and then retrieves its result </span></span><br><span class="line">String s = futureTask2.get(<span class="number">250</span>, TimeUnit.MILLISECONDS); </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (s != <span class="keyword">null</span>) &#123; </span><br><span class="line">System.out.println(<span class="string">&quot;FutureTask2 output=&quot;</span> + s); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">catch</span> (Exception e) &#123; </span><br><span class="line">Sysmtem.out.println(<span class="string">&quot;Exception: &quot;</span> + e); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Output:</span><br><span class="line"></span><br><span class="line">FutureTask1 output=FutureTask1 is complete</span><br><span class="line">Waiting for FutureTask2 to complete</span><br><span class="line">Waiting for FutureTask2 to complete</span><br><span class="line">Waiting for FutureTask2 to complete</span><br><span class="line">Waiting for FutureTask2 to complete</span><br><span class="line">FutureTask2 output=FutureTask2 is complete</span><br><span class="line">Both FutureTask Complete</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows</title>
      <link href="/2018/05/22/windows%20snippet/"/>
      <url>/2018/05/22/windows%20snippet/</url>
      
        <content type="html"><![CDATA[<h2 id="è¿›ç¨‹æ“ä½œ"><a href="#è¿›ç¨‹æ“ä½œ" class="headerlink" title="è¿›ç¨‹æ“ä½œ"></a>è¿›ç¨‹æ“ä½œ</h2><ul><li>netstat -aon|findstr â€œ8080â€ </li></ul><p>TCP     127.0.0.1:80       0.0.0.0:0             LISTENING    2448<br>ç«¯å£è¢«è¿›ç¨‹å·ä¸º2448çš„è¿›ç¨‹å ç”¨ï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><ul><li>tasklist|findstr â€œ2448â€ </li></ul><p>thread.exe                   2016 Console                 0     16,064 K</p><p>å¾ˆæ¸…æ¥šï¼Œthreadå ç”¨äº†ä½ çš„ç«¯å£,Kill it</p><ul><li>taskkill -F -PID 2448</li></ul><p>å¦‚æœç¬¬äºŒæ­¥æŸ¥ä¸åˆ°ï¼Œé‚£å°±å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼Œè¿›ç¨‹â€”æŸ¥çœ‹â€”é€‰æ‹©åˆ—â€”pidï¼ˆè¿›ç¨‹ä½æ ‡è¯†ç¬¦ï¼‰æ‰“ä¸ªå‹¾å°±å¯ä»¥äº†</p><h2 id="æŸ¥çœ‹æ–‡ä»¶md5å€¼"><a href="#æŸ¥çœ‹æ–‡ä»¶md5å€¼" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶md5å€¼"></a>æŸ¥çœ‹æ–‡ä»¶md5å€¼</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">certutil -hashfile filename MD5</span><br><span class="line">certutil -hashfile filename SHA1</span><br><span class="line">certutil -hashfile filename SHA256</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>socket snippet</title>
      <link href="/2018/05/09/TCP%20and%20UDP/"/>
      <url>/2018/05/09/TCP%20and%20UDP/</url>
      
        <content type="html"><![CDATA[<h2 id="TCP-and-UDP"><a href="#TCP-and-UDP" class="headerlink" title="TCP and UDP"></a>TCP and UDP</h2><blockquote><ul><li>TCP stands for Transmission Control Protocol and UDP stands for User Datagram Protocol, and both are used extensively to build Internet applications.</li><li>The protocol which is the core of internet, HTTP is based on TCP.</li></ul></blockquote><h3 id="why"><a href="#why" class="headerlink" title="why"></a>why</h3><blockquote><p> why Java developer should understand these two protocols in detail is that Java is extensively used to write multi-threaded, concurrent and scalable servers.</p></blockquote><h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><blockquote><p> While UDP is more suitable for applications that need fast, efficient transmission, such as games. UDPâ€™s stateless nature is also useful for servers that answer small queries from huge numbers of clients. In practice, TCP is used in finance domain e.g. <a href="http://javarevisited.blogspot.sg/2011/04/fix-protocol-tutorial-for-beginners.html">FIX protocol</a> is a TCP based protocol, UDP is used heavily in gaming and entertainment sites.</p></blockquote><h3 id="how"><a href="#how" class="headerlink" title="how"></a>how</h3><ul><li><p>  TCP is connection oriented, reliable, slow, provides guaranteed delivery and preserves the order of messages</p></li><li><p>  UDP is connectionless, unreliable, no ordering guarantee, but a fast protocol. </p></li><li><p>  TCP overhead is also much higher than UDP, as it transmits more metadata per packet than UDP.  that header size of Transmission control protocol is 20 bytes, compared to 8 bytes header of User Datagram protocol.</p></li><li><p>  Use TCP, if you canâ€™t afford to lose any message, while UDP is better for high-speed data transmission, where loss of a single packet is acceptable e.g. video streaming or online multiplayer games.</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Socket </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hibernate snippet</title>
      <link href="/2018/05/01/hibernate%20snippet/"/>
      <url>/2018/05/01/hibernate%20snippet/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ORM is an acronym for Object/Relational mapping. It is a programming strategy to map object with the data stored in the database. It simplifies data creation, data manipulation, and data access.</p></blockquote><h3 id="The-advantages-of-using-ORM-over-JDBC"><a href="#The-advantages-of-using-ORM-over-JDBC" class="headerlink" title="The advantages of using ORM over JDBC"></a>The advantages of using ORM over JDBC</h3><ul><li>Application development is fast.</li><li>Management of transaction.</li><li>Generates key automatically.</li><li>Details of SQL queries are hidden.</li></ul><h3 id="Hibernate-Architecture"><a href="#Hibernate-Architecture" class="headerlink" title="Hibernate Architecture"></a>Hibernate Architecture</h3><ul><li>Java application layer</li><li>Hibernate framework layer</li><li>Backhand api layer</li><li>Database layer</li></ul><p><img src="https://www.javatpoint.com/images/hibernate/arc2.jpg"></p><p>Hibernate Application Architectureï¼š</p><p><img src="https://www.tutorialspoint.com/hibernate/images/hibernate_architecture.jpg"></p><blockquote><p>JDBC (Java Database Connectivity)</p><p>JTA (Java Transaction API) </p><p>JNDI (Java Naming Directory Interface)</p></blockquote><h3 id="Elements-of-Hibernate-Architecture"><a href="#Elements-of-Hibernate-Architecture" class="headerlink" title="Elements of Hibernate Architecture"></a>Elements of Hibernate Architecture</h3><ul><li><p>Configuration</p><ul><li><strong>Database Connection</strong> âˆ’ This is handled through one or more configuration files supported by Hibernate. These files are <strong>hibernate.properties</strong> and <strong>hibernate.cfg.xml</strong>.</li><li><strong>Class Mapping Setup</strong> âˆ’ This component creates the connection between the Java classes and database tables.</li></ul></li><li><p>SessionFactory</p><blockquote><p>SessionFactory is a thread-safe object, many threads cannot access it simultaneously.</p></blockquote></li><li><p>Session</p><blockquote><ul><li>It maintains a connection between the hibernate application and database.It provides methods to store, update, delete or fetch data from the database such as persist(), update(), delete(), load(), get() etc.</li><li>Session is not a thread-safe object, many threads can access it simultaneously. In other words, you can share it between threads.</li></ul></blockquote></li><li><p>Transaction</p></li><li><p>ConnectionProvider</p></li><li><p>Query</p><blockquote><p>Query objects use SQL or Hibernate Query Language (HQL) string to retrieve data from the database and create objects. A Query instance is used to bind query parameters, limit the number of results returned by the query, and finally to execute the query.</p></blockquote></li><li><p>Criteria</p><blockquote><p>Criteria objects are used to create and execute object oriented criteria queries to retrieve objects.</p></blockquote></li></ul><h3 id="About-SQL"><a href="#About-SQL" class="headerlink" title="About SQL"></a>About SQL</h3><ul><li><p>SQL query created in Hibernateï¼ˆNative sqlï¼‰</p><blockquote><p>Session.createSQLQuery</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Session.createSQLQuery()</span><br><span class="line"><span class="comment">//The method createSQLQuery() creates Query object using the native SQL syntax. </span></span><br><span class="line">Query query = session.createSQLQuery(<span class="string">&quot;Select * from Student&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>HQL query</p><blockquote><p>Session.createQuery</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Session.createQuery()</span><br><span class="line"><span class="comment">//The method createQuery() creates Query object using the HQL syntax. </span></span><br><span class="line">Query query = session.createQuery(<span class="string">&quot;from Student s where s.name like &#x27;k%&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>criteria query</p><blockquote><p>Session.createCriteria</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Session.createCriteria()</span><br><span class="line"><span class="comment">//The method createCriteria() creates Criteria object for setting the query parameters. This is more useful feature for those who don&#x27;t want to write the query in hand. You can specify any type of complicated syntax using the Criteria API.</span></span><br><span class="line">Criteria criteria = session.createCriteria(Student.class);</span><br></pre></td></tr></table></figure></li></ul><h3 id="HQL-vs-Criteria"><a href="#HQL-vs-Criteria" class="headerlink" title="HQL vs Criteria"></a>HQL vs Criteria</h3><ul><li>HQL is to perform both select and non-select operations on the data,  but Criteria is only for selecting the data, we cannot perform non-select operations using criteria</li><li>HQL is suitable for executing Static Queries, where as Criteria is suitable for executing Dynamic Queries</li><li>HQL doesnâ€™t support pagination concept, but we can achieve pagination with Criteria</li><li>Criteria used to take more time to execute then HQL</li><li>With Criteria we are safe with SQL Injection because of its dynamic query generation but in HQL as your queries are either fixed or parametrized, there is no safe from SQL Injection.</li></ul><h3 id="Caching"><a href="#Caching" class="headerlink" title="Caching"></a>Caching</h3><blockquote><p>Cache memory stores recently used data items in order to reduce the number of database hits as much as possible.</p></blockquote><p><img src="https://www.tutorialspoint.com/hibernate/images/hibernate_cache.jpg"></p><ul><li><p>First level Cache</p><blockquote><p>Hibernate first level cache is associated with the Session object. Hibernate first level cache is enabled by default and there is no way to disable it. However hibernate provides methods through which we can delete selected objects from the cache or clear the cache completely.Any object cached in a session will not be visible to other sessions and when the session is closed, all the cached objects will also be lost.</p></blockquote></li><li><p>Second level Cache</p><blockquote><p>Hibernate Second Level cache is disabled by default but we can enable it through configuration. Currently EHCache and Infinispan provides implementation for Hibernate Second level cache and we can use them. </p></blockquote></li><li><p>Query Cache</p><blockquote><p>Hibernate can also cache result set of a query. Hibernate Query Cache doesnâ€™t cache the state of the actual entities in the cache; it caches only identifier values and results of value type. So it should always be used in conjunction with the second-level cache.</p></blockquote></li></ul><hr><h3 id="types-of-association-mapping"><a href="#types-of-association-mapping" class="headerlink" title="types of association mapping"></a>types of association mapping</h3><ol><li><p>One to One</p></li><li><p>One to Many</p><blockquote><p>ï¼ˆä¸€å¯¹å¤šï¼‰å•å‘ï¼šä¼šäº§ç”Ÿä¸­é—´è¡¨ï¼Œæ­¤æ—¶å¯ä»¥ç”¨@onetoMany @Joincolumnï¼ˆname=â€ â€œï¼‰é¿å…äº§ç”Ÿä¸­é—´è¡¨**ï¼Œå¹¶ä¸”æŒ‡å®šäº†å¤–é”®çš„åå­—ï¼ˆåˆ«çœ‹ @joincolumnåœ¨ä¸€ä¸­å†™ç€ï¼Œä½†å®ƒå­˜åœ¨åœ¨å¤šçš„é‚£ä¸ªè¡¨ä¸­ï¼‰</p></blockquote></li><li><p>Many to One</p><blockquote><p>ï¼ˆå¤šå¯¹ä¸€ï¼‰å•å‘ï¼šä¸äº§ç”Ÿä¸­é—´è¡¨ï¼Œä½†å¯ä»¥ç”¨@Joincolumnï¼ˆname=â€  â€œï¼‰æ¥æŒ‡å®šç”Ÿæˆå¤–é”®çš„åå­—ï¼Œå¤–é”®åœ¨å¤šçš„ä¸€æ–¹è¡¨ä¸­äº§ç”Ÿï¼</p></blockquote></li><li><p>Many to Many</p></li></ol><hr><p>å¯å‚è€ƒ<a href="https://www.jianshu.com/p/54108abb070f">JPAå®ä½“å…³ç³»æ˜ å°„</a></p><h4 id="ä¸ºä»€ä¹ˆè¦æœ‰å®ä½“å…³ç³»æ˜ å°„"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰å®ä½“å…³ç³»æ˜ å°„" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰å®ä½“å…³ç³»æ˜ å°„"></a>ä¸ºä»€ä¹ˆè¦æœ‰å®ä½“å…³ç³»æ˜ å°„</h4><blockquote><p>ç®€åŒ–ç¼–ç¨‹æ“ä½œã€‚æŠŠå†—ä½™çš„æ“ä½œäº¤ç»™åº•å±‚æ¡†æ¶æ¥å¤„ç†ã€‚<br> ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘è¦ç»™ä¸€ä½æ–°å…¥å­¦çš„å­¦ç”Ÿæ·»åŠ ä¸€ä½æ–°çš„è€å¸ˆã€‚è€Œè¿™ä¸ªè€å¸ˆåˆæ˜¯æ–°æ¥çš„ï¼Œåœ¨å­¦ç”Ÿæ•°æ®åº“ä¸æ•™å¸ˆæ•°æ®åº“ä¸­å‡ä¸å­˜åœ¨å¯¹åº”çš„æ•°æ®ã€‚é‚£ä¹ˆæˆ‘éœ€è¦å…ˆåœ¨æ•™å¸ˆæ•°æ®åº“ä¸­ä¿å­˜æ–°æ¥çš„è€å¸ˆçš„æ•°æ®ï¼ŒåŒæ—¶åœ¨å­¦ç”Ÿæ•°æ®åº“ä¸­ä¿å­˜æ–°å­¦ç”Ÿçš„æ•°æ®ï¼Œç„¶åå†ç»™ä¸¤è€…å»ºç«‹å…³è”ã€‚<br> è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†å®ä½“å…³ç³»æ˜ å°„ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¯¥æ–°æ•™å¸ˆå®ä½“äº¤ç»™è¯¥å­¦ç”Ÿå®ä½“ï¼Œç„¶åä¿å­˜è¯¥å­¦ç”Ÿå®ä½“å³å¯å®Œæˆã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> hibernate </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>design pattern</title>
      <link href="/2018/05/01/design%20pattern/"/>
      <url>/2018/05/01/design%20pattern/</url>
      
        <content type="html"><![CDATA[<h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><ul><li>java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Computer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//required parameters</span></span><br><span class="line"><span class="keyword">private</span> String HDD;</span><br><span class="line"><span class="keyword">private</span> String RAM;</span><br><span class="line"></span><br><span class="line"><span class="comment">//optional parameters</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isGraphicsCardEnabled;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isBluetoothEnabled;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getHDD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> HDD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getRAM</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> RAM;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isGraphicsCardEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isGraphicsCardEnabled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBluetoothEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isBluetoothEnabled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Computer</span><span class="params">(ComputerBuilder builder)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.HDD=builder.HDD;</span><br><span class="line">    <span class="keyword">this</span>.RAM=builder.RAM;</span><br><span class="line">    <span class="keyword">this</span>.isGraphicsCardEnabled=builder.isGraphicsCardEnabled;</span><br><span class="line">    <span class="keyword">this</span>.isBluetoothEnabled=builder.isBluetoothEnabled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Builder Class</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ComputerBuilder</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// required parameters</span></span><br><span class="line">    <span class="keyword">private</span> String HDD;</span><br><span class="line">    <span class="keyword">private</span> String RAM;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// optional parameters</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isGraphicsCardEnabled;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isBluetoothEnabled;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ComputerBuilder</span><span class="params">(String hdd, String ram)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.HDD=hdd;</span><br><span class="line">        <span class="keyword">this</span>.RAM=ram;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ComputerBuilder <span class="title">setGraphicsCardEnabled</span><span class="params">(<span class="keyword">boolean</span> isGraphicsCardEnabled)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isGraphicsCardEnabled = isGraphicsCardEnabled;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ComputerBuilder <span class="title">setBluetoothEnabled</span><span class="params">(<span class="keyword">boolean</span> isBluetoothEnabled)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isBluetoothEnabled = isBluetoothEnabled;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Computer <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Computer(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ComputerBuilder</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.journaldev.design.builder.Computer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBuilderPattern</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//Using builder to get the object in a single line of code and </span></span><br><span class="line">            <span class="comment">//without any inconsistent state or arguments management issues        </span></span><br><span class="line">    Computer comp = <span class="keyword">new</span> Computer.ComputerBuilder(</span><br><span class="line">            <span class="string">&quot;500 GB&quot;</span>, <span class="string">&quot;2 GB&quot;</span>).setBluetoothEnabled(<span class="keyword">true</span>)</span><br><span class="line">            .setGraphicsCardEnabled(<span class="keyword">true</span>).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> design pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> code </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis snippet</title>
      <link href="/2018/02/16/redis%20snippet/"/>
      <url>/2018/02/16/redis%20snippet/</url>
      
        <content type="html"><![CDATA[<h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><ul><li><p>String</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; SET name &quot;runoob&quot;</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; GET name</span><br><span class="line">&quot;runoob&quot;</span><br></pre></td></tr></table></figure></li><li><p>Hash</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; HMSET myhash field1 &quot;Hello&quot; field2 &quot;World&quot;</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">redis&gt; HGET myhash field1</span><br><span class="line">&quot;Hello&quot;</span><br><span class="line">redis&gt; HGET myhash field2</span><br><span class="line">&quot;World&quot;</span><br></pre></td></tr></table></figure></li><li><p>List</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; lpush runoob redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; lpush runoob mongodb</span><br><span class="line">(integer) 2</span><br><span class="line">redis 127.0.0.1:6379&gt; lpush runoob rabitmq</span><br><span class="line">(integer) 3</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange runoob 0 10</span><br><span class="line">1) &quot;rabitmq&quot;</span><br><span class="line">2) &quot;mongodb&quot;</span><br><span class="line">3) &quot;redis&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure></li><li><p>Set</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; sadd runoob redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; sadd runoob mongodb</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; sadd runoob rabitmq</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; sadd runoob rabitmq</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; smembers runoob</span><br><span class="line"></span><br><span class="line">1) &quot;redis&quot;</span><br><span class="line">2) &quot;rabitmq&quot;</span><br><span class="line">3) &quot;mongodb&quot;</span><br></pre></td></tr></table></figure></li><li><p>zset(sorted setï¼šæœ‰åºé›†åˆ)</p><ul><li><p>Redis zset å’Œ set ä¸€æ ·ä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚</p><p>ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚zsetçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚</p></li><li><p>å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zadd key score member </span><br></pre></td></tr></table></figure></li><li><p>å®ä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 mongodb</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 rabitmq</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 rabitmq</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; &gt; ZRANGEBYSCORE runoob 0 1000</span><br><span class="line">1) &quot;mongodb&quot;</span><br><span class="line">2) &quot;rabitmq&quot;</span><br><span class="line">3) &quot;redis&quot;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h3><ul><li><p>show all keys</p><p><code>KEYS *</code></p></li><li><p>Delete All Keys In Redis</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  Delete all keys from all Redis databases:</span><br><span class="line">`$ redis-cli FLUSHALL`</span><br><span class="line">Delete all keys of the currently selected Redis database:</span><br><span class="line">`$ redis-cli FLUSHDB`</span><br><span class="line">Delete all keys of the specified Redis database:</span><br><span class="line">`$ redis-cli -n &lt;database_number&gt; FLUSHDB`</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æŒ‡å®šå‰ç¼€çš„æ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æŒ‡å®šCCR866å‰ç¼€çš„redisæ•°æ®</span></span><br><span class="line">path/to/redis-cli -p 16379 -a Redis6379  -n 1 keys &#x27;CCR866*&#x27; | xargs ./redis-cli -p 16379 -a Redis6379 -n 1 del</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å¯åŠ¨å‘½ä»¤ä¸­æ·»åŠ  â€“raw,å¯ä»¥æŸ¥çœ‹valueçš„ä¸­æ–‡ä¿¡æ¯</p></li></ul><h3 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h3><ul><li><p>RedisConnectionFailureException</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis.confä¸­é»˜è®¤çš„æ˜¯bind 127.0.0.1ï¼Œéœ€è¦å°†è¿™æ®µæ³¨é‡Š</span><br><span class="line">è®¾ç½®protected-mode noï¼Œå› ä¸ºå¦‚æœæ˜¯yesçš„è¯ï¼Œåªèƒ½è¿›è¡Œæœ¬åœ°è®¿é—®ã€‚å¦‚æœè®¾ç½®äº†å¯†ç å’Œbindè¿™ä¸ªå¯ä»¥å¼€å¯ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥è®¾ç½®ä¸ºnoå³å¯ã€‚</span><br><span class="line">daemonize  yesè¡¨ç¤ºåå°è¿è¡Œ</span><br></pre></td></tr></table></figure></li><li><p>éœ€è¦å®‰è£…gcc</p></li><li><p>makeæ—¶ï¼Œæç¤ºfatal error: jemalloc/jemalloc.h: No such file or directory</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è§£å†³ï¼š   </span><br><span class="line"><span class="built_in">cd</span> src/deps</span><br><span class="line">make hiredis jemalloc linenoise lua geohash-int</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰é…ç½®redis-server"><a href="#è‡ªå®šä¹‰é…ç½®redis-server" class="headerlink" title="è‡ªå®šä¹‰é…ç½®redis server"></a>è‡ªå®šä¹‰é…ç½®redis server</h3><p>æ¶‰åŠåˆ°çš„ç›®å½•æˆ–æ–‡ä»¶æœ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.é…ç½®æ–‡ä»¶    /etc/redis/xxxx.conf</span><br><span class="line">2.æ—¥å¿—ã€æ•°æ®æ–‡ä»¶    /data/redis/xxxx</span><br><span class="line">3.å¯åŠ¨è„šæœ¬    /etc/init.d/redis_xxxx</span><br></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯å¯åŠ¨æ—¶    redis-cli -p xxxx</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvm snippet</title>
      <link href="/2018/01/18/JVM%20snippet/"/>
      <url>/2018/01/18/JVM%20snippet/</url>
      
        <content type="html"><![CDATA[<h2 id="JRE-JVM-JDK"><a href="#JRE-JVM-JDK" class="headerlink" title="JRE JVM JDK"></a>JRE JVM JDK</h2><ul><li>JRE:    java run-time</li></ul><blockquote><p>Java is every where in browser, in mobile, in TV or in set-top boxes and if you are into Java programming language than you know that Java code which is bundled in JAR (Java archive) file require Java virtual machine JVM to execute it. </p></blockquote><ul><li>JVM:    java virtual machine</li></ul><blockquote><p> Java Virtual Machine is get created when you run a java program using java command e.g. java HelloWorld. JVM is responsible for converting byte code into machine specific code</p></blockquote><ul><li>JDK:    java development kit</li></ul><blockquote><p> JDK is also loosely referred as JRE but its lot more than JRE and it provides all the tools and executable require to compile debug and execute Java Program.</p></blockquote><h2 id="basic-architecture-of-the-JVM"><a href="#basic-architecture-of-the-JVM" class="headerlink" title="basic architecture of the JVM"></a>basic architecture of the JVM</h2><img src="https://i.imgur.com/yI8u4Hr.jpg" style="width:50%"><h3 id="Class-Loader-Sub-System"><a href="#Class-Loader-Sub-System" class="headerlink" title="Class Loader Sub System"></a>Class Loader Sub System</h3><h4 id="1-Loading"><a href="#1-Loading" class="headerlink" title="1. Loading"></a>1. Loading</h4><ul><li><p>loading the class file and store inside method area</p><img src="https://i.imgur.com/57IalMb.png" style="width:50%"></li><li><p>Created object is not student object or customer object. It is a predefined class â€œClassâ€ object that is presently in java.lang package.</p><img src="https://i.imgur.com/9hHykjw.png" style="width:70%"></li><li><p>For every loaded .class file, only one class â€œClassâ€ object will be created by JVM, even though we are using that class multiple times in our program. Example,</p><img src="https://i.imgur.com/KKpqYVn.png" style="width:70%"></li></ul><h4 id="2-Linking"><a href="#2-Linking" class="headerlink" title="2. Linking"></a>2. Linking</h4><ul><li><p><strong>verification</strong> </p><blockquote><p>This Byte Code Verifier is responsible to verify weather .class file is properly formatted or not, structurally correct or not, generated by valid compiler or not.</p></blockquote></li><li><p><strong>preparation</strong> </p><blockquote><p>allocate memory for class level static variables and assigned default values.</p><p>E.g. For int â€”&gt; 0, For double â€”&gt; 0.0, For boolean â€”&gt; false</p></blockquote></li><li><p><strong>Resolution</strong></p><blockquote><p>It is the process of replacing all symbolic references used in our class with original direct references from method area.</p></blockquote><p><img src="https://i.imgur.com/jTM8BJz.png"></p></li><li><p><strong>Initialization</strong></p></li></ul><blockquote><p>In Initialization activity, for class level static variables assigns original values and static blocks will be executed from top to bottom.</p></blockquote><ul><li>Types of class loaders in class loader subsystem<ul><li>Bootstrap class loader/ Primordial class loader</li><li>Extension class loader</li><li>Application class loader/System class loader</li></ul></li></ul><h4 id="3-Class-loader-sub-system-follows-delegation-hierarchy-algorithm"><a href="#3-Class-loader-sub-system-follows-delegation-hierarchy-algorithm" class="headerlink" title="3. Class loader sub system follows delegation hierarchy algorithm"></a>3. Class loader sub system follows delegation hierarchy algorithm</h4><ul><li><strong>Customized class loader</strong>Sometimes we may not satisfy with default class loader mechanism then we can go for Customized class loader. For example:</li></ul><h3 id="Various-Memory-Areas-in-JVM"><a href="#Various-Memory-Areas-in-JVM" class="headerlink" title="Various Memory Areas in JVM"></a>Various Memory Areas in JVM</h3><h4 id="1-Method-Area"><a href="#1-Method-Area" class="headerlink" title="1. Method Area"></a>1. Method Area</h4><ul><li><p>Inside method area class level binary data including static variables will be stored</p></li><li><p>Constant pools of a class will be stored inside method area.</p></li><li><p>Method area can be accessed by multiple threads simultaneously.</p><blockquote><p>All threads share the same method area, so access to the method areaâ€™s data structures must be designed to be thread-safe. </p></blockquote></li></ul><h4 id="2-Heap-Area"><a href="#2-Heap-Area" class="headerlink" title="2. Heap Area"></a>2. Heap Area</h4><blockquote><p><strong>Heap space in Java is used for dynamic memory allocation for Java objects and JRE classes at the runtime</strong>. New objects are always created in heap space and the references to this objects are stored in stack memory.</p></blockquote><p>These objects have global access and can be accessed from anywhere in the application.</p><p>This memory model is further broken into smaller parts called generations, these are:</p><ol><li><strong>Young Generation â€“</strong> this is where all new objects are allocated and aged. A minor Garbage collection occurs when this fills up</li><li><strong>Old or Tenured Generation â€“</strong> this is where long surviving objects are stored. When objects are stored in the Young Generation, a threshold for the objectâ€™s age is set and when that threshold is reached, the object is moved to the old generation</li><li><strong>Permanent Generation â€“</strong> this consists of JVM metadata for the runtime classes and application methods</li></ol><ul><li>Itâ€™s accessed via complex memory management techniques that include Young Generation, Old or Tenured Generation, and Permanent Generation</li><li>If heap space is full, Java throws <em>java.lang.OutOfMemoryError</em></li><li>Access to this memory is relatively slower than stack memory</li><li>This memory, in contrast to stack, isnâ€™t automatically deallocated. It needs Garbage Collector to free up unused objects so as to keep the efficiency of the memory usage</li><li>Unlike stack, a heap isnâ€™t threadsafe and needs to be guarded by properly synchronizing the code</li></ul><hr><ul><li><p>Objects and corresponding instance variables will be stored in the heap area.</p></li><li><p>Every array in java is object only hence arrays also will be stored in the heap area.</p></li><li><p>Heap area can be access by multiple threads and hence the data stored in the heap area is not thread safe.</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Set Maximum and Minimum heap size</span><br><span class="line">-Xmx</span><br><span class="line">     To set maximum heap size , i.e., maxMemory</span><br><span class="line">    java -Xmx512m HeapSpaceDemo</span><br><span class="line">     Here mx = maximum size</span><br><span class="line">              512m = 512 MB</span><br><span class="line">              HeapSpaceDemo = Java class name</span><br><span class="line">-Xms</span><br><span class="line">     To set minimum heap size , i.e., total memory </span><br><span class="line">        java -Xms65m HeapSpaceDemo   </span><br><span class="line">      Here ms = minimum size</span><br><span class="line">              65m = 65 MB</span><br><span class="line">              HeapSpaceDemo = Java class name</span><br><span class="line">or, you can set a minimum maximum heap size at a time</span><br><span class="line">java -Xms256m -Xmx1024m HeapSpaceDemo</span><br></pre></td></tr></table></figure><h4 id="3-Stack-Memory"><a href="#3-Stack-Memory" class="headerlink" title="3. Stack Memory"></a>3. Stack Memory</h4><blockquote><p><strong>Stack Memory in Java is used for static memory allocation and the execution of a thread.</strong> It contains primitive values that are specific to a method and references to objects that are in a heap, referred from the method.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Access to this memory is in Last-In-First-Out (LIFO) order. Whenever a new method is called, a new block on top of the stack is created which contains values specific to that method, like primitive variables and references to objects.</span><br><span class="line"></span><br><span class="line">When the method finishes execution, itâ€™s corresponding stack frame is flushed, the flow goes back to the calling method and space becomes available for the next method.</span><br></pre></td></tr></table></figure><ul><li><p>It grows and shrinks as new methods are called and returned respectively</p></li><li><p>Variables inside stack exist only as long as the method that created them is running</p></li><li><p>Itâ€™s automatically allocated and deallocated when method finishes execution</p></li><li><p>If this memory is full, Java throws <em>java.lang.StackOverFlowError</em></p></li><li><p>Access to this memory is fast when compared to heap memory</p></li><li><p>This memory is threadsafe as each thread operates in its own stack</p></li></ul><hr><ul><li><p>Local Variable Array</p><ul><li><p>It contains all parameters and local variables of the method.</p></li><li><p>the occupied slot </p></li></ul></li><li><p>Operand Stack</p><ul><li><p>JVM uses operand stack as work space.</p></li><li><p>last-in first-out (LIFO) </p></li><li><p>how a Java virtual machine would add two local variables that contain ints and store the int result in a third local variable:</p></li></ul></li><li><p>Frame Data</p></li></ul><p><strong>Stack Memory vs Heap Space</strong></p><table><thead><tr><th>Parameter</th><th>Stack Memory</th><th>Heap Space</th></tr></thead><tbody><tr><td>Application</td><td>Stack is used in parts, one at a time during execution of a thread</td><td>The entire application uses Heap space during runtime</td></tr><tr><td>Size</td><td>Stack has size limits depending upon OS and is usually smaller then Heap</td><td>There is no size limit on Heap</td></tr><tr><td>Storage</td><td>Stores only primitive variables and references to objects that are created in Heap Space</td><td>All the newly created objects are stored here</td></tr><tr><td>Order</td><td>It is accessed using Last-in First-out (LIFO) memory allocation system</td><td>This memory is accessed via complex memory management techniques that include Young Generation, Old or Tenured Generation, and Permanent Generation.</td></tr><tr><td>Life</td><td>Stack memory only exists as long as the current method is running</td><td>Heap space exists as long as the application runs</td></tr><tr><td>Efficiency</td><td>Comparatively much faster to allocate when compared to heap</td><td>Slower to allocate when compared to stack</td></tr><tr><td>Allocation/Deallocation</td><td>This Memory is automatically allocated and deallocated when a method is called and returned respectively</td><td>Heap space is allocated when new objects are created and deallocated by Gargabe Collector when they are no longer referenced</td></tr></tbody></table><h4 id="4-PC-Registers-Program-Counter-Registers"><a href="#4-PC-Registers-Program-Counter-Registers" class="headerlink" title="4. PC Registers(Program Counter Registers)"></a>4. PC Registers(Program Counter Registers)</h4><blockquote><p>For every thread a separate PC register will be created at the time of thread creation. PC register contains address of current executing instruction. Once instruction execution completes automatically PC register will be incremented to hold address of next instruction. An â€œaddressâ€ can be a native pointer or an offset from the beginning of a methodâ€™s byte codes.   </p></blockquote><h4 id="5-Native-Method-Stacks"><a href="#5-Native-Method-Stacks" class="headerlink" title="5. Native Method Stacks"></a>5. Native Method Stacks</h4><blockquote><p>Here also for every Thread a separate run time stack will be created. It contains all the native methods used in the application. Native method means methods written in a language other than the Java programming language. In other words, it is a stack used to execute C/C++ codes invoked through JNI (Java Native Interface). According to the language, a C stack or C++ stack is created.</p></blockquote><h3 id="Execution-Engine"><a href="#Execution-Engine" class="headerlink" title="Execution Engine"></a>Execution Engine</h3><h4 id="1-Interpreter"><a href="#1-Interpreter" class="headerlink" title="1. Interpreter"></a>1. Interpreter</h4><blockquote><p>It is responsible to read byte code and interpret into machine code (native code) and execute that machine code line by line. </p></blockquote><h4 id="2-JIT-Compiler"><a href="#2-JIT-Compiler" class="headerlink" title="2. JIT Compiler"></a>2. JIT Compiler</h4><blockquote><p>The JIT compiler has been introduced to compensate for the disadvantages of the interpreter. The main purpose of JIT compiler is to improve the performance. Internally JIT compiler maintains a separate count for every method. Whenever JVM across any method call, first that method will be interpreted normally by the interpreter and JIT compiler increments the corresponding count variable. </p></blockquote><ul><li><strong>Profiler</strong> which is the part of JIT compiler is responsible to identify Hotspot(Repeated Used Methods).</li></ul><h3 id="Java-Native-Interface-JNI"><a href="#Java-Native-Interface-JNI" class="headerlink" title="Java Native Interface(JNI)"></a>Java Native Interface(JNI)</h3><blockquote><p>JNI is acts as a bridge (Mediator) for java method calls and corresponding native libraries. </p></blockquote><h3 id="å†…å­˜å¤§å°è®¾ç½®"><a href="#å†…å­˜å¤§å°è®¾ç½®" class="headerlink" title="å†…å­˜å¤§å°è®¾ç½®"></a>å†…å­˜å¤§å°è®¾ç½®</h3><ul><li>åœ¨å‘½ä»¤è¡Œä¸‹ç”¨  java -Xmx1200m -XX:Max Perm Size=60m -version å‘½ä»¤æ¥è¿›è¡Œæµ‹è¯•ï¼Œç„¶åé€æ¸çš„å¢å¤§XXXXçš„å€¼ï¼Œå¦‚æœæ‰§è¡Œæ­£å¸¸å°±è¡¨ç¤ºæŒ‡å®šçš„å†…å­˜å¤§å°å¯ç”¨ï¼Œå¦åˆ™ä¼šæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚<br>æœ€åå¾—åˆ°çš„è™šæ‹Ÿæœºå®é™…åˆ†é…åˆ°çš„<br>æ€»å†…å­˜å¤§å°=å †å†…å­˜+éå †å†…å­˜<br>1200mï¼šä¸ºå †å†…å­˜å¤§å°ï¼Œå¦‚æœä¸æŒ‡å®šåè€…å‚æ•°åˆ™æœ‰æœ€å¤§æ•°é™åˆ¶ï¼Œç½‘ä¸Šå¾ˆå¤šæ–‡ç« è®¤ä¸ºè¿™å°±æ˜¯JVMå†…å­˜ï¼Œ -Xmxä¸ºè®¾ç½®æœ€å¤§å †å†…å­˜<br>60mï¼š ä¸ºéå †å†…å­˜å¤§å°ï¼Œ -XX: Max PermSizeå®ä¸º æ°¸ä¹…åŸŸå†…å­˜ï¼Œåœ¨å †å†…å­˜ä¹‹å¤–ï¼Œå±äºéå †å†…å­˜éƒ¨åˆ†ï¼Œjdk1.5æˆ‘æµ‹äº†å¥½åƒé»˜è®¤ä¸º62mï¼Œå³å¾—åˆ°éå †éƒ¨åˆ†é»˜è®¤å†…å­˜ï¼‰</li></ul><h1 id="è¿›ç¨‹å†…å­˜"><a href="#è¿›ç¨‹å†…å­˜" class="headerlink" title="è¿›ç¨‹å†…å­˜"></a>è¿›ç¨‹å†…å­˜</h1><h2 id="æŸ¥çœ‹è¿›ç¨‹å¯¹è±¡å¤§å°"><a href="#æŸ¥çœ‹è¿›ç¨‹å¯¹è±¡å¤§å°" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹å¯¹è±¡å¤§å°"></a>æŸ¥çœ‹è¿›ç¨‹å¯¹è±¡å¤§å°</h2><ul><li><p><strong>jmap -histo è¿›ç¨‹id</strong>  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -histo 123456 | head -n15</span><br></pre></td></tr></table></figure></li></ul><h2 id="æŸ¥çœ‹å†…å­˜åˆ†å¸ƒåŠå›æ”¶æƒ…å†µ"><a href="#æŸ¥çœ‹å†…å­˜åˆ†å¸ƒåŠå›æ”¶æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹å†…å­˜åˆ†å¸ƒåŠå›æ”¶æƒ…å†µ"></a>æŸ¥çœ‹å†…å­˜åˆ†å¸ƒåŠå›æ”¶æƒ…å†µ</h2><ul><li><p><strong>jstat -gc è¿›ç¨‹id æ¯«ç§’</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gc 1692 5000</span><br></pre></td></tr></table></figure><p>S0C: Young Generationç¬¬ä¸€ä¸ªsurvivor spaceçš„å†…å­˜å¤§å° (kB).<br>S1C: Young Generationç¬¬äºŒä¸ªsurvivor spaceçš„å†…å­˜å¤§å° (kB).<br>S0U: Young Generationç¬¬ä¸€ä¸ªSurvivor spaceå½“å‰å·²ä½¿ç”¨çš„å†…å­˜å¤§å° (kB).<br>S1U: Young Generationç¬¬äºŒä¸ªSurvivor spaceå½“å‰å·²ç»ä½¿ç”¨çš„å†…å­˜å¤§å° (kB).<br>EC: Young Generationä¸­eden spaceçš„å†…å­˜å¤§å° (kB).<br>EU: Young Generationä¸­Eden spaceå½“å‰å·²ä½¿ç”¨çš„å†…å­˜å¤§å° (kB).<br>OC: Old Generationçš„å†…å­˜å¤§å° (kB).<br>OU: Old Generationå½“å‰å·²ä½¿ç”¨çš„å†…å­˜å¤§å° (kB).<br>MC: Permanent Generationçš„å†…å­˜å¤§å° (kB)<br>MU: Permanent Generationå½“å‰å·²ä½¿ç”¨çš„å†…å­˜å¤§å° (kB).<br>YGC: ä»å¯åŠ¨åˆ°é‡‡æ ·æ—¶Young Generation GCçš„æ¬¡æ•°<br>YGCT: ä»å¯åŠ¨åˆ°é‡‡æ ·æ—¶Young Generation GCæ‰€ç”¨çš„æ—¶é—´ (s).<br>FGC: ä»å¯åŠ¨åˆ°é‡‡æ ·æ—¶Old Generation GCçš„æ¬¡æ•°.<br>FGCT: ä»å¯åŠ¨åˆ°é‡‡æ ·æ—¶Old Generation GCæ‰€ç”¨çš„æ—¶é—´ (s).<br>GCT: ä»å¯åŠ¨åˆ°é‡‡æ ·æ—¶GCæ‰€ç”¨çš„æ€»æ—¶é—´ (s).</p></li></ul><h2 id="æŸ¥çœ‹å †æ ˆå ç”¨"><a href="#æŸ¥çœ‹å †æ ˆå ç”¨" class="headerlink" title="æŸ¥çœ‹å †æ ˆå ç”¨"></a>æŸ¥çœ‹å †æ ˆå ç”¨</h2><ul><li><p><strong>jmap -heap è¿›ç¨‹id</strong>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">S0ï¼š æ–°ç”Ÿä»£ä¸­Survivor space 0åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯”</span><br><span class="line">S1ï¼š æ–°ç”Ÿä»£ä¸­Survivor space 1åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯”</span><br><span class="line">E ï¼šæ–°ç”Ÿä»£å·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯” Eden space</span><br><span class="line">Oï¼š è€å¹´ä»£å·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯”ï¼ˆP:  æ°¸ä¹…å¸¦å·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯”ï¼‰</span><br><span class="line"></span><br><span class="line">Mï¼š å…ƒç©ºé—´ä½¿ç”¨ç™¾åˆ†æ¯”</span><br><span class="line">CCSï¼š å‹ç¼©ç±»ç©ºé—´åˆ©ç”¨ç‡ä¸ºç™¾åˆ†æ¯”</span><br><span class="line">YGCï¼š YGCæ¬¡æ•°</span><br><span class="line">YGCTï¼š å¹´è½»ä¸€ä»£åƒåœ¾æ”¶é›†æ—¶é—´</span><br><span class="line">FGCï¼š FGCæ¬¡æ•°.</span><br><span class="line">FGCTï¼š å®Œå…¨åƒåœ¾æ”¶é›†æ—¶é—´</span><br><span class="line">GCTï¼š åƒåœ¾å›æ”¶æ€»æ—¶é—´</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>maven snippet</title>
      <link href="/2018/01/09/maven%20snippet/"/>
      <url>/2018/01/09/maven%20snippet/</url>
      
        <content type="html"><![CDATA[<h3 id="å‘½ä»¤ä»‹ç»"><a href="#å‘½ä»¤ä»‹ç»" class="headerlink" title="å‘½ä»¤ä»‹ç»"></a>å‘½ä»¤ä»‹ç»</h3><ol><li><strong>mvn compile</strong> ç¼–è¯‘,å°†Java æºç¨‹åºç¼–è¯‘æˆ class å­—èŠ‚ç æ–‡ä»¶ã€‚</li><li><strong>mvn test</strong> æµ‹è¯•ï¼Œå¹¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</li><li><strong>mvn clean</strong> å°†ä»¥å‰ç¼–è¯‘å¾—åˆ°çš„æ—§çš„ class å­—èŠ‚ç æ–‡ä»¶åˆ é™¤</li><li><strong>mvn pakage</strong> æ‰“åŒ…,åŠ¨æ€ webå·¥ç¨‹æ‰“ waråŒ…ï¼ŒJavaå·¥ç¨‹æ‰“ jar åŒ…ã€‚</li><li><strong>mvn install</strong> å°†é¡¹ç›®ç”Ÿæˆ jar åŒ…æ”¾åœ¨ä»“åº“ä¸­ï¼Œä»¥ä¾¿åˆ«çš„æ¨¡å—è°ƒç”¨</li><li><a href="https://www.cnblogs.com/zhangxh20/p/6298062.html">Mavençš„å‡ ä¸ªå¸¸ç”¨plugin</a></li></ol><h3 id="tomcaté¡¹ç›®çš„éƒ¨ç½²"><a href="#tomcaté¡¹ç›®çš„éƒ¨ç½²" class="headerlink" title="tomcaté¡¹ç›®çš„éƒ¨ç½²"></a>tomcaté¡¹ç›®çš„éƒ¨ç½²</h3><ul><li>å‚ç…§ <a href="https://blog.csdn.net/u012076316/article/details/46907823">tomcat è®¾ç½®çƒ­éƒ¨ç½²</a></li><li>å‚ç…§<a href="http://www.jb51.net/article/117334.htm">warå’Œwar explodedåŒºåˆ«åŠé—®é¢˜æ±‡æ€»</a></li><li>å‚ç…§<a href="https://www.jianshu.com/p/fb0ed26c35d5">tomcatéƒ¨ç½²çš„ä¸åŒæ–¹å¼</a></li><li>å¯åŠ¨é¡¹ç›®æ—¶ï¼Œå¦‚æœteståŒ…é‡Œé¢æœ‰æµ‹è¯•ç¨‹åºï¼Œä¸ºäº†å¿½ç•¥ç¼–è¯‘testæµ‹è¯•ç¨‹åºï¼Œéœ€è¦è¿è¡Œå‘½ä»¤æ‰“åŒ…<code>mvn clean package -DskipTests</code>ï¼Œå¦å¤–è¿è¡Œtomcatçš„æ—¶å€™ä»¥debugæ¨¡å¼è¿›è¡Œå¯åŠ¨ã€‚</li></ul><h3 id="mavenå¤šé¡¹ç›®ä¹‹é—´ç›¸äº’å¼•ç”¨"><a href="#mavenå¤šé¡¹ç›®ä¹‹é—´ç›¸äº’å¼•ç”¨" class="headerlink" title="mavenå¤šé¡¹ç›®ä¹‹é—´ç›¸äº’å¼•ç”¨"></a>mavenå¤šé¡¹ç›®ä¹‹é—´ç›¸äº’å¼•ç”¨</h3><ul><li><p>åº”è¯¥åœ¨çˆ¶ç›®å½•ä¸‹è¿›è¡Œmaven installæ“ä½œï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå­æ¨¡å—çš„jaræˆ–waråŒ…ã€‚</p></li><li><p><strong>è§£å†³mavenæ— æ³•åŠ è½½æœ¬åœ°lib/ä¸‹çš„jaråŒ…é—®é¢˜(ç¨‹åºåŒ…XXXä¸å­˜åœ¨)</strong></p><ul><li><p>åŸå› </p><p>è‹¥è¯¥ç¨‹åºåŒ…æ˜¯ç¬¬ä¸‰æ–¹çš„jarï¼Œè§£å†³æ–¹æ¡ˆæ˜¯è®©mavenæ—¢åŠ è½½mavenåº“ä¸­çš„jaråŒ…ï¼Œåˆè¦åŠ è½½æœ¬åœ°WEB-INF/libä¸‹çš„jaråŒ…ã€‚ </p></li><li><p>è§£å†³</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.6.0&lt;/version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">        &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">        &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">        &lt;compilerArguments&gt;</span><br><span class="line">            &lt;extdirs&gt;$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib&lt;/extdirs&gt;</span><br><span class="line">        &lt;/compilerArguments&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="åˆ›å»ºæœ¬åœ°å¼•ç”¨åŒ…"><a href="#åˆ›å»ºæœ¬åœ°å¼•ç”¨åŒ…" class="headerlink" title="åˆ›å»ºæœ¬åœ°å¼•ç”¨åŒ…"></a>åˆ›å»ºæœ¬åœ°å¼•ç”¨åŒ…</h2><h4 id="1-ç›´æ¥å¼•ç”¨æœ¬åœ°jar"><a href="#1-ç›´æ¥å¼•ç”¨æœ¬åœ°jar" class="headerlink" title="1.ç›´æ¥å¼•ç”¨æœ¬åœ°jar"></a>1.ç›´æ¥å¼•ç”¨æœ¬åœ°jar</h4><p>å°†jaræ”¾åœ¨é¡¹ç›®ä¸­ï¼Œä¾‹å¦‚webé¡¹ç›®å°±æ”¾åœ¨ <code>webapp/WEB-INF/lib</code>ä¸‹é¢<br>ç„¶åå†<code>pom.xml</code>ä¸­æ·»åŠ jarçš„ä¾èµ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;myjar&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;myjar&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;system&lt;/scope&gt;</span><br><span class="line">    &lt;systemPath&gt;$&#123;project.basedir&#125;/webapp/WEB-INF/lib/myjar-1.0.0.jar&lt;/systemPath&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h4 id="2-å®‰è£…åˆ°æœ¬åœ°ä»“åº“"><a href="#2-å®‰è£…åˆ°æœ¬åœ°ä»“åº“" class="headerlink" title="2.å®‰è£…åˆ°æœ¬åœ°ä»“åº“"></a>2.å®‰è£…åˆ°æœ¬åœ°ä»“åº“</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -Dfile=xxx.jar -DgroupId=xx.xxx.xx -DartifactId=xx -Dversion=xx -Dpackaging=jar</span><br><span class="line"></span><br><span class="line">å‚æ•°è¯´æ˜:</span><br><span class="line">-DgroupId:å¯¹åº”dependencyçš„groupId</span><br><span class="line">-DartifactId:å¯¹åº”dependencyçš„artifactId</span><br><span class="line">-Dversion:å¯¹åº”dependencyä¸­çš„version</span><br><span class="line">-Dpackaging:å®‰è£…çš„ç±»å‹ï¼Œjaræˆ–è€…pom</span><br><span class="line">-Dfile:è¦å®‰è£…çš„jaræ–‡ä»¶çš„è·¯å¾„</span><br></pre></td></tr></table></figure><h2 id="scope"><a href="#scope" class="headerlink" title="scope"></a>scope</h2><ul><li><p>compile<br>é»˜è®¤å°±æ˜¯compileï¼Œä»€ä¹ˆéƒ½ä¸é…ç½®ä¹Ÿå°±æ˜¯æ„å‘³ç€compileã€‚compileè¡¨ç¤ºè¢«ä¾èµ–é¡¹ç›®éœ€è¦å‚ä¸å½“å‰é¡¹ç›®çš„ç¼–è¯‘ï¼Œå½“ç„¶åç»­çš„æµ‹è¯•ï¼Œè¿è¡Œå‘¨æœŸä¹Ÿå‚ä¸å…¶ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¼ºçš„ä¾èµ–ã€‚æ‰“åŒ…çš„æ—¶å€™é€šå¸¸éœ€è¦åŒ…å«è¿›å»ã€‚</p></li><li><p>test<br>scopeä¸ºtestè¡¨ç¤ºä¾èµ–é¡¹ç›®ä»…ä»…å‚ä¸æµ‹è¯•ç›¸å…³çš„å·¥ä½œï¼ŒåŒ…æ‹¬æµ‹è¯•ä»£ç çš„ç¼–è¯‘ï¼Œæ‰§è¡Œã€‚æ¯”è¾ƒå…¸å‹çš„å¦‚junitã€‚</p></li><li><p>runtime<br>runntimeè¡¨ç¤ºè¢«ä¾èµ–é¡¹ç›®æ— éœ€å‚ä¸é¡¹ç›®çš„ç¼–è¯‘ï¼Œä¸è¿‡åæœŸçš„æµ‹è¯•å’Œè¿è¡Œå‘¨æœŸéœ€è¦å…¶å‚ä¸ã€‚ä¸compileç›¸æ¯”ï¼Œè·³è¿‡ç¼–è¯‘è€Œå·²ï¼Œè¯´å®è¯åœ¨ç»ˆç«¯çš„é¡¹ç›®ï¼ˆéå¼€æºï¼Œä¼ä¸šå†…éƒ¨ç³»ç»Ÿï¼‰ä¸­ï¼Œå’ŒcompileåŒºåˆ«ä¸æ˜¯å¾ˆå¤§ã€‚æ¯”è¾ƒå¸¸è§çš„å¦‚JSRÃ—Ã—Ã—çš„å®ç°ï¼Œå¯¹åº”çš„API jaræ˜¯compileçš„ï¼Œå…·ä½“å®ç°æ˜¯runtimeçš„ï¼Œcompileåªéœ€è¦çŸ¥é“æ¥å£å°±è¶³å¤Ÿäº†ã€‚oracle jdbcé©±åŠ¨æ¶åŒ…å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œä¸€èˆ¬scopeä¸ºrunntimeã€‚å¦å¤–runntimeçš„ä¾èµ–é€šå¸¸å’Œoptionalæ­é…ä½¿ç”¨ï¼Œoptionalä¸ºtrueã€‚æˆ‘å¯ä»¥ç”¨Aå®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨Bå®ç°ã€‚</p></li><li><p>provided<br>providedæ„å‘³ç€æ‰“åŒ…çš„æ—¶å€™å¯ä»¥ä¸ç”¨åŒ…è¿›å»ï¼Œåˆ«çš„è®¾æ–½(Web Container)ä¼šæä¾›ã€‚äº‹å®ä¸Šè¯¥ä¾èµ–ç†è®ºä¸Šå¯ä»¥å‚ä¸ç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œè¿è¡Œç­‰å‘¨æœŸã€‚ç›¸å½“äºcompileï¼Œä½†æ˜¯åœ¨æ‰“åŒ…é˜¶æ®µåšäº†excludeçš„åŠ¨ä½œã€‚</p></li><li><p>system<br>ä»å‚ä¸åº¦æ¥è¯´ï¼Œå’Œprovidedç›¸åŒï¼Œä¸è¿‡è¢«ä¾èµ–é¡¹ä¸ä¼šä»mavenä»“åº“æŠ“ï¼Œè€Œæ˜¯ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ‹¿ï¼Œä¸€å®šéœ€è¦é…åˆsystemPathå±æ€§ä½¿ç”¨</p></li></ul><h2 id="ä¾èµ–ä¼ é€’åŸåˆ™"><a href="#ä¾èµ–ä¼ é€’åŸåˆ™" class="headerlink" title="ä¾èµ–ä¼ é€’åŸåˆ™"></a>ä¾èµ–ä¼ é€’åŸåˆ™</h2><p>å‡ ä¹æ‰€æœ‰çš„JaråŒ…å†²çªéƒ½å’Œä¾èµ–ä¼ é€’åŸåˆ™æœ‰å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¯´Mavenä¸­çš„ä¾èµ–ä¼ é€’åŸåˆ™ï¼š</p><p><strong>æœ€çŸ­è·¯å¾„ä¼˜å…ˆåŸåˆ™</strong></p><p>å‡å¦‚å¼•å…¥äº†2ä¸ªJaråŒ…Aå’ŒBï¼Œéƒ½ä¼ é€’ä¾èµ–äº†Zè¿™ä¸ªJaråŒ…ï¼š</p><p>A -&gt; X -&gt; Y -&gt; Z(2.5)<br>B -&gt; X -&gt; Z(2.0)</p><p>é‚£å…¶å®æœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯Z(2.0)è¿™ä¸ªç‰ˆæœ¬ã€‚å› ä¸ºä»–çš„è·¯å¾„æ›´åŠ çŸ­ã€‚å¦‚æœæˆ‘æœ¬åœ°å¼•ç”¨äº†Z(3.0)çš„åŒ…ï¼Œé‚£ç”Ÿæ•ˆçš„å°±æ˜¯3.0çš„ç‰ˆæœ¬ã€‚ä¸€æ ·çš„é“ç†ã€‚</p><p><strong>æœ€å…ˆå£°æ˜ä¼˜å…ˆåŸåˆ™</strong></p><p>å¦‚æœè·¯å¾„é•¿çŸ­ä¸€æ ·ï¼Œä¼˜å…ˆé€‰æœ€å…ˆå£°æ˜çš„é‚£ä¸ªã€‚</p><p>A -&gt; Z(3.0)<br>B -&gt; Z(2.5)</p><p>è¿™é‡ŒAæœ€å…ˆå£°æ˜ï¼Œæ‰€ä»¥ä¼ é€’è¿‡æ¥çš„Zé€‰æ‹©ç”¨3.0ç‰ˆæœ¬çš„ã€‚</p><h2 id="å¼•ç”¨æœ¬åœ°jaråŒ…ä¾èµ–"><a href="#å¼•ç”¨æœ¬åœ°jaråŒ…ä¾èµ–" class="headerlink" title="å¼•ç”¨æœ¬åœ°jaråŒ…ä¾èµ–"></a>å¼•ç”¨æœ¬åœ°jaråŒ…ä¾èµ–</h2><ol><li><p>jaråŒ…æ”¾å…¥é¡¹ç›®æŒ‡å®šä½ç½® ieï¼š${project.basedir}/src/main/resources/lib/xxx.jar</p></li><li><p>pomæ–‡ä»¶å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sdk.core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources/lib/xxx.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>systemPathè¿™ä¸ªè·¯å¾„æ˜¯jaråŒ…çš„è·¯å¾„ã€‚${project.basedir}åªæ˜¯ä¸€ä¸ªç³»ç»Ÿè‡ªå·±çš„å¸¸é‡ã€‚</p></blockquote></li><li><p>åœ¨å°†é¡¹ç›®ç”¨Mavenæ‰“åŒ…æ˜¯éœ€è¦åœ¨ <plugin> æ ‡ç­¾ä¸­åŠ å…¥:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includeSystemScope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeSystemScope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="init-project"><a href="#init-project" class="headerlink" title="init project"></a>init project</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=brook.hbase -DartifactId=hbase-client -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4 -DinteractiveMode=false</span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤å¯åŠ¨springboot"><a href="#å‘½ä»¤å¯åŠ¨springboot" class="headerlink" title="å‘½ä»¤å¯åŠ¨springboot"></a>å‘½ä»¤å¯åŠ¨springboot</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure><h2 id="add-git-commit-info-to-jar-package"><a href="#add-git-commit-info-to-jar-package" class="headerlink" title="add git commit info to jar package"></a>add git commit info to jar package</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>pl.project13.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>git-commit-id-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>get-the-git-infos<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>revision<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dotGitDirectory</span>&gt;</span>$&#123;project.basedir&#125;/.git<span class="tag">&lt;/<span class="name">dotGitDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prefix</span>&gt;</span>git<span class="tag">&lt;/<span class="name">prefix</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>false<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">generateGitPropertiesFile</span>&gt;</span>true&lt;/generateGitPropertiesFile</span><br><span class="line">  <span class="tag">&lt;<span class="name">generateGitPropertiesFilename</span>&gt;</span>$&#123;project.build.outputDirectory&#125;/git.properties<span class="tag">&lt;/<span class="name">generateGitPropertiesFilename</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">format</span>&gt;</span>json<span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gitDescribe</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">skip</span>&gt;</span>false<span class="tag">&lt;/<span class="name">skip</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">always</span>&gt;</span>false<span class="tag">&lt;/<span class="name">always</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dirty</span>&gt;</span>-dirty<span class="tag">&lt;/<span class="name">dirty</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">gitDescribe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç”Ÿæˆçš„<code>git.properties</code>ä¼šåœ¨jaråŒ…ä½ç½® <code>BOOT-INF/classes/git.properties</code></p></blockquote><h1 id="ç›¸å…³é—®é¢˜"><a href="#ç›¸å…³é—®é¢˜" class="headerlink" title="ç›¸å…³é—®é¢˜"></a>ç›¸å…³é—®é¢˜</h1><ul><li><p><a href="https://www.cnblogs.com/baixiaoshuai/p/8939989.html">ideaä¸­çš„mavenæ¨¡å—å˜æˆç°è‰²çš„å¯èƒ½åŸå› </a></p></li><li><p><a href="https://blog.csdn.net/qq_38663729/article/details/78275209">jaråŒ…å’ŒwaråŒ…çš„ä»‹ç»ä¸åŒºåˆ«</a></p></li><li><p>ç”±äºæ²¡æœ‰mvn installæ“ä½œï¼Œæ²¡æœ‰åœ¨æœ¬åœ°ä¸‹è½½ä¾èµ–åŒ…åˆ°libç›®å½•ä¸‹ï¼Œæ‰€ä»¥å¯åŠ¨é¡¹ç›®ï¼Œä¼šæç¤ºjava.lang.ClassNotFoundException: org.springframework.web.context.ContextLoaderListeneré”™è¯¯</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring aop</title>
      <link href="/2017/12/18/spring%20aop/"/>
      <url>/2017/12/18/spring%20aop/</url>
      
        <content type="html"><![CDATA[<h3 id="Architectural"><a href="#Architectural" class="headerlink" title="Architectural"></a>Architectural</h3><p><img src="https://www.baeldung.com/wp-content/uploads/2017/11/Program_Execution.jpg"></p><h3 id="Business-Object"><a href="#Business-Object" class="headerlink" title="Business Object"></a>Business Object</h3><blockquote><p><strong>A business object is a normal class which has a normal business logic.</strong></p></blockquote><h3 id="Aspect"><a href="#Aspect" class="headerlink" title="Aspect"></a>Aspect</h3><blockquote><p><strong>An aspect is a modularization of a concern that cuts across multiple classes.</strong></p></blockquote><h3 id="JoinPoint"><a href="#JoinPoint" class="headerlink" title="JoinPoint"></a>JoinPoint</h3><blockquote><p><strong>A Joinpoint is a point during the execution of a program, such as execution of a method or the handling of an exception.</strong></p></blockquote><p>In Spring AOP, a <em>JoinPoint</em> always represents a method execution.</p><h3 id="Pointcut"><a href="#Pointcut" class="headerlink" title="Pointcut"></a>Pointcut</h3><blockquote><p><strong>A Pointcut is a predicate that helps match an <em>Advice</em> to be applied by an <em>Aspect</em> at a particular <em>JoinPoint</em>.</strong></p></blockquote><p>The Advice is often associated with a <em>Pointcut</em> expression and runs at any <em>Joinpoint</em> matched by the Pointcut.</p><h3 id="Advice"><a href="#Advice" class="headerlink" title="Advice"></a>Advice</h3><blockquote><p><strong>An advice is an action taken by an aspect at a particular <em>Joinpoint</em>. Different types of advice include <em>â€œaround,â€ â€œbeforeâ€</em> and <em>â€œafterâ€</em> advice.</strong></p></blockquote><p>In Spring, an <em>Advice</em> is modeled as an interceptor, maintaining a chain of interceptors around the <em>Joinpoint</em>.</p><hr><h3 id="Example-Wiring-Business-Object-and-Aspect"><a href="#Example-Wiring-Business-Object-and-Aspect" class="headerlink" title="Example:Wiring Business Object and Aspect"></a>Example:Wiring Business Object and Aspect</h3><ul><li><p>Business Object</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleAdder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>a simple Aspect</p><p>Unified logging can be an example of such cross-cutting concern:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdderAfterReturnAspect</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturn</span><span class="params">(Object returnValue)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;value return was &#123;&#125;&quot;</span>,  returnValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>config excerpt</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sampleAdder&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.xxx.SampleAdder&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;doAfterReturningAspect&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;org.xxx.AdderAfterReturnAspect&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;aspects&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;doAfterReturningAspect&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointCutAfterReturning&quot;</span> <span class="attr">expression</span>=</span></span><br><span class="line"><span class="tag">         <span class="string">&quot;execution(* org.xxx.SampleAdder+.*(..))&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturn&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">returning</span>=<span class="string">&quot;returnValue&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCutAfterReturning&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><hr><blockquote><p>ä¾èµ–æ³¨å…¥DIæœ‰åŠ©äºåº”ç”¨å¯¹è±¡ä¹‹é—´çš„è§£è€¦ï¼Œè€ŒAOPå¯ä»¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸å®ƒä»¬æ‰€å½±å“çš„å¯¹è±¡ä¹‹é—´çš„è§£è€¦</p></blockquote><ul><li><p>é€šçŸ¥Advice</p><blockquote><p>åˆ‡é¢çš„å·¥ä½œè¢«ç§°ä¸ºé€šçŸ¥ï¼Œé€šçŸ¥å®šä¹‰äº†åˆ‡é¢æ˜¯ä»€ä¹ˆä»¥åŠä½•æ—¶ä½¿ç”¨ã€‚</p></blockquote><ul><li>å‰ç½®é€šçŸ¥ï¼ˆBeforeï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰è°ƒç”¨é€šçŸ¥åŠŸèƒ½</li><li>åç½®é€šçŸ¥ï¼ˆAfterï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•å®Œæˆä¹‹åè°ƒç”¨é€šçŸ¥ï¼Œæ­¤æ—¶ä¸ä¼šå…³å¿ƒæ–¹æ³•çš„è¾“å‡º</li><li>è¿”å›é€šçŸ¥ï¼ˆAfter-returningï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè°ƒç”¨é€šçŸ¥</li><li>å¼‚å¸¸é€šçŸ¥ï¼ˆAfter-throwingï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨é€šçŸ¥</li><li>ç¯ç»•é€šçŸ¥ï¼ˆAroundï¼‰ï¼šé€šçŸ¥åŒ…è£¹äº†è¢«é€šçŸ¥çš„æ–¹æ³•ï¼Œåœ¨è¢«é€šçŸ¥çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œè°ƒç”¨ä¹‹åæ‰§è¡Œè‡ªå®šä¹‰çš„è¡Œä¸ºã€‚</li></ul></li><li><p>è¿æ¥ç‚¹Join point</p><blockquote><p>è¿æ¥ç‚¹æ˜¯åº”ç”¨ç¨‹åºçš„ç‚¹ï¼Œå¯ä¾›æ’å…¥åˆ‡é¢</p><p>æˆ‘ç†è§£çš„æ˜¯ç¨‹åºçš„æŸå¤„ï¼Œæˆ–è€…ä»»æ„ä¸€å¤„éƒ½å¯ä»¥ç§°ä½œä¸ºè¿æ¥ç‚¹</p></blockquote></li><li><p>åˆ‡ç‚¹Pointcut</p><blockquote><p>åˆ‡ç‚¹æœ‰åŠ©äºç¼©å°åˆ‡é¢æ‰€é€šçŸ¥çš„è¿æ¥ç‚¹çš„èŒƒå›´</p><p>å¦‚æœAdviceå®šä¹‰äº†åˆ‡é¢çš„whatå’Œwhen,é‚£ä¹ˆpointcutå°±å®šä¹‰äº†where</p></blockquote></li><li><p>åˆ‡é¢Aspect</p><blockquote><p>Aspectæ˜¯Adviceå’ŒPointcutçš„ç»“åˆ</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue snippet</title>
      <link href="/2017/12/07/vue%20snippet/"/>
      <url>/2017/12/07/vue%20snippet/</url>
      
        <content type="html"><![CDATA[<ul><li><p>vueå®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹ï¼š</p><ul><li>è®¾ç½®æ•°æ®ç›‘å¬</li><li>ç¼–è¯‘æ¨¡æ¿</li><li>å°†å®ä¾‹æŒ‚è½½åˆ°DOMå¹¶åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–°DOMç­‰</li></ul></li><li><p>ç”Ÿå‘½å‘¨æœŸé’©å­ï¼šæä¾›ç”¨æˆ·åœ¨ä¸åŒé˜¶æ®µæ·»åŠ è‡ªå·±çš„ä»£ç çš„æœºä¼š</p><ul><li>createdï¼Œç”¨æ¥å®ä¾‹è¢«åˆ›å»ºä¹‹åæ‰§è¡Œä»£ç </li><li>mounted,</li><li>updated,</li><li>destoryed</li></ul></li><li><p>æŒ‡ä»¤ï¼ˆDirectivesï¼‰æ˜¯å¸¦æœ‰<code>v-</code>å‰ç¼€çš„ç‰¹æ®Šç‰¹æ€§ã€‚æŒ‡ä»¤ç‰¹æ€§çš„å€¼é¢„æœŸæ˜¯å•ä¸ªJavaScriptè¡¨è¾¾å¼ï¼ˆ<code>v-for</code>æ˜¯ä¾‹å¤–æƒ…å†µï¼‰ï¼ŒæŒ‡ä»¤çš„èŒè´£æ˜¯ï¼šå½“è¡¨è¾¾å¼çš„å€¼æ”¹å˜æ—¶ï¼Œå°†å…¶äº§ç”Ÿçš„è¿å¸¦å½±å“ï¼Œå“åº”å¼åœ°ä½œç”¨äºDOMã€‚</p><ul><li><p><code>v-bind</code>ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºå“åº”å¼åœ°æ›´æ–°HTMLç‰¹æ€§ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- å®Œæ•´è¯­æ³• --&gt;</span><br><span class="line">&lt;a v-bind:href=&quot;url&quot;&gt;...&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- ç¼©å†™ --&gt;</span><br><span class="line">&lt;a :href=&quot;url&quot;&gt;...&lt;/a&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>v-on</code>ï¼Œç”¨äºç›‘å¬DOMäº‹ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- å®Œæ•´è¯­æ³• --&gt;</span><br><span class="line">&lt;a v-on:click=&quot;doSomething&quot;&gt;...&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- ç¼©å†™ --&gt;</span><br><span class="line">&lt;a @click=&quot;doSomething&quot;&gt;...&lt;/a&gt;</span><br></pre></td></tr></table></figure></li><li><p>ä¿®é¥°ç¬¦<code>v-on:submit.prevent</code>,<code>.prevent</code> ä¿®é¥°ç¬¦å‘Šè¯‰ <code>v-on</code> æŒ‡ä»¤å¯¹äºè§¦å‘çš„äº‹ä»¶è°ƒç”¨ <code>event.preventDefault()</code>ã€‚</p></li></ul></li></ul><hr><ul><li><p>è®¡ç®—å±æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;example&quot;&gt;</span><br><span class="line">  &lt;p&gt;Original message: &quot;&#123;&#123; message &#125;&#125;&quot;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;Computed reversed message: &quot;&#123;&#123; reversedMessage &#125;&#125;&quot;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var vm = new Vue(&#123;</span><br><span class="line">  el: &#x27;#example&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: &#x27;Hello&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // è®¡ç®—å±æ€§çš„ getter</span><br><span class="line">    reversedMessage: function () &#123;</span><br><span class="line">      // `this` æŒ‡å‘ vm å®ä¾‹</span><br><span class="line">      return this.message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>è®¡ç®—å±æ€§ç¼“å­˜vsæ–¹æ³•</p><p>åœ¨æ–¹æ³•ä¸­å®ç°åŒè®¡ç®—å±æ€§åŒæ ·çš„æ•ˆæœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;Reversed message: &quot;&#123;&#123; reversedMessage() &#125;&#125;&quot;&lt;/p&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨ç»„ä»¶ä¸­</span><br><span class="line">methods: &#123;</span><br><span class="line">  reversedMessage: function () &#123;</span><br><span class="line">    return this.message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è®¡ç®—å±æ€§æ˜¯åŸºäºå®ƒä»¬çš„ä¾èµ–è¿›è¡Œç¼“å­˜çš„</strong>ã€‚åªåœ¨ç›¸å…³ä¾èµ–å‘ç”Ÿæ”¹å˜æ—¶å®ƒä»¬æ‰ä¼šé‡æ–°æ±‚å€¼ã€‚ </p></li><li><p>è®¡ç®—å±æ€§vsä¾¦å¬å±æ€§</p><p>ä¾¦å¬å±æ€§çš„ç”¨æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;demo&quot;&gt;&#123;&#123; fullName &#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var vm = new Vue(&#123;</span><br><span class="line">  el: &#x27;#demo&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    firstName: &#x27;Foo&#x27;,</span><br><span class="line">    lastName: &#x27;Bar&#x27;,</span><br><span class="line">    fullName: &#x27;Foo Bar&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    firstName: function (val) &#123;</span><br><span class="line">      this.fullName = val + &#x27; &#x27; + this.lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    lastName: function (val) &#123;</span><br><span class="line">      this.fullName = this.firstName + &#x27; &#x27; + val</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸è®¡ç®—å±æ€§çš„ç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var vm = new Vue(&#123;</span><br><span class="line">  el: &#x27;#demo&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    firstName: &#x27;Foo&#x27;,</span><br><span class="line">    lastName: &#x27;Bar&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    fullName: function () &#123;</span><br><span class="line">      return this.firstName + &#x27; &#x27; + this.lastName</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>è®¡ç®—å±æ€§çš„setter</p><p>è®¡ç®—å±æ€§é»˜è®¤åªæœ‰ getter ï¼Œä¸è¿‡åœ¨éœ€è¦æ—¶ä½ ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ª setter ï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// ...</span><br><span class="line">computed: &#123;</span><br><span class="line">  fullName: &#123;</span><br><span class="line">    // getter</span><br><span class="line">    get: function () &#123;</span><br><span class="line">      return this.firstName + &#x27; &#x27; + this.lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    // setter</span><br><span class="line">    set: function (newValue) &#123;</span><br><span class="line">      var names = newValue.split(&#x27; &#x27;)</span><br><span class="line">      this.firstName = names[0]</span><br><span class="line">      this.lastName = names[names.length - 1]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// ...</span><br></pre></td></tr></table></figure><p>ç°åœ¨å†è¿è¡Œ <code>vm.fullName = &#39;John Doe&#39;</code> æ—¶ï¼Œsetter ä¼šè¢«è°ƒç”¨ï¼Œ<code>vm.firstName</code> å’Œ <code>vm.lastName</code> ä¹Ÿä¼šç›¸åº”åœ°è¢«æ›´æ–°ã€‚ </p></li></ul></li><li><p>ä¾¦å¬å™¨</p><p>ä½¿ç”¨åœºæ™¯ï¼šå½“éœ€è¦åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥æˆ–å¼€é”€è¾ƒå¤§çš„æ“ä½œæ—¶ </p></li></ul><hr><ul><li><p>æ¡ä»¶æ¸²æŸ“</p><p><code>v-if</code></p></li><li><p>å±•ç¤ºå…ƒç´ </p><p><code>v-show</code>ï¼Œå®ƒåªæ˜¯ç®€å•åœ°åˆ‡æ¢å…ƒç´ çš„csså±æ€§<code>display</code></p><p>**<em>æ³¨æ„</em>ï¼š<code>v-show</code> ä¸æ”¯æŒ <code>&lt;template&gt;</code> å…ƒç´ ï¼Œä¹Ÿä¸æ”¯æŒ <code>v-else</code>ã€‚ </p><ul><li><p><code>v-if</code>vs<code>v-show</code></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>v-if</code> æœ‰æ›´é«˜çš„åˆ‡æ¢å¼€é”€ï¼Œè€Œ <code>v-show</code> æœ‰æ›´é«˜çš„åˆå§‹æ¸²æŸ“å¼€é”€ã€‚å› æ­¤ï¼Œå¦‚æœéœ€è¦éå¸¸é¢‘ç¹åœ°åˆ‡æ¢ï¼Œåˆ™ä½¿ç”¨ <code>v-show</code> è¾ƒå¥½ï¼›å¦‚æœåœ¨è¿è¡Œæ—¶æ¡ä»¶å¾ˆå°‘æ”¹å˜ï¼Œåˆ™ä½¿ç”¨ <code>v-if</code> è¾ƒå¥½ã€‚ </p></li></ul></li><li><p>åˆ—è¡¨æ¸²æŸ“</p><p><code>v-for</code></p><ul><li><p>å®ä¾‹ä¸€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul id=&quot;example-1&quot;&gt;</span><br><span class="line">  &lt;li v-for=&quot;item in items&quot;&gt;</span><br><span class="line">    &#123;&#123; item.message &#125;&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var example1 = new Vue(&#123;</span><br><span class="line">  el: &#x27;#example-1&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    items: [</span><br><span class="line">      &#123; message: &#x27;Foo&#x27; &#125;,</span><br><span class="line">      &#123; message: &#x27;Bar&#x27; &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>å®ä¾‹äºŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul id=&quot;example-2&quot;&gt;</span><br><span class="line">  &lt;li v-for=&quot;(item, index) in items&quot;&gt;</span><br><span class="line">    &#123;&#123; parentMessage &#125;&#125; - &#123;&#123; index &#125;&#125; - &#123;&#123; item.message &#125;&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var example2 = new Vue(&#123;</span><br><span class="line">  el: &#x27;#example-2&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    parentMessage: &#x27;Parent&#x27;,</span><br><span class="line">    items: [</span><br><span class="line">      &#123; message: &#x27;Foo&#x27; &#125;,</span><br><span class="line">      &#123; message: &#x27;Bar&#x27; &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥ç”¨ of æ›¿ä»£ in ä½œä¸ºåˆ†éš”ç¬¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-for=&quot;item of items&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure></li><li><p>å®ä¾‹ä¸‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">new Vue(&#123;</span><br><span class="line">  el: &#x27;#v-for-object&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    object: &#123;</span><br><span class="line">      firstName: &#x27;John&#x27;,</span><br><span class="line">      lastName: &#x27;Doe&#x27;,</span><br><span class="line">      age: 30</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul id=&quot;v-for-object&quot; class=&quot;demo&quot;&gt;</span><br><span class="line">  &lt;li v-for=&quot;value in object&quot;&gt;</span><br><span class="line">    &#123;&#123; value &#125;&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-for=&quot;(value, key) in object&quot;&gt;</span><br><span class="line">  &#123;&#123; key &#125;&#125;: &#123;&#123; value &#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-for=&quot;(value, key, index) in object&quot;&gt;</span><br><span class="line">  &#123;&#123; index &#125;&#125;. &#123;&#123; key &#125;&#125;: &#123;&#123; value &#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ•°ç»„æ›´æ–°æ£€æµ‹</p><ul><li>å˜å¼‚æ–¹æ³•ï¼Œä¼šæ”¹å˜è¢«è¿™äº›æ–¹æ³•è°ƒç”¨çš„åŸå§‹æ•°ç»„ <ul><li><code>push()</code></li><li><code>pop()</code></li><li><code>shift()</code></li><li><code>unshift()</code></li><li><code>splice()</code></li><li><code>sort()</code></li><li><code>reverse()</code></li></ul></li><li>ä¹Ÿæœ‰éå˜å¼‚ (non-mutating method) æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š<code>filter()</code>, <code>concat()</code> å’Œ <code>slice()</code> ã€‚è¿™äº›ä¸ä¼šæ”¹å˜åŸå§‹æ•°ç»„ï¼Œä½†<strong>æ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„</strong>ã€‚</li></ul><hr></li><li><p>vueç»„ä»¶å®ä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// å®šä¹‰ä¸€ä¸ªåä¸º button-counter çš„æ–°ç»„ä»¶</span><br><span class="line">Vue.component(&#x27;button-counter&#x27;, &#123;</span><br><span class="line">  data: function () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  template: &#x27;&lt;button v-on:click=&quot;count++&quot;&gt;You clicked me &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>propå¯ä»¥åœ¨ç»„ä»¶ä¸Šæ³¨å†Œçš„ä¸€äº›è‡ªå®šä¹‰ç‰¹æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&#x27;blog-post&#x27;, &#123;</span><br><span class="line">  props: [&#x27;title&#x27;],</span><br><span class="line">  template: &#x27;&lt;h3&gt;&#123;&#123; title &#125;&#125;&lt;/h3&gt;&#x27;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;blog-post title=&quot;My journey with Vue&quot;&gt;&lt;/blog-post&gt;</span><br><span class="line">&lt;blog-post title=&quot;Blogging with Vue&quot;&gt;&lt;/blog-post&gt;</span><br><span class="line">&lt;blog-post title=&quot;Why Vue is so fun&quot;&gt;&lt;/blog-post&gt;</span><br></pre></td></tr></table></figure></li><li><p>è°ƒç”¨å†…å»ºçš„ <a href="https://cn.vuejs.org/v2/api/#vm-emit"><strong>$emit</strong> æ–¹æ³•</a>å¹¶ä¼ å…¥äº‹ä»¶çš„åå­—ï¼Œæ¥å‘çˆ¶çº§ç»„ä»¶è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button v-on:click=&quot;$emit(&#x27;enlarge-text&#x27;)&quot;&gt;</span><br><span class="line">  Enlarge text</span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥ç”¨ <code>v-on</code> åœ¨åšæ–‡ç»„ä»¶ä¸Šç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œå°±åƒç›‘å¬ä¸€ä¸ªåŸç”Ÿ DOM äº‹ä»¶ä¸€æ · </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;blog-post</span><br><span class="line">...</span><br><span class="line">v-on:enlarge-text=&quot;postFontSize += 0.1&quot;</span><br><span class="line">&gt;&lt;/blog-post&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul><hr><h3 id="ç»„ä»¶æ³¨å†Œ"><a href="#ç»„ä»¶æ³¨å†Œ" class="headerlink" title="ç»„ä»¶æ³¨å†Œ"></a>ç»„ä»¶æ³¨å†Œ</h3><ul><li><p>å…¨å±€æ³¨å†Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&#x27;my-component-name&#x27;, &#123;</span><br><span class="line">  // ... é€‰é¡¹ ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>å±€éƒ¨æ³¨å†Œ</p><p>å®šä¹‰ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var ComponentA = &#123; /* ... */ &#125;</span><br><span class="line">var ComponentB = &#123; /* ... */ &#125;</span><br><span class="line">var ComponentC = &#123; /* ... */ &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">new Vue(&#123;</span><br><span class="line">el: &#x27;#app&#x27;,</span><br><span class="line">components: &#123;</span><br><span class="line">  &#x27;component-a&#x27;: ComponentA,</span><br><span class="line">  &#x27;component-b&#x27;: ComponentB</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p><strong>å…¨å±€æ³¨å†Œçš„è¡Œä¸ºå¿…é¡»åœ¨æ ¹ Vue å®ä¾‹ (é€šè¿‡ new Vue) åˆ›å»ºä¹‹å‰å‘ç”Ÿ</strong> </p><hr><h3 id="è‡ªå®šä¹‰äº‹ä»¶"><a href="#è‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰äº‹ä»¶"></a>è‡ªå®šä¹‰äº‹ä»¶</h3>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>editor</title>
      <link href="/2017/09/07/editor/"/>
      <url>/2017/09/07/editor/</url>
      
        <content type="html"><![CDATA[<h1 id="sublime"><a href="#sublime" class="headerlink" title="sublime"></a>sublime</h1><ul><li><p>å®‰è£…æ’ä»¶</p><p><code>CTRL + SHIFT + På¹¶ä¸”è¾“å…¥Package Control: Install Package  </code></p></li><li><p>htmlæ ¼å¼åŒ–</p><p><code>è¾“å…¥ï¼ï¼Œç„¶åæŒ‰ TAB</code></p></li><li><p>Pretty JSONæ’ä»¶</p><p><code>æ ¼å¼åŒ–  CTRL + ALT + J</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> editor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux snippet</title>
      <link href="/2017/05/09/linux%20snippet/"/>
      <url>/2017/05/09/linux%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h1><ul><li>/bin/    ç”¨ä»¥å­˜å‚¨äºŒè¿›åˆ¶å¯æ‰§è¡Œå‘½ä»¤æ–‡ä»¶ï¼Œ/usr/bin/ä¹Ÿå­˜å‚¨äº†ä¸€äº›åŸºäºç”¨æˆ·çš„å‘½ä»¤æ–‡ä»¶ã€‚</li><li>/sbin/    è®¸å¤šç³»ç»Ÿå‘½ä»¤çš„å­˜å‚¨ä½ç½®ï¼Œ/usr/sbin/ä¸­ä¹ŸåŒ…æ‹¬äº†è®¸å¤šå‘½ä»¤ã€‚</li><li>/root/    è¶…çº§ç”¨æˆ·ï¼Œå³æ ¹ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚</li><li>/home/    æ™®é€šç”¨æˆ·çš„é»˜è®¤ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹ï¼Œæ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ä¸€ä¸ªä»¥ç”¨æˆ·åå‘½åçš„æ–‡ä»¶å¤¹ã€‚</li><li>/boot/    å­˜æ”¾Ubuntuå†…æ ¸å’Œç³»ç»Ÿå¯åŠ¨æ–‡ä»¶ã€‚</li><li>/mnt/     é€šå¸¸åŒ…æ‹¬ç³»ç»Ÿå¼•å¯¼åè¢«æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹ã€‚</li><li>/dev/    å­˜å‚¨è®¾å¤‡æ–‡ä»¶ï¼ŒåŒ…æ‹¬è®¡ç®—æœºçš„æ‰€æœ‰å¤–éƒ¨è®¾å¤‡ï¼Œå¦‚ç¡¬ç›˜ã€æ˜¯ã€é”®ç›˜ã€é¼ æ ‡ç­‰ã€‚</li><li>/etc/    å­˜æ”¾æ–‡ä»¶ç®¡ç†é…ç½®æ–‡ä»¶å’Œç›®å½•ã€‚</li><li>/lib/    å­˜å‚¨å„ç§ç¨‹åºæ‰€éœ€è¦çš„å…±äº«åº“æ–‡ä»¶ã€‚</li><li>/lost+found/    ä¸€èˆ¬ä¸ºç©ºï¼Œå½“éæ³•å…³æœºæ—¶ï¼Œä¼šå­˜æ”¾ä¸€äº›é›¶æ•£çš„æ–‡ä»¶ã€‚</li><li>/var/    ç”¨äºå­˜æ”¾å¾ˆå¤šä¸æ–­å˜åŒ–çš„æ–‡ä»¶ï¼Œä¾‹å¦‚æ—¥å¿—æ–‡ä»¶ç­‰ã€‚</li><li>/usr/    åŒ…æ‹¬ä¸ç³»ç»Ÿç”¨æˆ·ç›´æ¥æœ‰å…³çš„æ–‡ä»¶å’Œç›®å½•</li><li>/media/    å­˜æ”¾Ubuntuç³»ç»Ÿè‡ªåŠ¨æŒ‚è½½çš„è®¾å¤‡æ–‡ä»¶ã€‚</li><li>/proc/    è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼Œå®ƒæ˜¯å†…å­˜çš„æ˜ å°„ï¼ŒåŒ…æ‹¬ç³»ç»Ÿä¿¡æ¯å’Œè¿›ç¨‹ä¿¡æ¯ã€‚</li><li>/tmp/    å­˜å‚¨ç³»ç»Ÿå’Œç”¨æˆ·çš„ä¸´æ—¶ä¿¡æ¯ã€‚</li><li>/initrd/    ç”¨æ¥åŠ è½½å¯åŠ¨æ—¶ä¸´æ—¶æŒ‚è½½çš„initrd.imgæ˜ åƒæ–‡ä»¶ï¼Œä»¥åŠè½½å…¥æ‰€è¦çš„è®¾å¤‡æ¨¡å—ç›®å½•ã€‚</li><li>/opt/    ä½œä¸ºå¯é€‰æ–‡ä»¶å’Œç¨‹åºçš„å­˜æ”¾ç›®å½•ï¼Œå¦åˆ™å°†æ— æ³•å¼•å¯¼è®¡ç®—æœºè¿›å…¥æ“ä½œç³»ç»Ÿã€‚</li><li>/srv/    å­˜å‚¨ç³»ç»Ÿæä¾›çš„æœåŠ¡æ•°æ®ã€‚</li><li>/sys/    ç³»ç»Ÿè®¾å¤‡å’Œæ–‡ä»¶å±‚æ¬¡ç»“æ„ï¼Œå¹¶å‘ç”¨æˆ·ç¨‹åºæä¾›è¯¦ç»†çš„å†…æ ¸æ•°æ®ä¿¡æ¯ã€‚</li></ul><h1 id="point"><a href="#point" class="headerlink" title="point"></a>point</h1><h2 id="native-lib-config"><a href="#native-lib-config" class="headerlink" title="native lib config"></a>native lib config</h2><ul><li><code>/lib</code> contain â€œessentialâ€ libraries that may be needed even in single-user (admin-only) mode and without /usr mounted</li><li><code>/usr/lib</code> are the libraries for the normal user-programs, that mostly can be found under /usr.</li><li><code>/usr/local/lib</code> are the libraries for locally installed programs and packages ie. things youâ€™ve compiled and installed from source-packages yourself.</li></ul><h2 id="shell-and-export"><a href="#shell-and-export" class="headerlink" title="shell and export"></a>shell and export</h2><p>ç”¨æˆ·ç™»å½•åˆ°Linuxç³»ç»Ÿåï¼Œç³»ç»Ÿå°†å¯åŠ¨ä¸€ä¸ªç”¨æˆ·shellã€‚åœ¨è¿™ä¸ªshellä¸­ï¼Œå¯ä»¥ä½¿ç”¨shellå‘½ä»¤æˆ–å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå¹¶è¿è¡Œ shellè„šæœ¬ç¨‹åºã€‚è¿è¡Œshellè„šæœ¬ç¨‹åºæ—¶ï¼Œç³»ç»Ÿå°†åˆ›å»ºä¸€ä¸ªå­shellã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿä¸­å°†æœ‰ä¸¤ä¸ªshellï¼Œä¸€ä¸ªæ˜¯ç™»å½•æ—¶ç³»ç»Ÿå¯åŠ¨çš„shellï¼Œå¦ä¸€ ä¸ªæ˜¯ç³»ç»Ÿä¸ºè¿è¡Œè„šæœ¬ç¨‹åºåˆ›å»ºçš„shellã€‚å½“ä¸€ä¸ªè„šæœ¬ç¨‹åºè¿è¡Œå®Œæ¯•ï¼Œå®ƒçš„è„šæœ¬shellå°†ç»ˆæ­¢ï¼Œå¯ä»¥è¿”å›åˆ°æ‰§è¡Œè¯¥è„šæœ¬ä¹‹å‰çš„shellã€‚ä»è¿™ç§æ„ä¹‰ä¸Šæ¥ è¯´ï¼Œç”¨æˆ·å¯ä»¥æœ‰è®¸å¤š shellï¼Œæ¯ä¸ªshelléƒ½æ˜¯ç”±æŸä¸ªshellï¼ˆç§°ä¸ºçˆ¶shellï¼‰æ´¾ç”Ÿçš„ã€‚</p><p>åœ¨å­ shellä¸­å®šä¹‰çš„å˜é‡åªåœ¨è¯¥å­shellå†…æœ‰æ•ˆã€‚å¦‚æœåœ¨ä¸€ä¸ªshellè„šæœ¬ç¨‹åºä¸­å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå½“è¯¥è„šæœ¬ç¨‹åºè¿è¡Œæ—¶ï¼Œè¿™ä¸ªå®šä¹‰çš„å˜é‡åªæ˜¯è¯¥è„šæœ¬ç¨‹åºå†… çš„ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå…¶ä»–çš„shellä¸èƒ½å¼•ç”¨å®ƒï¼Œè¦ä½¿æŸä¸ªå˜é‡çš„å€¼å¯ä»¥åœ¨å…¶ä»–shellä¸­è¢«æ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨exportå‘½ä»¤å¯¹å·²å®šä¹‰çš„å˜é‡è¿›è¡Œè¾“å‡ºã€‚ exportå‘½ä»¤å°†ä½¿ç³»ç»Ÿåœ¨åˆ›å»ºæ¯ä¸€ä¸ªæ–°çš„shellæ—¶å®šä¹‰è¿™ä¸ªå˜é‡çš„ä¸€ä¸ªæ‹·è´ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºå˜é‡è¾“å‡ºã€‚</p><ul><li><p>æ“ä½œæ–‡ä»¶åä¸­å«æœ‰â€œ-â€çš„æ–‡ä»¶</p><p>ä½¿ç”¨è½¬ç§»å­—ç¬¦ â€œâ€“â€ï¼Œ æ¯”å¦‚æŸ¥çœ‹æ–‡ä»¶â€œ-abc.txtâ€œï¼Œå‘½ä»¤ä¸º <code>vim -- -abc.txt</code></p></li><li><p><code>/etc/environment</code>æ˜¯è®¾ç½®æ•´ä¸ªç³»ç»Ÿçš„ç¯å¢ƒï¼Œè€Œ<code>/etc/profile</code>æ˜¯è®¾ç½®æ‰€æœ‰ç”¨æˆ·çš„ç¯å¢ƒ </p></li></ul><h2 id="KVM"><a href="#KVM" class="headerlink" title="KVM"></a>KVM</h2><p>KVM çš„å…¨ç§°æ˜¯ï¼šKernel-based Virtual Machineï¼Œç®€å•ä¸€å¥è¯æ¦‚æ‹¬ï¼Œå°±æ˜¯ä¸€ä¸ªåŸºäº Linux å†…æ ¸çš„è™šæ‹ŸåŒ–ç®¡ç†ç³»ç»Ÿã€‚</p><h2 id="java-config"><a href="#java-config" class="headerlink" title="java config"></a>java config</h2><ul><li>use <code>java -XshowSettings:properties</code> to show the java.library.path (and others) value.</li></ul><h1 id="practice"><a href="#practice" class="headerlink" title="practice"></a>practice</h1><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><ol><li><p>è¿›å…¥ç›®å½•<code> /root/.ssh</code></p></li><li><p>æ‰§è¡Œå‘½ä»¤ï¼š<code>ssh-keygen -t rsa</code>ï¼Œä¼šç”Ÿæˆæ–‡ä»¶id_rsaå’Œid_rsa.pub</p></li><li><p>å°†å…¬é’¥å†™å…¥æ–‡ä»¶ authorized_keysï¼Œ<code>cat id_rsa.pub &gt;&gt; authorized_keys</code></p></li><li><p>åœ¨å…¶å®ƒæœºå™¨é‡å¤ä¸Šè¿°æ“ä½œ</p></li><li><p>å°†å…¶å®ƒæœºå™¨çš„å…¬é’¥æ‹·è´åˆ°ç¬¬ä¸€å°æœºå™¨çš„authorized_keysæ–‡ä»¶ä¸­</p><p><code>ssh-copy-id -i id_rsa.pub ç”¨æˆ·@ip</code></p><blockquote><p>æ³¨æ„ï¼Œä¸€å®šä¸è¦ä½¿ç”¨å¤åˆ¶æ‹·è´çš„æ–¹å¼æŠŠå…¬é’¥å¤åˆ¶åˆ°authorized_keysæ–‡ä»¶ä¸­ï¼Œå› ä¸ºå¤åˆ¶çš„æ—¶å€™ä¼šæœ‰ç‰¹æ®Šå­—ç¬¦çš„åŠ å…¥ï¼Œå¯ä»¥åœ¨vimä¸­ä½¿ç”¨<code>:set list</code>è¿›è¡ŒéªŒè¯</p></blockquote></li><li><p>å°†ç¬¬ä¸€å°æœºå™¨çš„authorized_keyså¤åˆ¶åˆ°å…¶å®ƒæœºå™¨ä¸Š</p><p><code>scp authorized_keys ç”¨æˆ·@ip:/è·¯å¾„/.ssh/</code></p><p>æ³¨æ„ç‚¹</p></li></ol><ul><li>authorized_keys çš„æƒé™æ˜¯600ï¼Œå³è¯»å’Œå†™ï¼ˆå¦‚æœé»˜è®¤ä¸æ˜¯çš„è¯ï¼Œéœ€è¦ä¿®æ”¹ï¼‰</li></ul><h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -x &lt;shellName&gt;</span><br></pre></td></tr></table></figure><h1 id="troubleshoot"><a href="#troubleshoot" class="headerlink" title="troubleshoot"></a>troubleshoot</h1><h2 id="vmware-centos-ip-config"><a href="#vmware-centos-ip-config" class="headerlink" title="vmware centos ip config"></a>vmware centos ip config</h2><ol><li><code> vi /etc/sysconfig/network-scripts/ifcfg-ens33</code>,è®¾ç½®<code>ONBOOT=yes</code></li><li><code>service network restart </code></li><li><code>ip a</code>æŸ¥çœ‹ip</li></ol><h2 id="ç•Œé¢å¡æ­»"><a href="#ç•Œé¢å¡æ­»" class="headerlink" title="ç•Œé¢å¡æ­»"></a>ç•Œé¢å¡æ­»</h2><ol><li><p>ä½¿ç”¨ Ctrl+Alt+F1æˆ–F2æˆ–åˆ°F6ï¼Œè¿›å…¥ttyç»ˆç«¯ï¼ˆè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼‰</p></li><li><p>æ‰§è¡Œå‘½ä»¤æ³¨é”€æ¡Œé¢é‡æ–°ç™»å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pkill Xorg</span><br><span class="line">æˆ–</span><br><span class="line">sudo restart lightdm</span><br></pre></td></tr></table></figure></li></ol><h2 id="è£…æœºé—®é¢˜"><a href="#è£…æœºé—®é¢˜" class="headerlink" title="è£…æœºé—®é¢˜"></a>è£…æœºé—®é¢˜</h2><ul><li>Wifi Not Enabled Acer Aspire 4750</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">~$</span><span class="bash"> rfkill list all</span></span><br><span class="line">0: phy0: Wireless LAN</span><br><span class="line">Soft blocked: no</span><br><span class="line">Hard blocked: yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">~$</span><span class="bash"> sudo rmmod acer-wmi</span></span><br><span class="line">â€‹```</span><br><span class="line"></span><br><span class="line">add below line at the end of the file : /etc/modprobe.d/blacklist.conf</span><br><span class="line">blacklist acer-wmi</span><br><span class="line"></span><br><span class="line">Then restart the system.</span><br><span class="line"><span class="meta">~$</span><span class="bash"> rfkill list all</span></span><br><span class="line">0: phy0: Wireless LAN</span><br><span class="line">Soft blocked: no</span><br><span class="line">Hard blocked: no</span><br></pre></td></tr></table></figure><h2 id="æœºå™¨æ‰çº¿"><a href="#æœºå™¨æ‰çº¿" class="headerlink" title="æœºå™¨æ‰çº¿"></a>æœºå™¨æ‰çº¿</h2><h3 id="ç½‘å¡æ‰çº¿"><a href="#ç½‘å¡æ‰çº¿" class="headerlink" title="ç½‘å¡æ‰çº¿"></a>ç½‘å¡æ‰çº¿</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">ip a</span><br><span class="line">cat /etc/netplan/xxx.yaml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> resolve</span></span><br><span class="line">vim /etc/netplan/xxx.yaml</span><br><span class="line">netplan --debug apply</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux network command</title>
      <link href="/2017/05/09/linux%20cmd:%20network/"/>
      <url>/2017/05/09/linux%20cmd:%20network/</url>
      
        <content type="html"><![CDATA[<h1 id="port"><a href="#port" class="headerlink" title="port"></a>port</h1><ul><li><p>Check the listening ports</p><p>Run any one of the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i -P -n | grep LISTEN </span><br><span class="line">sudo netstat -tulpn | grep LISTEN</span><br><span class="line">sudo nmap -sTU -O IP-address-Here</span><br></pre></td></tr></table></figure></li><li><p>checking <strong>remote system</strong> tcp 80 port status</p><ol><li><p>Telnet</p></li><li><p>nc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> nc -zvw10 192.168.0.1 22</span><br><span class="line">å…¶ä¸­å‚æ•°ï¼š</span><br><span class="line">z: zero-I/O mode which is used for scanning</span><br><span class="line">v: for verbose output</span><br><span class="line">w10: timeout wait seconds</span><br></pre></td></tr></table></figure></li></ol></li></ul><ol start="3"><li>nmap<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">telnet myserver.com 80 </span><br><span class="line">nc -v myserver.com 80</span><br><span class="line">nc -vn 192.168.40.146 2424</span><br><span class="line">nmap myserver.com 80 </span><br></pre></td></tr></table></figure></li></ol><ul><li>é€šè¿‡è¿›ç¨‹åæŸ¥çœ‹å ç”¨ç«¯å£<ul><li><p>å…ˆæŸ¥çœ‹è¿›ç¨‹pid    <code>ps -ef | grep è¿›ç¨‹å </code></p></li><li><p>å†é€šè¿‡pidæŸ¥çœ‹å ç”¨ç«¯å£  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -nap | grep &lt;pid&gt;</span><br><span class="line">lsof -p &lt;pid&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li>é€šè¿‡ç«¯å£æŸ¥çœ‹è¿›ç¨‹<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -an | grep &lt;portnumber&gt;</span><br><span class="line">lsof -i:&lt;portnumber&gt;</span><br></pre></td></tr></table></figure></li></ul><h1 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h1><ul><li><p>æ ¹æ®è¿›ç¨‹å·æŸ¥çœ‹å¯åŠ¨æ–‡ä»¶æ‰€åœ¨ä½ç½®</p><p><code>readlink /proc/&lt;çº¿ç¨‹ID&gt;/exe</code></p></li><li><p>æŸ¥çœ‹è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤</p><p><code>cat /proc/&lt;çº¿ç¨‹ID&gt;/cmdline</code></p></li><li><p>æ ¹æ®PIDæŸ¥çœ‹å­è¿›ç¨‹</p><p><code>netstat -lntp |grep PID</code></p></li></ul><h1 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h1><ul><li><p>æŸ¥çœ‹æœ¬åœ°ç½‘ç»œä»£ç†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export | grep -i proxy</span><br></pre></td></tr></table></figure></li><li><p>å…³é—­ä»£ç†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unset http_proxy </span><br></pre></td></tr></table></figure></li></ul><h1 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h1><ul><li><p>pretty json </p><p><code>curl &#39;address:port&#39; | json_pp</code></p></li></ul><h1 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h1><p>æ£€æµ‹ç«¯å£æ˜¯å¦å…è®¸è¿œç¨‹è®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">netstat -an | grep &lt;port&gt;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¾“å‡ºç»“æœã€‚å¦‚æœè¾“å‡ºç»“æœä¸­æœ‰ 0.0.0.0:&lt;port&gt; æˆ–è€… :::&lt;port&gt;ï¼Œè¡¨ç¤ºè¯¥ç«¯å£å…è®¸è¿œç¨‹è®¿é—®ï¼›</span><br><span class="line">å¦‚æœè¾“å‡ºç»“æœä¸­åªæœ‰ 127.0.0.1:&lt;port&gt; æˆ–è€… ::1:&lt;port&gt;ï¼Œè¡¨ç¤ºè¯¥ç«¯å£åªå…è®¸æœ¬åœ°è®¿é—®</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp       0     82   172.30.14.126:2355    172.30.14.126:8772     ESTABLISHED 2057039/dingo-fuse</span><br><span class="line">          â”‚     â”‚           â”‚                       â”‚                      â”‚              â”‚</span><br><span class="line">          â”‚     â”‚           â”‚                       â”‚                      â”‚              â””â”€â”€ Process using connection</span><br><span class="line">          â”‚     â”‚           â”‚                       â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TCP state</span><br><span class="line">          â”‚     â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TCP send buffer</span><br><span class="line">          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TCP receive buffer</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>Position</strong></th><th><strong>Meaning</strong></th></tr></thead><tbody><tr><td>First 2355 (local)</td><td>The port the <strong>local process (dingo-fuse)</strong> is listening on (server side)</td></tr><tr><td>Second 8772 (remote)</td><td>The port used by the <strong>client side</strong> of the connection (also dingo-fuse)</td></tr></tbody></table><ul><li>åœ¨ Ubuntu ä¸­ï¼Œè¦å¼€å¯æŒ‡å®šç«¯å£çš„è¿œç¨‹è®¿é—®ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</li></ul><ol><li><p>ç¡®è®¤ç«¯å£æ˜¯å¦å·²ç»å¼€å¯ï¼šä½¿ç”¨ <code>netstat</code> å‘½ä»¤æ£€æŸ¥è¦å¼€å¯çš„ç«¯å£æ˜¯å¦å·²ç»åœ¨ç›‘å¬çŠ¶æ€ã€‚å¦‚æœå·²ç»åœ¨ç›‘å¬çŠ¶æ€ï¼Œåˆ™å¯ä»¥ç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼›å¦‚æœæ²¡æœ‰åœ¨ç›‘å¬çŠ¶æ€ï¼Œåˆ™éœ€è¦å…ˆå¯åŠ¨å¯¹åº”çš„æœåŠ¡ç¨‹åºã€‚</p></li><li><p>ä¿®æ”¹é˜²ç«å¢™è§„åˆ™ï¼šä½¿ç”¨ <code>ufw</code> å‘½ä»¤ä¿®æ”¹é˜²ç«å¢™è§„åˆ™ï¼Œå¼€æ”¾æŒ‡å®šç«¯å£ã€‚ä¾‹å¦‚ï¼Œè¦å¼€æ”¾ç«¯å£å·ä¸º 80 çš„ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 80/tcp</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šå°†ç«¯å£å·ä¸º 80 çš„ç«¯å£åŠ å…¥åˆ°é˜²ç«å¢™è§„åˆ™ä¸­ï¼Œå¹¶å…è®¸ TCP åè®®é€šè¿‡è¯¥ç«¯å£è¿›è¡Œè®¿é—®ã€‚</p></li><li><p>é‡å¯é˜²ç«å¢™æœåŠ¡ï¼šåœ¨ä¿®æ”¹é˜²ç«å¢™è§„åˆ™åï¼Œéœ€è¦é‡å¯é˜²ç«å¢™æœåŠ¡æ‰èƒ½ä½¿ä¿®æ”¹ç”Ÿæ•ˆã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡å¯é˜²ç«å¢™æœåŠ¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ufw restart</span><br></pre></td></tr></table></figure></li><li><p>ç¡®è®¤é˜²ç«å¢™è§„åˆ™æ˜¯å¦æ­£ç¡®ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰çš„é˜²ç«å¢™è§„åˆ™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status numbered</span><br></pre></td></tr></table></figure></li></ol><h1 id="subnet-mask"><a href="#subnet-mask" class="headerlink" title="subnet mask"></a>subnet mask</h1><blockquote><p>å­ç½‘æ©ç </p></blockquote><p>xx.xx.xx.xx/24</p><p>åœ¨ç½‘ç»œä¸­ï¼ŒIPåœ°å€ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€ã€‚IPåœ°å€çš„ç½‘ç»œéƒ¨åˆ†ç”¨äºæ ‡è¯†ç½‘ç»œï¼Œè€Œä¸»æœºéƒ¨åˆ†ç”¨äºæ ‡è¯†ç‰¹å®šçš„è®¾å¤‡æˆ–ä¸»æœºã€‚</p><p>CIDRï¼ˆæ— ç±»åˆ«åŸŸé—´è·¯ç”±ï¼‰è¡¨ç¤ºæ³•é€šå¸¸ç”¨äºæŒ‡å®šIPåœ°å€çš„å­ç½‘æ©ç ï¼Œä»¥ç¡®å®šç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€çš„è¾¹ç•Œã€‚CIDRè¡¨ç¤ºæ³•ä½¿ç”¨æ–œçº¿åé¢çš„æ•°å­—æ¥è¡¨ç¤ºç½‘ç»œåœ°å€ä¸­å‰å¤šå°‘ä½æ˜¯å›ºå®šçš„ï¼Œå³ç½‘ç»œå‰ç¼€é•¿åº¦ã€‚ä¾‹å¦‚ï¼Œ/24 è¡¨ç¤ºå‰ 24 ä½æ˜¯ç½‘ç»œåœ°å€ï¼Œå‰©ä¸‹çš„ 8 ä½åˆ™æ˜¯ä¸»æœºåœ°å€ã€‚</p><p>å¯¹äº IPv4 åœ°å€ï¼Œæ¯ä¸ª IP åœ°å€éƒ½ç”± 32 ä½äºŒè¿›åˆ¶æ•°è¡¨ç¤ºã€‚é€šè¿‡å°†å‰ 24 ä½ä½œä¸ºç½‘ç»œåœ°å€å¹¶ä¿ç•™æœ€å 8 ä½ä½œä¸ºä¸»æœºåœ°å€ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å« 256 ä¸ªå¯èƒ½ä¸»æœºåœ°å€çš„ç½‘ç»œã€‚è¿™è¢«ç§°ä¸º â€œ24 ä½ç½‘ç»œâ€ æˆ– â€œ24 ä½å­ç½‘â€ï¼Œå®ƒçš„å­ç½‘æ©ç æ˜¯ 255.255.255.0ã€‚</p><p>å› æ­¤ï¼Œå½“ä½ é…ç½®ä¸€ä¸ª IP åœ°å€å¹¶æ·»åŠ  /24 åç¼€æ—¶ï¼Œä½ æ­£åœ¨æŒ‡å®šè¯¥åœ°å€æ‰€å±çš„ç½‘ç»œå’Œå­ç½‘æ©ç ã€‚è¿™æ ·å¯ä»¥å¸®åŠ©ç¡®å®šè¯¥åœ°å€æ‰€åœ¨çš„ç½‘ç»œï¼Œå¹¶ç¡®ä¿ä¸å…¶ä»–è®¾å¤‡è¿›è¡Œé€šä¿¡æ—¶ï¼Œæ•°æ®åŒ…èƒ½å¤Ÿæ­£ç¡®åœ°è·¯ç”±åˆ°ç›®æ ‡è®¾å¤‡ã€‚</p><h1 id="route"><a href="#route" class="headerlink" title="route"></a>route</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check existed ip route</span></span><br><span class="line">ip route</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete specify ip route</span></span><br><span class="line">sudo ip route del 172.21.0.0/16</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete specify ip link</span></span><br><span class="line">sudo ip link delete br-900457b8a29e</span><br></pre></td></tr></table></figure><h1 id="bond"><a href="#bond" class="headerlink" title="bond"></a>bond</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check bond slave</span></span><br><span class="line">cat /proc/net/bonding/bond0</span><br></pre></td></tr></table></figure><h1 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h1><blockquote><p>The tcpdump command is a powerful command-line packet analyzer (network sniffer) used to capture and inspect network traffic in real-time on Unix-like systems. Itâ€™s widely used by system admins, network engineers, and security professionals for troubleshooting, diagnostics, and security analysis.</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Capture HTTP traffic</span></span><br><span class="line">sudo tcpdump -i eth0 tcp port 80</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Monitor Specific Communication</span></span><br><span class="line">sudo tcpdump -i eth0 host 192.168.1.10 and port 22</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Capture packets between two hosts</span></span><br><span class="line">sudo tcpdump -i eth0 src host 192.168.1.10 and dst host 192.168.1.20</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  Capture to a File (and Analyze Later)</span></span><br><span class="line">sudo tcpdump -i eth0 -w capture.pcap</span><br><span class="line">wireshark capture.pcap</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cache snippet</title>
      <link href="/2017/03/07/cache%20snippet/"/>
      <url>/2017/03/07/cache%20snippet/</url>
      
        <content type="html"><![CDATA[<ul><li>what is cache ?    why use cache ?<ol><li>Cacheæ˜¯é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨å™¨å­ç³»ç»Ÿï¼Œå…¶ä¸­å¤åˆ¶äº†é¢‘ç¹ä½¿ç”¨çš„æ•°æ®ä»¥åˆ©äºå¿«é€Ÿè®¿é—®</li><li>å‡¡æ˜¯ä½äºé€Ÿåº¦ç›¸å·®è¾ƒå¤§çš„ä¸¤ç§ç¡¬ä»¶/è½¯ä»¶ä¹‹é—´çš„ï¼Œç”¨äºåè°ƒä¸¤è€…æ•°æ®ä¼ è¾“é€Ÿåº¦å·®å¼‚çš„ç»“æ„ï¼Œå‡å¯ç§°ä¹‹ä¸º Cache </li></ol></li><li>ç¼“å­˜çš„åˆ†ç±»<ul><li>æ“ä½œç³»ç»Ÿç£ç›˜ç¼“å­˜-&gt;å‡å°‘ç£ç›˜æœºæ¢°æ“ä½œ</li><li>æ•°æ®åº“ç¼“å­˜-&gt;å‡å°‘æ–‡ä»¶ç³»ç»ŸI/O</li><li>åº”ç”¨ç¨‹åºç¼“å­˜-&gt;å‡å°‘å¯¹æ•°æ®åº“çš„æŸ¥è¯¢ </li><li>WebæœåŠ¡å™¨ç¼“å­˜-&gt;å‡å°‘åº”ç”¨æœåŠ¡å™¨è¯·æ±‚</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨ç¼“å­˜-&gt;å‡å°‘å¯¹ç½‘ç«™çš„è®¿é—®</li></ul></li></ul><h3 id="æŠ€æœ¯æ¡†æ¶"><a href="#æŠ€æœ¯æ¡†æ¶" class="headerlink" title="æŠ€æœ¯æ¡†æ¶"></a>æŠ€æœ¯æ¡†æ¶</h3><ul><li><strong>Encache</strong><ul><li>è®¾è®¡äºæé«˜åœ¨æ•°æ®ä»RDBMSä¸­å–å‡ºæ¥çš„é«˜èŠ±è´¹ã€é«˜å»¶è¿Ÿé‡‡å–çš„ä¸€ç§ç¼“å­˜æ–¹æ¡ˆ </li><li>javaç¼–å†™ï¼Œç›´æ¥åœ¨jvmè™šæ‹Ÿæœºä¸­ç¼“å­˜ï¼Œé€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜ï¼›ä½†æ˜¯ç¼“å­˜å…±äº«éº»çƒ¦ï¼Œé›†ç¾¤åˆ†å¸ƒå¼åº”ç”¨ä¸æ–¹ä¾¿ã€‚</li><li>ç‰¹ç‚¹ï¼š<ul><li>å¿«</li><li>ç®€å•</li><li>è¢–ç</li><li>è½»é‡</li><li>æ‰©å±•</li><li>ç›‘å¬å™¨</li></ul></li></ul></li><li><strong>memcache</strong><ul><li>ä¸€ç§é«˜æ€§èƒ½ã€åˆ†å¸ƒå¼å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œæœ€åˆè®¾è®¡äºç¼“è§£åŠ¨æ€ç½‘ç«™æ•°æ®åº“åŠ è½½æ•°æ®çš„å»¶è¿Ÿæ€§ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¤§çš„å†…å­˜HashTableï¼Œå°±æ˜¯ä¸€ä¸ªkey-valueé”®å€¼ç¼“å­˜ã€‚</li><li>Cè¯­è¨€ç¼–å†™</li><li>ç‰¹ç‚¹ï¼š<ul><li>ä¾èµ–</li><li>å¤šçº¿ç¨‹æ”¯æŒ</li><li>é«˜æ€§èƒ½</li></ul></li></ul></li><li><strong>redis</strong><ul><li>é€šè¿‡socketè®¿é—®åˆ°ç¼“å­˜æœåŠ¡ï¼Œæ•ˆç‡æ¯”encacheä½ï¼Œæ¯”æ•°æ®åº“è¦å¿«å¾ˆå¤šï¼Œå¤„ç†é›†ç¾¤å’Œåˆ†å¸ƒå¼ç¼“å­˜æ–¹ä¾¿ï¼Œæœ‰æˆç†Ÿçš„æ–¹æ¡ˆã€‚</li><li>ç‰¹æ€§ï¼š<ul><li>æ”¯æŒæŒä¹…åŒ–</li><li>ä¸°å¯Œçš„æ•°æ®ç±»å‹</li><li>é«˜æ€§èƒ½</li><li>ä¸»ä»å¤åˆ¶</li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> cache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jetbrains</title>
      <link href="/2016/12/16/jetbrains%20idea/"/>
      <url>/2016/12/16/jetbrains%20idea/</url>
      
        <content type="html"><![CDATA[<h1 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h1><h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><ul><li><p>å‚ç…§<a href="https://blog.csdn.net/q547550831/article/details/79129311">ä¸€å¤§å¨æ’ä»¶</a></p></li><li><p>ç°åœ¨å·²å®‰è£…çš„æ’ä»¶ï¼š</p><ul><li>Translation(ç¿»è¯‘å·¥å…·)</li><li>CheckStyle-IDEAï¼ˆä»£ç è§„èŒƒï¼‰</li><li>FindBugs-IDEA(é™æ€åˆ†æå·¥å…·)</li><li>BashSupportï¼ˆLinux Bashæ”¯æŒï¼Œå¯¹bashè¯­æ³•çš„é«˜äº®æ”¯æŒï¼‰</li><li>CodeGlanceï¼ˆç±»ä¼¼SublimeTextçš„Mini Mapæ’ä»¶ ï¼‰</li><li>Key promoterï¼ˆæç¤ºåŠŸèƒ½å¿«æ·é”®ï¼‰</li><li>GsonFormatï¼ˆæš‚æœªå®‰è£…ï¼Œå…¶åŠŸèƒ½ä¸ºæŠŠjsonæ ¼å¼çš„å†…å®¹è½¬æˆObjectï¼‰</li><li>jRebelï¼ˆæš‚æœªå®‰è£…ï¼Œçƒ­éƒ¨ç½²æ’ä»¶ï¼‰</li></ul></li><li><p><strong>scratchesè‰ç¨¿åŠŸèƒ½</strong></p><ul><li><p>å‚ç…§<a href="https://blog.csdn.net/theape/article/details/70194185">å¼ºå¤§çš„è‰ç¨¿åŠŸèƒ½</a></p></li><li><p>scratchä¸­æ–‡ä¹±ç è§£å†³åŠæ³•</p><p>éœ€è¦åœ¨<code>C:\Users\Administrator\.IntelliJIdea2019.1\config</code>ä¸­ä¿®æ”¹æ–‡ä»¶<code>idea64.exe.vmoptions</code>,åœ¨åé¢åŠ ä¸Šè®¾ç½®<code>-Dfile.encoding=UTF-8</code></p></li></ul></li><li><p>**Lombok **æ’ä»¶</p><p>æé«˜ç¼–ç æ•ˆç‡</p></li></ul><h2 id="ä¸­æ–‡ç¼–ç é…ç½®"><a href="#ä¸­æ–‡ç¼–ç é…ç½®" class="headerlink" title="ä¸­æ–‡ç¼–ç é…ç½®"></a>ä¸­æ–‡ç¼–ç é…ç½®</h2><ul><li>æœ‰å…³Propertiesæ–‡ä»¶ä¸­çš„ä¸­æ–‡unicodeè½¬ç é—®é¢˜åœ¨IDEAä¸­åˆ›å»ºäº†propertiesæ–‡ä»¶ï¼Œå‘ç°é»˜è®¤ä¸­æ–‡ä¸ä¼šè‡ªåŠ¨è¿›è¡Œunicodeè½¬ç ï¼Œéœ€è¦é…ç½®<img src="https://i.imgur.com/W2a0nMR.jpg"></li></ul><h2 id="grep-console"><a href="#grep-console" class="headerlink" title="grep console"></a>grep console</h2><ul><li>å»æ‰æŒ‡å®šæ—¥å¿—çº§åˆ«æ˜¾ç¤º<img src=""></li></ul><h1 id="keymap"><a href="#keymap" class="headerlink" title="keymap"></a>keymap</h1><h3 id="å¸¸ç”¨"><a href="#å¸¸ç”¨" class="headerlink" title="å¸¸ç”¨"></a>å¸¸ç”¨</h3><ul><li>ctrl + P<br>åˆ—å‡ºå‚æ•°åˆ—è¡¨ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤š ï¼‰</li><li>ctrl + shift + enter<br>å½“åœ¨æ‹¬å·é‡Œè¾“å…¥å®Œæœ€åä¸€ä¸ªå‚æ•°æ—¶å€™ä»–ä¼šç›´æ¥å…‰æ ‡è·³åˆ°æœ€åå¹¶ä¸”æ·»åŠ åˆ†å·ï¼Œä¸éœ€è¦è‡ªå·±æŒ‰å‘å·¦é”®ç§»åŠ¨å…‰æ ‡ã€‚ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤š ï¼‰<br>ctrl + enter å‘ä¸‹æ’å…¥ä¸€è¡Œï¼Œå…‰æ ‡ä½ç½®ä¸å˜</li><li>shift + enter<br>å‘ä¸‹æ’å…¥ä¸€è¡Œã€‚å…‰æ ‡ä½ç½®è¿›å…¥ä¸‹ä¸€è¡Œï¼ˆå¯ä»¥åœ¨ä¸€è¡Œçš„ä»»ä½•ä½ç½®æ¢è¡Œï¼Œè€Œä¸å¿…å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾ï¼Œä½¿ç”¨æ¯”è¾ƒå¤šï¼‰</li><li>ctrl+left/right<br>åœ¨å•è¯é—´è·³åŠ¨å…‰æ ‡ï¼ŒåŸºæœ¬åœ¨æ‰€æœ‰çš„ç¼–è¾‘å™¨ä¸­éƒ½æ˜¯é€‚ç”¨ ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤š ï¼‰</li><li>ctr+shitf+left/right<br>å¿«é€Ÿé€‰ä¸­ï¼ŒåŸºæœ¬åœ¨æ‰€æœ‰çš„ç¼–è¾‘å™¨ä¸­éƒ½æ˜¯é€‚ç”¨ï¼ˆshifté€‰ä¸­ï¼Œctrl+left/rightåœ¨å•è¯ä¸­å¿«é€Ÿè·³åŠ¨ï¼Œä½¿ç”¨æ¯”è¾ƒå¤š ï¼‰</li><li>Alt+left/rightï¼Œåˆ‡æ¢ä»£ç è§†å›¾ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤š ï¼‰</li><li>Alt+Up/Downï¼Œåœ¨æ–¹æ³•é—´å¿«é€Ÿç§»åŠ¨å®šä½ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤š ï¼‰</li><li>F2 æˆ– Shift+F2ï¼Œé«˜äº®é”™è¯¯æˆ–è­¦å‘Šå¿«é€Ÿå®šä½ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤šï¼‰</li><li>Ctrl+Alt+T<br>å¯ä»¥æŠŠä»£ç åŒ…åœ¨ä¸€ä¸ªå—å†…ï¼Œä¾‹å¦‚ï¼štry/catchï¼ˆä½¿ç”¨æ¯”è¾ƒå¤š ï¼‰</li><li>Ctrl+Fï¼Œå¤„äºæŸ¥æ‰¾çŠ¶æ€ä¸‹æŒ‰downå‘ä¸‹æŸ¥æ‰¾ï¼Œupå‘ä¸ŠæŸ¥æ‰¾ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤šï¼‰</li><li>Ctrl+F12ï¼Œå¯ä»¥æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„ç»“æ„ï¼ˆå¿«é€ŸæŸ¥æ‰¾å½“å‰ç±»ä¸­æŸä¸ªæ–¹æ³•ï¼Œä½¿ç”¨æ¯”è¾ƒå¤šï¼‰</li><li>Ctrl+Shift+Wï¼Œå–æ¶ˆé€‰æ‹©å…‰æ ‡æ‰€åœ¨è¯ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤šï¼‰</li><li>Ctrl+[ OR ]ï¼Œå¯ä»¥è·‘åˆ°å¤§æ‹¬å·çš„å¼€å¤´ä¸ç»“å°¾</li><li>Ctrl+Shift +[ OR ]ï¼Œé€‰æ‹©å¤§æ‹¬å·ä¸­çš„å†…å®¹</li><li>alt + 1 åŒä¸Šï¼ˆåœ¨å·¥ç¨‹ç›®å½•å’Œç¼–è¾‘é¡µé¢é—´åˆ‡æ¢ï¼Œä½¿ç”¨æ¯”è¾ƒå¤šï¼‰</li><li>Ctrl+Alt+Oï¼Œä¼˜åŒ–å¯¼å…¥çš„ç±»å’ŒåŒ…(å»æ‰æ²¡æœ‰ä½¿ç”¨çš„importï¼Œä½¿ç”¨æ¯”è¾ƒå¤š )</li><li>Shift+F6ï¼Œé‡æ„ - é‡å‘½åï¼ˆä½¿ç”¨æ¯”è¾ƒå¤š ï¼‰</li><li>Ctrl+Gï¼Œå®šä½è¡Œ</li><li>Ctrl+Hï¼Œæ˜¾ç¤ºç±»ç»“æ„å›¾ï¼ˆç±»çš„ç»§æ‰¿å±‚æ¬¡ï¼‰</li><li>Ctrl+Uï¼Œè½¬åˆ°çˆ¶ç±»</li><li>Ctrl+â€+/-â€œï¼Œå½“å‰æ–¹æ³•å±•å¼€ã€æŠ˜å </li><li>Ctrl+Shift+â€+/-â€œï¼Œå…¨éƒ¨å±•å¼€ã€æŠ˜å </li><li>Ctrl+Shift+Jï¼Œæ•´åˆä¸¤è¡Œ</li><li>ctrl + shift + space<br>å½“new ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå·²ç»å†™äº†å˜é‡ç±»å‹ï¼Œæ‰“äº†ç­‰å·ä¹‹åæŒ‰è¿™ä¸ªå¯ä»¥å¿«é€Ÿå®Œæˆã€‚</li></ul><hr><h2 id="Compile-and-Run"><a href="#Compile-and-Run" class="headerlink" title="Compile and Run"></a>Compile and Run</h2><p><a href="https://imgchr.com/i/nRX0JI"><img src="https://s2.ax1x.com/2019/09/16/nRX0JI.jpg" alt="nRX0JI.jpg"></a></p><h2 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h2><p><a href="https://imgchr.com/i/nRXhYn"><img src="https://s2.ax1x.com/2019/09/16/nRXhYn.jpg" alt="nRXhYn.jpg"></a></p><h2 id="Editing"><a href="#Editing" class="headerlink" title="Editing"></a>Editing</h2><p><a href="https://imgchr.com/i/nRXwFA"><img src="https://s2.ax1x.com/2019/09/16/nRXwFA.jpg" alt="nRXwFA.jpg"></a></p><h2 id="General"><a href="#General" class="headerlink" title="General"></a>General</h2><p><a href="https://imgchr.com/i/nRX2wQ"><img src="https://s2.ax1x.com/2019/09/16/nRX2wQ.jpg" alt="nRX2wQ.jpg"></a></p><h2 id="Live-Templates"><a href="#Live-Templates" class="headerlink" title="Live Templates"></a>Live Templates</h2><p><a href="https://imgchr.com/i/nRXRoj"><img src="https://s2.ax1x.com/2019/09/16/nRXRoj.jpg" alt="nRXRoj.jpg"></a></p><h2 id="Navigation"><a href="#Navigation" class="headerlink" title="Navigation"></a>Navigation</h2><p><a href="https://imgchr.com/i/nRXBWt"><img src="https://s2.ax1x.com/2019/09/16/nRXBWt.jpg" alt="nRXBWt.jpg"></a></p><h2 id="Refactoring"><a href="#Refactoring" class="headerlink" title="Refactoring"></a>Refactoring</h2><p><a href="https://imgchr.com/i/nRXsQf"><img src="https://s2.ax1x.com/2019/09/16/nRXsQf.jpg" alt="nRXsQf.jpg"></a></p><h2 id="Search-Replace"><a href="#Search-Replace" class="headerlink" title="Search/Replace"></a>Search/Replace</h2><p><a href="https://imgchr.com/i/nRXrSP"><img src="https://s2.ax1x.com/2019/09/16/nRXrSP.jpg" alt="nRXrSP.jpg"></a></p><h2 id="Usage-Search"><a href="#Usage-Search" class="headerlink" title="Usage Search"></a>Usage Search</h2><p><a href="https://imgchr.com/i/nRXyy8"><img src="https://s2.ax1x.com/2019/09/16/nRXyy8.jpg" alt="nRXyy8.jpg"></a></p><h2 id="VCS-Local-History"><a href="#VCS-Local-History" class="headerlink" title="VCS/Local History"></a>VCS/Local History</h2><p><a href="https://imgchr.com/i/nRX6OS"><img src="https://s2.ax1x.com/2019/09/16/nRX6OS.jpg" alt="nRX6OS.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> jetbrains </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tomcat snippet</title>
      <link href="/2016/12/16/tomcat%20snippet/"/>
      <url>/2016/12/16/tomcat%20snippet/</url>
      
        <content type="html"><![CDATA[<h3 id="é…ç½®é¡¹"><a href="#é…ç½®é¡¹" class="headerlink" title="é…ç½®é¡¹"></a>é…ç½®é¡¹</h3><ul><li>é¡¹ç›®éƒ¨ç½²åˆ°linuxçš„tomcatä¸­ï¼ŒéªŒè¯ç åœ¨é¡µé¢ä¸­åˆ·æ–°ä¸äº†ï¼Œéœ€è¦ä¿®æ”¹<code>catalina.sh</code>,æ·»åŠ <code>JAVA_OPTS=&quot;$JAVA_OPTS -Djava.awt.headless=true&quot;</code>é…ç½®</li></ul><h3 id="è®¾ç½®è™šæ‹Ÿè·¯å¾„çš„ä¸¤ç§æ–¹æ³•"><a href="#è®¾ç½®è™šæ‹Ÿè·¯å¾„çš„ä¸¤ç§æ–¹æ³•" class="headerlink" title="è®¾ç½®è™šæ‹Ÿè·¯å¾„çš„ä¸¤ç§æ–¹æ³•"></a>è®¾ç½®è™šæ‹Ÿè·¯å¾„çš„ä¸¤ç§æ–¹æ³•</h3><ul><li>ä½¿ç”¨tomcatè‡ªèº«è®¾ç½®è™šæ‹Ÿè·¯å¾„</li></ul><ol><li><p>åœ¨tomcatçš„server.xmlé…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®contextæ ‡ç­¾</p><p>Contextæ ‡ç­¾ä¸­çš„ç›¸å…³å±æ€§ï¼š</p><ul><li>path: æŒ‡å®šè®¿é—®è¯¥webåº”ç”¨çš„URLå…¥å£ï¼Œå³è™šæ‹Ÿæ–‡ä»¶ç›®å½•</li><li>docBase:ä¸ºè®¿é—®çš„çœŸå®è·¯å¾„</li><li>reloadable:å¦‚æœè¿™ä¸ªå±æ€§è®¾ä¸ºtrueï¼ŒtomcatæœåŠ¡å™¨åœ¨è¿è¡ŒçŠ¶æ€ä¸‹ä¼šç›‘è§†åœ¨WEB-INF/classeså’ŒWEB-INF/libç›®å½•ä¸‹classæ–‡ä»¶çš„æ”¹åŠ¨ï¼Œ å¦‚æœç›‘æµ‹åˆ°æœ‰classæ–‡ä»¶è¢«æ›´æ–°çš„ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½Webåº”ç”¨ã€‚ </li></ul></li><li><p>å¦‚æœè¿™äº‹ä½¿ç”¨ideaå¯åŠ¨é¡¹ç›®ï¼Œéœ€è¦å°†Deploy applications configured in Tomcat instanceå‹¾ä¸Š </p></li></ol><ul><li><p>å•ç‹¬è®¾ç½®IDEAè¿›è¡Œè®¾ç½®è™šæ‹Ÿè·¯å¾„</p><ol><li><p>ä¸Šå›¾çš„ä¸­<code>Deploy applications configured in Tomcat instance</code>ä¸è¦å‹¾ä¸Š </p></li><li><p>é€‰ä¸­<code>edit configurations</code>ï¼Œç‚¹å‡»åŠ å·æŒ‰é’®ï¼Œé€‰æ‹©å®é™…è·¯å¾„ï¼Œå¹¶åœ¨<code>Appication context</code>ä¸­å¡«å†™è™šæ‹Ÿè·¯å¾„ã€‚</p></li></ol></li></ul><h3 id="è®¾ç½®URLè¯·æ±‚å‚æ•°é•¿åº¦"><a href="#è®¾ç½®URLè¯·æ±‚å‚æ•°é•¿åº¦" class="headerlink" title="è®¾ç½®URLè¯·æ±‚å‚æ•°é•¿åº¦"></a>è®¾ç½®URLè¯·æ±‚å‚æ•°é•¿åº¦</h3><ul><li><p>é—®é¢˜æè¿°</p><p>postè¯·æ±‚ï¼Œæœ¬èº«è¯·æ±‚å‚æ•°æ— å¤§å°é™åˆ¶ï¼Œä½†æ˜¯ä¸€èˆ¬çš„æœåŠ¡å™¨åƒtomcatéƒ½æœ‰é»˜è®¤å¤§å°ï¼Œå¦‚æœä¼ è¾“çš„å‚æ•°è¶…è¿‡äº†é»˜è®¤å¤§å°ï¼Œåˆ™ä¼šæŠ¥é”™<code>http post request header is too large</code></p></li><li><p>è§£å†³åŠæ³•</p><p>åœ¨server.xmlä¸­<code>&lt;Connector connectionTimeout=&quot;20000&quot; port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; redirectPort=&quot;8443&quot;/&gt;  </code>ï¼Œæ·»åŠ è®¾ç½®é¡¹<code>maxHttpHeaderSize =&quot;102400&quot; </code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> tomcat </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring snippet</title>
      <link href="/2016/10/16/spring%20snippet/"/>
      <url>/2016/10/16/spring%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><h2 id="ä¼ JSONå­—ç¬¦ä¸²-RequestBodyæ¥æ”¶"><a href="#ä¼ JSONå­—ç¬¦ä¸²-RequestBodyæ¥æ”¶" class="headerlink" title="ä¼ JSONå­—ç¬¦ä¸²+@RequestBodyæ¥æ”¶"></a>ä¼ JSONå­—ç¬¦ä¸²+@RequestBodyæ¥æ”¶</h2><p>å‰ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">icheckDelete</span><span class="params">(url)</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> parms = &#123;</span><br><span class="line">      list : array <span class="comment">//è¿™æ˜¯ä¸ªæ•°ç»„</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">      dataType: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">      contentType:<span class="string">&#x27;application/json;charset=UTF-8&#x27;</span>,<span class="comment">//å…³é”®æ˜¯è¦åŠ ä¸Šè¿™è¡Œ</span></span><br><span class="line">      traditional:<span class="keyword">true</span>,<span class="comment">//è¿™ä½¿jsonæ ¼å¼çš„å­—ç¬¦ä¸ä¼šè¢«è½¬ç </span></span><br><span class="line">      data: JSON.stringify(parms),</span><br><span class="line">      type: <span class="string">&quot;DELETE&quot;</span>, </span><br><span class="line">      timeout: <span class="number">20000</span>,</span><br><span class="line">      url: url,</span><br><span class="line">      success : function () &#123;</span><br><span class="line">          alert(<span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      error : function (data)&#123;</span><br><span class="line">          alert(data.responseText);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>}</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- åç«¯</span><br><span class="line">Controller:</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;deleteList&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(<span class="meta">@RequestBody</span> DeleteListRequest request)</span> <span class="keyword">throws</span> WebTransException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* é€»è¾‘ä»£ç  */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RESTFUL"><a href="#RESTFUL" class="headerlink" title="RESTFUL"></a>RESTFUL</h2><ul><li> <code>@RestController</code> class level annotation and then add the following <code>@RequestMapping</code> to the class</li></ul><h1 id="springboot"><a href="#springboot" class="headerlink" title="springboot"></a>springboot</h1><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><ul><li><p>```<br>bootstrap.ymlï¼ˆbootstrap.propertiesï¼‰ç”¨æ¥ç¨‹åºå¼•å¯¼æ—¶æ‰§è¡Œï¼Œåº”ç”¨äºæ›´åŠ æ—©æœŸé…ç½®ä¿¡æ¯è¯»å–ï¼Œå¦‚å¯ä»¥ä½¿ç”¨æ¥é…ç½®application.ymlä¸­ä½¿ç”¨åˆ°å‚æ•°ç­‰</p><p>application.ymlï¼ˆapplication.properties) åº”ç”¨ç¨‹åºç‰¹æœ‰é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥é…ç½®åç»­å„ä¸ªæ¨¡å—ä¸­éœ€ä½¿ç”¨çš„å…¬å…±å‚æ•°ç­‰ã€‚</p><p>åŠ è½½é¡ºåºï¼šbootstrap.yml &gt; application.yml &gt; application-dev(prod).yml </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">## é—®é¢˜éšè®°</span><br><span class="line"></span><br><span class="line">### Spring Booté€šè¿‡Mybatisï¼Œä½¿ç”¨mapperæ¥å£å’Œxmlé…ç½®sqlï¼Œè¿æ¥æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">- é¦–å…ˆåœ¨é…ç½®æ–‡ä»¶application.properties</span><br><span class="line"></span><br><span class="line">  ```properties</span><br><span class="line">  spring.datasource.url=jdbc:mysql://localhost:3306/test</span><br><span class="line">  spring.datasource.username=***</span><br><span class="line">  spring.datasource.password=***</span><br><span class="line">  spring.datasource.driverClassName=com.mysql.jdbc.Driver</span><br><span class="line">  </span><br><span class="line">  #mybatis.typeAliasesPackageï¼šä¸ºå®ä½“å¯¹è±¡æ‰€åœ¨çš„åŒ…ï¼Œè·Ÿæ•°æ®åº“è¡¨ä¸€ä¸€å¯¹åº”</span><br><span class="line">  #mybatis.mapperLocationsï¼šmapperæ–‡ä»¶çš„ä½ç½®</span><br><span class="line">  </span><br><span class="line">  mybatis.typeAliasesPackage=com.xxx.model</span><br><span class="line">  mybatis.mapperLocations=classpath:mybatis/mapper/*Mapper.xml</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å¯åŠ¨ç±»Application.javaä¸­å†™ä¸Šé…ç½®ä¿¡æ¯ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.xxx.dao&quot;)</span> <span class="comment">// mybatisæ‰«æè·¯å¾„ï¼Œé’ˆå¯¹çš„æ˜¯æ¥å£Mapperç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DailyreportApplication</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DailyreportApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li>mysqlè¿æ¥å¼‚å¸¸<code>java.sql.SQLException: Value &#39;0000-00-00&#39; can not be represented as java.sql.Date</code></li></ol><ul><li><p>è§£å†³åŠæ³•</p><p><code>jdbc:mysql://yourserver:3306/yourdatabase?zeroDateTimeBehavior=convertToNull </code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java Concept of The Day</title>
      <link href="/2016/10/16/Java%20Concept%20of%20The%20Day/"/>
      <url>/2016/10/16/Java%20Concept%20of%20The%20Day/</url>
      
        <content type="html"><![CDATA[<ul><li><p>Stack is used only for execution purpose. Heap is used for storage purpose.</p><h3 id="Non-Static-Members-And-Their-Memory-Management-In-Java"><a href="#Non-Static-Members-And-Their-Memory-Management-In-Java" class="headerlink" title="Non-Static Members And Their Memory Management In Java"></a>Non-Static Members And Their Memory Management In Java</h3></li><li><p>Non-Static variables and Non-Static methods are non-static components of a class. These are also called instance components of a class. Non-static components are stored inside the object memory. Each object will have their own copy of non-static components. But,  static components are common to all objects of that class.</p><h3 id="IIB-Instance-Initialization-Block"><a href="#IIB-Instance-Initialization-Block" class="headerlink" title="IIB-Instance Initialization Block"></a>IIB-Instance Initialization Block</h3></li><li><p>IIB is used to initialize instance variables or non-static variables.</p></li><li><p>IIB blocks will not be called from the constructor in which this() statement is written as a first statement. </p><h3 id="super-and-this-keywords-in-java"><a href="#super-and-this-keywords-in-java" class="headerlink" title="super and this keywords in java"></a>super and this keywords in java</h3></li><li><p>super class constructor is called by super() calling statement. You canâ€™t use super() calling statement outside the constructor. By default, super() calling statement is the first statement in any constructor. </p></li><li><p>this() is the calling statement to same class constructor. It must be used within constructor only. If it is used, it must be the first statement in the constructor.</p></li><li><p>You canâ€™t use super and this keywords in a static method and in a static initialization block even though you are referring static members.</p><h3 id="10-Points-Every-Java-Programmer-Should-Know-About-final-keyword-in-java"><a href="#10-Points-Every-Java-Programmer-Should-Know-About-final-keyword-in-java" class="headerlink" title="10 Points Every Java Programmer Should Know About final keyword in java"></a>10 Points Every Java Programmer Should Know About final keyword in java</h3></li><li><p> Any class or any method can be either abstract or final but not both. abstract and final are totally opposite. Because, abstract class or abstract method must be implemented or modified in the sub classes but final does not allow this. This creates an ambiguity.</p></li><li><p> The global variable which is declared as final and static remains unchanged for the whole execution. Because, Static members are stored in the class memory and they are loaded only once in the whole execution. They are common to all objects of the class. If you declare static variables as final, any of the objects canâ€™t change their value as it is final. Therefore, variables declared as final and static are sometimes referred to as Constants. All fields of interfaces are referred as constants, because they are final and static by default.</p><h3 id="Garbage-Collection-And-finalize-method-In-Java"><a href="#Garbage-Collection-And-finalize-method-In-Java" class="headerlink" title="Garbage Collection And finalize() method In Java"></a>Garbage Collection And finalize() method In Java</h3></li><li><p>Whenever you run a java program, JVM creates three threads. 1) main thread   2) Thread Scheduler   3) Garbage Collector Thread. In these three threads, main thread is a user thread and remaining two are daemon threads which run in background.</p><h3 id="Access-Modifiers-In-Java"><a href="#Access-Modifiers-In-Java" class="headerlink" title="Access Modifiers In Java"></a>Access Modifiers In Java</h3></li><li><p>Class can not be a private except inner classes. Inner classes are nothing but again members of outer class. So members of a class (field, method, constructor and inner class) can be private but not the class itself.<br><img src="https://i.imgur.com/6h3llC0.jpg"></p><h3 id="What-Are-Access-And-Non-Access-Modifiers-In-Java"><a href="#What-Are-Access-And-Non-Access-Modifiers-In-Java" class="headerlink" title="What Are Access And Non-Access Modifiers In Java?"></a>What Are Access And Non-Access Modifiers In Java?</h3><p><img src="https://i.imgur.com/nB7eV1i.jpg"></p><h3 id="Type-Casting-In-Java"><a href="#Type-Casting-In-Java" class="headerlink" title="Type Casting In Java"></a>Type Casting In Java</h3><p>Please note that by using casting, data can not be modified but only type of data can be modified.</p></li><li><p>Primitive Casting.</p><ul><li>memory size <code>byte &lt; short &lt; int &lt; long &lt; float &lt; double.</code><ul><li>Auto Widening</li><li>Explicit Narrowing</li></ul></li></ul></li><li><p>Derived Casting</p><ul><li>Auto-up Casting<ul><li>Explicit Down Casting<h3 id="Abstraction-In-Java"><a href="#Abstraction-In-Java" class="headerlink" title="Abstraction In Java"></a>Abstraction In Java</h3></li></ul></li></ul></li><li><p>Abstract classes contain abstract methods (you can refer them as ideas) so that they can be implemented in sub classes according to their requirements. They are also called as incomplete classes as they have some unimplemented abstract methods(ideas).</p><h3 id="Interfaces-In-Java"><a href="#Interfaces-In-Java" class="headerlink" title="Interfaces In Java"></a>Interfaces In Java</h3></li><li><p>Interfaces in java are very much similar to abstract classes but interfaces contain only abstract methods (you can refer to them as only ideas). Abstract classes may contain both abstract methods as well as concrete methods. But interfaces must contain only abstract methods. Concrete methods are not allowed in interfaces. Therefore, Interfaces show 100% abstractness.</p><h3 id="Auto-Widening-Vs-Auto-Boxing-Vs-Auto-UpCasting-In-Java"><a href="#Auto-Widening-Vs-Auto-Boxing-Vs-Auto-UpCasting-In-Java" class="headerlink" title="Auto-Widening Vs Auto-Boxing Vs Auto-UpCasting In Java"></a>Auto-Widening Vs Auto-Boxing Vs Auto-UpCasting In Java</h3><p><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/widening-Vs-boxing.png?x70034"></p><h3 id="Exception-Handing"><a href="#Exception-Handing" class="headerlink" title="Exception Handing"></a>Exception Handing</h3><p>java.lang.Throwable is the super class of all errors and exceptions in java.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/Exceptions.png?x70034"><br><img src="https://i.imgur.com/xHC2xQo.jpg"></p></li><li><p>java.lang.Error class represents the errors which are mainly caused by the environment in which application is running. For example, OutOfMemoryError occurs when JVM runs out of memory or StackOverflowError occurs when stack overflows.</p></li><li><p>Where as java.lang.Exception class represents the exceptions which are mainly caused by the application itself. For example, NullPointerException occurs when an application tries to access null object or ClassCastException occurs when an application tries to cast incompatible class types. </p><h3 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h3></li><li><p>Array can hold the references to any type of objects. It is important to note that array can contain only references to the objects, not the objects itself. </p><h3 id="Threads"><a href="#Threads" class="headerlink" title="Threads"></a>Threads</h3></li><li><p>Processes and threads can be diagrammatically represented as this<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/ThreadsAndProcesses.png?x70034"></p></li><li><p>User threads are threads which are created by the application or user.</p></li><li><p>Daemon threads are threads which are mostly created by the JVM.</p></li><li><p>There are three constant fields in java.lang.Thread class related to priority of a thread. They are,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> MIN_PRIORITY   â€”&gt; It defines the lowest priority that a thread can have and Itâ€™s value is 1.</span><br><span class="line">NORM_PRIORITY  â€”&gt; It defines the normal priority that a thread can have and itâ€™s value is 5.</span><br><span class="line">MAX_PRIORITY  â€”&gt; It defines the highest priority that a thread can have and itâ€™s value is 10.</span><br></pre></td></tr></table></figure><p>  The priority of a main thread, if explicitly not set, is always 5 i.e NORM_PRIORITY.</p></li><li><p>avoid thread interference </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> By declaring the method as synchronized.</span><br><span class="line">By declaring the variables as final.</span><br><span class="line">By declaring the variable as volatile.</span><br><span class="line">By creating the immutable objects.</span><br><span class="line">By using Atomic operations.</span><br><span class="line">By restricting the access to same object by multiple threads.</span><br></pre></td></tr></table></figure></li><li><p>The Logic Behind The Synchronization In Java :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  The synchronization in java is built around an entity called object lock or monitor. Here is the brief description about lock or monitor.</span><br><span class="line">- Whenever an object is created to any class, an object lock is created and is stored inside the object.</span><br><span class="line">- One object will have only one object lock associated with it.</span><br><span class="line">- Any thread wants to enter into synchronized methods or blocks of any object, they must acquire object lock associated with that object and release the lock after they are done with the execution.</span><br><span class="line">- The other threads which wants to enter into synchronized methods of that object have to wait until the currently executing thread releases the object lock.</span><br><span class="line">- To enter into static synchronized methods or blocks, threads have to acquire class lock associated with that class as static members are stored inside the class memory.</span><br></pre></td></tr></table></figure></li><li><p>mutex</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class Shared</span><br><span class="line">&#123;</span><br><span class="line">    static void staticMethod()</span><br><span class="line">    &#123;</span><br><span class="line">        synchronized (Shared.class)</span><br><span class="line">        &#123;</span><br><span class="line">            //static synchronized block</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    void NonStaticMethod()</span><br><span class="line">    &#123;</span><br><span class="line">        synchronized (this)</span><br><span class="line">        &#123;</span><br><span class="line">            //Non-static synchronized block</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    void anotherNonStaticMethod()</span><br><span class="line">    &#123;</span><br><span class="line">        synchronized (new Shared())</span><br><span class="line">        &#123;</span><br><span class="line">            //Non-static synchronized block</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>10 Points-To-Remember About Synchronization In Java :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. You can use synchronized keyword only with methods but not with variables, constructors, static initializer and instance initializers.</span><br><span class="line">2. Constructors, Static initializer and instance initializer canâ€™t be declared with synchronized keyword, but they can contain synchronized blocks.</span><br><span class="line">3. Both static and non-static methods can use synchronized keyword. For static methods, thread need class level lock and for non-static methods, thread need object level lock.</span><br><span class="line">4. It is possible that both static synchronized and non-static synchronized methods can run simultaneously. Because, static methods need class level lock and non-static methods need object level lock.</span><br><span class="line">5. A method can contain any number of synchronized blocks. This is like synchronizing multiple parts of a method.</span><br><span class="line">6. Synchronization blocks can be nested.</span><br><span class="line">7. Lock acquired by the thread before executing a synchronized method or block must be released after the completion of execution, no matter whether execution is completed normally or abnormally (due to exceptions).</span><br><span class="line">8. Synchronization in java is Re-entrant in nature. A thread can not acquire a lock that is owned by another thread. But, a thread can acquire a lock that it already owns. That means if a synchronized method gives a call to another synchronized method which needs same lock, then currently executing thread can directly enter into that method or block without acquiring the lock.</span><br><span class="line">9. synchronized method or block is very slow. They decrease the performance of an application. So, special care need to be taken while using synchronization. Use synchronization only when you needed it the most.</span><br><span class="line">10. Use synchronized blocks instead of synchronized methods. Because, synchronizing some part of a method improves the performance than synchronizing the whole method.</span><br></pre></td></tr></table></figure></li><li><p>wait(), notify() and notifyAll()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">These methods are final methods of java.lang.Object class. That means every class in java will have these methods. Below is the method signatures of these methods.</span><br><span class="line">1. public final void wait() throws InterruptedException</span><br><span class="line">This method tells the currently executing thread to release the lock of this object and wait until some other thread acquires the same lock and notify it using either notify() or notifyAll() methods. This method throws InterruptedException if waiting thread is interrupted.</span><br><span class="line">2. public final void notify()</span><br><span class="line">This method wakes up one thread randomly that called wait() method on this object.</span><br><span class="line">3. public final void notifyAll()</span><br><span class="line">This method wakes up all the threads that called wait() method on this object. But, only one thread will acquire lock of this object depending upon the priority.</span><br><span class="line"></span><br><span class="line">Important Note : These three methods must be called within synchronized method or block. Any thread which calls these methods must have lock of that object.</span><br></pre></td></tr></table></figure></li><li><p>Some Things-To-Remember About wait(), notify() and notifyAll() :</p><ul><li>If a thread calls notify() method and more than one threads are waiting for the object lock, then only one thread will be notified randomly.</li><li>When a thread calls notifyAll() method on an object, it notifies all the threads which are waiting for this object lock. But, only one thread will acquire this object lock depending upon priority.</li><li>When you call sleep() method on a thread, thread goes to sleep with holding the object lock with it. But, if you call wait() method, thread releases the object lock and goes for sleep. This is the main difference between wait() and sleep() methods.</li><li>wait(), notify() and notifyAll() are final methods of java.lang.Object class not java.lang.Thread class.</li><li>wait(), notify() and notifyAll() â€“ all these three methods throw IllegalMonitorStateException if the calling thread does not owns the object lock.</li><li>wait() method is overloaded in Object class. There are two more wait() methods available in Object class.</li></ul></li><li><p>Thread Life Cycle OR Thread States In Java</p><ul><li>NEW,    A thread will be in this state before calling start() method.<ul><li>RUNNABLE, A thread will be in this state after calling the start() method.</li><li>BLOCKED, A thread will be in this state when a thread is waiting for object lock to enter into synchronized method/block or a thread will be in this state if deadlock occurs. </li><li>WAITING, A thread will be in this state when wait() or join() method is called.</li><li>TIMED_WAITING, A thread will be in this state when thread is sleeping. i.e A thread will be in this state when sleep() or wait() with timeOut or join() with timeOut is called.</li><li>TERMINATED, A thread will be in this state once it finishes itâ€™s execution.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/JavaThreadLifeCycle.png?x70034"></li></ul></li></ul></li><li><p>7 Things Every Java Programmer Should Know About Threads In Java</p><ul><li><strong>Runnable interface vs Thread class</strong> : I am of opinion that when multiple threads need to execute same task, then use Runnable interface. If multiple threads need to execute different tasks, then go for Thread class.</li></ul></li><li><p>Difference Between wait() and sleep() Methods In Java</p><ul><li><p><strong>wait()</strong>:  releases the lock or monitor</p><ul><li><strong>sleep()</strong>: not  releases the lock or monitor</li></ul><p><img src="https://javaconceptoftheday.com/wp-content/uploads/2015/02/WaitAndSleep.png"></p></li></ul></li><li><p>Extends Thread Vs Implements Runnable In Java<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2015/12/RunnableVsThread.png"><br>From the above all findings, it is clear that â€œImplements Runnableâ€ is the preferred method to create the threads in java.</p></li><li><p>How To Stop A Thread In Java</p><ul><li>One is using boolean variable and second one is using interrupt() method. In this post, we will discuss both of these methods.</li></ul></li><li><p>Difference Between notify And notifyAll In Java</p><ul><li>wait(), notify() and notifyAll() must be called within synchronized method or synchronized block.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2016/03/NotifyVsNotifyAll.png"></li></ul></li><li><p>Difference Between BLOCKED Vs WAITING States In Java</p><ul><li>There are six thread states in java. They are <strong>NEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING and TERMINATED</strong>.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2016/06/WaitingVsBlocked.png"></li></ul></li></ul><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><ul><li>strings are treated as objects.</li><li>JVM allocates some memory specially meant for string literals. This part of the heap memory is called String Constant Pool.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String s1 = &quot;abc&quot;; </span><br><span class="line">String s2 = &quot;xyz&quot;;</span><br><span class="line">String s3 = &quot;123&quot;;</span><br><span class="line">String s4 = &quot;A&quot;;</span><br><span class="line">   String s5 = new String(&quot;abc&quot;);</span><br><span class="line">char[] c = &#123;&#x27;J&#x27;, &#x27;A&#x27;, &#x27;V&#x27;, &#x27;A&#x27;&#125;;</span><br><span class="line">String s6 = new String(c);</span><br><span class="line">String s7 = new String(new StringBuffer());</span><br></pre></td></tr></table></figure><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/String-Constant-Pool.png"></li><li>String Constant Pool is allocated to an object depending upon itâ€™s content. There will be no two objects in the pool having the same content.</li><li>```<br>â€œWhen you create a string object using string literal, JVM first checks the content of to be created object. If there exist an object in the pool with the same content,     then it returns the reference of that object. It doesnâ€™t create new object. If the content is different from the existing objects then only it creates new object.â€<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">In simple words, there can not be two string objects with same content in the string constant pool. But, there can be two string objects with the same content in the heap memory.</span><br></pre></td></tr></table></figure></li><li>Immutability is the fundamental property of string objects. In whatever way you create the string objects, either using string literals or using new operator, they are immutable.</li></ul><h3 id="Generic"><a href="#Generic" class="headerlink" title="Generic"></a>Generic</h3><ul><li><p>Defining Generic Class</p><ul><li>Generics Work Only With Derived Types</li></ul></li><li><p>Rules To Follow While Implementing Generic Interfaces</p><ul><li>Only generic classes can implement generic interfaces.<br><code>class GenericClass&lt;T&gt; implements GenericInterface&lt;T&gt;</code><br>-A normal class can implement a generic interface if type parameter of generic interface is a wrapper class. For example, below implementation of GenericInterface is legal.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface GenericInterface&lt;Integer&gt;&#123;</span><br><span class="line">    //Generic interface with Integer as type parameter</span><br><span class="line">&#125;</span><br><span class="line">class NormalClass implements GenericInterface&lt;Integer&gt;&#123;</span><br><span class="line">    //Normal class implementing generic interface</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>Class implementing generic interface at least must have same number and same type of parameters and at most can have any number and any type of parameters.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class GenericClass2&lt;T, V&gt; implements GenericInterface&lt;T&gt;&#123;</span><br><span class="line">  //Class with two type parameters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Define Methods And Constructors As Generic</p><ul><li>Generic Methods:<br><code>&lt;type-Parameters&gt; return_type method_name(parameter list)</code></li><li>Constructors As Generics,As we all know that constructors are like methods but without return types</li></ul></li><li><p>Bounded Types</p><ul><li>the syntax for declaring Bounded type parameters.<br><code>&lt;T extends SuperClass&gt;</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;T extends Number&gt; void printNumbers(T[] t)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Wildcard arguments </p><ul><li>The syntax for declaring this type of wildcard arguments is:<code>GenericType&lt;?&gt;</code></li><li>To specify an upper bound for wildcards:<code>GenericType&lt;? extends SuperClass&gt;</code></li><li>specify a lower bound for wildcard argument using super clause:<code>GenericType&lt;? super SubClass&gt;</code></li></ul></li><li><p>Type Erasure</p></li></ul><h3 id="Collection-Framework"><a href="#Collection-Framework" class="headerlink" title="Collection Framework"></a>Collection Framework</h3><ul><li><p>Collection Framework â€“ Class Hierarchy</p><ul><li>All classes and interfaces related to Collection Framework are placed in java.util package.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/CollectionHierarchy.png"></li></ul></li><li><p>Collection Framework â€“ Collection Interface<br>  <img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/CollectionInterface.png"></p><ul><li>equals() and hashcode() methods in the Collection interface are not the methods of java.lang.Object class. Because, interfaces does not inherit from Object class. Only classes in java are inherited from Object class. Any classes implementing Collection interface must provide their own version of equals() and hashcode() methods or they can retain default version inherited from Object class.</li></ul></li><li><p>Collection Framework â€“ List Interface</p><ul><li>the class diagram of List interfaceï¼š<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/ListInterface.png"></li></ul></li><li><p>Collection Framework â€“ The ArrayList Class</p><ul><li>Default initial capacity of an ArrayList is 10.<ul><li>the hierarchy diagram of ArrayList class.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/12/ArrayListClass.png"></li><li>Properties Of ArrayList :<ul><li>Size of the ArrayList is not fixed. It can increase and decrease dynamically as we add or delete the elements.<ul><li>ArrayList can have any number of null elements.</li><li>ArrayList can have duplicate elements.</li><li>As ArrayList implements RandomAccess, you can get, set, insert and remove elements of the ArrayList from  any arbitrary position.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/12/ArrayListTemplateNew.png"></li></ul></li></ul></li></ul></li></ul></li><li><p>Differences Between Array Vs ArrayList In Java</p><ul><li>Array is static in nature,ArrayList is dynamic in nature<ul><li>when you try to add elements to ArrayList beyond its capacity, it creates the new array with increased size and copies the elements from old array to new array.</li><li>if adding an element requires resizing of an ArrayList, then it gets slightly slower as it involves creating a new array in the background and copying all elements from old array to new array.</li><li>Array can hold both primitive data types (int, floatâ€¦.) as well as objects. Where as ArrayList can hold only objects. If you try to insert primitive data into ArrayList, data is automatically boxed into corresponding wrapper class.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2016/09/ArrayVsArrayList.png"></li><li>ArrayList to Array,<strong>toArray()</strong> method returns an array containing all elements of the ArrayList.<code> Object[] array = list.toArray();</code></li><li>Array To ArrayList:<ul><li>Arrays.asList() <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] array = new String[] &#123;&quot;ANDROID&quot;, &quot;JSP&quot;, &quot;JAVA&quot;, &quot;STRUTS&quot;, &quot;HADOOP&quot;, &quot;JSF&quot;&#125;;</span><br><span class="line">ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;(Arrays.asList(array));</span><br></pre></td></tr></table></figure><ul><li>Collection.addAll()<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String[] array = new String[] &#123;&quot;ANDROID&quot;, &quot;JSP&quot;, &quot;JAVA&quot;, &quot;STRUTS&quot;, &quot;HADOOP&quot;, &quot;JSF&quot;&#125;;</span><br><span class="line">ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;();</span><br><span class="line">Collections.addAll(list, array);</span><br></pre></td></tr></table></figure></li><li>ArrayList.addAll()<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String[] array = new String[] &#123;&quot;ANDROID&quot;, &quot;JSP&quot;, &quot;JAVA&quot;, &quot;STRUTS&quot;, &quot;HADOOP&quot;, &quot;JSF&quot;&#125;;</span><br><span class="line">ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;();</span><br><span class="line">list.addAll(Arrays.asList(array));</span><br></pre></td></tr></table></figure></li><li>Using streams from java 8<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] array = new String[] &#123;&quot;ANDROID&quot;, &quot;JSP&quot;, &quot;JAVA&quot;, &quot;STRUTS&quot;, &quot;HADOOP&quot;, &quot;JSF&quot;&#125;;</span><br><span class="line">List&lt;Object&gt; list = Arrays.stream(array).collect(Collectors.toList());</span><br></pre></td></tr></table></figure><img src="https://javaconceptoftheday.com/wp-content/uploads/2016/07/ArrayToArrayList.png"></li></ul></li></ul></li></ul></li></ul></li><li><p>Remove Duplicate Elements From ArrayList</p><ul><li>Using HashSet<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HashSet&lt;String&gt; set = new HashSet&lt;String&gt;(listWithDuplicateElements);</span><br><span class="line">ArrayList&lt;String&gt; listWithoutDuplicateElements = new ArrayList&lt;String&gt;(set);</span><br></pre></td></tr></table></figure><ul><li>Using LinkedHashSet<br><code>LinkedHashSet&lt;String&gt; set = new LinkedHashSet&lt;String&gt;(listWithDuplicateElements);</code><br><img src="https://javaconceptoftheday.com/wp-content/uploads/2015/07/RemovingDuplicateElementsFromArrayList.png"></li></ul></li></ul></li><li><p>Collection Framework â€“ The Vector Class</p><ul><li>Vector class is synchronized. <ul><li>All methods of Vector class are synchronized </li><li>capacity of the vector will be doubled whenever size exceeds capacity.</li><li>Why Not To Use Vector Class In Your Code<ul><li>you can achieve thread safe ArrayList by using synchronizedList() method of Collections class. </li></ul></li></ul></li></ul></li><li><p>Java Collection Framework â€“ The LinkedList Class</p><ul><li>In general terms, LinkedList is a data structure where each element consist of three things. First one is the reference to previous element, second one is the actual value of the element and last one is the reference to next element.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/12/HowLinkedListWorks.png"></li></ul></li><li><p>Collection Framework â€“ The Queue Interface</p><ul><li>First-In-First-Out.<ul><li>You canâ€™t add or get or set elements at an arbitrary position in the queues.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/HowQueueWorks.png"></li><li>Properties Of Queue :<ul><li>Null elements are not allowed in the queue. <ul><li>Queue can have duplicate elements.</li><li>Unlike a normal list, queue is not random access. i.e you canâ€™t set or insert or get elements at an arbitrary positions.</li><li>In the Queue Interface, there are two methods to obtain and remove the elements from the head of the queue. They are poll() and remove(). The difference between them is, poll() returns null if the queue is empty and remove() throws an exception if the queue is empty.</li><li>There are two methods in the Queue interface to obtain the elements but donâ€™t remove. They are peek() and element(). peek() returns null if the queue is empty and element() throws an exception if the queue is empty.</li></ul></li></ul></li></ul></li></ul></li><li><p>Collection Framework â€“ The Deque Interface</p><ul><li>the hierarchy diagram of Deque interfaceï¼š<br>  <img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/Deque.png"></li><li>The main advantage of Deque is that you can use it as both Queue (FIFO) as well as Stack (LIFO).</li><li>Deque is nothing but the double ended queue. That means, you can insert, retrieve and remove the elements from both the ends.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2014/11/HowDequeWorks.png"></li></ul></li><li><p>Collection Framework â€“ The Set Interface</p><ul><li>Order of elements in a set is implementation dependent. HashSet elements are ordered on hash code of elements. TreeSet elements are ordered according to supplied Comparator (If no Comparator is supplied, elements will be placed in ascending order) and LinkedHashSet maintains insertion order.</li><li>The HashSet internally uses HashMap to store the objects. The elements you insert in HashSet will be stored as keys of that HashMap object and their values will be a constant called PRESENT. This constant is defined as private static final Object PRESENT = new Object() in the source code of HashSet class.</li><li>HashSet can have maximum one null element.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2015/01/HowHashSetWorks.png"></li><li>LinkedHashSet internally uses LinkedHashMap to store itâ€™s elements just like HashSet which internally uses HashMap to store itâ€™s elements.</li><li>LinkedHashSet maintains insertion order. This is the main difference between LinkedHashSet and HashSet.</li><li>SortedSet elements are sorted according to supplied Comparator. If you donâ€™t mention any Comparator while creating a SortedSet, elements will be placed in ascending order.</li><li>SortedSet Inserted elements must be of Comparable type and they must be mutually Comparable.</li><li>Elements inserted in the TreeSet must be of Comparable type and elements must be mutually comparable. </li><li>TreeSet internally uses TreeMap to store itâ€™s elements just like HashSet and LinkedHashSet which use HashMap and LinkedHashMap respectively to store their elements.</li></ul></li><li><p>Java Collection Framework â€“ The Map Interface<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2015/01/MapInterface.png"></p><ul><li>Each key-value pairs of the map are stored as Map.Entry objects. Map.Entry is an inner interface of Map interface.</li><li>HashMap doesnâ€™t maintain any order of elements. LinkedHashMap maintains insertion order of elements. Where as TreeMap places the elements according to supplied Comparator.</li><li>Default initial capacity of HashMap is 16.</li><li>Hashing is nothing but the function or algorithm or method which when applied on any object/variable returns an unique integer value representing that object/variable.</li><li>The capacity of an HashMap is the number of buckets in the hash table. The initial capacity is the capacity of an HashMap at the time of its creation. The default initial capacity of the HashMap is 24 i.e 16. The capacity of the HashMap is doubled each time it reaches the threshold. i.e the capacity is increased to 25=32, 26=64, 27=128â€¦.. when the threshold is reached.</li><li>HashMap internally uses an array of Entry&lt;K, V&gt; objects to store the data.</li><li>HashTable is a legacy class. It is almost considered as due for deprecation. Since JDK 1.5, ConcurrentHashMap is considered as better option than the HashTable.</li></ul></li></ul><h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h3><ul><li><p>Java Database Connectivity API which is used by the java application to interact with the database.</p><ul><li>JDBC API not directly interacts with the database. It uses JDBC driver of that database to interact with the database.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2015/06/JavaJDBCDriverDatabase.png"></li><li>JDBC driver is a software component provided along with the database which is required by the JDBC API to interact with the database. Each database will have its own JDBC driver.</li></ul><blockquote><p>In simple terms, JDBC drivers are nothing but the implementations of interfaces provided in the JDBC API (java.sql and javax.sql packages) with respect to a particular database. These implementations are bundled in a JAR file and supplied along with the database. These implementations are used by the JDBC API to interact with that database.</p></blockquote></li></ul><h3 id="Big-O-Notations"><a href="#Big-O-Notations" class="headerlink" title="Big O Notations"></a>Big O Notations</h3><ul><li>Big O notations consist of O and an expression enclosed within ( ). Expression within ( ) represents the number of computations a particular algorithm has to perform to solve a given problem.</li><li><strong>O(1)</strong> represents an algorithm which has to perform exact one computation to solve a problem. O(1) represents an algorithm which takes same time to execute for any size of input data. In other words, O(1) denotes an algorithm which performance is not affected by the size of the input data. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">boolean isFirstElementZero(int[] inputData)</span><br><span class="line">&#123;</span><br><span class="line">if(inputData[0] == 0)</span><br><span class="line">&#123;</span><br><span class="line">return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>O(N)</strong> represents an algorithm which has to perform â€˜Nâ€™ computations to solve a problem. Where â€˜Nâ€™ is the number of elements in input data. That means algorithm will take more time as number of elements in input data increases. In the other words, O(N) denotes an algorithm whose performance is directly proportional to size of the input data.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">boolean searchForElement(int[] inputData, int n)</span><br><span class="line">&#123;</span><br><span class="line">for (int i = 0; i &lt; inputData.length; i++)</span><br><span class="line">&#123;</span><br><span class="line">if(inputData[i] == n)</span><br><span class="line">&#123;</span><br><span class="line">return true;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>O(N^2)</strong> denotes an algorithm which has to perform N^2 computations to solve a problem. Where N is the number of elements in input data. In the other words, O(N^2) represents an algorithm whose performance is directly proportional to square of the size of the input data. The algorithms which have nested iterations over the input data will give O(N^2) performance. Further deeper iterations over the input data will give O(N^3), O(N^4) and so on.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">boolean findDuplicates(int[] inputData)</span><br><span class="line">&#123;</span><br><span class="line">for (int i = 0; i &lt; inputData.length; i++)</span><br><span class="line">&#123;</span><br><span class="line">for (int j = 0; j &lt; inputData.length; j++)</span><br><span class="line">&#123;</span><br><span class="line">if(inputData[i] == inputData[j] &amp;&amp; i!=j)</span><br><span class="line">&#123;</span><br><span class="line">return true;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>O(log N)</strong> represents an algorithm whose number of computations grows linearly as input data grows exponentially. i.e O(log N) represents the algorithms whose execution time grows linearly as input data grows exponentially. That means if an algorithm takes 1 second to compute 10 elements, then it will take 2 seconds to compute 100 elements, 3 seconds to compute 1000 elements and so on. The best example for O(log N) is binary search algorithm which uses divide and conquer rule to search for an element.</li><li><strong>O(2N)</strong> represents an algorithm whose execution time is doubled for every extra element in the input data. For example, if an algorithm takes 4 seconds to compute 2 elements, then it will take 8 seconds to compute 3 elements, 16 seconds for 4 elements, 32 seconds for 5 elements and so on.</li><li><strong>O(N!)</strong> represents an algorithm which has to perform N! computations to solve a problem. Where N is the number of elements in the input data. For example, if an algorithm takes 2 seconds to compute 2 elements, then it will take 6 seconds to compute 3 elements, 24 seconds to compute 4 elements and so on.<br><img src="https://javaconceptoftheday.com/wp-content/uploads/2015/05/Big-O-Notation.png"></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux file command</title>
      <link href="/2016/10/16/linux%20cmd:%20file/"/>
      <url>/2016/10/16/linux%20cmd:%20file/</url>
      
        <content type="html"><![CDATA[<h1 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h1><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><ul><li><p><code>awk -v FS=&quot;è¾“å…¥åˆ†éš”ç¬¦&quot; -v OFS=&#39;è¾“å‡ºåˆ†éš”ç¬¦&#39; &#39;&#123;if($1==$5) print $1,$5,$10&#125;&#39; filename</code></p><p>æŸ¥æ‰¾filenameæ–‡ä»¶ï¼ˆæ–‡ä»¶ä¸­åˆ—çš„åˆ†éš”ç¬¦ä¸ºâ€œè¾“å…¥åˆ†éš”ç¬¦â€ï¼‰ä¸­ï¼Œæ¯ä¸€è¡Œç¬¬ä¸€åˆ—å’Œç¬¬äº”åˆ—ç›¸ç­‰çš„è¡Œï¼Œå¹¶è¾“å‡ºç¬¬ä¸€åˆ—ã€ç¬¬äº”åˆ—ã€ç¬¬ååˆ—ï¼Œåˆ‡è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ä¸ºâ€œè¾“å‡ºåˆ†éš”ç¬¦â€ã€‚å¦‚æœä¸é…ç½®FSå’ŒOFSï¼Œé‚£ä¹ˆè¾“å…¥è¾“å‡ºåˆ†éš”ç¬¦å‡é»˜è®¤ä¸ºç©º</p></li><li><p><a href="https://www.commandlinefu.com/commands/view/6872/exclude-a-column-with-awk">exclude a column with awk</a>, æ¯”å¦‚æ‰“å°é™¤ç¬¬5åˆ—çš„å…¶å®ƒæ‰€æœ‰åˆ—</p><p>awk â€˜{ $5=â€â€; print }â€™ file</p></li></ul><h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><ul><li><p>è§£ç </p><p><code>echo [base64-encoded-string] | base64 --decode</code></p></li><li><p>ç¼–ç </p><p><code>echo &quot;your string&quot; | base64</code></p></li></ul><h2 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h2><p>ä½¿æ–‡ä»¶å¯ä»¥ç›´æ¥æ‰§è¡Œçš„å‘½ä»¤ï¼šchmod +x filename</p><p>ä½¿æ‰€æœ‰ç”¨æˆ·å¯¹ç›®å½•éƒ½æœ‰è¯»å†™æƒé™ï¼šsudo chmod ugo+rw /opt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r=4ï¼Œw=2ï¼Œx=1</span><br><span class="line">è‹¥è¦rwxå±æ€§åˆ™4+2+1=7ï¼›</span><br><span class="line">è‹¥è¦rw-å±æ€§åˆ™4+2=6ï¼›</span><br><span class="line">è‹¥è¦r-xå±æ€§åˆ™4+1=7</span><br></pre></td></tr></table></figure><h2 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rsync -aP &lt;sourceDir&gt; &lt;targetDir&gt;</span><br><span class="line"></span><br><span class="line">cp -r &lt;sourceDir&gt; &lt;targetDir&gt;</span><br></pre></td></tr></table></figure><h2 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;hello_world&quot; | cut -c1-5   # Output: hello</span><br></pre></td></tr></table></figure><h3 id="rclone"><a href="#rclone" class="headerlink" title="rclone"></a>rclone</h3><blockquote><p>Built-in retry and performance options</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> dir1 to dir2 æ³¨æ„ä¼ è¾“çš„æ˜¯ dir1ä¸­çš„æ–‡ä»¶åˆ° dir2ç›®å½•ä¸‹ï¼ˆè€Œä¸æ˜¯ä¼ è¾“dir1ç›®å½•åˆ°dir2ç›®å½•ï¼‰</span></span><br><span class="line">rclone copy dir1 dir2 \  </span><br><span class="line">  --transfers=32 --checkers=32 \</span><br><span class="line">  --fast-list --no-traverse \</span><br><span class="line">  --log-file=rclone_copy.log --progress</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> one big file</span></span><br><span class="line">rclone copy \</span><br><span class="line">  --progress \                     # Monitor transfer</span><br><span class="line">  --buffer-size=512M \             # Increase buffer size (adjust based on RAM)</span><br><span class="line">  --transfers=10 \                 # Parallel file transfers (uses CPU cores)</span><br><span class="line">  --multi-thread-streams=10 \      # Split file into concurrent streams</span><br><span class="line">  --retries=10 \                   # Retry on failures</span><br><span class="line">  --low-level-retries=20 \         # Retry on transient errors</span><br><span class="line">  --fast-list \                    # Speed up directory listings (if applicable)</span><br><span class="line">  /path/to/source/file \           # Source file path</span><br><span class="line">  remote:destination/path          # Target remote</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. big file</span></span><br><span class="line">rclone copy \</span><br><span class="line">  --progress \</span><br><span class="line">  --buffer-size=512M \</span><br><span class="line">  --transfers=5 \</span><br><span class="line">  --multi-thread-streams=5 \</span><br><span class="line">  --retries=5 \</span><br><span class="line">  --low-level-retries=10 \</span><br><span class="line">  --fast-list \</span><br><span class="line">  /mnt/tsinghua/newzip/omniobject3d.zip \</span><br><span class="line">  /mnt/disk2/tsinghua</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> large small files</span></span><br><span class="line">rclone copy /mnt/source/ /mnt/destination/ \</span><br><span class="line">  --progress \</span><br><span class="line">  --transfers=30 \               # Max parallel file transfers</span><br><span class="line">  --checkers=30 \                # Parallel file checks/listing</span><br><span class="line">  --buffer-size=16M \            # Smaller buffers for small files</span><br><span class="line">  --multi-thread-streams=0 \     # Disable chunking (small files)</span><br><span class="line">  --fast-list \                  # Reduce memory for directory listings</span><br><span class="line">  --no-traverse \                # Skip scanning destination</span><br><span class="line">  --max-backlog=100000 \         # Keep the pipeline full</span><br><span class="line">  --retries=10 \               </span><br><span class="line">  --low-level-retries=20 \</span><br><span class="line">  --log-level=INFO \</span><br><span class="line">  --log-file=rclone.log \</span><br><span class="line">  --drive-use-trash=false \      # If using Google Drive (optional)</span><br><span class="line">  --checksum                    # Keep for integrity (or remove for speed)</span><br></pre></td></tr></table></figure><h3 id="parallel"><a href="#parallel" class="headerlink" title="parallel"></a>parallel</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /path/to/source/ -maxdepth 1 -type d | parallel -j 8 &#x27;rclone copy &#123;&#125; /path/to/target/&#123;/&#125; --transfers=32 --checkers=32 --fast-list --buffer-size=512M --max-backlog=100000 --use-mmap --no-traverse --stats=30s --log-file=rclone_&#123;/&#125;.log&#x27;</span><br></pre></td></tr></table></figure><ul><li><p>find Part</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-maxdepth 1 -type d: Finds top-level directories under point3r/ (excludes files at this level and the root itself).</span><br></pre></td></tr></table></figure></li><li><p>parallel Part</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-j 8: Runs 8 parallel rclone jobs, one per subdirectory.</span><br><span class="line">&#123;&#125;: Placeholder for each directory from find.</span><br><span class="line">&#123;/&#125;: Basename of the directory (e.g., subdir1 from the full path).</span><br></pre></td></tr></table></figure></li><li><p>rclone copy Part</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--transfers=16: 16 concurrent file transfers per rclone job.</span><br><span class="line">--checkers=32: 32 concurrent file checks (e.g., verifying existence or integrity).</span><br><span class="line">--fast-list: Uses a single API call to list files (faster for remote filesystems like CephFS).</span><br><span class="line">--buffer-size=512M: 512 MB buffer per transfer (reduces disk I/O waits).</span><br><span class="line">--max-backlog=100000: Allows up to 100,000 files to queue before processing.</span><br><span class="line">--use-mmap: Uses memory-mapped I/O for reads (can speed up large files).</span><br><span class="line">--no-traverse: Skips directory traversal for remote sources, relying on listings.</span><br><span class="line">--stats=30s: Shows progress every 30 seconds.</span><br><span class="line">--log-file=rclone_&#123;/&#125;.log: Logs each job to a file named after the subdirectory (e.g., rclone_subdir1.log).</span><br></pre></td></tr></table></figure></li></ul><h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><p><strong>1.</strong>Â To delete all files in a directory except filename, type the command below:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -v !(&quot;filename&quot;)</span><br></pre></td></tr></table></figure><p><strong>2.</strong>Â To delete all files with the exception ofÂ <strong>filename1</strong>Â andÂ <strong>filename2</strong>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -v !(&quot;filename1&quot;|&quot;filename2&quot;) </span><br></pre></td></tr></table></figure><p><strong>3.</strong>Â The example below shows how to remove all files other than allÂ <code>.zip</code>Â files interactively:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -i !(*.zip)</span><br></pre></td></tr></table></figure><p><strong>4.</strong>Â Next, you can delete all files in a directory apart from allÂ <code>.zip</code>Â andÂ <code>.odt</code>Â files as follows, while displaying what is being done:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -v !(*.zip|*.odt)</span><br></pre></td></tr></table></figure><p><strong>5.</strong> åˆ é™¤æŒ‡å®šç›®å½•ä¸‹æŒ‡å®šæ—¥æœŸçš„ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨ <code>find</code> å’Œ <code>rm</code> å‘½ä»¤æ¥åˆ é™¤æŒ‡å®šç›®å½•ä¸‹æŒ‡å®šæ—¥æœŸçš„ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /path/to/directory -type d -mtime +365 -exec rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure><p><strong>6</strong>. åˆ é™¤æŒ‡å®šç›®å½•ä¸‹å‰ä¸€ä¸ªæ˜ŸæœŸçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>find</code> å’Œ <code>rm</code> å‘½ä»¤æ¥åˆ é™¤æŒ‡å®šç›®å½•ä¸‹æŒ‡å®šæ—¥æœŸçš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /path/to/directory -type f -mtime +7 -exec rm &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /path/to/directory -type f -mtime +7 -delete</span><br></pre></td></tr></table></figure><ul><li><p>å¯æŒ‡å®šç›¸å…³åç§°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /var/log -name &quot;*.log&quot; -type f -mtime +30 </span><br></pre></td></tr></table></figure></li></ul><h2 id="du"><a href="#du" class="headerlink" title="du"></a>du</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">du -h --max-depth=1 --exclude=&#x27;proc&#x27; --exclude=&#x27;home&#x27; --exclude=&#x27;mnt&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check actual disk usage</span></span><br><span class="line">du -sh /path/to/mountpoint</span><br></pre></td></tr></table></figure><h2 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=&lt;input&gt; of=&lt;output&gt; [options]</span><br></pre></td></tr></table></figure><p>â€‹    â€¢    if: Specifies the <strong>input file</strong> or device (e.g., /dev/sda or /path/to/file).</p><p>â€‹    â€¢    of: Specifies the <strong>output file</strong> or device (e.g., /dev/sdb or /path/to/file).</p><p>â€‹    â€¢    <strong>bs=SIZE</strong>: Block size, defining how much data to read and write at a time. It can be set to values like 512, 4M, etc. Example: bs=1M reads and writes 1 megabyte at a time.</p><p>â€‹    â€¢    <strong>count=N</strong>: Limits the number of blocks copied. For example, count=100 copies 100 blocks of the size specified by bs.</p><p>â€‹    â€¢    <strong>status=progress</strong>: Shows real-time progress while copying.</p><p>â€‹    â€¢    <strong>conv=notrunc</strong>: Prevents truncation of the output file (useful when appending).</p><p>â€‹    â€¢    <strong>conv=sync</strong>: Pads the input to the full block size with null bytes if necessary.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Copy specify file to specify path</span></span><br><span class="line">sudo dd if=/path/to/image.iso of=/dev/sdX bs=4M status=progress</span><br><span class="line">â€¢if=/path/to/image.iso: Input is an ISO file.</span><br><span class="line">â€¢of=/dev/sdX: Output is the target USB device (e.g., /dev/sdb).</span><br><span class="line">â€¢bs=4M: Sets block size to 4MB for faster copying.</span><br><span class="line">â€¢status=progress: Shows copy progress.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Clone a disk or partition to an image file</span></span><br><span class="line">sudo dd if=/dev/sda of=/path/to/backup.img bs=1M status=progress</span><br><span class="line">â€¢This creates a raw image backup of /dev/sda (entire disk).</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Restore the image created <span class="keyword">in</span> the above example</span></span><br><span class="line">sudo dd if=/path/to/backup.img of=/dev/sda bs=1M status=progress</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Erase a Disk (Overwrite with Zeros)</span></span><br><span class="line">sudo dd if=/dev/zero of=/dev/sdX bs=1M status=progress</span><br><span class="line">â€¢if=/dev/zero: Fills the disk with zeros.</span><br><span class="line">â€¢of=/dev/sdX: Target disk to be wiped.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create a File of a Specific Size</span></span><br><span class="line">dd if=/dev/urandom of=randomfile.bin bs=1M count=1024  # Create a 1GB file of random data</span><br><span class="line">â€¢if=/dev/urandom: Input is random data.</span><br><span class="line">â€¢of=randomfile.bin: Output file.</span><br><span class="line">â€¢bs=1M count=1024: Creates a 1GB file (1024 blocks of 1MB each).</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Test Disk Write Speed</span></span><br><span class="line">dd if=/dev/zero of=testfile bs=1M count=1024 conv=fdatasync status=progress # Measure disk performance by writing a 1GB file</span><br><span class="line">â€¢conv=fdatasync: Ensures data is fully written to disk before timing stops.</span><br></pre></td></tr></table></figure><h2 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> çœç•¥ç›¸åŒå†…å®¹çš„å±•ç¤º</span></span><br><span class="line">diff -y --suppress-common-lines original.txt modified.txt</span><br></pre></td></tr></table></figure><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><ul><li>æŸ¥æ‰¾å…·ä½“æ–‡ä»¶    </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name æ–‡ä»¶åç§°</span><br></pre></td></tr></table></figure><ul><li>æŸ¥æ‰¾æŒ‡å®šç”¨æˆ·çš„æ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ./* -user ç”¨æˆ·å</span><br></pre></td></tr></table></figure><ul><li>æŸ¥æ‰¾æŒ‡å®šç”¨æˆ·ç»„çš„æ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ./* -group ç”¨æˆ·ç»„</span><br></pre></td></tr></table></figure><ul><li><p>åŒ¹é…æŸ¥æ‰¾é™¤äº†æŸä¸ªç‰¹å®šæ–‡ä»¶ç±»å‹ä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶å°†ç»“æœä¼ é€’ç»™ <code>rm</code> å‘½ä»¤è¿›è¡Œåˆ é™¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . ! -name &quot;*.txt&quot; -delete</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…å¤šä¸ª</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . ! \( -name &quot;log4j*&quot; -o -name &quot;flink*&quot; \)</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æŒ‡å®šå¤©æ•°æ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥æ‰¾30å¤©ä¹‹å‰çš„æ–‡ä»¶</span></span><br><span class="line">find &lt;directory&gt; -type f -name &quot;*.tar.gz&quot; -mtime +30</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥æ‰¾30å¤©ä¹‹å†…çš„æ–‡ä»¶</span></span><br><span class="line">find &lt;directory&gt; -type f -name &quot;*.tar.gz&quot; -mtime -30</span><br></pre></td></tr></table></figure></li></ul><h2 id="findmnt"><a href="#findmnt" class="headerlink" title="findmnt"></a>findmnt</h2><blockquote><p>åˆ—ä¸¾æ‰€æœ‰æŒ‚è½½ç›˜</p></blockquote><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><ul><li>å»é™¤åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²çš„è¡Œï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -v &quot;pattern&quot; inputfile &gt; outputfile</span><br></pre></td></tr></table></figure><p>å‚æ•° <code>-v</code> æ˜¯ç”¨æ¥åå‘åŒ¹é…çš„é€‰é¡¹ï¼Œå®ƒä¼šå°†ä¸åŒ¹é…æŒ‡å®šæ¨¡å¼çš„è¡Œè¾“å‡º</p><ul><li>æŸ¥æ‰¾æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶å†…å®¹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep -rn &quot;info&quot; *</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šæ£€ç´¢ç›®å½•ï¼ŒæŒ‡å®šæ’å‡ºç›®å½•ï¼ˆexclude-dirå¯å¤šæ¬¡ä½¿ç”¨ï¼‰</span></span><br><span class="line">grep -rn &quot;info&quot; /home/rdx --exclude-dir=&quot;log&quot;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢å¤§æ–‡ä»¶é‡Œé¢çš„å†…å®¹</li></ul><p>æ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨ç®¡é“ç¬¦å¯ä»¥å®ç°è¿‡æ»¤æ—¢æ»¡è¶³æ—¶é—´åˆæ»¡è¶³ipçš„è¡Œã€‚</span><br><span class="line">grep -n -e â€œ10.198.2.133â€ prometheus.log |grep -e â€œ2019-09-24â€|head -n 3</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š<br>-n å‚æ•°çš„ä½œç”¨æ˜¯æ˜¾ç¤ºæŸ¥æ‰¾ç»“æœçš„æ‰€åœ¨è¡Œå·<br>-e å‚æ•°è¡¨ç¤ºæˆ‘ä»¬éœ€è¦æœç´¢çš„å…³é”®å­—ï¼Œå¤šä¸ªå…³é”®å­—å°±ç”¨å¤šä¸ª -e å‚æ•°<br>prometheus.log è¡¨ç¤ºå¾…æœç´¢çš„å¤§æ—¥å¿—æ–‡ä»¶<br>head -n 3 è¡¨ç¤ºæ˜¾ç¤ºå‰é¢æŸ¥è¯¢ç»“æœçš„å‰ä¸‰æ¡è®°å½•</p><ul><li>æ’é™¤æŒ‡å®šå†…å®¹</li></ul><p>è¦ä»…æ‰“å°ä¸æœç´¢æ¨¡å¼ä¸åŒ¹é…çš„è¡Œï¼Œå¯ä»¥ä½¿ç”¨grepçš„<code>-v</code>æˆ–<code>--invert-match</code>é€‰é¡¹ã€‚è¿›è¡Œåè½¬çš„åŒ¹é…ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -v xxx</span><br></pre></td></tr></table></figure><ul><li><p>é™å®šæŸ¥è¯¢ç»“æœä¹‹åçš„å‰å‡ è¡Œ</p><p> <code>grep -m 10 &lt;pattern&gt; &lt;file&gt; </code></p></li><li><p>é™å®šæŸ¥è¯¢ç»“æœå€’æ•°çš„å‡ è¡Œ</p><p> <code>grep &lt;pattern&gt; &lt;file&gt; | tail -10</code></p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Match any of multiple strings (OR logic)</span></span><br><span class="line">grep -E &#x27;pattern1|pattern2|pattern3&#x27; filename</span><br></pre></td></tr></table></figure><ul><li><p>æŸ¥çœ‹å‘¨å›´è¡Œæ•°çš„å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-A n # Show n lines after the match</span><br><span class="line">-B n # Show n lines before the match</span><br><span class="line">-C n # Show n lines around the match</span><br></pre></td></tr></table></figure></li></ul><h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><p><code>ls -lh</code>ä»¥å¯è¯»æ€§Gã€MæŸ¥çœ‹æ–‡ä»¶çš„å¤§å°</p><h2 id="link"><a href="#link" class="headerlink" title="link"></a>link</h2><ul><li><p>åˆ›å»ºè½¯è¿æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln  -s  [æºæ–‡ä»¶æˆ–ç›®å½•]  [ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•]</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾æŒ‡å®šç›®å½•çš„è½¯è¿æ¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -alR | grep ^l</span><br></pre></td></tr></table></figure></li><li><p>relink</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ln -sf &lt;new_target&gt; &lt;link_name&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> -s: Create a symbolic link.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -f: Force overwriting an existing link.</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><ul><li><p>æ›¿æ¢å­—ç¬¦</p><p>linuxç¯å¢ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/Search_String/Replacement_String/g&#x27; Input_File</span><br></pre></td></tr></table></figure><p>macç¯å¢ƒï¼ˆéœ€è¦è®¾ç½®å¤‡ä»½ï¼Œä»¥é˜²æ–‡ä»¶æŸåï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i .bak &#x27;s/Search_String/Replacement_String/g&#x27; Input_File</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æŒ‡å®šå¤šè¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;1,5d&#x27; example.txt</span><br></pre></td></tr></table></figure></li></ul><h2 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort --parallel=8 -S 4G -T /data -k2,3 largefile.txt &gt; sorted_file.txt</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨äº†8ä¸ªçº¿ç¨‹å¹¶è¡Œæ’åºï¼Œå¹¶ä¸”sortå‘½ä»¤åœ¨æ’åºè¿‡ç¨‹ä¸­æœ€å¤šä½¿ç”¨4GBçš„å†…å­˜ç¼“å†²åŒºã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äº†<code>-T /data</code>é€‰é¡¹ï¼ŒæŒ‡å®šsortå‘½ä»¤ä½¿ç”¨/dataç›®å½•æ¥å­˜å‚¨ä¸´æ—¶æ–‡ä»¶ï¼Œè€Œä¸æ˜¯é»˜è®¤è·¯å¾„ã€‚</p><p>â€œ-k1,2â€è¡¨ç¤ºå…ˆæŒ‰ç…§ç¬¬1åˆ—æ’åºï¼Œè‹¥ç¬¬1åˆ—ç›¸åŒåˆ™æŒ‰ç…§ç¬¬2åˆ—æ’åºã€‚</p></blockquote><h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><ul><li><p>c â€“ Creates a new .tar archive file.</p></li><li><p>x â€” to untar or extract a tar file</p></li><li><p>v â€“ Verbosely show the .tar file progress.</p></li><li><p>f â€“ File name type of the archive file.</p></li><li><p>z â€” gzip archive file</p></li><li><p>j â€”  bz2 feature compress and create archive file</p></li><li><p>t â€” to list the contents of tar archive file</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> extract files to a specific destination directory</span></span><br><span class="line">tar -xvf &lt;archive.tar&gt; -C &lt;destination_directory&gt;</span><br></pre></td></tr></table></figure><h2 id="tr"><a href="#tr" class="headerlink" title="tr"></a>tr</h2><p>tr â€“ translate or delete characters </p><ul><li><p>å¤§å°å†™è½¬æ¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat file | tr A-Z a-z </span><br><span class="line">cat file | tr a-z A-Z</span><br></pre></td></tr></table></figure></li></ul><h2 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h2><ul><li>è¯­æ³•</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼šwc [é€‰é¡¹] æ–‡ä»¶â€¦</span><br><span class="line">  - c ç»Ÿè®¡å­—èŠ‚æ•°ã€‚</span><br><span class="line">  - l ç»Ÿè®¡è¡Œæ•°ã€‚</span><br><span class="line">  - w ç»Ÿè®¡å­—æ•°ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç»Ÿè®¡ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æ•°é‡</span></span><br><span class="line">find /path/to/directory -type f | wc -l</span><br></pre></td></tr></table></figure><h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><ul><li>ä¸‹è½½æŒ‡å®šç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -r --no-parent http://abc.tamu.edu/projects/tzivi/repository/revisions/2/raw/tzivi/</span><br></pre></td></tr></table></figure><h1 id="senario"><a href="#senario" class="headerlink" title="senario"></a>senario</h1><h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Check filesystem <span class="built_in">type</span></span></span><br><span class="line">df -T /path/to/mountpoint</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ–‡ä»¶"><a href="#åˆ›å»ºæ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ–‡ä»¶"></a>åˆ›å»ºæ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> method 2</span></span><br><span class="line">fallocate -l 1G fileName</span><br></pre></td></tr></table></figure><p><strong>dd</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/zero of=/path/to/directory/filename bs=block_size count=number_of_blocks</span><br><span class="line"><span class="meta">#</span><span class="bash"> Create a 100MB File <span class="keyword">in</span> /tmp/</span></span><br><span class="line">dd if=/dev/zero of=/tmp/testfile.img bs=1M count=100</span><br></pre></td></tr></table></figure><ul><li><strong><code>if=/dev/zero</code></strong>: Input file (<code>/dev/zero</code> provides null bytes; use <code>/dev/urandom</code> for random data).</li><li><strong><code>of=/path/to/directory/filename</code></strong>: Output file path and name.</li><li><strong><code>bs</code></strong>: Block size (e.g., <code>1K</code>, <code>1M</code>, <code>1G</code>).</li><li><strong><code>count</code></strong>: Number of blocks to write</li></ul><h2 id="æ–‡ä»¶åˆ†å‰²"><a href="#æ–‡ä»¶åˆ†å‰²" class="headerlink" title="æ–‡ä»¶åˆ†å‰²"></a>æ–‡ä»¶åˆ†å‰²</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">split [-a] [-b] [-C] [-l] [è¦åˆ†å‰²çš„æ–‡ä»¶å] [åˆ†å‰²åçš„æ–‡ä»¶åå‰ç¼€]</span><br><span class="line">â€“version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">â€“ æˆ–è€…-l,æŒ‡å®šæ¯å¤šå°‘è¡Œåˆ‡å‰²ä¸€æ¬¡ï¼Œç”¨äºæ–‡æœ¬æ–‡ä»¶åˆ†å‰²</span><br><span class="line">-b æŒ‡å®šåˆ‡å‰²æ–‡ä»¶å¤§å°,å•ä½ m æˆ– k</span><br><span class="line">-C ä¸-bç±»ä¼¼ï¼Œä½†å°½é‡ç»´æŒæ¯è¡Œå®Œæ•´æ€§</span><br><span class="line">-d ä½¿ç”¨æ•°å­—è€Œä¸æ˜¯å­—æ¯ä½œä¸ºåç¼€å</span><br><span class="line">-a æŒ‡å®šåç¼€åçš„é•¿åº¦ï¼Œé»˜è®¤ä¸º2ä½</span><br></pre></td></tr></table></figure><p>å°†å¤šä¸ªåˆ†å‰²çš„æ–‡ä»¶è¿›è¡Œåˆå¹¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat files_name_1 files_name_2 files_name_3 &gt; files_name</span><br></pre></td></tr></table></figure><ul><li><p>æŒ‰è¡Œæ•°åˆ†å‰²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split -l 10000 bigfile.txt smallfile</span><br></pre></td></tr></table></figure><blockquote><p>åˆ†å‰²ä¹‹åçš„æ–‡ä»¶ä¸å½±å“è¯»å–</p></blockquote></li><li><p>ç»Ÿè®¡æŸä¸ªæ–‡ä»¶ä¸­çš„å­—ç¬¦æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ–‡ä»¶ä¸­åŒ…å«å¤šå­—èŠ‚å­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ï¼‰ï¼Œåˆ™æ¯ä¸ªå­—ç¬¦å°†è¢«è§†ä¸ºå¤šä¸ªå­—ç¬¦æ¥è®¡ç®—ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc -c /path/to/file</span><br></pre></td></tr></table></figure><p>åœ¨è¿™åŸºç¡€ä¸Šï¼Œç»Ÿè®¡å†…å®¹æ‰€å KB</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc -c /path/to/file | awk &#x27;&#123;print $1/1024&#125;&#x27;</span><br></pre></td></tr></table></figure></li><li><p>awkå¯¹æ–‡ä»¶æŒ‰ç…§æŒ‡å®šå¤šåˆ—çš„å†…å®¹è¿›è¡Œæ’åº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;print $0&#125;&#x27; head_100.csv | sort -t &#x27;,&#x27; -k2,3 &gt; head_100_sort.csv</span><br></pre></td></tr></table></figure><blockquote><p>å¹¶ç”¨<code>sort</code>å‘½ä»¤æ ¹æ®æŒ‡å®šåˆ—çš„å†…å®¹è¿›è¡Œæ’åºã€‚<code>-t</code>é€‰é¡¹è¡¨ç¤ºä½¿ç”¨åˆ¶è¡¨ç¬¦ä½œä¸ºå­—æ®µåˆ†éš”ç¬¦ï¼Œ<code>[åˆ—æ•°]</code>æ˜¯ä½ è¦æ’åºçš„é‚£ä¸€åˆ—ï¼Œâ€œ-k1,2â€è¡¨ç¤ºå…ˆæŒ‰ç…§ç¬¬1åˆ—æ’åºï¼Œè‹¥ç¬¬1åˆ—ç›¸åŒåˆ™æŒ‰ç…§ç¬¬2åˆ—æ’åºã€‚</p></blockquote></li><li><p>ç»Ÿè®¡å­—ç¬¦çš„é•¿åº¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo å­—ç¬¦ | wc -m</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ‰¹é‡æ›¿æ¢æ–‡ä»¶å"><a href="#æ‰¹é‡æ›¿æ¢æ–‡ä»¶å" class="headerlink" title="æ‰¹é‡æ›¿æ¢æ–‡ä»¶å"></a>æ‰¹é‡æ›¿æ¢æ–‡ä»¶å</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename -n -e <span class="string">&#x27;s/å¾…æ›¿æ¢å­—ç¬¦ä¸²/æ›¿æ¢å­—ç¬¦ä¸²/&#x27;</span>  *.png</span><br></pre></td></tr></table></figure><h2 id="è½¬æ¢æ–‡ä»¶ç¼–ç æ ¼å¼"><a href="#è½¬æ¢æ–‡ä»¶ç¼–ç æ ¼å¼" class="headerlink" title="è½¬æ¢æ–‡ä»¶ç¼–ç æ ¼å¼"></a>è½¬æ¢æ–‡ä»¶ç¼–ç æ ¼å¼</h2><ul><li><p>æŸ¥çœ‹ç¼–ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vim</span></span><br><span class="line">:set fileencoding</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> file</span></span><br><span class="line">file -i filename</span><br></pre></td></tr></table></figure></li><li><p>è½¬æ¢ç¼–ç </p></li></ul><p>ç„¶åä½¿ç”¨ <code>iconv</code> è¿›è¡Œç¼–ç æ ¼å¼çš„è½¬æ¢ï¼Œæ¯”å¦‚å°†ä¸€ä¸ª utf-8 ç¼–ç çš„æ–‡ä»¶è½¬æ¢æˆ GBK ç¼–ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> iconv -f UTF-8 -t GBK input.file -o output.file</span></span><br></pre></td></tr></table></figure><ul><li><p>å¦‚æœé‡åˆ°]iconv: æœªçŸ¥xxxxå¤„çš„éæ³•è¾“å…¥åºåˆ—,ä¸€ç§è§£å†³æ–¹æ³•æ˜¯åŠ å…¥ -cé€‰é¡¹ï¼šå¿½ç•¥æ— æ•ˆå­—ç¬¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iconv -c  -f gb2312 -t utf8 test.txt -o output.file</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iconv -f gb18030 -t UTF-8 input.file -o output.file</span><br><span class="line"></span><br><span class="line">gb18030</span><br></pre></td></tr></table></figure><h2 id="æ ¼å¼åŒ–json"><a href="#æ ¼å¼åŒ–json" class="headerlink" title="æ ¼å¼åŒ–json"></a>æ ¼å¼åŒ–json</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;&#123;&quot;kind&quot;: &quot;Service&quot;, &quot;apiVersion&quot;: &quot;v1&quot;, &quot;status&quot;: &#123;&quot;loadBalancer&quot;: true&#125;&#125;&#x27;|jq .</span><br></pre></td></tr></table></figure><h2 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h2><p>ç”¨zipå‘½ä»¤å¯¹æ–‡ä»¶åŠ å¯†å‹ç¼©å’Œè§£å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip -re filename.zip filename </span><br><span class="line">å›è½¦ï¼Œè¾“å…¥2æ¬¡å¯†ç </span><br></pre></td></tr></table></figure><h2 id="markdownè½¬word"><a href="#markdownè½¬word" class="headerlink" title="markdownè½¬word"></a>markdownè½¬word</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pandoc -o output.docx -f markdown -t docx filename.md</span><br></pre></td></tr></table></figure><h2 id="æ¸…ç†æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ–‡ä»¶"><a href="#æ¸…ç†æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ–‡ä»¶" class="headerlink" title="æ¸…ç†æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ–‡ä»¶"></a>æ¸…ç†æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ–‡ä»¶</h2><h1 id="troubleshooting"><a href="#troubleshooting" class="headerlink" title="troubleshooting"></a>troubleshooting</h1><h2 id="ç£ç›˜å±•ç¤ºç©ºé—´å’Œå®é™…ç©ºé—´ä¸ç¬¦"><a href="#ç£ç›˜å±•ç¤ºç©ºé—´å’Œå®é™…ç©ºé—´ä¸ç¬¦" class="headerlink" title="ç£ç›˜å±•ç¤ºç©ºé—´å’Œå®é™…ç©ºé—´ä¸ç¬¦"></a>ç£ç›˜å±•ç¤ºç©ºé—´å’Œå®é™…ç©ºé—´ä¸ç¬¦</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check deleted process</span></span><br><span class="line">sudo lsof | grep deleted</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Analyzing the Output</span></span><br><span class="line">wsssr_def 1368270 1368507 wsssr_def            root    7w      REG              259,3         0    1180232 /usr/local/wsssr_defence_agent/agent_init (deleted)</span><br><span class="line"></span><br><span class="line">Breaking it down:</span><br><span class="line">Command: wsssr_def (shortened process name, likely wsssr_defence_agent or similar).</span><br><span class="line">PID: 1368270 (process ID).</span><br><span class="line">PPID: 1368507 (parent process ID).</span><br><span class="line">User: root (running as root).</span><br><span class="line">FD: 7w (file descriptor 7, open for writing).</span><br><span class="line">Type: REG (regular file).</span><br><span class="line">Device: 259,3 (device number, matching /dev/nvme0n1p2â€”your root partition).</span><br><span class="line">Size: 0 (reported size is 0 bytesâ€”see below for why this is misleading).</span><br><span class="line">Node: 1180232 (inode number).</span><br><span class="line">File: /usr/local/wsssr_defence_agent/agent_init (deleted) (the deleted file).</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux system command</title>
      <link href="/2016/10/16/linux%20cmd:%20system/"/>
      <url>/2016/10/16/linux%20cmd:%20system/</url>
      
        <content type="html"><![CDATA[<h1 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h1><p><a href="https://linuxconfig.org/bash-scripting-tutorial-for-beginners">Bash Scripting Tutorial for Beginners</a></p><h3 id="Bash-Shell-Scripting-Definition"><a href="#Bash-Shell-Scripting-Definition" class="headerlink" title="Bash Shell Scripting Definition"></a>Bash Shell Scripting Definition</h3><ul><li>Bash:Bourne-Again SHell<br>Bash is a command language interpreter. <h2 id="conclusion"><a href="#conclusion" class="headerlink" title="conclusion"></a>conclusion</h2>Do not be afraid to break things as that is perfectly normal. Troubleshooting and fixing code is perhaps the best booster for you to enhance your understanding of bash scripting and to improve your ability.</li></ul><p><a href="https://linuxconfig.org/bash-scripting-tutorial#h24-stdout-to-screen">Bash scripting Tutorial</a></p><h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1: generate ssh-key <span class="keyword">in</span> all nodes</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"><span class="meta">#</span><span class="bash"> step2: <span class="keyword">in</span> first node</span></span><br><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line"><span class="meta">#</span><span class="bash"> step3: <span class="keyword">in</span> other node</span></span><br><span class="line">ssh-copy-id -i id_rsa.pub ç”¨æˆ·@&lt;first_node&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> step4: <span class="keyword">in</span> first node</span></span><br><span class="line">scp authorized_keys ç”¨æˆ·@&lt;other_node&gt;:~/.ssh/</span><br></pre></td></tr></table></figure><h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- kill seesion </span><br><span class="line">screen -X -S [session # you want to kill] quit</span><br><span class="line">- æ–°å»ºscreenä¼šè¯</span><br><span class="line">screen -S xxx</span><br><span class="line">- æ¢å¤æŒ‡å®šä¼šè¯</span><br><span class="line">screen -r xxx</span><br><span class="line">- æŸ¥çœ‹æ‰€æœ‰ä¼šè¯</span><br><span class="line">screen -ls</span><br><span class="line">- åˆ é™¤æŒ‡å®šä¼šè¯</span><br><span class="line">screen -S xxx -X quit</span><br><span class="line">- å›åˆ°ç»ˆç«¯</span><br><span class="line">Ctrl-a d</span><br></pre></td></tr></table></figure><h3 id="firewall"><a href="#firewall" class="headerlink" title="firewall"></a>firewall</h3><ul><li><p>check status : <code>sudo ufw status</code></p></li><li><p>enable firewall: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw <span class="built_in">enable</span></span><br><span class="line">Command may disrupt existing ssh connections. Proceed with operation (y|n)? y</span><br><span class="line">Firewall is active and enabled on system startup</span><br></pre></td></tr></table></figure></li><li><p>disable firewall</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw <span class="built_in">disable</span></span><br><span class="line">Firewall stopped and disabled on system startup</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç£ç›˜ç›¸å…³"><a href="#ç£ç›˜ç›¸å…³" class="headerlink" title="ç£ç›˜ç›¸å…³"></a>ç£ç›˜ç›¸å…³</h3><ul><li><p>æŸ¥çœ‹ç³»ç»Ÿç£ç›˜å ç”¨æƒ…å†µ    <code> df -h</code></p></li><li><p>æŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶å¤§å°        <code>du -sh</code></p></li><li><p>æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡: <code>du -h --max-depth=1 </code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹userç›®å½•çš„å¤§å°ï¼Œå¹¶ä¸æƒ³çœ‹å…¶ä»–ç›®å½•ä»¥åŠå…¶å­ç›®å½•ï¼š</span><br><span class="line">du -sh user</span><br><span class="line">-sè¡¨ç¤ºæ€»ç»“çš„æ„æ€ï¼Œå³åªåˆ—å‡ºä¸€ä¸ªæ€»ç»“çš„å€¼</span><br><span class="line">du -h --max-depth=0 user</span><br><span class="line">--max-depth=nè¡¨ç¤ºåªæ·±å…¥åˆ°ç¬¬nå±‚ç›®å½•ï¼Œæ­¤å¤„è®¾ç½®ä¸º0ï¼Œå³è¡¨ç¤ºä¸æ·±å…¥åˆ°å­ç›®å½•ã€‚</span><br></pre></td></tr></table></figure></li><li><p>æ€»ç»“duå¸¸ç”¨å‘½ä»¤</p><p><strong>du -h â€“max-depth=1 |grep â€˜Gâ€™ |sort   #æŸ¥çœ‹ä¸ŠGç›®å½•å¹¶æ’åº</strong></p><p>du -h â€“max-depth=1 |grep [TG] |sort   #æŸ¥æ‰¾ä¸ŠGå’ŒTçš„ç›®å½•å¹¶æ’åº<br>du -sh â€“max-depth=1  #æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ä¸€çº§å­ç›®å½•æ–‡ä»¶å¤¹å¤§å°</p></li><li><p>æ¸…ç†æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶</p><p>ä¾‹å¦‚éœ€è¦æ ¹æ®æ—¶é—´åˆ é™¤è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œ/tmpï¼Œæ¸…ç†æ‰20å¤©ä¹‹å‰çš„æ— æ•ˆæ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸€æ¡å‘½ä»¤å»å®Œæˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">find /tmp -mtime +21 -name &quot;*&quot; -exec rm -Rf &#123;&#125; \;</span><br><span class="line">- /tmp ï¼šå‡†å¤‡è¦è¿›è¡Œæ¸…ç†çš„ä»»æ„ç›®å½•</span><br><span class="line">- -mtimeï¼šæ ‡å‡†è¯­å¥å†™æ³•</span><br><span class="line">- ï¼‹10ï¼šæŸ¥æ‰¾10å¤©å‰çš„æ–‡ä»¶ï¼Œè¿™é‡Œç”¨æ•°å­—ä»£è¡¨å¤©æ•°ï¼Œï¼‹30è¡¨ç¤ºæŸ¥æ‰¾30å¤©å‰çš„æ–‡ä»¶</span><br><span class="line">- &quot;*&quot;ï¼šå¸Œæœ›æŸ¥æ‰¾çš„æ•°æ®ç±»å‹ï¼Œ&quot;.jpg&quot;è¡¨ç¤ºæŸ¥æ‰¾æ‰©å±•åä¸ºjpgçš„æ‰€æœ‰æ–‡ä»¶ï¼Œ&quot;&quot;è¡¨ç¤ºæŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶</span><br><span class="line">- -execï¼šå›ºå®šå†™æ³•</span><br><span class="line">- rm -Rfï¼šå¼ºåˆ¶åˆ é™¤æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç›®å½•(æ³¨æ„Rå¤§å†™ï¼Œfå°å†™)</span><br><span class="line">-  &#123;&#125; \; å›ºå®šå†™æ³•ï¼Œä¸€å¯¹å¤§æ‹¬å·+ç©ºæ ¼+\+; </span><br></pre></td></tr></table></figure></li></ul><h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p>æŸ¥çœ‹å†å²å‘½ä»¤ï¼Œæ”¯æŒ grepè¿‡æ»¤æ“ä½œ</p><h3 id="swap"><a href="#swap" class="headerlink" title="swap"></a>swap</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> temp</span></span><br><span class="line">sudo swapoff -a</span><br><span class="line"><span class="meta">#</span><span class="bash"> persistent</span></span><br><span class="line">sudo sed -i &#x27;/[[:space:]]swap[[:space:]]/s/^/#/&#x27; /etc/fstab</span><br></pre></td></tr></table></figure><h3 id="top"><a href="#top" class="headerlink" title="top"></a>top</h3><ul><li><p>â€œ1â€</p><p>æŸ¥çœ‹æ‰€æœ‰CPUæ ¸çš„ä½¿ç”¨æƒ…å†µ</p></li><li><p>â€œcâ€</p><p>æŸ¥çœ‹å…·ä½“è¿›ç¨‹çš„è·¯å¾„</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">l- å¼€å¯æˆ–å…³é—­ç¬¬ä¸€éƒ¨åˆ†ç¬¬ä¸€è¡Œtopä¿¡æ¯æ˜¾ç¤º</span><br><span class="line">t - å¼€å¯æˆ–å…³é—­ç¬¬ä¸€éƒ¨åˆ†ç¬¬äºŒè¡ŒTaskså’Œç¬¬ä¸‰è¡Œ Cpu(s)Â ä¿¡æ¯æ˜¾ç¤º</span><br><span class="line">m - å¼€å¯æˆ–å…³é—­ç¬¬ä¸€éƒ¨åˆ†ç¬¬å››è¡Œ Mem å’Œ ç¬¬äº”è¡Œ Swap ä¿¡æ¯æ˜¾ç¤º</span><br><span class="line">N - ä»¥ PID çš„å¤§å°çš„é¡ºåºæ’åˆ—è¡¨ç¤ºè¿›ç¨‹åˆ—è¡¨</span><br><span class="line">P - ä»¥ CPU å ç”¨ç‡å¤§å°çš„é¡ºåºæ’åˆ—è¿›ç¨‹åˆ—è¡¨</span><br><span class="line">M - ä»¥å†…å­˜å ç”¨ç‡å¤§å°çš„é¡ºåºæ’åˆ—è¿›ç¨‹åˆ—è¡¨</span><br><span class="line">h - æ˜¾ç¤ºå¸®åŠ©</span><br><span class="line">n - è®¾ç½®åœ¨è¿›ç¨‹åˆ—è¡¨æ‰€æ˜¾ç¤ºè¿›ç¨‹çš„æ•°é‡ï¼ˆæŒ‰å®Œnï¼Œå†è¾“å…¥ä¸ªæ•°ï¼‰</span><br><span class="line">q - é€€å‡º top</span><br><span class="line">s - è®¾ç½®æ˜¾ç¤ºä¿¡æ¯çš„åˆ·æ–°é¢‘ç‡ï¼ˆç”±äºæ˜¯å‘½ä»¤è¡Œæ¨¡å¼ï¼Œæ˜¾ç¤ºçš„è¿‡ç¨‹å…¶å®æ˜¯åˆ·å±çš„è¿‡ç¨‹ï¼‰</span><br></pre></td></tr></table></figure><ul><li><p>è¿›ç¨‹CPUå ç”¨ç‡</p><p>topæ˜¾ç¤ºæŸä¸ªè¿›ç¨‹å ç”¨cpuè¾¾åˆ°100%ï¼Œåˆ™è¡¨æ˜è¯¥è¿›ç¨‹æ­£åœ¨ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„ CPU èµ„æºã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºè¯¥è¿›ç¨‹æ‰§è¡Œçš„ä»»åŠ¡éå¸¸è€—è´¹ CPU èµ„æºï¼Œæˆ–è€…è¯¥è¿›ç¨‹å­˜åœ¨æŸäº›é—®é¢˜å¯¼è‡´ CPU ä½¿ç”¨ç‡å¼‚å¸¸é«˜ã€‚</p><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åªèƒ½åœ¨å•ä¸ª CPU æ ¸å¿ƒä¸Šè¿è¡Œã€‚ä½†æ˜¯ï¼Œç³»ç»Ÿå¯ä»¥é€šè¿‡è°ƒåº¦ç¨‹åºï¼ˆschedulerï¼‰åœ¨å¤šä¸ª CPU æ ¸å¿ƒä¹‹é—´è½®æ¢è¿è¡Œè¿›ç¨‹ï¼Œä»è€Œè¾¾åˆ°è®©å¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰§è¡Œçš„æ•ˆæœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">### cpu</span><br><span class="line">usï¼šç”¨æˆ·æ€ä½¿ç”¨çš„cpuæ—¶é—´æ¯”</span><br><span class="line">syï¼šç³»ç»Ÿæ€ä½¿ç”¨çš„cpuæ—¶é—´æ¯”</span><br><span class="line">niï¼šç”¨åšniceåŠ æƒçš„è¿›ç¨‹åˆ†é…çš„ç”¨æˆ·æ€cpuæ—¶é—´æ¯”</span><br><span class="line">idï¼šç©ºé—²çš„cpuæ—¶é—´æ¯”</span><br><span class="line">waï¼šcpuç­‰å¾…ç£ç›˜å†™å…¥å®Œæˆæ—¶é—´</span><br><span class="line">hiï¼šç¡¬ä¸­æ–­æ¶ˆè€—æ—¶é—´</span><br><span class="line">siï¼šè½¯ä¸­æ–­æ¶ˆè€—æ—¶é—´</span><br><span class="line">stï¼šè™šæ‹Ÿæœºå·å–æ—¶é—´</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>è¿‡æ»¤æŒ‡å®šè¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step1</span> </span><br><span class="line">o (å°å†™å­—æ¯)</span><br><span class="line"><span class="meta">#</span><span class="bash"> step2</span></span><br><span class="line">COMMAND=&lt;process_name&gt;</span><br></pre></td></tr></table></figure></li></ul><h1 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h1><h2 id="OOM"><a href="#OOM" class="headerlink" title="OOM"></a>OOM</h2><h3 id="ç§¯åˆ†æœºåˆ¶"><a href="#ç§¯åˆ†æœºåˆ¶" class="headerlink" title="ç§¯åˆ†æœºåˆ¶"></a>ç§¯åˆ†æœºåˆ¶</h3><blockquote><p>OOMï¼ˆOut-Of-Memoryï¼‰ç§¯åˆ†æœºåˆ¶æ˜¯ Linux å†…æ ¸åœ¨ç³»ç»Ÿå†…å­˜è€—å°½æ—¶ï¼Œé€šè¿‡è¯„ä¼°è¿›ç¨‹çš„ä¼˜å…ˆçº§å’Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ç»ˆæ­¢ä»¥é‡Šæ”¾å†…å­˜çš„ä¸€ç§æœºåˆ¶ã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯åœ¨å†…å­˜ä¸è¶³æ—¶ï¼Œæœ€å°åŒ–ç³»ç»Ÿå´©æºƒé£é™©å¹¶ä¼˜å…ˆä¿ç•™å…³é”®è¿›ç¨‹ã€‚</p></blockquote><p><strong>OOM ç§¯åˆ†æœºåˆ¶çš„å·¥ä½œåŸç†</strong></p><ol><li><strong><code>oom_score</code> è®¡ç®—</strong><br>æ¯ä¸ªè¿›ç¨‹çš„ <code>oom_score</code>ï¼ˆä½äº <code>/proc/&lt;pid&gt;/oom_score</code>ï¼‰å†³å®šäº†å®ƒè¢« OOM Killer é€‰ä¸­çš„æ¦‚ç‡ã€‚åˆ†æ•°è¶Šé«˜ï¼Œè¿›ç¨‹è¶Šå¯èƒ½è¢«ç»ˆæ­¢ã€‚è®¡ç®—ä¾æ®åŒ…æ‹¬ï¼š<ul><li><strong>å†…å­˜ä½¿ç”¨é‡</strong>ï¼šè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜å’Œäº¤æ¢åˆ†åŒºï¼ˆSwapï¼‰çš„æ€»å’Œã€‚</li><li><strong>è¿è¡Œæ—¶é—´</strong>ï¼šé•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹å¯èƒ½è¢«é€‚å½“ä¿æŠ¤ï¼ˆé€šè¿‡ <code>oom_score_adj</code> è°ƒæ•´ï¼‰ã€‚</li><li><strong>è¿›ç¨‹ä¼˜å…ˆçº§</strong>ï¼šä½ä¼˜å…ˆçº§ï¼ˆé«˜ <code>nice</code> å€¼ï¼‰çš„è¿›ç¨‹æ›´æ˜“è¢«ç»ˆæ­¢ã€‚</li><li><strong>å­è¿›ç¨‹å†…å­˜</strong>ï¼šçˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹å†…å­˜å¯èƒ½è®¡å…¥çˆ¶è¿›ç¨‹çš„è¯„åˆ†ã€‚</li><li><strong>ç”¨æˆ·æƒé™</strong>ï¼šç‰¹æƒè¿›ç¨‹ï¼ˆå¦‚ root ç”¨æˆ·è¿›ç¨‹ï¼‰å¯èƒ½è¢«ä¿æŠ¤ã€‚</li></ul></li><li><strong><code>oom_score_adj</code> è°ƒæ•´å› å­</strong><br>ç”¨æˆ·å¯é€šè¿‡ <code>/proc/&lt;pid&gt;/oom_score_adj</code> æ–‡ä»¶ï¼ˆèŒƒå›´ï¼š<code>-1000</code> åˆ° <code>1000</code>ï¼‰æ‰‹åŠ¨å¹²é¢„è¯„åˆ†ï¼š<ul><li><strong>è´Ÿå€¼</strong>ï¼šé™ä½è¢«ç»ˆæ­¢æ¦‚ç‡ï¼ˆå¦‚ <code>-1000</code> è¡¨ç¤ºå…ç–« OOM Killerï¼‰ã€‚</li><li><strong>æ­£å€¼</strong>ï¼šå¢åŠ è¢«ç»ˆæ­¢æ¦‚ç‡ã€‚</li></ul></li></ol><p><strong>è°ƒæ•´ OOM å‚æ•°çš„å¸¸è§æ–¹æ³•</strong></p><ul><li><p><strong>ä¿æŠ¤å…³é”®è¿›ç¨‹</strong>ï¼š<br>é€šè¿‡ä¿®æ”¹ <code>oom_score_adj</code> é™ä½å…¶è¢«ç»ˆæ­¢çš„æ¦‚ç‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -1000 &gt; /proc/&lt;pid&gt;/oom_score_adj  # ä½¿è¿›ç¨‹å…ç–« OOM Killer</span><br></pre></td></tr></table></figure></li><li><p><strong>å¢å¤§è¿›ç¨‹ç»ˆæ­¢æ¦‚ç‡</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 500 &gt; /proc/&lt;pid&gt;/oom_score_adj     # å¢å¤§ç»ˆæ­¢æ¦‚ç‡</span><br></pre></td></tr></table></figure></li></ul><h1 id="process"><a href="#process" class="headerlink" title="process"></a>process</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check specify process <span class="built_in">limit</span> info</span></span><br><span class="line">cat /proc/&lt;pid&gt;/limits</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check total-vm / anon-rss</span></span><br><span class="line">cat /proc/&lt;pid&gt;/status</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check running during time</span></span><br><span class="line">ps -p &lt;PID&gt; -o etime=</span><br></pre></td></tr></table></figure><ul><li><p>check memory limit</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Get the Cgroup Path</span></span><br><span class="line">cat /proc/&lt;pid&gt;/cgroup  # eg. cat /proc/51683/cgroup</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">print</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 0::/system.slice/dingofs-mount.service</span></span><br><span class="line">cgroup_path=&quot;/sys/fs/cgroup/system.slice/dingofs-mount.service&quot;</span><br><span class="line">cat &quot;$cgroup_path/memory.max&quot;  # print bytes num</span><br></pre></td></tr></table></figure></li></ul><h1 id="operate"><a href="#operate" class="headerlink" title="operate"></a>operate</h1><h3 id="hostname"><a href="#hostname" class="headerlink" title="hostname"></a>hostname</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo hostnamectl set-hostname &lt;new-hostname&gt;</span><br><span class="line">sudo hostnamectl status</span><br></pre></td></tr></table></figure><h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sudoæƒé™ç”¨æˆ·åˆ‡æ¢æˆroot</span></span><br><span class="line">sudo -i</span><br><span class="line">sudo su -</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> add user</span></span><br><span class="line">sudo useradd -m -s /bin/bash &lt;username&gt;</span><br><span class="line"></span><br><span class="line">  dingofs ALL=(ALL) NOPASSWD:ALL</span><br><span class="line"><span class="meta">#</span><span class="bash">-m: Creates a home directory <span class="keyword">for</span> the user.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-s /bin/bash: Sets the default shell to /bin/bash.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> config password</span></span><br><span class="line">passwd &lt;username&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> add user to sudo group</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> opitional-1 ubuntu/debian</span></span><br><span class="line">usermod -aG sudo &lt;username&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> opitional-2 edit visudo</span></span><br><span class="line">visudo</span><br><span class="line">&lt;username&gt; ALL=(ALL) NOPASSWD:ALL</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete user</span></span><br><span class="line">userdel &lt;username&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> uid:65535 to nobody base on gid: nobody 65534</span> </span><br><span class="line">sudo useradd -u 65535 -g 65534 -d /nonexistent -s /usr/sbin/nologin nobody65535</span><br></pre></td></tr></table></figure><h3 id="å¸è½½å®‰è£…çš„è½¯ä»¶"><a href="#å¸è½½å®‰è£…çš„è½¯ä»¶" class="headerlink" title="å¸è½½å®‰è£…çš„è½¯ä»¶"></a>å¸è½½å®‰è£…çš„è½¯ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æµè§ˆå·²å®‰è£…çš„ç¨‹åº    dpkg --list</span><br><span class="line">å¸è½½ç¨‹åºå’Œæ‰€æœ‰é…ç½®æ–‡ä»¶    sudo apt-get --purge remove &lt;programname&gt;</span><br><span class="line">åªå¸è½½ç¨‹åº    sudo apt-get remove &lt;programname&gt;</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…debæ–‡ä»¶å‡ºé”™æ—¶"><a href="#å®‰è£…debæ–‡ä»¶å‡ºé”™æ—¶" class="headerlink" title="å®‰è£…debæ–‡ä»¶å‡ºé”™æ—¶"></a>å®‰è£…debæ–‡ä»¶å‡ºé”™æ—¶</h3><p>ä½¿ç”¨<code>apt-get -f -y install</code>ä¿®å¤ä¹‹åï¼Œå†è¿›è¡Œå®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.æ‰§è¡Œå‘½ä»¤sudo dpkgã€€-iã€€XXX.debã€€è¿”å›ä¾èµ–å…³ç³»é”™è¯¯æç¤º</span><br><span class="line">2.æ‰§è¡Œsudo apt-get -f installã€€è¿™æ¡å‘½ä»¤å°†è‡ªåŠ¨å®‰è£…éœ€è¦çš„ä¾èµ–åŒ…ï¼</span><br><span class="line">3.å†æ¬¡æ‰§è¡Œå‘½ä»¤sudo dpkgã€€-iã€€XXX.debã€€å®‰è£…æˆåŠŸ</span><br></pre></td></tr></table></figure><h3 id="centoså®‰è£…ç¦»çº¿ä¾èµ–"><a href="#centoså®‰è£…ç¦»çº¿ä¾èµ–" class="headerlink" title="centoså®‰è£…ç¦»çº¿ä¾èµ–"></a>centoså®‰è£…ç¦»çº¿ä¾èµ–</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh name.rpm</span><br></pre></td></tr></table></figure><h3 id="å…‰æ ‡"><a href="#å…‰æ ‡" class="headerlink" title="å…‰æ ‡"></a>å…‰æ ‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+aï¼šå…‰æ ‡å›åˆ°å‘½ä»¤è¡Œé¦–ã€‚ ï¼ˆaï¼šaheadï¼‰</span><br><span class="line">Ctrl+eï¼šå…‰æ ‡å›åˆ°å‘½ä»¤è¡Œå°¾ã€‚ ï¼ˆeï¼šendï¼‰</span><br><span class="line">Ctrl+bï¼šå…‰æ ‡å‘è¡Œé¦–ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ã€‚ ï¼ˆbï¼šbackwardsï¼‰</span><br><span class="line">Ctrl+fï¼šå…‰æ ‡å‘è¡Œå°¾ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ã€‚ ï¼ˆfï¼šforwardsï¼‰</span><br><span class="line">Ctrl+w: åˆ é™¤å…‰æ ‡å¤„åˆ°è¡Œé¦–çš„å­—ç¬¦ã€‚</span><br><span class="line">Ctrl+kï¼šåˆ é™¤å…‰æ ‡å¤„åˆ°è¡Œå°¾çš„å­—ç¬¦ã€‚</span><br><span class="line">Ctrl+uï¼šåˆ é™¤æ•´ä¸ªå‘½ä»¤è¡Œæ–‡æœ¬å­—ç¬¦ã€‚</span><br><span class="line">Ctrl+hï¼šå‘è¡Œé¦–åˆ é™¤ä¸€ä¸ªå­—ç¬¦ã€‚</span><br><span class="line">Ctrl+dï¼šå‘è¡Œå°¾åˆ é™¤ä¸€ä¸ªå­—ç¬¦ã€‚</span><br><span class="line"></span><br><span class="line">Ctrl + xx ï¼šåœ¨å‘½ä»¤è¡Œå°¾å’Œå…‰æ ‡ä¹‹é—´ç§»åŠ¨</span><br></pre></td></tr></table></figure><h3 id="æ—¶åŒº"><a href="#æ—¶åŒº" class="headerlink" title="æ—¶åŒº"></a>æ—¶åŒº</h3><p><a href="https://www.cnblogs.com/zhangeamon/p/5500744.html">CentOS 7 æ—¶åŒºè®¾ç½®</a></p><ul><li><p>UTCï¼ˆCoordinated Universal Time ï¼‰æ˜¯å›½é™…æ—¶é—´æ ‡å‡†ï¼Œé€šå¸¸ä¸GMTç›¸åŒï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒUTCå¯èƒ½ä¼šæœ‰é—°ç§’çš„è°ƒæ•´ã€‚</p><ul><li><p>UTC is the global standard for timekeeping.</p></li><li><p>It does not observe Daylight Saving Time (DST).</p></li><li><p>Used as a reference for time zones worldwide.</p></li><li><p>Offset: UTC is the baseline, so its offset is <strong>0 hours</strong>.</p></li></ul></li><li><p>GMTï¼ˆGreenwich Mean Timeï¼‰æ˜¯æ ¼æ—å°¼æ²»æ—¶é—´ï¼Œæ²¡æœ‰å¤ä»¤æ—¶è°ƒæ•´ã€‚</p><ul><li>GMT was historically the global time standard but has largely been replaced by UTC.</li></ul></li><li><p>UTC+N or GMT+N</p><ul><li>In most practical cases, <strong>UTC+N</strong> and <strong>GMT+N</strong> are equivalent.</li><li>Refers to a time zone that is <strong>N hours ahead of UTC (Coordinated Universal Time)</strong>.</li><li><strong>UTC+N</strong> is the modern term and is more precise in technical or scientific contexts (e.g., aviation, computing, telecommunications).</li><li><strong>GMT+N</strong> is an older term that is still widely recognized but less commonly used in formal applications.</li></ul></li></ul><h3 id="æ—¥æœŸ"><a href="#æ—¥æœŸ" class="headerlink" title="æ—¥æœŸ"></a>æ—¥æœŸ</h3><ul><li><p>åˆ¤æ–­ã€€day of year     </p><p><code>doy=$(date +%j)</code></p></li><li><p>åˆ¶å®šæ—¥æœŸå‡ä¸€å¤©</p><p><code>date -d&quot;20140101 -1 days&quot; +&quot;%Y%m%d&quot;</code></p></li><li><p>å½“å‰æ—¶é—´æˆ³ï¼ˆç§’ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date +%s</span><br></pre></td></tr></table></figure></li></ul><h3 id="å‰ªåˆ‡æ¿"><a href="#å‰ªåˆ‡æ¿" class="headerlink" title="å‰ªåˆ‡æ¿"></a>å‰ªåˆ‡æ¿</h3><p>å°†å‰ªåˆ‡æ¿ä¸­çš„å†…å®¹è¾“å‡ºåˆ°æ–‡ä»¶     echo $(xsel â€“clipboard) &gt;&gt; a.txt </p><p>å°†æ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°å‰ªåˆ‡æ¿         cat a.txt | xsel â€“clipboard</p><h3 id="securtCRT"><a href="#securtCRT" class="headerlink" title="securtCRT"></a>securtCRT</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½æœåŠ¡å™¨æ–‡ä»¶  sz filename</span><br><span class="line">ä¸Šä¼ æœ¬åœ°æ–‡ä»¶   rz filename</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„è¿è¡Œæƒ…å†µ"><a href="#æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„è¿è¡Œæƒ…å†µ" class="headerlink" title="æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„è¿è¡Œæƒ…å†µ"></a>æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„è¿è¡Œæƒ…å†µ</h3><ul><li><code>journalctl -u xxx.service</code></li><li><code>journalctl -xe</code> æŸ¥çœ‹æœ€è¿‘ç³»ç»ŸæœåŠ¡æ—¥å¿—</li></ul><h3 id="èµ„æºå ç”¨"><a href="#èµ„æºå ç”¨" class="headerlink" title="èµ„æºå ç”¨"></a>èµ„æºå ç”¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep æœåŠ¡åç§°æˆ–pid</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¾ç¤º</span></span><br><span class="line">root  19496  0.0  2.4 4826152 1603360 ?     Sl    2020 503:15 java -jar -Xms1024m -Xmx1024m jenkins.war --httpPort=55555</span><br><span class="line"></span><br><span class="line">19496 ä¸ºPID</span><br><span class="line">0.0 ä¸ºCPUå ç”¨ç™¾åˆ†æ¯”ï¼ˆæ³¨æ„ï¼šå¦‚æœæœ‰ä¸¤ä¸ªCPUï¼Œ32æ ¸64çº¿ç¨‹ï¼Œé‚£ä¹ˆæ€»å æ¯”æ˜¯6400%ï¼Œå ç”¨ä¸€çº¿ç¨‹ï¼Œcpuå æ¯”æ˜¯100%ï¼‰</span><br><span class="line">2.4 ä¸ºå†…å­˜å ç”¨ç™¾åˆ†æ¯”</span><br></pre></td></tr></table></figure><h1 id="system"><a href="#system" class="headerlink" title="system"></a>system</h1><h2 id="kernel-dumps"><a href="#kernel-dumps" class="headerlink" title="kernel dumps"></a>kernel dumps</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Changing Kernel Crash Dump Directory (<span class="keyword">for</span> kdump)</span></span><br><span class="line">sudo vi /etc/kdump.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Look <span class="keyword">for</span> the line starting with path and change it to your desired directory</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default: /var/crash</span></span><br><span class="line">path /new/crash/directory</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Restart the kdump service:</span></span><br><span class="line">sudo systemctl restart kdump</span><br></pre></td></tr></table></figure><h2 id="core-dumps"><a href="#core-dumps" class="headerlink" title="core dumps"></a>core dumps</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ–¹å¼ä¸€ï¼šè®¾ç½® core æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„</span></span><br><span class="line">echo &quot;/core/core.%e.%p&quot; &gt; /proc/sys/kernel/core_pattern</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">%e is replaced by the executable name.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">%p is replaced by the process ID.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ–¹å¼äºŒï¼š</span></span><br><span class="line">sudo vim /etc/sysctl.conf</span><br><span class="line">kernel.core_pattern=/core/core-%e-%p-%t</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Apply the changes</span></span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure><table><thead><tr><th>Feature</th><th>Kernel Dumps</th><th>Core Dumps</th></tr></thead><tbody><tr><td>Source</td><td>Kernel crashes (kernel panic)</td><td>User-space process crashes</td></tr><tr><td>Trigger</td><td>Kernel panic</td><td>Process signals (e.g., SIGSEGV)</td></tr><tr><td>Contents</td><td>Entire (or partial) system memory</td><td>Process memory</td></tr><tr><td>Tools</td><td>kdump, crash</td><td>gdb, apport, ABRT</td></tr><tr><td>Debugging Scope</td><td>Kernel-level debugging</td><td>User-level application debugging</td></tr><tr><td>Location</td><td>Typically /var/crash</td><td>Specified by core_pattern (/proc/sys/kernel/core_pattern)</td></tr></tbody></table><h2 id="time"><a href="#time" class="headerlink" title="time"></a>time</h2><ul><li><p>running duration or uptime</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> option 1</span></span><br><span class="line">uptime</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> option 2</span></span><br><span class="line">who -b</span><br></pre></td></tr></table></figure></li><li><p>chrony</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> install</span></span><br><span class="line">sudo dnf install chrony -y</span><br><span class="line">sudo systemctl enable chronyd</span><br><span class="line">sudo systemctl start chronyd</span><br><span class="line"><span class="meta">#</span><span class="bash"> config NTP servers</span></span><br><span class="line">sudo vi /etc/chrony.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">server time1.aliyun.com iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">server time2.aliyun.com iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">server ntp.aliyun.com iburst</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restart</span></span><br><span class="line">sudo systemctl restart chronyd</span><br></pre></td></tr></table></figure></li></ul><h2 id="process-1"><a href="#process-1" class="headerlink" title="process"></a>process</h2><ul><li><p>Tree view all process</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree -g</span><br></pre></td></tr></table></figure></li></ul><h2 id="æŸ¥çœ‹ç³»ç»Ÿé…ç½®"><a href="#æŸ¥çœ‹ç³»ç»Ÿé…ç½®" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿé…ç½®"></a>æŸ¥çœ‹ç³»ç»Ÿé…ç½®</h2><ul><li><p>æŸ¥çœ‹ç³»ç»Ÿ</p><ul><li><code>cat /etc/os-release</code></li></ul></li><li><p>æŸ¥çœ‹å†…æ ¸</p><ul><li><code>cat /proc/version</code></li><li><code>uname -a</code></li></ul></li><li><p>æŸ¥çœ‹linuxç‰ˆæœ¬</p><ul><li><code>lsb_release -a</code></li><li><code>cat /etc/issue</code></li></ul></li><li><blockquote><p>æ€»æ ¸æ•° = ç‰©ç†CPUä¸ªæ•° X æ¯é¢—ç‰©ç†CPUçš„æ ¸æ•° </p><p>æ€»é€»è¾‘CPUæ•° = ç‰©ç†CPUä¸ªæ•° X æ¯é¢—ç‰©ç†CPUçš„æ ¸æ•° X è¶…çº¿ç¨‹æ•°</p></blockquote><ul><li><p>æŸ¥çœ‹ç‰©ç†CPUä¸ªæ•°</p><ol><li>topå‘½ä»¤ï¼Œç„¶åè¾“å…¥æ•°å­—1æŸ¥çœ‹ï¼Œå„é¡¹å‚æ•°å¦‚ä¸‹<ul><li><code>us</code>ï¼šç”¨æˆ·ç©ºé—´å ç”¨ CPU çš„ç™¾åˆ†æ¯”ã€‚</li><li><code>sy</code>ï¼šå†…æ ¸ç©ºé—´å ç”¨ CPU çš„ç™¾åˆ†æ¯”ã€‚</li><li><code>ni</code>ï¼šè°ƒæ•´è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨ CPU çš„ç™¾åˆ†æ¯”ã€‚</li><li><code>id</code>ï¼šç©ºé—² CPU çš„ç™¾åˆ†æ¯”ã€‚</li><li><code>wa</code>ï¼šç­‰å¾… I/O çš„ CPU æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</li><li><code>hi</code>ï¼šç¡¬ä¸­æ–­ï¼ˆhardware interruptï¼‰å ç”¨ CPU çš„æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</li><li><code>si</code>ï¼šè½¯ä¸­æ–­ï¼ˆsoftware interruptï¼‰å ç”¨ CPU çš„æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</li><li><code>st</code>ï¼šè™šæ‹Ÿæœºæˆ–è€…è¿è¡Œåœ¨å®ƒä¸Šé¢çš„è™šæ‹Ÿ CPU å ç”¨ CPU çš„æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</li></ul></li><li>è¾“å…¥mpstatæŸ¥çœ‹</li><li>è¾“å…¥ä»¥ä¸‹å‘½ä»¤</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo| grep &quot;physical id&quot;| sort| uniq| wc -l</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ¯ä¸ªç‰©ç†CPUä¸­coreçš„ä¸ªæ•°(å³æ ¸æ•°)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo| grep &quot;cpu cores&quot;| uniq</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é€»è¾‘CPUçš„æ€»æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo| grep &quot;processor&quot;| wc -l</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="æ¸…ç†å†…å­˜"><a href="#æ¸…ç†å†…å­˜" class="headerlink" title="æ¸…ç†å†…å­˜"></a>æ¸…ç†å†…å­˜</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sync; echo 1 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹buff-cache"><a href="#æŸ¥çœ‹buff-cache" class="headerlink" title="æŸ¥çœ‹buff/cache"></a>æŸ¥çœ‹buff/cache</h2><ul><li>å·¥å…·æ¨è <a href="https://github.com/silenceshell/hcache">https://github.com/silenceshell/hcache</a></li></ul><h1 id="troubleshooting"><a href="#troubleshooting" class="headerlink" title="troubleshooting"></a>troubleshooting</h1><h2 id="é¼ æ ‡æŒ‰é”®ä¼šåœ¨ç»ˆç«¯è¾“å…¥ä¹±ç "><a href="#é¼ æ ‡æŒ‰é”®ä¼šåœ¨ç»ˆç«¯è¾“å…¥ä¹±ç " class="headerlink" title="é¼ æ ‡æŒ‰é”®ä¼šåœ¨ç»ˆç«¯è¾“å…¥ä¹±ç "></a>é¼ æ ‡æŒ‰é”®ä¼šåœ¨ç»ˆç«¯è¾“å…¥ä¹±ç </h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> the `reset` <span class="built_in">command</span> helps restore the terminal to a known good state, <span class="built_in">which</span> can be helpful <span class="keyword">in</span> troubleshooting issues or clearing screen clutter.</span></span><br><span class="line">reset</span><br></pre></td></tr></table></figure><h2 id="received-disconnect-from-x-port-22-2-Too-many-authentication-failures"><a href="#received-disconnect-from-x-port-22-2-Too-many-authentication-failures" class="headerlink" title="received disconnect from x port 22:2: Too many authentication failures"></a>received disconnect from x port 22:2: Too many authentication failures</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Remove all keys from the agent</span></span><br><span class="line">ssh-add -D</span><br></pre></td></tr></table></figure><h2 id="etc-hosts-æ–‡ä»¶æ— æ³•ç¼–è¾‘"><a href="#etc-hosts-æ–‡ä»¶æ— æ³•ç¼–è¾‘" class="headerlink" title="/etc/hosts æ–‡ä»¶æ— æ³•ç¼–è¾‘"></a>/etc/hosts æ–‡ä»¶æ— æ³•ç¼–è¾‘</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> the file may have the immutable attribute <span class="built_in">set</span>. Check with:</span></span><br><span class="line">lsattr /etc/hosts</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  remove i flag</span></span><br><span class="line">sudo chattr -i /etc/hosts</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restore</span></span><br><span class="line">sudo chattr +i /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="Cannot-create-a-temporary-file"><a href="#Cannot-create-a-temporary-file" class="headerlink" title="Cannot create a temporary file"></a>Cannot create a temporary file</h2><blockquote><p>Cannot create a temporary file /var/tmp/sclhOLz2G: No space left on device</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç°è±¡</span></span><br><span class="line">ä»»ä½•æ“ä½œå‡ä¼šæç¤º ä»¥ä¸ŠæŠ¥é”™</span><br><span class="line"><span class="meta">#</span><span class="bash"> åŸå› </span></span><br><span class="line">ç³»ç»Ÿç›˜å·²æ»¡</span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å†³</span></span><br><span class="line">åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œæ¸…ç†ä¸€äº›ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå°¤å…¶æ’æŸ¥ä¸‹ core æ–‡ä»¶</span><br></pre></td></tr></table></figure><h2 id="root-filesystem-xxx-UNEXPECTED-INCONSISTENCY-RUN-fsck-MANUALLY"><a href="#root-filesystem-xxx-UNEXPECTED-INCONSISTENCY-RUN-fsck-MANUALLY" class="headerlink" title="root filesystem xxx UNEXPECTED INCONSISTENCY; RUN fsck MANUALLY"></a>root filesystem xxx UNEXPECTED INCONSISTENCY; RUN fsck MANUALLY</h2><ul><li><p>issuse</p><img src="/images/linux/issuse-root_filesystem.png"></li><li><p>resolve</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fsck /dev/mapper/ubuntu--vg-ubuntu--lv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">When prompted, <span class="built_in">type</span> y to accept each fix suggestion, or a to fix all.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Once fsck completes successfully, reboot the system:</span></span><br><span class="line">exec reboot -f</span><br></pre></td></tr></table></figure></li></ul><h2 id="A-fatal-error-was-detected-on-a-component-at-bus-0-device-2-function-0"><a href="#A-fatal-error-was-detected-on-a-component-at-bus-0-device-2-function-0" class="headerlink" title="A fatal error was detected on a component at bus 0 device 2 function 0."></a>A fatal error was detected on a component at bus 0 device 2 function 0.</h2><ul><li><p>identify what device is at <code>bus 0 device 2 function 0</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lspci -s 00:02.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">e.g. console <span class="built_in">print</span></span></span><br><span class="line">00:02.0 PCI bridge: Intel Corporation Xeon E7 v4/Xeon E5 v4/Xeon E3 v4/Xeon D PCI Express Root Port 2 (rev 01)</span><br></pre></td></tr></table></figure></li><li><p>list all PCI devices hierarchically and see whatâ€™s attached behind the 00:02.0 bridge:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">lspci -t -vv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">e.g. console <span class="built_in">print</span></span></span><br><span class="line"> \-[0000:00]-+-00.0  Intel Corporation Xeon E7 v4/Xeon E5 v4/Xeon E3 v4/Xeon D DMI2</span><br><span class="line">             +-01.0-[02]----00.0  Broadcom / LSI MegaRAID SAS-3 3108 [Invader]</span><br><span class="line">             +-02.0-[03]----00.0  Samsung Electronics Co Ltd NVMe SSD Controller S4LV008[Pascal]</span><br><span class="line">             +-03.0-[01]--+-00.0  Broadcom Inc. and subsidiaries BCM57412 NetXtreme-E 10Gb RDMA Ethernet Controller</span><br><span class="line">             ...</span><br><span class="line">             </span><br><span class="line"><span class="meta">#</span><span class="bash"> Explanation</span></span><br><span class="line">The PCIe fatal bus error you previously saw (bus 0 device 2 function 0) corresponds to:</span><br><span class="line">- A PCIe root port (00:02.0)</span><br><span class="line">- Leading to a Samsung NVMe SSD</span><br></pre></td></tr></table></figure></li><li><p>check NVMe Devices to PCIe Slots</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls -l /sys/block/ | grep nvme</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">e.g. console <span class="built_in">print</span></span></span><br><span class="line">lrwxrwxrwx. 1 root root 0 Apr 22 14:18 nvme0n1 -&gt; ../devices/pci0000:00/0000:00:02.0/0000:03:00.0/nvme/nvme0/nvme0n1</span><br><span class="line">lrwxrwxrwx. 1 root root 0 Apr 22 14:18 nvme1n1 -&gt; ../devices/pci0000:00/0000:00:03.2/0000:04:00.0/nvme/nvme1/nvme1n1</span><br><span class="line">lrwxrwxrwx. 1 root root 0 Apr 22 14:18 nvme2n1 -&gt; ../devices/pci0000:80/0000:80:02.0/0000:82:00.0/nvme/nvme2/nvme2n1</span><br></pre></td></tr></table></figure></li></ul><p><strong>other check</strong></p><ul><li><p>check drive health</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvme smart-log /path/to/device  # e.g. nvme smart-log /dev/nvme0</span><br></pre></td></tr></table></figure></li><li><p>check again for PCIe or I/O errors</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep -iE &quot;nvme|pcie|error&quot;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git</title>
      <link href="/2016/08/05/git/"/>
      <url>/2016/08/05/git/</url>
      
        <content type="html"><![CDATA[<h1 id="architecture"><a href="#architecture" class="headerlink" title="architecture"></a>architecture</h1><img src="/images/git/git flow.JPG" style="zoom:50%"><p><strong>command</strong></p><img src="/images/git/git command.JPG" style="zoom:100%"><h2 id="æ–‡ä»¶ç›¸å…³"><a href="#æ–‡ä»¶ç›¸å…³" class="headerlink" title="æ–‡ä»¶ç›¸å…³"></a>æ–‡ä»¶ç›¸å…³</h2><ul><li><p>æäº¤å•ä¸ªæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git commit &lt;file&gt; -m &quot;your comment&quot; </span><br><span class="line">git pull</span><br><span class="line">git push</span><br></pre></td></tr></table></figure></li><li><p>æäº¤å¤šä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦æ’é™¤æŒ‡å®šçš„æ–‡ä»¶</p><ul><li>method a</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add -u</span><br><span class="line">git reset -- main/dontcheckmein.txt</span><br><span class="line">ç„¶åè¿›è¡Œcommitã€pullç­‰æ“ä½œ</span><br></pre></td></tr></table></figure><ul><li>method b</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add . &#x27;:!&lt;file-to-exclude&gt;&#x27;</span><br></pre></td></tr></table></figure></li><li><p>æ¯”è¾ƒæ–‡ä»¶ï¼Œåœ¨ä¸åŒç‰ˆæœ¬çš„åŒºåˆ«</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> uncommited file to HEAD</span></span><br><span class="line">git diff &lt;path&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> uncommited file to before last commit</span></span><br><span class="line">git diff HEAD^ -- &lt;path&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">last commit to before last commit</span></span><br><span class="line">git diff HEAD^ HEAD -- &lt;path&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">difference between HEAD and n-th grandparent</span></span><br><span class="line">git diff HEAD~n HEAD -- &lt;path&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">Another cool feature is whatchanged <span class="built_in">command</span></span></span><br><span class="line">git whatchanged -- &lt;path&gt;</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤è¿œç¨‹ä»“åº“æ–‡ä»¶ï¼Œä½†ä¿ç•™æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ–‡ä»¶</span></span><br><span class="line">git rm --cached path/to/file</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç›®å½•</span></span><br><span class="line">git rm -r --cached path/to/directory</span><br></pre></td></tr></table></figure></li><li><p>æ’¤é”€ä»£ç ä¿®æ”¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git restore &lt;file&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  reset all tracked files</span></span><br><span class="line">git restore .</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æœªè¢«è¿½è¸ªçš„æ–‡ä»¶æˆ–ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å°†è¦åˆ é™¤çš„æ–‡ä»¶</span></span><br><span class="line">git clean -n</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æœªè¿½è¸ªçš„æ–‡ä»¶</span></span><br><span class="line">git clean -f</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æœªè¿½è¸ªçš„æ–‡ä»¶å’Œç›®å½•</span></span><br><span class="line">git clean -fd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æœªè¿½è¸ªçš„æ–‡ä»¶ã€ç›®å½•å’Œå¿½ç•¥çš„æ–‡ä»¶</span></span><br><span class="line">git clean -fdx</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æŒ‡å®šcommitæäº¤çš„æ–‡ä»¶ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git show --name-only &lt;commit-hash&gt;</span><br><span class="line">git show --name-status &lt;commit-hash&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="fork-ç›¸å…³"><a href="#fork-ç›¸å…³" class="headerlink" title="fork ç›¸å…³"></a>fork ç›¸å…³</h2><p>Git forkåçš„åˆ†æ”¯ï¼Œæ›´æ–°æœ€æ–°çš„æºä»£ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sourcerä¸ºæºé¡¹ç›®ä»£ç </span><br><span class="line">forkerä¸ºforkä¹‹åçš„é¡¹ç›®ä»£ç </span><br><span class="line"></span><br><span class="line">1ã€æ‰¾ä¸€ä¸ªç©ºçš„ç›®å½•ä¸‹ç­¾å‡º fork åçš„ä»£ç </span><br><span class="line">git clone https://github.com/sourcer/demo.git</span><br><span class="line">æŸ¥çœ‹ remote ä¿¡æ¯</span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line">2ã€ç„¶åæ·»åŠ æºé¡¹ç›®åœ°å€ï¼ˆè·ç¦»å®šä¹‰ä¸º sourceï¼‰</span><br><span class="line">git remote add source https://github.com/forker/demo.git</span><br><span class="line">æŸ¥çœ‹ remote ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢ä¸¤æ¡ä¿¡æ¯</span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line">3ã€fetch æºé¡¹ç›®</span><br><span class="line">git fetch source</span><br><span class="line"></span><br><span class="line">4ã€åˆå¹¶ä»£ç </span><br><span class="line">git merge source/master</span><br><span class="line"></span><br><span class="line">5ã€æŠŠåˆå¹¶æœ€æ–°çš„ä»£ç æ¨é€åˆ°ä½ çš„forké¡¹ç›®ä¸Š</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><h2 id="commitç›¸å…³"><a href="#commitç›¸å…³" class="headerlink" title="commitç›¸å…³"></a>commitç›¸å…³</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ¯ä¸€è¡Œæ˜¯å“ªæ¬¡æäº¤æœ€åä¿®æ”¹çš„</span></span><br><span class="line">git blame filename </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ—å‡ºæ–‡ä»¶çš„æ‰€æœ‰ä¿®æ”¹è®°å½•</span></span><br><span class="line">git log -p filename</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»¥å•è¡Œåˆ—å‡ºcommitä¿¡æ¯</span></span><br><span class="line">git log --oneline</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ—å‡ºshort commit</span></span><br><span class="line">git rev-parse --short HEAD</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹æœ€åä¸€æ¡commitäººå‘˜ä¿¡æ¯</span></span><br><span class="line">git commit --amend --author=&quot;New Name &lt;new.email@example.com&gt;&quot;</span><br></pre></td></tr></table></figure><h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><ul><li><p>config commit identity</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &quot;you@example.com&quot;</span><br><span class="line">git config --global user.name &quot;Your Name&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Setting these values with --global applies them to all repositories on your machine. You can also <span class="built_in">set</span> them at the repository level by omitting --global, <span class="keyword">in</span> <span class="built_in">which</span> <span class="keyword">case</span> they will override the global settings <span class="keyword">for</span> that specific project.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g.</span></span><br><span class="line">git config  user.email &quot;jackblack369@163.com&quot;</span><br><span class="line">git config  user.name &quot;DongWei&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Git automatically converts CRLF to LF when committing and back to CRLF when checking out.</span></span><br><span class="line">git config --global core.autocrlf</span><br></pre></td></tr></table></figure></li><li><p>commit info</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure></li><li><p>Type</p><blockquote><p>You can use your own commit types, but here are the most common use cases:</p></blockquote><ul><li><p>feat: a new feature, or change to an existing feature.</p></li><li><p>fix: Fixing a bug or known issue in code.</p></li><li><p>test: Adding additional tests for existing features.</p></li><li><p>chore: Updating build tools, like webpack, gulp, ascripts, etc.</p></li><li><p>docs: Update to documentation like README, wiki, etc.</p></li></ul></li><li><p>Scope</p><blockquote><p>The scope of the commit can be kept as granular as required and is bound to change based on the complexity of the project. If you are starting off a project, it might not seem necessary at the beginning, although, it is highly recommended as it makes you think twice and harder about the changes that you are about to push.</p></blockquote></li><li><p>reference <a href="https://hackernoon.com/7-rules-for-writing-a-good-commit-message">7 Rules for Writing a Good Commit Message</a></p></li></ul><h3 id="amend"><a href="#amend" class="headerlink" title="amend"></a>amend</h3><blockquote><p>In Git, the â€“amend option is used with the git commit command to modify the most recent commit. It allows you to make changes to the last commit without creating a new one, which is helpful for fixing small mistakes such as a missing file, a typo in the commit message, or an incorrect change.</p></blockquote><ul><li><p><strong>Example 1: Fixing a Commit Message</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Suppose you made a commit but realized there was a typo <span class="keyword">in</span> the message:</span></span><br><span class="line">git commit -m &quot;Fixing a bugg in login&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To correct the message, This will update the last commit with the corrected message.</span></span><br><span class="line">git commit --amend -m &quot;Fixing a bug in login&quot;</span><br></pre></td></tr></table></figure></li><li><p><strong>Example 2: Adding Missing Changes</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> You commit some changes but forgot to include a file:</span></span><br><span class="line">git commit -m &quot;Add login functionality&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Later, you realize that you forgot to add auth.js. To fix this:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.Stage the missing file:</span></span><br><span class="line">git add auth.js</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.Amend the commit:</span></span><br><span class="line">git commit --amend</span><br></pre></td></tr></table></figure><p>Git will open an editor to let you modify the commit message if needed. Save and close the editor to complete the process.</p></li></ul><p><strong>Important Notes</strong></p><ol><li><strong>Avoid amending commits that have already been pushed</strong></li></ol><p>Amending changes the commitâ€™s hash, which can lead to problems if others have already pulled the original commit.</p><ol start="2"><li><strong>Use in Local Development</strong></li></ol><p><code>git commit --amend</code> is best used in local branches before pushing changes to a shared repository.</p><h2 id="å›æ»š"><a href="#å›æ»š" class="headerlink" title="å›æ»š"></a>å›æ»š</h2><ul><li><p>method 1: é‡ç½®å½“å‰åˆ†æ”¯çš„ HEAD æŒ‡é’ˆä»¥åŠå·¥ä½œç›®å½•å’Œæš‚å­˜åŒºçš„å†…å®¹åˆ°æŒ‡å®šçš„æäº¤ï¼Œæ“¦é™¤äº†ç›®æ ‡æäº¤ä¹‹åçš„æ‰€æœ‰æäº¤å†å²ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard &lt;commit-id&gt;</span><br></pre></td></tr></table></figure></li><li><p>Method 2: åªæƒ³å›æ»šåˆ°æŒ‡å®šæäº¤ï¼Œå¹¶ä¿ç•™åç»­æäº¤å†å²</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;commit-id&gt;</span><br></pre></td></tr></table></figure></li><li><p>å›æ»šè¿œç¨‹åˆ†æ”¯</p><ul><li>æœ¬åœ°ä»£ç å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ <code>git reset --hard HEAD~1</code></li><li>å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬commitId  <code>git reset --hard commitId</code></li></ul></li></ul><p>åŠ å…¥-få‚æ•°ï¼Œå¼ºåˆ¶æäº¤ï¼Œè¿œç¨‹ç«¯å°†å¼ºåˆ¶è·Ÿæ–°åˆ°resetç‰ˆæœ¬</p><blockquote><p> git push -f</p></blockquote><h2 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹åˆ†æ”¯æäº¤å†å²</span></span><br><span class="line">git log --oneline --graph --decorate</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹åˆ†æ”¯å¯¹åº”çš„è¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">git branch -vv</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å‘½ååˆ†æ”¯</span></span><br><span class="line">git branch -m new-branch-name</span><br><span class="line">git push origin -u new-branch-name</span><br><span class="line"><span class="meta">#</span><span class="bash"> ï¼ˆå¯é€‰ï¼šåˆ é™¤åŸåˆ†æ”¯ï¼‰git push origin --delete old-branch-name</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ”¹å½“å‰åˆ†æ”¯å¯¹åº”çš„è¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">git branch --set-upstream-to=origin/branch-name</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½åˆ†æ”¯</span></span><br><span class="line">git branch bk-dev HEAD</span><br></pre></td></tr></table></figure><ul><li><p>æ‹‰å–è¿œç¨‹åˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> First, fetch the remote branches:</span></span><br><span class="line">git fetch origin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Next, checkout the branch you want. In this <span class="keyword">case</span>, the branch we want is called â€œbranchxyzâ€.</span></span><br><span class="line">git checkout -b branchxyz origin/branchxyz**</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºåˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> To create a new branch from a branch you <span class="keyword">do</span> NOT have checked out:</span></span><br><span class="line">git branch new_branch from_branch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To create a new branch from the branch you DO have checked out:</span></span><br><span class="line">git branch new_branch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To create *and check out* a new branch from the branch you DO have checked out:</span></span><br><span class="line">git checkout -b new_branch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To create *and check out* a new branch from a branch you <span class="keyword">do</span> NOT have checked out:</span></span><br><span class="line">git checkout -b new_branch from_branch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create a new branch from that commit by using the commit <span class="built_in">hash</span></span></span><br><span class="line">git checkout -b new-branch-name commit-id</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To rename a branch</span></span><br><span class="line">git branch -m old_name new_name</span><br></pre></td></tr></table></figure></li><li><p>æ¨é€æ–°åˆ†æ”¯åˆ°è¿œç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. å°†developåˆ†æ”¯æ¨é€åˆ°è¿œç¨‹</span></span><br><span class="line">git push origin new_branch:new_branch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. å»ºç«‹æœ¬åœ°è‡³ä¸Šæ¸¸ï¼ˆè¿œç¨‹ï¼‰åˆ†æ”¯çš„é“¾æ¥</span></span><br><span class="line">git branch --set-upstream-to=origin/new_branch new_branch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœè¦æ¨é€åˆ°çš„è¿œç¨‹åˆ†æ”¯ origin/new_branch ä¸æœ¬åœ°åˆ†æ”¯ new_branch åå­—ç›¸åŒï¼Œé‚£å¯ä»¥ä½¿ç”¨</span></span><br><span class="line">git branch --set-upstream-to origin new_branch</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤åˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> delete branch locally (å¦‚æœè¦åˆ é™¤è¿™ä¸ªåˆ†æ”¯çš„è¯ï¼Œéœ€è¦è·³è½¬è‡³å…¶ä»–åˆ†æ”¯åè¿›è¡Œåˆ é™¤æ“ä½œ)</span></span><br><span class="line">git branch -d localBranchName</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete branch remotely</span></span><br><span class="line">git push origin --delete remoteBranchName</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If someone <span class="keyword">else</span> has already deleted the branch, you just <span class="keyword">do</span> below</span></span><br><span class="line">git fetch -p</span><br></pre></td></tr></table></figure></li></ul><h2 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h2><ul><li><p>æ‹‰å–å¹¶åˆ‡æ¢æŒ‡å®štag åˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  git fetch --all --tags</span><br><span class="line">  git tag  # list all tag</span><br><span class="line">  git checkout &lt;tag_name&gt;</span><br><span class="line"></span><br><span class="line">- å¯¹æŒ‡å®šcommitè¿›è¡Œæ ‡è®°tag</span><br><span class="line"></span><br><span class="line">  ```shell</span><br><span class="line">  git tag &lt;tag_name&gt; &lt;commit_hash&gt;</span><br><span class="line">  </span><br><span class="line"><span class="meta">  #</span><span class="bash"> origin tag</span></span><br><span class="line">  git push origin &lt;tag_name&gt;</span><br><span class="line">  </span><br><span class="line"><span class="meta">  #</span><span class="bash"> push remote upstream repo</span></span><br><span class="line">  git push upstream &lt;tag_name&gt;</span><br><span class="line"><span class="meta">  #</span><span class="bash"> è¯¥å‘½ä»¤ä¼šè‡ªåŠ¨è§¦å‘upstream repoçš„github workflow</span></span><br></pre></td></tr></table></figure></li><li><p>æ ¹æ®tagåˆ›å»ºåˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;new_branch_name&gt; &lt;tag_name&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="conflict"><a href="#conflict" class="headerlink" title="conflict"></a>conflict</h2><ul><li><p>æŸ¥çœ‹å†²çªæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Highlight conflicts within files</span></span><br><span class="line">git diff</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> List conflict files directly</span></span><br><span class="line">git diff --name-only --diff-filter=U</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check merge conflicts interactively</span></span><br><span class="line">git mergetool</span><br></pre></td></tr></table></figure></li></ul><h2 id="æš‚å­˜åŒº"><a href="#æš‚å­˜åŒº" class="headerlink" title="æš‚å­˜åŒº"></a>æš‚å­˜åŒº</h2><ul><li><p>æŸ¥çœ‹æš‚å­˜å†…å®¹çš„å·®å¼‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure></li><li><p>é‡ç½®æš‚å­˜åŒºï¼ˆå¯¹äºæ‰€æœ‰æ–‡ä»¶ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset</span><br></pre></td></tr></table></figure></li></ul><h2 id="stash"><a href="#stash" class="headerlink" title="stash"></a>stash</h2><p>åœ¨Gitä¸­ï¼Œ<code>stash</code>å‘½ä»¤ç”¨äºæš‚å­˜å½“å‰æœªæäº¤çš„ä»£ç ä¿®æ”¹ï¼Œä»¥ä¾¿åœ¨åç»­æ—¶åˆ»å†æ¬¡åº”ç”¨å®ƒä»¬ã€‚å®ƒå¯ä»¥æš‚å­˜å·²ä¿®æ”¹ä½†è¿˜æœªæ·»åŠ åˆ°æš‚å­˜åŒºçš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æš‚å­˜å·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºä½†è¿˜æœªæäº¤çš„æ–‡ä»¶ã€‚</p><p>ä»¥ä¸‹æ˜¯<code>stash</code>å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼ï¼š</p><ol><li><p>æš‚å­˜å½“å‰ä¿®æ”¹ï¼š(è¿™ä¸ªå‘½ä»¤å°†å½“å‰çš„ä¿®æ”¹æš‚å­˜èµ·æ¥ï¼Œè®©ä½ çš„å·¥ä½œç›®å½•å˜æˆå¹²å‡€çš„çŠ¶æ€ã€‚)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure></li><li><p>æ¢å¤æš‚å­˜çš„ä¿®æ”¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash apply</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å°†ä¹‹å‰æš‚å­˜çš„ä¿®æ”¹åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ä¸Šã€‚å¦‚æœä½ æœ‰å¤šä¸ªstashï¼Œå¯ä»¥ä½¿ç”¨<code>git stash apply stash@&#123;n&#125;</code>æ¥æŒ‡å®šæ¢å¤æŸä¸ªç‰¹å®šçš„stashã€‚</p></li><li><p>åˆ é™¤stashï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash drop</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šåˆ é™¤æœ€è¿‘çš„ä¸€ä¸ªstashã€‚</p></li><li><p>åˆ—å‡ºæ‰€æœ‰stashï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash list</span><br></pre></td></tr></table></figure></li><li><p>åº”ç”¨å¹¶åˆ é™¤stashï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ç›¸å½“äº<code>git stash apply</code>å’Œ<code>git stash drop</code>çš„ç»„åˆï¼Œå®ƒä¼šå°†æœ€è¿‘çš„ä¸€ä¸ªstashåº”ç”¨åˆ°å½“å‰åˆ†æ”¯ï¼Œå¹¶å°†å…¶åˆ é™¤ã€‚</p></li><li><p>æš‚å­˜ç‰¹å®šçš„æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash push path/to/file</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥å°†æŒ‡å®šçš„æ–‡ä»¶æš‚å­˜èµ·æ¥ï¼Œè€Œä¸æ˜¯æš‚å­˜æ•´ä¸ªå·¥ä½œç›®å½•ã€‚</p></li><li><p>ç»™stashæ·»åŠ æè¿°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash save <span class="string">&quot;stash message&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h2><p><a href="https://waynerv.com/posts/git-rebase-intro/">git rebase ç”¨æ³•è¯¦è§£ä¸å·¥ä½œåŸç†</a></p><p><a href="https://johneverettcase.com/git-how-to-rebase-a-fork">How to Rebase a Fork</a></p><ol><li><p><strong>æ›´æ–°æœ¬åœ°ä¸»åˆ†æ”¯ï¼ˆé€šå¸¸æ˜¯ master æˆ– mainï¼‰:</strong> è·å–åŸå§‹ä»“åº“çš„æœ€æ–°æ›´æ”¹å¹¶åˆå¹¶åˆ°ä½ çš„æœ¬åœ°ä¸»åˆ†æ”¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout master  # åˆ‡æ¢åˆ°ä½ çš„æœ¬åœ°ä¸»åˆ†æ”¯</span><br><span class="line">git pull upstream master  # ä»åŸå§‹ä»“åº“æ‹‰å–æœ€æ–°æ›´æ”¹åˆ°æœ¬åœ°ä¸»åˆ†æ”¯</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch upstream</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ‡æ¢åˆ°ä½ çš„åˆ†æ”¯å¹¶è¿›è¡Œ rebase:</strong> åˆ‡æ¢åˆ°ä½ çš„åˆ†æ”¯å¹¶å°†å…¶ rebase åˆ°ä¸»åˆ†æ”¯ä¸Šï¼š</p><ul><li>å¦‚æœæ˜¯æ–°åˆ†æ”¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;æ–°åˆ†æ”¯&gt;</span><br><span class="line">git rebase master  # å°†æ–°åˆ†æ”¯ rebase åˆ°ä½ çš„æœ¬åœ°ä¸»åˆ†æ”¯</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ˜¯å·²æœ‰åˆ†æ”¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;å·²æœ‰åˆ†æ”¯&gt;</span><br><span class="line">git rebase upstream/master</span><br></pre></td></tr></table></figure></li><li><p><strong>è§£å†³å†²çªï¼ˆå¦‚æœæœ‰ï¼‰:</strong> å¦‚æœåœ¨ rebase è¿‡ç¨‹ä¸­å‡ºç°å†²çªï¼Œä½ éœ€è¦æ‰‹åŠ¨è§£å†³å†²çªï¼Œç„¶åä½¿ç”¨ <code>git add</code> æ ‡è®°ä¸ºå·²è§£å†³ã€‚</p><ul><li>å±•ç¤ºå†²çªä»£ç ï¼ˆå¯çœç•¥ï¼‰</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --name-only --diff-filter=U</span><br></pre></td></tr></table></figure><ul><li>è§£å†³ä»£ç å†²çª<ul><li>IDEæ‰‹åŠ¨è§£å†³</li><li>vimdiffè§£å†³</li><li>meldè§£å†³</li></ul></li><li>è§£å†³ä¹‹å</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .  # resolve conflict, always use add &amp; commit ğŸš¨</span><br><span class="line">git commit -m &quot;xxx&quot;</span><br><span class="line">git rebase --continue</span><br></pre></td></tr></table></figure><ul><li>ç»ˆæ­¢rebase</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --abort</span><br></pre></td></tr></table></figure></li><li><p><strong>æ¨é€æ›´æ”¹åˆ°è¿œç¨‹ä»“åº“:</strong> æ¨é€ä½ çš„æ›´æ”¹åˆ°è¿œç¨‹ä»“åº“ï¼š</p><ul><li>å¦‚æœæ˜¯æ–°åˆ†æ”¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;åˆ†æ”¯&gt; --force  # å¼ºåˆ¶æ¨é€åˆ°ä½ çš„ fork ä»“åº“çš„æ–°åˆ†æ”¯ä¸Š</span><br><span class="line">æˆ–</span><br><span class="line">git push -f origin &lt;åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼šä½¿ç”¨ <code>--force</code> å‚æ•°è¿›è¡Œå¼ºåˆ¶æ¨é€æ—¶ï¼Œè¯·ç¡®ä¿ä½ äº†è§£å®ƒçš„å½±å“ã€‚å®ƒå¯èƒ½ä¼šè¦†ç›–è¿œç¨‹åˆ†æ”¯çš„å†å²è®°å½•ï¼Œå› æ­¤åŠ¡å¿…å°å¿ƒæ“ä½œã€‚</p><ul><li>å¦‚æœæ˜¯å·²æœ‰åˆ†æ”¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»º Pull Request:</strong> åœ¨ä½ çš„ fork ä»“åº“ä¸­ï¼Œä»æ–°åˆ†æ”¯åˆ›å»ºä¸€ä¸ª Pull Requestï¼ˆPRï¼‰ï¼Œå°†ä½ çš„æ›´æ”¹åˆå¹¶åˆ°åŸå§‹ä»“åº“çš„ç›®æ ‡åˆ†æ”¯</p></li></ol><h2 id="squash-reword-commit"><a href="#squash-reword-commit" class="headerlink" title="squash/reword commit"></a>squash/reword commit</h2><blockquote><p>æå‰å¤‡ä»½å¾…æ“ä½œçš„åˆ†æ”¯ git branch bk-dev HEAD</p></blockquote><ol><li><p>merge the last 3 commits into a single commit.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -i HEAD~3</span><br></pre></td></tr></table></figure></li><li><p>replace all those <code>pick</code> with <code>squash</code> (or simply <code>s</code>) apart from the first one.</p><img src="https://www.freecodecamp.org/news/content/images/2023/03/Screenshot-2023-03-22-at-11.28.12.png" style="zoom:40%"><p><strong>Note:</strong> <code>pick</code> or <code>p</code> will only use those commits, but <code>squash</code> or <code>s</code> will use them and combine them all together.</p><p>The first commit is the one you will combine them into without losing your changes.</p><blockquote><p>æ³¨æ„ï¼Œä¸€èˆ¬éœ€è¦ squashçš„æ˜¯åé¢çš„commitï¼Œéœ€è¦ä¿è¯ç¬¬ä¸€æ¡ï¼ˆæœ€æ—©çš„ï¼‰commit ä¿¡æ¯ä¸è¢« squash</p></blockquote></li><li><p>After doing that, save the file and close it. Git will open up another editor where you can see the new commit message it generates for you.</p><img src="https://www.freecodecamp.org/news/content/images/2023/03/Screenshot-2023-03-22-at-11.36.02.png"   style="zoom:40%;"/><p>You can get rid of all of them and add your custom message:</p><img src="https://www.freecodecamp.org/news/content/images/2023/03/Screenshot-2023-03-22-at-11.37.45.png" style="zoom:44%;"><p> Or you can leave it as is. If you add a new commit message, save the file and close it.</p></li><li><p>Pushing changes, You should run git push to add a new commit to the remote origin. If you have already pushed your commits, then you should force push them using the git push command with â€” force flag (suppose, the name of remote is origin, which is by default)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --force origin HEAD</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>ä¸­é€”å¦‚éœ€ç»ˆæ­¢rebaseï¼Œè¿è¡Œ git rebase â€“abort</p></blockquote><ol start="5"><li><p>å…¶å®ƒç»“åˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- å…ˆè¿›è¡Œ `git rebase upstream/v1` å¯ä»¥ç¡®ä¿ä½ çš„åˆ†æ”¯æ˜¯åŸºäºæœ€æ–°çš„ä¸Šæ¸¸ä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">- ç„¶åè¿›è¡Œ `git rebase -i HEAD~2` è®©ä½ å¯ä»¥åœ¨æœ€æ–°ä»£ç çš„åŸºç¡€ä¸Šä¿®æ”¹ä½ çš„æäº¤ã€‚</span><br><span class="line"></span><br><span class="line">  è¿™ä¸ªé¡ºåºå¯ä»¥å‡å°‘å†²çªçš„å¯èƒ½æ€§ï¼Œå› ä¸ºä½ å…ˆå°†ä½ çš„ä»£ç åŸºäºæœ€æ–°çš„ä¸Šæ¸¸ä»£ç ï¼Œç„¶åå†ä¿®æ”¹ä½ è‡ªå·±çš„æäº¤ã€‚</span><br></pre></td></tr></table></figure></li></ol><h2 id="remote"><a href="#remote" class="headerlink" title="remote"></a>remote</h2><p><a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/syncing-a-fork">docs.github.com</a></p><ul><li><strong>åˆå§‹åŒ–ä»“åº“</strong></li></ul><ol><li><p>List the current configured remote repository for your fork.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git remote -v</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> origin  https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> origin  https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)</span></span><br></pre></td></tr></table></figure></li><li><p>Specify a new remote <em>upstream</em> repository that will be synced with the fork.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add upstream https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git</span><br></pre></td></tr></table></figure></li><li><p>Verify the new upstream repository youâ€™ve specified for your fork.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git remote -v</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> origin    https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> origin    https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> upstream  https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git (fetch)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> upstream  https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git (push)</span></span><br></pre></td></tr></table></figure></li></ol><ul><li><strong>åŒæ­¥ä»£ç </strong></li></ul><ol><li><p>Change the current working directory to your local project.</p></li><li><p>Fetch the branches and their respective commits from the upstream repository. Commits to <code>BRANCHNAME</code> will be stored in the local branch <code>upstream/BRANCHNAME</code>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git fetch upstream</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> remote: Counting objects: 75, <span class="keyword">done</span>.</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> remote: Compressing objects: 100% (53/53), <span class="keyword">done</span>.</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> remote: Total 62 (delta 27), reused 44 (delta 9)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Unpacking objects: 100% (62/62), <span class="keyword">done</span>.</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> From https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  * [new branch]      main     -&gt; upstream/main</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šfetchæŸä¸ªåˆ†æ”¯</span></span><br><span class="line">git fetch &lt;remote&gt; &lt;branch&gt;</span><br></pre></td></tr></table></figure></li><li><p>Check out your forkâ€™s local default branch - in this case, we use <code>main</code>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout main</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Switched to branch <span class="string">&#x27;main&#x27;</span></span></span><br></pre></td></tr></table></figure></li><li><p>Merge the changes from the upstream default branch - in this case, <code>upstream/main</code> - into your local default branch. This brings your forkâ€™s default branch into sync with the upstream repository, without losing your local changes.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git merge upstream/main</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Updating a422352..5fdff0f</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Fast-forward</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  README                    |    9 -------</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  README.md                 |    7 ++++++</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  2 files changed, 7 insertions(+), 9 deletions(-)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  delete mode 100644 README</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  create mode 100644 README.md</span></span><br></pre></td></tr></table></figure><p>If your local branch didnâ€™t have any unique commits, Git will perform a fast-forward. For more information, see <a href="https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging">Basic Branching and Merging</a> in the Git documentation.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git merge upstream/main</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Updating 34e91da..16c56ad</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Fast-forward</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  README.md                 |    5 +++--</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  1 file changed, 3 insertions(+), 2 deletions(-)</span></span><br></pre></td></tr></table></figure><p>If your local branch had unique commits, you may need to resolve conflicts. For more information, see â€œ<a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts">Addressing merge conflicts</a>.â€</p></li></ol><h2 id="submodule"><a href="#submodule" class="headerlink" title="submodule"></a>submodule</h2><blockquote><p>å¯¹äºé¡¹ç›®ä¸­åŒ…å«å­é¡¹ç›®çš„gité¡¹ç›®</p><p>reference</p><p><a href="https://www.git-scm.com/book/en/v2/Git-Tools-Submodules">https://www.git-scm.com/book/en/v2/Git-Tools-Submodules</a></p><p> <a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97">https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97</a></p></blockquote><ul><li><p>å¦‚æœæ˜¯é¦–æ¬¡å…‹éš†ï¼Œåˆå§‹åŒ–ä»£ç éœ€è¦ <code>git clone --recurse-submodules https://github.com/chaconinc/MainProject</code></p><p>æˆ–å¦‚æœé¦–æ¬¡æ²¡æœ‰ä½¿ç”¨<code>--recurse-submodules</code>ï¼Œé‚£åé¢å¯ä»¥é€šè¿‡ <code>git submodule init</code>å’Œ<code>git submodule update</code>ï¼Œè¿›è¡Œå­æ¨¡å—çš„æ‹‰å–æ›´æ–°</p></li></ul><ul><li><p>å¦‚ä½•è¦å¯¹å­æ¨¡å—çš„ä»£ç ä¹Ÿç”¨å…‹éš†åœ°å€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config -f .gitmodules -e    # opens editor, update URLs for your forks`</span><br><span class="line">git submodule sync</span><br></pre></td></tr></table></figure></li><li><p>åæœŸä»è¿œç¨‹ä»“åº“æ›´æ–°submoduleä»£ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule update --remote</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å·²æœ‰é¡¹ç›®æ·»åŠ å­æ¨¡å—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> add the submodule</span></span><br><span class="line">git submodule add https://github.com/example/submodule.git submodule-dir</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> fetch and checkout the specific tag</span></span><br><span class="line">cd submodule-dir</span><br><span class="line">git fetch --tags</span><br><span class="line">git checkout &lt;xxx&gt;</span><br><span class="line">cd ..</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> check submodule</span></span><br><span class="line">git submodule status</span><br></pre></td></tr></table></figure></li><li><p>æ›´æ¢åˆ°æŒ‡å®šcommitID</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch</span><br><span class="line">git checkout &lt;commit-id&gt;</span><br></pre></td></tr></table></figure></li><li><p>remove submodule</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git submodule deinit path/to/submodule</span><br><span class="line">rm -rf path/to/submodule</span><br><span class="line">git rm --cached path/to/submodule</span><br><span class="line">git commit -m &quot;Removed submodule path/to/submodule&quot;</span><br></pre></td></tr></table></figure></li></ul><h1 id="cherry-pick"><a href="#cherry-pick" class="headerlink" title="cherry pick"></a>cherry pick</h1><p>If the new commits (commit-4, commit-5, commit-6) are in the feat-alpha branch and you want to cherry-pick them into a clean branch based on upstream/main, hereâ€™s how to do it:</p><p><strong>1. Fetch the Latest Changes from Upstream</strong></p><p>First, ensure you have the latest changes from the upstream repository:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git fetch upstream</span><br><span class="line">git checkout main</span><br><span class="line">git merge upstream/main</span><br></pre></td></tr></table></figure><p><strong>2. Create a Clean Branch Based on upstream/main</strong></p><p>Create a new branch starting from the updated upstream/main. This branch will hold only the cherry-picked commits.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b new-feature-branch upstream/main</span><br></pre></td></tr></table></figure><p><strong>3. Cherry-Pick Commits from feat-alpha</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Locate the <span class="built_in">hash</span> IDs of commit-4, commit-5, and commit-6 <span class="keyword">in</span> the feat-alpha branch using:</span></span><br><span class="line">git log feat-alpha --oneline</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Once you have the commit hashes, cherry-pick them into the new branch:</span></span><br><span class="line">git cherry-pick &lt;commit-4-hash&gt;</span><br><span class="line">git cherry-pick &lt;commit-5-hash&gt;</span><br><span class="line">git cherry-pick &lt;commit-6-hash&gt;</span><br></pre></td></tr></table></figure><p><strong>4. Resolve Any Conflicts</strong> (optional)</p><p>If there are conflicts during the cherry-pick process:</p><p>â€‹    1.    Git will stop and list the conflicting files.</p><p>â€‹    2.    Open the conflicting files and manually resolve the conflicts.</p><p>â€‹    3.    After resolving the conflicts, mark them as resolved:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;file&gt;</span><br><span class="line">git cherry-pick --continue</span><br></pre></td></tr></table></figure><p>If you encounter multiple conflicts, repeat this process for each one.</p><p>If you decide to abort the cherry-pick entirely:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick --abort</span><br></pre></td></tr></table></figure><p><strong>5. Push the Clean Branch</strong></p><p>Once all desired commits are cherry-picked and conflicts are resolved, push the new branch to your forked repository:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin new-feature-branch</span><br></pre></td></tr></table></figure><p><strong>Why This Approach Works</strong></p><p>â€‹    1.    <strong>Selective Commits</strong>: Cherry-picking ensures only the necessary commits from feat-alpha are included.</p><p>â€‹    2.    <strong>Conflict Management</strong>: Conflicts, if any, are resolved once during cherry-picking.</p><p>â€‹    3.    <strong>Clean PR</strong>: The new branch has a clear history, free from irrelevant or duplicate commits.</p><p>This ensures a smooth and conflict-free pull request to the upstream repository.</p><h1 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h1><h2 id="åˆå¹¶ç­–ç•¥"><a href="#åˆå¹¶ç­–ç•¥" class="headerlink" title="åˆå¹¶ç­–ç•¥"></a>åˆå¹¶ç­–ç•¥</h2><p>warning: ä¸å»ºè®®åœ¨æ²¡æœ‰ä¸ºåç¦»åˆ†æ”¯æŒ‡å®šåˆå¹¶ç­–ç•¥æ—¶æ‰§è¡Œpullæ“ä½œã€‚<br>æ‚¨å¯ä»¥åœ¨æ‰§è¡Œä¸‹ä¸€æ¬¡pullæ“ä½œä¹‹å‰æ‰§è¡Œä¸‹é¢ä¸€æ¡å‘½ä»¤æ¥æŠ‘åˆ¶æœ¬æ¶ˆæ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config pull.rebase false # åˆå¹¶ï¼ˆç¼ºçœç­–ç•¥ï¼‰  </span><br><span class="line">git config pull.rebase true # å˜åŸº  </span><br><span class="line">git config pull.ff only # ä»…å¿«è¿›</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥å°† â€œgit configâ€ æ›¿æ¢ä¸º â€œgit config â€“globalâ€ ä»¥ä¾¿ä¸ºæ‰€æœ‰ä»“åº“è®¾ç½®<br>ç¼ºçœçš„é…ç½®é¡¹ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œ pull å‘½ä»¤æ—¶æ·»åŠ  â€“rebaseã€â€“no-rebaseï¼Œ<br>æˆ–è€… â€“ff-only å‚æ•°è¦†ç›–ç¼ºçœè®¾ç½®ã€‚</p><h2 id="æ¨é€æœ¬åœ°ç¦»çº¿é¡¹ç›®åˆ°è¿œç¨‹github"><a href="#æ¨é€æœ¬åœ°ç¦»çº¿é¡¹ç›®åˆ°è¿œç¨‹github" class="headerlink" title="æ¨é€æœ¬åœ°ç¦»çº¿é¡¹ç›®åˆ°è¿œç¨‹github"></a>æ¨é€æœ¬åœ°ç¦»çº¿é¡¹ç›®åˆ°è¿œç¨‹github</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir my_project</span><br><span class="line">cd my_project</span><br><span class="line">touch .gitignore</span><br><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line">git remote add origin youruser@yourserver.com:/path/to/my_project.git</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><h2 id="æ›´æ”¹httpsåè®®è¿›è¡Œæ¨é€"><a href="#æ›´æ”¹httpsåè®®è¿›è¡Œæ¨é€" class="headerlink" title="æ›´æ”¹httpsåè®®è¿›è¡Œæ¨é€"></a>æ›´æ”¹httpsåè®®è¿›è¡Œæ¨é€</h2><blockquote><p>å¦‚æœä¹‹å‰æ˜¯ä½¿ç”¨sshåè®®è¿›è¡Œæ¨é€ï¼Œç°æ”¹ä¸ºhttpåè®®</p></blockquote><ol><li><p>æŸ¥çœ‹å½“å‰Gité¡¹ç›®çš„è¿œç¨‹åœ°å€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰å·²é…ç½®çš„è¿œç¨‹ä»“åº“åœ°å€ï¼Œå¹¶æ˜¾ç¤ºå®ƒä»¬çš„è¯»å–å’Œå†™å…¥è®¿é—®URLã€‚ç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">origin  https://github.com/username/repository.git (fetch)</span><br><span class="line">origin  https://github.com/username/repository.git (push)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>origin</code>æ˜¯è¿œç¨‹ä»“åº“çš„åç§°ï¼Œ<code>https://github.com/username/repository.git</code>æ˜¯è¿œç¨‹ä»“åº“çš„åœ°å€ï¼Œ<code>(fetch)</code>å’Œ<code>(push)</code>åˆ†åˆ«è¡¨ç¤ºè¯»å–å’Œå†™å…¥è®¿é—®URLã€‚</p></li><li><p>å°†Gitä»“åº“çš„URLæ›¿æ¢ä¸ºHTTPåè®®çš„URL</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote set-url origin http://gitlab.xxx.com/username/repository.git</span><br></pre></td></tr></table></figure></li><li><p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒGit pushæ“ä½œ</p></li></ol><p>åè®°ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨HTTPåè®®è¿›è¡ŒGit pushæ“ä½œçš„é€Ÿåº¦å¯èƒ½ä¼šæ¯”ä½¿ç”¨SSHåè®®æ…¢ä¸€äº›ï¼Œå› ä¸ºHTTPåè®®éœ€è¦å»ºç«‹TCPè¿æ¥ã€å‘é€HTTPè¯·æ±‚ã€æ¥æ”¶HTTPå“åº”ç­‰è¿‡ç¨‹ã€‚åŒæ—¶ï¼ŒHTTPåè®®çš„å®‰å…¨æ€§ä¹Ÿæ¯”SSHåè®®ç¨ä½ï¼Œå› æ­¤åœ¨å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨SSHåè®®è¿›è¡ŒGit pushæ“ä½œã€‚</p><h2 id="Gitä¿®æ”¹-gitignoreä¸ç”Ÿæ•ˆ"><a href="#Gitä¿®æ”¹-gitignoreä¸ç”Ÿæ•ˆ" class="headerlink" title="Gitä¿®æ”¹.gitignoreä¸ç”Ÿæ•ˆ"></a>Gitä¿®æ”¹.gitignoreä¸ç”Ÿæ•ˆ</h2><ul><li><p>åœ¨gitä¸­ï¼Œå¦‚æœæƒ³å¿½ç•¥æŸä¸ªæ–‡ä»¶ï¼Œä¸è®©è¿™ä¸ªæ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬åº“ä¸­ï¼Œå¯ä»¥ä¿®æ”¹æ ¹ç›®å½•ä¸­çš„.gitignoreæ–‡ä»¶</p><p>ä½†æœ‰æ—¶å€™æŠŠæŸäº›ç›®å½•æˆ–è€…æ–‡ä»¶åŠ å…¥å¿½ç•¥è§„åˆ™ï¼Œå‘ç°å¹¶æœªç”Ÿæ•ˆ</p></li><li><p>æœªç”Ÿæ•ˆåŸå› ï¼š.gitignoreåªèƒ½å¿½ç•¥é‚£äº›åŸæ¥æ²¡æœ‰è¢«è¿½è¸ª(track)çš„æ–‡ä»¶ï¼Œå¦‚æœæŸäº›æ–‡ä»¶å·²ç»è¢«çº³å…¥äº†ç‰ˆæœ¬ç®¡ç†ä¸­ï¼Œåˆ™ä¿®æ”¹.gitignoreæ˜¯æ— æ•ˆçš„</p></li><li><p>è§£å†³æ–¹æ¡ˆï¼šå…ˆæŠŠæœ¬åœ°ç¼“å­˜åˆ é™¤ï¼ˆæ”¹å˜æˆæœªtrackçŠ¶æ€ï¼‰ï¼Œç„¶åæäº¤ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached &lt;è¦å¿½ç•¥çš„å…·ä½“æ–‡ä»¶æˆ–è€…ç›®å½•&gt; æˆ–è€… git rm -r --cached . </span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;update .gitignore&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Latin alphabet</title>
      <link href="/2016/05/16/Latin%20alphabet/"/>
      <url>/2016/05/16/Latin%20alphabet/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1 Î‘ Î± alpha a:lf é˜¿å°”æ³•</span><br><span class="line">2 Î’ Î² beta bet è´å¡”</span><br><span class="line">3 Î“ Î³ gamma ga:m ä¼½é©¬</span><br><span class="line">4 Î” Î´ delta delt å¾·å°”å¡”</span><br><span class="line">5 Î• Îµ epsilon ep`silon ä¼Šæ™®è¥¿é¾™</span><br><span class="line">6 Î– Î¶ zeta zat æˆªå¡”</span><br><span class="line">7 Î— Î· eta eit è‰¾å¡”</span><br><span class="line">8 Î˜ Î¸ theta Î¸it è¥¿å¡”</span><br><span class="line">9 Î™ Î¹ iota aiot çº¦å¡”</span><br><span class="line">10Îš Îº kappa kap å¡å¸•</span><br><span class="line">11âˆ§ Î» lambda lambd å…°å¸ƒè¾¾</span><br><span class="line">12Îœ Î¼ mu mju ç¼ª</span><br><span class="line">13Î Î½ nu nju çº½</span><br><span class="line">14Î Î¾ xi ksi å…‹è¥¿</span><br><span class="line">15ÎŸ Î¿ omicron omik`ron å¥¥å¯†å…‹æˆ</span><br><span class="line">16âˆ Ï€ pi pai æ´¾</span><br><span class="line">17Î¡ Ï rho rou è‚‰</span><br><span class="line">18âˆ‘ Ïƒ sigma `sigma è¥¿æ ¼é©¬</span><br><span class="line">19Î¤ Ï„ tau tau å¥—</span><br><span class="line">20 Î¥ Ï… upsilon ju:p`sailon å®‡æ™®è¥¿é¾™</span><br><span class="line">21 Î¦ Ï† phi fai ä½›çˆ±</span><br><span class="line">22 Î§ Ï‡ chi phai è¥¿</span><br><span class="line">23 Î¨ Ïˆ psi psai æ™®è¥¿</span><br><span class="line">24 Î© Ï‰ omega o`miga æ¬§ç±³ä¼½</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Latin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo</title>
      <link href="/2016/05/01/z-hexo/"/>
      <url>/2016/05/01/z-hexo/</url>
      
        <content type="html"><![CDATA[<h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><h3 id="Clean"><a href="#Clean" class="headerlink" title="Clean"></a>Clean</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html">Deployment</a></p><h1 id="image-reference"><a href="#image-reference" class="headerlink" title="image reference"></a>image reference</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> markdown syntax</span></span><br><span class="line">![](/images/flink/flink_schedule_architecture.png)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> html</span></span><br><span class="line">&lt;img src=&quot;/images/minio/cert.jpg&quot; style=&quot;zoom: 60%&quot;&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> style support below config</span></span><br><span class="line">style=&quot;float: left; width: 40%; zoom: 60%; margin-right: 20px;</span><br></pre></td></tr></table></figure><h1 id="theme"><a href="#theme" class="headerlink" title="theme"></a>theme</h1><h2 id="next"><a href="#next" class="headerlink" title="next"></a>next</h2><h3 id="å®‰è£…è¯„è®º"><a href="#å®‰è£…è¯„è®º" class="headerlink" title="å®‰è£…è¯„è®º"></a>å®‰è£…è¯„è®º</h3><p><a href="https://zhuanlan.zhihu.com/p/33617273">æ¥å¿…åŠ›è¯„è®º</a></p><p><a href="https://sjq597.github.io/2018/05/18/Hexo-%E4%BD%BF%E7%94%A8Gitment%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/">ä½¿ç”¨Gitmentè¯„è®ºåŠŸèƒ½</a></p><h3 id="ç½®é¡¶åŠŸèƒ½"><a href="#ç½®é¡¶åŠŸèƒ½" class="headerlink" title="ç½®é¡¶åŠŸèƒ½"></a>ç½®é¡¶åŠŸèƒ½</h3><p><a href="https://donlex.cn/archives/caeb67e2.html">æ·»åŠ ç½®é¡¶</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>java backend</title>
      <link href="/2016/03/01/backend%20snippet/"/>
      <url>/2016/03/01/backend%20snippet/</url>
      
        <content type="html"><![CDATA[<h1 id="filter-in-servlet"><a href="#filter-in-servlet" class="headerlink" title="filter in servlet"></a>filter in servlet</h1><blockquote><p>A filter is an object that is invoked at the preprocessing and postprocessing of a request.</p></blockquote><ul><li>It is mainly used to perform filtering tasks such as conversion, logging, compression, encryption and decryption, input validation etc.</li><li>The servlet filter is pluggable, i.e. its entry is defined in the web.xml file, if we remove the entry of filter from the web.xml file, filter will be removed automatically and we donâ€™t need to change the servlet.</li></ul><p><img src="https://www.javatpoint.com/images/filter.JPG"></p><h3 id="Usage-of-Filter"><a href="#Usage-of-Filter" class="headerlink" title="Usage of Filter"></a>Usage of Filter</h3><ul><li>recording all incoming requests</li><li>logs the IP addresses of the computers from which the requests originate</li><li>conversion</li><li>data compression</li><li>encryption and decryption</li><li>input validation etc.</li></ul><h3 id="Advantage-of-Fliter"><a href="#Advantage-of-Fliter" class="headerlink" title="Advantage of Fliter"></a>Advantage of Fliter</h3><ul><li>Filter is pluggable.</li><li>One filter donâ€™t have dependency onto another resource.</li><li>Less Maintenance</li></ul><h3 id="Filter-API"><a href="#Filter-API" class="headerlink" title="Filter API"></a>Filter API</h3><ul><li><p>Filter</p><blockquote><p>For creating any filter, you must implement the Filter interface. Filter interface provides the life cycle methods for a filter.</p></blockquote></li><li><p>FilterChain</p><blockquote><p>The object of FilterChain is responsible to invoke the next filter or resource in the chain.This object is passed in the doFilter method of Filter interface.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;&#125;  </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp,  </span></span></span><br><span class="line"><span class="params"><span class="function">      FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;  </span><br><span class="line"></span><br><span class="line">          PrintWriter out=resp.getWriter();  </span><br><span class="line">          out.print(<span class="string">&quot;filter is invoked before&quot;</span>);  </span><br><span class="line"></span><br><span class="line">          chain.doFilter(req, resp);<span class="comment">//sends request to next resource  </span></span><br><span class="line"></span><br><span class="line">          out.print(<span class="string">&quot;filter is invoked after&quot;</span>);  </span><br><span class="line">      &#125;  </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;&#125;  </span><br><span class="line">&#125;      </span><br></pre></td></tr></table></figure></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- FilterConfig</span><br></pre></td></tr></table></figure><h1 id="Event-and-Listen"><a href="#Event-and-Listen" class="headerlink" title="Event and Listen"></a>Event and Listen</h1><blockquote><p>Events are basically occurrence of something. Changing the state of an object is known as an event.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">We can perform some important tasks at the occurrence of these exceptions, such as counting total and current logged-in users, creating tables of the database at time of deploying the project, creating database connection object etc.</span><br></pre></td></tr></table></figure><h3 id="Event-classes"><a href="#Event-classes" class="headerlink" title="Event classes"></a>Event classes</h3><ul><li>ServletRequestEvent</li><li>ServletContextEvent</li><li>ServletRequestAttributeEvent</li><li>ServletContextAttributeEvent</li><li>HttpSessionEvent</li><li>HttpSessionBindingEvent</li></ul><h3 id="Event-interfaces"><a href="#Event-interfaces" class="headerlink" title="Event interfaces"></a>Event interfaces</h3><ul><li>ServletRequestListener</li><li>ServletRequestAttributeListener</li><li>ServletContextListener</li><li>ServletContextAttributeListener</li><li>HttpSessionListener</li><li>HttpSessionAttributeListener</li><li>HttpSessionBindingListener</li><li>HttpSessionActivationListener</li></ul><hr><h3 id="ServletContextEvent-and-ServletContextListener"><a href="#ServletContextEvent-and-ServletContextListener" class="headerlink" title="ServletContextEvent and ServletContextListener"></a>ServletContextEvent and ServletContextListener</h3><ul><li>The ServletContextEvent is notified when web application is deployed on the server.</li><li>If you want to perform some action at the time of deploying the web application such as creating database connection, creating all the tables of the project etc, you need to implement ServletContextListener interface and provide the implementation of its methods.</li></ul><p><code>Web application &gt; ServletContextEvent &gt; ServletContextListener</code></p><h3 id="HttpSessionEvent-and-HttpSessionListener"><a href="#HttpSessionEvent-and-HttpSessionListener" class="headerlink" title="HttpSessionEvent and HttpSessionListener"></a>HttpSessionEvent and HttpSessionListener</h3><ul><li>The HttpSessionEvent is notified when session object is changed. The corresponding Listener interface for this event is HttpSessionListener.</li><li>We can perform some operations at this event such as counting total and current logged-in users, maintaing a log of user details such as login time, logout time etc.</li></ul><p><code>session object &gt; HttpSessionEvent &gt; HttpSessionListener</code></p><h1 id="other"><a href="#other" class="headerlink" title="other"></a>other</h1><h3 id="generate-code-based-proto-file"><a href="#generate-code-based-proto-file" class="headerlink" title="generate code based proto file"></a>generate code based proto file</h3><p><code>protoc --proto_path=æ‰«æç›®å½• --java_out=ä»£ç ç”Ÿæˆç›®å½• protoæ–‡ä»¶ç›®å½•</code></p><blockquote><p>protoc â€“proto_path=src â€“java_out=build/gen src/foo.proto</p></blockquote><h3 id="Spring-provides-three-way-of-scheduling"><a href="#Spring-provides-three-way-of-scheduling" class="headerlink" title="Spring provides three way of scheduling:"></a>Spring provides three way of scheduling:</h3><ul><li>@Scheduled</li><li>Via Quartz</li><li>Via JDK Timer</li></ul><hr><h3 id="one-word"><a href="#one-word" class="headerlink" title="one word"></a>one word</h3><ul><li>\xå¯¹åº”çš„æ˜¯UTF-8ç¼–ç çš„æ•°æ®</li></ul>]]></content>
      
      
      <categories>
          
          <category> java backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java code snippet</title>
      <link href="/2016/02/16/java%20code%20snippet/"/>
      <url>/2016/02/16/java%20code%20snippet/</url>
      
        <content type="html"><![CDATA[<h2 id="base64ToByte"><a href="#base64ToByte" class="headerlink" title="base64ToByte"></a>base64ToByte</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String string = <span class="string">&quot;SmF2YWNvZGVnZWVrcw==&quot;</span>;</span><br><span class="line"><span class="comment">// Get bytes from string</span></span><br><span class="line"><span class="keyword">byte</span>[] byteArray = Base64.decodeBase64(string.getBytes());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print the decoded array</span></span><br><span class="line">System.out.println(Arrays.toString(byteArray));</span><br><span class="line"><span class="comment">// Print the decoded string </span></span><br><span class="line">String decodedString = <span class="keyword">new</span> String(byteArray);</span><br><span class="line">System.out.println(string + <span class="string">&quot; = &quot;</span> + decodedString);</span><br></pre></td></tr></table></figure><h2 id="TimeConvert"><a href="#TimeConvert" class="headerlink" title="TimeConvert"></a>TimeConvert</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//date format</span></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.time.DateFormatUtils;</span><br><span class="line">String timeStr = DateFormatUtils.format(dateDate,<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">Date dateTime = DateUtils.parseDate(dateTimeStr,<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">Date dateWithoutTime = sdf.parse(sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line"><span class="comment">//capitalize the first letter of word</span></span><br><span class="line">String output = input.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase() + input.substring(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//measure the time cost</span></span><br><span class="line"><span class="keyword">long</span> start = System.nanoTime();</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">long</span> end = System.nanoTime();</span><br><span class="line"><span class="keyword">long</span> used = end-start;</span><br><span class="line">System.out.println(<span class="string">&quot;used:&quot;</span>+TimeUnit.NANOSECONDS.toMillis(used)+<span class="string">&quot; ms&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//stream read database   </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStreamRead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        oracleSqlSessionTemplate.select(<span class="string">&quot;xxxx.OracleMapper.getPersonInfos&quot;</span>, <span class="keyword">new</span> ResultHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleResult</span><span class="params">(ResultContext resultContext)</span> </span>&#123;</span><br><span class="line">                PersonInfo personInfo = (PersonInfo) resultContext.getResultObject();</span><br><span class="line">                LOG.debug(<span class="string">&quot;result count:[&#123;&#125;],result info:[&#123;&#125;]&quot;</span>, resultContext.getResultCount(), personInfo.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStreamRead2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        oracleSqlSessionTemplate.select(<span class="string">&quot;xxxx.OracleMapper.getPersonInfos&quot;</span>,</span><br><span class="line">                resultContext -&gt; &#123;</span><br><span class="line">                    PersonInfo personInfo = (PersonInfo) resultContext.getResultObject();</span><br><span class="line">                    LOG.debug(<span class="string">&quot;result count:[&#123;&#125;],result info:[&#123;&#125;]&quot;</span>, resultContext.getResultCount(), personInfo.getName());</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//iterate list</span></span><br><span class="line">myFinalList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">myListToParse.stream()</span><br><span class="line">        .filter(elt -&gt; elt != <span class="keyword">null</span>)</span><br><span class="line">        .forEach(elt -&gt; myFinalList.add(doSomething(elt)));</span><br><span class="line"><span class="comment">//prefer</span></span><br><span class="line">myFinalList = myListToParse.stream()</span><br><span class="line">        .filter(elt -&gt; elt != <span class="keyword">null</span>)</span><br><span class="line">        .map(elt -&gt; doSomething(elt))</span><br><span class="line">        .collect(Collectors.toList()); </span><br></pre></td></tr></table></figure><h2 id="thread"><a href="#thread" class="headerlink" title="thread"></a>thread</h2><h3 id="notify-thread"><a href="#notify-thread" class="headerlink" title="notify thread"></a>notify thread</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shared</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">waitMethod</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">         </span><br><span class="line">        System.out.println(t.getName()+<span class="string">&quot; is releasing the lock and going to wait&quot;</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        System.out.println(t.getName()+<span class="string">&quot; has been notified and acquired the lock back&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">notifyOneThread</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">         </span><br><span class="line">        notify();</span><br><span class="line">         </span><br><span class="line">        System.out.println(t.getName()+<span class="string">&quot; has notified one thread waiting for this object lock&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainClass</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Shared s = <span class="keyword">new</span> Shared();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//Thread t1 will be waiting for lock of object &#x27;s&#x27;</span></span><br><span class="line">         </span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread() </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                s.waitMethod();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">         </span><br><span class="line">        t1.start();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//Thread t2 will be waiting for lock of object &#x27;s&#x27;</span></span><br><span class="line">         </span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread() </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                s.waitMethod();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"> </span><br><span class="line">        t2.start();</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//Thread t3 will be waiting for lock of object &#x27;s&#x27;</span></span><br><span class="line">         </span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread() </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                s.waitMethod();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">         </span><br><span class="line">        t3.start();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//Thread t4 will notify only one thread which is waiting for lock of object &#x27;s&#x27;</span></span><br><span class="line">         </span><br><span class="line">        Thread t4 = <span class="keyword">new</span> Thread() </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                s.notifyOneThread();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">         </span><br><span class="line">        t4.start(); </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="stop-thread"><a href="#stop-thread" class="headerlink" title="stop thread"></a>stop thread</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//Initially setting the flag as true</span></span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//This method will set flag as false</span></span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopRunning</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        flag = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//Keep the task in while loop</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">//This will make thread continue to run until flag becomes false</span></span><br><span class="line">         </span><br><span class="line">        <span class="keyword">while</span> (flag)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;I am running....&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        System.out.println(<span class="string">&quot;Stopped Running....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainClass</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MyThread thread = <span class="keyword">new</span> MyThread();</span><br><span class="line">         </span><br><span class="line">        thread.start();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//call stopRunning() method whenever you want to stop a thread</span></span><br><span class="line">         </span><br><span class="line">        thread.stopRunning();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!Thread.interrupted())</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;I am running....&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        System.out.println(<span class="string">&quot;Stopped Running.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainClass</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MyThread thread = <span class="keyword">new</span> MyThread();</span><br><span class="line">         </span><br><span class="line">        thread.start();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//interrupting the thread</span></span><br><span class="line">         </span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="try-catch-finally"><a href="#try-catch-finally" class="headerlink" title="try-catch-finally"></a>try-catch-finally</h3><ol><li>ä¸ç®¡æœ‰æœ¨æœ‰å‡ºç°å¼‚å¸¸ï¼Œfinallyå—ä¸­ä»£ç éƒ½ä¼šæ‰§è¡Œ** </li><li><strong>å½“tryå’Œcatchä¸­æœ‰returnæ—¶ï¼Œfinallyä»ç„¶ä¼šæ‰§è¡Œ</strong> </li><li><strong>finallyæ˜¯åœ¨returnåé¢çš„è¡¨è¾¾å¼è¿ç®—åæ‰§è¡Œçš„ï¼ˆæ­¤æ—¶å¹¶æ²¡æœ‰è¿”å›è¿ç®—åçš„å€¼ï¼Œè€Œæ˜¯å…ˆæŠŠè¦è¿”å›çš„å€¼ä¿å­˜èµ·æ¥ï¼Œç®¡finallyä¸­çš„ä»£ç æ€ä¹ˆæ ·ï¼Œè¿”å›çš„å€¼éƒ½ä¸ä¼šæ”¹å˜ï¼Œä»ç„¶æ˜¯ä¹‹å‰ä¿å­˜çš„å€¼ï¼‰ï¼Œæ‰€ä»¥å‡½æ•°è¿”å›å€¼æ˜¯åœ¨finallyæ‰§è¡Œå‰ç¡®å®šçš„ï¼›</strong> </li><li><strong>finallyä¸­æœ€å¥½ä¸è¦åŒ…å«returnï¼Œå¦åˆ™ç¨‹åºä¼šæå‰é€€å‡ºï¼Œè¿”å›å€¼ä¸æ˜¯tryæˆ–catchä¸­ä¿å­˜çš„è¿”å›å€¼ã€‚</strong> </li><li>ä»»ä½•æ‰§è¡Œtry æˆ–è€…catchä¸­çš„returnè¯­å¥ä¹‹å‰ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œfinallyè¯­å¥ï¼Œå¦‚æœfinallyä¸­æœ‰returnè¯­å¥ï¼Œé‚£ä¹ˆç¨‹åºå°±returnäº†ï¼Œæ‰€ä»¥finallyä¸­çš„returnæ˜¯ä¸€å®šä¼šè¢«returnçš„ã€‚</li></ol><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Java program to show, how to use ReentrantLock in Java.</span></span><br><span class="line"><span class="comment"> * Reentrant lock is an alternative way of locking</span></span><br><span class="line"><span class="comment"> * apart from implicit locking provided by synchronized keyword in Java.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>  Javin Paul</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReentrantLockHowto</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//Locking using Lock and ReentrantLock</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; gets Count: &quot;</span> + count);</span><br><span class="line">            <span class="keyword">return</span> count++;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//Implicit locking using synchronized keyword</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">getCountTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> count++;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ThreadTest counter = <span class="keyword">new</span> ThreadTest();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (counter.getCount() &amp;lt; <span class="number">6</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                        ex.printStackTrace();                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">      </span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (counter.getCount() &amp;lt; <span class="number">6</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                        ex.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">      </span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Output:</span><br><span class="line">Thread-0 gets Count: 0</span><br><span class="line">Thread-1 gets Count: 1</span><br><span class="line">Thread-1 gets Count: 2</span><br><span class="line">Thread-0 gets Count: 3</span><br><span class="line">Thread-1 gets Count: 4</span><br><span class="line">Thread-0 gets Count: 5</span><br><span class="line">Thread-0 gets Count: 6</span><br><span class="line">Thread-1 gets Count: 7</span><br></pre></td></tr></table></figure><h2 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h2><h3 id="Creating-Java-Streams"><a href="#Creating-Java-Streams" class="headerlink" title="Creating Java Streams"></a>Creating Java Streams</h3><ol><li>We can use Stream.of() to create a stream from similar type of data. For example, we can create Java Stream of integers from a group of int or Integer objects.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; stream = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure><ol start="2"><li>We can use Stream.of() with an array of Objects to return the stream. Note that it doesnâ€™t support autoboxing, so we canâ€™t pass primitive type array.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; stream = Stream.of(<span class="keyword">new</span> Integer[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;); </span><br><span class="line"><span class="comment">//works fine</span></span><br><span class="line"></span><br><span class="line">Stream&lt;Integer&gt; stream1 = Stream.of(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;); </span><br><span class="line"><span class="comment">//Compile time error, Type mismatch: cannot convert from Stream&lt;int[]&gt; to Stream&lt;Integer&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>We can use Collection stream() to create sequential stream and parallelStream() to create parallel stream.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; myList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) myList.add(i);</span><br><span class="line"></span><br><span class="line"><span class="comment">//sequential stream</span></span><br><span class="line">Stream&lt;Integer&gt; sequentialStream = myList.stream();</span><br><span class="line"></span><br><span class="line"><span class="comment">//parallel stream</span></span><br><span class="line">Stream&lt;Integer&gt; parallelStream = myList.parallelStream();</span><br></pre></td></tr></table></figure><ol start="4"><li>We can use Stream.generate() and Stream.iterate() methods to create Stream.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;String&gt; stream1 = Stream.generate(() -&gt; &#123;<span class="keyword">return</span> <span class="string">&quot;abc&quot;</span>;&#125;);</span><br><span class="line">Stream&lt;String&gt; stream2 = Stream.iterate(<span class="string">&quot;abc&quot;</span>, (i) -&gt; i);</span><br></pre></td></tr></table></figure><ol start="5"><li>Using Arrays.stream() and String.chars() methods.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LongStream is = Arrays.stream(<span class="keyword">new</span> <span class="keyword">long</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;);</span><br><span class="line">IntStream is2 = <span class="string">&quot;abc&quot;</span>.chars();</span><br></pre></td></tr></table></figure><h3 id="Converting-Java-Stream-to-Collection-or-Array"><a href="#Converting-Java-Stream-to-Collection-or-Array" class="headerlink" title="Converting Java Stream to Collection or Array"></a>Converting Java Stream to Collection or Array</h3><ol><li>We can use java Stream collect() method to get List, Map or Set from stream.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; intStream = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">List&lt;Integer&gt; intList = intStream.collect(Collectors.toList());</span><br><span class="line">System.out.println(intList); <span class="comment">//prints [1, 2, 3, 4]</span></span><br><span class="line"></span><br><span class="line">intStream = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>); <span class="comment">//stream is closed, so we need to create it again</span></span><br><span class="line">Map&lt;Integer,Integer&gt; intMap = intStream.collect(Collectors.toMap(i -&gt; i, i -&gt; i+<span class="number">10</span>));</span><br><span class="line">System.out.println(intMap); <span class="comment">//prints &#123;1=11, 2=12, 3=13, 4=14&#125;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>We can use stream toArray() method to create an array from the stream.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; intStream = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">Integer[] intArray = intStream.toArray(Integer[]::<span class="keyword">new</span>);</span><br><span class="line">System.out.println(Arrays.toString(intArray)); <span class="comment">//prints [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure><h3 id="Java-Stream-Intermediate-Operations"><a href="#Java-Stream-Intermediate-Operations" class="headerlink" title="Java Stream Intermediate Operations"></a>Java Stream Intermediate Operations</h3><ol><li>Stream filter() : We can use filter() method to test stream elements for a condition and generate filtered list.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; myList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) myList.add(i);</span><br><span class="line">Stream&lt;Integer&gt; sequentialStream = myList.stream();</span><br><span class="line"></span><br><span class="line">Stream&lt;Integer&gt; highNums = sequentialStream.filter(p -&gt; p &gt; <span class="number">90</span>); <span class="comment">//filter numbers greater than 90</span></span><br><span class="line">System.out.print(<span class="string">&quot;High Nums greater than 90=&quot;</span>);</span><br><span class="line">highNums.forEach(p -&gt; System.out.print(p+<span class="string">&quot; &quot;</span>));</span><br><span class="line"><span class="comment">//prints &quot;High Nums greater than 90=91 92 93 94 95 96 97 98 99 &quot;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>Stream map() : We can use map() to apply functions to an stream. Letâ€™s see how we can use it to apply upper case function to a list of Strings.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;String&gt; names = Stream.of(<span class="string">&quot;aBc&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;ef&quot;</span>);</span><br><span class="line">System.out.println(names.map(s -&gt; &#123;</span><br><span class="line"><span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">&#125;).collect(Collectors.toList()));</span><br><span class="line"><span class="comment">//prints [ABC, D, EF]</span></span><br></pre></td></tr></table></figure><ol start="3"><li>Stream sorted() : We can use sorted() to sort the stream elements by passing Comparator argument.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;String&gt; names2 = Stream.of(<span class="string">&quot;aBc&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;ef&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">List&lt;String&gt; reverseSorted = names2.sorted(Comparator.reverseOrder()).collect(Collectors.toList());</span><br><span class="line">System.out.println(reverseSorted); <span class="comment">// [ef, d, aBc, 123456]</span></span><br><span class="line"></span><br><span class="line">Stream&lt;String&gt; names3 = Stream.of(<span class="string">&quot;aBc&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;ef&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">List&lt;String&gt; naturalSorted = names3.sorted().collect(Collectors.toList());</span><br><span class="line">System.out.println(naturalSorted); <span class="comment">//[123456, aBc, d, ef]</span></span><br></pre></td></tr></table></figure><ol start="4"><li>Stream flatMap() : We can use flatMap() to create a stream from the stream of list. Letâ€™s see a simple example to clear this doubt.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;List&lt;String&gt;&gt; namesOriginalList = Stream.of(</span><br><span class="line">Arrays.asList(<span class="string">&quot;Pankaj&quot;</span>), </span><br><span class="line">Arrays.asList(<span class="string">&quot;David&quot;</span>, <span class="string">&quot;Lisa&quot;</span>),</span><br><span class="line">Arrays.asList(<span class="string">&quot;Amit&quot;</span>));</span><br><span class="line"><span class="comment">//flat the stream from List&lt;String&gt; to String stream</span></span><br><span class="line">Stream&lt;String&gt; flatStream = namesOriginalList</span><br><span class="line">.flatMap(strList -&gt; strList.stream());</span><br><span class="line"></span><br><span class="line">flatStream.forEach(System.out::println);</span><br></pre></td></tr></table></figure><h3 id="Java-Stream-Terminal-Operations"><a href="#Java-Stream-Terminal-Operations" class="headerlink" title="Java Stream Terminal Operations"></a>Java Stream Terminal Operations</h3><ol><li>Stream reduce() example: We can use reduce() to perform a reduction on the elements of the stream, using an associative accumulation function, and return an Optional. Letâ€™s see how we can use it multiply the integers in a stream.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; numbers = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">Optional&lt;Integer&gt; intOptional = numbers.reduce((i,j) -&gt; &#123;<span class="keyword">return</span> i*j;&#125;);</span><br><span class="line"><span class="keyword">if</span>(intOptional.isPresent()) System.out.println(<span class="string">&quot;Multiplication = &quot;</span>+intOptional.get()); <span class="comment">//120</span></span><br></pre></td></tr></table></figure><ol start="2"><li>Stream count() example: We can use this terminal operation to count the number of items in the stream.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; numbers1 = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Number of elements in stream=&quot;</span>+numbers1.count()); <span class="comment">//5</span></span><br></pre></td></tr></table></figure><ol start="3"><li>Stream forEach() example: This can be used for iterating over the stream. We can use this in place of iterator. Letâ€™s see how to use it for printing all the elements of the stream.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; numbers2 = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">numbers2.forEach(i -&gt; System.out.print(i+<span class="string">&quot;,&quot;</span>)); <span class="comment">//1,2,3,4,5,</span></span><br></pre></td></tr></table></figure><ol start="4"><li>Stream match() examples: Letâ€™s see some of the examples for matching methods in Stream API.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; numbers3 = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Stream contains 4? &quot;</span>+numbers3.anyMatch(i -&gt; i==<span class="number">4</span>));</span><br><span class="line"><span class="comment">//Stream contains 4? true</span></span><br><span class="line"></span><br><span class="line">Stream&lt;Integer&gt; numbers4 = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Stream contains all elements less than 10? &quot;</span>+numbers4.allMatch(i -&gt; i&lt;<span class="number">10</span>));</span><br><span class="line"><span class="comment">//Stream contains all elements less than 10? true</span></span><br><span class="line"></span><br><span class="line">Stream&lt;Integer&gt; numbers5 = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Stream doesn&#x27;t contain 10? &quot;</span>+numbers5.noneMatch(i -&gt; i==<span class="number">10</span>));</span><br><span class="line"><span class="comment">//Stream doesn&#x27;t contain 10? true</span></span><br></pre></td></tr></table></figure><ol start="5"><li>Stream findFirst() :This is a short circuiting terminal operation, letâ€™s see how we can use it to find the first string from a stream starting with D.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;String&gt; names4 = Stream.of(<span class="string">&quot;Pankaj&quot;</span>,<span class="string">&quot;Amit&quot;</span>,<span class="string">&quot;David&quot;</span>, <span class="string">&quot;Lisa&quot;</span>);</span><br><span class="line">Optional&lt;String&gt; firstNameWithD = names4.filter(i -&gt; i.startsWith(<span class="string">&quot;D&quot;</span>)).findFirst();</span><br><span class="line"><span class="keyword">if</span>(firstNameWithD.isPresent())&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;First Name starting with D=&quot;</span>+firstNameWithD.get()); <span class="comment">//David</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="some-example"><a href="#some-example" class="headerlink" title="some example"></a>some example</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//merge collection</span></span><br><span class="line">List&lt;String&gt; resultPersonnos = Stream.of(list1, list2)</span><br><span class="line">                .flatMap(Collection::stream)</span><br><span class="line">                .distinct()</span><br><span class="line">                .sorted()</span><br><span class="line">                .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snippet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vim command</title>
      <link href="/2015/08/16/vim%20command/"/>
      <url>/2015/08/16/vim%20command/</url>
      
        <content type="html"><![CDATA[<h1 id="config"><a href="#config" class="headerlink" title="config"></a>config</h1><p><code>~/.vimrc</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&quot; Tab and Indentation Settings</span><br><span class="line">set tabstop=4        &quot; Number of spaces a tab counts for</span><br><span class="line">set shiftwidth=4     &quot; Number of spaces to use for each step of auto indent</span><br><span class="line">set expandtab        &quot; Use spaces instead of tabs</span><br><span class="line">set smarttab         &quot; Insert tabs on the start of a line according to shiftwidth</span><br><span class="line">set autoindent       &quot; Copy indent from current line when starting a new line</span><br><span class="line">set smartindent      &quot; Smart autoindenting when starting a new line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot; General Settings</span><br><span class="line">set number           &quot; Show line numbers</span><br><span class="line">set relativenumber   &quot; Show relative line numbers</span><br><span class="line">set ruler            &quot; Show cursor position</span><br><span class="line">set encoding=utf-8   &quot; Set UTF-8 encoding</span><br><span class="line">set scrolloff=5      &quot; Keep 5 lines visible above/below cursor</span><br><span class="line"></span><br><span class="line">&quot; Search Settings</span><br><span class="line">set ignorecase       &quot; Ignore case when searching</span><br><span class="line">set smartcase        &quot; Override ignorecase if search contains uppercase</span><br><span class="line">set hlsearch         &quot; Highlight search results</span><br><span class="line">set incsearch        &quot; Show search matches as you type</span><br><span class="line"></span><br><span class="line">&quot; Syntax and Appearance</span><br><span class="line">syntax enable        &quot; Enable syntax highlighting</span><br><span class="line">set background=dark  &quot; Dark background mode</span><br><span class="line">colorscheme default  &quot; Choose a color scheme</span><br><span class="line"></span><br><span class="line">&quot; File Handling</span><br><span class="line">set autoread         &quot; Automatically read files changed outside of Vim</span><br><span class="line">set nobackup         &quot; Don&#x27;t create backup files</span><br><span class="line">set noswapfile       &quot; Don&#x27;t use swap files</span><br></pre></td></tr></table></figure><ul><li><p>format script</p><ol><li>   Move to the top of the file using <code>gg</code>.</li><li>   Re-indent the file:  <code>gg=G</code></li></ol></li></ul>  <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">set</span> <span class="keyword">filetype</span>=<span class="keyword">sh</span>  # optional</span><br><span class="line">:<span class="keyword">set</span> autoindent</span><br><span class="line">:<span class="keyword">set</span> tabstop=<span class="number">4</span>       <span class="comment">&quot; Number of spaces per tab</span></span><br><span class="line">:<span class="keyword">set</span> <span class="built_in">shiftwidth</span>=<span class="number">4</span>    <span class="comment">&quot; Number of spaces for indentation</span></span><br><span class="line">:<span class="keyword">set</span> expandtab       <span class="comment">&quot; Use spaces instead of tabs</span></span><br></pre></td></tr></table></figure><ul><li><p>format json</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%!jq .</span><br></pre></td></tr></table></figure></li><li><p>formate xml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%!xmllint --format %</span><br></pre></td></tr></table></figure></li><li><p>æ˜¾ç¤ºä¸å¯è§å­—ç¬¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:set list</span><br></pre></td></tr></table></figure></li><li><p>ç»Ÿè®¡å­—ç¬¦å‡ºç°æ¬¡æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/å­—ç¬¦ä¸²//ng</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>å¤§å°å†™è½¬æ¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€‰æ‹©æ–‡æœ¬ä¹‹åï¼Œæ‰§è¡Œ g~~ è¿›è¡Œå¤§å°å†™çš„è½¬æ¢</span><br></pre></td></tr></table></figure></li><li><p>å…¨æ–‡é€‰æ‹©</p></li><li><p>å¤šè¡Œæ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŒ‰ä¸‹ Ctrl + v è¿›å…¥å¯è§†å—æ¨¡å¼ã€‚</span><br><span class="line">ä½¿ç”¨ä¸Šä¸‹ç®­å¤´é”®æˆ– j å’Œ k é”®é€‰æ‹©è¦ç¼–è¾‘çš„è¡Œã€‚</span><br><span class="line">æŒ‰ä¸‹ Shift + i è¿›å…¥æ’å…¥æ¨¡å¼ã€‚</span><br><span class="line">è¾“å…¥è¦æ’å…¥çš„æ–‡æœ¬ã€‚</span><br><span class="line">æŒ‰ä¸‹ Esc é”®é€€å‡ºæ’å…¥æ¨¡å¼ï¼Œæ‰€æœ‰é€‰å®šçš„è¡Œéƒ½å°†è¢«ä¿®æ”¹ã€‚</span><br></pre></td></tr></table></figure></li></ul><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><h2 id="type-M"><a href="#type-M" class="headerlink" title="type ^M"></a>type <code>^M</code></h2><blockquote><p>equal <code>\r</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Ctrl-V Ctrl-M</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
