<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="虚拟环境项目粒度：python -m venv venv                    poetry系统粒度：pyenv                    conda 指令 安装tar.gz，解压之后，执行 1python3 setup.py install  pip 国内镜像 12pip config set global.index-url https:&#x2F;&#x2F;pypi.mirrors">
<meta property="og:type" content="article">
<meta property="og:title" content="python snippet">
<meta property="og:url" content="https://www.willshirley.top/2023/11/14/python%20snippet/index.html">
<meta property="og:site_name" content="Clean &amp; Focus">
<meta property="og:description" content="虚拟环境项目粒度：python -m venv venv                    poetry系统粒度：pyenv                    conda 指令 安装tar.gz，解压之后，执行 1python3 setup.py install  pip 国内镜像 12pip config set global.index-url https:&#x2F;&#x2F;pypi.mirrors">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-11-14T07:28:51.000Z">
<meta property="article:modified_time" content="2025-03-14T12:29:04.761Z">
<meta property="article:author" content="brook">
<meta property="article:tag" content="snippet">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>python snippet</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Clean & Focus" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/archives/">Log</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/11/15/tmux%20snippet/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/11/05/gateway%20snippet/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.willshirley.top/2023/11/14/python%20snippet/&text=python snippet"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.willshirley.top/2023/11/14/python%20snippet/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=python snippet&body=Check out this article: https://www.willshirley.top/2023/11/14/python%20snippet/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.willshirley.top/2023/11/14/python%20snippet/&title=python snippet"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.willshirley.top/2023/11/14/python%20snippet/&title=python snippet"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.willshirley.top/2023/11/14/python%20snippet/&title=python snippet"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.willshirley.top/2023/11/14/python%20snippet/&t=python snippet"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">虚拟环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">指令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pip"><span class="toc-number">2.1.</span> <span class="toc-text">pip</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Buildins"><span class="toc-number">3.</span> <span class="toc-text">Buildins</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#profiler"><span class="toc-number">4.</span> <span class="toc-text">profiler</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#py-spy"><span class="toc-number">4.1.</span> <span class="toc-text">py-spy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E5%88%9B"><span class="toc-number">5.</span> <span class="toc-text">信创</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">6.</span> <span class="toc-text">规范</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Principle"><span class="toc-number">7.</span> <span class="toc-text">Principle</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SOLID"><span class="toc-number">7.1.</span> <span class="toc-text">SOLID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#idea"><span class="toc-number">7.2.</span> <span class="toc-text">idea</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-practise"><span class="toc-number">7.3.</span> <span class="toc-text">code practise</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%B9%E7%95%8C%E6%83%85%E5%86%B5%EF%BC%88Edge-cases%EF%BC%89"><span class="toc-number">7.3.0.1.</span> <span class="toc-text">边界情况（Edge cases）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Method"><span class="toc-number">8.</span> <span class="toc-text">Method</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">8.0.1.</span> <span class="toc-text">统计运行时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#call-%E5%87%BD%E6%95%B0"><span class="toc-number">8.0.2.</span> <span class="toc-text">__call__函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">8.0.3.</span> <span class="toc-text">**使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9C%9F%E5%81%87%E5%88%A4%E6%96%AD"><span class="toc-number">8.0.4.</span> <span class="toc-text">布尔真假判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E4%B8%AD%E4%BD%BF%E7%94%A8-all-any"><span class="toc-number">8.0.5.</span> <span class="toc-text">在条件判断中使用 all() &#x2F; any()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-partial-%E6%9E%84%E9%80%A0%E6%96%B0%E5%87%BD%E6%95%B0"><span class="toc-number">8.0.6.</span> <span class="toc-text">使用 partial 构造新函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mixin"><span class="toc-number">8.0.7.</span> <span class="toc-text">Mixin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LOOP"><span class="toc-number">8.0.8.</span> <span class="toc-text">LOOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%96%E5%B1%82%E5%8F%98%E9%87%8F%E6%97%B6%E8%AE%B0%E5%BE%97%E4%BD%BF%E7%94%A8-nonlocal"><span class="toc-number">8.0.9.</span> <span class="toc-text">修改外层变量时记得使用 nonlocal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%AF%B9%E8%B1%A1"><span class="toc-number">8.0.10.</span> <span class="toc-text">类对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-dataclass-%E7%AE%80%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="toc-number">8.0.11.</span> <span class="toc-text">使用 dataclass 简化代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Package"><span class="toc-number">9.</span> <span class="toc-text">Package</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-number">9.0.1.</span> <span class="toc-text">文件处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json"><span class="toc-number">9.0.2.</span> <span class="toc-text">json</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Grammar"><span class="toc-number">10.</span> <span class="toc-text">Grammar</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#struture"><span class="toc-number">10.1.</span> <span class="toc-text">struture</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        python snippet
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">brook</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-11-14T07:28:51.000Z" class="dt-published" itemprop="datePublished">2023-11-14</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/python/">python</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/snippet/" rel="tag">snippet</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h1><p>项目粒度：python -m venv venv<br>                    poetry<br>系统粒度：pyenv<br>                    conda</p>
<h1 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h1><ul>
<li><p>安装tar.gz，解压之后，执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h2><ul>
<li><p>国内镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip config set global.index-url https://pypi.mirrors.ustc.edu.cn/simple</span><br><span class="line">pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure></li>
<li><p>安装子模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install &#x27;fastapi_amis_admin[cli]&#x27;  # 注意引号</span><br></pre></td></tr></table></figure></li>
<li><p>查看指定依赖版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip show package_name</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p>把项目的依赖放入指定文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure></li>
<li><p>清除缓存</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip cache purge</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Buildins"><a href="#Buildins" class="headerlink" title="Buildins"></a>Buildins</h1><ul>
<li>装饰器 <code>staticmethod</code> 用于定义与类或实例无关的函数，而 <code>classmethod</code> 用于定义需要访问类或类变量的函数。</li>
</ul>
<h1 id="profiler"><a href="#profiler" class="headerlink" title="profiler"></a>profiler</h1><h2 id="py-spy"><a href="#py-spy" class="headerlink" title="py-spy"></a>py-spy</h2><ul>
<li>record</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo py-spy record -o tableagent.svg --pid 37152</span><br></pre></td></tr></table></figure>

<h1 id="信创"><a href="#信创" class="headerlink" title="信创"></a>信创</h1><ul>
<li><p>安装python3-devel</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install python3-devel</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h1><ul>
<li><p><strong>请选择四个空格的缩进，不要使用 Tab，更不要 Tab 和空格混着用。</strong></p>
</li>
<li><p><strong>全局的类和函数的上方需要空两个空行，而类的函数之间需要空一个空行</strong></p>
</li>
<li><p>代码的尾部，每个代码文件的最后一行为空行，并且只有这一个空行。</p>
</li>
<li><p>可以使用<code>#</code>进行单独注释，请记得要在<code>#</code>后、注释前加一个空格。</p>
</li>
<li><p>对于操作符，例如<code>+</code>，<code>-</code>，<code>*</code>，<code>/</code>，<code>&amp;</code>，<code>|</code>，<code>=</code>，<code>==</code>，<code>!=</code>，请在两边都保留空格。不过与此对应，括号内的两端并不需要空格。</p>
</li>
<li><p>采用 <code>from module import func</code> 这样的语句，请确保 func 在本文件中不会出现命名冲突。不过，你其实可以通过 <code>from module import func as new_func</code> 来进行重命名，从而避免冲突。</p>
</li>
<li><p>如果是类的私有变量，请记得前面增加两个下划线。</p>
</li>
<li><p>对于常量，最好的做法是全部大写，并通过下划线连接</p>
</li>
<li><p>对于函数名，同样也请使用小写的方式，通过下划线连接起来，例如：<code>launch_nuclear_missile()</code>、<code>check_input_validation()</code>。</p>
</li>
<li><p>对于类名，则应该首字母大写，然后合并起来，例如：<code>class SpatialDropout2D()</code>、<code>class FeatureSet()</code>。</p>
</li>
</ul>
<h1 id="Principle"><a href="#Principle" class="headerlink" title="Principle"></a>Principle</h1><h2 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h2><ul>
<li><p>S <em>（单一职责原则 Single responsibility principle）</em> </p>
<ul>
<li><strong>一个类应该仅仅只有一个被修改的理由。</strong></li>
</ul>
</li>
<li><p>O <em>（开放-关闭原则 Open–closed principle）</em></p>
<ul>
<li><strong>类应该对扩展开放，对修改封闭。</strong></li>
</ul>
</li>
<li><p>L <em>（里氏替换原则 Liskov Substitution Principle）</em></p>
<ul>
<li><strong>子类应该可以随意替换它的父类 ，而不破坏程序 本身的功能</strong></li>
</ul>
</li>
<li><p>I <em>（接口隔离原则 Interface Segregation Principles）</em></p>
<ul>
<li><strong>客户（client）应该不依赖于它不使用的方法</strong></li>
</ul>
</li>
<li><p>D <em>（依赖倒置原则 Dependency Inversion Principle）</em></p>
<ul>
<li><strong>高层模块不应该依赖于低层模块，二者都应该依赖于抽象。</strong></li>
</ul>
</li>
</ul>
<h2 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h2><ul>
<li>好代码在处理边界情况时应该是简洁的、“润物细无声”的</li>
</ul>
<h2 id="code-practise"><a href="#code-practise" class="headerlink" title="code practise"></a>code practise</h2><h4 id="边界情况（Edge-cases）"><a href="#边界情况（Edge-cases）" class="headerlink" title="边界情况（Edge cases）"></a>边界情况（Edge cases）</h4><ul>
<li>bad style: <ul>
<li>LBYL（Look Before You Leap）</li>
</ul>
</li>
<li>better style:<ul>
<li>EAFP（Easier to Ask for Forgiveness than Permission）</li>
</ul>
</li>
<li>best style<ul>
<li>在日常编码时，我们应该尽量避免去手动校验数据。而是应该使用<em>（或者自己实现）</em>合适的第三方校验模块，把这部分边界处理工作抽象出去，简化主流程代码。</li>
</ul>
</li>
</ul>
<h1 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h1><h3 id="统计运行时间"><a href="#统计运行时间" class="headerlink" title="统计运行时间"></a>统计运行时间</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 毫秒值</span></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">xxx</span><br><span class="line">cost_time = <span class="built_in">int</span>((time.perf_counter() - start_time)* <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="call-函数"><a href="#call-函数" class="headerlink" title="__call__函数"></a><code>__call__函数</code></h3><p><code>__call__</code> 方法是 Python 中的一个特殊方法（也称为魔术方法），用于将一个对象作为函数调用。当一个对象被作为函数调用时，Python 解释器会自动调用该对象的 <code>__call__</code> 方法。</p>
<p>在类中定义 <code>__call__</code> 方法可以使对象具有可调用的行为，就像调用函数一样。这样的对象被称为可调用对象。通过实现 <code>__call__</code> 方法，我们可以在对象被调用时执行特定的逻辑。</p>
<p>以下是一个示例，展示了如何定义和使用 <code>__call__</code> 方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableClass</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Object is being called&quot;</span>)</span><br><span class="line"></span><br><span class="line">obj = CallableClass()</span><br><span class="line">obj()  <span class="comment"># 等同于调用 obj.__call__()</span></span><br></pre></td></tr></table></figure>

<p>在上面的示例中，我们定义了一个名为 <code>CallableClass</code> 的类，并在其中实现了 <code>__call__</code> 方法。当创建 <code>CallableClass</code> 的实例 <code>obj</code> 并将其作为函数调用时，<code>__call__</code> 方法会被自动调用，并打印出 “Object is being called”。</p>
<p>需要注意的是，<code>__call__</code> 方法可以带有参数，就像普通的函数一样。我们可以在 <code>__call__</code> 方法中定义任意的逻辑，可以访问实例的属性、调用其他方法等。</p>
<p>使用 <code>__call__</code> 方法可以使对象具有类似函数的行为，这在某些情况下非常有用，例如实现可调用的类或实现函数式编程的概念。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="**使用"></a><code>**</code>使用</h3><ul>
<li><p><code>**</code> 运算符用于解包字典或关键字参数。当应用于字典时，<code>**</code> 运算符可以将字典中的键值对解包为一系列关键字参数传递给函数或方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_person_info</span>(<span class="params">name, age, city</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Name: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Age: <span class="subst">&#123;age&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;City: <span class="subst">&#123;city&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">person = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;New York&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print_person_info(**person)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="布尔真假判断"><a href="#布尔真假判断" class="headerlink" title="布尔真假判断"></a>布尔真假判断</h3><p>虽然所有用户类实例的布尔值都是真。但是 Python 提供了改变这个行为的办法：<strong>自定义类的 <code>__bool__</code> 魔法方法</strong> <em>（在 Python 2.X 版本中为 <code>__nonzero__</code>）</em>。当类定义了 <code>__bool__</code> 方法后，它的返回值将会被当作类实例的布尔值。</p>
<p>另外，<code>__bool__</code> 不是影响实例布尔真假的唯一方法。如果类没有定义 <code>__bool__</code> 方法，Python 还会尝试调用 <code>__len__</code> 方法<em>（也就是对任何序列对象调用 <code>len</code> 函数）</em>，通过结果是否为 <code>0</code> 判断实例真假。</p>
<h3 id="在条件判断中使用-all-any"><a href="#在条件判断中使用-all-any" class="headerlink" title="在条件判断中使用 all() / any()"></a>在条件判断中使用 all() / any()</h3><p><code>all()</code> 和 <code>any()</code> 两个函数非常适合在条件判断中使用。这两个函数接受一个可迭代对象，返回一个布尔值，其中：</p>
<ul>
<li><code>all(seq)</code>：仅当 <code>seq</code> 中所有对象都为布尔真时返回 <code>True</code>，否则返回 <code>False</code></li>
<li><code>any(seq)</code>：只要 <code>seq</code> 中任何一个对象为布尔真就返回 <code>True</code>，否则返回 <code>False</code></li>
</ul>
<h3 id="使用-partial-构造新函数"><a href="#使用-partial-构造新函数" class="headerlink" title="使用 partial 构造新函数"></a>使用 partial 构造新函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x * y</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">double</span>(<span class="params">value</span>):</span></span><br><span class="line">    <span class="comment"># 返回另一个函数调用结果</span></span><br><span class="line">    <span class="keyword">return</span> multiply(<span class="number">2</span>, value)</span><br></pre></td></tr></table></figure>

<p>可写成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line">double = functools.partial(multiply, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Mixin"><a href="#Mixin" class="headerlink" title="Mixin"></a>Mixin</h3><blockquote>
<p>Mixin 是面向对象编程中的一个术语，它表示一种设计模式，用于将一组功能或行为以模块化的方式添加到类中，而不需要使用继承的方式。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendMailMixin</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_mail</span>(<span class="params">self, email</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Sending mail to <span class="subst">&#123;email&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, email</span>):</span></span><br><span class="line">        self.email = email</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminUser</span>(<span class="params">User, SendMailMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_admin_mail</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.send_mail(self.email)</span><br><span class="line"></span><br><span class="line">admin = AdminUser(<span class="string">&quot;admin@example.com&quot;</span>)</span><br><span class="line">admin.send_admin_mail()  <span class="comment"># 输出: Sending mail to admin@example.com</span></span><br></pre></td></tr></table></figure>



<p><strong>Mixin和abc.ABC的区别:</strong></p>
<ol>
<li><strong>用途</strong>: Mixin侧重于代码复用和功能扩展,而abc.ABC则用于定义抽象类和接口。</li>
<li><strong>继承关系</strong>: Mixin通常与其他类一起使用多重继承,而abc.ABC作为基类被具体类继承。</li>
<li><strong>抽象程度</strong>: Mixin可以包含具体的实现,而abc.ABC中的抽象方法必须由子类实现。</li>
<li><strong>类型检查</strong>: abc.ABC可用于类型检查,而Mixin无法直接进行类型检查。</li>
</ol>
<h3 id="LOOP"><a href="#LOOP" class="headerlink" title="LOOP"></a>LOOP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(names):</span><br><span class="line">    <span class="built_in">print</span>(i, name)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 product 扁平化多层嵌套循环</li>
<li>使用 islice 实现循环内隔行处理</li>
<li>使用 takewhile 替代 break 语句</li>
<li>使用生成器编写自己的修饰函数</li>
</ul>
<h3 id="修改外层变量时记得使用-nonlocal"><a href="#修改外层变量时记得使用-nonlocal" class="headerlink" title="修改外层变量时记得使用 nonlocal"></a>修改外层变量时记得使用 nonlocal</h3><ul>
<li>闭包的参数使用</li>
</ul>
<h3 id="类对象"><a href="#类对象" class="headerlink" title="类对象"></a>类对象</h3><ul>
<li><code>cls</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_send_request</span>(<span class="params">cls, method, endpoint, json=<span class="literal">None</span>, params=<span class="literal">None</span></span>):</span></span><br></pre></td></tr></table></figure>



<h3 id="使用-dataclass-简化代码"><a href="#使用-dataclass-简化代码" class="headerlink" title="使用 dataclass 简化代码"></a>使用 dataclass 简化代码</h3><p>总结一下,dataclass主要提供了以下几方面的功能:</p>
<ol>
<li><p><strong>自动生成构造函数和基本方法</strong></p>
<ul>
<li>自动生成<code>__init__</code>构造函数</li>
<li>自动生成<code>__repr__</code>、<code>__eq__</code>等基本方法</li>
</ul>
</li>
<li><p><strong>数据字段管理</strong></p>
<ul>
<li>定义数据字段</li>
<li>支持为字段设置默认值</li>
<li>支持字段类型注解</li>
<li>支持只读字段、后期初始化字段</li>
</ul>
</li>
<li><p><strong>数据类行为定制</strong></p>
<ul>
<li>可自定义字段排序</li>
<li>可自定义字段命名规则(snake_case/CamelCase)</li>
<li>支持自定义<code>__post_init__</code>方法做数据校验</li>
<li>可控制是否生成<code>__repr__</code>方法</li>
<li>支持生成<code>__hash__</code>方法用于哈希</li>
</ul>
</li>
<li><p><strong>性能优化</strong></p>
<ul>
<li>支持使用<code>__slots__</code>优化内存使用</li>
</ul>
</li>
<li><p><strong>与静态类型检查工具结合</strong></p>
<ul>
<li>支持与mypy等类型检查工具结合使用</li>
</ul>
</li>
<li><p><strong>继承和嵌套</strong></p>
<ul>
<li>支持数据类的继承</li>
<li>支持嵌套数据类作为字段</li>
</ul>
</li>
</ol>
<p>通过这些功能,dataclass可以极大简化数据类的定义和使用,减少样板代码。它使得创建数据类变得高效和优雅,同时还提供了足够的定制空间。无论是简单的数据持有对象还是复杂的数据结构,dataclass都能发挥它的优势,提高代码的可读性和可维护性。</p>
<h1 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h1><h3 id="文件处理"><a href="#文件处理" class="headerlink" title="文件处理"></a>文件处理</h3><ul>
<li>pathlib</li>
</ul>
<h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><p>json模块主要有四个比较重要的函数，分别是：</p>
<ul>
<li><code>dump</code> - 将Python对象按照JSON格式序列化到文件中</li>
<li><code>dumps</code> - 将Python对象处理成JSON格式的字符串</li>
<li><code>load</code> - 将文件中的JSON数据反序列化成对象</li>
<li><code>loads</code> - 将字符串的内容反序列化成Python对象</li>
</ul>
<h1 id="Grammar"><a href="#Grammar" class="headerlink" title="Grammar"></a>Grammar</h1><ul>
<li><code>*args</code> 接收并处理所有传递进来的位置参数，<code>**kwargs</code> 接收并处理所有传递进来的关键字参数。</li>
</ul>
<h2 id="struture"><a href="#struture" class="headerlink" title="struture"></a>struture</h2><ul>
<li><p>在Python中，基本数据类型（如整数、布尔值）是不可变的，这意味着当你将一个基本数据类型的变量传递给一个函数或方法时，你实际上是传递了它的值的副本，而不是它本身。</p>
<p>因此，如果你在一个方法内部修改了一个基本数据类型的成员变量，这个修改不会影响到任何其他方法中对该成员变量的引用。</p>
</li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/archives/">Log</a></li>
        
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">虚拟环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">指令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pip"><span class="toc-number">2.1.</span> <span class="toc-text">pip</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Buildins"><span class="toc-number">3.</span> <span class="toc-text">Buildins</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#profiler"><span class="toc-number">4.</span> <span class="toc-text">profiler</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#py-spy"><span class="toc-number">4.1.</span> <span class="toc-text">py-spy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E5%88%9B"><span class="toc-number">5.</span> <span class="toc-text">信创</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">6.</span> <span class="toc-text">规范</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Principle"><span class="toc-number">7.</span> <span class="toc-text">Principle</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SOLID"><span class="toc-number">7.1.</span> <span class="toc-text">SOLID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#idea"><span class="toc-number">7.2.</span> <span class="toc-text">idea</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code-practise"><span class="toc-number">7.3.</span> <span class="toc-text">code practise</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%B9%E7%95%8C%E6%83%85%E5%86%B5%EF%BC%88Edge-cases%EF%BC%89"><span class="toc-number">7.3.0.1.</span> <span class="toc-text">边界情况（Edge cases）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Method"><span class="toc-number">8.</span> <span class="toc-text">Method</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">8.0.1.</span> <span class="toc-text">统计运行时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#call-%E5%87%BD%E6%95%B0"><span class="toc-number">8.0.2.</span> <span class="toc-text">__call__函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">8.0.3.</span> <span class="toc-text">**使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9C%9F%E5%81%87%E5%88%A4%E6%96%AD"><span class="toc-number">8.0.4.</span> <span class="toc-text">布尔真假判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E4%B8%AD%E4%BD%BF%E7%94%A8-all-any"><span class="toc-number">8.0.5.</span> <span class="toc-text">在条件判断中使用 all() &#x2F; any()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-partial-%E6%9E%84%E9%80%A0%E6%96%B0%E5%87%BD%E6%95%B0"><span class="toc-number">8.0.6.</span> <span class="toc-text">使用 partial 构造新函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mixin"><span class="toc-number">8.0.7.</span> <span class="toc-text">Mixin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LOOP"><span class="toc-number">8.0.8.</span> <span class="toc-text">LOOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%96%E5%B1%82%E5%8F%98%E9%87%8F%E6%97%B6%E8%AE%B0%E5%BE%97%E4%BD%BF%E7%94%A8-nonlocal"><span class="toc-number">8.0.9.</span> <span class="toc-text">修改外层变量时记得使用 nonlocal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%AF%B9%E8%B1%A1"><span class="toc-number">8.0.10.</span> <span class="toc-text">类对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-dataclass-%E7%AE%80%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="toc-number">8.0.11.</span> <span class="toc-text">使用 dataclass 简化代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Package"><span class="toc-number">9.</span> <span class="toc-text">Package</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-number">9.0.1.</span> <span class="toc-text">文件处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json"><span class="toc-number">9.0.2.</span> <span class="toc-text">json</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Grammar"><span class="toc-number">10.</span> <span class="toc-text">Grammar</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#struture"><span class="toc-number">10.1.</span> <span class="toc-text">struture</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.willshirley.top/2023/11/14/python%20snippet/&text=python snippet"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.willshirley.top/2023/11/14/python%20snippet/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=python snippet&body=Check out this article: https://www.willshirley.top/2023/11/14/python%20snippet/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.willshirley.top/2023/11/14/python%20snippet/&title=python snippet"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.willshirley.top/2023/11/14/python%20snippet/&title=python snippet"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.willshirley.top/2023/11/14/python%20snippet/&title=python snippet"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.willshirley.top/2023/11/14/python%20snippet/&t=python snippet"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    brook
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/archives/">Log</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
